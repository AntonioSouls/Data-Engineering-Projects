<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning</title>
<!--Generated on Fri Oct  4 02:55:44 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2410.03103v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S1" title="In Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2" title="In Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Post-processing for Fill-in-the-Middle</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2.SS1" title="In 2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Post-processing Requires Task-specific Knowledge</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2.SS2" title="In 2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Post-processing Conceals LLMs’ Inability of Connecting to Suffix</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2.SS3" title="In 2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.3 </span>Fill-in-the-Middle Requires Planning Capability of LLMs</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S3" title="In Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Horizon-Length Prediction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4" title="In Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.SS1" title="In 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Syntax-Aware and Multilingual Code Fill-in-the-Middle</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.SS2" title="In 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Repository-Level Cross-File Code Fill-in-the-Middle</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.SS3" title="In 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Code Fixing via Fill-in-the-Middle</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.SS4" title="In 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.4 </span>Code Reasoning via Fill-in-the-Middle</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S5" title="In Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Next-Token Prediction Alone Cannot Yield Horizon Awareness</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S6" title="In Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S7" title="In Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">7 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#A1" title="In Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Appendix</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#A1.SS1" title="In Appendix A Appendix ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1 </span>Effect of HLP on Left-to-Right Performance</span></a></li>
</ol>
</li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Horizon-Length Prediction: 
<br class="ltx_break"/>Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">
<span class="ltx_tabular ltx_align_middle" id="id6.6.6">
<span class="ltx_tbody">
<span class="ltx_tr" id="id6.6.6.6">
<span class="ltx_td ltx_nopad_r ltx_align_justify ltx_align_top" id="id1.1.1.1.1">
<span class="ltx_inline-block ltx_align_top" id="id1.1.1.1.1.1">
<span class="ltx_p" id="id1.1.1.1.1.1.1" style="width:65.6pt;">Yifeng Ding<sup class="ltx_sup" id="id1.1.1.1.1.1.1.1">1</sup></span>
</span></span>
<span class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_justify ltx_align_top" id="id2.2.2.2.2">
<span class="ltx_inline-block ltx_align_top" id="id2.2.2.2.2.1">
<span class="ltx_p" id="id2.2.2.2.2.1.1" style="width:69.6pt;">Hantian Ding<sup class="ltx_sup" id="id2.2.2.2.2.1.1.1">2</sup></span>
</span></span>
<span class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_justify ltx_align_top" id="id3.3.3.3.3">
<span class="ltx_inline-block ltx_align_top" id="id3.3.3.3.3.1">
<span class="ltx_p" id="id3.3.3.3.3.1.1" style="width:60.8pt;">Shiqi Wang<sup class="ltx_sup" id="id3.3.3.3.3.1.1.1">2</sup></span>
</span></span>
<span class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_justify ltx_align_top" id="id4.4.4.4.4">
<span class="ltx_inline-block ltx_align_top" id="id4.4.4.4.4.1">
<span class="ltx_p" id="id4.4.4.4.4.1.1" style="width:50.1pt;">Qing Sun<sup class="ltx_sup" id="id4.4.4.4.4.1.1.1">2</sup></span>
</span></span>
<span class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_justify ltx_align_top" id="id5.5.5.5.5">
<span class="ltx_inline-block ltx_align_top" id="id5.5.5.5.5.1">
<span class="ltx_p" id="id5.5.5.5.5.1.1" style="width:70.4pt;">Varun Kumar<sup class="ltx_sup" id="id5.5.5.5.5.1.1.1">2</sup></span>
</span></span>
<span class="ltx_td ltx_nopad_l ltx_nopad_r ltx_align_justify ltx_align_top" id="id6.6.6.6.6">
<span class="ltx_inline-block ltx_align_top" id="id6.6.6.6.6.1">
<span class="ltx_p" id="id6.6.6.6.6.1.1" style="width:63.6pt;">Zijian Wang<sup class="ltx_sup" id="id6.6.6.6.6.1.1.1">2</sup></span>
</span></span></span>
</span>
</span>
<br class="ltx_break"/>
<br class="ltx_break"/>
<span class="ltx_tabular ltx_align_middle" id="id8.8.8">
<span class="ltx_tbody">
<span class="ltx_tr" id="id8.8.8.2">
<span class="ltx_td ltx_align_justify ltx_align_top" id="id7.7.7.1.1">
<span class="ltx_inline-block ltx_align_top" id="id7.7.7.1.1.1">
<span class="ltx_p" id="id7.7.7.1.1.1.1" style="width:178.9pt;">University of Illinois Urbana-Champaign<sup class="ltx_sup" id="id7.7.7.1.1.1.1.1">1</sup></span>
</span></span>
<span class="ltx_td ltx_align_justify ltx_align_top" id="id8.8.8.2.2">
<span class="ltx_inline-block ltx_align_top" id="id8.8.8.2.2.1">
<span class="ltx_p" id="id8.8.8.2.2.1.1" style="width:163.0pt;">AWS AI Labs<sup class="ltx_sup" id="id8.8.8.2.2.1.1.1">2</sup></span>
</span></span></span>
</span>
</span>
<br class="ltx_break"/>
<span class="ltx_tabular ltx_align_middle" id="id9.9.id1">
<span class="ltx_tbody">
<span class="ltx_tr" id="id9.9.id1.1.1">
<span class="ltx_td ltx_align_justify ltx_align_top" id="id9.9.id1.1.1.1">
<span class="ltx_inline-block ltx_align_top" id="id9.9.id1.1.1.1.1">
<span class="ltx_p" id="id9.9.id1.1.1.1.1.1" style="width:178.9pt;"><span class="ltx_text ltx_font_typewriter" id="id9.9.id1.1.1.1.1.1.1">yifeng6@illinois.edu</span></span>
</span></span>
<span class="ltx_td ltx_align_justify ltx_align_top" id="id9.9.id1.1.1.2">
<span class="ltx_inline-block ltx_align_top" id="id9.9.id1.1.1.2.1">
<span class="ltx_p" id="id9.9.id1.1.1.2.1.1" style="width:163.0pt;"><span class="ltx_text ltx_font_typewriter" id="id9.9.id1.1.1.2.1.1.1">{dhantian,zijwan}@amazon.com</span></span>
</span></span></span>
</span>
</span>
</span><span class="ltx_author_notes">Work done during a research internship at AWS AI Labs.</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id10.id1">Fill-in-the-Middle (FIM) has become integral to code language models, enabling generation of missing code given both left and right contexts. However, the current FIM training paradigm, which reorders original training sequences and then performs regular next-token prediction (NTP), often leads to models struggling to generate content that aligns smoothly with the surrounding context.
Crucially, while existing works rely on rule-based post-processing to circumvent this weakness, such methods are not practically usable in open-domain code completion tasks as they depend on restrictive, dataset-specific assumptions (<em class="ltx_emph ltx_font_italic" id="id10.id1.1">e.g.,</em> <span class="ltx_text ltx_font_italic" id="id10.id1.2">generating the same number of lines as in the ground truth</span>). Moreover, model performance on FIM tasks deteriorates significantly without these unrealistic assumptions.</p>
<p class="ltx_p" id="id11.id2">We hypothesize that NTP alone is insufficient for models to <span class="ltx_text ltx_font_italic" id="id11.id2.1">learn effective planning</span> conditioned on the distant right context, a critical factor for successful code infilling. To overcome this, we propose <span class="ltx_text ltx_font_bold" id="id11.id2.2">Horizon-Length Prediction</span> (<span class="ltx_text ltx_font_bold" id="id11.id2.3">HLP</span>), a novel training objective that teaches models to predict the number of remaining middle tokens (<em class="ltx_emph ltx_font_italic" id="id11.id2.4">i.e.,</em> horizon length) at each step. HLP advances FIM with lookahead planning, enabling models to inherently learn infilling boundaries for arbitrary left and right contexts without relying on dataset-specific post-processing. Our evaluation across different models and sizes shows that HLP significantly improves FIM performance by up to 24% relatively on diverse benchmarks, across file-level and repository-level, and without resorting to unrealistic post-processing methods. Furthermore, the enhanced planning capability gained through HLP boosts model performance on code reasoning. Importantly, HLP only incurs negligible training overhead and no additional inference cost, ensuring its practicality for real-world scenarios.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para ltx_noindent" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Large Language Models (LLMs) trained on massive source code data have demonstrated significant progress in coding-related tasks <cite class="ltx_cite ltx_citemacro_citep">(Lozhkov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib20" title="">2024</a>; Guo et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib12" title="">2024</a>; DeepSeek-AI et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib5" title="">2024</a>; Hui et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib14" title="">2024</a>)</cite>. While natural language generation predominantly follows a Left-to-Right (L2R) approach, <span class="ltx_text ltx_font_italic" id="S1.p1.1.1">Fill-in-the-Middle</span> (FIM), or <span class="ltx_text ltx_font_italic" id="S1.p1.1.2">infilling</span>, is ubiquitous in code completion scenarios. This prevalence stems from the iterative nature of coding, which involves frequent edits and insertions rather than a single left-to-right pass <cite class="ltx_cite ltx_citemacro_citep">(Bavarian et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib2" title="">2022</a>; Fried et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib8" title="">2023</a>)</cite>.
In an infilling task, the model is asked to generate the missing code in the middle, conditioned on both the preceding (left) and the succeeding (right) contexts.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p2">
<p class="ltx_p" id="S1.p2.12">The common practice to achieve FIM capability with uni-directional auto-regressive models is to reorder the original sequence of <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S1.p2.1.m1.1"><semantics id="S1.p2.1.m1.1a"><mi id="S1.p2.1.m1.1.1" xref="S1.p2.1.m1.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p2.1.m1.1b"><ci id="S1.p2.1.m1.1.1.cmml" xref="S1.p2.1.m1.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.1.m1.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.1.m1.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.p2.2.m2.1"><semantics id="S1.p2.2.m2.1a"><mi id="S1.p2.2.m2.1.1" xref="S1.p2.2.m2.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.p2.2.m2.1b"><ci id="S1.p2.2.m2.1.1.cmml" xref="S1.p2.2.m2.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.2.m2.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.2.m2.1d">sansserif_middle</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.p2.3.m3.1"><semantics id="S1.p2.3.m3.1a"><mi id="S1.p2.3.m3.1.1" xref="S1.p2.3.m3.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p2.3.m3.1b"><ci id="S1.p2.3.m3.1.1.cmml" xref="S1.p2.3.m3.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.3.m3.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.3.m3.1d">sansserif_suffix</annotation></semantics></math> into either <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S1.p2.4.m4.1"><semantics id="S1.p2.4.m4.1a"><mi id="S1.p2.4.m4.1.1" xref="S1.p2.4.m4.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p2.4.m4.1b"><ci id="S1.p2.4.m4.1.1.cmml" xref="S1.p2.4.m4.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.4.m4.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.4.m4.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.p2.5.m5.1"><semantics id="S1.p2.5.m5.1a"><mi id="S1.p2.5.m5.1.1" xref="S1.p2.5.m5.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p2.5.m5.1b"><ci id="S1.p2.5.m5.1.1.cmml" xref="S1.p2.5.m5.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.5.m5.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.5.m5.1d">sansserif_suffix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.p2.6.m6.1"><semantics id="S1.p2.6.m6.1a"><mi id="S1.p2.6.m6.1.1" xref="S1.p2.6.m6.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.p2.6.m6.1b"><ci id="S1.p2.6.m6.1.1.cmml" xref="S1.p2.6.m6.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.6.m6.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.6.m6.1d">sansserif_middle</annotation></semantics></math> (PSM) or <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.p2.7.m7.1"><semantics id="S1.p2.7.m7.1a"><mi id="S1.p2.7.m7.1.1" xref="S1.p2.7.m7.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p2.7.m7.1b"><ci id="S1.p2.7.m7.1.1.cmml" xref="S1.p2.7.m7.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.7.m7.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.7.m7.1d">sansserif_suffix</annotation></semantics></math>-<math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S1.p2.8.m8.1"><semantics id="S1.p2.8.m8.1a"><mi id="S1.p2.8.m8.1.1" xref="S1.p2.8.m8.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p2.8.m8.1b"><ci id="S1.p2.8.m8.1.1.cmml" xref="S1.p2.8.m8.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.8.m8.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.8.m8.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.p2.9.m9.1"><semantics id="S1.p2.9.m9.1a"><mi id="S1.p2.9.m9.1.1" xref="S1.p2.9.m9.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.p2.9.m9.1b"><ci id="S1.p2.9.m9.1.1.cmml" xref="S1.p2.9.m9.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.9.m9.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.9.m9.1d">sansserif_middle</annotation></semantics></math> (SPM). This reordering allows the middle part to be predicted while conditioned on both left and right contexts as past tokens <cite class="ltx_cite ltx_citemacro_citep">(Bavarian et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib2" title="">2022</a>; Fried et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib8" title="">2023</a>)</cite>. Typically. an <span class="ltx_text ltx_font_typewriter" id="S1.p2.12.1">&lt;end_of_insertion&gt;</span> (i.e., <span class="ltx_text ltx_font_typewriter" id="S1.p2.12.2">&lt;eoi&gt;</span>) token is appended to the end to indicate the generation boundary. At training time, the <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S1.p2.10.m10.1"><semantics id="S1.p2.10.m10.1a"><mi id="S1.p2.10.m10.1.1" xref="S1.p2.10.m10.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p2.10.m10.1b"><ci id="S1.p2.10.m10.1.1.cmml" xref="S1.p2.10.m10.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.10.m10.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.10.m10.1d">sansserif_prefix</annotation></semantics></math>, <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.p2.11.m11.1"><semantics id="S1.p2.11.m11.1a"><mi id="S1.p2.11.m11.1.1" xref="S1.p2.11.m11.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.p2.11.m11.1b"><ci id="S1.p2.11.m11.1.1.cmml" xref="S1.p2.11.m11.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.11.m11.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.11.m11.1d">sansserif_middle</annotation></semantics></math>, and <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.p2.12.m12.1"><semantics id="S1.p2.12.m12.1a"><mi id="S1.p2.12.m12.1.1" xref="S1.p2.12.m12.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p2.12.m12.1b"><ci id="S1.p2.12.m12.1.1.cmml" xref="S1.p2.12.m12.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p2.12.m12.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.p2.12.m12.1d">sansserif_suffix</annotation></semantics></math> are determined by a random split, and the reordered sequence is fed to the model for standard next-token prediction (NTP).</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p3">
<p class="ltx_p" id="S1.p3.7">A key challenge in FIM is to seamlessly connect the generated <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.p3.1.m1.1"><semantics id="S1.p3.1.m1.1a"><mi id="S1.p3.1.m1.1.1" xref="S1.p3.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.p3.1.m1.1b"><ci id="S1.p3.1.m1.1.1.cmml" xref="S1.p3.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.1.m1.1d">sansserif_middle</annotation></semantics></math> to the given <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.p3.2.m2.1"><semantics id="S1.p3.2.m2.1a"><mi id="S1.p3.2.m2.1.1" xref="S1.p3.2.m2.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p3.2.m2.1b"><ci id="S1.p3.2.m2.1.1.cmml" xref="S1.p3.2.m2.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.2.m2.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.2.m2.1d">sansserif_suffix</annotation></semantics></math> considering both fluency and semantics, a difficult task for models to learn in practice. As pointed out by the previous work <cite class="ltx_cite ltx_citemacro_citep">(Bavarian et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib2" title="">2022</a>)</cite>, though model is trained to generate <span class="ltx_text ltx_font_typewriter" id="S1.p3.7.1">&lt;eoi&gt;</span> when <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.p3.3.m3.1"><semantics id="S1.p3.3.m3.1a"><mi id="S1.p3.3.m3.1.1" xref="S1.p3.3.m3.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.p3.3.m3.1b"><ci id="S1.p3.3.m3.1.1.cmml" xref="S1.p3.3.m3.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.3.m3.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.3.m3.1d">sansserif_middle</annotation></semantics></math> ends and connects to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.p3.4.m4.1"><semantics id="S1.p3.4.m4.1a"><mi id="S1.p3.4.m4.1.1" xref="S1.p3.4.m4.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p3.4.m4.1b"><ci id="S1.p3.4.m4.1.1.cmml" xref="S1.p3.4.m4.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.4.m4.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.4.m4.1d">sansserif_suffix</annotation></semantics></math>, it often fails to do so at the right place during test time, resulting in generation that does not connect well to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.p3.5.m5.1"><semantics id="S1.p3.5.m5.1a"><mi id="S1.p3.5.m5.1.1" xref="S1.p3.5.m5.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p3.5.m5.1b"><ci id="S1.p3.5.m5.1.1.cmml" xref="S1.p3.5.m5.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.5.m5.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.5.m5.1d">sansserif_suffix</annotation></semantics></math>. We hypothesize that this challenge stems from the fundamental difference in <span class="ltx_text ltx_font_italic" id="S1.p3.7.2">prediction horizon</span> compared to standard NTP. In NTP, the model only needs to consider a horizon of one token at a time. In contrast, FIM requires the model to plan for a much longer horizon, <em class="ltx_emph ltx_font_italic" id="S1.p3.7.3">i.e.,</em> the entire length of the missing <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.p3.6.m6.1"><semantics id="S1.p3.6.m6.1a"><mi id="S1.p3.6.m6.1.1" xref="S1.p3.6.m6.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.p3.6.m6.1b"><ci id="S1.p3.6.m6.1.1.cmml" xref="S1.p3.6.m6.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.6.m6.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.6.m6.1d">sansserif_middle</annotation></semantics></math> section. This extended horizon is crucial because the model must generate a sequence that not only follows the left context but also smoothly transitions to the right context, which may be many tokens away. Standard NTP training does not adequately prepare models for this long-horizon planning task. Consequently, models often struggle to maintain coherence over the longer sequences required in FIM, particularly when approaching the transition to the right context. Without effective long-horizon planning, generation frequently falters towards the end of the infill, failing to create a smooth connection with the given <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.p3.7.m7.1"><semantics id="S1.p3.7.m7.1a"><mi id="S1.p3.7.m7.1.1" xref="S1.p3.7.m7.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.p3.7.m7.1b"><ci id="S1.p3.7.m7.1.1.cmml" xref="S1.p3.7.m7.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p3.7.m7.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.p3.7.m7.1d">sansserif_suffix</annotation></semantics></math>.</p>
</div>
<figure class="ltx_figure ltx_align_floatright" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="701" id="S1.F1.g1" src="x1.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>An example that illustrates how post-processing truncates redundant parts at the end of generation. <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.F1.5.m1.1"><semantics id="S1.F1.5.m1.1b"><mi id="S1.F1.5.m1.1.1" xref="S1.F1.5.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.F1.5.m1.1c"><ci id="S1.F1.5.m1.1.1.cmml" xref="S1.F1.5.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.5.m1.1d">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.5.m1.1e">sansserif_middle</annotation></semantics></math> is generated by the model, which introduces syntax error and breaks correctness if directly connected to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.F1.6.m2.1"><semantics id="S1.F1.6.m2.1b"><mi id="S1.F1.6.m2.1.1" xref="S1.F1.6.m2.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.F1.6.m2.1c"><ci id="S1.F1.6.m2.1.1.cmml" xref="S1.F1.6.m2.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.6.m2.1d">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.6.m2.1e">sansserif_suffix</annotation></semantics></math>. After truncating the part with strike-through through post-processing, <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.F1.7.m3.1"><semantics id="S1.F1.7.m3.1b"><mi id="S1.F1.7.m3.1.1" xref="S1.F1.7.m3.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.F1.7.m3.1c"><ci id="S1.F1.7.m3.1.1.cmml" xref="S1.F1.7.m3.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.7.m3.1d">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.7.m3.1e">sansserif_middle</annotation></semantics></math> successfully connects to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S1.F1.8.m4.1"><semantics id="S1.F1.8.m4.1b"><mi id="S1.F1.8.m4.1.1" xref="S1.F1.8.m4.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S1.F1.8.m4.1c"><ci id="S1.F1.8.m4.1.1.cmml" xref="S1.F1.8.m4.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.8.m4.1d">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.8.m4.1e">sansserif_suffix</annotation></semantics></math> without any errors.
</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">Most existing FIM benchmarks circumvent the above challenge to some extent by devising rule-based post-processing to truncate redundant parts at the end of the generation <cite class="ltx_cite ltx_citemacro_citep">(Gong et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib10" title="">2024</a>; Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib28" title="">2023</a>; Ding et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib7" title="">2023</a>; Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib25" title="">2024</a>)</cite>, as shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">1</span></a>. We argue that these post-processing techniques lack practicality as they rely on restrictive and dataset-specific assumptions, such as the exact number of lines of the expected completion <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib28" title="">2023</a>; Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib25" title="">2024</a>)</cite> or a specific structure to be met <cite class="ltx_cite ltx_citemacro_citep">(Ding et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib7" title="">2023</a>; Gong et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib10" title="">2024</a>)</cite>. Essentially, we need to develop better models that are capable of spontaneously terminating generation at the correct point with respect to arbitrary left and right contexts.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">To this end, we propose <span class="ltx_text ltx_font_bold" id="S1.p5.1.1">Horizon-Length Prediction</span> (<span class="ltx_text ltx_font_bold" id="S1.p5.1.2">HLP</span>) to improve code infilling by teaching models to <span class="ltx_text ltx_font_italic" id="S1.p5.1.3">plan ahead</span> on the number of tokens to be generated (<em class="ltx_emph ltx_font_italic" id="S1.p5.1.4">i.e.,</em> horizon length). Specifically, given the hidden state of the current token, we introduce an auxiliary training objective to predict <span class="ltx_text ltx_font_italic" id="S1.p5.1.5">the number of future tokens</span> required to complete <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.p5.1.m1.1"><semantics id="S1.p5.1.m1.1a"><mi id="S1.p5.1.m1.1.1" xref="S1.p5.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.p5.1.m1.1b"><ci id="S1.p5.1.m1.1.1.cmml" xref="S1.p5.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p5.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.p5.1.m1.1d">sansserif_middle</annotation></semantics></math>, in addition to standard next-token prediction (NTP).
Unlike rule-based post-processing, HLP is generalizable as it does not require any task-specific knowledge.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p6">
<p class="ltx_p" id="S1.p6.1">Through comprehensive evaluation we demonstrate that HLP achieves up to 24% improvements relatively on diverse FIM benchmarks at both file-level and repository-level, with no access to task-specific post-processing. Moreover, with an emphasis on planning, training with HLP also helps achieve superior model performance on code reasoning. Besides, HLP is also extremely efficient as its training overhead is negligible and it doesn’t have any inference cost.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p7">
<p class="ltx_p" id="S1.p7.1">Our key contributions are as follows:</p>
</div>
<div class="ltx_para" id="S1.p8">
<ul class="ltx_itemize" id="S1.I1">
<li class="ltx_item" id="S1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i1.p1">
<p class="ltx_p" id="S1.I1.i1.p1.1">We highlight that post-processing methods adopted by current benchmarks overestimate existing code LLMs’ FIM performance, and empirically quantify the gap. We further draw attention to models’ <span class="ltx_text ltx_font_italic" id="S1.I1.i1.p1.1.1">long-horizon planning</span> capability as the key to successful code infilling.</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S1.I1.i2.p1">
<p class="ltx_p" id="S1.I1.i2.p1.1">We propose <span class="ltx_text ltx_font_bold" id="S1.I1.i2.p1.1.1">Horizon-Length Prediction</span> (<span class="ltx_text ltx_font_bold" id="S1.I1.i2.p1.1.2">HLP</span>), a novel training task that advances fill-in-the-middle capability by teaching LLMs to plan ahead over arbitrarily long horizons. HLP complements the standard next-token prediction by training LLMs to predict the remaining number of future tokens required to complete <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S1.I1.i2.p1.1.m1.1"><semantics id="S1.I1.i2.p1.1.m1.1a"><mi id="S1.I1.i2.p1.1.m1.1.1" xref="S1.I1.i2.p1.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S1.I1.i2.p1.1.m1.1b"><ci id="S1.I1.i2.p1.1.m1.1.1.cmml" xref="S1.I1.i2.p1.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.I1.i2.p1.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S1.I1.i2.p1.1.m1.1d">sansserif_middle</annotation></semantics></math> (i.e., horizon length).</p>
</div>
</li>
<li class="ltx_item" id="S1.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para ltx_noindent" id="S1.I1.i3.p1">
<p class="ltx_p" id="S1.I1.i3.p1.1">Our evaluation shows that HLP not only improves code infilling by up to 24% across various benchmarks without using any rule-based and/or dataset-specific post-processing, but also enhances performance on code reasoning. HLP is also super efficient as it only incurs negligible training overhead while not adding any inference overhead.</p>
</div>
</li>
</ul>
</div>
<figure class="ltx_table" id="S1.T1">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S1.T1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S1.T1.1.1.1">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="S1.T1.1.1.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S1.T1.1.1.1.2">Post-processing Criteria</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S1.T1.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S1.T1.1.2.1.1">RepoEval</th>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="S1.T1.1.2.1.2" rowspan="4"><span class="ltx_text" id="S1.T1.1.2.1.2.1">Truncate generation to <span class="ltx_text ltx_font_bold" id="S1.T1.1.2.1.2.1.1">the same number of lines as in ground truth</span>.</span></td>
</tr>
<tr class="ltx_tr" id="S1.T1.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S1.T1.1.3.2.1"><cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib28" title="">2023</a>)</cite></th>
</tr>
<tr class="ltx_tr" id="S1.T1.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S1.T1.1.4.3.1">CrossCodeLongEval</th>
</tr>
<tr class="ltx_tr" id="S1.T1.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S1.T1.1.5.4.1"><cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib25" title="">2024</a>)</cite></th>
</tr>
<tr class="ltx_tr" id="S1.T1.1.6.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S1.T1.1.6.5.1">CrossCodeEval</th>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_t" id="S1.T1.1.6.5.2" rowspan="2"><span class="ltx_text" id="S1.T1.1.6.5.2.1">Truncate generation <span class="ltx_text ltx_font_bold" id="S1.T1.1.6.5.2.1.1">at the first complete statement</span>.</span></td>
</tr>
<tr class="ltx_tr" id="S1.T1.1.7.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S1.T1.1.7.6.1"><cite class="ltx_cite ltx_citemacro_citep">(Ding et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib7" title="">2023</a>)</cite></th>
</tr>
<tr class="ltx_tr" id="S1.T1.1.8.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S1.T1.1.8.7.1">SAFIM</th>
<td class="ltx_td ltx_nopad_r ltx_align_left ltx_border_bb ltx_border_t" id="S1.T1.1.8.7.2" rowspan="2"><span class="ltx_text" id="S1.T1.1.8.7.2.1">Stop when <span class="ltx_text ltx_font_bold" id="S1.T1.1.8.7.2.1.1">the target program structure in ground truth</span> is generated.</span></td>
</tr>
</tbody>
<tfoot class="ltx_tfoot">
<tr class="ltx_tr" id="S1.T1.1.9.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="S1.T1.1.9.1.1"><cite class="ltx_cite ltx_citemacro_citep">(Gong et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib10" title="">2024</a>)</cite></th>
</tr>
</tfoot>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>
Post-processing criteria used in existing FIM benchmarks. Text in bold denotes restrictive dataset-specific knowledge they employ in evaluation.
</figcaption>
</figure>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Post-processing for Fill-in-the-Middle</h2>
<figure class="ltx_table ltx_align_floatright" id="S2.T2">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S2.T2.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S2.T2.1.2.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S2.T2.1.2.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="4" id="S2.T2.1.2.1.2">SAFIM</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S2.T2.1.2.1.3" rowspan="2"><span class="ltx_text" id="S2.T2.1.2.1.3.1">Avg</span></th>
</tr>
<tr class="ltx_tr" id="S2.T2.1.1">
<th class="ltx_td ltx_th ltx_th_row" id="S2.T2.1.1.2"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S2.T2.1.1.3">Algo</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S2.T2.1.1.1">Algo<math alttext="{}_{\text{v2}}" class="ltx_Math" display="inline" id="S2.T2.1.1.1.m1.1"><semantics id="S2.T2.1.1.1.m1.1a"><msub id="S2.T2.1.1.1.m1.1.1" xref="S2.T2.1.1.1.m1.1.1.cmml"><mi id="S2.T2.1.1.1.m1.1.1a" xref="S2.T2.1.1.1.m1.1.1.cmml"></mi><mtext id="S2.T2.1.1.1.m1.1.1.1" xref="S2.T2.1.1.1.m1.1.1.1a.cmml">v2</mtext></msub><annotation-xml encoding="MathML-Content" id="S2.T2.1.1.1.m1.1b"><apply id="S2.T2.1.1.1.m1.1.1.cmml" xref="S2.T2.1.1.1.m1.1.1"><ci id="S2.T2.1.1.1.m1.1.1.1a.cmml" xref="S2.T2.1.1.1.m1.1.1.1"><mtext id="S2.T2.1.1.1.m1.1.1.1.cmml" mathsize="70%" xref="S2.T2.1.1.1.m1.1.1.1">v2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.T2.1.1.1.m1.1c">{}_{\text{v2}}</annotation><annotation encoding="application/x-llamapun" id="S2.T2.1.1.1.m1.1d">start_FLOATSUBSCRIPT v2 end_FLOATSUBSCRIPT</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S2.T2.1.1.4">Control</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S2.T2.1.1.5">API</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S2.T2.1.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S2.T2.1.3.1.1">DS-1.3B</th>
<td class="ltx_td ltx_border_t" id="S2.T2.1.3.1.2"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.3.1.3"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.3.1.4"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.3.1.5"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.3.1.6"></td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.4.2.1">    w/ post</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.4.2.2">43.9</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.4.2.3">49.2</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.4.2.4">55.6</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.4.2.5">62.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.4.2.6">52.9</td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.5.3.1">    w/o post</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.5.3.2">39.8</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.5.3.3">42.4</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.5.3.4">52.4</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.5.3.5">56.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.5.3.6">47.7</td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.6.4.1">
<span class="ltx_ERROR undefined" id="S2.T2.1.6.4.1.1">\hdashline</span>
  rel. diff</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.6.4.2"><span class="ltx_text ltx_font_bold" id="S2.T2.1.6.4.2.1" style="color:#FF0000;">-9.3%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.6.4.3"><span class="ltx_text ltx_font_bold" id="S2.T2.1.6.4.3.1" style="color:#FF0000;">-13.8%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.6.4.4"><span class="ltx_text ltx_font_bold" id="S2.T2.1.6.4.4.1" style="color:#FF0000;">-5.8%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.6.4.5"><span class="ltx_text ltx_font_bold" id="S2.T2.1.6.4.5.1" style="color:#FF0000;">-10.8%</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.6.4.6"><span class="ltx_text ltx_font_bold" id="S2.T2.1.6.4.6.1" style="color:#FF0000;">-9.9%</span></td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.7.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S2.T2.1.7.5.1">DS-6.7B</th>
<td class="ltx_td ltx_border_t" id="S2.T2.1.7.5.2"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.7.5.3"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.7.5.4"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.7.5.5"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.7.5.6"></td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.8.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.8.6.1">    w/ post</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.8.6.2">54.9</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.8.6.3">58.9</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.8.6.4">68.1</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.8.6.5">71.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.8.6.6">63.2</td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.9.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.9.7.1">    w/o post</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.9.7.2">53.4</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.9.7.3">56.7</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.9.7.4">66.6</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.9.7.5">69.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.9.7.6">61.4</td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.10.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.10.8.1">
<span class="ltx_ERROR undefined" id="S2.T2.1.10.8.1.1">\hdashline</span>
  rel. diff</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.10.8.2"><span class="ltx_text ltx_font_bold" id="S2.T2.1.10.8.2.1" style="color:#FF0000;">-2.7%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.10.8.3"><span class="ltx_text ltx_font_bold" id="S2.T2.1.10.8.3.1" style="color:#FF0000;">-3.7%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.10.8.4"><span class="ltx_text ltx_font_bold" id="S2.T2.1.10.8.4.1" style="color:#FF0000;">-2.2%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.10.8.5"><span class="ltx_text ltx_font_bold" id="S2.T2.1.10.8.5.1" style="color:#FF0000;">-2.8%</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.10.8.6"><span class="ltx_text ltx_font_bold" id="S2.T2.1.10.8.6.1" style="color:#FF0000;">-2.8%</span></td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.11.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S2.T2.1.11.9.1">SC2-3B</th>
<td class="ltx_td ltx_border_t" id="S2.T2.1.11.9.2"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.11.9.3"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.11.9.4"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.11.9.5"></td>
<td class="ltx_td ltx_nopad_r ltx_border_t" id="S2.T2.1.11.9.6"></td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.12.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.12.10.1">    w/ post</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.12.10.2">48.1</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.12.10.3">53.5</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.12.10.4">60.1</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.12.10.5">68.4</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.12.10.6">57.5</td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.13.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.13.11.1">    w/o post</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.13.11.2">45.4</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.13.11.3">49.7</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.13.11.4">57.1</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.13.11.5">61.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.13.11.6">53.4</td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.14.12">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.14.12.1">
<span class="ltx_ERROR undefined" id="S2.T2.1.14.12.1.1">\hdashline</span>
  rel. diff</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.14.12.2"><span class="ltx_text ltx_font_bold" id="S2.T2.1.14.12.2.1" style="color:#FF0000;">-5.6%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.14.12.3"><span class="ltx_text ltx_font_bold" id="S2.T2.1.14.12.3.1" style="color:#FF0000;">-7.1%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.14.12.4"><span class="ltx_text ltx_font_bold" id="S2.T2.1.14.12.4.1" style="color:#FF0000;">-5.0%</span></td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.14.12.5"><span class="ltx_text ltx_font_bold" id="S2.T2.1.14.12.5.1" style="color:#FF0000;">-10.4%</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.14.12.6"><span class="ltx_text ltx_font_bold" id="S2.T2.1.14.12.6.1" style="color:#FF0000;">-7.2%</span></td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.15.13">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S2.T2.1.15.13.1">SC2-7B</th>
<td class="ltx_td ltx_border_t" id="S2.T2.1.15.13.2"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.15.13.3"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.15.13.4"></td>
<td class="ltx_td ltx_border_t" id="S2.T2.1.15.13.5"></td>
<td class="ltx_td ltx_nopad_r ltx_border_t" id="S2.T2.1.15.13.6"></td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.16.14">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.16.14.1">    w/ post</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.16.14.2">50.4</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.16.14.3">55.8</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.16.14.4">62.3</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.16.14.5">70.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.16.14.6">59.7</td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.17.15">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S2.T2.1.17.15.1">    w/o post</th>
<td class="ltx_td ltx_align_center" id="S2.T2.1.17.15.2">48.4</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.17.15.3">53.1</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.17.15.4">60.4</td>
<td class="ltx_td ltx_align_center" id="S2.T2.1.17.15.5">63.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S2.T2.1.17.15.6">56.5</td>
</tr>
<tr class="ltx_tr" id="S2.T2.1.18.16">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S2.T2.1.18.16.1">
<span class="ltx_ERROR undefined" id="S2.T2.1.18.16.1.1">\hdashline</span>
  rel. diff</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T2.1.18.16.2"><span class="ltx_text ltx_font_bold" id="S2.T2.1.18.16.2.1" style="color:#FF0000;">-4.0%</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T2.1.18.16.3"><span class="ltx_text ltx_font_bold" id="S2.T2.1.18.16.3.1" style="color:#FF0000;">-4.8%</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T2.1.18.16.4"><span class="ltx_text ltx_font_bold" id="S2.T2.1.18.16.4.1" style="color:#FF0000;">-3.0%</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S2.T2.1.18.16.5"><span class="ltx_text ltx_font_bold" id="S2.T2.1.18.16.5.1" style="color:#FF0000;">-9.1%</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S2.T2.1.18.16.6"><span class="ltx_text ltx_font_bold" id="S2.T2.1.18.16.6.1" style="color:#FF0000;">-5.4%</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 2: </span>
Effect of post-processing techniques for different code LLMs on SAFIM, where "<span class="ltx_text ltx_font_bold" id="S2.T2.5.1">w/ post</span>" refers to using post-processing, "<span class="ltx_text ltx_font_bold" id="S2.T2.6.2">w/o post</span>" refers to not using post-processing, and "<span class="ltx_text ltx_font_bold" id="S2.T2.7.3">rel. diff</span>" refers to the relative performance difference between the two. We follow the same settings used in §<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.SS1" title="4.1 Syntax-Aware and Multilingual Code Fill-in-the-Middle ‣ 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">4.1</span></a>.
</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S2.p1">
<p class="ltx_p" id="S2.p1.2">Most existing FIM works rely on post-processing to truncate code completions generated by LLMs for infilling tasks <cite class="ltx_cite ltx_citemacro_citep">(Gong et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib10" title="">2024</a>; Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib28" title="">2023</a>; Ding et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib7" title="">2023</a>; Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib25" title="">2024</a>)</cite>. While such post-processing can enhance the FIM performance, we argue that they are are designed based on dataset-specific prior knowledge, and thus fundamentally limited and impractical for real-world scenarios (§<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2.SS1" title="2.1 Post-processing Requires Task-specific Knowledge ‣ 2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">2.1</span></a>). Through evaluation, we show that FIM performance of existing code models drops significantly without post-processing, suggesting that post-processing conceals models’ inability to determine the end of insertion (§<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2.SS2" title="2.2 Post-processing Conceals LLMs’ Inability of Connecting to Suffix ‣ 2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">2.2</span></a>). Furthermore, we show that plausible generation of <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S2.p1.1.m1.1"><semantics id="S2.p1.1.m1.1a"><mi id="S2.p1.1.m1.1.1" xref="S2.p1.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S2.p1.1.m1.1b"><ci id="S2.p1.1.m1.1.1.cmml" xref="S2.p1.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S2.p1.1.m1.1d">sansserif_middle</annotation></semantics></math> without careful planning can easily lead to the failure in connecting to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S2.p1.2.m2.1"><semantics id="S2.p1.2.m2.1a"><mi id="S2.p1.2.m2.1.1" xref="S2.p1.2.m2.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.p1.2.m2.1b"><ci id="S2.p1.2.m2.1.1.cmml" xref="S2.p1.2.m2.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.2.m2.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S2.p1.2.m2.1d">sansserif_suffix</annotation></semantics></math> at the end, which can not be mitigated even with post-processing (§<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2.SS3" title="2.3 Fill-in-the-Middle Requires Planning Capability of LLMs ‣ 2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">2.3</span></a>). We believe that post-processing leads to an overestimation of infilling capability of existing code LLMs and more generalizable techniques are in need to advance LLMs’ FIM performance.</p>
</div>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>Post-processing Requires Task-specific Knowledge</h3>
<div class="ltx_para ltx_noindent" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1">Post-processing methods adopted by recent FIM benchmarks typically assume a certain completion type and perform rule-based truncation accordingly. Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S1.T1" title="Table 1 ‣ 1 Introduction ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">1</span></a> summarizes the post-processing criteria of four popular FIM benchmarks, highlighting the specific rule used for each dataset. These criteria do not transfer across datasets, nor are they generalizable to FIM in the real-world scenario where both left and right contexts can be arbitrary. Given the complexity of programming languages, it is infeasible to devise any rule-based post-processing for general code infilling in open-domain scenarios. A more practical and effective solution is to let the model itself decide when to stop by learning from the massive data.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Post-processing Conceals LLMs’ Inability of Connecting to Suffix</h3>
<div class="ltx_para ltx_noindent" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.2">To further demonstrate to what extent post-processing conceals LLMs’ inability of connecting to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S2.SS2.p1.1.m1.1"><semantics id="S2.SS2.p1.1.m1.1a"><mi id="S2.SS2.p1.1.m1.1.1" xref="S2.SS2.p1.1.m1.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.1.m1.1b"><ci id="S2.SS2.p1.1.m1.1.1.cmml" xref="S2.SS2.p1.1.m1.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.1.m1.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.1.m1.1d">sansserif_suffix</annotation></semantics></math>, we conduct a comprehensive experiment on SAFIM. We compare FIM performance of four different code LLMs, with or without post-processing. As shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2.T2" title="Table 2 ‣ 2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">2</span></a>, after removing post-processing, we see <span class="ltx_text" id="S2.SS2.p1.2.1">pass@1</span> drops by up to 13.8% across all models, revealing that post-processing seriously obfuscates LLMs’ inherent inability to connect seamlessly to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S2.SS2.p1.2.m2.1"><semantics id="S2.SS2.p1.2.m2.1a"><mi id="S2.SS2.p1.2.m2.1.1" xref="S2.SS2.p1.2.m2.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.2.m2.1b"><ci id="S2.SS2.p1.2.m2.1.1.cmml" xref="S2.SS2.p1.2.m2.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.2.m2.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.2.m2.1d">sansserif_suffix</annotation></semantics></math> during infilling.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.3 </span>Fill-in-the-Middle Requires Planning Capability of LLMs</h3>
<div class="ltx_para ltx_noindent" id="S2.SS3.p1">
<p class="ltx_p" id="S2.SS3.p1.5">We argue that FIM requires planning from LLMs for deeper reasons beyond simply predicting the <span class="ltx_text ltx_font_typewriter" id="S2.SS3.p1.5.1">&lt;eoi&gt;</span> token. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2.F2" title="Figure 2 ‣ 2.3 Fill-in-the-Middle Requires Planning Capability of LLMs ‣ 2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">2</span></a> provides an illustrative example that highlights the importance of planning ahead in FIM tasks. In this example, compared with the ground truth (<em class="ltx_emph ltx_font_italic" id="S2.SS3.p1.5.2">i.e.,</em> <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S2.SS3.p1.1.m1.1"><semantics id="S2.SS3.p1.1.m1.1a"><mi id="S2.SS3.p1.1.m1.1.1" xref="S2.SS3.p1.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p1.1.m1.1b"><ci id="S2.SS3.p1.1.m1.1.1.cmml" xref="S2.SS3.p1.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p1.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p1.1.m1.1d">sansserif_middle</annotation></semantics></math> in <span class="ltx_text ltx_font_bold" id="S2.SS3.p1.5.3">Reference</span>), the model generation (<em class="ltx_emph ltx_font_italic" id="S2.SS3.p1.5.4">i.e.,</em> <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S2.SS3.p1.2.m2.1"><semantics id="S2.SS3.p1.2.m2.1a"><mi id="S2.SS3.p1.2.m2.1.1" xref="S2.SS3.p1.2.m2.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p1.2.m2.1b"><ci id="S2.SS3.p1.2.m2.1.1.cmml" xref="S2.SS3.p1.2.m2.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p1.2.m2.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p1.2.m2.1d">sansserif_middle</annotation></semantics></math> in <span class="ltx_text ltx_font_bold" id="S2.SS3.p1.5.5">Answer</span>) does not correctly connect to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S2.SS3.p1.3.m3.1"><semantics id="S2.SS3.p1.3.m3.1a"><mi id="S2.SS3.p1.3.m3.1.1" xref="S2.SS3.p1.3.m3.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p1.3.m3.1b"><ci id="S2.SS3.p1.3.m3.1.1.cmml" xref="S2.SS3.p1.3.m3.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p1.3.m3.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p1.3.m3.1d">sansserif_suffix</annotation></semantics></math>. To elaborate, since the beginning of <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S2.SS3.p1.4.m4.1"><semantics id="S2.SS3.p1.4.m4.1a"><mi id="S2.SS3.p1.4.m4.1.1" xref="S2.SS3.p1.4.m4.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p1.4.m4.1b"><ci id="S2.SS3.p1.4.m4.1.1.cmml" xref="S2.SS3.p1.4.m4.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p1.4.m4.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p1.4.m4.1d">sansserif_suffix</annotation></semantics></math> is a function call (<span class="ltx_text ltx_font_typewriter" id="S2.SS3.p1.5.6">Recognizer()</span>) that can only be accessed through a specific object (<span class="ltx_text ltx_font_typewriter" id="S2.SS3.p1.5.7">speech</span>), the model has to end the generation with <span class="ltx_text ltx_font_typewriter" id="S2.SS3.p1.5.8">speech.</span> to properly connect to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S2.SS3.p1.5.m5.1"><semantics id="S2.SS3.p1.5.m5.1a"><mi id="S2.SS3.p1.5.m5.1.1" xref="S2.SS3.p1.5.m5.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p1.5.m5.1b"><ci id="S2.SS3.p1.5.m5.1.1.cmml" xref="S2.SS3.p1.5.m5.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p1.5.m5.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p1.5.m5.1d">sansserif_suffix</annotation></semantics></math>, but it fails to do so in <span class="ltx_text ltx_font_bold" id="S2.SS3.p1.5.9">Answer</span>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS3.p2">
<p class="ltx_p" id="S2.SS3.p2.1">Interestingly, the model has demonstrated its knowledge of how to call the function by generating <span class="ltx_text ltx_font_typewriter" id="S2.SS3.p2.1.1">speech.Recognizer()</span> in <span class="ltx_text ltx_font_bold" id="S2.SS3.p2.1.2">Answer</span>. However, without careful planning, it prematurely writes this call before other necessary code (the assignment statement of <span class="ltx_text ltx_font_typewriter" id="S2.SS3.p2.1.3">self.voice</span>). This example illustrates that the real challenge lies in planning the entire generation, rather than understanding individual components. Furthermore, this case demonstrates that post-processing, despite taking advantage of task-specific prior knowledge, cannot adequately address such planning failures. Truncating the code after <span class="ltx_text ltx_font_typewriter" id="S2.SS3.p2.1.4">speech.</span> in <span class="ltx_text ltx_font_bold" id="S2.SS3.p2.1.5">Answer</span> would result in loss of other necessary code for correctness. This observation underscores the irreplaceable importance of planning ahead in code infilling.</p>
</div>
<figure class="ltx_figure" id="S2.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="96" id="S2.F2.g1" src="x2.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span>An example showing that FIM requires planning capabilities. <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S2.F2.6.m1.1"><semantics id="S2.F2.6.m1.1b"><mi id="S2.F2.6.m1.1.1" xref="S2.F2.6.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S2.F2.6.m1.1c"><ci id="S2.F2.6.m1.1.1.cmml" xref="S2.F2.6.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.6.m1.1d">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.6.m1.1e">sansserif_middle</annotation></semantics></math> in <span class="ltx_text ltx_font_bold" id="S2.F2.13.1">Reference</span> refers to the ground truth and <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S2.F2.7.m2.1"><semantics id="S2.F2.7.m2.1b"><mi id="S2.F2.7.m2.1.1" xref="S2.F2.7.m2.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S2.F2.7.m2.1c"><ci id="S2.F2.7.m2.1.1.cmml" xref="S2.F2.7.m2.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.7.m2.1d">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.7.m2.1e">sansserif_middle</annotation></semantics></math> in <span class="ltx_text ltx_font_bold" id="S2.F2.14.2">Answer</span> refers to the code generated by LLMs, given <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S2.F2.8.m3.1"><semantics id="S2.F2.8.m3.1b"><mi id="S2.F2.8.m3.1.1" xref="S2.F2.8.m3.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.F2.8.m3.1c"><ci id="S2.F2.8.m3.1.1.cmml" xref="S2.F2.8.m3.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.8.m3.1d">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.8.m3.1e">sansserif_prefix</annotation></semantics></math> and <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S2.F2.9.m4.1"><semantics id="S2.F2.9.m4.1b"><mi id="S2.F2.9.m4.1.1" xref="S2.F2.9.m4.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.F2.9.m4.1c"><ci id="S2.F2.9.m4.1.1.cmml" xref="S2.F2.9.m4.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.9.m4.1d">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.9.m4.1e">sansserif_suffix</annotation></semantics></math>. Compared with the ground truth, LLM fails to connect to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S2.F2.10.m5.1"><semantics id="S2.F2.10.m5.1b"><mi id="S2.F2.10.m5.1.1" xref="S2.F2.10.m5.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S2.F2.10.m5.1c"><ci id="S2.F2.10.m5.1.1.cmml" xref="S2.F2.10.m5.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.10.m5.1d">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.10.m5.1e">sansserif_suffix</annotation></semantics></math> due to lack of planning capability.
</figcaption>
</figure>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Horizon-Length Prediction</h2>
<div class="ltx_para ltx_noindent" id="S3.p1">
<p class="ltx_p" id="S3.p1.12">Given a document <math alttext="D=\{x_{t}\}_{t=1}^{T}" class="ltx_Math" display="inline" id="S3.p1.1.m1.1"><semantics id="S3.p1.1.m1.1a"><mrow id="S3.p1.1.m1.1.1" xref="S3.p1.1.m1.1.1.cmml"><mi id="S3.p1.1.m1.1.1.3" xref="S3.p1.1.m1.1.1.3.cmml">D</mi><mo id="S3.p1.1.m1.1.1.2" xref="S3.p1.1.m1.1.1.2.cmml">=</mo><msubsup id="S3.p1.1.m1.1.1.1" xref="S3.p1.1.m1.1.1.1.cmml"><mrow id="S3.p1.1.m1.1.1.1.1.1.1" xref="S3.p1.1.m1.1.1.1.1.1.2.cmml"><mo id="S3.p1.1.m1.1.1.1.1.1.1.2" stretchy="false" xref="S3.p1.1.m1.1.1.1.1.1.2.cmml">{</mo><msub id="S3.p1.1.m1.1.1.1.1.1.1.1" xref="S3.p1.1.m1.1.1.1.1.1.1.1.cmml"><mi id="S3.p1.1.m1.1.1.1.1.1.1.1.2" xref="S3.p1.1.m1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.p1.1.m1.1.1.1.1.1.1.1.3" xref="S3.p1.1.m1.1.1.1.1.1.1.1.3.cmml">t</mi></msub><mo id="S3.p1.1.m1.1.1.1.1.1.1.3" stretchy="false" xref="S3.p1.1.m1.1.1.1.1.1.2.cmml">}</mo></mrow><mrow id="S3.p1.1.m1.1.1.1.1.3" xref="S3.p1.1.m1.1.1.1.1.3.cmml"><mi id="S3.p1.1.m1.1.1.1.1.3.2" xref="S3.p1.1.m1.1.1.1.1.3.2.cmml">t</mi><mo id="S3.p1.1.m1.1.1.1.1.3.1" xref="S3.p1.1.m1.1.1.1.1.3.1.cmml">=</mo><mn id="S3.p1.1.m1.1.1.1.1.3.3" xref="S3.p1.1.m1.1.1.1.1.3.3.cmml">1</mn></mrow><mi id="S3.p1.1.m1.1.1.1.3" xref="S3.p1.1.m1.1.1.1.3.cmml">T</mi></msubsup></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.1.m1.1b"><apply id="S3.p1.1.m1.1.1.cmml" xref="S3.p1.1.m1.1.1"><eq id="S3.p1.1.m1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.2"></eq><ci id="S3.p1.1.m1.1.1.3.cmml" xref="S3.p1.1.m1.1.1.3">𝐷</ci><apply id="S3.p1.1.m1.1.1.1.cmml" xref="S3.p1.1.m1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.1.m1.1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.1">superscript</csymbol><apply id="S3.p1.1.m1.1.1.1.1.cmml" xref="S3.p1.1.m1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.1.m1.1.1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.1">subscript</csymbol><set id="S3.p1.1.m1.1.1.1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.1.1.1.1"><apply id="S3.p1.1.m1.1.1.1.1.1.1.1.cmml" xref="S3.p1.1.m1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.1.m1.1.1.1.1.1.1.1.1.cmml" xref="S3.p1.1.m1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.p1.1.m1.1.1.1.1.1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.p1.1.m1.1.1.1.1.1.1.1.3.cmml" xref="S3.p1.1.m1.1.1.1.1.1.1.1.3">𝑡</ci></apply></set><apply id="S3.p1.1.m1.1.1.1.1.3.cmml" xref="S3.p1.1.m1.1.1.1.1.3"><eq id="S3.p1.1.m1.1.1.1.1.3.1.cmml" xref="S3.p1.1.m1.1.1.1.1.3.1"></eq><ci id="S3.p1.1.m1.1.1.1.1.3.2.cmml" xref="S3.p1.1.m1.1.1.1.1.3.2">𝑡</ci><cn id="S3.p1.1.m1.1.1.1.1.3.3.cmml" type="integer" xref="S3.p1.1.m1.1.1.1.1.3.3">1</cn></apply></apply><ci id="S3.p1.1.m1.1.1.1.3.cmml" xref="S3.p1.1.m1.1.1.1.3">𝑇</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.1.m1.1c">D=\{x_{t}\}_{t=1}^{T}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.1.m1.1d">italic_D = { italic_x start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT } start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T end_POSTSUPERSCRIPT</annotation></semantics></math> that contains <math alttext="T" class="ltx_Math" display="inline" id="S3.p1.2.m2.1"><semantics id="S3.p1.2.m2.1a"><mi id="S3.p1.2.m2.1.1" xref="S3.p1.2.m2.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="S3.p1.2.m2.1b"><ci id="S3.p1.2.m2.1.1.cmml" xref="S3.p1.2.m2.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.2.m2.1c">T</annotation><annotation encoding="application/x-llamapun" id="S3.p1.2.m2.1d">italic_T</annotation></semantics></math> tokens <math alttext="x_{1},\ x_{2},\cdots,\ x_{T}" class="ltx_Math" display="inline" id="S3.p1.3.m3.4"><semantics id="S3.p1.3.m3.4a"><mrow id="S3.p1.3.m3.4.4.3" xref="S3.p1.3.m3.4.4.4.cmml"><msub id="S3.p1.3.m3.2.2.1.1" xref="S3.p1.3.m3.2.2.1.1.cmml"><mi id="S3.p1.3.m3.2.2.1.1.2" xref="S3.p1.3.m3.2.2.1.1.2.cmml">x</mi><mn id="S3.p1.3.m3.2.2.1.1.3" xref="S3.p1.3.m3.2.2.1.1.3.cmml">1</mn></msub><mo id="S3.p1.3.m3.4.4.3.4" rspace="0.667em" xref="S3.p1.3.m3.4.4.4.cmml">,</mo><msub id="S3.p1.3.m3.3.3.2.2" xref="S3.p1.3.m3.3.3.2.2.cmml"><mi id="S3.p1.3.m3.3.3.2.2.2" xref="S3.p1.3.m3.3.3.2.2.2.cmml">x</mi><mn id="S3.p1.3.m3.3.3.2.2.3" xref="S3.p1.3.m3.3.3.2.2.3.cmml">2</mn></msub><mo id="S3.p1.3.m3.4.4.3.5" xref="S3.p1.3.m3.4.4.4.cmml">,</mo><mi id="S3.p1.3.m3.1.1" mathvariant="normal" xref="S3.p1.3.m3.1.1.cmml">⋯</mi><mo id="S3.p1.3.m3.4.4.3.6" rspace="0.667em" xref="S3.p1.3.m3.4.4.4.cmml">,</mo><msub id="S3.p1.3.m3.4.4.3.3" xref="S3.p1.3.m3.4.4.3.3.cmml"><mi id="S3.p1.3.m3.4.4.3.3.2" xref="S3.p1.3.m3.4.4.3.3.2.cmml">x</mi><mi id="S3.p1.3.m3.4.4.3.3.3" xref="S3.p1.3.m3.4.4.3.3.3.cmml">T</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.3.m3.4b"><list id="S3.p1.3.m3.4.4.4.cmml" xref="S3.p1.3.m3.4.4.3"><apply id="S3.p1.3.m3.2.2.1.1.cmml" xref="S3.p1.3.m3.2.2.1.1"><csymbol cd="ambiguous" id="S3.p1.3.m3.2.2.1.1.1.cmml" xref="S3.p1.3.m3.2.2.1.1">subscript</csymbol><ci id="S3.p1.3.m3.2.2.1.1.2.cmml" xref="S3.p1.3.m3.2.2.1.1.2">𝑥</ci><cn id="S3.p1.3.m3.2.2.1.1.3.cmml" type="integer" xref="S3.p1.3.m3.2.2.1.1.3">1</cn></apply><apply id="S3.p1.3.m3.3.3.2.2.cmml" xref="S3.p1.3.m3.3.3.2.2"><csymbol cd="ambiguous" id="S3.p1.3.m3.3.3.2.2.1.cmml" xref="S3.p1.3.m3.3.3.2.2">subscript</csymbol><ci id="S3.p1.3.m3.3.3.2.2.2.cmml" xref="S3.p1.3.m3.3.3.2.2.2">𝑥</ci><cn id="S3.p1.3.m3.3.3.2.2.3.cmml" type="integer" xref="S3.p1.3.m3.3.3.2.2.3">2</cn></apply><ci id="S3.p1.3.m3.1.1.cmml" xref="S3.p1.3.m3.1.1">⋯</ci><apply id="S3.p1.3.m3.4.4.3.3.cmml" xref="S3.p1.3.m3.4.4.3.3"><csymbol cd="ambiguous" id="S3.p1.3.m3.4.4.3.3.1.cmml" xref="S3.p1.3.m3.4.4.3.3">subscript</csymbol><ci id="S3.p1.3.m3.4.4.3.3.2.cmml" xref="S3.p1.3.m3.4.4.3.3.2">𝑥</ci><ci id="S3.p1.3.m3.4.4.3.3.3.cmml" xref="S3.p1.3.m3.4.4.3.3.3">𝑇</ci></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.3.m3.4c">x_{1},\ x_{2},\cdots,\ x_{T}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.3.m3.4d">italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , italic_x start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT , ⋯ , italic_x start_POSTSUBSCRIPT italic_T end_POSTSUBSCRIPT</annotation></semantics></math>, existing FIM training scheme can be divided into three steps: (1) Split the document <math alttext="D" class="ltx_Math" display="inline" id="S3.p1.4.m4.1"><semantics id="S3.p1.4.m4.1a"><mi id="S3.p1.4.m4.1.1" xref="S3.p1.4.m4.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.p1.4.m4.1b"><ci id="S3.p1.4.m4.1.1.cmml" xref="S3.p1.4.m4.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.4.m4.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.p1.4.m4.1d">italic_D</annotation></semantics></math> into three parts: <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S3.p1.5.m5.1"><semantics id="S3.p1.5.m5.1a"><mi id="S3.p1.5.m5.1.1" xref="S3.p1.5.m5.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p1.5.m5.1b"><ci id="S3.p1.5.m5.1.1.cmml" xref="S3.p1.5.m5.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.5.m5.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.5.m5.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.p1.6.m6.1"><semantics id="S3.p1.6.m6.1a"><mi id="S3.p1.6.m6.1.1" xref="S3.p1.6.m6.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.p1.6.m6.1b"><ci id="S3.p1.6.m6.1.1.cmml" xref="S3.p1.6.m6.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.6.m6.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.6.m6.1d">sansserif_middle</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S3.p1.7.m7.1"><semantics id="S3.p1.7.m7.1a"><mi id="S3.p1.7.m7.1.1" xref="S3.p1.7.m7.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p1.7.m7.1b"><ci id="S3.p1.7.m7.1.1.cmml" xref="S3.p1.7.m7.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.7.m7.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.7.m7.1d">sansserif_suffix</annotation></semantics></math> <span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>We opt to use PSM setting in this work given our base models (DeepSeek-Coder <cite class="ltx_cite ltx_citemacro_citep">(Guo et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib12" title="">2024</a>)</cite> and StarCoder2 <cite class="ltx_cite ltx_citemacro_citep">(Lozhkov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib20" title="">2024</a>)</cite>) were both pre-trained with PSM setting. However, we expect that our method is generalizable to SPM setting as well.</span></span></span>, (2) Construct a new FIM-style document <math alttext="D^{\prime}" class="ltx_Math" display="inline" id="S3.p1.8.m8.1"><semantics id="S3.p1.8.m8.1a"><msup id="S3.p1.8.m8.1.1" xref="S3.p1.8.m8.1.1.cmml"><mi id="S3.p1.8.m8.1.1.2" xref="S3.p1.8.m8.1.1.2.cmml">D</mi><mo id="S3.p1.8.m8.1.1.3" xref="S3.p1.8.m8.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.p1.8.m8.1b"><apply id="S3.p1.8.m8.1.1.cmml" xref="S3.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S3.p1.8.m8.1.1.1.cmml" xref="S3.p1.8.m8.1.1">superscript</csymbol><ci id="S3.p1.8.m8.1.1.2.cmml" xref="S3.p1.8.m8.1.1.2">𝐷</ci><ci id="S3.p1.8.m8.1.1.3.cmml" xref="S3.p1.8.m8.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.8.m8.1c">D^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.8.m8.1d">italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> by reordering the three parts as <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S3.p1.9.m9.1"><semantics id="S3.p1.9.m9.1a"><mi id="S3.p1.9.m9.1.1" xref="S3.p1.9.m9.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p1.9.m9.1b"><ci id="S3.p1.9.m9.1.1.cmml" xref="S3.p1.9.m9.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.9.m9.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.9.m9.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S3.p1.10.m10.1"><semantics id="S3.p1.10.m10.1a"><mi id="S3.p1.10.m10.1.1" xref="S3.p1.10.m10.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p1.10.m10.1b"><ci id="S3.p1.10.m10.1.1.cmml" xref="S3.p1.10.m10.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.10.m10.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.10.m10.1d">sansserif_suffix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.p1.11.m11.1"><semantics id="S3.p1.11.m11.1a"><mi id="S3.p1.11.m11.1.1" xref="S3.p1.11.m11.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.p1.11.m11.1b"><ci id="S3.p1.11.m11.1.1.cmml" xref="S3.p1.11.m11.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.11.m11.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.11.m11.1d">sansserif_middle</annotation></semantics></math>, and (3) Conduct next-token prediction (NTP) training on the document <math alttext="D^{\prime}" class="ltx_Math" display="inline" id="S3.p1.12.m12.1"><semantics id="S3.p1.12.m12.1a"><msup id="S3.p1.12.m12.1.1" xref="S3.p1.12.m12.1.1.cmml"><mi id="S3.p1.12.m12.1.1.2" xref="S3.p1.12.m12.1.1.2.cmml">D</mi><mo id="S3.p1.12.m12.1.1.3" xref="S3.p1.12.m12.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.p1.12.m12.1b"><apply id="S3.p1.12.m12.1.1.cmml" xref="S3.p1.12.m12.1.1"><csymbol cd="ambiguous" id="S3.p1.12.m12.1.1.1.cmml" xref="S3.p1.12.m12.1.1">superscript</csymbol><ci id="S3.p1.12.m12.1.1.2.cmml" xref="S3.p1.12.m12.1.1.2">𝐷</ci><ci id="S3.p1.12.m12.1.1.3.cmml" xref="S3.p1.12.m12.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.12.m12.1c">D^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.12.m12.1d">italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.p2">
<p class="ltx_p" id="S3.p2.5">Specifically, we define the three parts in document <math alttext="D" class="ltx_Math" display="inline" id="S3.p2.1.m1.1"><semantics id="S3.p2.1.m1.1a"><mi id="S3.p2.1.m1.1.1" xref="S3.p2.1.m1.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.p2.1.m1.1b"><ci id="S3.p2.1.m1.1.1.cmml" xref="S3.p2.1.m1.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.1.m1.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.p2.1.m1.1d">italic_D</annotation></semantics></math> as <math alttext="\text{$\mathsf{prefix}$}=x_{1\cdots P}" class="ltx_Math" display="inline" id="S3.p2.2.m2.1"><semantics id="S3.p2.2.m2.1a"><mrow id="S3.p2.2.m2.1.2" xref="S3.p2.2.m2.1.2.cmml"><mi id="S3.p2.2.m2.1.2.2" xref="S3.p2.2.m2.1.2.2.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><mo id="S3.p2.2.m2.1.2.1" xref="S3.p2.2.m2.1.2.1.cmml">=</mo><msub id="S3.p2.2.m2.1.2.3" xref="S3.p2.2.m2.1.2.3.cmml"><mi id="S3.p2.2.m2.1.2.3.2" xref="S3.p2.2.m2.1.2.3.2.cmml">x</mi><mrow id="S3.p2.2.m2.1.2.3.3" xref="S3.p2.2.m2.1.2.3.3.cmml"><mn id="S3.p2.2.m2.1.2.3.3.2" xref="S3.p2.2.m2.1.2.3.3.2.cmml">1</mn><mo id="S3.p2.2.m2.1.2.3.3.1" xref="S3.p2.2.m2.1.2.3.3.1.cmml">⁢</mo><mi id="S3.p2.2.m2.1.2.3.3.3" mathvariant="normal" xref="S3.p2.2.m2.1.2.3.3.3.cmml">⋯</mi><mo id="S3.p2.2.m2.1.2.3.3.1a" xref="S3.p2.2.m2.1.2.3.3.1.cmml">⁢</mo><mi id="S3.p2.2.m2.1.2.3.3.4" xref="S3.p2.2.m2.1.2.3.3.4.cmml">P</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.2.m2.1b"><apply id="S3.p2.2.m2.1.2.cmml" xref="S3.p2.2.m2.1.2"><eq id="S3.p2.2.m2.1.2.1.cmml" xref="S3.p2.2.m2.1.2.1"></eq><ci id="S3.p2.2.m2.1.2.2.cmml" xref="S3.p2.2.m2.1.2.2">𝗉𝗋𝖾𝖿𝗂𝗑</ci><apply id="S3.p2.2.m2.1.2.3.cmml" xref="S3.p2.2.m2.1.2.3"><csymbol cd="ambiguous" id="S3.p2.2.m2.1.2.3.1.cmml" xref="S3.p2.2.m2.1.2.3">subscript</csymbol><ci id="S3.p2.2.m2.1.2.3.2.cmml" xref="S3.p2.2.m2.1.2.3.2">𝑥</ci><apply id="S3.p2.2.m2.1.2.3.3.cmml" xref="S3.p2.2.m2.1.2.3.3"><times id="S3.p2.2.m2.1.2.3.3.1.cmml" xref="S3.p2.2.m2.1.2.3.3.1"></times><cn id="S3.p2.2.m2.1.2.3.3.2.cmml" type="integer" xref="S3.p2.2.m2.1.2.3.3.2">1</cn><ci id="S3.p2.2.m2.1.2.3.3.3.cmml" xref="S3.p2.2.m2.1.2.3.3.3">⋯</ci><ci id="S3.p2.2.m2.1.2.3.3.4.cmml" xref="S3.p2.2.m2.1.2.3.3.4">𝑃</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.2.m2.1c">\text{$\mathsf{prefix}$}=x_{1\cdots P}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.2.m2.1d">sansserif_prefix = italic_x start_POSTSUBSCRIPT 1 ⋯ italic_P end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="\text{$\mathsf{middle}$}=x_{P+1\cdots P+M}" class="ltx_Math" display="inline" id="S3.p2.3.m3.1"><semantics id="S3.p2.3.m3.1a"><mrow id="S3.p2.3.m3.1.2" xref="S3.p2.3.m3.1.2.cmml"><mi id="S3.p2.3.m3.1.2.2" xref="S3.p2.3.m3.1.2.2.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><mo id="S3.p2.3.m3.1.2.1" xref="S3.p2.3.m3.1.2.1.cmml">=</mo><msub id="S3.p2.3.m3.1.2.3" xref="S3.p2.3.m3.1.2.3.cmml"><mi id="S3.p2.3.m3.1.2.3.2" xref="S3.p2.3.m3.1.2.3.2.cmml">x</mi><mrow id="S3.p2.3.m3.1.2.3.3" xref="S3.p2.3.m3.1.2.3.3.cmml"><mi id="S3.p2.3.m3.1.2.3.3.2" xref="S3.p2.3.m3.1.2.3.3.2.cmml">P</mi><mo id="S3.p2.3.m3.1.2.3.3.1" xref="S3.p2.3.m3.1.2.3.3.1.cmml">+</mo><mrow id="S3.p2.3.m3.1.2.3.3.3" xref="S3.p2.3.m3.1.2.3.3.3.cmml"><mn id="S3.p2.3.m3.1.2.3.3.3.2" xref="S3.p2.3.m3.1.2.3.3.3.2.cmml">1</mn><mo id="S3.p2.3.m3.1.2.3.3.3.1" xref="S3.p2.3.m3.1.2.3.3.3.1.cmml">⁢</mo><mi id="S3.p2.3.m3.1.2.3.3.3.3" mathvariant="normal" xref="S3.p2.3.m3.1.2.3.3.3.3.cmml">⋯</mi><mo id="S3.p2.3.m3.1.2.3.3.3.1a" xref="S3.p2.3.m3.1.2.3.3.3.1.cmml">⁢</mo><mi id="S3.p2.3.m3.1.2.3.3.3.4" xref="S3.p2.3.m3.1.2.3.3.3.4.cmml">P</mi></mrow><mo id="S3.p2.3.m3.1.2.3.3.1a" xref="S3.p2.3.m3.1.2.3.3.1.cmml">+</mo><mi id="S3.p2.3.m3.1.2.3.3.4" xref="S3.p2.3.m3.1.2.3.3.4.cmml">M</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.3.m3.1b"><apply id="S3.p2.3.m3.1.2.cmml" xref="S3.p2.3.m3.1.2"><eq id="S3.p2.3.m3.1.2.1.cmml" xref="S3.p2.3.m3.1.2.1"></eq><ci id="S3.p2.3.m3.1.2.2.cmml" xref="S3.p2.3.m3.1.2.2">𝗆𝗂𝖽𝖽𝗅𝖾</ci><apply id="S3.p2.3.m3.1.2.3.cmml" xref="S3.p2.3.m3.1.2.3"><csymbol cd="ambiguous" id="S3.p2.3.m3.1.2.3.1.cmml" xref="S3.p2.3.m3.1.2.3">subscript</csymbol><ci id="S3.p2.3.m3.1.2.3.2.cmml" xref="S3.p2.3.m3.1.2.3.2">𝑥</ci><apply id="S3.p2.3.m3.1.2.3.3.cmml" xref="S3.p2.3.m3.1.2.3.3"><plus id="S3.p2.3.m3.1.2.3.3.1.cmml" xref="S3.p2.3.m3.1.2.3.3.1"></plus><ci id="S3.p2.3.m3.1.2.3.3.2.cmml" xref="S3.p2.3.m3.1.2.3.3.2">𝑃</ci><apply id="S3.p2.3.m3.1.2.3.3.3.cmml" xref="S3.p2.3.m3.1.2.3.3.3"><times id="S3.p2.3.m3.1.2.3.3.3.1.cmml" xref="S3.p2.3.m3.1.2.3.3.3.1"></times><cn id="S3.p2.3.m3.1.2.3.3.3.2.cmml" type="integer" xref="S3.p2.3.m3.1.2.3.3.3.2">1</cn><ci id="S3.p2.3.m3.1.2.3.3.3.3.cmml" xref="S3.p2.3.m3.1.2.3.3.3.3">⋯</ci><ci id="S3.p2.3.m3.1.2.3.3.3.4.cmml" xref="S3.p2.3.m3.1.2.3.3.3.4">𝑃</ci></apply><ci id="S3.p2.3.m3.1.2.3.3.4.cmml" xref="S3.p2.3.m3.1.2.3.3.4">𝑀</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.3.m3.1c">\text{$\mathsf{middle}$}=x_{P+1\cdots P+M}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.3.m3.1d">sansserif_middle = italic_x start_POSTSUBSCRIPT italic_P + 1 ⋯ italic_P + italic_M end_POSTSUBSCRIPT</annotation></semantics></math>, and <math alttext="\text{$\mathsf{suffix}$}=x_{P+M+1\cdots T}" class="ltx_Math" display="inline" id="S3.p2.4.m4.1"><semantics id="S3.p2.4.m4.1a"><mrow id="S3.p2.4.m4.1.2" xref="S3.p2.4.m4.1.2.cmml"><mi id="S3.p2.4.m4.1.2.2" xref="S3.p2.4.m4.1.2.2.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><mo id="S3.p2.4.m4.1.2.1" xref="S3.p2.4.m4.1.2.1.cmml">=</mo><msub id="S3.p2.4.m4.1.2.3" xref="S3.p2.4.m4.1.2.3.cmml"><mi id="S3.p2.4.m4.1.2.3.2" xref="S3.p2.4.m4.1.2.3.2.cmml">x</mi><mrow id="S3.p2.4.m4.1.2.3.3" xref="S3.p2.4.m4.1.2.3.3.cmml"><mi id="S3.p2.4.m4.1.2.3.3.2" xref="S3.p2.4.m4.1.2.3.3.2.cmml">P</mi><mo id="S3.p2.4.m4.1.2.3.3.1" xref="S3.p2.4.m4.1.2.3.3.1.cmml">+</mo><mi id="S3.p2.4.m4.1.2.3.3.3" xref="S3.p2.4.m4.1.2.3.3.3.cmml">M</mi><mo id="S3.p2.4.m4.1.2.3.3.1a" xref="S3.p2.4.m4.1.2.3.3.1.cmml">+</mo><mrow id="S3.p2.4.m4.1.2.3.3.4" xref="S3.p2.4.m4.1.2.3.3.4.cmml"><mn id="S3.p2.4.m4.1.2.3.3.4.2" xref="S3.p2.4.m4.1.2.3.3.4.2.cmml">1</mn><mo id="S3.p2.4.m4.1.2.3.3.4.1" xref="S3.p2.4.m4.1.2.3.3.4.1.cmml">⁢</mo><mi id="S3.p2.4.m4.1.2.3.3.4.3" mathvariant="normal" xref="S3.p2.4.m4.1.2.3.3.4.3.cmml">⋯</mi><mo id="S3.p2.4.m4.1.2.3.3.4.1a" xref="S3.p2.4.m4.1.2.3.3.4.1.cmml">⁢</mo><mi id="S3.p2.4.m4.1.2.3.3.4.4" xref="S3.p2.4.m4.1.2.3.3.4.4.cmml">T</mi></mrow></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.4.m4.1b"><apply id="S3.p2.4.m4.1.2.cmml" xref="S3.p2.4.m4.1.2"><eq id="S3.p2.4.m4.1.2.1.cmml" xref="S3.p2.4.m4.1.2.1"></eq><ci id="S3.p2.4.m4.1.2.2.cmml" xref="S3.p2.4.m4.1.2.2">𝗌𝗎𝖿𝖿𝗂𝗑</ci><apply id="S3.p2.4.m4.1.2.3.cmml" xref="S3.p2.4.m4.1.2.3"><csymbol cd="ambiguous" id="S3.p2.4.m4.1.2.3.1.cmml" xref="S3.p2.4.m4.1.2.3">subscript</csymbol><ci id="S3.p2.4.m4.1.2.3.2.cmml" xref="S3.p2.4.m4.1.2.3.2">𝑥</ci><apply id="S3.p2.4.m4.1.2.3.3.cmml" xref="S3.p2.4.m4.1.2.3.3"><plus id="S3.p2.4.m4.1.2.3.3.1.cmml" xref="S3.p2.4.m4.1.2.3.3.1"></plus><ci id="S3.p2.4.m4.1.2.3.3.2.cmml" xref="S3.p2.4.m4.1.2.3.3.2">𝑃</ci><ci id="S3.p2.4.m4.1.2.3.3.3.cmml" xref="S3.p2.4.m4.1.2.3.3.3">𝑀</ci><apply id="S3.p2.4.m4.1.2.3.3.4.cmml" xref="S3.p2.4.m4.1.2.3.3.4"><times id="S3.p2.4.m4.1.2.3.3.4.1.cmml" xref="S3.p2.4.m4.1.2.3.3.4.1"></times><cn id="S3.p2.4.m4.1.2.3.3.4.2.cmml" type="integer" xref="S3.p2.4.m4.1.2.3.3.4.2">1</cn><ci id="S3.p2.4.m4.1.2.3.3.4.3.cmml" xref="S3.p2.4.m4.1.2.3.3.4.3">⋯</ci><ci id="S3.p2.4.m4.1.2.3.3.4.4.cmml" xref="S3.p2.4.m4.1.2.3.3.4.4">𝑇</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.4.m4.1c">\text{$\mathsf{suffix}$}=x_{P+M+1\cdots T}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.4.m4.1d">sansserif_suffix = italic_x start_POSTSUBSCRIPT italic_P + italic_M + 1 ⋯ italic_T end_POSTSUBSCRIPT</annotation></semantics></math>. Then, the new document <math alttext="D^{\prime}" class="ltx_Math" display="inline" id="S3.p2.5.m5.1"><semantics id="S3.p2.5.m5.1a"><msup id="S3.p2.5.m5.1.1" xref="S3.p2.5.m5.1.1.cmml"><mi id="S3.p2.5.m5.1.1.2" xref="S3.p2.5.m5.1.1.2.cmml">D</mi><mo id="S3.p2.5.m5.1.1.3" xref="S3.p2.5.m5.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.p2.5.m5.1b"><apply id="S3.p2.5.m5.1.1.cmml" xref="S3.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S3.p2.5.m5.1.1.1.cmml" xref="S3.p2.5.m5.1.1">superscript</csymbol><ci id="S3.p2.5.m5.1.1.2.cmml" xref="S3.p2.5.m5.1.1.2">𝐷</ci><ci id="S3.p2.5.m5.1.1.3.cmml" xref="S3.p2.5.m5.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.5.m5.1c">D^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.5.m5.1d">italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> will be formatted as follows:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}D^{\prime}&amp;=\text{&lt;}\textsc{pre}\text{&gt;}\ \text{$\mathsf{prefix}$%
}\ \text{&lt;}\textsc{suf}\text{&gt;}\ \text{$\mathsf{suffix}$}\ \text{&lt;}\textsc{mid%
}\text{&gt;}\ \text{$\mathsf{middle}$}\ \text{&lt;}\textsc{eoi}\text{&gt;}\\
&amp;=\text{&lt;}\textsc{pre}\text{&gt;}\ x_{1\cdots P}\ \text{&lt;}\textsc{suf}\text{&gt;}\ x%
_{P+M+1\cdots T}\ \text{&lt;}\textsc{mid}\text{&gt;}\ x_{P+1\cdots P+M}\ \text{&lt;}%
\textsc{eoi}\text{&gt;}\\
&amp;\overset{\Delta}{=}y_{1\cdots T-M+3}\ x_{P+1\cdots P+M}\ \text{&lt;}\textsc{eoi}%
\text{&gt;},\end{split}" class="ltx_Math" display="block" id="S3.E1.m1.30"><semantics id="S3.E1.m1.30a"><mtable columnspacing="0pt" displaystyle="true" id="S3.E1.m1.30.30.2" rowspacing="0pt"><mtr id="S3.E1.m1.30.30.2a"><mtd class="ltx_align_right" columnalign="right" id="S3.E1.m1.30.30.2b"><msup id="S3.E1.m1.5.5.5.5.2"><mi id="S3.E1.m1.4.4.4.4.1.1" xref="S3.E1.m1.4.4.4.4.1.1.cmml">D</mi><mo id="S3.E1.m1.5.5.5.5.2.2.1" xref="S3.E1.m1.5.5.5.5.2.2.1.cmml">′</mo></msup></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E1.m1.30.30.2c"><mrow id="S3.E1.m1.10.10.10.10.8"><mi id="S3.E1.m1.10.10.10.10.8.9" xref="S3.E1.m1.29.29.1.1.1.cmml"></mi><mo id="S3.E1.m1.6.6.6.6.4.4" xref="S3.E1.m1.6.6.6.6.4.4.cmml">=</mo><mrow id="S3.E1.m1.10.10.10.10.8.10"><mrow id="S3.E1.m1.7.7.7.7.5.5" xref="S3.E1.m1.7.7.7.7.5.5d.cmml"><mtext id="S3.E1.m1.7.7.7.7.5.5a" xref="S3.E1.m1.7.7.7.7.5.5d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.7.7.7.7.5.5b" xref="S3.E1.m1.7.7.7.7.5.5d.cmml">pre</mtext><mtext id="S3.E1.m1.7.7.7.7.5.5c" xref="S3.E1.m1.7.7.7.7.5.5d.cmml">&gt;</mtext></mrow><mo id="S3.E1.m1.10.10.10.10.8.10.1" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mi id="S3.E1.m1.1.1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><mo id="S3.E1.m1.10.10.10.10.8.10.1a" lspace="0.500em" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.8.8.8.8.6.6" xref="S3.E1.m1.8.8.8.8.6.6d.cmml"><mtext id="S3.E1.m1.8.8.8.8.6.6a" xref="S3.E1.m1.8.8.8.8.6.6d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.8.8.8.8.6.6b" xref="S3.E1.m1.8.8.8.8.6.6d.cmml">suf</mtext><mtext id="S3.E1.m1.8.8.8.8.6.6c" xref="S3.E1.m1.8.8.8.8.6.6d.cmml">&gt;</mtext></mrow><mo id="S3.E1.m1.10.10.10.10.8.10.1b" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mi id="S3.E1.m1.2.2.2.2.2.2" xref="S3.E1.m1.2.2.2.2.2.2.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><mo id="S3.E1.m1.10.10.10.10.8.10.1c" lspace="0.500em" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.9.9.9.9.7.7" xref="S3.E1.m1.9.9.9.9.7.7d.cmml"><mtext id="S3.E1.m1.9.9.9.9.7.7a" xref="S3.E1.m1.9.9.9.9.7.7d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.9.9.9.9.7.7b" xref="S3.E1.m1.9.9.9.9.7.7d.cmml">mid</mtext><mtext id="S3.E1.m1.9.9.9.9.7.7c" xref="S3.E1.m1.9.9.9.9.7.7d.cmml">&gt;</mtext></mrow><mo id="S3.E1.m1.10.10.10.10.8.10.1d" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mi id="S3.E1.m1.3.3.3.3.3.3" xref="S3.E1.m1.3.3.3.3.3.3.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><mo id="S3.E1.m1.10.10.10.10.8.10.1e" lspace="0.500em" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.10.10.10.10.8.8" xref="S3.E1.m1.10.10.10.10.8.8d.cmml"><mtext id="S3.E1.m1.10.10.10.10.8.8a" xref="S3.E1.m1.10.10.10.10.8.8d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.10.10.10.10.8.8b" xref="S3.E1.m1.10.10.10.10.8.8d.cmml">eoi</mtext><mtext id="S3.E1.m1.10.10.10.10.8.8c" xref="S3.E1.m1.10.10.10.10.8.8d.cmml">&gt;</mtext></mrow></mrow></mrow></mtd></mtr><mtr id="S3.E1.m1.30.30.2d"><mtd id="S3.E1.m1.30.30.2e" xref="S3.E1.m1.29.29.1.1.1.cmml"></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E1.m1.30.30.2f"><mrow id="S3.E1.m1.21.21.21.11.11"><mi id="S3.E1.m1.21.21.21.11.11.12" xref="S3.E1.m1.29.29.1.1.1.cmml"></mi><mo id="S3.E1.m1.11.11.11.1.1.1" xref="S3.E1.m1.11.11.11.1.1.1.cmml">=</mo><mrow id="S3.E1.m1.21.21.21.11.11.13"><mrow id="S3.E1.m1.12.12.12.2.2.2" xref="S3.E1.m1.12.12.12.2.2.2d.cmml"><mtext id="S3.E1.m1.12.12.12.2.2.2a" xref="S3.E1.m1.12.12.12.2.2.2d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.12.12.12.2.2.2b" xref="S3.E1.m1.12.12.12.2.2.2d.cmml">pre</mtext><mtext id="S3.E1.m1.12.12.12.2.2.2c" xref="S3.E1.m1.12.12.12.2.2.2d.cmml">&gt;</mtext></mrow><mo id="S3.E1.m1.21.21.21.11.11.13.1" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><msub id="S3.E1.m1.21.21.21.11.11.13.2"><mi id="S3.E1.m1.13.13.13.3.3.3" xref="S3.E1.m1.13.13.13.3.3.3.cmml">x</mi><mrow id="S3.E1.m1.14.14.14.4.4.4.1" xref="S3.E1.m1.14.14.14.4.4.4.1.cmml"><mn id="S3.E1.m1.14.14.14.4.4.4.1.2" xref="S3.E1.m1.14.14.14.4.4.4.1.2.cmml">1</mn><mo id="S3.E1.m1.14.14.14.4.4.4.1.1" xref="S3.E1.m1.14.14.14.4.4.4.1.1.cmml">⁢</mo><mi id="S3.E1.m1.14.14.14.4.4.4.1.3" mathvariant="normal" xref="S3.E1.m1.14.14.14.4.4.4.1.3.cmml">⋯</mi><mo id="S3.E1.m1.14.14.14.4.4.4.1.1a" xref="S3.E1.m1.14.14.14.4.4.4.1.1.cmml">⁢</mo><mi id="S3.E1.m1.14.14.14.4.4.4.1.4" xref="S3.E1.m1.14.14.14.4.4.4.1.4.cmml">P</mi></mrow></msub><mo id="S3.E1.m1.21.21.21.11.11.13.1a" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.15.15.15.5.5.5" xref="S3.E1.m1.15.15.15.5.5.5d.cmml"><mtext id="S3.E1.m1.15.15.15.5.5.5a" xref="S3.E1.m1.15.15.15.5.5.5d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.15.15.15.5.5.5b" xref="S3.E1.m1.15.15.15.5.5.5d.cmml">suf</mtext><mtext id="S3.E1.m1.15.15.15.5.5.5c" xref="S3.E1.m1.15.15.15.5.5.5d.cmml">&gt;</mtext></mrow><mo id="S3.E1.m1.21.21.21.11.11.13.1b" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><msub id="S3.E1.m1.21.21.21.11.11.13.3"><mi id="S3.E1.m1.16.16.16.6.6.6" xref="S3.E1.m1.16.16.16.6.6.6.cmml">x</mi><mrow id="S3.E1.m1.17.17.17.7.7.7.1" xref="S3.E1.m1.17.17.17.7.7.7.1.cmml"><mi id="S3.E1.m1.17.17.17.7.7.7.1.2" xref="S3.E1.m1.17.17.17.7.7.7.1.2.cmml">P</mi><mo id="S3.E1.m1.17.17.17.7.7.7.1.1" xref="S3.E1.m1.17.17.17.7.7.7.1.1.cmml">+</mo><mi id="S3.E1.m1.17.17.17.7.7.7.1.3" xref="S3.E1.m1.17.17.17.7.7.7.1.3.cmml">M</mi><mo id="S3.E1.m1.17.17.17.7.7.7.1.1a" xref="S3.E1.m1.17.17.17.7.7.7.1.1.cmml">+</mo><mrow id="S3.E1.m1.17.17.17.7.7.7.1.4" xref="S3.E1.m1.17.17.17.7.7.7.1.4.cmml"><mn id="S3.E1.m1.17.17.17.7.7.7.1.4.2" xref="S3.E1.m1.17.17.17.7.7.7.1.4.2.cmml">1</mn><mo id="S3.E1.m1.17.17.17.7.7.7.1.4.1" xref="S3.E1.m1.17.17.17.7.7.7.1.4.1.cmml">⁢</mo><mi id="S3.E1.m1.17.17.17.7.7.7.1.4.3" mathvariant="normal" xref="S3.E1.m1.17.17.17.7.7.7.1.4.3.cmml">⋯</mi><mo id="S3.E1.m1.17.17.17.7.7.7.1.4.1a" xref="S3.E1.m1.17.17.17.7.7.7.1.4.1.cmml">⁢</mo><mi id="S3.E1.m1.17.17.17.7.7.7.1.4.4" xref="S3.E1.m1.17.17.17.7.7.7.1.4.4.cmml">T</mi></mrow></mrow></msub><mo id="S3.E1.m1.21.21.21.11.11.13.1c" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.18.18.18.8.8.8" xref="S3.E1.m1.18.18.18.8.8.8d.cmml"><mtext id="S3.E1.m1.18.18.18.8.8.8a" xref="S3.E1.m1.18.18.18.8.8.8d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.18.18.18.8.8.8b" xref="S3.E1.m1.18.18.18.8.8.8d.cmml">mid</mtext><mtext id="S3.E1.m1.18.18.18.8.8.8c" xref="S3.E1.m1.18.18.18.8.8.8d.cmml">&gt;</mtext></mrow><mo id="S3.E1.m1.21.21.21.11.11.13.1d" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><msub id="S3.E1.m1.21.21.21.11.11.13.4"><mi id="S3.E1.m1.19.19.19.9.9.9" xref="S3.E1.m1.19.19.19.9.9.9.cmml">x</mi><mrow id="S3.E1.m1.20.20.20.10.10.10.1" xref="S3.E1.m1.20.20.20.10.10.10.1.cmml"><mi id="S3.E1.m1.20.20.20.10.10.10.1.2" xref="S3.E1.m1.20.20.20.10.10.10.1.2.cmml">P</mi><mo id="S3.E1.m1.20.20.20.10.10.10.1.1" xref="S3.E1.m1.20.20.20.10.10.10.1.1.cmml">+</mo><mrow id="S3.E1.m1.20.20.20.10.10.10.1.3" xref="S3.E1.m1.20.20.20.10.10.10.1.3.cmml"><mn id="S3.E1.m1.20.20.20.10.10.10.1.3.2" xref="S3.E1.m1.20.20.20.10.10.10.1.3.2.cmml">1</mn><mo id="S3.E1.m1.20.20.20.10.10.10.1.3.1" xref="S3.E1.m1.20.20.20.10.10.10.1.3.1.cmml">⁢</mo><mi id="S3.E1.m1.20.20.20.10.10.10.1.3.3" mathvariant="normal" xref="S3.E1.m1.20.20.20.10.10.10.1.3.3.cmml">⋯</mi><mo id="S3.E1.m1.20.20.20.10.10.10.1.3.1a" xref="S3.E1.m1.20.20.20.10.10.10.1.3.1.cmml">⁢</mo><mi id="S3.E1.m1.20.20.20.10.10.10.1.3.4" xref="S3.E1.m1.20.20.20.10.10.10.1.3.4.cmml">P</mi></mrow><mo id="S3.E1.m1.20.20.20.10.10.10.1.1a" xref="S3.E1.m1.20.20.20.10.10.10.1.1.cmml">+</mo><mi id="S3.E1.m1.20.20.20.10.10.10.1.4" xref="S3.E1.m1.20.20.20.10.10.10.1.4.cmml">M</mi></mrow></msub><mo id="S3.E1.m1.21.21.21.11.11.13.1e" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.21.21.21.11.11.11" xref="S3.E1.m1.21.21.21.11.11.11d.cmml"><mtext id="S3.E1.m1.21.21.21.11.11.11a" xref="S3.E1.m1.21.21.21.11.11.11d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.21.21.21.11.11.11b" xref="S3.E1.m1.21.21.21.11.11.11d.cmml">eoi</mtext><mtext id="S3.E1.m1.21.21.21.11.11.11c" xref="S3.E1.m1.21.21.21.11.11.11d.cmml">&gt;</mtext></mrow></mrow></mrow></mtd></mtr><mtr id="S3.E1.m1.30.30.2g"><mtd id="S3.E1.m1.30.30.2h" xref="S3.E1.m1.29.29.1.1.1.cmml"></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E1.m1.30.30.2i"><mrow id="S3.E1.m1.30.30.2.29.8.8.8"><mrow id="S3.E1.m1.30.30.2.29.8.8.8.1"><mover accent="true" id="S3.E1.m1.22.22.22.1.1.1" xref="S3.E1.m1.22.22.22.1.1.1.cmml"><mo id="S3.E1.m1.22.22.22.1.1.1.2" xref="S3.E1.m1.22.22.22.1.1.1.2.cmml">=</mo><mo id="S3.E1.m1.22.22.22.1.1.1.1" xref="S3.E1.m1.22.22.22.1.1.1.1.cmml">Δ</mo></mover><mo id="S3.E1.m1.30.30.2.29.8.8.8.1.1" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><msub id="S3.E1.m1.30.30.2.29.8.8.8.1.2"><mi id="S3.E1.m1.23.23.23.2.2.2" xref="S3.E1.m1.23.23.23.2.2.2.cmml">y</mi><mrow id="S3.E1.m1.24.24.24.3.3.3.1" xref="S3.E1.m1.24.24.24.3.3.3.1.cmml"><mrow id="S3.E1.m1.24.24.24.3.3.3.1.2" xref="S3.E1.m1.24.24.24.3.3.3.1.2.cmml"><mrow id="S3.E1.m1.24.24.24.3.3.3.1.2.2" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.cmml"><mn id="S3.E1.m1.24.24.24.3.3.3.1.2.2.2" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.2.cmml">1</mn><mo id="S3.E1.m1.24.24.24.3.3.3.1.2.2.1" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.1.cmml">⁢</mo><mi id="S3.E1.m1.24.24.24.3.3.3.1.2.2.3" mathvariant="normal" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.3.cmml">⋯</mi><mo id="S3.E1.m1.24.24.24.3.3.3.1.2.2.1a" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.1.cmml">⁢</mo><mi id="S3.E1.m1.24.24.24.3.3.3.1.2.2.4" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.4.cmml">T</mi></mrow><mo id="S3.E1.m1.24.24.24.3.3.3.1.2.1" xref="S3.E1.m1.24.24.24.3.3.3.1.2.1.cmml">−</mo><mi id="S3.E1.m1.24.24.24.3.3.3.1.2.3" xref="S3.E1.m1.24.24.24.3.3.3.1.2.3.cmml">M</mi></mrow><mo id="S3.E1.m1.24.24.24.3.3.3.1.1" xref="S3.E1.m1.24.24.24.3.3.3.1.1.cmml">+</mo><mn id="S3.E1.m1.24.24.24.3.3.3.1.3" xref="S3.E1.m1.24.24.24.3.3.3.1.3.cmml">3</mn></mrow></msub><mo id="S3.E1.m1.30.30.2.29.8.8.8.1.1a" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><msub id="S3.E1.m1.30.30.2.29.8.8.8.1.3"><mi id="S3.E1.m1.25.25.25.4.4.4" xref="S3.E1.m1.25.25.25.4.4.4.cmml">x</mi><mrow id="S3.E1.m1.26.26.26.5.5.5.1" xref="S3.E1.m1.26.26.26.5.5.5.1.cmml"><mi id="S3.E1.m1.26.26.26.5.5.5.1.2" xref="S3.E1.m1.26.26.26.5.5.5.1.2.cmml">P</mi><mo id="S3.E1.m1.26.26.26.5.5.5.1.1" xref="S3.E1.m1.26.26.26.5.5.5.1.1.cmml">+</mo><mrow id="S3.E1.m1.26.26.26.5.5.5.1.3" xref="S3.E1.m1.26.26.26.5.5.5.1.3.cmml"><mn id="S3.E1.m1.26.26.26.5.5.5.1.3.2" xref="S3.E1.m1.26.26.26.5.5.5.1.3.2.cmml">1</mn><mo id="S3.E1.m1.26.26.26.5.5.5.1.3.1" xref="S3.E1.m1.26.26.26.5.5.5.1.3.1.cmml">⁢</mo><mi id="S3.E1.m1.26.26.26.5.5.5.1.3.3" mathvariant="normal" xref="S3.E1.m1.26.26.26.5.5.5.1.3.3.cmml">⋯</mi><mo id="S3.E1.m1.26.26.26.5.5.5.1.3.1a" xref="S3.E1.m1.26.26.26.5.5.5.1.3.1.cmml">⁢</mo><mi id="S3.E1.m1.26.26.26.5.5.5.1.3.4" xref="S3.E1.m1.26.26.26.5.5.5.1.3.4.cmml">P</mi></mrow><mo id="S3.E1.m1.26.26.26.5.5.5.1.1a" xref="S3.E1.m1.26.26.26.5.5.5.1.1.cmml">+</mo><mi id="S3.E1.m1.26.26.26.5.5.5.1.4" xref="S3.E1.m1.26.26.26.5.5.5.1.4.cmml">M</mi></mrow></msub><mo id="S3.E1.m1.30.30.2.29.8.8.8.1.1b" xref="S3.E1.m1.29.29.1.1.1.cmml">⁢</mo><mrow id="S3.E1.m1.27.27.27.6.6.6" xref="S3.E1.m1.27.27.27.6.6.6d.cmml"><mtext id="S3.E1.m1.27.27.27.6.6.6a" xref="S3.E1.m1.27.27.27.6.6.6d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.27.27.27.6.6.6b" xref="S3.E1.m1.27.27.27.6.6.6d.cmml">eoi</mtext><mtext id="S3.E1.m1.27.27.27.6.6.6c" xref="S3.E1.m1.27.27.27.6.6.6d.cmml">&gt;</mtext></mrow></mrow><mo id="S3.E1.m1.28.28.28.7.7.7" xref="S3.E1.m1.29.29.1.1.1.cmml">,</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E1.m1.30b"><apply id="S3.E1.m1.29.29.1.1.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><and id="S3.E1.m1.29.29.1.1.1a.cmml" xref="S3.E1.m1.10.10.10.10.8.9"></and><apply id="S3.E1.m1.29.29.1.1.1b.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><eq id="S3.E1.m1.6.6.6.6.4.4.cmml" xref="S3.E1.m1.6.6.6.6.4.4"></eq><apply id="S3.E1.m1.29.29.1.1.1.2.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><csymbol cd="ambiguous" id="S3.E1.m1.29.29.1.1.1.2.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9">superscript</csymbol><ci id="S3.E1.m1.4.4.4.4.1.1.cmml" xref="S3.E1.m1.4.4.4.4.1.1">𝐷</ci><ci id="S3.E1.m1.5.5.5.5.2.2.1.cmml" xref="S3.E1.m1.5.5.5.5.2.2.1">′</ci></apply><apply id="S3.E1.m1.29.29.1.1.1.4.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><times id="S3.E1.m1.29.29.1.1.1.4.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9"></times><ci id="S3.E1.m1.7.7.7.7.5.5d.cmml" xref="S3.E1.m1.7.7.7.7.5.5"><mrow id="S3.E1.m1.7.7.7.7.5.5.cmml" xref="S3.E1.m1.7.7.7.7.5.5"><mtext id="S3.E1.m1.7.7.7.7.5.5a.cmml" xref="S3.E1.m1.7.7.7.7.5.5">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.7.7.7.7.5.5b.cmml" xref="S3.E1.m1.7.7.7.7.5.5">pre</mtext><mtext id="S3.E1.m1.7.7.7.7.5.5c.cmml" xref="S3.E1.m1.7.7.7.7.5.5">&gt;</mtext></mrow></ci><ci id="S3.E1.m1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.1.1.1.1.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci><ci id="S3.E1.m1.8.8.8.8.6.6d.cmml" xref="S3.E1.m1.8.8.8.8.6.6"><mrow id="S3.E1.m1.8.8.8.8.6.6.cmml" xref="S3.E1.m1.8.8.8.8.6.6"><mtext id="S3.E1.m1.8.8.8.8.6.6a.cmml" xref="S3.E1.m1.8.8.8.8.6.6">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.8.8.8.8.6.6b.cmml" xref="S3.E1.m1.8.8.8.8.6.6">suf</mtext><mtext id="S3.E1.m1.8.8.8.8.6.6c.cmml" xref="S3.E1.m1.8.8.8.8.6.6">&gt;</mtext></mrow></ci><ci id="S3.E1.m1.2.2.2.2.2.2.cmml" xref="S3.E1.m1.2.2.2.2.2.2">𝗌𝗎𝖿𝖿𝗂𝗑</ci><ci id="S3.E1.m1.9.9.9.9.7.7d.cmml" xref="S3.E1.m1.9.9.9.9.7.7"><mrow id="S3.E1.m1.9.9.9.9.7.7.cmml" xref="S3.E1.m1.9.9.9.9.7.7"><mtext id="S3.E1.m1.9.9.9.9.7.7a.cmml" xref="S3.E1.m1.9.9.9.9.7.7">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.9.9.9.9.7.7b.cmml" xref="S3.E1.m1.9.9.9.9.7.7">mid</mtext><mtext id="S3.E1.m1.9.9.9.9.7.7c.cmml" xref="S3.E1.m1.9.9.9.9.7.7">&gt;</mtext></mrow></ci><ci id="S3.E1.m1.3.3.3.3.3.3.cmml" xref="S3.E1.m1.3.3.3.3.3.3">𝗆𝗂𝖽𝖽𝗅𝖾</ci><ci id="S3.E1.m1.10.10.10.10.8.8d.cmml" xref="S3.E1.m1.10.10.10.10.8.8"><mrow id="S3.E1.m1.10.10.10.10.8.8.cmml" xref="S3.E1.m1.10.10.10.10.8.8"><mtext id="S3.E1.m1.10.10.10.10.8.8a.cmml" xref="S3.E1.m1.10.10.10.10.8.8">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.10.10.10.10.8.8b.cmml" xref="S3.E1.m1.10.10.10.10.8.8">eoi</mtext><mtext id="S3.E1.m1.10.10.10.10.8.8c.cmml" xref="S3.E1.m1.10.10.10.10.8.8">&gt;</mtext></mrow></ci></apply></apply><apply id="S3.E1.m1.29.29.1.1.1c.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><eq id="S3.E1.m1.11.11.11.1.1.1.cmml" xref="S3.E1.m1.11.11.11.1.1.1"></eq><share href="https://arxiv.org/html/2410.03103v1#S3.E1.m1.29.29.1.1.1.4.cmml" id="S3.E1.m1.29.29.1.1.1d.cmml" xref="S3.E1.m1.10.10.10.10.8.9"></share><apply id="S3.E1.m1.29.29.1.1.1.6.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><times id="S3.E1.m1.29.29.1.1.1.6.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9"></times><ci id="S3.E1.m1.12.12.12.2.2.2d.cmml" xref="S3.E1.m1.12.12.12.2.2.2"><mrow id="S3.E1.m1.12.12.12.2.2.2.cmml" xref="S3.E1.m1.12.12.12.2.2.2"><mtext id="S3.E1.m1.12.12.12.2.2.2a.cmml" xref="S3.E1.m1.12.12.12.2.2.2">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.12.12.12.2.2.2b.cmml" xref="S3.E1.m1.12.12.12.2.2.2">pre</mtext><mtext id="S3.E1.m1.12.12.12.2.2.2c.cmml" xref="S3.E1.m1.12.12.12.2.2.2">&gt;</mtext></mrow></ci><apply id="S3.E1.m1.29.29.1.1.1.6.3.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><csymbol cd="ambiguous" id="S3.E1.m1.29.29.1.1.1.6.3.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9">subscript</csymbol><ci id="S3.E1.m1.13.13.13.3.3.3.cmml" xref="S3.E1.m1.13.13.13.3.3.3">𝑥</ci><apply id="S3.E1.m1.14.14.14.4.4.4.1.cmml" xref="S3.E1.m1.14.14.14.4.4.4.1"><times id="S3.E1.m1.14.14.14.4.4.4.1.1.cmml" xref="S3.E1.m1.14.14.14.4.4.4.1.1"></times><cn id="S3.E1.m1.14.14.14.4.4.4.1.2.cmml" type="integer" xref="S3.E1.m1.14.14.14.4.4.4.1.2">1</cn><ci id="S3.E1.m1.14.14.14.4.4.4.1.3.cmml" xref="S3.E1.m1.14.14.14.4.4.4.1.3">⋯</ci><ci id="S3.E1.m1.14.14.14.4.4.4.1.4.cmml" xref="S3.E1.m1.14.14.14.4.4.4.1.4">𝑃</ci></apply></apply><ci id="S3.E1.m1.15.15.15.5.5.5d.cmml" xref="S3.E1.m1.15.15.15.5.5.5"><mrow id="S3.E1.m1.15.15.15.5.5.5.cmml" xref="S3.E1.m1.15.15.15.5.5.5"><mtext id="S3.E1.m1.15.15.15.5.5.5a.cmml" xref="S3.E1.m1.15.15.15.5.5.5">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.15.15.15.5.5.5b.cmml" xref="S3.E1.m1.15.15.15.5.5.5">suf</mtext><mtext id="S3.E1.m1.15.15.15.5.5.5c.cmml" xref="S3.E1.m1.15.15.15.5.5.5">&gt;</mtext></mrow></ci><apply id="S3.E1.m1.29.29.1.1.1.6.5.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><csymbol cd="ambiguous" id="S3.E1.m1.29.29.1.1.1.6.5.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9">subscript</csymbol><ci id="S3.E1.m1.16.16.16.6.6.6.cmml" xref="S3.E1.m1.16.16.16.6.6.6">𝑥</ci><apply id="S3.E1.m1.17.17.17.7.7.7.1.cmml" xref="S3.E1.m1.17.17.17.7.7.7.1"><plus id="S3.E1.m1.17.17.17.7.7.7.1.1.cmml" xref="S3.E1.m1.17.17.17.7.7.7.1.1"></plus><ci id="S3.E1.m1.17.17.17.7.7.7.1.2.cmml" xref="S3.E1.m1.17.17.17.7.7.7.1.2">𝑃</ci><ci id="S3.E1.m1.17.17.17.7.7.7.1.3.cmml" xref="S3.E1.m1.17.17.17.7.7.7.1.3">𝑀</ci><apply id="S3.E1.m1.17.17.17.7.7.7.1.4.cmml" xref="S3.E1.m1.17.17.17.7.7.7.1.4"><times id="S3.E1.m1.17.17.17.7.7.7.1.4.1.cmml" xref="S3.E1.m1.17.17.17.7.7.7.1.4.1"></times><cn id="S3.E1.m1.17.17.17.7.7.7.1.4.2.cmml" type="integer" xref="S3.E1.m1.17.17.17.7.7.7.1.4.2">1</cn><ci id="S3.E1.m1.17.17.17.7.7.7.1.4.3.cmml" xref="S3.E1.m1.17.17.17.7.7.7.1.4.3">⋯</ci><ci id="S3.E1.m1.17.17.17.7.7.7.1.4.4.cmml" xref="S3.E1.m1.17.17.17.7.7.7.1.4.4">𝑇</ci></apply></apply></apply><ci id="S3.E1.m1.18.18.18.8.8.8d.cmml" xref="S3.E1.m1.18.18.18.8.8.8"><mrow id="S3.E1.m1.18.18.18.8.8.8.cmml" xref="S3.E1.m1.18.18.18.8.8.8"><mtext id="S3.E1.m1.18.18.18.8.8.8a.cmml" xref="S3.E1.m1.18.18.18.8.8.8">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.18.18.18.8.8.8b.cmml" xref="S3.E1.m1.18.18.18.8.8.8">mid</mtext><mtext id="S3.E1.m1.18.18.18.8.8.8c.cmml" xref="S3.E1.m1.18.18.18.8.8.8">&gt;</mtext></mrow></ci><apply id="S3.E1.m1.29.29.1.1.1.6.7.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><csymbol cd="ambiguous" id="S3.E1.m1.29.29.1.1.1.6.7.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9">subscript</csymbol><ci id="S3.E1.m1.19.19.19.9.9.9.cmml" xref="S3.E1.m1.19.19.19.9.9.9">𝑥</ci><apply id="S3.E1.m1.20.20.20.10.10.10.1.cmml" xref="S3.E1.m1.20.20.20.10.10.10.1"><plus id="S3.E1.m1.20.20.20.10.10.10.1.1.cmml" xref="S3.E1.m1.20.20.20.10.10.10.1.1"></plus><ci id="S3.E1.m1.20.20.20.10.10.10.1.2.cmml" xref="S3.E1.m1.20.20.20.10.10.10.1.2">𝑃</ci><apply id="S3.E1.m1.20.20.20.10.10.10.1.3.cmml" xref="S3.E1.m1.20.20.20.10.10.10.1.3"><times id="S3.E1.m1.20.20.20.10.10.10.1.3.1.cmml" xref="S3.E1.m1.20.20.20.10.10.10.1.3.1"></times><cn id="S3.E1.m1.20.20.20.10.10.10.1.3.2.cmml" type="integer" xref="S3.E1.m1.20.20.20.10.10.10.1.3.2">1</cn><ci id="S3.E1.m1.20.20.20.10.10.10.1.3.3.cmml" xref="S3.E1.m1.20.20.20.10.10.10.1.3.3">⋯</ci><ci id="S3.E1.m1.20.20.20.10.10.10.1.3.4.cmml" xref="S3.E1.m1.20.20.20.10.10.10.1.3.4">𝑃</ci></apply><ci id="S3.E1.m1.20.20.20.10.10.10.1.4.cmml" xref="S3.E1.m1.20.20.20.10.10.10.1.4">𝑀</ci></apply></apply><ci id="S3.E1.m1.21.21.21.11.11.11d.cmml" xref="S3.E1.m1.21.21.21.11.11.11"><mrow id="S3.E1.m1.21.21.21.11.11.11.cmml" xref="S3.E1.m1.21.21.21.11.11.11"><mtext id="S3.E1.m1.21.21.21.11.11.11a.cmml" xref="S3.E1.m1.21.21.21.11.11.11">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.21.21.21.11.11.11b.cmml" xref="S3.E1.m1.21.21.21.11.11.11">eoi</mtext><mtext id="S3.E1.m1.21.21.21.11.11.11c.cmml" xref="S3.E1.m1.21.21.21.11.11.11">&gt;</mtext></mrow></ci><apply id="S3.E1.m1.22.22.22.1.1.1.cmml" xref="S3.E1.m1.22.22.22.1.1.1"><ci id="S3.E1.m1.22.22.22.1.1.1.1.cmml" xref="S3.E1.m1.22.22.22.1.1.1.1">Δ</ci><eq id="S3.E1.m1.22.22.22.1.1.1.2.cmml" xref="S3.E1.m1.22.22.22.1.1.1.2"></eq></apply><apply id="S3.E1.m1.29.29.1.1.1.6.10.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><csymbol cd="ambiguous" id="S3.E1.m1.29.29.1.1.1.6.10.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9">subscript</csymbol><ci id="S3.E1.m1.23.23.23.2.2.2.cmml" xref="S3.E1.m1.23.23.23.2.2.2">𝑦</ci><apply id="S3.E1.m1.24.24.24.3.3.3.1.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1"><plus id="S3.E1.m1.24.24.24.3.3.3.1.1.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1.1"></plus><apply id="S3.E1.m1.24.24.24.3.3.3.1.2.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1.2"><minus id="S3.E1.m1.24.24.24.3.3.3.1.2.1.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1.2.1"></minus><apply id="S3.E1.m1.24.24.24.3.3.3.1.2.2.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2"><times id="S3.E1.m1.24.24.24.3.3.3.1.2.2.1.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.1"></times><cn id="S3.E1.m1.24.24.24.3.3.3.1.2.2.2.cmml" type="integer" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.2">1</cn><ci id="S3.E1.m1.24.24.24.3.3.3.1.2.2.3.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.3">⋯</ci><ci id="S3.E1.m1.24.24.24.3.3.3.1.2.2.4.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1.2.2.4">𝑇</ci></apply><ci id="S3.E1.m1.24.24.24.3.3.3.1.2.3.cmml" xref="S3.E1.m1.24.24.24.3.3.3.1.2.3">𝑀</ci></apply><cn id="S3.E1.m1.24.24.24.3.3.3.1.3.cmml" type="integer" xref="S3.E1.m1.24.24.24.3.3.3.1.3">3</cn></apply></apply><apply id="S3.E1.m1.29.29.1.1.1.6.11.cmml" xref="S3.E1.m1.10.10.10.10.8.9"><csymbol cd="ambiguous" id="S3.E1.m1.29.29.1.1.1.6.11.1.cmml" xref="S3.E1.m1.10.10.10.10.8.9">subscript</csymbol><ci id="S3.E1.m1.25.25.25.4.4.4.cmml" xref="S3.E1.m1.25.25.25.4.4.4">𝑥</ci><apply id="S3.E1.m1.26.26.26.5.5.5.1.cmml" xref="S3.E1.m1.26.26.26.5.5.5.1"><plus id="S3.E1.m1.26.26.26.5.5.5.1.1.cmml" xref="S3.E1.m1.26.26.26.5.5.5.1.1"></plus><ci id="S3.E1.m1.26.26.26.5.5.5.1.2.cmml" xref="S3.E1.m1.26.26.26.5.5.5.1.2">𝑃</ci><apply id="S3.E1.m1.26.26.26.5.5.5.1.3.cmml" xref="S3.E1.m1.26.26.26.5.5.5.1.3"><times id="S3.E1.m1.26.26.26.5.5.5.1.3.1.cmml" xref="S3.E1.m1.26.26.26.5.5.5.1.3.1"></times><cn id="S3.E1.m1.26.26.26.5.5.5.1.3.2.cmml" type="integer" xref="S3.E1.m1.26.26.26.5.5.5.1.3.2">1</cn><ci id="S3.E1.m1.26.26.26.5.5.5.1.3.3.cmml" xref="S3.E1.m1.26.26.26.5.5.5.1.3.3">⋯</ci><ci id="S3.E1.m1.26.26.26.5.5.5.1.3.4.cmml" xref="S3.E1.m1.26.26.26.5.5.5.1.3.4">𝑃</ci></apply><ci id="S3.E1.m1.26.26.26.5.5.5.1.4.cmml" xref="S3.E1.m1.26.26.26.5.5.5.1.4">𝑀</ci></apply></apply><ci id="S3.E1.m1.27.27.27.6.6.6d.cmml" xref="S3.E1.m1.27.27.27.6.6.6"><mrow id="S3.E1.m1.27.27.27.6.6.6.cmml" xref="S3.E1.m1.27.27.27.6.6.6"><mtext id="S3.E1.m1.27.27.27.6.6.6a.cmml" xref="S3.E1.m1.27.27.27.6.6.6">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E1.m1.27.27.27.6.6.6b.cmml" xref="S3.E1.m1.27.27.27.6.6.6">eoi</mtext><mtext id="S3.E1.m1.27.27.27.6.6.6c.cmml" xref="S3.E1.m1.27.27.27.6.6.6">&gt;</mtext></mrow></ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.30c">\begin{split}D^{\prime}&amp;=\text{&lt;}\textsc{pre}\text{&gt;}\ \text{$\mathsf{prefix}$%
}\ \text{&lt;}\textsc{suf}\text{&gt;}\ \text{$\mathsf{suffix}$}\ \text{&lt;}\textsc{mid%
}\text{&gt;}\ \text{$\mathsf{middle}$}\ \text{&lt;}\textsc{eoi}\text{&gt;}\\
&amp;=\text{&lt;}\textsc{pre}\text{&gt;}\ x_{1\cdots P}\ \text{&lt;}\textsc{suf}\text{&gt;}\ x%
_{P+M+1\cdots T}\ \text{&lt;}\textsc{mid}\text{&gt;}\ x_{P+1\cdots P+M}\ \text{&lt;}%
\textsc{eoi}\text{&gt;}\\
&amp;\overset{\Delta}{=}y_{1\cdots T-M+3}\ x_{P+1\cdots P+M}\ \text{&lt;}\textsc{eoi}%
\text{&gt;},\end{split}</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.30d">start_ROW start_CELL italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT end_CELL start_CELL = &lt; smallcaps_pre &gt; sansserif_prefix &lt; smallcaps_suf &gt; sansserif_suffix &lt; smallcaps_mid &gt; sansserif_middle &lt; smallcaps_eoi &gt; end_CELL end_ROW start_ROW start_CELL end_CELL start_CELL = &lt; smallcaps_pre &gt; italic_x start_POSTSUBSCRIPT 1 ⋯ italic_P end_POSTSUBSCRIPT &lt; smallcaps_suf &gt; italic_x start_POSTSUBSCRIPT italic_P + italic_M + 1 ⋯ italic_T end_POSTSUBSCRIPT &lt; smallcaps_mid &gt; italic_x start_POSTSUBSCRIPT italic_P + 1 ⋯ italic_P + italic_M end_POSTSUBSCRIPT &lt; smallcaps_eoi &gt; end_CELL end_ROW start_ROW start_CELL end_CELL start_CELL overroman_Δ start_ARG = end_ARG italic_y start_POSTSUBSCRIPT 1 ⋯ italic_T - italic_M + 3 end_POSTSUBSCRIPT italic_x start_POSTSUBSCRIPT italic_P + 1 ⋯ italic_P + italic_M end_POSTSUBSCRIPT &lt; smallcaps_eoi &gt; , end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p2.7">where the last step re-indexes the leading tokens up until <span class="ltx_text" id="S3.p2.7.1">&lt;</span><span class="ltx_text ltx_font_smallcaps" id="S3.p2.7.2">mid<span class="ltx_text ltx_font_upright" id="S3.p2.7.2.1">&gt;</span></span> to <math alttext="y_{1\cdots T-M+3}" class="ltx_Math" display="inline" id="S3.p2.6.m1.1"><semantics id="S3.p2.6.m1.1a"><msub id="S3.p2.6.m1.1.1" xref="S3.p2.6.m1.1.1.cmml"><mi id="S3.p2.6.m1.1.1.2" xref="S3.p2.6.m1.1.1.2.cmml">y</mi><mrow id="S3.p2.6.m1.1.1.3" xref="S3.p2.6.m1.1.1.3.cmml"><mrow id="S3.p2.6.m1.1.1.3.2" xref="S3.p2.6.m1.1.1.3.2.cmml"><mrow id="S3.p2.6.m1.1.1.3.2.2" xref="S3.p2.6.m1.1.1.3.2.2.cmml"><mn id="S3.p2.6.m1.1.1.3.2.2.2" xref="S3.p2.6.m1.1.1.3.2.2.2.cmml">1</mn><mo id="S3.p2.6.m1.1.1.3.2.2.1" xref="S3.p2.6.m1.1.1.3.2.2.1.cmml">⁢</mo><mi id="S3.p2.6.m1.1.1.3.2.2.3" mathvariant="normal" xref="S3.p2.6.m1.1.1.3.2.2.3.cmml">⋯</mi><mo id="S3.p2.6.m1.1.1.3.2.2.1a" xref="S3.p2.6.m1.1.1.3.2.2.1.cmml">⁢</mo><mi id="S3.p2.6.m1.1.1.3.2.2.4" xref="S3.p2.6.m1.1.1.3.2.2.4.cmml">T</mi></mrow><mo id="S3.p2.6.m1.1.1.3.2.1" xref="S3.p2.6.m1.1.1.3.2.1.cmml">−</mo><mi id="S3.p2.6.m1.1.1.3.2.3" xref="S3.p2.6.m1.1.1.3.2.3.cmml">M</mi></mrow><mo id="S3.p2.6.m1.1.1.3.1" xref="S3.p2.6.m1.1.1.3.1.cmml">+</mo><mn id="S3.p2.6.m1.1.1.3.3" xref="S3.p2.6.m1.1.1.3.3.cmml">3</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.p2.6.m1.1b"><apply id="S3.p2.6.m1.1.1.cmml" xref="S3.p2.6.m1.1.1"><csymbol cd="ambiguous" id="S3.p2.6.m1.1.1.1.cmml" xref="S3.p2.6.m1.1.1">subscript</csymbol><ci id="S3.p2.6.m1.1.1.2.cmml" xref="S3.p2.6.m1.1.1.2">𝑦</ci><apply id="S3.p2.6.m1.1.1.3.cmml" xref="S3.p2.6.m1.1.1.3"><plus id="S3.p2.6.m1.1.1.3.1.cmml" xref="S3.p2.6.m1.1.1.3.1"></plus><apply id="S3.p2.6.m1.1.1.3.2.cmml" xref="S3.p2.6.m1.1.1.3.2"><minus id="S3.p2.6.m1.1.1.3.2.1.cmml" xref="S3.p2.6.m1.1.1.3.2.1"></minus><apply id="S3.p2.6.m1.1.1.3.2.2.cmml" xref="S3.p2.6.m1.1.1.3.2.2"><times id="S3.p2.6.m1.1.1.3.2.2.1.cmml" xref="S3.p2.6.m1.1.1.3.2.2.1"></times><cn id="S3.p2.6.m1.1.1.3.2.2.2.cmml" type="integer" xref="S3.p2.6.m1.1.1.3.2.2.2">1</cn><ci id="S3.p2.6.m1.1.1.3.2.2.3.cmml" xref="S3.p2.6.m1.1.1.3.2.2.3">⋯</ci><ci id="S3.p2.6.m1.1.1.3.2.2.4.cmml" xref="S3.p2.6.m1.1.1.3.2.2.4">𝑇</ci></apply><ci id="S3.p2.6.m1.1.1.3.2.3.cmml" xref="S3.p2.6.m1.1.1.3.2.3">𝑀</ci></apply><cn id="S3.p2.6.m1.1.1.3.3.cmml" type="integer" xref="S3.p2.6.m1.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.6.m1.1c">y_{1\cdots T-M+3}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.6.m1.1d">italic_y start_POSTSUBSCRIPT 1 ⋯ italic_T - italic_M + 3 end_POSTSUBSCRIPT</annotation></semantics></math> to focus on the FIM part, as LLMs are expected to start infilling after &lt;<span class="ltx_text ltx_font_smallcaps" id="S3.p2.7.3">mid</span>&gt; token and to end generation with &lt;<span class="ltx_text ltx_font_smallcaps" id="S3.p2.7.4">eoi</span>&gt; token to connect to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S3.p2.7.m2.1"><semantics id="S3.p2.7.m2.1a"><mi id="S3.p2.7.m2.1.1" xref="S3.p2.7.m2.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p2.7.m2.1b"><ci id="S3.p2.7.m2.1.1.cmml" xref="S3.p2.7.m2.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.7.m2.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.7.m2.1d">sansserif_suffix</annotation></semantics></math> accurately.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.p3">
<p class="ltx_p" id="S3.p3.2">Next-token prediction (NTP) training is conducted on the document <math alttext="D^{\prime}" class="ltx_Math" display="inline" id="S3.p3.1.m1.1"><semantics id="S3.p3.1.m1.1a"><msup id="S3.p3.1.m1.1.1" xref="S3.p3.1.m1.1.1.cmml"><mi id="S3.p3.1.m1.1.1.2" xref="S3.p3.1.m1.1.1.2.cmml">D</mi><mo id="S3.p3.1.m1.1.1.3" xref="S3.p3.1.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.p3.1.m1.1b"><apply id="S3.p3.1.m1.1.1.cmml" xref="S3.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S3.p3.1.m1.1.1.1.cmml" xref="S3.p3.1.m1.1.1">superscript</csymbol><ci id="S3.p3.1.m1.1.1.2.cmml" xref="S3.p3.1.m1.1.1.2">𝐷</ci><ci id="S3.p3.1.m1.1.1.3.cmml" xref="S3.p3.1.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.1.m1.1c">D^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.1.m1.1d">italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math>, whose goal is to minimize the following cross-entropy loss (where <math alttext="P_{\theta}" class="ltx_Math" display="inline" id="S3.p3.2.m2.1"><semantics id="S3.p3.2.m2.1a"><msub id="S3.p3.2.m2.1.1" xref="S3.p3.2.m2.1.1.cmml"><mi id="S3.p3.2.m2.1.1.2" xref="S3.p3.2.m2.1.1.2.cmml">P</mi><mi id="S3.p3.2.m2.1.1.3" xref="S3.p3.2.m2.1.1.3.cmml">θ</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p3.2.m2.1b"><apply id="S3.p3.2.m2.1.1.cmml" xref="S3.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S3.p3.2.m2.1.1.1.cmml" xref="S3.p3.2.m2.1.1">subscript</csymbol><ci id="S3.p3.2.m2.1.1.2.cmml" xref="S3.p3.2.m2.1.1.2">𝑃</ci><ci id="S3.p3.2.m2.1.1.3.cmml" xref="S3.p3.2.m2.1.1.3">𝜃</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p3.2.m2.1c">P_{\theta}</annotation><annotation encoding="application/x-llamapun" id="S3.p3.2.m2.1d">italic_P start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT</annotation></semantics></math> refers to LLMs being trained):</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}L_{NTP}=&amp;-\sum_{t=1}^{T-M+2}\log P_{\theta}(y_{t+1}|y_{1\cdots t}%
)\\
&amp;-\sum_{t=1}^{M-1}\log P_{\theta}(x_{P+t+1}|y_{1\cdots T-M+3},x_{P+1\cdots P+t%
})\\
&amp;-\log P_{\theta}(\text{&lt;}\textsc{eoi}\text{&gt;}|y_{1\cdots T-M+3},x_{P+1\cdots P%
+M}).\end{split}" class="ltx_Math" display="block" id="S3.E2.m1.52"><semantics id="S3.E2.m1.52a"><mtable columnspacing="0pt" displaystyle="true" id="S3.E2.m1.52.52.4" rowspacing="0pt"><mtr id="S3.E2.m1.52.52.4a"><mtd class="ltx_align_right" columnalign="right" id="S3.E2.m1.52.52.4b"><mrow id="S3.E2.m1.3.3.3.3.3"><msub id="S3.E2.m1.3.3.3.3.3.4"><mi id="S3.E2.m1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.cmml">L</mi><mrow id="S3.E2.m1.2.2.2.2.2.2.1" xref="S3.E2.m1.2.2.2.2.2.2.1.cmml"><mi id="S3.E2.m1.2.2.2.2.2.2.1.2" xref="S3.E2.m1.2.2.2.2.2.2.1.2.cmml">N</mi><mo id="S3.E2.m1.2.2.2.2.2.2.1.1" xref="S3.E2.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S3.E2.m1.2.2.2.2.2.2.1.3" xref="S3.E2.m1.2.2.2.2.2.2.1.3.cmml">T</mi><mo id="S3.E2.m1.2.2.2.2.2.2.1.1a" xref="S3.E2.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S3.E2.m1.2.2.2.2.2.2.1.4" xref="S3.E2.m1.2.2.2.2.2.2.1.4.cmml">P</mi></mrow></msub><mo id="S3.E2.m1.3.3.3.3.3.3" xref="S3.E2.m1.3.3.3.3.3.3.cmml">=</mo><mi id="S3.E2.m1.3.3.3.3.3.5" xref="S3.E2.m1.49.49.1.1.1.cmml"></mi></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E2.m1.52.52.4c"><mrow id="S3.E2.m1.50.50.2.49.18.15"><mo id="S3.E2.m1.50.50.2.49.18.15a" xref="S3.E2.m1.49.49.1.1.1.cmml">−</mo><mrow id="S3.E2.m1.50.50.2.49.18.15.15"><munderover id="S3.E2.m1.50.50.2.49.18.15.15.2"><mo id="S3.E2.m1.5.5.5.5.2.2" movablelimits="false" xref="S3.E2.m1.5.5.5.5.2.2.cmml">∑</mo><mrow id="S3.E2.m1.6.6.6.6.3.3.1" xref="S3.E2.m1.6.6.6.6.3.3.1.cmml"><mi id="S3.E2.m1.6.6.6.6.3.3.1.2" xref="S3.E2.m1.6.6.6.6.3.3.1.2.cmml">t</mi><mo id="S3.E2.m1.6.6.6.6.3.3.1.1" xref="S3.E2.m1.6.6.6.6.3.3.1.1.cmml">=</mo><mn id="S3.E2.m1.6.6.6.6.3.3.1.3" xref="S3.E2.m1.6.6.6.6.3.3.1.3.cmml">1</mn></mrow><mrow id="S3.E2.m1.7.7.7.7.4.4.1" xref="S3.E2.m1.7.7.7.7.4.4.1.cmml"><mrow id="S3.E2.m1.7.7.7.7.4.4.1.2" xref="S3.E2.m1.7.7.7.7.4.4.1.2.cmml"><mi id="S3.E2.m1.7.7.7.7.4.4.1.2.2" xref="S3.E2.m1.7.7.7.7.4.4.1.2.2.cmml">T</mi><mo id="S3.E2.m1.7.7.7.7.4.4.1.2.1" xref="S3.E2.m1.7.7.7.7.4.4.1.2.1.cmml">−</mo><mi id="S3.E2.m1.7.7.7.7.4.4.1.2.3" xref="S3.E2.m1.7.7.7.7.4.4.1.2.3.cmml">M</mi></mrow><mo id="S3.E2.m1.7.7.7.7.4.4.1.1" xref="S3.E2.m1.7.7.7.7.4.4.1.1.cmml">+</mo><mn id="S3.E2.m1.7.7.7.7.4.4.1.3" xref="S3.E2.m1.7.7.7.7.4.4.1.3.cmml">2</mn></mrow></munderover><mrow id="S3.E2.m1.50.50.2.49.18.15.15.1"><mrow id="S3.E2.m1.50.50.2.49.18.15.15.1.3"><mi id="S3.E2.m1.8.8.8.8.5.5" xref="S3.E2.m1.8.8.8.8.5.5.cmml">log</mi><mo id="S3.E2.m1.50.50.2.49.18.15.15.1.3a" lspace="0.167em" xref="S3.E2.m1.49.49.1.1.1.cmml">⁡</mo><msub id="S3.E2.m1.50.50.2.49.18.15.15.1.3.1"><mi id="S3.E2.m1.9.9.9.9.6.6" xref="S3.E2.m1.9.9.9.9.6.6.cmml">P</mi><mi id="S3.E2.m1.10.10.10.10.7.7.1" xref="S3.E2.m1.10.10.10.10.7.7.1.cmml">θ</mi></msub></mrow><mo id="S3.E2.m1.50.50.2.49.18.15.15.1.2" xref="S3.E2.m1.49.49.1.1.1.cmml">⁢</mo><mrow id="S3.E2.m1.50.50.2.49.18.15.15.1.1.1"><mo id="S3.E2.m1.11.11.11.11.8.8" stretchy="false" xref="S3.E2.m1.49.49.1.1.1.cmml">(</mo><mrow id="S3.E2.m1.50.50.2.49.18.15.15.1.1.1.1"><msub id="S3.E2.m1.50.50.2.49.18.15.15.1.1.1.1.1"><mi id="S3.E2.m1.12.12.12.12.9.9" xref="S3.E2.m1.12.12.12.12.9.9.cmml">y</mi><mrow id="S3.E2.m1.13.13.13.13.10.10.1" xref="S3.E2.m1.13.13.13.13.10.10.1.cmml"><mi id="S3.E2.m1.13.13.13.13.10.10.1.2" xref="S3.E2.m1.13.13.13.13.10.10.1.2.cmml">t</mi><mo id="S3.E2.m1.13.13.13.13.10.10.1.1" xref="S3.E2.m1.13.13.13.13.10.10.1.1.cmml">+</mo><mn id="S3.E2.m1.13.13.13.13.10.10.1.3" xref="S3.E2.m1.13.13.13.13.10.10.1.3.cmml">1</mn></mrow></msub><mo fence="false" id="S3.E2.m1.14.14.14.14.11.11" xref="S3.E2.m1.14.14.14.14.11.11.cmml">|</mo><msub id="S3.E2.m1.50.50.2.49.18.15.15.1.1.1.1.2"><mi id="S3.E2.m1.15.15.15.15.12.12" xref="S3.E2.m1.15.15.15.15.12.12.cmml">y</mi><mrow id="S3.E2.m1.16.16.16.16.13.13.1" xref="S3.E2.m1.16.16.16.16.13.13.1.cmml"><mn id="S3.E2.m1.16.16.16.16.13.13.1.2" xref="S3.E2.m1.16.16.16.16.13.13.1.2.cmml">1</mn><mo id="S3.E2.m1.16.16.16.16.13.13.1.1" xref="S3.E2.m1.16.16.16.16.13.13.1.1.cmml">⁢</mo><mi id="S3.E2.m1.16.16.16.16.13.13.1.3" mathvariant="normal" xref="S3.E2.m1.16.16.16.16.13.13.1.3.cmml">⋯</mi><mo id="S3.E2.m1.16.16.16.16.13.13.1.1a" xref="S3.E2.m1.16.16.16.16.13.13.1.1.cmml">⁢</mo><mi id="S3.E2.m1.16.16.16.16.13.13.1.4" xref="S3.E2.m1.16.16.16.16.13.13.1.4.cmml">t</mi></mrow></msub></mrow><mo id="S3.E2.m1.17.17.17.17.14.14" stretchy="false" xref="S3.E2.m1.49.49.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow></mtd></mtr><mtr id="S3.E2.m1.52.52.4d"><mtd id="S3.E2.m1.52.52.4e" xref="S3.E2.m1.49.49.1.1.1.cmml"></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E2.m1.52.52.4f"><mrow id="S3.E2.m1.51.51.3.50.18.18"><mo id="S3.E2.m1.51.51.3.50.18.18a" xref="S3.E2.m1.49.49.1.1.1.cmml">−</mo><mrow id="S3.E2.m1.51.51.3.50.18.18.18"><munderover id="S3.E2.m1.51.51.3.50.18.18.18.2"><mo id="S3.E2.m1.19.19.19.2.2.2" movablelimits="false" xref="S3.E2.m1.19.19.19.2.2.2.cmml">∑</mo><mrow id="S3.E2.m1.20.20.20.3.3.3.1" xref="S3.E2.m1.20.20.20.3.3.3.1.cmml"><mi id="S3.E2.m1.20.20.20.3.3.3.1.2" xref="S3.E2.m1.20.20.20.3.3.3.1.2.cmml">t</mi><mo id="S3.E2.m1.20.20.20.3.3.3.1.1" xref="S3.E2.m1.20.20.20.3.3.3.1.1.cmml">=</mo><mn id="S3.E2.m1.20.20.20.3.3.3.1.3" xref="S3.E2.m1.20.20.20.3.3.3.1.3.cmml">1</mn></mrow><mrow id="S3.E2.m1.21.21.21.4.4.4.1" xref="S3.E2.m1.21.21.21.4.4.4.1.cmml"><mi id="S3.E2.m1.21.21.21.4.4.4.1.2" xref="S3.E2.m1.21.21.21.4.4.4.1.2.cmml">M</mi><mo id="S3.E2.m1.21.21.21.4.4.4.1.1" xref="S3.E2.m1.21.21.21.4.4.4.1.1.cmml">−</mo><mn id="S3.E2.m1.21.21.21.4.4.4.1.3" xref="S3.E2.m1.21.21.21.4.4.4.1.3.cmml">1</mn></mrow></munderover><mrow id="S3.E2.m1.51.51.3.50.18.18.18.1"><mrow id="S3.E2.m1.51.51.3.50.18.18.18.1.3"><mi id="S3.E2.m1.22.22.22.5.5.5" xref="S3.E2.m1.22.22.22.5.5.5.cmml">log</mi><mo id="S3.E2.m1.51.51.3.50.18.18.18.1.3a" lspace="0.167em" xref="S3.E2.m1.49.49.1.1.1.cmml">⁡</mo><msub id="S3.E2.m1.51.51.3.50.18.18.18.1.3.1"><mi id="S3.E2.m1.23.23.23.6.6.6" xref="S3.E2.m1.23.23.23.6.6.6.cmml">P</mi><mi id="S3.E2.m1.24.24.24.7.7.7.1" xref="S3.E2.m1.24.24.24.7.7.7.1.cmml">θ</mi></msub></mrow><mo id="S3.E2.m1.51.51.3.50.18.18.18.1.2" xref="S3.E2.m1.49.49.1.1.1.cmml">⁢</mo><mrow id="S3.E2.m1.51.51.3.50.18.18.18.1.1.1"><mo id="S3.E2.m1.25.25.25.8.8.8" stretchy="false" xref="S3.E2.m1.49.49.1.1.1.cmml">(</mo><mrow id="S3.E2.m1.51.51.3.50.18.18.18.1.1.1.1"><msub id="S3.E2.m1.51.51.3.50.18.18.18.1.1.1.1.3"><mi id="S3.E2.m1.26.26.26.9.9.9" xref="S3.E2.m1.26.26.26.9.9.9.cmml">x</mi><mrow id="S3.E2.m1.27.27.27.10.10.10.1" xref="S3.E2.m1.27.27.27.10.10.10.1.cmml"><mi id="S3.E2.m1.27.27.27.10.10.10.1.2" xref="S3.E2.m1.27.27.27.10.10.10.1.2.cmml">P</mi><mo id="S3.E2.m1.27.27.27.10.10.10.1.1" xref="S3.E2.m1.27.27.27.10.10.10.1.1.cmml">+</mo><mi id="S3.E2.m1.27.27.27.10.10.10.1.3" xref="S3.E2.m1.27.27.27.10.10.10.1.3.cmml">t</mi><mo id="S3.E2.m1.27.27.27.10.10.10.1.1a" xref="S3.E2.m1.27.27.27.10.10.10.1.1.cmml">+</mo><mn id="S3.E2.m1.27.27.27.10.10.10.1.4" xref="S3.E2.m1.27.27.27.10.10.10.1.4.cmml">1</mn></mrow></msub><mo fence="false" id="S3.E2.m1.28.28.28.11.11.11" xref="S3.E2.m1.28.28.28.11.11.11.cmml">|</mo><mrow id="S3.E2.m1.51.51.3.50.18.18.18.1.1.1.1.2.2"><msub id="S3.E2.m1.51.51.3.50.18.18.18.1.1.1.1.1.1.1"><mi id="S3.E2.m1.29.29.29.12.12.12" xref="S3.E2.m1.29.29.29.12.12.12.cmml">y</mi><mrow id="S3.E2.m1.30.30.30.13.13.13.1" xref="S3.E2.m1.30.30.30.13.13.13.1.cmml"><mrow id="S3.E2.m1.30.30.30.13.13.13.1.2" xref="S3.E2.m1.30.30.30.13.13.13.1.2.cmml"><mrow id="S3.E2.m1.30.30.30.13.13.13.1.2.2" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.cmml"><mn id="S3.E2.m1.30.30.30.13.13.13.1.2.2.2" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.2.cmml">1</mn><mo id="S3.E2.m1.30.30.30.13.13.13.1.2.2.1" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.1.cmml">⁢</mo><mi id="S3.E2.m1.30.30.30.13.13.13.1.2.2.3" mathvariant="normal" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.3.cmml">⋯</mi><mo id="S3.E2.m1.30.30.30.13.13.13.1.2.2.1a" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.1.cmml">⁢</mo><mi id="S3.E2.m1.30.30.30.13.13.13.1.2.2.4" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.4.cmml">T</mi></mrow><mo id="S3.E2.m1.30.30.30.13.13.13.1.2.1" xref="S3.E2.m1.30.30.30.13.13.13.1.2.1.cmml">−</mo><mi id="S3.E2.m1.30.30.30.13.13.13.1.2.3" xref="S3.E2.m1.30.30.30.13.13.13.1.2.3.cmml">M</mi></mrow><mo id="S3.E2.m1.30.30.30.13.13.13.1.1" xref="S3.E2.m1.30.30.30.13.13.13.1.1.cmml">+</mo><mn id="S3.E2.m1.30.30.30.13.13.13.1.3" xref="S3.E2.m1.30.30.30.13.13.13.1.3.cmml">3</mn></mrow></msub><mo id="S3.E2.m1.31.31.31.14.14.14" xref="S3.E2.m1.49.49.1.1.1.cmml">,</mo><msub id="S3.E2.m1.51.51.3.50.18.18.18.1.1.1.1.2.2.2"><mi id="S3.E2.m1.32.32.32.15.15.15" xref="S3.E2.m1.32.32.32.15.15.15.cmml">x</mi><mrow id="S3.E2.m1.33.33.33.16.16.16.1" xref="S3.E2.m1.33.33.33.16.16.16.1.cmml"><mi id="S3.E2.m1.33.33.33.16.16.16.1.2" xref="S3.E2.m1.33.33.33.16.16.16.1.2.cmml">P</mi><mo id="S3.E2.m1.33.33.33.16.16.16.1.1" xref="S3.E2.m1.33.33.33.16.16.16.1.1.cmml">+</mo><mrow id="S3.E2.m1.33.33.33.16.16.16.1.3" xref="S3.E2.m1.33.33.33.16.16.16.1.3.cmml"><mn id="S3.E2.m1.33.33.33.16.16.16.1.3.2" xref="S3.E2.m1.33.33.33.16.16.16.1.3.2.cmml">1</mn><mo id="S3.E2.m1.33.33.33.16.16.16.1.3.1" xref="S3.E2.m1.33.33.33.16.16.16.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.33.33.33.16.16.16.1.3.3" mathvariant="normal" xref="S3.E2.m1.33.33.33.16.16.16.1.3.3.cmml">⋯</mi><mo id="S3.E2.m1.33.33.33.16.16.16.1.3.1a" xref="S3.E2.m1.33.33.33.16.16.16.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.33.33.33.16.16.16.1.3.4" xref="S3.E2.m1.33.33.33.16.16.16.1.3.4.cmml">P</mi></mrow><mo id="S3.E2.m1.33.33.33.16.16.16.1.1a" xref="S3.E2.m1.33.33.33.16.16.16.1.1.cmml">+</mo><mi id="S3.E2.m1.33.33.33.16.16.16.1.4" xref="S3.E2.m1.33.33.33.16.16.16.1.4.cmml">t</mi></mrow></msub></mrow></mrow><mo id="S3.E2.m1.34.34.34.17.17.17" stretchy="false" xref="S3.E2.m1.49.49.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow></mtd></mtr><mtr id="S3.E2.m1.52.52.4g"><mtd id="S3.E2.m1.52.52.4h" xref="S3.E2.m1.49.49.1.1.1.cmml"></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E2.m1.52.52.4i"><mrow id="S3.E2.m1.52.52.4.51.15.15.15"><mrow id="S3.E2.m1.52.52.4.51.15.15.15.1"><mo id="S3.E2.m1.52.52.4.51.15.15.15.1a" rspace="0.167em" xref="S3.E2.m1.49.49.1.1.1.cmml">−</mo><mrow id="S3.E2.m1.52.52.4.51.15.15.15.1.1"><mrow id="S3.E2.m1.52.52.4.51.15.15.15.1.1.3"><mi id="S3.E2.m1.36.36.36.2.2.2" xref="S3.E2.m1.36.36.36.2.2.2.cmml">log</mi><mo id="S3.E2.m1.52.52.4.51.15.15.15.1.1.3a" lspace="0.167em" xref="S3.E2.m1.49.49.1.1.1.cmml">⁡</mo><msub id="S3.E2.m1.52.52.4.51.15.15.15.1.1.3.1"><mi id="S3.E2.m1.37.37.37.3.3.3" xref="S3.E2.m1.37.37.37.3.3.3.cmml">P</mi><mi id="S3.E2.m1.38.38.38.4.4.4.1" xref="S3.E2.m1.38.38.38.4.4.4.1.cmml">θ</mi></msub></mrow><mo id="S3.E2.m1.52.52.4.51.15.15.15.1.1.2" xref="S3.E2.m1.49.49.1.1.1.cmml">⁢</mo><mrow id="S3.E2.m1.52.52.4.51.15.15.15.1.1.1.1"><mo id="S3.E2.m1.39.39.39.5.5.5" stretchy="false" xref="S3.E2.m1.49.49.1.1.1.cmml">(</mo><mrow id="S3.E2.m1.52.52.4.51.15.15.15.1.1.1.1.1"><mrow id="S3.E2.m1.40.40.40.6.6.6" xref="S3.E2.m1.40.40.40.6.6.6d.cmml"><mtext id="S3.E2.m1.40.40.40.6.6.6a" xref="S3.E2.m1.40.40.40.6.6.6d.cmml">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E2.m1.40.40.40.6.6.6b" xref="S3.E2.m1.40.40.40.6.6.6d.cmml">eoi</mtext><mtext id="S3.E2.m1.40.40.40.6.6.6c" xref="S3.E2.m1.40.40.40.6.6.6d.cmml">&gt;</mtext></mrow><mo fence="false" id="S3.E2.m1.41.41.41.7.7.7" xref="S3.E2.m1.41.41.41.7.7.7.cmml">|</mo><mrow id="S3.E2.m1.52.52.4.51.15.15.15.1.1.1.1.1.2.2"><msub id="S3.E2.m1.52.52.4.51.15.15.15.1.1.1.1.1.1.1.1"><mi id="S3.E2.m1.42.42.42.8.8.8" xref="S3.E2.m1.42.42.42.8.8.8.cmml">y</mi><mrow id="S3.E2.m1.43.43.43.9.9.9.1" xref="S3.E2.m1.43.43.43.9.9.9.1.cmml"><mrow id="S3.E2.m1.43.43.43.9.9.9.1.2" xref="S3.E2.m1.43.43.43.9.9.9.1.2.cmml"><mrow id="S3.E2.m1.43.43.43.9.9.9.1.2.2" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.cmml"><mn id="S3.E2.m1.43.43.43.9.9.9.1.2.2.2" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.2.cmml">1</mn><mo id="S3.E2.m1.43.43.43.9.9.9.1.2.2.1" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.1.cmml">⁢</mo><mi id="S3.E2.m1.43.43.43.9.9.9.1.2.2.3" mathvariant="normal" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.3.cmml">⋯</mi><mo id="S3.E2.m1.43.43.43.9.9.9.1.2.2.1a" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.1.cmml">⁢</mo><mi id="S3.E2.m1.43.43.43.9.9.9.1.2.2.4" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.4.cmml">T</mi></mrow><mo id="S3.E2.m1.43.43.43.9.9.9.1.2.1" xref="S3.E2.m1.43.43.43.9.9.9.1.2.1.cmml">−</mo><mi id="S3.E2.m1.43.43.43.9.9.9.1.2.3" xref="S3.E2.m1.43.43.43.9.9.9.1.2.3.cmml">M</mi></mrow><mo id="S3.E2.m1.43.43.43.9.9.9.1.1" xref="S3.E2.m1.43.43.43.9.9.9.1.1.cmml">+</mo><mn id="S3.E2.m1.43.43.43.9.9.9.1.3" xref="S3.E2.m1.43.43.43.9.9.9.1.3.cmml">3</mn></mrow></msub><mo id="S3.E2.m1.44.44.44.10.10.10" xref="S3.E2.m1.49.49.1.1.1.cmml">,</mo><msub id="S3.E2.m1.52.52.4.51.15.15.15.1.1.1.1.1.2.2.2"><mi id="S3.E2.m1.45.45.45.11.11.11" xref="S3.E2.m1.45.45.45.11.11.11.cmml">x</mi><mrow id="S3.E2.m1.46.46.46.12.12.12.1" xref="S3.E2.m1.46.46.46.12.12.12.1.cmml"><mi id="S3.E2.m1.46.46.46.12.12.12.1.2" xref="S3.E2.m1.46.46.46.12.12.12.1.2.cmml">P</mi><mo id="S3.E2.m1.46.46.46.12.12.12.1.1" xref="S3.E2.m1.46.46.46.12.12.12.1.1.cmml">+</mo><mrow id="S3.E2.m1.46.46.46.12.12.12.1.3" xref="S3.E2.m1.46.46.46.12.12.12.1.3.cmml"><mn id="S3.E2.m1.46.46.46.12.12.12.1.3.2" xref="S3.E2.m1.46.46.46.12.12.12.1.3.2.cmml">1</mn><mo id="S3.E2.m1.46.46.46.12.12.12.1.3.1" xref="S3.E2.m1.46.46.46.12.12.12.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.46.46.46.12.12.12.1.3.3" mathvariant="normal" xref="S3.E2.m1.46.46.46.12.12.12.1.3.3.cmml">⋯</mi><mo id="S3.E2.m1.46.46.46.12.12.12.1.3.1a" xref="S3.E2.m1.46.46.46.12.12.12.1.3.1.cmml">⁢</mo><mi id="S3.E2.m1.46.46.46.12.12.12.1.3.4" xref="S3.E2.m1.46.46.46.12.12.12.1.3.4.cmml">P</mi></mrow><mo id="S3.E2.m1.46.46.46.12.12.12.1.1a" xref="S3.E2.m1.46.46.46.12.12.12.1.1.cmml">+</mo><mi id="S3.E2.m1.46.46.46.12.12.12.1.4" xref="S3.E2.m1.46.46.46.12.12.12.1.4.cmml">M</mi></mrow></msub></mrow></mrow><mo id="S3.E2.m1.47.47.47.13.13.13" stretchy="false" xref="S3.E2.m1.49.49.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E2.m1.48.48.48.14.14.14" lspace="0em" xref="S3.E2.m1.49.49.1.1.1.cmml">.</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E2.m1.52b"><apply id="S3.E2.m1.49.49.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><eq id="S3.E2.m1.3.3.3.3.3.3.cmml" xref="S3.E2.m1.3.3.3.3.3.3"></eq><apply id="S3.E2.m1.49.49.1.1.1.5.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.5.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1">𝐿</ci><apply id="S3.E2.m1.2.2.2.2.2.2.1.cmml" xref="S3.E2.m1.2.2.2.2.2.2.1"><times id="S3.E2.m1.2.2.2.2.2.2.1.1.cmml" xref="S3.E2.m1.2.2.2.2.2.2.1.1"></times><ci id="S3.E2.m1.2.2.2.2.2.2.1.2.cmml" xref="S3.E2.m1.2.2.2.2.2.2.1.2">𝑁</ci><ci id="S3.E2.m1.2.2.2.2.2.2.1.3.cmml" xref="S3.E2.m1.2.2.2.2.2.2.1.3">𝑇</ci><ci id="S3.E2.m1.2.2.2.2.2.2.1.4.cmml" xref="S3.E2.m1.2.2.2.2.2.2.1.4">𝑃</ci></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.3.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><minus id="S3.E2.m1.18.18.18.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"></minus><apply id="S3.E2.m1.49.49.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><minus id="S3.E2.m1.4.4.4.4.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"></minus><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.1.1.1.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">superscript</csymbol><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.2.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><sum id="S3.E2.m1.5.5.5.5.2.2.cmml" xref="S3.E2.m1.5.5.5.5.2.2"></sum><apply id="S3.E2.m1.6.6.6.6.3.3.1.cmml" xref="S3.E2.m1.6.6.6.6.3.3.1"><eq id="S3.E2.m1.6.6.6.6.3.3.1.1.cmml" xref="S3.E2.m1.6.6.6.6.3.3.1.1"></eq><ci id="S3.E2.m1.6.6.6.6.3.3.1.2.cmml" xref="S3.E2.m1.6.6.6.6.3.3.1.2">𝑡</ci><cn id="S3.E2.m1.6.6.6.6.3.3.1.3.cmml" type="integer" xref="S3.E2.m1.6.6.6.6.3.3.1.3">1</cn></apply></apply><apply id="S3.E2.m1.7.7.7.7.4.4.1.cmml" xref="S3.E2.m1.7.7.7.7.4.4.1"><plus id="S3.E2.m1.7.7.7.7.4.4.1.1.cmml" xref="S3.E2.m1.7.7.7.7.4.4.1.1"></plus><apply id="S3.E2.m1.7.7.7.7.4.4.1.2.cmml" xref="S3.E2.m1.7.7.7.7.4.4.1.2"><minus id="S3.E2.m1.7.7.7.7.4.4.1.2.1.cmml" xref="S3.E2.m1.7.7.7.7.4.4.1.2.1"></minus><ci id="S3.E2.m1.7.7.7.7.4.4.1.2.2.cmml" xref="S3.E2.m1.7.7.7.7.4.4.1.2.2">𝑇</ci><ci id="S3.E2.m1.7.7.7.7.4.4.1.2.3.cmml" xref="S3.E2.m1.7.7.7.7.4.4.1.2.3">𝑀</ci></apply><cn id="S3.E2.m1.7.7.7.7.4.4.1.3.cmml" type="integer" xref="S3.E2.m1.7.7.7.7.4.4.1.3">2</cn></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><times id="S3.E2.m1.49.49.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"></times><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><log id="S3.E2.m1.8.8.8.8.5.5.cmml" xref="S3.E2.m1.8.8.8.8.5.5"></log><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.1.1.1.1.3.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.9.9.9.9.6.6.cmml" xref="S3.E2.m1.9.9.9.9.6.6">𝑃</ci><ci id="S3.E2.m1.10.10.10.10.7.7.1.cmml" xref="S3.E2.m1.10.10.10.10.7.7.1">𝜃</ci></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="latexml" id="S3.E2.m1.14.14.14.14.11.11.cmml" xref="S3.E2.m1.14.14.14.14.11.11">conditional</csymbol><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.12.12.12.12.9.9.cmml" xref="S3.E2.m1.12.12.12.12.9.9">𝑦</ci><apply id="S3.E2.m1.13.13.13.13.10.10.1.cmml" xref="S3.E2.m1.13.13.13.13.10.10.1"><plus id="S3.E2.m1.13.13.13.13.10.10.1.1.cmml" xref="S3.E2.m1.13.13.13.13.10.10.1.1"></plus><ci id="S3.E2.m1.13.13.13.13.10.10.1.2.cmml" xref="S3.E2.m1.13.13.13.13.10.10.1.2">𝑡</ci><cn id="S3.E2.m1.13.13.13.13.10.10.1.3.cmml" type="integer" xref="S3.E2.m1.13.13.13.13.10.10.1.3">1</cn></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.15.15.15.15.12.12.cmml" xref="S3.E2.m1.15.15.15.15.12.12">𝑦</ci><apply id="S3.E2.m1.16.16.16.16.13.13.1.cmml" xref="S3.E2.m1.16.16.16.16.13.13.1"><times id="S3.E2.m1.16.16.16.16.13.13.1.1.cmml" xref="S3.E2.m1.16.16.16.16.13.13.1.1"></times><cn id="S3.E2.m1.16.16.16.16.13.13.1.2.cmml" type="integer" xref="S3.E2.m1.16.16.16.16.13.13.1.2">1</cn><ci id="S3.E2.m1.16.16.16.16.13.13.1.3.cmml" xref="S3.E2.m1.16.16.16.16.13.13.1.3">⋯</ci><ci id="S3.E2.m1.16.16.16.16.13.13.1.4.cmml" xref="S3.E2.m1.16.16.16.16.13.13.1.4">𝑡</ci></apply></apply></apply></apply></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.2.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><apply id="S3.E2.m1.49.49.1.1.1.2.2.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.2.2.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">superscript</csymbol><apply id="S3.E2.m1.49.49.1.1.1.2.2.2.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.2.2.2.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><sum id="S3.E2.m1.19.19.19.2.2.2.cmml" xref="S3.E2.m1.19.19.19.2.2.2"></sum><apply id="S3.E2.m1.20.20.20.3.3.3.1.cmml" xref="S3.E2.m1.20.20.20.3.3.3.1"><eq id="S3.E2.m1.20.20.20.3.3.3.1.1.cmml" xref="S3.E2.m1.20.20.20.3.3.3.1.1"></eq><ci id="S3.E2.m1.20.20.20.3.3.3.1.2.cmml" xref="S3.E2.m1.20.20.20.3.3.3.1.2">𝑡</ci><cn id="S3.E2.m1.20.20.20.3.3.3.1.3.cmml" type="integer" xref="S3.E2.m1.20.20.20.3.3.3.1.3">1</cn></apply></apply><apply id="S3.E2.m1.21.21.21.4.4.4.1.cmml" xref="S3.E2.m1.21.21.21.4.4.4.1"><minus id="S3.E2.m1.21.21.21.4.4.4.1.1.cmml" xref="S3.E2.m1.21.21.21.4.4.4.1.1"></minus><ci id="S3.E2.m1.21.21.21.4.4.4.1.2.cmml" xref="S3.E2.m1.21.21.21.4.4.4.1.2">𝑀</ci><cn id="S3.E2.m1.21.21.21.4.4.4.1.3.cmml" type="integer" xref="S3.E2.m1.21.21.21.4.4.4.1.3">1</cn></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.2.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><times id="S3.E2.m1.49.49.1.1.1.2.2.1.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"></times><apply id="S3.E2.m1.49.49.1.1.1.2.2.1.3.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><log id="S3.E2.m1.22.22.22.5.5.5.cmml" xref="S3.E2.m1.22.22.22.5.5.5"></log><apply id="S3.E2.m1.49.49.1.1.1.2.2.1.3.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.2.2.1.3.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.23.23.23.6.6.6.cmml" xref="S3.E2.m1.23.23.23.6.6.6">𝑃</ci><ci id="S3.E2.m1.24.24.24.7.7.7.1.cmml" xref="S3.E2.m1.24.24.24.7.7.7.1">𝜃</ci></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.2.2.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="latexml" id="S3.E2.m1.28.28.28.11.11.11.cmml" xref="S3.E2.m1.28.28.28.11.11.11">conditional</csymbol><apply id="S3.E2.m1.49.49.1.1.1.2.2.1.1.1.1.4.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.2.2.1.1.1.1.4.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.26.26.26.9.9.9.cmml" xref="S3.E2.m1.26.26.26.9.9.9">𝑥</ci><apply id="S3.E2.m1.27.27.27.10.10.10.1.cmml" xref="S3.E2.m1.27.27.27.10.10.10.1"><plus id="S3.E2.m1.27.27.27.10.10.10.1.1.cmml" xref="S3.E2.m1.27.27.27.10.10.10.1.1"></plus><ci id="S3.E2.m1.27.27.27.10.10.10.1.2.cmml" xref="S3.E2.m1.27.27.27.10.10.10.1.2">𝑃</ci><ci id="S3.E2.m1.27.27.27.10.10.10.1.3.cmml" xref="S3.E2.m1.27.27.27.10.10.10.1.3">𝑡</ci><cn id="S3.E2.m1.27.27.27.10.10.10.1.4.cmml" type="integer" xref="S3.E2.m1.27.27.27.10.10.10.1.4">1</cn></apply></apply><list id="S3.E2.m1.49.49.1.1.1.2.2.1.1.1.1.2.3.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><apply id="S3.E2.m1.49.49.1.1.1.2.2.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.29.29.29.12.12.12.cmml" xref="S3.E2.m1.29.29.29.12.12.12">𝑦</ci><apply id="S3.E2.m1.30.30.30.13.13.13.1.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1"><plus id="S3.E2.m1.30.30.30.13.13.13.1.1.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1.1"></plus><apply id="S3.E2.m1.30.30.30.13.13.13.1.2.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1.2"><minus id="S3.E2.m1.30.30.30.13.13.13.1.2.1.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1.2.1"></minus><apply id="S3.E2.m1.30.30.30.13.13.13.1.2.2.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2"><times id="S3.E2.m1.30.30.30.13.13.13.1.2.2.1.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.1"></times><cn id="S3.E2.m1.30.30.30.13.13.13.1.2.2.2.cmml" type="integer" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.2">1</cn><ci id="S3.E2.m1.30.30.30.13.13.13.1.2.2.3.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.3">⋯</ci><ci id="S3.E2.m1.30.30.30.13.13.13.1.2.2.4.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1.2.2.4">𝑇</ci></apply><ci id="S3.E2.m1.30.30.30.13.13.13.1.2.3.cmml" xref="S3.E2.m1.30.30.30.13.13.13.1.2.3">𝑀</ci></apply><cn id="S3.E2.m1.30.30.30.13.13.13.1.3.cmml" type="integer" xref="S3.E2.m1.30.30.30.13.13.13.1.3">3</cn></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.2.2.1.1.1.1.2.2.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.2.2.1.1.1.1.2.2.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.32.32.32.15.15.15.cmml" xref="S3.E2.m1.32.32.32.15.15.15">𝑥</ci><apply id="S3.E2.m1.33.33.33.16.16.16.1.cmml" xref="S3.E2.m1.33.33.33.16.16.16.1"><plus id="S3.E2.m1.33.33.33.16.16.16.1.1.cmml" xref="S3.E2.m1.33.33.33.16.16.16.1.1"></plus><ci id="S3.E2.m1.33.33.33.16.16.16.1.2.cmml" xref="S3.E2.m1.33.33.33.16.16.16.1.2">𝑃</ci><apply id="S3.E2.m1.33.33.33.16.16.16.1.3.cmml" xref="S3.E2.m1.33.33.33.16.16.16.1.3"><times id="S3.E2.m1.33.33.33.16.16.16.1.3.1.cmml" xref="S3.E2.m1.33.33.33.16.16.16.1.3.1"></times><cn id="S3.E2.m1.33.33.33.16.16.16.1.3.2.cmml" type="integer" xref="S3.E2.m1.33.33.33.16.16.16.1.3.2">1</cn><ci id="S3.E2.m1.33.33.33.16.16.16.1.3.3.cmml" xref="S3.E2.m1.33.33.33.16.16.16.1.3.3">⋯</ci><ci id="S3.E2.m1.33.33.33.16.16.16.1.3.4.cmml" xref="S3.E2.m1.33.33.33.16.16.16.1.3.4">𝑃</ci></apply><ci id="S3.E2.m1.33.33.33.16.16.16.1.4.cmml" xref="S3.E2.m1.33.33.33.16.16.16.1.4">𝑡</ci></apply></apply></list></apply></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.3.3.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><times id="S3.E2.m1.49.49.1.1.1.3.3.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"></times><apply id="S3.E2.m1.49.49.1.1.1.3.3.3.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><log id="S3.E2.m1.36.36.36.2.2.2.cmml" xref="S3.E2.m1.36.36.36.2.2.2"></log><apply id="S3.E2.m1.49.49.1.1.1.3.3.3.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.3.3.3.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.37.37.37.3.3.3.cmml" xref="S3.E2.m1.37.37.37.3.3.3">𝑃</ci><ci id="S3.E2.m1.38.38.38.4.4.4.1.cmml" xref="S3.E2.m1.38.38.38.4.4.4.1">𝜃</ci></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.3.3.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="latexml" id="S3.E2.m1.41.41.41.7.7.7.cmml" xref="S3.E2.m1.41.41.41.7.7.7">conditional</csymbol><ci id="S3.E2.m1.40.40.40.6.6.6d.cmml" xref="S3.E2.m1.40.40.40.6.6.6"><mrow id="S3.E2.m1.40.40.40.6.6.6.cmml" xref="S3.E2.m1.40.40.40.6.6.6"><mtext id="S3.E2.m1.40.40.40.6.6.6a.cmml" xref="S3.E2.m1.40.40.40.6.6.6">&lt;</mtext><mtext class="ltx_font_smallcaps" id="S3.E2.m1.40.40.40.6.6.6b.cmml" xref="S3.E2.m1.40.40.40.6.6.6">eoi</mtext><mtext id="S3.E2.m1.40.40.40.6.6.6c.cmml" xref="S3.E2.m1.40.40.40.6.6.6">&gt;</mtext></mrow></ci><list id="S3.E2.m1.49.49.1.1.1.3.3.1.1.1.2.3.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><apply id="S3.E2.m1.49.49.1.1.1.3.3.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.3.3.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.42.42.42.8.8.8.cmml" xref="S3.E2.m1.42.42.42.8.8.8">𝑦</ci><apply id="S3.E2.m1.43.43.43.9.9.9.1.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1"><plus id="S3.E2.m1.43.43.43.9.9.9.1.1.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1.1"></plus><apply id="S3.E2.m1.43.43.43.9.9.9.1.2.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1.2"><minus id="S3.E2.m1.43.43.43.9.9.9.1.2.1.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1.2.1"></minus><apply id="S3.E2.m1.43.43.43.9.9.9.1.2.2.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2"><times id="S3.E2.m1.43.43.43.9.9.9.1.2.2.1.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.1"></times><cn id="S3.E2.m1.43.43.43.9.9.9.1.2.2.2.cmml" type="integer" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.2">1</cn><ci id="S3.E2.m1.43.43.43.9.9.9.1.2.2.3.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.3">⋯</ci><ci id="S3.E2.m1.43.43.43.9.9.9.1.2.2.4.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1.2.2.4">𝑇</ci></apply><ci id="S3.E2.m1.43.43.43.9.9.9.1.2.3.cmml" xref="S3.E2.m1.43.43.43.9.9.9.1.2.3">𝑀</ci></apply><cn id="S3.E2.m1.43.43.43.9.9.9.1.3.cmml" type="integer" xref="S3.E2.m1.43.43.43.9.9.9.1.3">3</cn></apply></apply><apply id="S3.E2.m1.49.49.1.1.1.3.3.1.1.1.2.2.2.cmml" xref="S3.E2.m1.3.3.3.3.3.5"><csymbol cd="ambiguous" id="S3.E2.m1.49.49.1.1.1.3.3.1.1.1.2.2.2.1.cmml" xref="S3.E2.m1.3.3.3.3.3.5">subscript</csymbol><ci id="S3.E2.m1.45.45.45.11.11.11.cmml" xref="S3.E2.m1.45.45.45.11.11.11">𝑥</ci><apply id="S3.E2.m1.46.46.46.12.12.12.1.cmml" xref="S3.E2.m1.46.46.46.12.12.12.1"><plus id="S3.E2.m1.46.46.46.12.12.12.1.1.cmml" xref="S3.E2.m1.46.46.46.12.12.12.1.1"></plus><ci id="S3.E2.m1.46.46.46.12.12.12.1.2.cmml" xref="S3.E2.m1.46.46.46.12.12.12.1.2">𝑃</ci><apply id="S3.E2.m1.46.46.46.12.12.12.1.3.cmml" xref="S3.E2.m1.46.46.46.12.12.12.1.3"><times id="S3.E2.m1.46.46.46.12.12.12.1.3.1.cmml" xref="S3.E2.m1.46.46.46.12.12.12.1.3.1"></times><cn id="S3.E2.m1.46.46.46.12.12.12.1.3.2.cmml" type="integer" xref="S3.E2.m1.46.46.46.12.12.12.1.3.2">1</cn><ci id="S3.E2.m1.46.46.46.12.12.12.1.3.3.cmml" xref="S3.E2.m1.46.46.46.12.12.12.1.3.3">⋯</ci><ci id="S3.E2.m1.46.46.46.12.12.12.1.3.4.cmml" xref="S3.E2.m1.46.46.46.12.12.12.1.3.4">𝑃</ci></apply><ci id="S3.E2.m1.46.46.46.12.12.12.1.4.cmml" xref="S3.E2.m1.46.46.46.12.12.12.1.4">𝑀</ci></apply></apply></list></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.52c">\begin{split}L_{NTP}=&amp;-\sum_{t=1}^{T-M+2}\log P_{\theta}(y_{t+1}|y_{1\cdots t}%
)\\
&amp;-\sum_{t=1}^{M-1}\log P_{\theta}(x_{P+t+1}|y_{1\cdots T-M+3},x_{P+1\cdots P+t%
})\\
&amp;-\log P_{\theta}(\text{&lt;}\textsc{eoi}\text{&gt;}|y_{1\cdots T-M+3},x_{P+1\cdots P%
+M}).\end{split}</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.52d">start_ROW start_CELL italic_L start_POSTSUBSCRIPT italic_N italic_T italic_P end_POSTSUBSCRIPT = end_CELL start_CELL - ∑ start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_T - italic_M + 2 end_POSTSUPERSCRIPT roman_log italic_P start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_y start_POSTSUBSCRIPT italic_t + 1 end_POSTSUBSCRIPT | italic_y start_POSTSUBSCRIPT 1 ⋯ italic_t end_POSTSUBSCRIPT ) end_CELL end_ROW start_ROW start_CELL end_CELL start_CELL - ∑ start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_M - 1 end_POSTSUPERSCRIPT roman_log italic_P start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( italic_x start_POSTSUBSCRIPT italic_P + italic_t + 1 end_POSTSUBSCRIPT | italic_y start_POSTSUBSCRIPT 1 ⋯ italic_T - italic_M + 3 end_POSTSUBSCRIPT , italic_x start_POSTSUBSCRIPT italic_P + 1 ⋯ italic_P + italic_t end_POSTSUBSCRIPT ) end_CELL end_ROW start_ROW start_CELL end_CELL start_CELL - roman_log italic_P start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ( &lt; smallcaps_eoi &gt; | italic_y start_POSTSUBSCRIPT 1 ⋯ italic_T - italic_M + 3 end_POSTSUBSCRIPT , italic_x start_POSTSUBSCRIPT italic_P + 1 ⋯ italic_P + italic_M end_POSTSUBSCRIPT ) . end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para ltx_noindent" id="S3.p4">
<p class="ltx_p" id="S3.p4.2">While NTP has provided LLMs with necessary supervision signals to learn Fill-in-the-Middle (<em class="ltx_emph ltx_font_italic" id="S3.p4.2.1">i.e.,</em> starting generation to match <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S3.p4.1.m1.1"><semantics id="S3.p4.1.m1.1a"><mi id="S3.p4.1.m1.1.1" xref="S3.p4.1.m1.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p4.1.m1.1b"><ci id="S3.p4.1.m1.1.1.cmml" xref="S3.p4.1.m1.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.1.m1.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S3.p4.1.m1.1d">sansserif_prefix</annotation></semantics></math> and stopping at the right place to connect to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S3.p4.2.m2.1"><semantics id="S3.p4.2.m2.1a"><mi id="S3.p4.2.m2.1.1" xref="S3.p4.2.m2.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p4.2.m2.1b"><ci id="S3.p4.2.m2.1.1.cmml" xref="S3.p4.2.m2.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p4.2.m2.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S3.p4.2.m2.1d">sansserif_suffix</annotation></semantics></math>), it is shown in our analysis (§<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S2" title="2 Post-processing for Fill-in-the-Middle ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">2</span></a>) that LLMs trained with NTP alone do not learn this task well in practice. This is likely due to models trained with NTP only learns to predict with a horizon length of only 1 (<em class="ltx_emph ltx_font_italic" id="S3.p4.2.2">i.e.,</em> next token), and thus infilling which typically requires planning over a much longer horizon length could not be learnt effectively.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.p5">
<p class="ltx_p" id="S3.p5.1"><span class="ltx_text ltx_font_bold" id="S3.p5.1.1">Horizon-Length Prediction (HLP)</span>. To mitigate this issue, we propose adding an auxiliary training objective, namely horizon-length prediction (HLP), to improve the planning capabilities of LLMs over long horizons. Specifically, given the hidden state of current token, the model is tasked by HLP to predict the number of future tokens required to complete <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.p5.1.m1.1"><semantics id="S3.p5.1.m1.1a"><mi id="S3.p5.1.m1.1.1" xref="S3.p5.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.p5.1.m1.1b"><ci id="S3.p5.1.m1.1.1.cmml" xref="S3.p5.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p5.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.p5.1.m1.1d">sansserif_middle</annotation></semantics></math>, as shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S3.F3" title="Figure 3 ‣ 3 Horizon-Length Prediction ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">3</span></a>.</p>
</div>
<figure class="ltx_figure" id="S3.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="371" id="S3.F3.g1" src="x3.png" width="830"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span>Overview of Horizon-Length Prediction (HLP). In this example, we set the length of <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.F3.4.m1.1"><semantics id="S3.F3.4.m1.1b"><mi id="S3.F3.4.m1.1.1" xref="S3.F3.4.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.F3.4.m1.1c"><ci id="S3.F3.4.m1.1.1.cmml" xref="S3.F3.4.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F3.4.m1.1d">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.F3.4.m1.1e">sansserif_middle</annotation></semantics></math> to five tokens. Following the flow of arrows, we illustrate how the second token of <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.F3.5.m2.1"><semantics id="S3.F3.5.m2.1b"><mi id="S3.F3.5.m2.1.1" xref="S3.F3.5.m2.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.F3.5.m2.1c"><ci id="S3.F3.5.m2.1.1.cmml" xref="S3.F3.5.m2.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F3.5.m2.1d">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.F3.5.m2.1e">sansserif_middle</annotation></semantics></math> (<em class="ltx_emph ltx_font_italic" id="S3.F3.8.1">i.e.,</em> "<math alttext="x_{2}" class="ltx_Math" display="inline" id="S3.F3.6.m3.1"><semantics id="S3.F3.6.m3.1b"><msub id="S3.F3.6.m3.1.1" xref="S3.F3.6.m3.1.1.cmml"><mi id="S3.F3.6.m3.1.1.2" xref="S3.F3.6.m3.1.1.2.cmml">x</mi><mn id="S3.F3.6.m3.1.1.3" xref="S3.F3.6.m3.1.1.3.cmml">2</mn></msub><annotation-xml encoding="MathML-Content" id="S3.F3.6.m3.1c"><apply id="S3.F3.6.m3.1.1.cmml" xref="S3.F3.6.m3.1.1"><csymbol cd="ambiguous" id="S3.F3.6.m3.1.1.1.cmml" xref="S3.F3.6.m3.1.1">subscript</csymbol><ci id="S3.F3.6.m3.1.1.2.cmml" xref="S3.F3.6.m3.1.1.2">𝑥</ci><cn id="S3.F3.6.m3.1.1.3.cmml" type="integer" xref="S3.F3.6.m3.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F3.6.m3.1d">x_{2}</annotation><annotation encoding="application/x-llamapun" id="S3.F3.6.m3.1e">italic_x start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT</annotation></semantics></math>") is processed through both next-token prediction objective and horizon-length prediction objective.
</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S3.p6">
<p class="ltx_p" id="S3.p6.14">In detail, the FIM-style document <math alttext="D^{\prime}" class="ltx_Math" display="inline" id="S3.p6.1.m1.1"><semantics id="S3.p6.1.m1.1a"><msup id="S3.p6.1.m1.1.1" xref="S3.p6.1.m1.1.1.cmml"><mi id="S3.p6.1.m1.1.1.2" xref="S3.p6.1.m1.1.1.2.cmml">D</mi><mo id="S3.p6.1.m1.1.1.3" xref="S3.p6.1.m1.1.1.3.cmml">′</mo></msup><annotation-xml encoding="MathML-Content" id="S3.p6.1.m1.1b"><apply id="S3.p6.1.m1.1.1.cmml" xref="S3.p6.1.m1.1.1"><csymbol cd="ambiguous" id="S3.p6.1.m1.1.1.1.cmml" xref="S3.p6.1.m1.1.1">superscript</csymbol><ci id="S3.p6.1.m1.1.1.2.cmml" xref="S3.p6.1.m1.1.1.2">𝐷</ci><ci id="S3.p6.1.m1.1.1.3.cmml" xref="S3.p6.1.m1.1.1.3">′</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.1.m1.1c">D^{\prime}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.1.m1.1d">italic_D start_POSTSUPERSCRIPT ′ end_POSTSUPERSCRIPT</annotation></semantics></math> defined in Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S3.E1" title="In 3 Horizon-Length Prediction ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">1</span></a>) contains three different parts, including <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S3.p6.2.m2.1"><semantics id="S3.p6.2.m2.1a"><mi id="S3.p6.2.m2.1.1" xref="S3.p6.2.m2.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p6.2.m2.1b"><ci id="S3.p6.2.m2.1.1.cmml" xref="S3.p6.2.m2.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.2.m2.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.2.m2.1d">sansserif_prefix</annotation></semantics></math>, <span class="ltx_text ltx_markedasmath" id="S3.p6.3.m3.1.1.1"><math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S3.p6.3.m3.1.1.1.m1.1"><semantics id="S3.p6.3.m3.1.1.1.m1.1a"><mi id="S3.p6.3.m3.1.1.1.m1.1.1" xref="S3.p6.3.m3.1.1.1.m1.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S3.p6.3.m3.1.1.1.m1.1b"><ci id="S3.p6.3.m3.1.1.1.m1.1.1.cmml" xref="S3.p6.3.m3.1.1.1.m1.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.3.m3.1.1.1.m1.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.3.m3.1.1.1.m1.1d">sansserif_suffix</annotation></semantics></math></span>, and <span class="ltx_text ltx_markedasmath" id="S3.p6.4.m4.1.1.1"><math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.p6.4.m4.1.1.1.m1.1"><semantics id="S3.p6.4.m4.1.1.1.m1.1a"><mi id="S3.p6.4.m4.1.1.1.m1.1.1" xref="S3.p6.4.m4.1.1.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.p6.4.m4.1.1.1.m1.1b"><ci id="S3.p6.4.m4.1.1.1.m1.1.1.cmml" xref="S3.p6.4.m4.1.1.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.4.m4.1.1.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.4.m4.1.1.1.m1.1d">sansserif_middle</annotation></semantics></math></span>, and HLP is applied to <span class="ltx_text ltx_markedasmath" id="S3.p6.5.m5.1.1.1"><math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.p6.5.m5.1.1.1.m1.1"><semantics id="S3.p6.5.m5.1.1.1.m1.1a"><mi id="S3.p6.5.m5.1.1.1.m1.1.1" xref="S3.p6.5.m5.1.1.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.p6.5.m5.1.1.1.m1.1b"><ci id="S3.p6.5.m5.1.1.1.m1.1.1.cmml" xref="S3.p6.5.m5.1.1.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.5.m5.1.1.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.5.m5.1.1.1.m1.1d">sansserif_middle</annotation></semantics></math></span> part as it is the major focus of FIM tasks. Recall that <span class="ltx_text ltx_markedasmath" id="S3.p6.6.m6.1.1.1"><math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.p6.6.m6.1.1.1.m1.1"><semantics id="S3.p6.6.m6.1.1.1.m1.1a"><mi id="S3.p6.6.m6.1.1.1.m1.1.1" xref="S3.p6.6.m6.1.1.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.p6.6.m6.1.1.1.m1.1b"><ci id="S3.p6.6.m6.1.1.1.m1.1.1.cmml" xref="S3.p6.6.m6.1.1.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.6.m6.1.1.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.6.m6.1.1.1.m1.1d">sansserif_middle</annotation></semantics></math></span> has <math alttext="M" class="ltx_Math" display="inline" id="S3.p6.7.m7.1"><semantics id="S3.p6.7.m7.1a"><mi id="S3.p6.7.m7.1.1" xref="S3.p6.7.m7.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S3.p6.7.m7.1b"><ci id="S3.p6.7.m7.1.1.cmml" xref="S3.p6.7.m7.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.7.m7.1c">M</annotation><annotation encoding="application/x-llamapun" id="S3.p6.7.m7.1d">italic_M</annotation></semantics></math> tokens, ranging from <math alttext="x_{P+1}" class="ltx_Math" display="inline" id="S3.p6.8.m8.1"><semantics id="S3.p6.8.m8.1a"><msub id="S3.p6.8.m8.1.1" xref="S3.p6.8.m8.1.1.cmml"><mi id="S3.p6.8.m8.1.1.2" xref="S3.p6.8.m8.1.1.2.cmml">x</mi><mrow id="S3.p6.8.m8.1.1.3" xref="S3.p6.8.m8.1.1.3.cmml"><mi id="S3.p6.8.m8.1.1.3.2" xref="S3.p6.8.m8.1.1.3.2.cmml">P</mi><mo id="S3.p6.8.m8.1.1.3.1" xref="S3.p6.8.m8.1.1.3.1.cmml">+</mo><mn id="S3.p6.8.m8.1.1.3.3" xref="S3.p6.8.m8.1.1.3.3.cmml">1</mn></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.p6.8.m8.1b"><apply id="S3.p6.8.m8.1.1.cmml" xref="S3.p6.8.m8.1.1"><csymbol cd="ambiguous" id="S3.p6.8.m8.1.1.1.cmml" xref="S3.p6.8.m8.1.1">subscript</csymbol><ci id="S3.p6.8.m8.1.1.2.cmml" xref="S3.p6.8.m8.1.1.2">𝑥</ci><apply id="S3.p6.8.m8.1.1.3.cmml" xref="S3.p6.8.m8.1.1.3"><plus id="S3.p6.8.m8.1.1.3.1.cmml" xref="S3.p6.8.m8.1.1.3.1"></plus><ci id="S3.p6.8.m8.1.1.3.2.cmml" xref="S3.p6.8.m8.1.1.3.2">𝑃</ci><cn id="S3.p6.8.m8.1.1.3.3.cmml" type="integer" xref="S3.p6.8.m8.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.8.m8.1c">x_{P+1}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.8.m8.1d">italic_x start_POSTSUBSCRIPT italic_P + 1 end_POSTSUBSCRIPT</annotation></semantics></math> to <math alttext="x_{P+M}" class="ltx_Math" display="inline" id="S3.p6.9.m9.1"><semantics id="S3.p6.9.m9.1a"><msub id="S3.p6.9.m9.1.1" xref="S3.p6.9.m9.1.1.cmml"><mi id="S3.p6.9.m9.1.1.2" xref="S3.p6.9.m9.1.1.2.cmml">x</mi><mrow id="S3.p6.9.m9.1.1.3" xref="S3.p6.9.m9.1.1.3.cmml"><mi id="S3.p6.9.m9.1.1.3.2" xref="S3.p6.9.m9.1.1.3.2.cmml">P</mi><mo id="S3.p6.9.m9.1.1.3.1" xref="S3.p6.9.m9.1.1.3.1.cmml">+</mo><mi id="S3.p6.9.m9.1.1.3.3" xref="S3.p6.9.m9.1.1.3.3.cmml">M</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.p6.9.m9.1b"><apply id="S3.p6.9.m9.1.1.cmml" xref="S3.p6.9.m9.1.1"><csymbol cd="ambiguous" id="S3.p6.9.m9.1.1.1.cmml" xref="S3.p6.9.m9.1.1">subscript</csymbol><ci id="S3.p6.9.m9.1.1.2.cmml" xref="S3.p6.9.m9.1.1.2">𝑥</ci><apply id="S3.p6.9.m9.1.1.3.cmml" xref="S3.p6.9.m9.1.1.3"><plus id="S3.p6.9.m9.1.1.3.1.cmml" xref="S3.p6.9.m9.1.1.3.1"></plus><ci id="S3.p6.9.m9.1.1.3.2.cmml" xref="S3.p6.9.m9.1.1.3.2">𝑃</ci><ci id="S3.p6.9.m9.1.1.3.3.cmml" xref="S3.p6.9.m9.1.1.3.3">𝑀</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.9.m9.1c">x_{P+M}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.9.m9.1d">italic_x start_POSTSUBSCRIPT italic_P + italic_M end_POSTSUBSCRIPT</annotation></semantics></math>. At each position <math alttext="t\in[1,M]" class="ltx_Math" display="inline" id="S3.p6.10.m10.2"><semantics id="S3.p6.10.m10.2a"><mrow id="S3.p6.10.m10.2.3" xref="S3.p6.10.m10.2.3.cmml"><mi id="S3.p6.10.m10.2.3.2" xref="S3.p6.10.m10.2.3.2.cmml">t</mi><mo id="S3.p6.10.m10.2.3.1" xref="S3.p6.10.m10.2.3.1.cmml">∈</mo><mrow id="S3.p6.10.m10.2.3.3.2" xref="S3.p6.10.m10.2.3.3.1.cmml"><mo id="S3.p6.10.m10.2.3.3.2.1" stretchy="false" xref="S3.p6.10.m10.2.3.3.1.cmml">[</mo><mn id="S3.p6.10.m10.1.1" xref="S3.p6.10.m10.1.1.cmml">1</mn><mo id="S3.p6.10.m10.2.3.3.2.2" xref="S3.p6.10.m10.2.3.3.1.cmml">,</mo><mi id="S3.p6.10.m10.2.2" xref="S3.p6.10.m10.2.2.cmml">M</mi><mo id="S3.p6.10.m10.2.3.3.2.3" stretchy="false" xref="S3.p6.10.m10.2.3.3.1.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p6.10.m10.2b"><apply id="S3.p6.10.m10.2.3.cmml" xref="S3.p6.10.m10.2.3"><in id="S3.p6.10.m10.2.3.1.cmml" xref="S3.p6.10.m10.2.3.1"></in><ci id="S3.p6.10.m10.2.3.2.cmml" xref="S3.p6.10.m10.2.3.2">𝑡</ci><interval closure="closed" id="S3.p6.10.m10.2.3.3.1.cmml" xref="S3.p6.10.m10.2.3.3.2"><cn id="S3.p6.10.m10.1.1.cmml" type="integer" xref="S3.p6.10.m10.1.1">1</cn><ci id="S3.p6.10.m10.2.2.cmml" xref="S3.p6.10.m10.2.2">𝑀</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.10.m10.2c">t\in[1,M]</annotation><annotation encoding="application/x-llamapun" id="S3.p6.10.m10.2d">italic_t ∈ [ 1 , italic_M ]</annotation></semantics></math> in <span class="ltx_text ltx_markedasmath" id="S3.p6.11.m11.1.1.1"><math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.p6.11.m11.1.1.1.m1.1"><semantics id="S3.p6.11.m11.1.1.1.m1.1a"><mi id="S3.p6.11.m11.1.1.1.m1.1.1" xref="S3.p6.11.m11.1.1.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.p6.11.m11.1.1.1.m1.1b"><ci id="S3.p6.11.m11.1.1.1.m1.1.1.cmml" xref="S3.p6.11.m11.1.1.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.11.m11.1.1.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.11.m11.1.1.1.m1.1d">sansserif_middle</annotation></semantics></math></span>, HLP aims to predict the number of future tokens required to complete the <span class="ltx_text ltx_markedasmath" id="S3.p6.12.m12.1.1.1"><math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S3.p6.12.m12.1.1.1.m1.1"><semantics id="S3.p6.12.m12.1.1.1.m1.1a"><mi id="S3.p6.12.m12.1.1.1.m1.1.1" xref="S3.p6.12.m12.1.1.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S3.p6.12.m12.1.1.1.m1.1b"><ci id="S3.p6.12.m12.1.1.1.m1.1.1.cmml" xref="S3.p6.12.m12.1.1.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.12.m12.1.1.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S3.p6.12.m12.1.1.1.m1.1d">sansserif_middle</annotation></semantics></math></span>, which is <math alttext="M-t" class="ltx_Math" display="inline" id="S3.p6.13.m13.1"><semantics id="S3.p6.13.m13.1a"><mrow id="S3.p6.13.m13.1.1" xref="S3.p6.13.m13.1.1.cmml"><mi id="S3.p6.13.m13.1.1.2" xref="S3.p6.13.m13.1.1.2.cmml">M</mi><mo id="S3.p6.13.m13.1.1.1" xref="S3.p6.13.m13.1.1.1.cmml">−</mo><mi id="S3.p6.13.m13.1.1.3" xref="S3.p6.13.m13.1.1.3.cmml">t</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.p6.13.m13.1b"><apply id="S3.p6.13.m13.1.1.cmml" xref="S3.p6.13.m13.1.1"><minus id="S3.p6.13.m13.1.1.1.cmml" xref="S3.p6.13.m13.1.1.1"></minus><ci id="S3.p6.13.m13.1.1.2.cmml" xref="S3.p6.13.m13.1.1.2">𝑀</ci><ci id="S3.p6.13.m13.1.1.3.cmml" xref="S3.p6.13.m13.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.13.m13.1c">M-t</annotation><annotation encoding="application/x-llamapun" id="S3.p6.13.m13.1d">italic_M - italic_t</annotation></semantics></math>. Considering that the context window size of LLMs can be infinite in theory and so is <math alttext="M-t" class="ltx_Math" display="inline" id="S3.p6.14.m14.1"><semantics id="S3.p6.14.m14.1a"><mrow id="S3.p6.14.m14.1.1" xref="S3.p6.14.m14.1.1.cmml"><mi id="S3.p6.14.m14.1.1.2" xref="S3.p6.14.m14.1.1.2.cmml">M</mi><mo id="S3.p6.14.m14.1.1.1" xref="S3.p6.14.m14.1.1.1.cmml">−</mo><mi id="S3.p6.14.m14.1.1.3" xref="S3.p6.14.m14.1.1.3.cmml">t</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.p6.14.m14.1b"><apply id="S3.p6.14.m14.1.1.cmml" xref="S3.p6.14.m14.1.1"><minus id="S3.p6.14.m14.1.1.1.cmml" xref="S3.p6.14.m14.1.1.1"></minus><ci id="S3.p6.14.m14.1.1.2.cmml" xref="S3.p6.14.m14.1.1.2">𝑀</ci><ci id="S3.p6.14.m14.1.1.3.cmml" xref="S3.p6.14.m14.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.14.m14.1c">M-t</annotation><annotation encoding="application/x-llamapun" id="S3.p6.14.m14.1d">italic_M - italic_t</annotation></semantics></math>, instead of formatting HLP as a classification task with a fixed set of discrete values as labels, we make it a regression problem by taking the normalized count of future tokens as the target:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}y_{t}=\frac{M-t}{M}\in(0,1].\end{split}" class="ltx_Math" display="block" id="S3.E3.m1.13"><semantics id="S3.E3.m1.13a"><mtable displaystyle="true" id="S3.E3.m1.13.13.2"><mtr id="S3.E3.m1.13.13.2a"><mtd class="ltx_align_right" columnalign="right" id="S3.E3.m1.13.13.2b"><mrow id="S3.E3.m1.13.13.2.12.12.12.12"><mrow id="S3.E3.m1.13.13.2.12.12.12.12.1"><msub id="S3.E3.m1.13.13.2.12.12.12.12.1.2"><mi id="S3.E3.m1.1.1.1.1.1.1" xref="S3.E3.m1.1.1.1.1.1.1.cmml">y</mi><mi id="S3.E3.m1.2.2.2.2.2.2.1" xref="S3.E3.m1.2.2.2.2.2.2.1.cmml">t</mi></msub><mo id="S3.E3.m1.3.3.3.3.3.3" xref="S3.E3.m1.3.3.3.3.3.3.cmml">=</mo><mfrac id="S3.E3.m1.4.4.4.4.4.4" xref="S3.E3.m1.4.4.4.4.4.4.cmml"><mrow id="S3.E3.m1.4.4.4.4.4.4.2" xref="S3.E3.m1.4.4.4.4.4.4.2.cmml"><mi id="S3.E3.m1.4.4.4.4.4.4.2.2" xref="S3.E3.m1.4.4.4.4.4.4.2.2.cmml">M</mi><mo id="S3.E3.m1.4.4.4.4.4.4.2.1" xref="S3.E3.m1.4.4.4.4.4.4.2.1.cmml">−</mo><mi id="S3.E3.m1.4.4.4.4.4.4.2.3" xref="S3.E3.m1.4.4.4.4.4.4.2.3.cmml">t</mi></mrow><mi id="S3.E3.m1.4.4.4.4.4.4.3" xref="S3.E3.m1.4.4.4.4.4.4.3.cmml">M</mi></mfrac><mo id="S3.E3.m1.5.5.5.5.5.5" xref="S3.E3.m1.5.5.5.5.5.5.cmml">∈</mo><mrow id="S3.E3.m1.13.13.2.12.12.12.12.1.3"><mo id="S3.E3.m1.6.6.6.6.6.6" stretchy="false" xref="S3.E3.m1.12.12.1.1.1.cmml">(</mo><mn id="S3.E3.m1.7.7.7.7.7.7" xref="S3.E3.m1.7.7.7.7.7.7.cmml">0</mn><mo id="S3.E3.m1.8.8.8.8.8.8" xref="S3.E3.m1.12.12.1.1.1.cmml">,</mo><mn id="S3.E3.m1.9.9.9.9.9.9" xref="S3.E3.m1.9.9.9.9.9.9.cmml">1</mn><mo id="S3.E3.m1.10.10.10.10.10.10" stretchy="false" xref="S3.E3.m1.12.12.1.1.1.cmml">]</mo></mrow></mrow><mo id="S3.E3.m1.11.11.11.11.11.11" lspace="0em" xref="S3.E3.m1.12.12.1.1.1.cmml">.</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E3.m1.13b"><apply id="S3.E3.m1.12.12.1.1.1.cmml" xref="S3.E3.m1.6.6.6.6.6.6"><and id="S3.E3.m1.12.12.1.1.1a.cmml" xref="S3.E3.m1.6.6.6.6.6.6"></and><apply id="S3.E3.m1.12.12.1.1.1b.cmml" xref="S3.E3.m1.6.6.6.6.6.6"><eq id="S3.E3.m1.3.3.3.3.3.3.cmml" xref="S3.E3.m1.3.3.3.3.3.3"></eq><apply id="S3.E3.m1.12.12.1.1.1.2.cmml" xref="S3.E3.m1.6.6.6.6.6.6"><csymbol cd="ambiguous" id="S3.E3.m1.12.12.1.1.1.2.1.cmml" xref="S3.E3.m1.6.6.6.6.6.6">subscript</csymbol><ci id="S3.E3.m1.1.1.1.1.1.1.cmml" xref="S3.E3.m1.1.1.1.1.1.1">𝑦</ci><ci id="S3.E3.m1.2.2.2.2.2.2.1.cmml" xref="S3.E3.m1.2.2.2.2.2.2.1">𝑡</ci></apply><apply id="S3.E3.m1.4.4.4.4.4.4.cmml" xref="S3.E3.m1.4.4.4.4.4.4"><divide id="S3.E3.m1.4.4.4.4.4.4.1.cmml" xref="S3.E3.m1.4.4.4.4.4.4"></divide><apply id="S3.E3.m1.4.4.4.4.4.4.2.cmml" xref="S3.E3.m1.4.4.4.4.4.4.2"><minus id="S3.E3.m1.4.4.4.4.4.4.2.1.cmml" xref="S3.E3.m1.4.4.4.4.4.4.2.1"></minus><ci id="S3.E3.m1.4.4.4.4.4.4.2.2.cmml" xref="S3.E3.m1.4.4.4.4.4.4.2.2">𝑀</ci><ci id="S3.E3.m1.4.4.4.4.4.4.2.3.cmml" xref="S3.E3.m1.4.4.4.4.4.4.2.3">𝑡</ci></apply><ci id="S3.E3.m1.4.4.4.4.4.4.3.cmml" xref="S3.E3.m1.4.4.4.4.4.4.3">𝑀</ci></apply></apply><apply id="S3.E3.m1.12.12.1.1.1c.cmml" xref="S3.E3.m1.6.6.6.6.6.6"><in id="S3.E3.m1.5.5.5.5.5.5.cmml" xref="S3.E3.m1.5.5.5.5.5.5"></in><share href="https://arxiv.org/html/2410.03103v1#S3.E3.m1.12.12.1.1.1.4.cmml" id="S3.E3.m1.12.12.1.1.1d.cmml" xref="S3.E3.m1.6.6.6.6.6.6"></share><interval closure="open-closed" id="S3.E3.m1.12.12.1.1.1.6.cmml" xref="S3.E3.m1.6.6.6.6.6.6"><cn id="S3.E3.m1.7.7.7.7.7.7.cmml" type="integer" xref="S3.E3.m1.7.7.7.7.7.7">0</cn><cn id="S3.E3.m1.9.9.9.9.9.9.cmml" type="integer" xref="S3.E3.m1.9.9.9.9.9.9">1</cn></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E3.m1.13c">\begin{split}y_{t}=\frac{M-t}{M}\in(0,1].\end{split}</annotation><annotation encoding="application/x-llamapun" id="S3.E3.m1.13d">start_ROW start_CELL italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT = divide start_ARG italic_M - italic_t end_ARG start_ARG italic_M end_ARG ∈ ( 0 , 1 ] . end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p6.15">As such, the target is always within the <math alttext="(0,1]" class="ltx_Math" display="inline" id="S3.p6.15.m1.2"><semantics id="S3.p6.15.m1.2a"><mrow id="S3.p6.15.m1.2.3.2" xref="S3.p6.15.m1.2.3.1.cmml"><mo id="S3.p6.15.m1.2.3.2.1" stretchy="false" xref="S3.p6.15.m1.2.3.1.cmml">(</mo><mn id="S3.p6.15.m1.1.1" xref="S3.p6.15.m1.1.1.cmml">0</mn><mo id="S3.p6.15.m1.2.3.2.2" xref="S3.p6.15.m1.2.3.1.cmml">,</mo><mn id="S3.p6.15.m1.2.2" xref="S3.p6.15.m1.2.2.cmml">1</mn><mo id="S3.p6.15.m1.2.3.2.3" stretchy="false" xref="S3.p6.15.m1.2.3.1.cmml">]</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.p6.15.m1.2b"><interval closure="open-closed" id="S3.p6.15.m1.2.3.1.cmml" xref="S3.p6.15.m1.2.3.2"><cn id="S3.p6.15.m1.1.1.cmml" type="integer" xref="S3.p6.15.m1.1.1">0</cn><cn id="S3.p6.15.m1.2.2.cmml" type="integer" xref="S3.p6.15.m1.2.2">1</cn></interval></annotation-xml><annotation encoding="application/x-tex" id="S3.p6.15.m1.2c">(0,1]</annotation><annotation encoding="application/x-llamapun" id="S3.p6.15.m1.2d">( 0 , 1 ]</annotation></semantics></math> interval regardless of the model’s context window size.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.p7">
<p class="ltx_p" id="S3.p7.7">HLP is implemented as a linear layer on top of the transformer model (<em class="ltx_emph ltx_font_italic" id="S3.p7.7.1">i.e.,</em> <math alttext="\mathsf{hlp\_head}" class="ltx_Math" display="inline" id="S3.p7.1.m1.1"><semantics id="S3.p7.1.m1.1a"><mrow id="S3.p7.1.m1.1.1" xref="S3.p7.1.m1.1.1.cmml"><mi id="S3.p7.1.m1.1.1.2" xref="S3.p7.1.m1.1.1.2.cmml">𝗁𝗅𝗉</mi><mo id="S3.p7.1.m1.1.1.1" xref="S3.p7.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.p7.1.m1.1.1.3" mathvariant="normal" xref="S3.p7.1.m1.1.1.3.cmml">_</mi><mo id="S3.p7.1.m1.1.1.1a" xref="S3.p7.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.p7.1.m1.1.1.4" xref="S3.p7.1.m1.1.1.4.cmml">𝗁𝖾𝖺𝖽</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.p7.1.m1.1b"><apply id="S3.p7.1.m1.1.1.cmml" xref="S3.p7.1.m1.1.1"><times id="S3.p7.1.m1.1.1.1.cmml" xref="S3.p7.1.m1.1.1.1"></times><ci id="S3.p7.1.m1.1.1.2.cmml" xref="S3.p7.1.m1.1.1.2">𝗁𝗅𝗉</ci><ci id="S3.p7.1.m1.1.1.3.cmml" xref="S3.p7.1.m1.1.1.3">_</ci><ci id="S3.p7.1.m1.1.1.4.cmml" xref="S3.p7.1.m1.1.1.4">𝗁𝖾𝖺𝖽</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p7.1.m1.1c">\mathsf{hlp\_head}</annotation><annotation encoding="application/x-llamapun" id="S3.p7.1.m1.1d">sansserif_hlp _ sansserif_head</annotation></semantics></math> in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S3.F3" title="Figure 3 ‣ 3 Horizon-Length Prediction ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">3</span></a>) with weight <math alttext="w_{hlp}" class="ltx_Math" display="inline" id="S3.p7.2.m2.1"><semantics id="S3.p7.2.m2.1a"><msub id="S3.p7.2.m2.1.1" xref="S3.p7.2.m2.1.1.cmml"><mi id="S3.p7.2.m2.1.1.2" xref="S3.p7.2.m2.1.1.2.cmml">w</mi><mrow id="S3.p7.2.m2.1.1.3" xref="S3.p7.2.m2.1.1.3.cmml"><mi id="S3.p7.2.m2.1.1.3.2" xref="S3.p7.2.m2.1.1.3.2.cmml">h</mi><mo id="S3.p7.2.m2.1.1.3.1" xref="S3.p7.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.p7.2.m2.1.1.3.3" xref="S3.p7.2.m2.1.1.3.3.cmml">l</mi><mo id="S3.p7.2.m2.1.1.3.1a" xref="S3.p7.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.p7.2.m2.1.1.3.4" xref="S3.p7.2.m2.1.1.3.4.cmml">p</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.p7.2.m2.1b"><apply id="S3.p7.2.m2.1.1.cmml" xref="S3.p7.2.m2.1.1"><csymbol cd="ambiguous" id="S3.p7.2.m2.1.1.1.cmml" xref="S3.p7.2.m2.1.1">subscript</csymbol><ci id="S3.p7.2.m2.1.1.2.cmml" xref="S3.p7.2.m2.1.1.2">𝑤</ci><apply id="S3.p7.2.m2.1.1.3.cmml" xref="S3.p7.2.m2.1.1.3"><times id="S3.p7.2.m2.1.1.3.1.cmml" xref="S3.p7.2.m2.1.1.3.1"></times><ci id="S3.p7.2.m2.1.1.3.2.cmml" xref="S3.p7.2.m2.1.1.3.2">ℎ</ci><ci id="S3.p7.2.m2.1.1.3.3.cmml" xref="S3.p7.2.m2.1.1.3.3">𝑙</ci><ci id="S3.p7.2.m2.1.1.3.4.cmml" xref="S3.p7.2.m2.1.1.3.4">𝑝</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p7.2.m2.1c">w_{hlp}</annotation><annotation encoding="application/x-llamapun" id="S3.p7.2.m2.1d">italic_w start_POSTSUBSCRIPT italic_h italic_l italic_p end_POSTSUBSCRIPT</annotation></semantics></math>, whose input is the hidden state <math alttext="h_{t}" class="ltx_Math" display="inline" id="S3.p7.3.m3.1"><semantics id="S3.p7.3.m3.1a"><msub id="S3.p7.3.m3.1.1" xref="S3.p7.3.m3.1.1.cmml"><mi id="S3.p7.3.m3.1.1.2" xref="S3.p7.3.m3.1.1.2.cmml">h</mi><mi id="S3.p7.3.m3.1.1.3" xref="S3.p7.3.m3.1.1.3.cmml">t</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p7.3.m3.1b"><apply id="S3.p7.3.m3.1.1.cmml" xref="S3.p7.3.m3.1.1"><csymbol cd="ambiguous" id="S3.p7.3.m3.1.1.1.cmml" xref="S3.p7.3.m3.1.1">subscript</csymbol><ci id="S3.p7.3.m3.1.1.2.cmml" xref="S3.p7.3.m3.1.1.2">ℎ</ci><ci id="S3.p7.3.m3.1.1.3.cmml" xref="S3.p7.3.m3.1.1.3">𝑡</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p7.3.m3.1c">h_{t}</annotation><annotation encoding="application/x-llamapun" id="S3.p7.3.m3.1d">italic_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> from the last attention layer. The output <math alttext="w_{hlp}^{\top}h_{t}" class="ltx_Math" display="inline" id="S3.p7.4.m4.1"><semantics id="S3.p7.4.m4.1a"><mrow id="S3.p7.4.m4.1.1" xref="S3.p7.4.m4.1.1.cmml"><msubsup id="S3.p7.4.m4.1.1.2" xref="S3.p7.4.m4.1.1.2.cmml"><mi id="S3.p7.4.m4.1.1.2.2.2" xref="S3.p7.4.m4.1.1.2.2.2.cmml">w</mi><mrow id="S3.p7.4.m4.1.1.2.2.3" xref="S3.p7.4.m4.1.1.2.2.3.cmml"><mi id="S3.p7.4.m4.1.1.2.2.3.2" xref="S3.p7.4.m4.1.1.2.2.3.2.cmml">h</mi><mo id="S3.p7.4.m4.1.1.2.2.3.1" xref="S3.p7.4.m4.1.1.2.2.3.1.cmml">⁢</mo><mi id="S3.p7.4.m4.1.1.2.2.3.3" xref="S3.p7.4.m4.1.1.2.2.3.3.cmml">l</mi><mo id="S3.p7.4.m4.1.1.2.2.3.1a" xref="S3.p7.4.m4.1.1.2.2.3.1.cmml">⁢</mo><mi id="S3.p7.4.m4.1.1.2.2.3.4" xref="S3.p7.4.m4.1.1.2.2.3.4.cmml">p</mi></mrow><mo id="S3.p7.4.m4.1.1.2.3" xref="S3.p7.4.m4.1.1.2.3.cmml">⊤</mo></msubsup><mo id="S3.p7.4.m4.1.1.1" xref="S3.p7.4.m4.1.1.1.cmml">⁢</mo><msub id="S3.p7.4.m4.1.1.3" xref="S3.p7.4.m4.1.1.3.cmml"><mi id="S3.p7.4.m4.1.1.3.2" xref="S3.p7.4.m4.1.1.3.2.cmml">h</mi><mi id="S3.p7.4.m4.1.1.3.3" xref="S3.p7.4.m4.1.1.3.3.cmml">t</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.p7.4.m4.1b"><apply id="S3.p7.4.m4.1.1.cmml" xref="S3.p7.4.m4.1.1"><times id="S3.p7.4.m4.1.1.1.cmml" xref="S3.p7.4.m4.1.1.1"></times><apply id="S3.p7.4.m4.1.1.2.cmml" xref="S3.p7.4.m4.1.1.2"><csymbol cd="ambiguous" id="S3.p7.4.m4.1.1.2.1.cmml" xref="S3.p7.4.m4.1.1.2">superscript</csymbol><apply id="S3.p7.4.m4.1.1.2.2.cmml" xref="S3.p7.4.m4.1.1.2"><csymbol cd="ambiguous" id="S3.p7.4.m4.1.1.2.2.1.cmml" xref="S3.p7.4.m4.1.1.2">subscript</csymbol><ci id="S3.p7.4.m4.1.1.2.2.2.cmml" xref="S3.p7.4.m4.1.1.2.2.2">𝑤</ci><apply id="S3.p7.4.m4.1.1.2.2.3.cmml" xref="S3.p7.4.m4.1.1.2.2.3"><times id="S3.p7.4.m4.1.1.2.2.3.1.cmml" xref="S3.p7.4.m4.1.1.2.2.3.1"></times><ci id="S3.p7.4.m4.1.1.2.2.3.2.cmml" xref="S3.p7.4.m4.1.1.2.2.3.2">ℎ</ci><ci id="S3.p7.4.m4.1.1.2.2.3.3.cmml" xref="S3.p7.4.m4.1.1.2.2.3.3">𝑙</ci><ci id="S3.p7.4.m4.1.1.2.2.3.4.cmml" xref="S3.p7.4.m4.1.1.2.2.3.4">𝑝</ci></apply></apply><csymbol cd="latexml" id="S3.p7.4.m4.1.1.2.3.cmml" xref="S3.p7.4.m4.1.1.2.3">top</csymbol></apply><apply id="S3.p7.4.m4.1.1.3.cmml" xref="S3.p7.4.m4.1.1.3"><csymbol cd="ambiguous" id="S3.p7.4.m4.1.1.3.1.cmml" xref="S3.p7.4.m4.1.1.3">subscript</csymbol><ci id="S3.p7.4.m4.1.1.3.2.cmml" xref="S3.p7.4.m4.1.1.3.2">ℎ</ci><ci id="S3.p7.4.m4.1.1.3.3.cmml" xref="S3.p7.4.m4.1.1.3.3">𝑡</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p7.4.m4.1c">w_{hlp}^{\top}h_{t}</annotation><annotation encoding="application/x-llamapun" id="S3.p7.4.m4.1d">italic_w start_POSTSUBSCRIPT italic_h italic_l italic_p end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT italic_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT</annotation></semantics></math> is converted to a value between <math alttext="0" class="ltx_Math" display="inline" id="S3.p7.5.m5.1"><semantics id="S3.p7.5.m5.1a"><mn id="S3.p7.5.m5.1.1" xref="S3.p7.5.m5.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S3.p7.5.m5.1b"><cn id="S3.p7.5.m5.1.1.cmml" type="integer" xref="S3.p7.5.m5.1.1">0</cn></annotation-xml></semantics></math> and <math alttext="1" class="ltx_Math" display="inline" id="S3.p7.6.m6.1"><semantics id="S3.p7.6.m6.1a"><mn id="S3.p7.6.m6.1.1" xref="S3.p7.6.m6.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S3.p7.6.m6.1b"><cn id="S3.p7.6.m6.1.1.cmml" type="integer" xref="S3.p7.6.m6.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S3.p7.6.m6.1c">1</annotation><annotation encoding="application/x-llamapun" id="S3.p7.6.m6.1d">1</annotation></semantics></math> through a sigmoid layer <math alttext="\sigma" class="ltx_Math" display="inline" id="S3.p7.7.m7.1"><semantics id="S3.p7.7.m7.1a"><mi id="S3.p7.7.m7.1.1" xref="S3.p7.7.m7.1.1.cmml">σ</mi><annotation-xml encoding="MathML-Content" id="S3.p7.7.m7.1b"><ci id="S3.p7.7.m7.1.1.cmml" xref="S3.p7.7.m7.1.1">𝜎</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p7.7.m7.1c">\sigma</annotation><annotation encoding="application/x-llamapun" id="S3.p7.7.m7.1d">italic_σ</annotation></semantics></math> to represent the final prediction. We use L1 loss for HLP:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}L_{HLP}=\sum_{t=1}^{M}|\sigma(w_{hlp}^{\top}h_{t})-y_{t}|.\end{split}" class="ltx_Math" display="block" id="S3.E4.m1.22"><semantics id="S3.E4.m1.22a"><mtable displaystyle="true" id="S3.E4.m1.22.22.2"><mtr id="S3.E4.m1.22.22.2a"><mtd class="ltx_align_right" columnalign="right" id="S3.E4.m1.22.22.2b"><mrow id="S3.E4.m1.22.22.2.21.21.21.21"><mrow id="S3.E4.m1.22.22.2.21.21.21.21.1"><msub id="S3.E4.m1.22.22.2.21.21.21.21.1.2"><mi id="S3.E4.m1.1.1.1.1.1.1" xref="S3.E4.m1.1.1.1.1.1.1.cmml">L</mi><mrow id="S3.E4.m1.2.2.2.2.2.2.1" xref="S3.E4.m1.2.2.2.2.2.2.1.cmml"><mi id="S3.E4.m1.2.2.2.2.2.2.1.2" xref="S3.E4.m1.2.2.2.2.2.2.1.2.cmml">H</mi><mo id="S3.E4.m1.2.2.2.2.2.2.1.1" xref="S3.E4.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S3.E4.m1.2.2.2.2.2.2.1.3" xref="S3.E4.m1.2.2.2.2.2.2.1.3.cmml">L</mi><mo id="S3.E4.m1.2.2.2.2.2.2.1.1a" xref="S3.E4.m1.2.2.2.2.2.2.1.1.cmml">⁢</mo><mi id="S3.E4.m1.2.2.2.2.2.2.1.4" xref="S3.E4.m1.2.2.2.2.2.2.1.4.cmml">P</mi></mrow></msub><mo id="S3.E4.m1.3.3.3.3.3.3" rspace="0.111em" xref="S3.E4.m1.3.3.3.3.3.3.cmml">=</mo><mrow id="S3.E4.m1.22.22.2.21.21.21.21.1.1"><munderover id="S3.E4.m1.22.22.2.21.21.21.21.1.1.2"><mo id="S3.E4.m1.4.4.4.4.4.4" movablelimits="false" rspace="0em" xref="S3.E4.m1.4.4.4.4.4.4.cmml">∑</mo><mrow id="S3.E4.m1.5.5.5.5.5.5.1" xref="S3.E4.m1.5.5.5.5.5.5.1.cmml"><mi id="S3.E4.m1.5.5.5.5.5.5.1.2" xref="S3.E4.m1.5.5.5.5.5.5.1.2.cmml">t</mi><mo id="S3.E4.m1.5.5.5.5.5.5.1.1" xref="S3.E4.m1.5.5.5.5.5.5.1.1.cmml">=</mo><mn id="S3.E4.m1.5.5.5.5.5.5.1.3" xref="S3.E4.m1.5.5.5.5.5.5.1.3.cmml">1</mn></mrow><mi id="S3.E4.m1.6.6.6.6.6.6.1" xref="S3.E4.m1.6.6.6.6.6.6.1.cmml">M</mi></munderover><mrow id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1"><mo id="S3.E4.m1.7.7.7.7.7.7" stretchy="false" xref="S3.E4.m1.21.21.1.1.1.cmml">|</mo><mrow id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1"><mrow id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1.1"><mi id="S3.E4.m1.8.8.8.8.8.8" xref="S3.E4.m1.8.8.8.8.8.8.cmml">σ</mi><mo id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1.1.2" xref="S3.E4.m1.21.21.1.1.1.cmml">⁢</mo><mrow id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1.1.1.1"><mo id="S3.E4.m1.9.9.9.9.9.9" stretchy="false" xref="S3.E4.m1.21.21.1.1.1.cmml">(</mo><mrow id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1.1.1.1.1"><msubsup id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1.1.1.1.1.2"><mi id="S3.E4.m1.10.10.10.10.10.10" xref="S3.E4.m1.10.10.10.10.10.10.cmml">w</mi><mrow id="S3.E4.m1.11.11.11.11.11.11.1" xref="S3.E4.m1.11.11.11.11.11.11.1.cmml"><mi id="S3.E4.m1.11.11.11.11.11.11.1.2" xref="S3.E4.m1.11.11.11.11.11.11.1.2.cmml">h</mi><mo id="S3.E4.m1.11.11.11.11.11.11.1.1" xref="S3.E4.m1.11.11.11.11.11.11.1.1.cmml">⁢</mo><mi id="S3.E4.m1.11.11.11.11.11.11.1.3" xref="S3.E4.m1.11.11.11.11.11.11.1.3.cmml">l</mi><mo id="S3.E4.m1.11.11.11.11.11.11.1.1a" xref="S3.E4.m1.11.11.11.11.11.11.1.1.cmml">⁢</mo><mi id="S3.E4.m1.11.11.11.11.11.11.1.4" xref="S3.E4.m1.11.11.11.11.11.11.1.4.cmml">p</mi></mrow><mo id="S3.E4.m1.12.12.12.12.12.12.1" xref="S3.E4.m1.12.12.12.12.12.12.1.cmml">⊤</mo></msubsup><mo id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1.1.1.1.1.1" xref="S3.E4.m1.21.21.1.1.1.cmml">⁢</mo><msub id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1.1.1.1.1.3"><mi id="S3.E4.m1.13.13.13.13.13.13" xref="S3.E4.m1.13.13.13.13.13.13.cmml">h</mi><mi id="S3.E4.m1.14.14.14.14.14.14.1" xref="S3.E4.m1.14.14.14.14.14.14.1.cmml">t</mi></msub></mrow><mo id="S3.E4.m1.15.15.15.15.15.15" stretchy="false" xref="S3.E4.m1.21.21.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E4.m1.16.16.16.16.16.16" xref="S3.E4.m1.16.16.16.16.16.16.cmml">−</mo><msub id="S3.E4.m1.22.22.2.21.21.21.21.1.1.1.1.1.2"><mi id="S3.E4.m1.17.17.17.17.17.17" xref="S3.E4.m1.17.17.17.17.17.17.cmml">y</mi><mi id="S3.E4.m1.18.18.18.18.18.18.1" xref="S3.E4.m1.18.18.18.18.18.18.1.cmml">t</mi></msub></mrow><mo id="S3.E4.m1.19.19.19.19.19.19" stretchy="false" xref="S3.E4.m1.21.21.1.1.1.cmml">|</mo></mrow></mrow></mrow><mo id="S3.E4.m1.20.20.20.20.20.20" lspace="0em" xref="S3.E4.m1.21.21.1.1.1.cmml">.</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E4.m1.22b"><apply id="S3.E4.m1.21.21.1.1.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><eq id="S3.E4.m1.3.3.3.3.3.3.cmml" xref="S3.E4.m1.3.3.3.3.3.3"></eq><apply id="S3.E4.m1.21.21.1.1.1.3.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><csymbol cd="ambiguous" id="S3.E4.m1.21.21.1.1.1.3.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7">subscript</csymbol><ci id="S3.E4.m1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.1.1.1.1.1.1">𝐿</ci><apply id="S3.E4.m1.2.2.2.2.2.2.1.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1"><times id="S3.E4.m1.2.2.2.2.2.2.1.1.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1.1"></times><ci id="S3.E4.m1.2.2.2.2.2.2.1.2.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1.2">𝐻</ci><ci id="S3.E4.m1.2.2.2.2.2.2.1.3.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1.3">𝐿</ci><ci id="S3.E4.m1.2.2.2.2.2.2.1.4.cmml" xref="S3.E4.m1.2.2.2.2.2.2.1.4">𝑃</ci></apply></apply><apply id="S3.E4.m1.21.21.1.1.1.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><apply id="S3.E4.m1.21.21.1.1.1.1.2.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><csymbol cd="ambiguous" id="S3.E4.m1.21.21.1.1.1.1.2.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7">superscript</csymbol><apply id="S3.E4.m1.21.21.1.1.1.1.2.2.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><csymbol cd="ambiguous" id="S3.E4.m1.21.21.1.1.1.1.2.2.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7">subscript</csymbol><sum id="S3.E4.m1.4.4.4.4.4.4.cmml" xref="S3.E4.m1.4.4.4.4.4.4"></sum><apply id="S3.E4.m1.5.5.5.5.5.5.1.cmml" xref="S3.E4.m1.5.5.5.5.5.5.1"><eq id="S3.E4.m1.5.5.5.5.5.5.1.1.cmml" xref="S3.E4.m1.5.5.5.5.5.5.1.1"></eq><ci id="S3.E4.m1.5.5.5.5.5.5.1.2.cmml" xref="S3.E4.m1.5.5.5.5.5.5.1.2">𝑡</ci><cn id="S3.E4.m1.5.5.5.5.5.5.1.3.cmml" type="integer" xref="S3.E4.m1.5.5.5.5.5.5.1.3">1</cn></apply></apply><ci id="S3.E4.m1.6.6.6.6.6.6.1.cmml" xref="S3.E4.m1.6.6.6.6.6.6.1">𝑀</ci></apply><apply id="S3.E4.m1.21.21.1.1.1.1.1.2.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><abs id="S3.E4.m1.21.21.1.1.1.1.1.2.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7"></abs><apply id="S3.E4.m1.21.21.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><minus id="S3.E4.m1.16.16.16.16.16.16.cmml" xref="S3.E4.m1.16.16.16.16.16.16"></minus><apply id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><times id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.7.7.7.7.7.7"></times><ci id="S3.E4.m1.8.8.8.8.8.8.cmml" xref="S3.E4.m1.8.8.8.8.8.8">𝜎</ci><apply id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><times id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7"></times><apply id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><csymbol cd="ambiguous" id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7">superscript</csymbol><apply id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><csymbol cd="ambiguous" id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7">subscript</csymbol><ci id="S3.E4.m1.10.10.10.10.10.10.cmml" xref="S3.E4.m1.10.10.10.10.10.10">𝑤</ci><apply id="S3.E4.m1.11.11.11.11.11.11.1.cmml" xref="S3.E4.m1.11.11.11.11.11.11.1"><times id="S3.E4.m1.11.11.11.11.11.11.1.1.cmml" xref="S3.E4.m1.11.11.11.11.11.11.1.1"></times><ci id="S3.E4.m1.11.11.11.11.11.11.1.2.cmml" xref="S3.E4.m1.11.11.11.11.11.11.1.2">ℎ</ci><ci id="S3.E4.m1.11.11.11.11.11.11.1.3.cmml" xref="S3.E4.m1.11.11.11.11.11.11.1.3">𝑙</ci><ci id="S3.E4.m1.11.11.11.11.11.11.1.4.cmml" xref="S3.E4.m1.11.11.11.11.11.11.1.4">𝑝</ci></apply></apply><csymbol cd="latexml" id="S3.E4.m1.12.12.12.12.12.12.1.cmml" xref="S3.E4.m1.12.12.12.12.12.12.1">top</csymbol></apply><apply id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><csymbol cd="ambiguous" id="S3.E4.m1.21.21.1.1.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7">subscript</csymbol><ci id="S3.E4.m1.13.13.13.13.13.13.cmml" xref="S3.E4.m1.13.13.13.13.13.13">ℎ</ci><ci id="S3.E4.m1.14.14.14.14.14.14.1.cmml" xref="S3.E4.m1.14.14.14.14.14.14.1">𝑡</ci></apply></apply></apply><apply id="S3.E4.m1.21.21.1.1.1.1.1.1.1.3.cmml" xref="S3.E4.m1.7.7.7.7.7.7"><csymbol cd="ambiguous" id="S3.E4.m1.21.21.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E4.m1.7.7.7.7.7.7">subscript</csymbol><ci id="S3.E4.m1.17.17.17.17.17.17.cmml" xref="S3.E4.m1.17.17.17.17.17.17">𝑦</ci><ci id="S3.E4.m1.18.18.18.18.18.18.1.cmml" xref="S3.E4.m1.18.18.18.18.18.18.1">𝑡</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E4.m1.22c">\begin{split}L_{HLP}=\sum_{t=1}^{M}|\sigma(w_{hlp}^{\top}h_{t})-y_{t}|.\end{split}</annotation><annotation encoding="application/x-llamapun" id="S3.E4.m1.22d">start_ROW start_CELL italic_L start_POSTSUBSCRIPT italic_H italic_L italic_P end_POSTSUBSCRIPT = ∑ start_POSTSUBSCRIPT italic_t = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_M end_POSTSUPERSCRIPT | italic_σ ( italic_w start_POSTSUBSCRIPT italic_h italic_l italic_p end_POSTSUBSCRIPT start_POSTSUPERSCRIPT ⊤ end_POSTSUPERSCRIPT italic_h start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ) - italic_y start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT | . end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p7.10">The full training objective is a weighted sum of NTP loss and HLP loss:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\begin{split}L=L_{NTP}+\lambda\cdot L_{HLP},\end{split}" class="ltx_Math" display="block" id="S3.E5.m1.12"><semantics id="S3.E5.m1.12a"><mtable displaystyle="true" id="S3.E5.m1.12.12.2"><mtr id="S3.E5.m1.12.12.2a"><mtd class="ltx_align_right" columnalign="right" id="S3.E5.m1.12.12.2b"><mrow id="S3.E5.m1.12.12.2.11.11.11.11"><mrow id="S3.E5.m1.12.12.2.11.11.11.11.1"><mi id="S3.E5.m1.1.1.1.1.1.1" xref="S3.E5.m1.1.1.1.1.1.1.cmml">L</mi><mo id="S3.E5.m1.2.2.2.2.2.2" xref="S3.E5.m1.2.2.2.2.2.2.cmml">=</mo><mrow id="S3.E5.m1.12.12.2.11.11.11.11.1.1"><msub id="S3.E5.m1.12.12.2.11.11.11.11.1.1.1"><mi id="S3.E5.m1.3.3.3.3.3.3" xref="S3.E5.m1.3.3.3.3.3.3.cmml">L</mi><mrow id="S3.E5.m1.4.4.4.4.4.4.1" xref="S3.E5.m1.4.4.4.4.4.4.1.cmml"><mi id="S3.E5.m1.4.4.4.4.4.4.1.2" xref="S3.E5.m1.4.4.4.4.4.4.1.2.cmml">N</mi><mo id="S3.E5.m1.4.4.4.4.4.4.1.1" xref="S3.E5.m1.4.4.4.4.4.4.1.1.cmml">⁢</mo><mi id="S3.E5.m1.4.4.4.4.4.4.1.3" xref="S3.E5.m1.4.4.4.4.4.4.1.3.cmml">T</mi><mo id="S3.E5.m1.4.4.4.4.4.4.1.1a" xref="S3.E5.m1.4.4.4.4.4.4.1.1.cmml">⁢</mo><mi id="S3.E5.m1.4.4.4.4.4.4.1.4" xref="S3.E5.m1.4.4.4.4.4.4.1.4.cmml">P</mi></mrow></msub><mo id="S3.E5.m1.5.5.5.5.5.5" xref="S3.E5.m1.5.5.5.5.5.5.cmml">+</mo><mrow id="S3.E5.m1.12.12.2.11.11.11.11.1.1.2"><mi id="S3.E5.m1.6.6.6.6.6.6" xref="S3.E5.m1.6.6.6.6.6.6.cmml">λ</mi><mo id="S3.E5.m1.7.7.7.7.7.7" lspace="0.222em" rspace="0.222em" xref="S3.E5.m1.7.7.7.7.7.7.cmml">⋅</mo><msub id="S3.E5.m1.12.12.2.11.11.11.11.1.1.2.1"><mi id="S3.E5.m1.8.8.8.8.8.8" xref="S3.E5.m1.8.8.8.8.8.8.cmml">L</mi><mrow id="S3.E5.m1.9.9.9.9.9.9.1" xref="S3.E5.m1.9.9.9.9.9.9.1.cmml"><mi id="S3.E5.m1.9.9.9.9.9.9.1.2" xref="S3.E5.m1.9.9.9.9.9.9.1.2.cmml">H</mi><mo id="S3.E5.m1.9.9.9.9.9.9.1.1" xref="S3.E5.m1.9.9.9.9.9.9.1.1.cmml">⁢</mo><mi id="S3.E5.m1.9.9.9.9.9.9.1.3" xref="S3.E5.m1.9.9.9.9.9.9.1.3.cmml">L</mi><mo id="S3.E5.m1.9.9.9.9.9.9.1.1a" xref="S3.E5.m1.9.9.9.9.9.9.1.1.cmml">⁢</mo><mi id="S3.E5.m1.9.9.9.9.9.9.1.4" xref="S3.E5.m1.9.9.9.9.9.9.1.4.cmml">P</mi></mrow></msub></mrow></mrow></mrow><mo id="S3.E5.m1.10.10.10.10.10.10" xref="S3.E5.m1.11.11.1.1.1.cmml">,</mo></mrow></mtd></mtr></mtable><annotation-xml encoding="MathML-Content" id="S3.E5.m1.12b"><apply id="S3.E5.m1.11.11.1.1.1.cmml" xref="S3.E5.m1.10.10.10.10.10.10"><eq id="S3.E5.m1.2.2.2.2.2.2.cmml" xref="S3.E5.m1.2.2.2.2.2.2"></eq><ci id="S3.E5.m1.1.1.1.1.1.1.cmml" xref="S3.E5.m1.1.1.1.1.1.1">𝐿</ci><apply id="S3.E5.m1.11.11.1.1.1.3.cmml" xref="S3.E5.m1.10.10.10.10.10.10"><plus id="S3.E5.m1.5.5.5.5.5.5.cmml" xref="S3.E5.m1.5.5.5.5.5.5"></plus><apply id="S3.E5.m1.11.11.1.1.1.3.2.cmml" xref="S3.E5.m1.10.10.10.10.10.10"><csymbol cd="ambiguous" id="S3.E5.m1.11.11.1.1.1.3.2.1.cmml" xref="S3.E5.m1.10.10.10.10.10.10">subscript</csymbol><ci id="S3.E5.m1.3.3.3.3.3.3.cmml" xref="S3.E5.m1.3.3.3.3.3.3">𝐿</ci><apply id="S3.E5.m1.4.4.4.4.4.4.1.cmml" xref="S3.E5.m1.4.4.4.4.4.4.1"><times id="S3.E5.m1.4.4.4.4.4.4.1.1.cmml" xref="S3.E5.m1.4.4.4.4.4.4.1.1"></times><ci id="S3.E5.m1.4.4.4.4.4.4.1.2.cmml" xref="S3.E5.m1.4.4.4.4.4.4.1.2">𝑁</ci><ci id="S3.E5.m1.4.4.4.4.4.4.1.3.cmml" xref="S3.E5.m1.4.4.4.4.4.4.1.3">𝑇</ci><ci id="S3.E5.m1.4.4.4.4.4.4.1.4.cmml" xref="S3.E5.m1.4.4.4.4.4.4.1.4">𝑃</ci></apply></apply><apply id="S3.E5.m1.11.11.1.1.1.3.3.cmml" xref="S3.E5.m1.10.10.10.10.10.10"><ci id="S3.E5.m1.7.7.7.7.7.7.cmml" xref="S3.E5.m1.7.7.7.7.7.7">⋅</ci><ci id="S3.E5.m1.6.6.6.6.6.6.cmml" xref="S3.E5.m1.6.6.6.6.6.6">𝜆</ci><apply id="S3.E5.m1.11.11.1.1.1.3.3.3.cmml" xref="S3.E5.m1.10.10.10.10.10.10"><csymbol cd="ambiguous" id="S3.E5.m1.11.11.1.1.1.3.3.3.1.cmml" xref="S3.E5.m1.10.10.10.10.10.10">subscript</csymbol><ci id="S3.E5.m1.8.8.8.8.8.8.cmml" xref="S3.E5.m1.8.8.8.8.8.8">𝐿</ci><apply id="S3.E5.m1.9.9.9.9.9.9.1.cmml" xref="S3.E5.m1.9.9.9.9.9.9.1"><times id="S3.E5.m1.9.9.9.9.9.9.1.1.cmml" xref="S3.E5.m1.9.9.9.9.9.9.1.1"></times><ci id="S3.E5.m1.9.9.9.9.9.9.1.2.cmml" xref="S3.E5.m1.9.9.9.9.9.9.1.2">𝐻</ci><ci id="S3.E5.m1.9.9.9.9.9.9.1.3.cmml" xref="S3.E5.m1.9.9.9.9.9.9.1.3">𝐿</ci><ci id="S3.E5.m1.9.9.9.9.9.9.1.4.cmml" xref="S3.E5.m1.9.9.9.9.9.9.1.4">𝑃</ci></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E5.m1.12c">\begin{split}L=L_{NTP}+\lambda\cdot L_{HLP},\end{split}</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.12d">start_ROW start_CELL italic_L = italic_L start_POSTSUBSCRIPT italic_N italic_T italic_P end_POSTSUBSCRIPT + italic_λ ⋅ italic_L start_POSTSUBSCRIPT italic_H italic_L italic_P end_POSTSUBSCRIPT , end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p7.9">where <math alttext="\lambda" class="ltx_Math" display="inline" id="S3.p7.8.m1.1"><semantics id="S3.p7.8.m1.1a"><mi id="S3.p7.8.m1.1.1" xref="S3.p7.8.m1.1.1.cmml">λ</mi><annotation-xml encoding="MathML-Content" id="S3.p7.8.m1.1b"><ci id="S3.p7.8.m1.1.1.cmml" xref="S3.p7.8.m1.1.1">𝜆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p7.8.m1.1c">\lambda</annotation><annotation encoding="application/x-llamapun" id="S3.p7.8.m1.1d">italic_λ</annotation></semantics></math> is the tunable weight. In experiments, we set <math alttext="\lambda=0.1" class="ltx_Math" display="inline" id="S3.p7.9.m2.1"><semantics id="S3.p7.9.m2.1a"><mrow id="S3.p7.9.m2.1.1" xref="S3.p7.9.m2.1.1.cmml"><mi id="S3.p7.9.m2.1.1.2" xref="S3.p7.9.m2.1.1.2.cmml">λ</mi><mo id="S3.p7.9.m2.1.1.1" xref="S3.p7.9.m2.1.1.1.cmml">=</mo><mn id="S3.p7.9.m2.1.1.3" xref="S3.p7.9.m2.1.1.3.cmml">0.1</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.p7.9.m2.1b"><apply id="S3.p7.9.m2.1.1.cmml" xref="S3.p7.9.m2.1.1"><eq id="S3.p7.9.m2.1.1.1.cmml" xref="S3.p7.9.m2.1.1.1"></eq><ci id="S3.p7.9.m2.1.1.2.cmml" xref="S3.p7.9.m2.1.1.2">𝜆</ci><cn id="S3.p7.9.m2.1.1.3.cmml" type="float" xref="S3.p7.9.m2.1.1.3">0.1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p7.9.m2.1c">\lambda=0.1</annotation><annotation encoding="application/x-llamapun" id="S3.p7.9.m2.1d">italic_λ = 0.1</annotation></semantics></math>, which achieves good results across benchmarks empirically.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.p8">
<p class="ltx_p" id="S3.p8.1"><span class="ltx_text ltx_font_bold" id="S3.p8.1.1">Overhead Analysis.</span> While HLP introduces the additional <math alttext="\mathsf{hlp\_head}" class="ltx_Math" display="inline" id="S3.p8.1.m1.1"><semantics id="S3.p8.1.m1.1a"><mrow id="S3.p8.1.m1.1.1" xref="S3.p8.1.m1.1.1.cmml"><mi id="S3.p8.1.m1.1.1.2" xref="S3.p8.1.m1.1.1.2.cmml">𝗁𝗅𝗉</mi><mo id="S3.p8.1.m1.1.1.1" xref="S3.p8.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.p8.1.m1.1.1.3" mathvariant="normal" xref="S3.p8.1.m1.1.1.3.cmml">_</mi><mo id="S3.p8.1.m1.1.1.1a" xref="S3.p8.1.m1.1.1.1.cmml">⁢</mo><mi id="S3.p8.1.m1.1.1.4" xref="S3.p8.1.m1.1.1.4.cmml">𝗁𝖾𝖺𝖽</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.p8.1.m1.1b"><apply id="S3.p8.1.m1.1.1.cmml" xref="S3.p8.1.m1.1.1"><times id="S3.p8.1.m1.1.1.1.cmml" xref="S3.p8.1.m1.1.1.1"></times><ci id="S3.p8.1.m1.1.1.2.cmml" xref="S3.p8.1.m1.1.1.2">𝗁𝗅𝗉</ci><ci id="S3.p8.1.m1.1.1.3.cmml" xref="S3.p8.1.m1.1.1.3">_</ci><ci id="S3.p8.1.m1.1.1.4.cmml" xref="S3.p8.1.m1.1.1.4">𝗁𝖾𝖺𝖽</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p8.1.m1.1c">\mathsf{hlp\_head}</annotation><annotation encoding="application/x-llamapun" id="S3.p8.1.m1.1d">sansserif_hlp _ sansserif_head</annotation></semantics></math> during training, the number of added parameters is &lt; 0.01% of the base model, which incurs <span class="ltx_text ltx_font_italic" id="S3.p8.1.2">almost zero training overhead</span>. Furthermore, the additional head can be discarded during inference, leading to <span class="ltx_text ltx_font_italic" id="S3.p8.1.3">no inference overhead</span>.</p>
</div>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2>
<div class="ltx_para ltx_noindent" id="S4.p1">
<p class="ltx_p" id="S4.p1.2"><span class="ltx_text ltx_font_bold" id="S4.p1.2.1">Training.</span> We conduct continual pre-training on a set of code LLMs of different model families and sizes to validate the effectiveness of HLP. Specifically, DeepSeek-Coder-Base 1.3B/6.7B <cite class="ltx_cite ltx_citemacro_citep">(Guo et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib12" title="">2024</a>)</cite> and StarCoder2 3B/7B <cite class="ltx_cite ltx_citemacro_citep">(Lozhkov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib20" title="">2024</a>)</cite> are involved in our experiments. We use AdamW <cite class="ltx_cite ltx_citemacro_citep">(Loshchilov &amp; Hutter, <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib19" title="">2019</a>)</cite> as the optimizer with <math alttext="\beta_{1}=0.9" class="ltx_Math" display="inline" id="S4.p1.1.m1.1"><semantics id="S4.p1.1.m1.1a"><mrow id="S4.p1.1.m1.1.1" xref="S4.p1.1.m1.1.1.cmml"><msub id="S4.p1.1.m1.1.1.2" xref="S4.p1.1.m1.1.1.2.cmml"><mi id="S4.p1.1.m1.1.1.2.2" xref="S4.p1.1.m1.1.1.2.2.cmml">β</mi><mn id="S4.p1.1.m1.1.1.2.3" xref="S4.p1.1.m1.1.1.2.3.cmml">1</mn></msub><mo id="S4.p1.1.m1.1.1.1" xref="S4.p1.1.m1.1.1.1.cmml">=</mo><mn id="S4.p1.1.m1.1.1.3" xref="S4.p1.1.m1.1.1.3.cmml">0.9</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.p1.1.m1.1b"><apply id="S4.p1.1.m1.1.1.cmml" xref="S4.p1.1.m1.1.1"><eq id="S4.p1.1.m1.1.1.1.cmml" xref="S4.p1.1.m1.1.1.1"></eq><apply id="S4.p1.1.m1.1.1.2.cmml" xref="S4.p1.1.m1.1.1.2"><csymbol cd="ambiguous" id="S4.p1.1.m1.1.1.2.1.cmml" xref="S4.p1.1.m1.1.1.2">subscript</csymbol><ci id="S4.p1.1.m1.1.1.2.2.cmml" xref="S4.p1.1.m1.1.1.2.2">𝛽</ci><cn id="S4.p1.1.m1.1.1.2.3.cmml" type="integer" xref="S4.p1.1.m1.1.1.2.3">1</cn></apply><cn id="S4.p1.1.m1.1.1.3.cmml" type="float" xref="S4.p1.1.m1.1.1.3">0.9</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p1.1.m1.1c">\beta_{1}=0.9</annotation><annotation encoding="application/x-llamapun" id="S4.p1.1.m1.1d">italic_β start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT = 0.9</annotation></semantics></math> and <math alttext="\beta_{2}=0.95" class="ltx_Math" display="inline" id="S4.p1.2.m2.1"><semantics id="S4.p1.2.m2.1a"><mrow id="S4.p1.2.m2.1.1" xref="S4.p1.2.m2.1.1.cmml"><msub id="S4.p1.2.m2.1.1.2" xref="S4.p1.2.m2.1.1.2.cmml"><mi id="S4.p1.2.m2.1.1.2.2" xref="S4.p1.2.m2.1.1.2.2.cmml">β</mi><mn id="S4.p1.2.m2.1.1.2.3" xref="S4.p1.2.m2.1.1.2.3.cmml">2</mn></msub><mo id="S4.p1.2.m2.1.1.1" xref="S4.p1.2.m2.1.1.1.cmml">=</mo><mn id="S4.p1.2.m2.1.1.3" xref="S4.p1.2.m2.1.1.3.cmml">0.95</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.p1.2.m2.1b"><apply id="S4.p1.2.m2.1.1.cmml" xref="S4.p1.2.m2.1.1"><eq id="S4.p1.2.m2.1.1.1.cmml" xref="S4.p1.2.m2.1.1.1"></eq><apply id="S4.p1.2.m2.1.1.2.cmml" xref="S4.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S4.p1.2.m2.1.1.2.1.cmml" xref="S4.p1.2.m2.1.1.2">subscript</csymbol><ci id="S4.p1.2.m2.1.1.2.2.cmml" xref="S4.p1.2.m2.1.1.2.2">𝛽</ci><cn id="S4.p1.2.m2.1.1.2.3.cmml" type="integer" xref="S4.p1.2.m2.1.1.2.3">2</cn></apply><cn id="S4.p1.2.m2.1.1.3.cmml" type="float" xref="S4.p1.2.m2.1.1.3">0.95</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p1.2.m2.1c">\beta_{2}=0.95</annotation><annotation encoding="application/x-llamapun" id="S4.p1.2.m2.1d">italic_β start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT = 0.95</annotation></semantics></math>. We use a cosine learning rate scheduler with a peak learning rate equal to that at pre-training end. All models are trained for 200K steps with a warm-up period over the first 3,000 steps. The global batch size is 512.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p2">
<p class="ltx_p" id="S4.p2.4"><span class="ltx_text ltx_font_bold" id="S4.p2.4.1">Dataset.</span> We use a subset of <span class="ltx_text ltx_font_typewriter" id="S4.p2.4.2">the-stack-v2-train-smol</span> <cite class="ltx_cite ltx_citemacro_citep">(Lozhkov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib20" title="">2024</a>)</cite> for continual pre-training which includes Python, Java, C++, and C#. In line with existing works <cite class="ltx_cite ltx_citemacro_citep">(Guo et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib12" title="">2024</a>; Lozhkov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib20" title="">2024</a>)</cite>, FIM rate is set to <math alttext="0.5" class="ltx_Math" display="inline" id="S4.p2.1.m1.1"><semantics id="S4.p2.1.m1.1a"><mn id="S4.p2.1.m1.1.1" xref="S4.p2.1.m1.1.1.cmml">0.5</mn><annotation-xml encoding="MathML-Content" id="S4.p2.1.m1.1b"><cn id="S4.p2.1.m1.1.1.cmml" type="float" xref="S4.p2.1.m1.1.1">0.5</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.1.m1.1c">0.5</annotation><annotation encoding="application/x-llamapun" id="S4.p2.1.m1.1d">0.5</annotation></semantics></math>. We employ Best-fit Packing <cite class="ltx_cite ltx_citemacro_citep">(Ding et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib6" title="">2024</a>)</cite> to group multiple files into each training sequence while masking out cross-file attention. The <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S4.p2.2.m2.1"><semantics id="S4.p2.2.m2.1a"><mi id="S4.p2.2.m2.1.1" xref="S4.p2.2.m2.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S4.p2.2.m2.1b"><ci id="S4.p2.2.m2.1.1.cmml" xref="S4.p2.2.m2.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.2.m2.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.2.m2.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S4.p2.3.m3.1"><semantics id="S4.p2.3.m3.1a"><mi id="S4.p2.3.m3.1.1" xref="S4.p2.3.m3.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S4.p2.3.m3.1b"><ci id="S4.p2.3.m3.1.1.cmml" xref="S4.p2.3.m3.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.3.m3.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.3.m3.1d">sansserif_middle</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S4.p2.4.m4.1"><semantics id="S4.p2.4.m4.1a"><mi id="S4.p2.4.m4.1.1" xref="S4.p2.4.m4.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S4.p2.4.m4.1b"><ci id="S4.p2.4.m4.1.1.cmml" xref="S4.p2.4.m4.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.4.m4.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.4.m4.1d">sansserif_suffix</annotation></semantics></math> split is applied to each file independently rather than the whole training sequence.</p>
</div>
<figure class="ltx_table" id="S4.T3">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S4.T3.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T3.1.2.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S4.T3.1.2.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="4" id="S4.T3.1.2.1.2">SAFIM</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S4.T3.1.2.1.3" rowspan="2"><span class="ltx_text" id="S4.T3.1.2.1.3.1">Average</span></th>
</tr>
<tr class="ltx_tr" id="S4.T3.1.1">
<th class="ltx_td ltx_th ltx_th_row" id="S4.T3.1.1.2"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T3.1.1.3">Algorithmic</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T3.1.1.1">Algorithmic<math alttext="{}_{\text{v2}}" class="ltx_Math" display="inline" id="S4.T3.1.1.1.m1.1"><semantics id="S4.T3.1.1.1.m1.1a"><msub id="S4.T3.1.1.1.m1.1.1" xref="S4.T3.1.1.1.m1.1.1.cmml"><mi id="S4.T3.1.1.1.m1.1.1a" xref="S4.T3.1.1.1.m1.1.1.cmml"></mi><mtext id="S4.T3.1.1.1.m1.1.1.1" xref="S4.T3.1.1.1.m1.1.1.1a.cmml">v2</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.T3.1.1.1.m1.1b"><apply id="S4.T3.1.1.1.m1.1.1.cmml" xref="S4.T3.1.1.1.m1.1.1"><ci id="S4.T3.1.1.1.m1.1.1.1a.cmml" xref="S4.T3.1.1.1.m1.1.1.1"><mtext id="S4.T3.1.1.1.m1.1.1.1.cmml" mathsize="70%" xref="S4.T3.1.1.1.m1.1.1.1">v2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T3.1.1.1.m1.1c">{}_{\text{v2}}</annotation><annotation encoding="application/x-llamapun" id="S4.T3.1.1.1.m1.1d">start_FLOATSUBSCRIPT v2 end_FLOATSUBSCRIPT</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T3.1.1.4">Control</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T3.1.1.5">API</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T3.1.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T3.1.3.1.1">DS-1.3B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.3.1.2">39.8</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.3.1.3">42.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.3.1.4">52.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.3.1.5">56.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.3.1.6">47.7</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T3.1.4.2.1">
<span class="ltx_ERROR undefined" id="S4.T3.1.4.2.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T3.1.4.2.2"><span class="ltx_text ltx_font_bold" id="S4.T3.1.4.2.2.1">41.3</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.4.2.3"><span class="ltx_text ltx_font_bold" id="S4.T3.1.4.2.3.1">46.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.4.2.4"><span class="ltx_text ltx_font_bold" id="S4.T3.1.4.2.4.1">53.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.4.2.5"><span class="ltx_text ltx_font_bold" id="S4.T3.1.4.2.5.1">59.0</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.4.2.6"><span class="ltx_text ltx_font_bold" id="S4.T3.1.4.2.6.1">50.0</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T3.1.5.3.1">DS-6.7B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.5.3.2">53.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.5.3.3">56.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.5.3.4">66.6</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.5.3.5">69.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.5.3.6">61.4</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T3.1.6.4.1">
<span class="ltx_ERROR undefined" id="S4.T3.1.6.4.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T3.1.6.4.2"><span class="ltx_text ltx_font_bold" id="S4.T3.1.6.4.2.1">53.5</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.6.4.3"><span class="ltx_text ltx_font_bold" id="S4.T3.1.6.4.3.1">57.4</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.6.4.4"><span class="ltx_text ltx_font_bold" id="S4.T3.1.6.4.4.1">66.9</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.6.4.5"><span class="ltx_text ltx_font_bold" id="S4.T3.1.6.4.5.1">69.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.6.4.6"><span class="ltx_text ltx_font_bold" id="S4.T3.1.6.4.6.1">61.9</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.7.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T3.1.7.5.1">SC2-3B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.7.5.2">45.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.7.5.3">49.7</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.7.5.4">57.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.7.5.5">61.3</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.7.5.6">53.4</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.8.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T3.1.8.6.1">
<span class="ltx_ERROR undefined" id="S4.T3.1.8.6.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T3.1.8.6.2"><span class="ltx_text ltx_font_bold" id="S4.T3.1.8.6.2.1">47.2</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.8.6.3"><span class="ltx_text ltx_font_bold" id="S4.T3.1.8.6.3.1">52.1</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.8.6.4"><span class="ltx_text ltx_font_bold" id="S4.T3.1.8.6.4.1">58.7</span></td>
<td class="ltx_td ltx_align_center" id="S4.T3.1.8.6.5"><span class="ltx_text ltx_font_bold" id="S4.T3.1.8.6.5.1">64.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T3.1.8.6.6"><span class="ltx_text ltx_font_bold" id="S4.T3.1.8.6.6.1">55.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.9.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T3.1.9.7.1">SC2-7B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.9.7.2">48.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.9.7.3">53.1</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.9.7.4">60.4</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T3.1.9.7.5">63.9</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T3.1.9.7.6">56.5</td>
</tr>
<tr class="ltx_tr" id="S4.T3.1.10.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S4.T3.1.10.8.1">
<span class="ltx_ERROR undefined" id="S4.T3.1.10.8.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.1.10.8.2"><span class="ltx_text ltx_font_bold" id="S4.T3.1.10.8.2.1">49.4</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.1.10.8.3"><span class="ltx_text ltx_font_bold" id="S4.T3.1.10.8.3.1">54.5</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.1.10.8.4"><span class="ltx_text ltx_font_bold" id="S4.T3.1.10.8.4.1">61.8</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T3.1.10.8.5"><span class="ltx_text ltx_font_bold" id="S4.T3.1.10.8.5.1">65.8</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S4.T3.1.10.8.6"><span class="ltx_text ltx_font_bold" id="S4.T3.1.10.8.6.1">57.9</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3: </span>
<span class="ltx_text" id="S4.T3.3.1">Pass@1</span> results of training w/o and w/ HLP for different code LLMs on SAFIM <cite class="ltx_cite ltx_citemacro_citep">(Gong et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib10" title="">2024</a>)</cite> computed with greedy decoding.
</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S4.p3">
<p class="ltx_p" id="S4.p3.1">We conduct controlled experiments for all the studied code LLMs in our experiments. Specifically, we conduct two continual pre-training experiments for each model as follows:</p>
<ul class="ltx_itemize" id="S4.I1">
<li class="ltx_item" id="S4.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para" id="S4.I1.i1.p1">
<p class="ltx_p" id="S4.I1.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I1.i1.p1.1.1">NTP</span>: existing pre-training scheme with next-token prediction (NTP) objective only.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">•</span>
<div class="ltx_para ltx_noindent" id="S4.I1.i2.p1">
<p class="ltx_p" id="S4.I1.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I1.i2.p1.1.1">NTP + HLP</span>: our newly proposed pre-training scheme that incorporates horizon-length prediction (HLP) objective with next-token prediction (NTP) objective.</p>
</div>
</li>
</ul>
</div>
<div class="ltx_para ltx_noindent" id="S4.p4">
<p class="ltx_p" id="S4.p4.1">Throughout this section, we determine the end of generation solely based on <span class="ltx_text ltx_font_typewriter" id="S4.p4.1.1">&lt;eoi&gt;</span> predicted by the model during evaluation, without any rule-based post-processing, unless otherwise specified in §<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.SS4" title="4.4 Code Reasoning via Fill-in-the-Middle ‣ 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">4.4</span></a>.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Syntax-Aware and Multilingual Code Fill-in-the-Middle</h3>
<div class="ltx_para ltx_noindent" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">We use SAFIM <cite class="ltx_cite ltx_citemacro_citep">(Gong et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib10" title="">2024</a>)</cite>, a syntax-aware and multilingual code Fill-in-the-Middle benchmark, to evaluate the effectiveness of HLP. SAFIM focuses on syntax-aware completions of program structures, covering algorithmic block (<em class="ltx_emph ltx_font_italic" id="S4.SS1.p1.1.1">i.e.,</em> Algo and Algo<math alttext="{}_{\text{v2}}" class="ltx_Math" display="inline" id="S4.SS1.p1.1.m1.1"><semantics id="S4.SS1.p1.1.m1.1a"><msub id="S4.SS1.p1.1.m1.1.1" xref="S4.SS1.p1.1.m1.1.1.cmml"><mi id="S4.SS1.p1.1.m1.1.1a" xref="S4.SS1.p1.1.m1.1.1.cmml"></mi><mtext id="S4.SS1.p1.1.m1.1.1.1" xref="S4.SS1.p1.1.m1.1.1.1a.cmml">v2</mtext></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.1.m1.1b"><apply id="S4.SS1.p1.1.m1.1.1.cmml" xref="S4.SS1.p1.1.m1.1.1"><ci id="S4.SS1.p1.1.m1.1.1.1a.cmml" xref="S4.SS1.p1.1.m1.1.1.1"><mtext id="S4.SS1.p1.1.m1.1.1.1.cmml" mathsize="70%" xref="S4.SS1.p1.1.m1.1.1.1">v2</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.1.m1.1c">{}_{\text{v2}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.1.m1.1d">start_FLOATSUBSCRIPT v2 end_FLOATSUBSCRIPT</annotation></semantics></math>), control-flow expression (<em class="ltx_emph ltx_font_italic" id="S4.SS1.p1.1.2">i.e.,</em> Control), and API function call (<em class="ltx_emph ltx_font_italic" id="S4.SS1.p1.1.3">i.e.,</em> API). It consists of 17,720 examples from four different programming languages, including Python, Java, C++, and C#. SAFIM employs execution-based evaluation and reports <span class="ltx_text" id="S4.SS1.p1.1.4">pass@1</span> as the evaluation metric. As shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.T3" title="Table 3 ‣ 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">3</span></a>, compared with NTP only, adding HLP achieves up to 5% improvements on average across all the studied code LLMs. Specifically, HLP consistently improves LLMs’ performance on completions of various program structures. Furthermore, since SAFIM is a multilingual benchmark, our evaluation also shows that incorporating HLP can improve FIM performance across different languages.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Repository-Level Cross-File Code Fill-in-the-Middle</h3>
<figure class="ltx_table" id="S4.T4">
<div class="ltx_flex_figure ltx_flex_table">
<div class="ltx_flex_cell ltx_flex_size_1">
<table class="ltx_tabular ltx_centering ltx_figure_panel ltx_guessed_headers ltx_align_middle" id="S4.T4.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T4.1.1.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S4.T4.1.1.1.1"></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="6" id="S4.T4.1.1.1.2">CrossCodeEval / CrossCodeLongEval</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T4.1.1.1.3" rowspan="2"><span class="ltx_text" id="S4.T4.1.1.1.3.1">Average</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.2.2">
<th class="ltx_td ltx_th ltx_th_row" id="S4.T4.1.2.2.1"></th>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T4.1.2.2.2">Line</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T4.1.2.2.3">Chunk</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T4.1.2.2.4">Function</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.3.3">
<th class="ltx_td ltx_th ltx_th_row ltx_border_t" id="S4.T4.1.3.3.1"></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.2">EM</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.3">ES</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.4">EM</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.5">ES</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.6">EM</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.7">ES</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.8">EM</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.3.3.9">ES</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.1.4.4.1">DS-1.3B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.4.4.2">15.23</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.4.4.3">49.64</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.4.4.4">22.48</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.4.4.5">56.40</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.4.4.6">4.58</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.4.4.7">33.96</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.4.4.8">14.10</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.1.4.4.9">46.67</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.5.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.5.5.1">
<span class="ltx_ERROR undefined" id="S4.T4.1.5.5.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.2"><span class="ltx_text ltx_font_bold" id="S4.T4.1.5.5.2.1">18.99</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.3"><span class="ltx_text ltx_font_bold" id="S4.T4.1.5.5.3.1">55.47</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.4"><span class="ltx_text ltx_font_bold" id="S4.T4.1.5.5.4.1">24.32</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.5"><span class="ltx_text ltx_font_bold" id="S4.T4.1.5.5.5.1">58.77</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.6"><span class="ltx_text ltx_font_bold" id="S4.T4.1.5.5.6.1">5.12</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.7"><span class="ltx_text ltx_font_bold" id="S4.T4.1.5.5.7.1">35.25</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.5.5.8"><span class="ltx_text ltx_font_bold" id="S4.T4.1.5.5.8.1">16.14</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.5.5.9"><span class="ltx_text ltx_font_bold" id="S4.T4.1.5.5.9.1">49.83</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.6.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.1.6.6.1">DS-6.7B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.2">26.23</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.3">62.07</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.4">28.90</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.5">62.37</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.6"><span class="ltx_text ltx_font_bold" id="S4.T4.1.6.6.6.1">7.50</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.7"><span class="ltx_text ltx_font_bold" id="S4.T4.1.6.6.7.1">41.42</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.6.6.8">20.88</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.1.6.6.9">55.29</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.7.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.7.7.1">
<span class="ltx_ERROR undefined" id="S4.T4.1.7.7.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.2"><span class="ltx_text ltx_font_bold" id="S4.T4.1.7.7.2.1">27.35</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.3"><span class="ltx_text ltx_font_bold" id="S4.T4.1.7.7.3.1">63.54</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.4"><span class="ltx_text ltx_font_bold" id="S4.T4.1.7.7.4.1">30.08</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.5"><span class="ltx_text ltx_font_bold" id="S4.T4.1.7.7.5.1">63.18</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.6">7.22</td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.7">40.99</td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.7.7.8"><span class="ltx_text ltx_font_bold" id="S4.T4.1.7.7.8.1">21.55</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.7.7.9"><span class="ltx_text ltx_font_bold" id="S4.T4.1.7.7.9.1">55.90</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.8.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.1.8.8.1">SC2-3B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.8.8.2">24.17</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.8.8.3">59.89</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.8.8.4">22.20</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.8.8.5">52.69</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.8.8.6">6.80</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.8.8.7">38.13</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.8.8.8">17.72</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.1.8.8.9">50.24</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.9.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.1.9.9.1">
<span class="ltx_ERROR undefined" id="S4.T4.1.9.9.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.2"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.2.1">25.67</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.3"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.3.1">62.62</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.4"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.4.1">30.66</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.5"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.5.1">62.01</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.6"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.6.1">7.18</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.7"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.7.1">39.42</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.1.9.9.8"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.8.1">21.17</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.1.9.9.9"><span class="ltx_text ltx_font_bold" id="S4.T4.1.9.9.9.1">54.68</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.10.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.1.10.10.1">SC2-7B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.10.10.2">26.00</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.10.10.3">61.68</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.10.10.4">27.14</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.10.10.5">56.52</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.10.10.6">7.66</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.10.10.7">39.54</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.1.10.10.8">20.27</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.1.10.10.9">52.58</td>
</tr>
<tr class="ltx_tr" id="S4.T4.1.11.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S4.T4.1.11.11.1">
<span class="ltx_ERROR undefined" id="S4.T4.1.11.11.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.11.11.2"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.2.1">27.58</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.11.11.3"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.3.1">63.84</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.11.11.4"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.4.1">32.86</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.11.11.5"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.5.1">64.07</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.11.11.6"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.6.1">8.44</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.11.11.7"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.7.1">41.03</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.1.11.11.8"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.8.1">22.96</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S4.T4.1.11.11.9"><span class="ltx_text ltx_font_bold" id="S4.T4.1.11.11.9.1">56.31</span></td>
</tr>
</tbody>
</table>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<table class="ltx_tabular ltx_centering ltx_figure_panel ltx_guessed_headers ltx_align_middle" id="S4.T4.2">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T4.2.1.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S4.T4.2.1.1.1"></th>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="6" id="S4.T4.2.1.1.2">RepoEval</td>
<td class="ltx_td ltx_align_center ltx_border_tt" colspan="2" id="S4.T4.2.1.1.3" rowspan="2"><span class="ltx_text" id="S4.T4.2.1.1.3.1">Average</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.2.2">
<th class="ltx_td ltx_th ltx_th_row" id="S4.T4.2.2.2.1"></th>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T4.2.2.2.2">Line</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T4.2.2.2.3">API</td>
<td class="ltx_td ltx_align_center ltx_border_t" colspan="2" id="S4.T4.2.2.2.4">Function</td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.3.3">
<th class="ltx_td ltx_th ltx_th_row ltx_border_t" id="S4.T4.2.3.3.1"></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.3.3.2">EM</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.3.3.3">ES</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.3.3.4">EM</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.3.3.5">ES</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.3.3.6">EM</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.3.3.7">ES</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.3.3.8">EM</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.3.3.9">ES</td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.2.4.4.1">DS-1.3B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.4.4.2">24.50</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.4.4.3">50.42</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.4.4.4">18.81</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.4.4.5">58.15</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.4.4.6">3.96</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.4.4.7">29.73</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.4.4.8">15.76</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.2.4.4.9">46.10</td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.5.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.2.5.5.1">
<span class="ltx_ERROR undefined" id="S4.T4.2.5.5.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.5.2"><span class="ltx_text ltx_font_bold" id="S4.T4.2.5.5.2.1">27.25</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.5.3"><span class="ltx_text ltx_font_bold" id="S4.T4.2.5.5.3.1">53.45</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.5.4"><span class="ltx_text ltx_font_bold" id="S4.T4.2.5.5.4.1">21.81</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.5.5"><span class="ltx_text ltx_font_bold" id="S4.T4.2.5.5.5.1">59.79</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.5.6"><span class="ltx_text ltx_font_bold" id="S4.T4.2.5.5.6.1">5.93</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.5.7"><span class="ltx_text ltx_font_bold" id="S4.T4.2.5.5.7.1">31.92</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.5.5.8"><span class="ltx_text ltx_font_bold" id="S4.T4.2.5.5.8.1">18.33</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.2.5.5.9"><span class="ltx_text ltx_font_bold" id="S4.T4.2.5.5.9.1">48.39</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.6.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.2.6.6.1">DS-6.7B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.6.6.2">26.62</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.6.6.3">52.59</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.6.6.4">22.69</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.6.6.5">61.94</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.6.6.6">7.47</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.6.6.7">36.24</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.6.6.8">18.93</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.2.6.6.9">50.26</td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.7.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.2.7.7.1">
<span class="ltx_ERROR undefined" id="S4.T4.2.7.7.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T4.2.7.7.2"><span class="ltx_text ltx_font_bold" id="S4.T4.2.7.7.2.1">30.31</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.7.7.3"><span class="ltx_text ltx_font_bold" id="S4.T4.2.7.7.3.1">55.97</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.7.7.4"><span class="ltx_text ltx_font_bold" id="S4.T4.2.7.7.4.1">25.12</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.7.7.5"><span class="ltx_text ltx_font_bold" id="S4.T4.2.7.7.5.1">63.06</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.7.7.6"><span class="ltx_text ltx_font_bold" id="S4.T4.2.7.7.6.1">7.69</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.7.7.7"><span class="ltx_text ltx_font_bold" id="S4.T4.2.7.7.7.1">37.22</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.7.7.8"><span class="ltx_text ltx_font_bold" id="S4.T4.2.7.7.8.1">21.04</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.2.7.7.9"><span class="ltx_text ltx_font_bold" id="S4.T4.2.7.7.9.1">52.08</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.8.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.2.8.8.1">SC2-3B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.8.8.2">21.88</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.8.8.3">46.74</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.8.8.4">18.81</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.8.8.5">56.66</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.8.8.6">4.40</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.8.8.7">29.99</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.8.8.8">15.03</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.2.8.8.9">44.46</td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.9.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T4.2.9.9.1">
<span class="ltx_ERROR undefined" id="S4.T4.2.9.9.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.9.2"><span class="ltx_text ltx_font_bold" id="S4.T4.2.9.9.2.1">26.56</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.9.3"><span class="ltx_text ltx_font_bold" id="S4.T4.2.9.9.3.1">50.56</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.9.4"><span class="ltx_text ltx_font_bold" id="S4.T4.2.9.9.4.1">23.06</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.9.5"><span class="ltx_text ltx_font_bold" id="S4.T4.2.9.9.5.1">61.02</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.9.6"><span class="ltx_text ltx_font_bold" id="S4.T4.2.9.9.6.1">7.25</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.9.7"><span class="ltx_text ltx_font_bold" id="S4.T4.2.9.9.7.1">33.79</span></td>
<td class="ltx_td ltx_align_center" id="S4.T4.2.9.9.8"><span class="ltx_text ltx_font_bold" id="S4.T4.2.9.9.8.1">18.96</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T4.2.9.9.9"><span class="ltx_text ltx_font_bold" id="S4.T4.2.9.9.9.1">48.46</span></td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.10.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T4.2.10.10.1">SC2-7B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.10.2">27.94</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.10.3">51.60</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.10.4">21.56</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.10.5">58.98</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.10.6">6.81</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.10.7">32.80</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T4.2.10.10.8">18.77</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T4.2.10.10.9">47.79</td>
</tr>
<tr class="ltx_tr" id="S4.T4.2.11.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S4.T4.2.11.11.1">
<span class="ltx_ERROR undefined" id="S4.T4.2.11.11.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.11.2"><span class="ltx_text ltx_font_bold" id="S4.T4.2.11.11.2.1">34.19</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.11.3"><span class="ltx_text ltx_font_bold" id="S4.T4.2.11.11.3.1">57.29</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.11.4"><span class="ltx_text ltx_font_bold" id="S4.T4.2.11.11.4.1">27.31</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.11.5"><span class="ltx_text ltx_font_bold" id="S4.T4.2.11.11.5.1">63.04</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.11.6"><span class="ltx_text ltx_font_bold" id="S4.T4.2.11.11.6.1">8.35</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.11.7"><span class="ltx_text ltx_font_bold" id="S4.T4.2.11.11.7.1">35.40</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T4.2.11.11.8"><span class="ltx_text ltx_font_bold" id="S4.T4.2.11.11.8.1">23.28</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S4.T4.2.11.11.9"><span class="ltx_text ltx_font_bold" id="S4.T4.2.11.11.9.1">51.91</span></td>
</tr>
</tbody>
</table>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 4: </span>
Exact Match (EM) and Edit Similarity (ES) results of training w/o and w/ HLP for different code LLMs on CrossCodeEval <cite class="ltx_cite ltx_citemacro_citep">(Ding et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib7" title="">2023</a>)</cite>, CrossCodeLongEval <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib25" title="">2024</a>)</cite>, and RepoEval <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib28" title="">2023</a>)</cite> using greedy decoding, following the experimental setting of existing work <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib25" title="">2024</a>)</cite>. Our evaluation is conducted under “Retrieval” mode, where evaluation prompts are constructed by prepending the retrieved cross-file context to the current file, to show the performance of repository-level cross-file code completion.
</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1">In addition to single-file FIM evaluation with SAFIM, we also evaluate the effectiveness of HLP on repository-level code Fill-in-the-Middle in cross-file scenarios via CrossCodeEval <cite class="ltx_cite ltx_citemacro_citep">(Ding et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib7" title="">2023</a>)</cite>, CrossCodeLongEval <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib25" title="">2024</a>)</cite>, and RepoEval <cite class="ltx_cite ltx_citemacro_citep">(Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib28" title="">2023</a>)</cite>. CrossCodeEval (Python) and CrossCodeLongEval are two repository-level cross-file benchmarks that leverage more than 1500 raw Python repositories to construct 12,665 examples across line, chunk, and function completion tasks, which are used for a more rigorous evaluation. RepoEval is another repository-level cross-file code completion benchmark consisting of 3,655 line, API, and function completion tasks created from 32 Python repositories. We follow existing work <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib25" title="">2024</a>)</cite> to evaluate the model’s FIM performance on these benchmarks and use Exact Match (EM) and Edit Similarity (ES) as our evaluation metrics. As shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.T4" title="Table 4 ‣ 4.2 Repository-Level Cross-File Code Fill-in-the-Middle ‣ 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">4</span></a>, adding HLP provides consistent improvements for all models across different benchmarks and completion tasks. Specifically, HLP achieves up to 24% improvements on EM and 9% improvements on ES relatively, showing its significant effectiveness.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Code Fixing via Fill-in-the-Middle</h3>
<div class="ltx_para ltx_noindent" id="S4.SS3.p1">
<p class="ltx_p" id="S4.SS3.p1.1">We use Defects4J <cite class="ltx_cite ltx_citemacro_citep">(Just et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib15" title="">2014</a>)</cite> to evaluate the performance of HLP on code fixing. Defects4J consists of open-source bugs found across 15 Java repositories. Following existing works <cite class="ltx_cite ltx_citemacro_citep">(Xia et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib27" title="">2023</a>; Xia &amp; Zhang, <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib26" title="">2023</a>)</cite>, we collect 313 single-hunk bugs from Defects4J that can be fixed by replacing or adding a continuous code hunk. Specifically, for each bug, models are prompted to generate the correct code hunk (<em class="ltx_emph ltx_font_italic" id="S4.SS3.p1.1.1">i.e.,</em> patch) given the left and right contexts of the buggy code hunk, and the whole test suite of the project will be executed to evaluate the correctness of the generated patch. Patches that can successfully pass the test suite are referred to as <span class="ltx_text ltx_font_italic" id="S4.SS3.p1.1.2">plausible patches</span> and we report the number of plausible patches as our evaluation metric. As shown in the "Code Fix" section of Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.T5" title="Table 5 ‣ 4.3 Code Fixing via Fill-in-the-Middle ‣ 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">5</span></a>, adding HLP during training results in relatively up to 18% more bugs fixed by the model.</p>
</div>
<figure class="ltx_table ltx_align_floatright" id="S4.T5">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S4.T5.5">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S4.T5.5.1.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S4.T5.5.1.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S4.T5.5.1.1.2"><span class="ltx_text ltx_font_bold" id="S4.T5.5.1.1.2.1">Code Fix</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="S4.T5.5.1.1.3"><span class="ltx_text ltx_font_bold" id="S4.T5.5.1.1.3.1">Code Reasoning</span></th>
</tr>
<tr class="ltx_tr" id="S4.T5.5.2.2">
<th class="ltx_td ltx_th ltx_th_row" id="S4.T5.5.2.2.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_t" id="S4.T5.5.2.2.2">Defects4J</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T5.5.2.2.3">CRUXEval-I</th>
<th class="ltx_td ltx_nopad_r ltx_align_center ltx_th ltx_th_column ltx_border_t" id="S4.T5.5.2.2.4">CRUXEval-O</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T5.5.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T5.5.3.1.1">DS-1.3B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S4.T5.5.3.1.2">33</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.5.3.1.3">42.0</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T5.5.3.1.4">31.0</td>
</tr>
<tr class="ltx_tr" id="S4.T5.5.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.5.4.2.1">
<span class="ltx_ERROR undefined" id="S4.T5.5.4.2.1.1">\hdashline</span>
   + HLP</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S4.T5.5.4.2.2"><span class="ltx_text ltx_font_bold" id="S4.T5.5.4.2.2.1">39</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.5.4.2.3"><span class="ltx_text ltx_font_bold" id="S4.T5.5.4.2.3.1">44.7</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.5.4.2.4"><span class="ltx_text ltx_font_bold" id="S4.T5.5.4.2.4.1">31.8</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.5.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T5.5.5.3.1">DS-6.7B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S4.T5.5.5.3.2">58</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.5.5.3.3">52.1</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T5.5.5.3.4">39.2</td>
</tr>
<tr class="ltx_tr" id="S4.T5.5.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.5.6.4.1">
<span class="ltx_ERROR undefined" id="S4.T5.5.6.4.1.1">\hdashline</span>
   + HLP</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S4.T5.5.6.4.2"><span class="ltx_text ltx_font_bold" id="S4.T5.5.6.4.2.1">59</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.5.6.4.3"><span class="ltx_text ltx_font_bold" id="S4.T5.5.6.4.3.1">52.4</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.5.6.4.4"><span class="ltx_text ltx_font_bold" id="S4.T5.5.6.4.4.1">39.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.5.7.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T5.5.7.5.1">SC2-3B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S4.T5.5.7.5.2">39</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.5.7.5.3">42.8</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T5.5.7.5.4">32.1</td>
</tr>
<tr class="ltx_tr" id="S4.T5.5.8.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S4.T5.5.8.6.1">
<span class="ltx_ERROR undefined" id="S4.T5.5.8.6.1.1">\hdashline</span>
   + HLP</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S4.T5.5.8.6.2"><span class="ltx_text ltx_font_bold" id="S4.T5.5.8.6.2.1">41</span></th>
<td class="ltx_td ltx_align_center" id="S4.T5.5.8.6.3"><span class="ltx_text ltx_font_bold" id="S4.T5.5.8.6.3.1">43.9</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S4.T5.5.8.6.4"><span class="ltx_text ltx_font_bold" id="S4.T5.5.8.6.4.1">32.6</span></td>
</tr>
<tr class="ltx_tr" id="S4.T5.5.9.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S4.T5.5.9.7.1">SC2-7B</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_t" id="S4.T5.5.9.7.2">41</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S4.T5.5.9.7.3">44.4</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S4.T5.5.9.7.4">35.9</td>
</tr>
<tr class="ltx_tr" id="S4.T5.5.10.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S4.T5.5.10.8.1">
<span class="ltx_ERROR undefined" id="S4.T5.5.10.8.1.1">\hdashline</span>
   + HLP</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_bb" id="S4.T5.5.10.8.2"><span class="ltx_text ltx_font_bold" id="S4.T5.5.10.8.2.1">47</span></th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S4.T5.5.10.8.3"><span class="ltx_text ltx_font_bold" id="S4.T5.5.10.8.3.1">45.5</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S4.T5.5.10.8.4"><span class="ltx_text ltx_font_bold" id="S4.T5.5.10.8.4.1">36.1</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 5: </span>
Code fixing and reasoning performance of models trained w/o and w/ HLP for different code LLMs on Defects4J and CRUXEval. On Defects4J. We report the number of plausible patches under greedy decoding. On CRUXEval, we follow the original setting to do sampling with <math alttext="T=0.2" class="ltx_Math" display="inline" id="S4.T5.3.m1.1"><semantics id="S4.T5.3.m1.1b"><mrow id="S4.T5.3.m1.1.1" xref="S4.T5.3.m1.1.1.cmml"><mi id="S4.T5.3.m1.1.1.2" xref="S4.T5.3.m1.1.1.2.cmml">T</mi><mo id="S4.T5.3.m1.1.1.1" xref="S4.T5.3.m1.1.1.1.cmml">=</mo><mn id="S4.T5.3.m1.1.1.3" xref="S4.T5.3.m1.1.1.3.cmml">0.2</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T5.3.m1.1c"><apply id="S4.T5.3.m1.1.1.cmml" xref="S4.T5.3.m1.1.1"><eq id="S4.T5.3.m1.1.1.1.cmml" xref="S4.T5.3.m1.1.1.1"></eq><ci id="S4.T5.3.m1.1.1.2.cmml" xref="S4.T5.3.m1.1.1.2">𝑇</ci><cn id="S4.T5.3.m1.1.1.3.cmml" type="float" xref="S4.T5.3.m1.1.1.3">0.2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T5.3.m1.1d">T=0.2</annotation><annotation encoding="application/x-llamapun" id="S4.T5.3.m1.1e">italic_T = 0.2</annotation></semantics></math> and <math alttext="n=10" class="ltx_Math" display="inline" id="S4.T5.4.m2.1"><semantics id="S4.T5.4.m2.1b"><mrow id="S4.T5.4.m2.1.1" xref="S4.T5.4.m2.1.1.cmml"><mi id="S4.T5.4.m2.1.1.2" xref="S4.T5.4.m2.1.1.2.cmml">n</mi><mo id="S4.T5.4.m2.1.1.1" xref="S4.T5.4.m2.1.1.1.cmml">=</mo><mn id="S4.T5.4.m2.1.1.3" xref="S4.T5.4.m2.1.1.3.cmml">10</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.T5.4.m2.1c"><apply id="S4.T5.4.m2.1.1.cmml" xref="S4.T5.4.m2.1.1"><eq id="S4.T5.4.m2.1.1.1.cmml" xref="S4.T5.4.m2.1.1.1"></eq><ci id="S4.T5.4.m2.1.1.2.cmml" xref="S4.T5.4.m2.1.1.2">𝑛</ci><cn id="S4.T5.4.m2.1.1.3.cmml" type="integer" xref="S4.T5.4.m2.1.1.3">10</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.T5.4.m2.1d">n=10</annotation><annotation encoding="application/x-llamapun" id="S4.T5.4.m2.1e">italic_n = 10</annotation></semantics></math> and to extract accurate input/output values from raw generation.
</figcaption>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.4 </span>Code Reasoning via Fill-in-the-Middle</h3>
<div class="ltx_para ltx_noindent" id="S4.SS4.p1">
<p class="ltx_p" id="S4.SS4.p1.1">Lastly, we examine whether HLP improves model performance on code reasoning beyond ordinary completion use cases. The motivation behind is that HLP aims to teach the model to plan ahead, and planning is a special subset of reasoning that requires an action sequence over a long time horizon <cite class="ltx_cite ltx_citemacro_citep">(Kang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib16" title="">2024</a>)</cite>. Towards this end, we consider CRUXEval <cite class="ltx_cite ltx_citemacro_citep">(Gu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib11" title="">2024</a>)</cite> which comprises 800 Python functions paired with two distinct tasks: CRUXEval-I, where LLMs need to predict the input from the known output, and CRUXEval-O, where LLMs are required to predict the output based on the given input.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS4.p2">
<p class="ltx_p" id="S4.SS4.p2.1">We reformat prompts of CRUXEval-I into FIM style and leave CRUXEval-O as L2R generation, both of which are evaluated in zero-shot setting. Different from previous subsections where post-processing is not used, we follow the same pipeline as in the original CRUXEval paper to extract accurate input/output values from generation because we are focusing on evaluating the reasoning capability of LLMs rather than their capability of generating correct code<span class="ltx_note ltx_role_footnote" id="footnote2"><sup class="ltx_note_mark">2</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">2</sup><span class="ltx_tag ltx_tag_note">2</span>In CRUXEval-I, we only want to evaluate the correctness of the input value infilled by LLMs in the given assertion. However, FIM-style prompts we use in the experiments does not restrict LLMs from writing multiple assertions before starting infilling the given assertion, which is useless in this task. So we use post-processing techniques to extract the input value infilled for the given assertion to better evaluate the reasoning capabilities.</span></span></span>. As shown in the "Code Reasoning" section of Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.T5" title="Table 5 ‣ 4.3 Code Fixing via Fill-in-the-Middle ‣ 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">5</span></a>, HLP demonstrates up to 6% improvements on both CRUXEval-I and CRUXEval-O tasks for all the code LLMs consistently, which shows that HLP also improves code reasoning capabilities of LLMs.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Next-Token Prediction Alone Cannot Yield Horizon Awareness</h2>
<figure class="ltx_table ltx_figure_panel ltx_align_center ltx_align_floatright" id="S5.T6">
<table class="ltx_tabular ltx_figure_panel ltx_guessed_headers ltx_align_middle" id="S5.2.2">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.2.2.2">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="S5.2.2.2.3"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.1.1.1.1">Training <math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.1.1.1.1.m1.1"><semantics id="S5.1.1.1.1.m1.1a"><mo id="S5.1.1.1.1.m1.1.1" stretchy="false" xref="S5.1.1.1.1.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.1.1.1.1.m1.1b"><ci id="S5.1.1.1.1.m1.1.1.cmml" xref="S5.1.1.1.1.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.1.1.1.1.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.1.1.1.1.m1.1d">↑</annotation></semantics></math>
</th>
<th class="ltx_td ltx_nopad_r ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="S5.2.2.2.2">Test <math alttext="\uparrow" class="ltx_Math" display="inline" id="S5.2.2.2.2.m1.1"><semantics id="S5.2.2.2.2.m1.1a"><mo id="S5.2.2.2.2.m1.1.1" stretchy="false" xref="S5.2.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="S5.2.2.2.2.m1.1b"><ci id="S5.2.2.2.2.m1.1.1.cmml" xref="S5.2.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.2.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="S5.2.2.2.2.m1.1d">↑</annotation></semantics></math>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.2.2.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.2.2.3.1.1">DS-1.3B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.2.2.3.1.2">0.455</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.2.2.3.1.3">0.440</td>
</tr>
<tr class="ltx_tr" id="S5.2.2.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.2.2.4.2.1">
<span class="ltx_ERROR undefined" id="S5.2.2.4.2.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S5.2.2.4.2.2"><span class="ltx_text ltx_font_bold" id="S5.2.2.4.2.2.1">0.919</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.2.2.4.2.3"><span class="ltx_text ltx_font_bold" id="S5.2.2.4.2.3.1">0.915</span></td>
</tr>
<tr class="ltx_tr" id="S5.2.2.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.2.2.5.3.1">DS-6.7B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.2.2.5.3.2">0.525</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.2.2.5.3.3">0.519</td>
</tr>
<tr class="ltx_tr" id="S5.2.2.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.2.2.6.4.1">
<span class="ltx_ERROR undefined" id="S5.2.2.6.4.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S5.2.2.6.4.2"><span class="ltx_text ltx_font_bold" id="S5.2.2.6.4.2.1">0.919</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.2.2.6.4.3"><span class="ltx_text ltx_font_bold" id="S5.2.2.6.4.3.1">0.913</span></td>
</tr>
<tr class="ltx_tr" id="S5.2.2.7.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.2.2.7.5.1">SC2-3B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.2.2.7.5.2">0.364</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.2.2.7.5.3">0.356</td>
</tr>
<tr class="ltx_tr" id="S5.2.2.8.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S5.2.2.8.6.1">
<span class="ltx_ERROR undefined" id="S5.2.2.8.6.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center" id="S5.2.2.8.6.2"><span class="ltx_text ltx_font_bold" id="S5.2.2.8.6.2.1">0.927</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="S5.2.2.8.6.3"><span class="ltx_text ltx_font_bold" id="S5.2.2.8.6.3.1">0.932</span></td>
</tr>
<tr class="ltx_tr" id="S5.2.2.9.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.2.2.9.7.1">SC2-7B</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S5.2.2.9.7.2">0.418</td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="S5.2.2.9.7.3">0.410</td>
</tr>
<tr class="ltx_tr" id="S5.2.2.10.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="S5.2.2.10.8.1">
<span class="ltx_ERROR undefined" id="S5.2.2.10.8.1.1">\hdashline</span>
   + HLP</th>
<td class="ltx_td ltx_align_center ltx_border_bb" id="S5.2.2.10.8.2"><span class="ltx_text ltx_font_bold" id="S5.2.2.10.8.2.1">0.929</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb" id="S5.2.2.10.8.3"><span class="ltx_text ltx_font_bold" id="S5.2.2.10.8.3.1">0.932</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 6: </span>Probing results of models trained w/o and w/ HLP. We report the coefficient of determination <math alttext="(R^{2})" class="ltx_Math" display="inline" id="S5.T6.2.m1.1"><semantics id="S5.T6.2.m1.1b"><mrow id="S5.T6.2.m1.1.1.1" xref="S5.T6.2.m1.1.1.1.1.cmml"><mo id="S5.T6.2.m1.1.1.1.2" stretchy="false" xref="S5.T6.2.m1.1.1.1.1.cmml">(</mo><msup id="S5.T6.2.m1.1.1.1.1" xref="S5.T6.2.m1.1.1.1.1.cmml"><mi id="S5.T6.2.m1.1.1.1.1.2" xref="S5.T6.2.m1.1.1.1.1.2.cmml">R</mi><mn id="S5.T6.2.m1.1.1.1.1.3" xref="S5.T6.2.m1.1.1.1.1.3.cmml">2</mn></msup><mo id="S5.T6.2.m1.1.1.1.3" stretchy="false" xref="S5.T6.2.m1.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.T6.2.m1.1c"><apply id="S5.T6.2.m1.1.1.1.1.cmml" xref="S5.T6.2.m1.1.1.1"><csymbol cd="ambiguous" id="S5.T6.2.m1.1.1.1.1.1.cmml" xref="S5.T6.2.m1.1.1.1">superscript</csymbol><ci id="S5.T6.2.m1.1.1.1.1.2.cmml" xref="S5.T6.2.m1.1.1.1.1.2">𝑅</ci><cn id="S5.T6.2.m1.1.1.1.1.3.cmml" type="integer" xref="S5.T6.2.m1.1.1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.T6.2.m1.1d">(R^{2})</annotation><annotation encoding="application/x-llamapun" id="S5.T6.2.m1.1e">( italic_R start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT )</annotation></semantics></math> of prediction, which is the higher the better.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">We argue that NTP alone does not grant code LLMs the awareness of prediction horizon. Specifically, we show that hidden states of baseline models trained with NTP only do not carry information about the number of future tokens (<em class="ltx_emph ltx_font_italic" id="S5.p1.1.1">i.e.,</em> horizon length). Consequently, including HLP in training is essential for models to be knowledgeable of prediction horizon.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.p2">
<p class="ltx_p" id="S5.p2.1">We design a probing task by fitting linear regression models over hidden states of code LLMs trained with or without HLP respectively, while freezing all parameters of the underlying transformers. In our experiments, we use different models to generate hidden states for 20K code snippets, which gives hidden state vectors for 7.8M tokens from the <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S5.p2.1.m1.1"><semantics id="S5.p2.1.m1.1a"><mi id="S5.p2.1.m1.1.1" xref="S5.p2.1.m1.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S5.p2.1.m1.1b"><ci id="S5.p2.1.m1.1.1.cmml" xref="S5.p2.1.m1.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.p2.1.m1.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S5.p2.1.m1.1d">sansserif_middle</annotation></semantics></math> part. We split them into the training and the test set, ensuring no overlap at sequence level. Taking these hidden state vectors as inputs and the true normalized remaining token counts as targets, we fit two linear regression models for each code LLM trained with or without HLP, respectively.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.p3">
<p class="ltx_p" id="S5.p3.1">We plot the predicted percentage of remaining tokens versus the normalized token position in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S5.F4" title="Figure 4 ‣ 5 Next-Token Prediction Alone Cannot Yield Horizon Awareness ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">4</span></a>, and report the coefficient of determination <math alttext="(R^{2})" class="ltx_Math" display="inline" id="S5.p3.1.m1.1"><semantics id="S5.p3.1.m1.1a"><mrow id="S5.p3.1.m1.1.1.1" xref="S5.p3.1.m1.1.1.1.1.cmml"><mo id="S5.p3.1.m1.1.1.1.2" stretchy="false" xref="S5.p3.1.m1.1.1.1.1.cmml">(</mo><msup id="S5.p3.1.m1.1.1.1.1" xref="S5.p3.1.m1.1.1.1.1.cmml"><mi id="S5.p3.1.m1.1.1.1.1.2" xref="S5.p3.1.m1.1.1.1.1.2.cmml">R</mi><mn id="S5.p3.1.m1.1.1.1.1.3" xref="S5.p3.1.m1.1.1.1.1.3.cmml">2</mn></msup><mo id="S5.p3.1.m1.1.1.1.3" stretchy="false" xref="S5.p3.1.m1.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.p3.1.m1.1b"><apply id="S5.p3.1.m1.1.1.1.1.cmml" xref="S5.p3.1.m1.1.1.1"><csymbol cd="ambiguous" id="S5.p3.1.m1.1.1.1.1.1.cmml" xref="S5.p3.1.m1.1.1.1">superscript</csymbol><ci id="S5.p3.1.m1.1.1.1.1.2.cmml" xref="S5.p3.1.m1.1.1.1.1.2">𝑅</ci><cn id="S5.p3.1.m1.1.1.1.1.3.cmml" type="integer" xref="S5.p3.1.m1.1.1.1.1.3">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.p3.1.m1.1c">(R^{2})</annotation><annotation encoding="application/x-llamapun" id="S5.p3.1.m1.1d">( italic_R start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT )</annotation></semantics></math> in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S5.T6" title="Table 6 ‣ 5 Next-Token Prediction Alone Cannot Yield Horizon Awareness ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">6</span></a>. As shown, the regression model does not fit well with hidden states from the baseline model, indicating that those hidden states are not strongly correlated with future token count and do not contain information about horizon length. In contrast, with HLP, the hidden states perform much better. The result demonstrates that horizon awareness does not naturally exist in language models trained with NTP, and can only be obtained through targeted training tasks such as HLP.</p>
</div>
<figure class="ltx_figure" id="S5.F4">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F4.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="147" id="S5.F4.sf1.g1" src="x4.png" width="191"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(a) </span></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F4.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="146" id="S5.F4.sf2.g1" src="x5.png" width="179"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(b) </span></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F4.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="146" id="S5.F4.sf3.g1" src="x6.png" width="179"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(c) </span></figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F4.sf4"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="146" id="S5.F4.sf4.g1" src="x7.png" width="179"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(d) </span></figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span>Predicted percentage of remaining future tokens (as defined in Eq. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S3.E3" title="In 3 Horizon-Length Prediction ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">3</span></a>)) from models trained w/o and w/ HLP at different token positions, where the concrete position of each token is normalized to the corresponding percentage over the whole sequence.</figcaption>
</figure>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Related Work</h2>
<div class="ltx_para ltx_noindent" id="S6.p1">
<p class="ltx_p" id="S6.p1.1"><span class="ltx_text ltx_font_bold" id="S6.p1.1.1">Fill-in-the-Middle for Code Language Models </span>
The unprecedented success of causal language models such as GPT-3 <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib3" title="">2020</a>)</cite> in natural language has inspired researchers to develop similar decoder-only models for programming languages. These models are trained on massive source code data for applications such as code generation. While early models such as Codex <cite class="ltx_cite ltx_citemacro_citep">(Chen et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib4" title="">2021</a>)</cite> and CodeGen <cite class="ltx_cite ltx_citemacro_citep">(Nijkamp et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib23" title="">2023</a>)</cite> only support Left-to-Right (L2R) generation, Fill-in-the-Middle (or infilling) has attracted increased attention because right context naturally carries an indispensable part of information for completing code in the middle <cite class="ltx_cite ltx_citemacro_citep">(Fried et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib8" title="">2023</a>; Bavarian et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib2" title="">2022</a>)</cite>. Subsequently, FIM training has become a common practice widely adopted by most code LLMs, such as StarCoder <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib17" title="">2023</a>; Lozhkov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib20" title="">2024</a>)</cite>, DeepSeek-Coder <cite class="ltx_cite ltx_citemacro_citep">(Guo et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib12" title="">2024</a>; DeepSeek-AI et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib5" title="">2024</a>)</cite>, and Code Llama <cite class="ltx_cite ltx_citemacro_citep">(Rozière et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib24" title="">2023</a>)</cite>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p2">
<p class="ltx_p" id="S6.p2.9">Existing models generally tackle the infilling problem by breaking a code snippet into <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S6.p2.1.m1.1"><semantics id="S6.p2.1.m1.1a"><mi id="S6.p2.1.m1.1.1" xref="S6.p2.1.m1.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S6.p2.1.m1.1b"><ci id="S6.p2.1.m1.1.1.cmml" xref="S6.p2.1.m1.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.1.m1.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.1.m1.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S6.p2.2.m2.1"><semantics id="S6.p2.2.m2.1a"><mi id="S6.p2.2.m2.1.1" xref="S6.p2.2.m2.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S6.p2.2.m2.1b"><ci id="S6.p2.2.m2.1.1.cmml" xref="S6.p2.2.m2.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.2.m2.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.2.m2.1d">sansserif_middle</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S6.p2.3.m3.1"><semantics id="S6.p2.3.m3.1a"><mi id="S6.p2.3.m3.1.1" xref="S6.p2.3.m3.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S6.p2.3.m3.1b"><ci id="S6.p2.3.m3.1.1.cmml" xref="S6.p2.3.m3.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.3.m3.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.3.m3.1d">sansserif_suffix</annotation></semantics></math>, and reordering them into <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S6.p2.4.m4.1"><semantics id="S6.p2.4.m4.1a"><mi id="S6.p2.4.m4.1.1" xref="S6.p2.4.m4.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S6.p2.4.m4.1b"><ci id="S6.p2.4.m4.1.1.cmml" xref="S6.p2.4.m4.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.4.m4.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.4.m4.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S6.p2.5.m5.1"><semantics id="S6.p2.5.m5.1a"><mi id="S6.p2.5.m5.1.1" xref="S6.p2.5.m5.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S6.p2.5.m5.1b"><ci id="S6.p2.5.m5.1.1.cmml" xref="S6.p2.5.m5.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.5.m5.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.5.m5.1d">sansserif_suffix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S6.p2.6.m6.1"><semantics id="S6.p2.6.m6.1a"><mi id="S6.p2.6.m6.1.1" xref="S6.p2.6.m6.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S6.p2.6.m6.1b"><ci id="S6.p2.6.m6.1.1.cmml" xref="S6.p2.6.m6.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.6.m6.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.6.m6.1d">sansserif_middle</annotation></semantics></math> (PSM) or <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S6.p2.7.m7.1"><semantics id="S6.p2.7.m7.1a"><mi id="S6.p2.7.m7.1.1" xref="S6.p2.7.m7.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S6.p2.7.m7.1b"><ci id="S6.p2.7.m7.1.1.cmml" xref="S6.p2.7.m7.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.7.m7.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.7.m7.1d">sansserif_suffix</annotation></semantics></math>-<math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S6.p2.8.m8.1"><semantics id="S6.p2.8.m8.1a"><mi id="S6.p2.8.m8.1.1" xref="S6.p2.8.m8.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S6.p2.8.m8.1b"><ci id="S6.p2.8.m8.1.1.cmml" xref="S6.p2.8.m8.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.8.m8.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.8.m8.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S6.p2.9.m9.1"><semantics id="S6.p2.9.m9.1a"><mi id="S6.p2.9.m9.1.1" xref="S6.p2.9.m9.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S6.p2.9.m9.1b"><ci id="S6.p2.9.m9.1.1.cmml" xref="S6.p2.9.m9.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p2.9.m9.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S6.p2.9.m9.1d">sansserif_middle</annotation></semantics></math> (SPM). The transformed sequences are fed to the model during training for standard next-token prediction (NTP). We point out that the infilling task cannot be effectively learned with NTP alone, as it requires planning capability for the model to fluently and meaningfully connect the middle completion to the suffix through forward looking during auto-regressive decoding.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p3">
<p class="ltx_p" id="S6.p3.1">An alternative approach is to train two language models in different directions, with one generating from left to right and the other from right to left, and have the two generations meet in the middle <cite class="ltx_cite ltx_citemacro_citep">(Nguyen et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib22" title="">2023</a>)</cite>. Nevertheless, the L2R model does not have access to the right context, and vice versa, which impedes holistic planning that takes into account the context from both sides.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p4">
<p class="ltx_p" id="S6.p4.1"><span class="ltx_text ltx_font_bold" id="S6.p4.1.1">Planning and Lookahead in Language Generation </span> Standard decoder-only models are trained with next-token prediction and used to sequentially predict one token at a time, conditioned only on past tokens, in an auto-regressive manner. One drawback of this paradigm is that models are not aware of future tokens during decoding. The token that maximizes the conditional probability at current step may lead to suboptimal continuation, and consequently the model can fail to compose a fluent and sensible generation that meets human requirements. Various decoding techniques have been proposed to address the problem through tree search with lookahead heuristics, particularly for constrained generation problems <cite class="ltx_cite ltx_citemacro_citep">(Lu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib21" title="">2022</a>; Huang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib13" title="">2024</a>)</cite>. While these methods are training-free, they inevitably incur additional cost of inference complexity.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p5">
<p class="ltx_p" id="S6.p5.5">Apart from those, <cite class="ltx_cite ltx_citemacro_cite">Gloeckle et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib9" title="">2024</a>)</cite> proposed to predict multiple tokens from a single hidden state during both training and inference, which was shown to achieve stronger performance on coding tasks with no computation overhead. While multi-token prediction enhances models’ planning capability within the <math alttext="n" class="ltx_Math" display="inline" id="S6.p5.1.m1.1"><semantics id="S6.p5.1.m1.1a"><mi id="S6.p5.1.m1.1.1" xref="S6.p5.1.m1.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S6.p5.1.m1.1b"><ci id="S6.p5.1.m1.1.1.cmml" xref="S6.p5.1.m1.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p5.1.m1.1c">n</annotation><annotation encoding="application/x-llamapun" id="S6.p5.1.m1.1d">italic_n</annotation></semantics></math> tokens predicted together (<math alttext="n\leq 8" class="ltx_Math" display="inline" id="S6.p5.2.m2.1"><semantics id="S6.p5.2.m2.1a"><mrow id="S6.p5.2.m2.1.1" xref="S6.p5.2.m2.1.1.cmml"><mi id="S6.p5.2.m2.1.1.2" xref="S6.p5.2.m2.1.1.2.cmml">n</mi><mo id="S6.p5.2.m2.1.1.1" xref="S6.p5.2.m2.1.1.1.cmml">≤</mo><mn id="S6.p5.2.m2.1.1.3" xref="S6.p5.2.m2.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S6.p5.2.m2.1b"><apply id="S6.p5.2.m2.1.1.cmml" xref="S6.p5.2.m2.1.1"><leq id="S6.p5.2.m2.1.1.1.cmml" xref="S6.p5.2.m2.1.1.1"></leq><ci id="S6.p5.2.m2.1.1.2.cmml" xref="S6.p5.2.m2.1.1.2">𝑛</ci><cn id="S6.p5.2.m2.1.1.3.cmml" type="integer" xref="S6.p5.2.m2.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S6.p5.2.m2.1c">n\leq 8</annotation><annotation encoding="application/x-llamapun" id="S6.p5.2.m2.1d">italic_n ≤ 8</annotation></semantics></math>), we argue that with a small <math alttext="n" class="ltx_Math" display="inline" id="S6.p5.3.m3.1"><semantics id="S6.p5.3.m3.1a"><mi id="S6.p5.3.m3.1.1" xref="S6.p5.3.m3.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S6.p5.3.m3.1b"><ci id="S6.p5.3.m3.1.1.cmml" xref="S6.p5.3.m3.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p5.3.m3.1c">n</annotation><annotation encoding="application/x-llamapun" id="S6.p5.3.m3.1d">italic_n</annotation></semantics></math>, the limited horizon is usually insufficient for planning in the case of infilling as the connection from <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S6.p5.4.m4.1"><semantics id="S6.p5.4.m4.1a"><mi id="S6.p5.4.m4.1.1" xref="S6.p5.4.m4.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S6.p5.4.m4.1b"><ci id="S6.p5.4.m4.1.1.cmml" xref="S6.p5.4.m4.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p5.4.m4.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S6.p5.4.m4.1d">sansserif_middle</annotation></semantics></math> to <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S6.p5.5.m5.1"><semantics id="S6.p5.5.m5.1a"><mi id="S6.p5.5.m5.1.1" xref="S6.p5.5.m5.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S6.p5.5.m5.1b"><ci id="S6.p5.5.m5.1.1.cmml" xref="S6.p5.5.m5.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S6.p5.5.m5.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S6.p5.5.m5.1d">sansserif_suffix</annotation></semantics></math> only happens towards the end of the generation. In contrast, HLP adopts a global and arbitrary long horizon over all future tokens by counting the remaining generation budget, which more effectively helps models to close the generation fluently with early planning.</p>
</div>
</section>
<section class="ltx_section" id="S7">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">7 </span>Conclusion</h2>
<div class="ltx_para ltx_noindent" id="S7.p1">
<p class="ltx_p" id="S7.p1.9">Fill-in-the-Middle is ubiquitous in code completion, and therefore, has become an important consideration in the development of code language models. The current FIM training paradigm splits and reorders original training sequences (<math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S7.p1.1.m1.1"><semantics id="S7.p1.1.m1.1a"><mi id="S7.p1.1.m1.1.1" xref="S7.p1.1.m1.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S7.p1.1.m1.1b"><ci id="S7.p1.1.m1.1.1.cmml" xref="S7.p1.1.m1.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.1.m1.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.1.m1.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S7.p1.2.m2.1"><semantics id="S7.p1.2.m2.1a"><mi id="S7.p1.2.m2.1.1" xref="S7.p1.2.m2.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S7.p1.2.m2.1b"><ci id="S7.p1.2.m2.1.1.cmml" xref="S7.p1.2.m2.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.2.m2.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.2.m2.1d">sansserif_middle</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S7.p1.3.m3.1"><semantics id="S7.p1.3.m3.1a"><mi id="S7.p1.3.m3.1.1" xref="S7.p1.3.m3.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S7.p1.3.m3.1b"><ci id="S7.p1.3.m3.1.1.cmml" xref="S7.p1.3.m3.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.3.m3.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.3.m3.1d">sansserif_suffix</annotation></semantics></math>) into FIM-style sequences (<math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S7.p1.4.m4.1"><semantics id="S7.p1.4.m4.1a"><mi id="S7.p1.4.m4.1.1" xref="S7.p1.4.m4.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S7.p1.4.m4.1b"><ci id="S7.p1.4.m4.1.1.cmml" xref="S7.p1.4.m4.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.4.m4.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.4.m4.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S7.p1.5.m5.1"><semantics id="S7.p1.5.m5.1a"><mi id="S7.p1.5.m5.1.1" xref="S7.p1.5.m5.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S7.p1.5.m5.1b"><ci id="S7.p1.5.m5.1.1.cmml" xref="S7.p1.5.m5.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.5.m5.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.5.m5.1d">sansserif_suffix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S7.p1.6.m6.1"><semantics id="S7.p1.6.m6.1a"><mi id="S7.p1.6.m6.1.1" xref="S7.p1.6.m6.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S7.p1.6.m6.1b"><ci id="S7.p1.6.m6.1.1.cmml" xref="S7.p1.6.m6.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.6.m6.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.6.m6.1d">sansserif_middle</annotation></semantics></math>/PSM or <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="S7.p1.7.m7.1"><semantics id="S7.p1.7.m7.1a"><mi id="S7.p1.7.m7.1.1" xref="S7.p1.7.m7.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S7.p1.7.m7.1b"><ci id="S7.p1.7.m7.1.1.cmml" xref="S7.p1.7.m7.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.7.m7.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.7.m7.1d">sansserif_suffix</annotation></semantics></math>-<math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="S7.p1.8.m8.1"><semantics id="S7.p1.8.m8.1a"><mi id="S7.p1.8.m8.1.1" xref="S7.p1.8.m8.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="S7.p1.8.m8.1b"><ci id="S7.p1.8.m8.1.1.cmml" xref="S7.p1.8.m8.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.8.m8.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.8.m8.1d">sansserif_prefix</annotation></semantics></math>-<math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="S7.p1.9.m9.1"><semantics id="S7.p1.9.m9.1a"><mi id="S7.p1.9.m9.1.1" xref="S7.p1.9.m9.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="S7.p1.9.m9.1b"><ci id="S7.p1.9.m9.1.1.cmml" xref="S7.p1.9.m9.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="S7.p1.9.m9.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="S7.p1.9.m9.1d">sansserif_middle</annotation></semantics></math>/SPM), and performs standard next-token prediction. However, this approach frequently results in models struggling to generate content that smoothly aligns with the right context. While existing FIM benchmarks frequently rely on different post-processing methods to circumvent this problem, we emphasize that such methods typically require dataset-specific assumptions, which are impractical in real-world scenarios. To address this limitation and enhance the infilling capability of code language models, we propose <span class="ltx_text ltx_font_bold" id="S7.p1.9.1">Horizon-Length Prediction</span> (<span class="ltx_text ltx_font_bold" id="S7.p1.9.2">HLP</span>). HLP teaches models to predict the portion of remaining tokens at every step. Experiments across different model families and sizes show that HLP improves infilling performance on diverse FIM benchmarks, across file-level and repository-level, and without using any dataset-specific post-processing. Moreover, the enhanced planning capability acquired through HLP training also boosts models’ performance on code reasoning tasks, suggesting that HLP may broadly improve language models’ reasoning capabilities. Besides, HLP is also efficient as it does not cause any inference overhead and the training overhead is negligible as well. Our work marks a significant advancement in developing more effective code language models for real-world applications.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Austin et al. (2021)</span>
<span class="ltx_bibblock">
Jacob Austin, Augustus Odena, Maxwell I. Nye, Maarten Bosma, Henryk Michalewski, David Dohan, Ellen Jiang, Carrie J. Cai, Michael Terry, Quoc V. Le, and Charles Sutton.

</span>
<span class="ltx_bibblock">Program synthesis with large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">ArXiv preprint</em>, abs/2108.07732, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2108.07732" title="">https://arxiv.org/abs/2108.07732</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bavarian et al. (2022)</span>
<span class="ltx_bibblock">
Mohammad Bavarian, Heewoo Jun, Nikolas Tezak, John Schulman, Christine McLeavey, Jerry Tworek, and Mark Chen.

</span>
<span class="ltx_bibblock">Efficient training of language models to fill in the middle, 2022.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2207.14255" title="">https://arxiv.org/abs/2207.14255</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Brown et al. (2020)</span>
<span class="ltx_bibblock">
Tom B. Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared Kaplan, Prafulla Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell, Sandhini Agarwal, Ariel Herbert-Voss, Gretchen Krueger, Tom Henighan, Rewon Child, Aditya Ramesh, Daniel M. Ziegler, Jeffrey Wu, Clemens Winter, Christopher Hesse, Mark Chen, Eric Sigler, Mateusz Litwin, Scott Gray, Benjamin Chess, Jack Clark, Christopher Berner, Sam McCandlish, Alec Radford, Ilya Sutskever, and Dario Amodei.

</span>
<span class="ltx_bibblock">Language models are few-shot learners.

</span>
<span class="ltx_bibblock">In Hugo Larochelle, Marc’Aurelio Ranzato, Raia Hadsell, Maria-Florina Balcan, and Hsuan-Tien Lin (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">Advances in Neural Information Processing Systems 33: Annual Conference on Neural Information Processing Systems 2020, NeurIPS 2020, December 6-12, 2020, virtual</em>, 2020.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper/2020/hash/1457c0d6bfcb4967418bfb8ac142f64a-Abstract.html" title="">https://proceedings.neurips.cc/paper/2020/hash/1457c0d6bfcb4967418bfb8ac142f64a-Abstract.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al. (2021)</span>
<span class="ltx_bibblock">
Mark Chen, Jerry Tworek, Heewoo Jun, Qiming Yuan, Henrique Ponde de Oliveira Pinto, Jared Kaplan, Harri Edwards, Yuri Burda, Nicholas Joseph, Greg Brockman, Alex Ray, Raul Puri, Gretchen Krueger, Michael Petrov, Heidy Khlaaf, Girish Sastry, Pamela Mishkin, Brooke Chan, Scott Gray, Nick Ryder, Mikhail Pavlov, Alethea Power, Lukasz Kaiser, Mohammad Bavarian, Clemens Winter, Philippe Tillet, Felipe Petroski Such, Dave Cummings, Matthias Plappert, Fotios Chantzis, Elizabeth Barnes, Ariel Herbert-Voss, William Hebgen Guss, Alex Nichol, Alex Paino, Nikolas Tezak, Jie Tang, Igor Babuschkin, Suchir Balaji, Shantanu Jain, William Saunders, Christopher Hesse, Andrew N. Carr, Jan Leike, Josh Achiam, Vedant Misra, Evan Morikawa, Alec Radford, Matthew Knight, Miles Brundage, Mira Murati, Katie Mayer, Peter Welinder, Bob McGrew, Dario Amodei, Sam McCandlish, Ilya Sutskever, and Wojciech Zaremba.

</span>
<span class="ltx_bibblock">Evaluating large language models trained on code, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2107.03374" title="">https://arxiv.org/abs/2107.03374</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">DeepSeek-AI et al. (2024)</span>
<span class="ltx_bibblock">
DeepSeek-AI, Qihao Zhu, Daya Guo, Zhihong Shao, Dejian Yang, Peiyi Wang, Runxin Xu, Y. Wu, Yukun Li, Huazuo Gao, Shirong Ma, Wangding Zeng, Xiao Bi, Zihui Gu, Hanwei Xu, Damai Dai, Kai Dong, Liyue Zhang, Yishi Piao, Zhibin Gou, Zhenda Xie, Zhewen Hao, Bingxuan Wang, Junxiao Song, Deli Chen, Xin Xie, Kang Guan, Yuxiang You, Aixin Liu, Qiushi Du, Wenjun Gao, Xuan Lu, Qinyu Chen, Yaohui Wang, Chengqi Deng, Jiashi Li, Chenggang Zhao, Chong Ruan, Fuli Luo, and Wenfeng Liang.

</span>
<span class="ltx_bibblock">Deepseek-coder-v2: Breaking the barrier of closed-source models in code intelligence, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2406.11931" title="">https://arxiv.org/abs/2406.11931</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ding et al. (2024)</span>
<span class="ltx_bibblock">
Hantian Ding, Zijian Wang, Giovanni Paolini, Varun Kumar, Anoop Deoras, Dan Roth, and Stefano Soatto.

</span>
<span class="ltx_bibblock">Fewer truncations improve language modeling, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2404.10830" title="">https://arxiv.org/abs/2404.10830</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ding et al. (2023)</span>
<span class="ltx_bibblock">
Yangruibo Ding, Zijian Wang, Wasi Uddin Ahmad, Hantian Ding, Ming Tan, Nihal Jain, Murali Krishna Ramanathan, Ramesh Nallapati, Parminder Bhatia, Dan Roth, and Bing Xiang.

</span>
<span class="ltx_bibblock">Crosscodeeval: A diverse and multilingual benchmark for cross-file code completion.

</span>
<span class="ltx_bibblock">In Alice Oh, Tristan Naumann, Amir Globerson, Kate Saenko, Moritz Hardt, and Sergey Levine (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Advances in Neural Information Processing Systems 36: Annual Conference on Neural Information Processing Systems 2023, NeurIPS 2023, New Orleans, LA, USA, December 10 - 16, 2023</em>, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://papers.nips.cc/paper_files/paper/2023/hash/920f2dced7d32ab2ba2f1970bc306af6-Abstract-Datasets_and_Benchmarks.html" title="">http://papers.nips.cc/paper_files/paper/2023/hash/920f2dced7d32ab2ba2f1970bc306af6-Abstract-Datasets_and_Benchmarks.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fried et al. (2023)</span>
<span class="ltx_bibblock">
Daniel Fried, Armen Aghajanyan, Jessy Lin, Sida Wang, Eric Wallace, Freda Shi, Ruiqi Zhong, Scott Yih, Luke Zettlemoyer, and Mike Lewis.

</span>
<span class="ltx_bibblock">Incoder: A generative model for code infilling and synthesis.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">The Eleventh International Conference on Learning Representations, ICLR 2023, Kigali, Rwanda, May 1-5, 2023</em>. OpenReview.net, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/pdf?id=hQwb-lbM6EL" title="">https://openreview.net/pdf?id=hQwb-lbM6EL</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gloeckle et al. (2024)</span>
<span class="ltx_bibblock">
Fabian Gloeckle, Badr Youbi Idrissi, Baptiste Rozière, David Lopez-Paz, and Gabriele Synnaeve.

</span>
<span class="ltx_bibblock">Better &amp; faster large language models via multi-token prediction.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">ArXiv preprint</em>, abs/2404.19737, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2404.19737" title="">https://arxiv.org/abs/2404.19737</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gong et al. (2024)</span>
<span class="ltx_bibblock">
Linyuan Gong, Sida Wang, Mostafa Elhoushi, and Alvin Cheung.

</span>
<span class="ltx_bibblock">Evaluation of llms on syntax-aware code fill-in-the-middle tasks, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2403.04814" title="">https://arxiv.org/abs/2403.04814</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gu et al. (2024)</span>
<span class="ltx_bibblock">
Alex Gu, Baptiste Rozière, Hugh Leather, Armando Solar-Lezama, Gabriel Synnaeve, and Sida I. Wang.

</span>
<span class="ltx_bibblock">Cruxeval: A benchmark for code reasoning, understanding and execution, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2401.03065" title="">https://arxiv.org/abs/2401.03065</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Guo et al. (2024)</span>
<span class="ltx_bibblock">
Daya Guo, Qihao Zhu, Dejian Yang, Zhenda Xie, Kai Dong, Wentao Zhang, Guanting Chen, Xiao Bi, Y. Wu, Y. K. Li, Fuli Luo, Yingfei Xiong, and Wenfeng Liang.

</span>
<span class="ltx_bibblock">Deepseek-coder: When the large language model meets programming – the rise of code intelligence, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2401.14196" title="">https://arxiv.org/abs/2401.14196</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Huang et al. (2024)</span>
<span class="ltx_bibblock">
James Y. Huang, Sailik Sengupta, Daniele Bonadiman, Yi an Lai, Arshit Gupta, Nikolaos Pappas, Saab Mansour, Katrin Kirchoff, and Dan Roth.

</span>
<span class="ltx_bibblock">Deal: Decoding-time alignment for large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">ArXiv preprint</em>, abs/2402.06147, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2402.06147" title="">https://arxiv.org/abs/2402.06147</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hui et al. (2024)</span>
<span class="ltx_bibblock">
Binyuan Hui, Jian Yang, Zeyu Cui, Jiaxi Yang, Dayiheng Liu, Lei Zhang, Tianyu Liu, Jiajun Zhang, Bowen Yu, Kai Dang, An Yang, Rui Men, Fei Huang, Xingzhang Ren, Xuancheng Ren, Jingren Zhou, and Junyang Lin.

</span>
<span class="ltx_bibblock">Qwen2.5-coder technical report, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2409.12186" title="">https://arxiv.org/abs/2409.12186</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Just et al. (2014)</span>
<span class="ltx_bibblock">
René Just, Darioush Jalali, and Michael D. Ernst.

</span>
<span class="ltx_bibblock">Defects4j: a database of existing faults to enable controlled testing studies for java programs.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">Proceedings of the 2014 International Symposium on Software Testing and Analysis</em>, ISSTA 2014, pp.  437–440, New York, NY, USA, 2014. Association for Computing Machinery.

</span>
<span class="ltx_bibblock">ISBN 9781450326452.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.1145/2610384.2628055</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.1145/2610384.2628055" title="">https://doi.org/10.1145/2610384.2628055</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kang et al. (2024)</span>
<span class="ltx_bibblock">
Liwei Kang, Zirui Zhao, David Hsu, and Wee Sun Lee.

</span>
<span class="ltx_bibblock">On the empirical complexity of reasoning and planning in llms, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2404.11041" title="">https://arxiv.org/abs/2404.11041</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2023)</span>
<span class="ltx_bibblock">
Raymond Li, Loubna Ben Allal, Yangtian Zi, Niklas Muennighoff, Denis Kocetkov, Chenghao Mou, Marc Marone, Christopher Akiki, Jia Li, Jenny Chim, Qian Liu, Evgenii Zheltonozhskii, Terry Yue Zhuo, Thomas Wang, Olivier Dehaene, Mishig Davaadorj, Joel Lamy-Poirier, João Monteiro, Oleh Shliazhko, Nicolas Gontier, Nicholas Meade, Armel Zebaze, Ming-Ho Yee, Logesh Kumar Umapathi, Jian Zhu, Benjamin Lipkin, Muhtasham Oblokulov, Zhiruo Wang, Rudra Murthy, Jason Stillerman, Siva Sankalp Patel, Dmitry Abulkhanov, Marco Zocca, Manan Dey, Zhihan Zhang, Nour Fahmy, Urvashi Bhattacharyya, Wenhao Yu, Swayam Singh, Sasha Luccioni, Paulo Villegas, Maxim Kunakov, Fedor Zhdanov, Manuel Romero, Tony Lee, Nadav Timor, Jennifer Ding, Claire Schlesinger, Hailey Schoelkopf, Jan Ebert, Tri Dao, Mayank Mishra, Alex Gu, Jennifer Robinson, Carolyn Jane Anderson, Brendan Dolan-Gavitt, Danish Contractor, Siva Reddy, Daniel Fried, Dzmitry Bahdanau, Yacine Jernite, Carlos Muñoz Ferrandis, Sean Hughes, Thomas Wolf, Arjun Guha, Leandro von
Werra, and Harm de Vries.

</span>
<span class="ltx_bibblock">Starcoder: may the source be with you!, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2305.06161" title="">https://arxiv.org/abs/2305.06161</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al. (2023)</span>
<span class="ltx_bibblock">
Jiawei Liu, Chunqiu Steven Xia, Yuyao Wang, and Lingming Zhang.

</span>
<span class="ltx_bibblock">Is your code generated by chatgpt really correct? rigorous evaluation of large language models for code generation.

</span>
<span class="ltx_bibblock">In Alice Oh, Tristan Naumann, Amir Globerson, Kate Saenko, Moritz Hardt, and Sergey Levine (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">Advances in Neural Information Processing Systems 36: Annual Conference on Neural Information Processing Systems 2023, NeurIPS 2023, New Orleans, LA, USA, December 10 - 16, 2023</em>, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://papers.nips.cc/paper_files/paper/2023/hash/43e9d647ccd3e4b7b5baab53f0368686-Abstract-Conference.html" title="">http://papers.nips.cc/paper_files/paper/2023/hash/43e9d647ccd3e4b7b5baab53f0368686-Abstract-Conference.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Loshchilov &amp; Hutter (2019)</span>
<span class="ltx_bibblock">
Ilya Loshchilov and Frank Hutter.

</span>
<span class="ltx_bibblock">Decoupled weight decay regularization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">7th International Conference on Learning Representations, ICLR 2019, New Orleans, LA, USA, May 6-9, 2019</em>. OpenReview.net, 2019.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=Bkg6RiCqY7" title="">https://openreview.net/forum?id=Bkg6RiCqY7</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lozhkov et al. (2024)</span>
<span class="ltx_bibblock">
Anton Lozhkov, Raymond Li, Loubna Ben Allal, Federico Cassano, Joel Lamy-Poirier, Nouamane Tazi, Ao Tang, Dmytro Pykhtar, Jiawei Liu, Yuxiang Wei, Tianyang Liu, Max Tian, Denis Kocetkov, Arthur Zucker, Younes Belkada, Zijian Wang, Qian Liu, Dmitry Abulkhanov, Indraneil Paul, Zhuang Li, Wen-Ding Li, Megan Risdal, Jia Li, Jian Zhu, Terry Yue Zhuo, Evgenii Zheltonozhskii, Nii Osae Osae Dade, Wenhao Yu, Lucas Krauß, Naman Jain, Yixuan Su, Xuanli He, Manan Dey, Edoardo Abati, Yekun Chai, Niklas Muennighoff, Xiangru Tang, Muhtasham Oblokulov, Christopher Akiki, Marc Marone, Chenghao Mou, Mayank Mishra, Alex Gu, Binyuan Hui, Tri Dao, Armel Zebaze, Olivier Dehaene, Nicolas Patry, Canwen Xu, Julian McAuley, Han Hu, Torsten Scholak, Sebastien Paquet, Jennifer Robinson, Carolyn Jane Anderson, Nicolas Chapados, Mostofa Patwary, Nima Tajbakhsh, Yacine Jernite, Carlos Muñoz Ferrandis, Lingming Zhang, Sean Hughes, Thomas Wolf, Arjun Guha, Leandro von Werra, and Harm de Vries.

</span>
<span class="ltx_bibblock">Starcoder 2 and the stack v2: The next generation, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2402.19173" title="">https://arxiv.org/abs/2402.19173</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lu et al. (2022)</span>
<span class="ltx_bibblock">
Ximing Lu, Sean Welleck, Peter West, Liwei Jiang, Jungo Kasai, Daniel Khashabi, Ronan Le Bras, Lianhui Qin, Youngjae Yu, Rowan Zellers, Noah A. Smith, and Yejin Choi.

</span>
<span class="ltx_bibblock">NeuroLogic a*esque decoding: Constrained text generation with lookahead heuristics.

</span>
<span class="ltx_bibblock">In Marine Carpuat, Marie-Catherine de Marneffe, and Ivan Vladimir Meza Ruiz (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">Proceedings of the 2022 Conference of the North American Chapter of the Association for Computational Linguistics: Human Language Technologies</em>, pp.  780–799, Seattle, United States, 2022. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/2022.naacl-main.57</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2022.naacl-main.57" title="">https://aclanthology.org/2022.naacl-main.57</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nguyen et al. (2023)</span>
<span class="ltx_bibblock">
Anh Nguyen, Nikos Karampatziakis, and Weizhu Chen.

</span>
<span class="ltx_bibblock">Meet in the middle: A new pre-training paradigm.

</span>
<span class="ltx_bibblock">In Alice Oh, Tristan Naumann, Amir Globerson, Kate Saenko, Moritz Hardt, and Sergey Levine (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">Advances in Neural Information Processing Systems 36: Annual Conference on Neural Information Processing Systems 2023, NeurIPS 2023, New Orleans, LA, USA, December 10 - 16, 2023</em>, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://papers.nips.cc/paper_files/paper/2023/hash/105fdc31cc9eb927cc5a0110f4031287-Abstract-Conference.html" title="">http://papers.nips.cc/paper_files/paper/2023/hash/105fdc31cc9eb927cc5a0110f4031287-Abstract-Conference.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nijkamp et al. (2023)</span>
<span class="ltx_bibblock">
Erik Nijkamp, Bo Pang, Hiroaki Hayashi, Lifu Tu, Huan Wang, Yingbo Zhou, Silvio Savarese, and Caiming Xiong.

</span>
<span class="ltx_bibblock">Codegen: An open large language model for code with multi-turn program synthesis.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">The Eleventh International Conference on Learning Representations, ICLR 2023, Kigali, Rwanda, May 1-5, 2023</em>. OpenReview.net, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/pdf?id=iaYcJKpY2B_" title="">https://openreview.net/pdf?id=iaYcJKpY2B_</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rozière et al. (2023)</span>
<span class="ltx_bibblock">
Baptiste Rozière, Jonas Gehring, Fabian Gloeckle, Sten Sootla, Itai Gat, Xiaoqing Ellen Tan, Yossi Adi, Jingyu Liu, Romain Sauvestre, Tal Remez, Jérémy Rapin, Artyom Kozhevnikov, Ivan Evtimov, Joanna Bitton, Manish Bhatt, Cristian Canton Ferrer, Aaron Grattafiori, Wenhan Xiong, Alexandre Défossez, Jade Copet, Faisal Azhar, Hugo Touvron, Louis Martin, Nicolas Usunier, Thomas Scialom, and Gabriel Synnaeve.

</span>
<span class="ltx_bibblock">Code llama: Open foundation models for code, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2308.12950" title="">https://arxiv.org/abs/2308.12950</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wu et al. (2024)</span>
<span class="ltx_bibblock">
Di Wu, Wasi Uddin Ahmad, Dejiao Zhang, Murali Krishna Ramanathan, and Xiaofei Ma.

</span>
<span class="ltx_bibblock">Repoformer: Selective retrieval for repository-level code completion, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2403.10059" title="">https://arxiv.org/abs/2403.10059</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xia &amp; Zhang (2023)</span>
<span class="ltx_bibblock">
Chunqiu Steven Xia and Lingming Zhang.

</span>
<span class="ltx_bibblock">Keep the conversation going: Fixing 162 out of 337 bugs for $0.42 each using chatgpt, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2304.00385" title="">https://arxiv.org/abs/2304.00385</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xia et al. (2023)</span>
<span class="ltx_bibblock">
Chunqiu Steven Xia, Yifeng Ding, and Lingming Zhang.

</span>
<span class="ltx_bibblock">The plastic surgery hypothesis in the era of large language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">2023 38th IEEE/ACM International Conference on Automated Software Engineering (ASE)</em>, pp.  522–534, 2023.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.1109/ASE56229.2023.00047</span>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2023)</span>
<span class="ltx_bibblock">
Fengji Zhang, Bei Chen, Yue Zhang, Jacky Keung, Jin Liu, Daoguang Zan, Yi Mao, Jian-Guang Lou, and Weizhu Chen.

</span>
<span class="ltx_bibblock">RepoCoder: Repository-level code completion through iterative retrieval and generation.

</span>
<span class="ltx_bibblock">In Houda Bouamor, Juan Pino, and Kalika Bali (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Proceedings of the 2023 Conference on Empirical Methods in Natural Language Processing</em>, pp.  2471–2484, Singapore, 2023. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/2023.emnlp-main.151</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2023.emnlp-main.151" title="">https://aclanthology.org/2023.emnlp-main.151</a>.

</span>
</li>
</ul>
</section>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Appendix</h2>
<section class="ltx_subsection" id="A1.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1 </span>Effect of HLP on Left-to-Right Performance</h3>
<div class="ltx_para ltx_noindent" id="A1.SS1.p1">
<p class="ltx_p" id="A1.SS1.p1.4">While HLP have significantly improved the FIM performance of LLMs, we also study its impact on the L2R code completion.
To this end, we evaluate L2R performance on HumanEval <cite class="ltx_cite ltx_citemacro_citep">(Chen et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib4" title="">2021</a>)</cite> and MBPP <cite class="ltx_cite ltx_citemacro_citep">(Austin et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib1" title="">2021</a>)</cite> with DeepSeek-Coder-Base 1.3B. We further employ HumanEval+ and MBPP+ from EvalPlus <cite class="ltx_cite ltx_citemacro_cite">Liu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#bib.bib18" title="">2023</a>)</cite> for more rigorous evaluation with better test coverage.
As shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#A1.T7" title="Table 7 ‣ A.1 Effect of HLP on Left-to-Right Performance ‣ Appendix A Appendix ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">7</span></a>, with HLP applied to FIM data only (<em class="ltx_emph ltx_font_italic" id="A1.SS1.p1.4.1">i.e.,</em> <math alttext="\text{HLP}_{\text{FIM}}" class="ltx_Math" display="inline" id="A1.SS1.p1.1.m1.1"><semantics id="A1.SS1.p1.1.m1.1a"><msub id="A1.SS1.p1.1.m1.1.1" xref="A1.SS1.p1.1.m1.1.1.cmml"><mtext id="A1.SS1.p1.1.m1.1.1.2" xref="A1.SS1.p1.1.m1.1.1.2a.cmml">HLP</mtext><mtext id="A1.SS1.p1.1.m1.1.1.3" xref="A1.SS1.p1.1.m1.1.1.3a.cmml">FIM</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p1.1.m1.1b"><apply id="A1.SS1.p1.1.m1.1.1.cmml" xref="A1.SS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="A1.SS1.p1.1.m1.1.1.1.cmml" xref="A1.SS1.p1.1.m1.1.1">subscript</csymbol><ci id="A1.SS1.p1.1.m1.1.1.2a.cmml" xref="A1.SS1.p1.1.m1.1.1.2"><mtext id="A1.SS1.p1.1.m1.1.1.2.cmml" xref="A1.SS1.p1.1.m1.1.1.2">HLP</mtext></ci><ci id="A1.SS1.p1.1.m1.1.1.3a.cmml" xref="A1.SS1.p1.1.m1.1.1.3"><mtext id="A1.SS1.p1.1.m1.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p1.1.m1.1.1.3">FIM</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p1.1.m1.1c">\text{HLP}_{\text{FIM}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p1.1.m1.1d">HLP start_POSTSUBSCRIPT FIM end_POSTSUBSCRIPT</annotation></semantics></math>), the performance on L2R tasks sometimes shows a slight degradation. We hypothesize that applying HLP to <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="A1.SS1.p1.2.m2.1"><semantics id="A1.SS1.p1.2.m2.1a"><mi id="A1.SS1.p1.2.m2.1.1" xref="A1.SS1.p1.2.m2.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p1.2.m2.1b"><ci id="A1.SS1.p1.2.m2.1.1.cmml" xref="A1.SS1.p1.2.m2.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p1.2.m2.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p1.2.m2.1d">sansserif_middle</annotation></semantics></math> only causes unbalanced training on <math alttext="\mathsf{prefix}" class="ltx_Math" display="inline" id="A1.SS1.p1.3.m3.1"><semantics id="A1.SS1.p1.3.m3.1a"><mi id="A1.SS1.p1.3.m3.1.1" xref="A1.SS1.p1.3.m3.1.1.cmml">𝗉𝗋𝖾𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p1.3.m3.1b"><ci id="A1.SS1.p1.3.m3.1.1.cmml" xref="A1.SS1.p1.3.m3.1.1">𝗉𝗋𝖾𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p1.3.m3.1c">\mathsf{prefix}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p1.3.m3.1d">sansserif_prefix</annotation></semantics></math> and <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="A1.SS1.p1.4.m4.1"><semantics id="A1.SS1.p1.4.m4.1a"><mi id="A1.SS1.p1.4.m4.1.1" xref="A1.SS1.p1.4.m4.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p1.4.m4.1b"><ci id="A1.SS1.p1.4.m4.1.1.cmml" xref="A1.SS1.p1.4.m4.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p1.4.m4.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p1.4.m4.1d">sansserif_suffix</annotation></semantics></math> parts.</p>
</div>
<figure class="ltx_table" id="A1.T7">
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A1.T7.4">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A1.T7.4.5.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_tt" id="A1.T7.4.5.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="A1.T7.4.5.1.2">Left-to-Right</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A1.T7.4.5.1.3">Fill-in-the-Middle</th>
</tr>
<tr class="ltx_tr" id="A1.T7.4.6.2">
<th class="ltx_td ltx_th ltx_th_row ltx_border_t" id="A1.T7.4.6.2.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="A1.T7.4.6.2.2">HumanEval (+)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="A1.T7.4.6.2.3">MBPP (+)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_t" id="A1.T7.4.6.2.4">SAFIM</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A1.T7.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A1.T7.1.1.1"><span class="ltx_text ltx_markedasmath" id="A1.T7.1.1.1.1">DS-1.3B</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T7.1.1.2"><span class="ltx_text ltx_font_bold" id="A1.T7.1.1.2.1">26.3 (22.0)</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A1.T7.1.1.3"><span class="ltx_text ltx_font_bold" id="A1.T7.1.1.3.1">45.8 (36.7)</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_t" id="A1.T7.1.1.4">47.7</td>
</tr>
<tr class="ltx_tr" id="A1.T7.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A1.T7.2.2.1">
<span class="ltx_ERROR undefined" id="A1.T7.2.2.1.1">\hdashline</span>
   + HLP <math alttext="{}_{\text{FIM}}" class="ltx_Math" display="inline" id="A1.T7.2.2.1.m1.1"><semantics id="A1.T7.2.2.1.m1.1a"><msub id="A1.T7.2.2.1.m1.1.1" xref="A1.T7.2.2.1.m1.1.1.cmml"><mi id="A1.T7.2.2.1.m1.1.1a" xref="A1.T7.2.2.1.m1.1.1.cmml"></mi><mtext id="A1.T7.2.2.1.m1.1.1.1" xref="A1.T7.2.2.1.m1.1.1.1a.cmml">FIM</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.T7.2.2.1.m1.1b"><apply id="A1.T7.2.2.1.m1.1.1.cmml" xref="A1.T7.2.2.1.m1.1.1"><ci id="A1.T7.2.2.1.m1.1.1.1a.cmml" xref="A1.T7.2.2.1.m1.1.1.1"><mtext id="A1.T7.2.2.1.m1.1.1.1.cmml" mathsize="70%" xref="A1.T7.2.2.1.m1.1.1.1">FIM</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T7.2.2.1.m1.1c">{}_{\text{FIM}}</annotation><annotation encoding="application/x-llamapun" id="A1.T7.2.2.1.m1.1d">start_FLOATSUBSCRIPT FIM end_FLOATSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center" id="A1.T7.2.2.2">25.5 (21.3)</td>
<td class="ltx_td ltx_align_center" id="A1.T7.2.2.3">45.8 (36.5)</td>
<td class="ltx_td ltx_nopad_r ltx_align_center" id="A1.T7.2.2.4"><span class="ltx_text ltx_font_bold" id="A1.T7.2.2.4.1">50.0</span></td>
</tr>
<tr class="ltx_tr" id="A1.T7.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="A1.T7.4.4.2">     + HLP <math alttext="{}_{\text{FIM}}" class="ltx_Math" display="inline" id="A1.T7.3.3.1.m1.1"><semantics id="A1.T7.3.3.1.m1.1a"><msub id="A1.T7.3.3.1.m1.1.1" xref="A1.T7.3.3.1.m1.1.1.cmml"><mi id="A1.T7.3.3.1.m1.1.1a" xref="A1.T7.3.3.1.m1.1.1.cmml"></mi><mtext id="A1.T7.3.3.1.m1.1.1.1" xref="A1.T7.3.3.1.m1.1.1.1a.cmml">FIM</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.T7.3.3.1.m1.1b"><apply id="A1.T7.3.3.1.m1.1.1.cmml" xref="A1.T7.3.3.1.m1.1.1"><ci id="A1.T7.3.3.1.m1.1.1.1a.cmml" xref="A1.T7.3.3.1.m1.1.1.1"><mtext id="A1.T7.3.3.1.m1.1.1.1.cmml" mathsize="70%" xref="A1.T7.3.3.1.m1.1.1.1">FIM</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T7.3.3.1.m1.1c">{}_{\text{FIM}}</annotation><annotation encoding="application/x-llamapun" id="A1.T7.3.3.1.m1.1d">start_FLOATSUBSCRIPT FIM end_FLOATSUBSCRIPT</annotation></semantics></math> + HLP <math alttext="{}_{\text{L2R}}" class="ltx_Math" display="inline" id="A1.T7.4.4.2.m2.1"><semantics id="A1.T7.4.4.2.m2.1a"><msub id="A1.T7.4.4.2.m2.1.1" xref="A1.T7.4.4.2.m2.1.1.cmml"><mi id="A1.T7.4.4.2.m2.1.1a" xref="A1.T7.4.4.2.m2.1.1.cmml"></mi><mtext id="A1.T7.4.4.2.m2.1.1.1" xref="A1.T7.4.4.2.m2.1.1.1a.cmml">L2R</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.T7.4.4.2.m2.1b"><apply id="A1.T7.4.4.2.m2.1.1.cmml" xref="A1.T7.4.4.2.m2.1.1"><ci id="A1.T7.4.4.2.m2.1.1.1a.cmml" xref="A1.T7.4.4.2.m2.1.1.1"><mtext id="A1.T7.4.4.2.m2.1.1.1.cmml" mathsize="70%" xref="A1.T7.4.4.2.m2.1.1.1">L2R</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T7.4.4.2.m2.1c">{}_{\text{L2R}}</annotation><annotation encoding="application/x-llamapun" id="A1.T7.4.4.2.m2.1d">start_FLOATSUBSCRIPT L2R end_FLOATSUBSCRIPT</annotation></semantics></math>
</th>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="A1.T7.4.4.3"><span class="ltx_text ltx_font_bold" id="A1.T7.4.4.3.1">26.2 (22.0)</span></td>
<td class="ltx_td ltx_align_center ltx_border_bb ltx_border_t" id="A1.T7.4.4.4"><span class="ltx_text ltx_font_bold" id="A1.T7.4.4.4.1">45.7 (36.6)</span></td>
<td class="ltx_td ltx_nopad_r ltx_align_center ltx_border_bb ltx_border_t" id="A1.T7.4.4.5"><span class="ltx_text ltx_font_bold" id="A1.T7.4.4.5.1">49.6</span></td>
</tr>
</tbody>
</table>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 7: </span>
Effect of <math alttext="\text{HLP}_{\text{FIM}}" class="ltx_Math" display="inline" id="A1.T7.9.m1.1"><semantics id="A1.T7.9.m1.1b"><msub id="A1.T7.9.m1.1.1" xref="A1.T7.9.m1.1.1.cmml"><mtext id="A1.T7.9.m1.1.1.2" xref="A1.T7.9.m1.1.1.2a.cmml">HLP</mtext><mtext id="A1.T7.9.m1.1.1.3" xref="A1.T7.9.m1.1.1.3a.cmml">FIM</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.T7.9.m1.1c"><apply id="A1.T7.9.m1.1.1.cmml" xref="A1.T7.9.m1.1.1"><csymbol cd="ambiguous" id="A1.T7.9.m1.1.1.1.cmml" xref="A1.T7.9.m1.1.1">subscript</csymbol><ci id="A1.T7.9.m1.1.1.2a.cmml" xref="A1.T7.9.m1.1.1.2"><mtext id="A1.T7.9.m1.1.1.2.cmml" xref="A1.T7.9.m1.1.1.2">HLP</mtext></ci><ci id="A1.T7.9.m1.1.1.3a.cmml" xref="A1.T7.9.m1.1.1.3"><mtext id="A1.T7.9.m1.1.1.3.cmml" mathsize="70%" xref="A1.T7.9.m1.1.1.3">FIM</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T7.9.m1.1d">\text{HLP}_{\text{FIM}}</annotation><annotation encoding="application/x-llamapun" id="A1.T7.9.m1.1e">HLP start_POSTSUBSCRIPT FIM end_POSTSUBSCRIPT</annotation></semantics></math> only and <math alttext="\text{HLP}_{\text{FIM}}+\text{HLP}_{\text{L2R}}" class="ltx_Math" display="inline" id="A1.T7.10.m2.1"><semantics id="A1.T7.10.m2.1b"><mrow id="A1.T7.10.m2.1.1" xref="A1.T7.10.m2.1.1.cmml"><msub id="A1.T7.10.m2.1.1.2" xref="A1.T7.10.m2.1.1.2.cmml"><mtext id="A1.T7.10.m2.1.1.2.2" xref="A1.T7.10.m2.1.1.2.2a.cmml">HLP</mtext><mtext id="A1.T7.10.m2.1.1.2.3" xref="A1.T7.10.m2.1.1.2.3a.cmml">FIM</mtext></msub><mo id="A1.T7.10.m2.1.1.1" xref="A1.T7.10.m2.1.1.1.cmml">+</mo><msub id="A1.T7.10.m2.1.1.3" xref="A1.T7.10.m2.1.1.3.cmml"><mtext id="A1.T7.10.m2.1.1.3.2" xref="A1.T7.10.m2.1.1.3.2a.cmml">HLP</mtext><mtext id="A1.T7.10.m2.1.1.3.3" xref="A1.T7.10.m2.1.1.3.3a.cmml">L2R</mtext></msub></mrow><annotation-xml encoding="MathML-Content" id="A1.T7.10.m2.1c"><apply id="A1.T7.10.m2.1.1.cmml" xref="A1.T7.10.m2.1.1"><plus id="A1.T7.10.m2.1.1.1.cmml" xref="A1.T7.10.m2.1.1.1"></plus><apply id="A1.T7.10.m2.1.1.2.cmml" xref="A1.T7.10.m2.1.1.2"><csymbol cd="ambiguous" id="A1.T7.10.m2.1.1.2.1.cmml" xref="A1.T7.10.m2.1.1.2">subscript</csymbol><ci id="A1.T7.10.m2.1.1.2.2a.cmml" xref="A1.T7.10.m2.1.1.2.2"><mtext id="A1.T7.10.m2.1.1.2.2.cmml" xref="A1.T7.10.m2.1.1.2.2">HLP</mtext></ci><ci id="A1.T7.10.m2.1.1.2.3a.cmml" xref="A1.T7.10.m2.1.1.2.3"><mtext id="A1.T7.10.m2.1.1.2.3.cmml" mathsize="70%" xref="A1.T7.10.m2.1.1.2.3">FIM</mtext></ci></apply><apply id="A1.T7.10.m2.1.1.3.cmml" xref="A1.T7.10.m2.1.1.3"><csymbol cd="ambiguous" id="A1.T7.10.m2.1.1.3.1.cmml" xref="A1.T7.10.m2.1.1.3">subscript</csymbol><ci id="A1.T7.10.m2.1.1.3.2a.cmml" xref="A1.T7.10.m2.1.1.3.2"><mtext id="A1.T7.10.m2.1.1.3.2.cmml" xref="A1.T7.10.m2.1.1.3.2">HLP</mtext></ci><ci id="A1.T7.10.m2.1.1.3.3a.cmml" xref="A1.T7.10.m2.1.1.3.3"><mtext id="A1.T7.10.m2.1.1.3.3.cmml" mathsize="70%" xref="A1.T7.10.m2.1.1.3.3">L2R</mtext></ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T7.10.m2.1d">\text{HLP}_{\text{FIM}}+\text{HLP}_{\text{L2R}}</annotation><annotation encoding="application/x-llamapun" id="A1.T7.10.m2.1e">HLP start_POSTSUBSCRIPT FIM end_POSTSUBSCRIPT + HLP start_POSTSUBSCRIPT L2R end_POSTSUBSCRIPT</annotation></semantics></math> for DeepSeek-Coder-Base 1.3B on L2R and FIM tasks. On L2R tasks including HumanEval (+) and MBPP (+), we do sampling with <math alttext="T=0.8" class="ltx_Math" display="inline" id="A1.T7.11.m3.1"><semantics id="A1.T7.11.m3.1b"><mrow id="A1.T7.11.m3.1.1" xref="A1.T7.11.m3.1.1.cmml"><mi id="A1.T7.11.m3.1.1.2" xref="A1.T7.11.m3.1.1.2.cmml">T</mi><mo id="A1.T7.11.m3.1.1.1" xref="A1.T7.11.m3.1.1.1.cmml">=</mo><mn id="A1.T7.11.m3.1.1.3" xref="A1.T7.11.m3.1.1.3.cmml">0.8</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.T7.11.m3.1c"><apply id="A1.T7.11.m3.1.1.cmml" xref="A1.T7.11.m3.1.1"><eq id="A1.T7.11.m3.1.1.1.cmml" xref="A1.T7.11.m3.1.1.1"></eq><ci id="A1.T7.11.m3.1.1.2.cmml" xref="A1.T7.11.m3.1.1.2">𝑇</ci><cn id="A1.T7.11.m3.1.1.3.cmml" type="float" xref="A1.T7.11.m3.1.1.3">0.8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T7.11.m3.1d">T=0.8</annotation><annotation encoding="application/x-llamapun" id="A1.T7.11.m3.1e">italic_T = 0.8</annotation></semantics></math> and <math alttext="n=200" class="ltx_Math" display="inline" id="A1.T7.12.m4.1"><semantics id="A1.T7.12.m4.1b"><mrow id="A1.T7.12.m4.1.1" xref="A1.T7.12.m4.1.1.cmml"><mi id="A1.T7.12.m4.1.1.2" xref="A1.T7.12.m4.1.1.2.cmml">n</mi><mo id="A1.T7.12.m4.1.1.1" xref="A1.T7.12.m4.1.1.1.cmml">=</mo><mn id="A1.T7.12.m4.1.1.3" xref="A1.T7.12.m4.1.1.3.cmml">200</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.T7.12.m4.1c"><apply id="A1.T7.12.m4.1.1.cmml" xref="A1.T7.12.m4.1.1"><eq id="A1.T7.12.m4.1.1.1.cmml" xref="A1.T7.12.m4.1.1.1"></eq><ci id="A1.T7.12.m4.1.1.2.cmml" xref="A1.T7.12.m4.1.1.2">𝑛</ci><cn id="A1.T7.12.m4.1.1.3.cmml" type="integer" xref="A1.T7.12.m4.1.1.3">200</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.T7.12.m4.1d">n=200</annotation><annotation encoding="application/x-llamapun" id="A1.T7.12.m4.1e">italic_n = 200</annotation></semantics></math>. We report <span class="ltx_text" id="A1.T7.16.1">pass@1</span> performance of all the models, where numbers outside and inside parenthesis "()" indicate <span class="ltx_text ltx_font_typewriter" id="A1.T7.17.2">base</span> and <span class="ltx_text ltx_font_typewriter" id="A1.T7.18.3">plus</span> versions of EvalPlus, respectively. For FIM experiments on SAFIM, we follow the same settings used in §<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S4.SS1" title="4.1 Syntax-Aware and Multilingual Code Fill-in-the-Middle ‣ 4 Experiments ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">4.1</span></a>.
</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="A1.SS1.p2">
<p class="ltx_p" id="A1.SS1.p2.3">To mitigate such effect, we need to devise another HLP task that can be applied to L2R training (<em class="ltx_emph ltx_font_italic" id="A1.SS1.p2.3.1">i.e.,</em> <math alttext="\text{HLP}_{\text{L2R}}" class="ltx_Math" display="inline" id="A1.SS1.p2.1.m1.1"><semantics id="A1.SS1.p2.1.m1.1a"><msub id="A1.SS1.p2.1.m1.1.1" xref="A1.SS1.p2.1.m1.1.1.cmml"><mtext id="A1.SS1.p2.1.m1.1.1.2" xref="A1.SS1.p2.1.m1.1.1.2a.cmml">HLP</mtext><mtext id="A1.SS1.p2.1.m1.1.1.3" xref="A1.SS1.p2.1.m1.1.1.3a.cmml">L2R</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p2.1.m1.1b"><apply id="A1.SS1.p2.1.m1.1.1.cmml" xref="A1.SS1.p2.1.m1.1.1"><csymbol cd="ambiguous" id="A1.SS1.p2.1.m1.1.1.1.cmml" xref="A1.SS1.p2.1.m1.1.1">subscript</csymbol><ci id="A1.SS1.p2.1.m1.1.1.2a.cmml" xref="A1.SS1.p2.1.m1.1.1.2"><mtext id="A1.SS1.p2.1.m1.1.1.2.cmml" xref="A1.SS1.p2.1.m1.1.1.2">HLP</mtext></ci><ci id="A1.SS1.p2.1.m1.1.1.3a.cmml" xref="A1.SS1.p2.1.m1.1.1.3"><mtext id="A1.SS1.p2.1.m1.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p2.1.m1.1.1.3">L2R</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p2.1.m1.1c">\text{HLP}_{\text{L2R}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p2.1.m1.1d">HLP start_POSTSUBSCRIPT L2R end_POSTSUBSCRIPT</annotation></semantics></math>). However, the original design of HLP in §<a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#S3" title="3 Horizon-Length Prediction ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">3</span></a> is not directly applicable to L2R data. While the end of <math alttext="\mathsf{middle}" class="ltx_Math" display="inline" id="A1.SS1.p2.2.m2.1"><semantics id="A1.SS1.p2.2.m2.1a"><mi id="A1.SS1.p2.2.m2.1.1" xref="A1.SS1.p2.2.m2.1.1.cmml">𝗆𝗂𝖽𝖽𝗅𝖾</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p2.2.m2.1b"><ci id="A1.SS1.p2.2.m2.1.1.cmml" xref="A1.SS1.p2.2.m2.1.1">𝗆𝗂𝖽𝖽𝗅𝖾</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p2.2.m2.1c">\mathsf{middle}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p2.2.m2.1d">sansserif_middle</annotation></semantics></math> in FIM data is strictly bounded by the beginning of <math alttext="\mathsf{suffix}" class="ltx_Math" display="inline" id="A1.SS1.p2.3.m3.1"><semantics id="A1.SS1.p2.3.m3.1a"><mi id="A1.SS1.p2.3.m3.1.1" xref="A1.SS1.p2.3.m3.1.1.cmml">𝗌𝗎𝖿𝖿𝗂𝗑</mi><annotation-xml encoding="MathML-Content" id="A1.SS1.p2.3.m3.1b"><ci id="A1.SS1.p2.3.m3.1.1.cmml" xref="A1.SS1.p2.3.m3.1.1">𝗌𝗎𝖿𝖿𝗂𝗑</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p2.3.m3.1c">\mathsf{suffix}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p2.3.m3.1d">sansserif_suffix</annotation></semantics></math>, the end of L2R data does not have any clear signals, as it is often possible to add additional contents (<em class="ltx_emph ltx_font_italic" id="A1.SS1.p2.3.2">e.g.,</em> another line of code or a new helper function) to the end of document fluently without any restrictions.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p3">
<p class="ltx_p" id="A1.SS1.p3.7">Therefore, instead of taking the entire code file as prediction horizon, we ask the model to predict the number of future tokens <span class="ltx_text ltx_font_bold" id="A1.SS1.p3.7.1">required to complete current line</span> in L2R training, which is a natural semantic unit in code. Furthermore, to avoid conflicts between <math alttext="\text{HLP}_{\text{FIM}}" class="ltx_Math" display="inline" id="A1.SS1.p3.1.m1.1"><semantics id="A1.SS1.p3.1.m1.1a"><msub id="A1.SS1.p3.1.m1.1.1" xref="A1.SS1.p3.1.m1.1.1.cmml"><mtext id="A1.SS1.p3.1.m1.1.1.2" xref="A1.SS1.p3.1.m1.1.1.2a.cmml">HLP</mtext><mtext id="A1.SS1.p3.1.m1.1.1.3" xref="A1.SS1.p3.1.m1.1.1.3a.cmml">FIM</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.1.m1.1b"><apply id="A1.SS1.p3.1.m1.1.1.cmml" xref="A1.SS1.p3.1.m1.1.1"><csymbol cd="ambiguous" id="A1.SS1.p3.1.m1.1.1.1.cmml" xref="A1.SS1.p3.1.m1.1.1">subscript</csymbol><ci id="A1.SS1.p3.1.m1.1.1.2a.cmml" xref="A1.SS1.p3.1.m1.1.1.2"><mtext id="A1.SS1.p3.1.m1.1.1.2.cmml" xref="A1.SS1.p3.1.m1.1.1.2">HLP</mtext></ci><ci id="A1.SS1.p3.1.m1.1.1.3a.cmml" xref="A1.SS1.p3.1.m1.1.1.3"><mtext id="A1.SS1.p3.1.m1.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p3.1.m1.1.1.3">FIM</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.1.m1.1c">\text{HLP}_{\text{FIM}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.1.m1.1d">HLP start_POSTSUBSCRIPT FIM end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\text{HLP}_{\text{L2R}}" class="ltx_Math" display="inline" id="A1.SS1.p3.2.m2.1"><semantics id="A1.SS1.p3.2.m2.1a"><msub id="A1.SS1.p3.2.m2.1.1" xref="A1.SS1.p3.2.m2.1.1.cmml"><mtext id="A1.SS1.p3.2.m2.1.1.2" xref="A1.SS1.p3.2.m2.1.1.2a.cmml">HLP</mtext><mtext id="A1.SS1.p3.2.m2.1.1.3" xref="A1.SS1.p3.2.m2.1.1.3a.cmml">L2R</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.2.m2.1b"><apply id="A1.SS1.p3.2.m2.1.1.cmml" xref="A1.SS1.p3.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS1.p3.2.m2.1.1.1.cmml" xref="A1.SS1.p3.2.m2.1.1">subscript</csymbol><ci id="A1.SS1.p3.2.m2.1.1.2a.cmml" xref="A1.SS1.p3.2.m2.1.1.2"><mtext id="A1.SS1.p3.2.m2.1.1.2.cmml" xref="A1.SS1.p3.2.m2.1.1.2">HLP</mtext></ci><ci id="A1.SS1.p3.2.m2.1.1.3a.cmml" xref="A1.SS1.p3.2.m2.1.1.3"><mtext id="A1.SS1.p3.2.m2.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p3.2.m2.1.1.3">L2R</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.2.m2.1c">\text{HLP}_{\text{L2R}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.2.m2.1d">HLP start_POSTSUBSCRIPT L2R end_POSTSUBSCRIPT</annotation></semantics></math>, we use two independent <math alttext="\mathsf{hlp\_head}" class="ltx_Math" display="inline" id="A1.SS1.p3.3.m3.1"><semantics id="A1.SS1.p3.3.m3.1a"><mrow id="A1.SS1.p3.3.m3.1.1" xref="A1.SS1.p3.3.m3.1.1.cmml"><mi id="A1.SS1.p3.3.m3.1.1.2" xref="A1.SS1.p3.3.m3.1.1.2.cmml">𝗁𝗅𝗉</mi><mo id="A1.SS1.p3.3.m3.1.1.1" xref="A1.SS1.p3.3.m3.1.1.1.cmml">⁢</mo><mi id="A1.SS1.p3.3.m3.1.1.3" mathvariant="normal" xref="A1.SS1.p3.3.m3.1.1.3.cmml">_</mi><mo id="A1.SS1.p3.3.m3.1.1.1a" xref="A1.SS1.p3.3.m3.1.1.1.cmml">⁢</mo><mi id="A1.SS1.p3.3.m3.1.1.4" xref="A1.SS1.p3.3.m3.1.1.4.cmml">𝗁𝖾𝖺𝖽</mi></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.3.m3.1b"><apply id="A1.SS1.p3.3.m3.1.1.cmml" xref="A1.SS1.p3.3.m3.1.1"><times id="A1.SS1.p3.3.m3.1.1.1.cmml" xref="A1.SS1.p3.3.m3.1.1.1"></times><ci id="A1.SS1.p3.3.m3.1.1.2.cmml" xref="A1.SS1.p3.3.m3.1.1.2">𝗁𝗅𝗉</ci><ci id="A1.SS1.p3.3.m3.1.1.3.cmml" xref="A1.SS1.p3.3.m3.1.1.3">_</ci><ci id="A1.SS1.p3.3.m3.1.1.4.cmml" xref="A1.SS1.p3.3.m3.1.1.4">𝗁𝖾𝖺𝖽</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.3.m3.1c">\mathsf{hlp\_head}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.3.m3.1d">sansserif_hlp _ sansserif_head</annotation></semantics></math>s to let the model learn <math alttext="\text{HLP}_{\text{FIM}}" class="ltx_Math" display="inline" id="A1.SS1.p3.4.m4.1"><semantics id="A1.SS1.p3.4.m4.1a"><msub id="A1.SS1.p3.4.m4.1.1" xref="A1.SS1.p3.4.m4.1.1.cmml"><mtext id="A1.SS1.p3.4.m4.1.1.2" xref="A1.SS1.p3.4.m4.1.1.2a.cmml">HLP</mtext><mtext id="A1.SS1.p3.4.m4.1.1.3" xref="A1.SS1.p3.4.m4.1.1.3a.cmml">FIM</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.4.m4.1b"><apply id="A1.SS1.p3.4.m4.1.1.cmml" xref="A1.SS1.p3.4.m4.1.1"><csymbol cd="ambiguous" id="A1.SS1.p3.4.m4.1.1.1.cmml" xref="A1.SS1.p3.4.m4.1.1">subscript</csymbol><ci id="A1.SS1.p3.4.m4.1.1.2a.cmml" xref="A1.SS1.p3.4.m4.1.1.2"><mtext id="A1.SS1.p3.4.m4.1.1.2.cmml" xref="A1.SS1.p3.4.m4.1.1.2">HLP</mtext></ci><ci id="A1.SS1.p3.4.m4.1.1.3a.cmml" xref="A1.SS1.p3.4.m4.1.1.3"><mtext id="A1.SS1.p3.4.m4.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p3.4.m4.1.1.3">FIM</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.4.m4.1c">\text{HLP}_{\text{FIM}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.4.m4.1d">HLP start_POSTSUBSCRIPT FIM end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\text{HLP}_{\text{L2R}}" class="ltx_Math" display="inline" id="A1.SS1.p3.5.m5.1"><semantics id="A1.SS1.p3.5.m5.1a"><msub id="A1.SS1.p3.5.m5.1.1" xref="A1.SS1.p3.5.m5.1.1.cmml"><mtext id="A1.SS1.p3.5.m5.1.1.2" xref="A1.SS1.p3.5.m5.1.1.2a.cmml">HLP</mtext><mtext id="A1.SS1.p3.5.m5.1.1.3" xref="A1.SS1.p3.5.m5.1.1.3a.cmml">L2R</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.5.m5.1b"><apply id="A1.SS1.p3.5.m5.1.1.cmml" xref="A1.SS1.p3.5.m5.1.1"><csymbol cd="ambiguous" id="A1.SS1.p3.5.m5.1.1.1.cmml" xref="A1.SS1.p3.5.m5.1.1">subscript</csymbol><ci id="A1.SS1.p3.5.m5.1.1.2a.cmml" xref="A1.SS1.p3.5.m5.1.1.2"><mtext id="A1.SS1.p3.5.m5.1.1.2.cmml" xref="A1.SS1.p3.5.m5.1.1.2">HLP</mtext></ci><ci id="A1.SS1.p3.5.m5.1.1.3a.cmml" xref="A1.SS1.p3.5.m5.1.1.3"><mtext id="A1.SS1.p3.5.m5.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p3.5.m5.1.1.3">L2R</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.5.m5.1c">\text{HLP}_{\text{L2R}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.5.m5.1d">HLP start_POSTSUBSCRIPT L2R end_POSTSUBSCRIPT</annotation></semantics></math> separately. As shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03103v1#A1.T7" title="Table 7 ‣ A.1 Effect of HLP on Left-to-Right Performance ‣ Appendix A Appendix ‣ Horizon-Length Prediction: Advancing Fill-in-the-Middle Capabilities for Code Generation with Lookahead Planning"><span class="ltx_text ltx_ref_tag">7</span></a>, by applying <math alttext="\text{HLP}_{\text{FIM}}" class="ltx_Math" display="inline" id="A1.SS1.p3.6.m6.1"><semantics id="A1.SS1.p3.6.m6.1a"><msub id="A1.SS1.p3.6.m6.1.1" xref="A1.SS1.p3.6.m6.1.1.cmml"><mtext id="A1.SS1.p3.6.m6.1.1.2" xref="A1.SS1.p3.6.m6.1.1.2a.cmml">HLP</mtext><mtext id="A1.SS1.p3.6.m6.1.1.3" xref="A1.SS1.p3.6.m6.1.1.3a.cmml">FIM</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.6.m6.1b"><apply id="A1.SS1.p3.6.m6.1.1.cmml" xref="A1.SS1.p3.6.m6.1.1"><csymbol cd="ambiguous" id="A1.SS1.p3.6.m6.1.1.1.cmml" xref="A1.SS1.p3.6.m6.1.1">subscript</csymbol><ci id="A1.SS1.p3.6.m6.1.1.2a.cmml" xref="A1.SS1.p3.6.m6.1.1.2"><mtext id="A1.SS1.p3.6.m6.1.1.2.cmml" xref="A1.SS1.p3.6.m6.1.1.2">HLP</mtext></ci><ci id="A1.SS1.p3.6.m6.1.1.3a.cmml" xref="A1.SS1.p3.6.m6.1.1.3"><mtext id="A1.SS1.p3.6.m6.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p3.6.m6.1.1.3">FIM</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.6.m6.1c">\text{HLP}_{\text{FIM}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.6.m6.1d">HLP start_POSTSUBSCRIPT FIM end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\text{HLP}_{\text{L2R}}" class="ltx_Math" display="inline" id="A1.SS1.p3.7.m7.1"><semantics id="A1.SS1.p3.7.m7.1a"><msub id="A1.SS1.p3.7.m7.1.1" xref="A1.SS1.p3.7.m7.1.1.cmml"><mtext id="A1.SS1.p3.7.m7.1.1.2" xref="A1.SS1.p3.7.m7.1.1.2a.cmml">HLP</mtext><mtext id="A1.SS1.p3.7.m7.1.1.3" xref="A1.SS1.p3.7.m7.1.1.3a.cmml">L2R</mtext></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.7.m7.1b"><apply id="A1.SS1.p3.7.m7.1.1.cmml" xref="A1.SS1.p3.7.m7.1.1"><csymbol cd="ambiguous" id="A1.SS1.p3.7.m7.1.1.1.cmml" xref="A1.SS1.p3.7.m7.1.1">subscript</csymbol><ci id="A1.SS1.p3.7.m7.1.1.2a.cmml" xref="A1.SS1.p3.7.m7.1.1.2"><mtext id="A1.SS1.p3.7.m7.1.1.2.cmml" xref="A1.SS1.p3.7.m7.1.1.2">HLP</mtext></ci><ci id="A1.SS1.p3.7.m7.1.1.3a.cmml" xref="A1.SS1.p3.7.m7.1.1.3"><mtext id="A1.SS1.p3.7.m7.1.1.3.cmml" mathsize="70%" xref="A1.SS1.p3.7.m7.1.1.3">L2R</mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.7.m7.1c">\text{HLP}_{\text{L2R}}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.7.m7.1d">HLP start_POSTSUBSCRIPT L2R end_POSTSUBSCRIPT</annotation></semantics></math> simultaneously, the performance degradation on L2R tasks is recovered, with the improvement on FIM tasks largely retained. These results demonstrate the generalizable effectiveness of HLP and shows the huge potential of applying the idea of HLP to more general training scenarios.</p>
</div>
</section>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Fri Oct  4 02:55:44 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
