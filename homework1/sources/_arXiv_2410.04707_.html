<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Learning How Hard to Think: Input-Adaptive Allocation of LM Computation</title>
<!--Generated on Fri Oct  4 13:47:08 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2410.04707v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S1" title="In Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S2" title="In Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Preliminaries</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3" title="In Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Method</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.SS1" title="In 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Estimating Problem Difficulty by Predicting Marginal Rewards</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.SS2" title="In 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Allocating Computation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.SS3" title="In 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Interesting Special Cases</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4" title="In Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.SS1" title="In 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Adaptive Best-of-k</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.SS2" title="In 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Routing</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.SS3" title="In 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.3 </span>Analysis</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S5" title="In Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S6" title="In Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#A1" title="In Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Experiment Details</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#A1.SS1" title="In Appendix A Experiment Details ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.1 </span>Math</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#A1.SS2" title="In Appendix A Experiment Details ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.2 </span>Code</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#A1.SS3" title="In Appendix A Experiment Details ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.3 </span>Chat</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#A1.SS4" title="In Appendix A Experiment Details ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.4 </span>Routing: Model Size</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#A1.SS5" title="In Appendix A Experiment Details ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A.5 </span>Routing: VAS</span></a></li>
</ol>
</li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Learning How Hard to Think: 
<br class="ltx_break"/>Input-Adaptive Allocation of LM Computation</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">Mehul Damani
   
Idan Shenfeld
   
Andi Peng
   
Andreea Bobu
   
Jacob Andreas 
<br class="ltx_break"/>Massachusetts Institute of Technology
</span><span class="ltx_author_notes">Correspondence to <span class="ltx_text ltx_font_typewriter" id="id2.1.id1">mehul42@mit.edu</span>.</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id1.1">Computationally intensive decoding procedures—including search, reranking, and self-critique—can improve the quality of language model (LM) outputs in problems spanning code generation, numerical reasoning, and dialog.
Existing work typically applies the same decoding procedure for every input to an LM. But not all inputs require the same amount of computation to process.
Can we allocate decoding computation <em class="ltx_emph ltx_font_italic" id="id1.1.2">adaptively</em>, using more resources to answer questions whose answers will be harder to compute?
We present an approach that
predicts the distribution of rewards given an input and computation budget, then allocates additional computation to inputs for which it is predicted to be most useful.
We apply this approach in two decoding procedures: first, an <em class="ltx_emph ltx_font_italic" id="id1.1.1">adaptive best-of-<math alttext="k" class="ltx_Math" display="inline" id="id1.1.1.m1.1"><semantics id="id1.1.1.m1.1a"><mi id="id1.1.1.m1.1.1" xref="id1.1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="id1.1.1.m1.1b"><ci id="id1.1.1.m1.1.1.cmml" xref="id1.1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="id1.1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="id1.1.1.m1.1d">italic_k</annotation></semantics></math></em> procedure that dynamically selects the number of samples to generate as input to a reranker; second, a <em class="ltx_emph ltx_font_italic" id="id1.1.3">routing</em> procedure that dynamically responds to a query using a decoding procedure that is expensive but accurate, or one that is cheaper but less capable.
Across a suite of programming, mathematics, and dialog tasks, we show that accurate computation-allocation procedures can be learned, and
reduce computation by up to 50% at no cost to response quality, or improve quality by up to 10% at a fixed computational budget.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<figure class="ltx_figure" id="S1.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="140" id="S1.F1.g1" src="x1.png" width="274"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span>Overview of our approach. Given a set of input queries to a language model, we train a lightweight model to estimate the difficulty of these queries (more precisely, a model that estimates how much each query would benefit from a more computationally intensive decoding procedure.) We then allocate extra computation to those queries for which it would be most beneficial.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Recent improvements in language models (LMs) have dramatically enhanced their ability to tackle complex tasks in mathematics, coding, and reasoning.
However, as with natural and artificial intelligent agents of all kinds <cite class="ltx_cite ltx_citemacro_citep">(Silver et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib21" title="">2016</a>)</cite>, LMs cannot solve all problems on the first try: they benefit from the ability to perform search <cite class="ltx_cite ltx_citemacro_citep">(Yao et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib26" title="">2024</a>)</cite>, sampling <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib4" title="">2024</a>)</cite>, or more sophisticated decoding procedures like chain-of-thought <cite class="ltx_cite ltx_citemacro_citep">(Wei et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib25" title="">2022</a>)</cite> and self-critique <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib24" title="">2023</a>)</cite>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Importantly, computationally intensive problem <em class="ltx_emph ltx_font_italic" id="S1.p2.1.1">domains</em>
may exhibit considerable variation in the difficulty of individual problem <em class="ltx_emph ltx_font_italic" id="S1.p2.1.2">instances</em>: not all problems are equally hard to solve.
For example, even a novice programmer can likely write code to to test if an integer is even. Balancing a binary tree might require multiple attempts, and finding a polynomial-time set cover algorithm is likely impossible, and not be worth attempting at all.
Maximally efficient use of computational resources thus requires identifying, <span class="ltx_text ltx_font_italic" id="S1.p2.1.3">a priori</span>, the inputs for which additional computation will improve outputs.
In LMs, recent work has shown
that significant gains from adaptive choice of decoding procedures are theoretically achievable <cite class="ltx_cite ltx_citemacro_citep">(Snell et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib22" title="">2024</a>)</cite>. However, past work has relied on measures of problem difficulty that could only be estimated <em class="ltx_emph ltx_font_italic" id="S1.p2.1.4">a posteriori</em>, using a sampling procedure significantly more expensive than the one used to generate model outputs.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">In this paper, we show that it is possible to perform inference-time scaling of computation <em class="ltx_emph ltx_font_italic" id="S1.p3.1.1">before</em> responding to a set of user queries, by predicting how much computation will be required to respond successfully to each query, and allocating resources accordingly (<a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S1.F1" title="In 1 Introduction ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Fig.</span> <span class="ltx_text ltx_ref_tag">1</span></a>).
Our approach has two parts.
First, we describe how to train a <span class="ltx_text ltx_font_italic" id="S1.p3.1.2">difficulty model</span> that estimates the marginal improvement in response quality that would result from allocating an additional unit of computing power when responding to a query.
We show that effective difficulty models can be constructed by training lightweight “probes” on top of a pre-trained LM’s hidden representations, suggesting that LMs may already learn to encode problem difficulty as a result of pre-training.
Second, we describe an efficient allocation algorithm that, given a collection of queries and a computation budget, uses predictions from the difficulty model to allocate computation to individual queries.
We show how to perform this optimization online (exactly satisfying the budget for a batch of queries) or offline (computing a fixed mapping from queries to compute allocations so that constraints are satisfied on average).</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p4">
<p class="ltx_p" id="S1.p4.2">This approach is flexible with regard to the choice of compute-scaling procedure, and we demonstrate its effectiveness with two different inference procedures.
In <span class="ltx_text ltx_font_bold" id="S1.p4.2.1">best-of-<span class="ltx_text ltx_font_italic" id="S1.p4.2.1.1">k</span></span> experiments, we choose how many samples to generate from an LM before re-ranking with a reward model.
In <span class="ltx_text ltx_font_bold" id="S1.p4.2.2">routing</span> experiments, we choose whether to respond to queries using a
computationally expensive but capable decoding procedure, or a less powerful but more cost-effective decoder.
For the best-of-<math alttext="k" class="ltx_Math" display="inline" id="S1.p4.1.m1.1"><semantics id="S1.p4.1.m1.1a"><mi id="S1.p4.1.m1.1.1" xref="S1.p4.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S1.p4.1.m1.1b"><ci id="S1.p4.1.m1.1.1.cmml" xref="S1.p4.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.p4.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S1.p4.1.m1.1d">italic_k</annotation></semantics></math> setting, we present results across <math alttext="3" class="ltx_Math" display="inline" id="S1.p4.2.m2.1"><semantics id="S1.p4.2.m2.1a"><mn id="S1.p4.2.m2.1.1" xref="S1.p4.2.m2.1.1.cmml">3</mn><annotation-xml encoding="MathML-Content" id="S1.p4.2.m2.1b"><cn id="S1.p4.2.m2.1.1.cmml" type="integer" xref="S1.p4.2.m2.1.1">3</cn></annotation-xml><annotation encoding="application/x-tex" id="S1.p4.2.m2.1c">3</annotation><annotation encoding="application/x-llamapun" id="S1.p4.2.m2.1d">3</annotation></semantics></math> domains: Math, Code and Chat.
Adaptive sampling outperforms non-adaptive strategies on all three domains across a range of possible compute budgets.
On Math and Code, we achieve the same performance as non-adaptive methods using up to 50% less compute; on Chat, we are able to match reward using up to 10% less compute than base models.
For routing, we experiment with both a pair of models (Gemma-2B, Gemma-7B) and a pair of decoding procedures (ordinary sampling and value-augmented sampling; <cite class="ltx_cite ltx_citemacro_citep">Han et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib10" title="">2024</a></cite>). In both cases, we match the performance of the more expensive decoder while calling it only 50–75% of the time.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p5">
<p class="ltx_p" id="S1.p5.1">In summary, this work presents
(1) a generally applicable framework for adaptively scaling test-time LM computation;
(2) a learned model for estimating the marginal benefit of additional computation in LM decoding;
(3) an efficient algorithm for allocating computation to queries; and
(4) experiments demonstrating significant improvements in LM efficiency and output quality.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Preliminaries</h2>
<div class="ltx_para ltx_noindent" id="S2.p1">
<p class="ltx_p" id="S2.p1.6">Suppose we have an LM-based agent that will interact with a large number of users in parallel. At any moment, each of a set of users has issued a <span class="ltx_text ltx_font_bold" id="S2.p1.6.1">query</span> <math alttext="x_{i}" class="ltx_Math" display="inline" id="S2.p1.1.m1.1"><semantics id="S2.p1.1.m1.1a"><msub id="S2.p1.1.m1.1.1" xref="S2.p1.1.m1.1.1.cmml"><mi id="S2.p1.1.m1.1.1.2" xref="S2.p1.1.m1.1.1.2.cmml">x</mi><mi id="S2.p1.1.m1.1.1.3" xref="S2.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p1.1.m1.1b"><apply id="S2.p1.1.m1.1.1.cmml" xref="S2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.p1.1.m1.1.1.1.cmml" xref="S2.p1.1.m1.1.1">subscript</csymbol><ci id="S2.p1.1.m1.1.1.2.cmml" xref="S2.p1.1.m1.1.1.2">𝑥</ci><ci id="S2.p1.1.m1.1.1.3.cmml" xref="S2.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.1.m1.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.p1.1.m1.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, for which we wish to produce a <span class="ltx_text ltx_font_bold" id="S2.p1.6.2">response</span> <math alttext="y_{i}" class="ltx_Math" display="inline" id="S2.p1.2.m2.1"><semantics id="S2.p1.2.m2.1a"><msub id="S2.p1.2.m2.1.1" xref="S2.p1.2.m2.1.1.cmml"><mi id="S2.p1.2.m2.1.1.2" xref="S2.p1.2.m2.1.1.2.cmml">y</mi><mi id="S2.p1.2.m2.1.1.3" xref="S2.p1.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p1.2.m2.1b"><apply id="S2.p1.2.m2.1.1.cmml" xref="S2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S2.p1.2.m2.1.1.1.cmml" xref="S2.p1.2.m2.1.1">subscript</csymbol><ci id="S2.p1.2.m2.1.1.2.cmml" xref="S2.p1.2.m2.1.1.2">𝑦</ci><ci id="S2.p1.2.m2.1.1.3.cmml" xref="S2.p1.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.2.m2.1c">y_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.p1.2.m2.1d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. We have acccess to both a <span class="ltx_text ltx_font_bold" id="S2.p1.6.3">language model (LMs)</span> <math alttext="p(y\mid x)" class="ltx_Math" display="inline" id="S2.p1.3.m3.1"><semantics id="S2.p1.3.m3.1a"><mrow id="S2.p1.3.m3.1.1" xref="S2.p1.3.m3.1.1.cmml"><mi id="S2.p1.3.m3.1.1.3" xref="S2.p1.3.m3.1.1.3.cmml">p</mi><mo id="S2.p1.3.m3.1.1.2" xref="S2.p1.3.m3.1.1.2.cmml">⁢</mo><mrow id="S2.p1.3.m3.1.1.1.1" xref="S2.p1.3.m3.1.1.1.1.1.cmml"><mo id="S2.p1.3.m3.1.1.1.1.2" stretchy="false" xref="S2.p1.3.m3.1.1.1.1.1.cmml">(</mo><mrow id="S2.p1.3.m3.1.1.1.1.1" xref="S2.p1.3.m3.1.1.1.1.1.cmml"><mi id="S2.p1.3.m3.1.1.1.1.1.2" xref="S2.p1.3.m3.1.1.1.1.1.2.cmml">y</mi><mo id="S2.p1.3.m3.1.1.1.1.1.1" xref="S2.p1.3.m3.1.1.1.1.1.1.cmml">∣</mo><mi id="S2.p1.3.m3.1.1.1.1.1.3" xref="S2.p1.3.m3.1.1.1.1.1.3.cmml">x</mi></mrow><mo id="S2.p1.3.m3.1.1.1.1.3" stretchy="false" xref="S2.p1.3.m3.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p1.3.m3.1b"><apply id="S2.p1.3.m3.1.1.cmml" xref="S2.p1.3.m3.1.1"><times id="S2.p1.3.m3.1.1.2.cmml" xref="S2.p1.3.m3.1.1.2"></times><ci id="S2.p1.3.m3.1.1.3.cmml" xref="S2.p1.3.m3.1.1.3">𝑝</ci><apply id="S2.p1.3.m3.1.1.1.1.1.cmml" xref="S2.p1.3.m3.1.1.1.1"><csymbol cd="latexml" id="S2.p1.3.m3.1.1.1.1.1.1.cmml" xref="S2.p1.3.m3.1.1.1.1.1.1">conditional</csymbol><ci id="S2.p1.3.m3.1.1.1.1.1.2.cmml" xref="S2.p1.3.m3.1.1.1.1.1.2">𝑦</ci><ci id="S2.p1.3.m3.1.1.1.1.1.3.cmml" xref="S2.p1.3.m3.1.1.1.1.1.3">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.3.m3.1c">p(y\mid x)</annotation><annotation encoding="application/x-llamapun" id="S2.p1.3.m3.1d">italic_p ( italic_y ∣ italic_x )</annotation></semantics></math>, capable of generating candidate responses, as well as a <span class="ltx_text ltx_font_bold" id="S2.p1.6.4">reward model</span> <math alttext="r(x,y)" class="ltx_Math" display="inline" id="S2.p1.4.m4.2"><semantics id="S2.p1.4.m4.2a"><mrow id="S2.p1.4.m4.2.3" xref="S2.p1.4.m4.2.3.cmml"><mi id="S2.p1.4.m4.2.3.2" xref="S2.p1.4.m4.2.3.2.cmml">r</mi><mo id="S2.p1.4.m4.2.3.1" xref="S2.p1.4.m4.2.3.1.cmml">⁢</mo><mrow id="S2.p1.4.m4.2.3.3.2" xref="S2.p1.4.m4.2.3.3.1.cmml"><mo id="S2.p1.4.m4.2.3.3.2.1" stretchy="false" xref="S2.p1.4.m4.2.3.3.1.cmml">(</mo><mi id="S2.p1.4.m4.1.1" xref="S2.p1.4.m4.1.1.cmml">x</mi><mo id="S2.p1.4.m4.2.3.3.2.2" xref="S2.p1.4.m4.2.3.3.1.cmml">,</mo><mi id="S2.p1.4.m4.2.2" xref="S2.p1.4.m4.2.2.cmml">y</mi><mo id="S2.p1.4.m4.2.3.3.2.3" stretchy="false" xref="S2.p1.4.m4.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p1.4.m4.2b"><apply id="S2.p1.4.m4.2.3.cmml" xref="S2.p1.4.m4.2.3"><times id="S2.p1.4.m4.2.3.1.cmml" xref="S2.p1.4.m4.2.3.1"></times><ci id="S2.p1.4.m4.2.3.2.cmml" xref="S2.p1.4.m4.2.3.2">𝑟</ci><interval closure="open" id="S2.p1.4.m4.2.3.3.1.cmml" xref="S2.p1.4.m4.2.3.3.2"><ci id="S2.p1.4.m4.1.1.cmml" xref="S2.p1.4.m4.1.1">𝑥</ci><ci id="S2.p1.4.m4.2.2.cmml" xref="S2.p1.4.m4.2.2">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.4.m4.2c">r(x,y)</annotation><annotation encoding="application/x-llamapun" id="S2.p1.4.m4.2d">italic_r ( italic_x , italic_y )</annotation></semantics></math> capable of assessing the quality of candidate responses. In the absence of any computational constraints, we might wish to find the best response to every user query by optimizing
<math alttext="\operatorname*{arg\,max}_{y}r(x_{i},y)" class="ltx_Math" display="inline" id="S2.p1.5.m5.2"><semantics id="S2.p1.5.m5.2a"><mrow id="S2.p1.5.m5.2.2" xref="S2.p1.5.m5.2.2.cmml"><mrow id="S2.p1.5.m5.2.2.3" xref="S2.p1.5.m5.2.2.3.cmml"><msub id="S2.p1.5.m5.2.2.3.1" xref="S2.p1.5.m5.2.2.3.1.cmml"><mrow id="S2.p1.5.m5.2.2.3.1.2" xref="S2.p1.5.m5.2.2.3.1.2.cmml"><mi id="S2.p1.5.m5.2.2.3.1.2.2" xref="S2.p1.5.m5.2.2.3.1.2.2.cmml">arg</mi><mo id="S2.p1.5.m5.2.2.3.1.2.1" lspace="0.170em" xref="S2.p1.5.m5.2.2.3.1.2.1.cmml">⁢</mo><mi id="S2.p1.5.m5.2.2.3.1.2.3" xref="S2.p1.5.m5.2.2.3.1.2.3.cmml">max</mi></mrow><mi id="S2.p1.5.m5.2.2.3.1.3" xref="S2.p1.5.m5.2.2.3.1.3.cmml">y</mi></msub><mo id="S2.p1.5.m5.2.2.3a" lspace="0.167em" xref="S2.p1.5.m5.2.2.3.cmml">⁡</mo><mi id="S2.p1.5.m5.2.2.3.2" xref="S2.p1.5.m5.2.2.3.2.cmml">r</mi></mrow><mo id="S2.p1.5.m5.2.2.2" xref="S2.p1.5.m5.2.2.2.cmml">⁢</mo><mrow id="S2.p1.5.m5.2.2.1.1" xref="S2.p1.5.m5.2.2.1.2.cmml"><mo id="S2.p1.5.m5.2.2.1.1.2" stretchy="false" xref="S2.p1.5.m5.2.2.1.2.cmml">(</mo><msub id="S2.p1.5.m5.2.2.1.1.1" xref="S2.p1.5.m5.2.2.1.1.1.cmml"><mi id="S2.p1.5.m5.2.2.1.1.1.2" xref="S2.p1.5.m5.2.2.1.1.1.2.cmml">x</mi><mi id="S2.p1.5.m5.2.2.1.1.1.3" xref="S2.p1.5.m5.2.2.1.1.1.3.cmml">i</mi></msub><mo id="S2.p1.5.m5.2.2.1.1.3" xref="S2.p1.5.m5.2.2.1.2.cmml">,</mo><mi id="S2.p1.5.m5.1.1" xref="S2.p1.5.m5.1.1.cmml">y</mi><mo id="S2.p1.5.m5.2.2.1.1.4" stretchy="false" xref="S2.p1.5.m5.2.2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p1.5.m5.2b"><apply id="S2.p1.5.m5.2.2.cmml" xref="S2.p1.5.m5.2.2"><times id="S2.p1.5.m5.2.2.2.cmml" xref="S2.p1.5.m5.2.2.2"></times><apply id="S2.p1.5.m5.2.2.3.cmml" xref="S2.p1.5.m5.2.2.3"><apply id="S2.p1.5.m5.2.2.3.1.cmml" xref="S2.p1.5.m5.2.2.3.1"><csymbol cd="ambiguous" id="S2.p1.5.m5.2.2.3.1.1.cmml" xref="S2.p1.5.m5.2.2.3.1">subscript</csymbol><apply id="S2.p1.5.m5.2.2.3.1.2.cmml" xref="S2.p1.5.m5.2.2.3.1.2"><times id="S2.p1.5.m5.2.2.3.1.2.1.cmml" xref="S2.p1.5.m5.2.2.3.1.2.1"></times><ci id="S2.p1.5.m5.2.2.3.1.2.2.cmml" xref="S2.p1.5.m5.2.2.3.1.2.2">arg</ci><ci id="S2.p1.5.m5.2.2.3.1.2.3.cmml" xref="S2.p1.5.m5.2.2.3.1.2.3">max</ci></apply><ci id="S2.p1.5.m5.2.2.3.1.3.cmml" xref="S2.p1.5.m5.2.2.3.1.3">𝑦</ci></apply><ci id="S2.p1.5.m5.2.2.3.2.cmml" xref="S2.p1.5.m5.2.2.3.2">𝑟</ci></apply><interval closure="open" id="S2.p1.5.m5.2.2.1.2.cmml" xref="S2.p1.5.m5.2.2.1.1"><apply id="S2.p1.5.m5.2.2.1.1.1.cmml" xref="S2.p1.5.m5.2.2.1.1.1"><csymbol cd="ambiguous" id="S2.p1.5.m5.2.2.1.1.1.1.cmml" xref="S2.p1.5.m5.2.2.1.1.1">subscript</csymbol><ci id="S2.p1.5.m5.2.2.1.1.1.2.cmml" xref="S2.p1.5.m5.2.2.1.1.1.2">𝑥</ci><ci id="S2.p1.5.m5.2.2.1.1.1.3.cmml" xref="S2.p1.5.m5.2.2.1.1.1.3">𝑖</ci></apply><ci id="S2.p1.5.m5.1.1.cmml" xref="S2.p1.5.m5.1.1">𝑦</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.5.m5.2c">\operatorname*{arg\,max}_{y}r(x_{i},y)</annotation><annotation encoding="application/x-llamapun" id="S2.p1.5.m5.2d">start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_y end_POSTSUBSCRIPT italic_r ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_y )</annotation></semantics></math>
independently for each query <math alttext="x_{i}" class="ltx_Math" display="inline" id="S2.p1.6.m6.1"><semantics id="S2.p1.6.m6.1a"><msub id="S2.p1.6.m6.1.1" xref="S2.p1.6.m6.1.1.cmml"><mi id="S2.p1.6.m6.1.1.2" xref="S2.p1.6.m6.1.1.2.cmml">x</mi><mi id="S2.p1.6.m6.1.1.3" xref="S2.p1.6.m6.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p1.6.m6.1b"><apply id="S2.p1.6.m6.1.1.cmml" xref="S2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S2.p1.6.m6.1.1.1.cmml" xref="S2.p1.6.m6.1.1">subscript</csymbol><ci id="S2.p1.6.m6.1.1.2.cmml" xref="S2.p1.6.m6.1.1.2">𝑥</ci><ci id="S2.p1.6.m6.1.1.3.cmml" xref="S2.p1.6.m6.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p1.6.m6.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.p1.6.m6.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.p2">
<p class="ltx_p" id="S2.p2.4">In practice, however, we generally do not have the ability to perform exhaustive search over candidate responses <math alttext="y" class="ltx_Math" display="inline" id="S2.p2.1.m1.1"><semantics id="S2.p2.1.m1.1a"><mi id="S2.p2.1.m1.1.1" xref="S2.p2.1.m1.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S2.p2.1.m1.1b"><ci id="S2.p2.1.m1.1.1.cmml" xref="S2.p2.1.m1.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.1.m1.1c">y</annotation><annotation encoding="application/x-llamapun" id="S2.p2.1.m1.1d">italic_y</annotation></semantics></math>. Instead, we use a <span class="ltx_text ltx_font_bold" id="S2.p2.4.1">decoding procedure</span> <math alttext="f(x,b)" class="ltx_Math" display="inline" id="S2.p2.2.m2.2"><semantics id="S2.p2.2.m2.2a"><mrow id="S2.p2.2.m2.2.3" xref="S2.p2.2.m2.2.3.cmml"><mi id="S2.p2.2.m2.2.3.2" xref="S2.p2.2.m2.2.3.2.cmml">f</mi><mo id="S2.p2.2.m2.2.3.1" xref="S2.p2.2.m2.2.3.1.cmml">⁢</mo><mrow id="S2.p2.2.m2.2.3.3.2" xref="S2.p2.2.m2.2.3.3.1.cmml"><mo id="S2.p2.2.m2.2.3.3.2.1" stretchy="false" xref="S2.p2.2.m2.2.3.3.1.cmml">(</mo><mi id="S2.p2.2.m2.1.1" xref="S2.p2.2.m2.1.1.cmml">x</mi><mo id="S2.p2.2.m2.2.3.3.2.2" xref="S2.p2.2.m2.2.3.3.1.cmml">,</mo><mi id="S2.p2.2.m2.2.2" xref="S2.p2.2.m2.2.2.cmml">b</mi><mo id="S2.p2.2.m2.2.3.3.2.3" stretchy="false" xref="S2.p2.2.m2.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p2.2.m2.2b"><apply id="S2.p2.2.m2.2.3.cmml" xref="S2.p2.2.m2.2.3"><times id="S2.p2.2.m2.2.3.1.cmml" xref="S2.p2.2.m2.2.3.1"></times><ci id="S2.p2.2.m2.2.3.2.cmml" xref="S2.p2.2.m2.2.3.2">𝑓</ci><interval closure="open" id="S2.p2.2.m2.2.3.3.1.cmml" xref="S2.p2.2.m2.2.3.3.2"><ci id="S2.p2.2.m2.1.1.cmml" xref="S2.p2.2.m2.1.1">𝑥</ci><ci id="S2.p2.2.m2.2.2.cmml" xref="S2.p2.2.m2.2.2">𝑏</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.2.m2.2c">f(x,b)</annotation><annotation encoding="application/x-llamapun" id="S2.p2.2.m2.2d">italic_f ( italic_x , italic_b )</annotation></semantics></math> that (stochastically) generates a response <math alttext="y" class="ltx_Math" display="inline" id="S2.p2.3.m3.1"><semantics id="S2.p2.3.m3.1a"><mi id="S2.p2.3.m3.1.1" xref="S2.p2.3.m3.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S2.p2.3.m3.1b"><ci id="S2.p2.3.m3.1.1.cmml" xref="S2.p2.3.m3.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.3.m3.1c">y</annotation><annotation encoding="application/x-llamapun" id="S2.p2.3.m3.1d">italic_y</annotation></semantics></math> subject to some constrained <span class="ltx_text ltx_font_bold" id="S2.p2.4.2">computation budget</span> <math alttext="b" class="ltx_Math" display="inline" id="S2.p2.4.m4.1"><semantics id="S2.p2.4.m4.1a"><mi id="S2.p2.4.m4.1.1" xref="S2.p2.4.m4.1.1.cmml">b</mi><annotation-xml encoding="MathML-Content" id="S2.p2.4.m4.1b"><ci id="S2.p2.4.m4.1.1.cmml" xref="S2.p2.4.m4.1.1">𝑏</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p2.4.m4.1c">b</annotation><annotation encoding="application/x-llamapun" id="S2.p2.4.m4.1d">italic_b</annotation></semantics></math>. (In general, increasing the budget to a query should increase the quality of the response.) Many such decoding procedures are in wide use; our experiments will focus on two of the most widely used.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.p3">
<p class="ltx_p" id="S2.p3.1">In <span class="ltx_text ltx_font_bold" id="S2.p3.1.1">best-of-<span class="ltx_text ltx_font_italic" id="S2.p3.1.1.1">k</span></span>, we generate a finite number of samples, then rerank them:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f(x,b)=\operatorname*{arg\,max}_{y_{i}\in\{y_{1},\ldots,y_{b}\}\sim p(\cdot%
\mid x)}r(x,y_{i})~{}." class="ltx_math_unparsed" display="block" id="S2.E1.m1.5"><semantics id="S2.E1.m1.5a"><mrow id="S2.E1.m1.5.5.1"><mrow id="S2.E1.m1.5.5.1.1"><mrow id="S2.E1.m1.5.5.1.1.3"><mi id="S2.E1.m1.5.5.1.1.3.2">f</mi><mo id="S2.E1.m1.5.5.1.1.3.1">⁢</mo><mrow id="S2.E1.m1.5.5.1.1.3.3.2"><mo id="S2.E1.m1.5.5.1.1.3.3.2.1" stretchy="false">(</mo><mi id="S2.E1.m1.2.2">x</mi><mo id="S2.E1.m1.5.5.1.1.3.3.2.2">,</mo><mi id="S2.E1.m1.3.3">b</mi><mo id="S2.E1.m1.5.5.1.1.3.3.2.3" stretchy="false">)</mo></mrow></mrow><mo id="S2.E1.m1.5.5.1.1.2">=</mo><mrow id="S2.E1.m1.5.5.1.1.1"><mrow id="S2.E1.m1.5.5.1.1.1.3"><munder id="S2.E1.m1.5.5.1.1.1.3.1"><mrow id="S2.E1.m1.5.5.1.1.1.3.1.2"><mi id="S2.E1.m1.5.5.1.1.1.3.1.2.2">arg</mi><mo id="S2.E1.m1.5.5.1.1.1.3.1.2.1" lspace="0.170em">⁢</mo><mi id="S2.E1.m1.5.5.1.1.1.3.1.2.3">max</mi></mrow><mrow id="S2.E1.m1.1.1.1"><msub id="S2.E1.m1.1.1.1.2"><mi id="S2.E1.m1.1.1.1.2.2">y</mi><mi id="S2.E1.m1.1.1.1.2.3">i</mi></msub><mo id="S2.E1.m1.1.1.1.3">∈</mo><mrow id="S2.E1.m1.1.1.1.4"><mo id="S2.E1.m1.1.1.1.4.1" stretchy="false">{</mo><msub id="S2.E1.m1.1.1.1.4.2"><mi id="S2.E1.m1.1.1.1.4.2.2">y</mi><mn id="S2.E1.m1.1.1.1.4.2.3">1</mn></msub><mo id="S2.E1.m1.1.1.1.4.3">,</mo><mi id="S2.E1.m1.1.1.1.1" mathvariant="normal">…</mi><mo id="S2.E1.m1.1.1.1.4.4">,</mo><msub id="S2.E1.m1.1.1.1.4.5"><mi id="S2.E1.m1.1.1.1.4.5.2">y</mi><mi id="S2.E1.m1.1.1.1.4.5.3">b</mi></msub><mo id="S2.E1.m1.1.1.1.4.6" stretchy="false">}</mo></mrow><mo id="S2.E1.m1.1.1.1.5">∼</mo><mi id="S2.E1.m1.1.1.1.6">p</mi><mrow id="S2.E1.m1.1.1.1.7"><mo id="S2.E1.m1.1.1.1.7.1" stretchy="false">(</mo><mo id="S2.E1.m1.1.1.1.7.2" lspace="0em" rspace="0em">⋅</mo><mo id="S2.E1.m1.1.1.1.7.3" lspace="0em" rspace="0.167em">∣</mo><mi id="S2.E1.m1.1.1.1.7.4">x</mi><mo id="S2.E1.m1.1.1.1.7.5" stretchy="false">)</mo></mrow></mrow></munder><mo id="S2.E1.m1.5.5.1.1.1.3a">⁡</mo><mi id="S2.E1.m1.5.5.1.1.1.3.2">r</mi></mrow><mo id="S2.E1.m1.5.5.1.1.1.2">⁢</mo><mrow id="S2.E1.m1.5.5.1.1.1.1.1"><mo id="S2.E1.m1.5.5.1.1.1.1.1.2" stretchy="false">(</mo><mi id="S2.E1.m1.4.4">x</mi><mo id="S2.E1.m1.5.5.1.1.1.1.1.3">,</mo><msub id="S2.E1.m1.5.5.1.1.1.1.1.1"><mi id="S2.E1.m1.5.5.1.1.1.1.1.1.2">y</mi><mi id="S2.E1.m1.5.5.1.1.1.1.1.1.3">i</mi></msub><mo id="S2.E1.m1.5.5.1.1.1.1.1.4" rspace="0.052em" stretchy="false">)</mo></mrow></mrow></mrow><mo id="S2.E1.m1.5.5.1.2">.</mo></mrow><annotation encoding="application/x-tex" id="S2.E1.m1.5b">f(x,b)=\operatorname*{arg\,max}_{y_{i}\in\{y_{1},\ldots,y_{b}\}\sim p(\cdot%
\mid x)}r(x,y_{i})~{}.</annotation><annotation encoding="application/x-llamapun" id="S2.E1.m1.5c">italic_f ( italic_x , italic_b ) = start_OPERATOR roman_arg roman_max end_OPERATOR start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∈ { italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_y start_POSTSUBSCRIPT italic_b end_POSTSUBSCRIPT } ∼ italic_p ( ⋅ ∣ italic_x ) end_POSTSUBSCRIPT italic_r ( italic_x , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para ltx_noindent" id="S2.p4">
<p class="ltx_p" id="S2.p4.2">In <span class="ltx_text ltx_font_bold" id="S2.p4.2.1">routing</span>, we have access to a <span class="ltx_text ltx_font_bold" id="S2.p4.2.2">strong</span> but expensive decoding scheme <math alttext="p^{S}" class="ltx_Math" display="inline" id="S2.p4.1.m1.1"><semantics id="S2.p4.1.m1.1a"><msup id="S2.p4.1.m1.1.1" xref="S2.p4.1.m1.1.1.cmml"><mi id="S2.p4.1.m1.1.1.2" xref="S2.p4.1.m1.1.1.2.cmml">p</mi><mi id="S2.p4.1.m1.1.1.3" xref="S2.p4.1.m1.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S2.p4.1.m1.1b"><apply id="S2.p4.1.m1.1.1.cmml" xref="S2.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S2.p4.1.m1.1.1.1.cmml" xref="S2.p4.1.m1.1.1">superscript</csymbol><ci id="S2.p4.1.m1.1.1.2.cmml" xref="S2.p4.1.m1.1.1.2">𝑝</ci><ci id="S2.p4.1.m1.1.1.3.cmml" xref="S2.p4.1.m1.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.1.m1.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="S2.p4.1.m1.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math> (which could involve search, reasoning, or even just a larger model). For every query we can either use this decoding scheme or to fall back to a <span class="ltx_text ltx_font_bold" id="S2.p4.2.3">weak</span> but cheaper decoding scheme <math alttext="p^{W}" class="ltx_Math" display="inline" id="S2.p4.2.m2.1"><semantics id="S2.p4.2.m2.1a"><msup id="S2.p4.2.m2.1.1" xref="S2.p4.2.m2.1.1.cmml"><mi id="S2.p4.2.m2.1.1.2" xref="S2.p4.2.m2.1.1.2.cmml">p</mi><mi id="S2.p4.2.m2.1.1.3" xref="S2.p4.2.m2.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S2.p4.2.m2.1b"><apply id="S2.p4.2.m2.1.1.cmml" xref="S2.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S2.p4.2.m2.1.1.1.cmml" xref="S2.p4.2.m2.1.1">superscript</csymbol><ci id="S2.p4.2.m2.1.1.2.cmml" xref="S2.p4.2.m2.1.1.2">𝑝</ci><ci id="S2.p4.2.m2.1.1.3.cmml" xref="S2.p4.2.m2.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.2.m2.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S2.p4.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> (e.g. ordinary decoding or a smaller model). Then:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="f(x,b)=\begin{cases}y\sim p^{W}(\cdot\mid x)&amp;\textrm{if }b=b^{W}\\
y\sim p^{S\ \,}(\cdot\mid x)&amp;\textrm{if }b=b^{S}\end{cases}~{}." class="ltx_math_unparsed" display="block" id="S2.E2.m1.7"><semantics id="S2.E2.m1.7a"><mrow id="S2.E2.m1.7.7.1"><mrow id="S2.E2.m1.7.7.1.1"><mrow id="S2.E2.m1.7.7.1.1.2"><mi id="S2.E2.m1.7.7.1.1.2.2">f</mi><mo id="S2.E2.m1.7.7.1.1.2.1">⁢</mo><mrow id="S2.E2.m1.7.7.1.1.2.3.2"><mo id="S2.E2.m1.7.7.1.1.2.3.2.1" stretchy="false">(</mo><mi id="S2.E2.m1.5.5">x</mi><mo id="S2.E2.m1.7.7.1.1.2.3.2.2">,</mo><mi id="S2.E2.m1.6.6">b</mi><mo id="S2.E2.m1.7.7.1.1.2.3.2.3" stretchy="false">)</mo></mrow></mrow><mo id="S2.E2.m1.7.7.1.1.1">=</mo><mrow id="S2.E2.m1.4.4"><mo id="S2.E2.m1.4.4.5">{</mo><mtable columnspacing="5pt" displaystyle="true" id="S2.E2.m1.4.4.4" rowspacing="0pt"><mtr id="S2.E2.m1.4.4.4a"><mtd class="ltx_align_left" columnalign="left" id="S2.E2.m1.4.4.4b"><mrow id="S2.E2.m1.1.1.1.1.1.1"><mi id="S2.E2.m1.1.1.1.1.1.1.1">y</mi><mo id="S2.E2.m1.1.1.1.1.1.1.2">∼</mo><msup id="S2.E2.m1.1.1.1.1.1.1.3"><mi id="S2.E2.m1.1.1.1.1.1.1.3.2">p</mi><mi id="S2.E2.m1.1.1.1.1.1.1.3.3">W</mi></msup><mrow id="S2.E2.m1.1.1.1.1.1.1.4"><mo id="S2.E2.m1.1.1.1.1.1.1.4.1" stretchy="false">(</mo><mo id="S2.E2.m1.1.1.1.1.1.1.4.2" lspace="0em" rspace="0em">⋅</mo><mo id="S2.E2.m1.1.1.1.1.1.1.4.3" lspace="0em" rspace="0.167em">∣</mo><mi id="S2.E2.m1.1.1.1.1.1.1.4.4">x</mi><mo id="S2.E2.m1.1.1.1.1.1.1.4.5" stretchy="false">)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S2.E2.m1.4.4.4c"><mrow id="S2.E2.m1.2.2.2.2.2.1"><mrow id="S2.E2.m1.2.2.2.2.2.1.2"><mtext id="S2.E2.m1.2.2.2.2.2.1.2.2">if </mtext><mo id="S2.E2.m1.2.2.2.2.2.1.2.1">⁢</mo><mi id="S2.E2.m1.2.2.2.2.2.1.2.3">b</mi></mrow><mo id="S2.E2.m1.2.2.2.2.2.1.1">=</mo><msup id="S2.E2.m1.2.2.2.2.2.1.3"><mi id="S2.E2.m1.2.2.2.2.2.1.3.2">b</mi><mi id="S2.E2.m1.2.2.2.2.2.1.3.3">W</mi></msup></mrow></mtd></mtr><mtr id="S2.E2.m1.4.4.4d"><mtd class="ltx_align_left" columnalign="left" id="S2.E2.m1.4.4.4e"><mrow id="S2.E2.m1.3.3.3.3.1.1"><mi id="S2.E2.m1.3.3.3.3.1.1.1">y</mi><mo id="S2.E2.m1.3.3.3.3.1.1.2">∼</mo><msup id="S2.E2.m1.3.3.3.3.1.1.3"><mi id="S2.E2.m1.3.3.3.3.1.1.3.2">p</mi><mi id="S2.E2.m1.3.3.3.3.1.1.3.3">S</mi></msup><mrow id="S2.E2.m1.3.3.3.3.1.1.4"><mo id="S2.E2.m1.3.3.3.3.1.1.4.1" stretchy="false">(</mo><mo id="S2.E2.m1.3.3.3.3.1.1.4.2" lspace="0em" rspace="0em">⋅</mo><mo id="S2.E2.m1.3.3.3.3.1.1.4.3" lspace="0em" rspace="0.167em">∣</mo><mi id="S2.E2.m1.3.3.3.3.1.1.4.4">x</mi><mo id="S2.E2.m1.3.3.3.3.1.1.4.5" stretchy="false">)</mo></mrow></mrow></mtd><mtd class="ltx_align_left" columnalign="left" id="S2.E2.m1.4.4.4f"><mrow id="S2.E2.m1.4.4.4.4.2.1"><mrow id="S2.E2.m1.4.4.4.4.2.1.2"><mtext id="S2.E2.m1.4.4.4.4.2.1.2.2">if </mtext><mo id="S2.E2.m1.4.4.4.4.2.1.2.1">⁢</mo><mi id="S2.E2.m1.4.4.4.4.2.1.2.3">b</mi></mrow><mo id="S2.E2.m1.4.4.4.4.2.1.1">=</mo><msup id="S2.E2.m1.4.4.4.4.2.1.3"><mi id="S2.E2.m1.4.4.4.4.2.1.3.2">b</mi><mi id="S2.E2.m1.4.4.4.4.2.1.3.3">S</mi></msup></mrow></mtd></mtr></mtable></mrow></mrow><mo id="S2.E2.m1.7.7.1.2" lspace="0em">.</mo></mrow><annotation encoding="application/x-tex" id="S2.E2.m1.7b">f(x,b)=\begin{cases}y\sim p^{W}(\cdot\mid x)&amp;\textrm{if }b=b^{W}\\
y\sim p^{S\ \,}(\cdot\mid x)&amp;\textrm{if }b=b^{S}\end{cases}~{}.</annotation><annotation encoding="application/x-llamapun" id="S2.E2.m1.7c">italic_f ( italic_x , italic_b ) = { start_ROW start_CELL italic_y ∼ italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT ( ⋅ ∣ italic_x ) end_CELL start_CELL if italic_b = italic_b start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT end_CELL end_ROW start_ROW start_CELL italic_y ∼ italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT ( ⋅ ∣ italic_x ) end_CELL start_CELL if italic_b = italic_b start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT end_CELL end_ROW .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p4.5">Here <math alttext="b^{W}" class="ltx_Math" display="inline" id="S2.p4.3.m1.1"><semantics id="S2.p4.3.m1.1a"><msup id="S2.p4.3.m1.1.1" xref="S2.p4.3.m1.1.1.cmml"><mi id="S2.p4.3.m1.1.1.2" xref="S2.p4.3.m1.1.1.2.cmml">b</mi><mi id="S2.p4.3.m1.1.1.3" xref="S2.p4.3.m1.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S2.p4.3.m1.1b"><apply id="S2.p4.3.m1.1.1.cmml" xref="S2.p4.3.m1.1.1"><csymbol cd="ambiguous" id="S2.p4.3.m1.1.1.1.cmml" xref="S2.p4.3.m1.1.1">superscript</csymbol><ci id="S2.p4.3.m1.1.1.2.cmml" xref="S2.p4.3.m1.1.1.2">𝑏</ci><ci id="S2.p4.3.m1.1.1.3.cmml" xref="S2.p4.3.m1.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.3.m1.1c">b^{W}</annotation><annotation encoding="application/x-llamapun" id="S2.p4.3.m1.1d">italic_b start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="b^{S}" class="ltx_Math" display="inline" id="S2.p4.4.m2.1"><semantics id="S2.p4.4.m2.1a"><msup id="S2.p4.4.m2.1.1" xref="S2.p4.4.m2.1.1.cmml"><mi id="S2.p4.4.m2.1.1.2" xref="S2.p4.4.m2.1.1.2.cmml">b</mi><mi id="S2.p4.4.m2.1.1.3" xref="S2.p4.4.m2.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S2.p4.4.m2.1b"><apply id="S2.p4.4.m2.1.1.cmml" xref="S2.p4.4.m2.1.1"><csymbol cd="ambiguous" id="S2.p4.4.m2.1.1.1.cmml" xref="S2.p4.4.m2.1.1">superscript</csymbol><ci id="S2.p4.4.m2.1.1.2.cmml" xref="S2.p4.4.m2.1.1.2">𝑏</ci><ci id="S2.p4.4.m2.1.1.3.cmml" xref="S2.p4.4.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.4.m2.1c">b^{S}</annotation><annotation encoding="application/x-llamapun" id="S2.p4.4.m2.1d">italic_b start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math> denote the cost of calling the weak and strong decoders respectively.
Decoding procedures including consensus <cite class="ltx_cite ltx_citemacro_citep">(Jacob et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib13" title="">2024</a>)</cite>, chain-of-thought <cite class="ltx_cite ltx_citemacro_citep">(Wei et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib25" title="">2022</a>)</cite>, self-critique <cite class="ltx_cite ltx_citemacro_citep">(Luo et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib19" title="">2024</a>)</cite> and debate <cite class="ltx_cite ltx_citemacro_citep">(Du et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib6" title="">2024</a>)</cite> may all be expressed in this form, with the budget <math alttext="b" class="ltx_Math" display="inline" id="S2.p4.5.m3.1"><semantics id="S2.p4.5.m3.1a"><mi id="S2.p4.5.m3.1.1" xref="S2.p4.5.m3.1.1.cmml">b</mi><annotation-xml encoding="MathML-Content" id="S2.p4.5.m3.1b"><ci id="S2.p4.5.m3.1.1.cmml" xref="S2.p4.5.m3.1.1">𝑏</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p4.5.m3.1c">b</annotation><annotation encoding="application/x-llamapun" id="S2.p4.5.m3.1d">italic_b</annotation></semantics></math> controlling the number of generated samples, tokens, or rounds of revision.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.p5">
<p class="ltx_p" id="S2.p5.3">In current practice, it is typical to set a <em class="ltx_emph ltx_font_italic" id="S2.p5.3.1">fixed</em> budget <math alttext="B" class="ltx_Math" display="inline" id="S2.p5.1.m1.1"><semantics id="S2.p5.1.m1.1a"><mi id="S2.p5.1.m1.1.1" xref="S2.p5.1.m1.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S2.p5.1.m1.1b"><ci id="S2.p5.1.m1.1.1.cmml" xref="S2.p5.1.m1.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.1.m1.1c">B</annotation><annotation encoding="application/x-llamapun" id="S2.p5.1.m1.1d">italic_B</annotation></semantics></math>, and allocate this uniformly for all queries—returning <math alttext="y_{i}\sim f(x_{i},B)" class="ltx_Math" display="inline" id="S2.p5.2.m2.2"><semantics id="S2.p5.2.m2.2a"><mrow id="S2.p5.2.m2.2.2" xref="S2.p5.2.m2.2.2.cmml"><msub id="S2.p5.2.m2.2.2.3" xref="S2.p5.2.m2.2.2.3.cmml"><mi id="S2.p5.2.m2.2.2.3.2" xref="S2.p5.2.m2.2.2.3.2.cmml">y</mi><mi id="S2.p5.2.m2.2.2.3.3" xref="S2.p5.2.m2.2.2.3.3.cmml">i</mi></msub><mo id="S2.p5.2.m2.2.2.2" xref="S2.p5.2.m2.2.2.2.cmml">∼</mo><mrow id="S2.p5.2.m2.2.2.1" xref="S2.p5.2.m2.2.2.1.cmml"><mi id="S2.p5.2.m2.2.2.1.3" xref="S2.p5.2.m2.2.2.1.3.cmml">f</mi><mo id="S2.p5.2.m2.2.2.1.2" xref="S2.p5.2.m2.2.2.1.2.cmml">⁢</mo><mrow id="S2.p5.2.m2.2.2.1.1.1" xref="S2.p5.2.m2.2.2.1.1.2.cmml"><mo id="S2.p5.2.m2.2.2.1.1.1.2" stretchy="false" xref="S2.p5.2.m2.2.2.1.1.2.cmml">(</mo><msub id="S2.p5.2.m2.2.2.1.1.1.1" xref="S2.p5.2.m2.2.2.1.1.1.1.cmml"><mi id="S2.p5.2.m2.2.2.1.1.1.1.2" xref="S2.p5.2.m2.2.2.1.1.1.1.2.cmml">x</mi><mi id="S2.p5.2.m2.2.2.1.1.1.1.3" xref="S2.p5.2.m2.2.2.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.p5.2.m2.2.2.1.1.1.3" xref="S2.p5.2.m2.2.2.1.1.2.cmml">,</mo><mi id="S2.p5.2.m2.1.1" xref="S2.p5.2.m2.1.1.cmml">B</mi><mo id="S2.p5.2.m2.2.2.1.1.1.4" stretchy="false" xref="S2.p5.2.m2.2.2.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.p5.2.m2.2b"><apply id="S2.p5.2.m2.2.2.cmml" xref="S2.p5.2.m2.2.2"><csymbol cd="latexml" id="S2.p5.2.m2.2.2.2.cmml" xref="S2.p5.2.m2.2.2.2">similar-to</csymbol><apply id="S2.p5.2.m2.2.2.3.cmml" xref="S2.p5.2.m2.2.2.3"><csymbol cd="ambiguous" id="S2.p5.2.m2.2.2.3.1.cmml" xref="S2.p5.2.m2.2.2.3">subscript</csymbol><ci id="S2.p5.2.m2.2.2.3.2.cmml" xref="S2.p5.2.m2.2.2.3.2">𝑦</ci><ci id="S2.p5.2.m2.2.2.3.3.cmml" xref="S2.p5.2.m2.2.2.3.3">𝑖</ci></apply><apply id="S2.p5.2.m2.2.2.1.cmml" xref="S2.p5.2.m2.2.2.1"><times id="S2.p5.2.m2.2.2.1.2.cmml" xref="S2.p5.2.m2.2.2.1.2"></times><ci id="S2.p5.2.m2.2.2.1.3.cmml" xref="S2.p5.2.m2.2.2.1.3">𝑓</ci><interval closure="open" id="S2.p5.2.m2.2.2.1.1.2.cmml" xref="S2.p5.2.m2.2.2.1.1.1"><apply id="S2.p5.2.m2.2.2.1.1.1.1.cmml" xref="S2.p5.2.m2.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S2.p5.2.m2.2.2.1.1.1.1.1.cmml" xref="S2.p5.2.m2.2.2.1.1.1.1">subscript</csymbol><ci id="S2.p5.2.m2.2.2.1.1.1.1.2.cmml" xref="S2.p5.2.m2.2.2.1.1.1.1.2">𝑥</ci><ci id="S2.p5.2.m2.2.2.1.1.1.1.3.cmml" xref="S2.p5.2.m2.2.2.1.1.1.1.3">𝑖</ci></apply><ci id="S2.p5.2.m2.1.1.cmml" xref="S2.p5.2.m2.1.1">𝐵</ci></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.2.m2.2c">y_{i}\sim f(x_{i},B)</annotation><annotation encoding="application/x-llamapun" id="S2.p5.2.m2.2d">italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∼ italic_f ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_B )</annotation></semantics></math> for each <math alttext="x_{i}" class="ltx_Math" display="inline" id="S2.p5.3.m3.1"><semantics id="S2.p5.3.m3.1a"><msub id="S2.p5.3.m3.1.1" xref="S2.p5.3.m3.1.1.cmml"><mi id="S2.p5.3.m3.1.1.2" xref="S2.p5.3.m3.1.1.2.cmml">x</mi><mi id="S2.p5.3.m3.1.1.3" xref="S2.p5.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p5.3.m3.1b"><apply id="S2.p5.3.m3.1.1.cmml" xref="S2.p5.3.m3.1.1"><csymbol cd="ambiguous" id="S2.p5.3.m3.1.1.1.cmml" xref="S2.p5.3.m3.1.1">subscript</csymbol><ci id="S2.p5.3.m3.1.1.2.cmml" xref="S2.p5.3.m3.1.1.2">𝑥</ci><ci id="S2.p5.3.m3.1.1.3.cmml" xref="S2.p5.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.3.m3.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.p5.3.m3.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. In this case, the expected reward for a set of queries is simply:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\sum_{i}\mathbb{E}_{y_{i}\sim f(x_{i},B)}[r(x_{i},y_{i})]" class="ltx_Math" display="block" id="S2.E3.m1.3"><semantics id="S2.E3.m1.3a"><mrow id="S2.E3.m1.3.3" xref="S2.E3.m1.3.3.cmml"><munder id="S2.E3.m1.3.3.2" xref="S2.E3.m1.3.3.2.cmml"><mo id="S2.E3.m1.3.3.2.2" movablelimits="false" xref="S2.E3.m1.3.3.2.2.cmml">∑</mo><mi id="S2.E3.m1.3.3.2.3" xref="S2.E3.m1.3.3.2.3.cmml">i</mi></munder><mrow id="S2.E3.m1.3.3.1" xref="S2.E3.m1.3.3.1.cmml"><msub id="S2.E3.m1.3.3.1.3" xref="S2.E3.m1.3.3.1.3.cmml"><mi id="S2.E3.m1.3.3.1.3.2" xref="S2.E3.m1.3.3.1.3.2.cmml">𝔼</mi><mrow id="S2.E3.m1.2.2.2" xref="S2.E3.m1.2.2.2.cmml"><msub id="S2.E3.m1.2.2.2.4" xref="S2.E3.m1.2.2.2.4.cmml"><mi id="S2.E3.m1.2.2.2.4.2" xref="S2.E3.m1.2.2.2.4.2.cmml">y</mi><mi id="S2.E3.m1.2.2.2.4.3" xref="S2.E3.m1.2.2.2.4.3.cmml">i</mi></msub><mo id="S2.E3.m1.2.2.2.3" xref="S2.E3.m1.2.2.2.3.cmml">∼</mo><mrow id="S2.E3.m1.2.2.2.2" xref="S2.E3.m1.2.2.2.2.cmml"><mi id="S2.E3.m1.2.2.2.2.3" xref="S2.E3.m1.2.2.2.2.3.cmml">f</mi><mo id="S2.E3.m1.2.2.2.2.2" xref="S2.E3.m1.2.2.2.2.2.cmml">⁢</mo><mrow id="S2.E3.m1.2.2.2.2.1.1" xref="S2.E3.m1.2.2.2.2.1.2.cmml"><mo id="S2.E3.m1.2.2.2.2.1.1.2" stretchy="false" xref="S2.E3.m1.2.2.2.2.1.2.cmml">(</mo><msub id="S2.E3.m1.2.2.2.2.1.1.1" xref="S2.E3.m1.2.2.2.2.1.1.1.cmml"><mi id="S2.E3.m1.2.2.2.2.1.1.1.2" xref="S2.E3.m1.2.2.2.2.1.1.1.2.cmml">x</mi><mi id="S2.E3.m1.2.2.2.2.1.1.1.3" xref="S2.E3.m1.2.2.2.2.1.1.1.3.cmml">i</mi></msub><mo id="S2.E3.m1.2.2.2.2.1.1.3" xref="S2.E3.m1.2.2.2.2.1.2.cmml">,</mo><mi id="S2.E3.m1.1.1.1.1" xref="S2.E3.m1.1.1.1.1.cmml">B</mi><mo id="S2.E3.m1.2.2.2.2.1.1.4" stretchy="false" xref="S2.E3.m1.2.2.2.2.1.2.cmml">)</mo></mrow></mrow></mrow></msub><mo id="S2.E3.m1.3.3.1.2" xref="S2.E3.m1.3.3.1.2.cmml">⁢</mo><mrow id="S2.E3.m1.3.3.1.1.1" xref="S2.E3.m1.3.3.1.1.2.cmml"><mo id="S2.E3.m1.3.3.1.1.1.2" stretchy="false" xref="S2.E3.m1.3.3.1.1.2.1.cmml">[</mo><mrow id="S2.E3.m1.3.3.1.1.1.1" xref="S2.E3.m1.3.3.1.1.1.1.cmml"><mi id="S2.E3.m1.3.3.1.1.1.1.4" xref="S2.E3.m1.3.3.1.1.1.1.4.cmml">r</mi><mo id="S2.E3.m1.3.3.1.1.1.1.3" xref="S2.E3.m1.3.3.1.1.1.1.3.cmml">⁢</mo><mrow id="S2.E3.m1.3.3.1.1.1.1.2.2" xref="S2.E3.m1.3.3.1.1.1.1.2.3.cmml"><mo id="S2.E3.m1.3.3.1.1.1.1.2.2.3" stretchy="false" xref="S2.E3.m1.3.3.1.1.1.1.2.3.cmml">(</mo><msub id="S2.E3.m1.3.3.1.1.1.1.1.1.1" xref="S2.E3.m1.3.3.1.1.1.1.1.1.1.cmml"><mi id="S2.E3.m1.3.3.1.1.1.1.1.1.1.2" xref="S2.E3.m1.3.3.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S2.E3.m1.3.3.1.1.1.1.1.1.1.3" xref="S2.E3.m1.3.3.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.E3.m1.3.3.1.1.1.1.2.2.4" xref="S2.E3.m1.3.3.1.1.1.1.2.3.cmml">,</mo><msub id="S2.E3.m1.3.3.1.1.1.1.2.2.2" xref="S2.E3.m1.3.3.1.1.1.1.2.2.2.cmml"><mi id="S2.E3.m1.3.3.1.1.1.1.2.2.2.2" xref="S2.E3.m1.3.3.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="S2.E3.m1.3.3.1.1.1.1.2.2.2.3" xref="S2.E3.m1.3.3.1.1.1.1.2.2.2.3.cmml">i</mi></msub><mo id="S2.E3.m1.3.3.1.1.1.1.2.2.5" stretchy="false" xref="S2.E3.m1.3.3.1.1.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S2.E3.m1.3.3.1.1.1.3" stretchy="false" xref="S2.E3.m1.3.3.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E3.m1.3b"><apply id="S2.E3.m1.3.3.cmml" xref="S2.E3.m1.3.3"><apply id="S2.E3.m1.3.3.2.cmml" xref="S2.E3.m1.3.3.2"><csymbol cd="ambiguous" id="S2.E3.m1.3.3.2.1.cmml" xref="S2.E3.m1.3.3.2">subscript</csymbol><sum id="S2.E3.m1.3.3.2.2.cmml" xref="S2.E3.m1.3.3.2.2"></sum><ci id="S2.E3.m1.3.3.2.3.cmml" xref="S2.E3.m1.3.3.2.3">𝑖</ci></apply><apply id="S2.E3.m1.3.3.1.cmml" xref="S2.E3.m1.3.3.1"><times id="S2.E3.m1.3.3.1.2.cmml" xref="S2.E3.m1.3.3.1.2"></times><apply id="S2.E3.m1.3.3.1.3.cmml" xref="S2.E3.m1.3.3.1.3"><csymbol cd="ambiguous" id="S2.E3.m1.3.3.1.3.1.cmml" xref="S2.E3.m1.3.3.1.3">subscript</csymbol><ci id="S2.E3.m1.3.3.1.3.2.cmml" xref="S2.E3.m1.3.3.1.3.2">𝔼</ci><apply id="S2.E3.m1.2.2.2.cmml" xref="S2.E3.m1.2.2.2"><csymbol cd="latexml" id="S2.E3.m1.2.2.2.3.cmml" xref="S2.E3.m1.2.2.2.3">similar-to</csymbol><apply id="S2.E3.m1.2.2.2.4.cmml" xref="S2.E3.m1.2.2.2.4"><csymbol cd="ambiguous" id="S2.E3.m1.2.2.2.4.1.cmml" xref="S2.E3.m1.2.2.2.4">subscript</csymbol><ci id="S2.E3.m1.2.2.2.4.2.cmml" xref="S2.E3.m1.2.2.2.4.2">𝑦</ci><ci id="S2.E3.m1.2.2.2.4.3.cmml" xref="S2.E3.m1.2.2.2.4.3">𝑖</ci></apply><apply id="S2.E3.m1.2.2.2.2.cmml" xref="S2.E3.m1.2.2.2.2"><times id="S2.E3.m1.2.2.2.2.2.cmml" xref="S2.E3.m1.2.2.2.2.2"></times><ci id="S2.E3.m1.2.2.2.2.3.cmml" xref="S2.E3.m1.2.2.2.2.3">𝑓</ci><interval closure="open" id="S2.E3.m1.2.2.2.2.1.2.cmml" xref="S2.E3.m1.2.2.2.2.1.1"><apply id="S2.E3.m1.2.2.2.2.1.1.1.cmml" xref="S2.E3.m1.2.2.2.2.1.1.1"><csymbol cd="ambiguous" id="S2.E3.m1.2.2.2.2.1.1.1.1.cmml" xref="S2.E3.m1.2.2.2.2.1.1.1">subscript</csymbol><ci id="S2.E3.m1.2.2.2.2.1.1.1.2.cmml" xref="S2.E3.m1.2.2.2.2.1.1.1.2">𝑥</ci><ci id="S2.E3.m1.2.2.2.2.1.1.1.3.cmml" xref="S2.E3.m1.2.2.2.2.1.1.1.3">𝑖</ci></apply><ci id="S2.E3.m1.1.1.1.1.cmml" xref="S2.E3.m1.1.1.1.1">𝐵</ci></interval></apply></apply></apply><apply id="S2.E3.m1.3.3.1.1.2.cmml" xref="S2.E3.m1.3.3.1.1.1"><csymbol cd="latexml" id="S2.E3.m1.3.3.1.1.2.1.cmml" xref="S2.E3.m1.3.3.1.1.1.2">delimited-[]</csymbol><apply id="S2.E3.m1.3.3.1.1.1.1.cmml" xref="S2.E3.m1.3.3.1.1.1.1"><times id="S2.E3.m1.3.3.1.1.1.1.3.cmml" xref="S2.E3.m1.3.3.1.1.1.1.3"></times><ci id="S2.E3.m1.3.3.1.1.1.1.4.cmml" xref="S2.E3.m1.3.3.1.1.1.1.4">𝑟</ci><interval closure="open" id="S2.E3.m1.3.3.1.1.1.1.2.3.cmml" xref="S2.E3.m1.3.3.1.1.1.1.2.2"><apply id="S2.E3.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S2.E3.m1.3.3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E3.m1.3.3.1.1.1.1.1.1.1.1.cmml" xref="S2.E3.m1.3.3.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E3.m1.3.3.1.1.1.1.1.1.1.2.cmml" xref="S2.E3.m1.3.3.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S2.E3.m1.3.3.1.1.1.1.1.1.1.3.cmml" xref="S2.E3.m1.3.3.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S2.E3.m1.3.3.1.1.1.1.2.2.2.cmml" xref="S2.E3.m1.3.3.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E3.m1.3.3.1.1.1.1.2.2.2.1.cmml" xref="S2.E3.m1.3.3.1.1.1.1.2.2.2">subscript</csymbol><ci id="S2.E3.m1.3.3.1.1.1.1.2.2.2.2.cmml" xref="S2.E3.m1.3.3.1.1.1.1.2.2.2.2">𝑦</ci><ci id="S2.E3.m1.3.3.1.1.1.1.2.2.2.3.cmml" xref="S2.E3.m1.3.3.1.1.1.1.2.2.2.3">𝑖</ci></apply></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E3.m1.3c">\sum_{i}\mathbb{E}_{y_{i}\sim f(x_{i},B)}[r(x_{i},y_{i})]</annotation><annotation encoding="application/x-llamapun" id="S2.E3.m1.3d">∑ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∼ italic_f ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_B ) end_POSTSUBSCRIPT [ italic_r ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p5.5">But as noted in <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S1" title="1 Introduction ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Section</span> <span class="ltx_text ltx_ref_tag">1</span></a>, different <math alttext="x_{i}" class="ltx_Math" display="inline" id="S2.p5.4.m1.1"><semantics id="S2.p5.4.m1.1a"><msub id="S2.p5.4.m1.1.1" xref="S2.p5.4.m1.1.1.cmml"><mi id="S2.p5.4.m1.1.1.2" xref="S2.p5.4.m1.1.1.2.cmml">x</mi><mi id="S2.p5.4.m1.1.1.3" xref="S2.p5.4.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.p5.4.m1.1b"><apply id="S2.p5.4.m1.1.1.cmml" xref="S2.p5.4.m1.1.1"><csymbol cd="ambiguous" id="S2.p5.4.m1.1.1.1.cmml" xref="S2.p5.4.m1.1.1">subscript</csymbol><ci id="S2.p5.4.m1.1.1.2.cmml" xref="S2.p5.4.m1.1.1.2">𝑥</ci><ci id="S2.p5.4.m1.1.1.3.cmml" xref="S2.p5.4.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.4.m1.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.p5.4.m1.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> may in practice benefit differentially from increased budgets.
In this paper, we consider a more flexible version of the problem—if we are willing to set a fixed <em class="ltx_emph ltx_font_italic" id="S2.p5.5.1">average</em> computational cost per query, can we improve overall accuracy by allocating this computation adaptively?
In this case, responding to a collection of queries <math alttext="\{x_{1},\ldots,x_{n}\}" class="ltx_Math" display="inline" id="S2.p5.5.m2.3"><semantics id="S2.p5.5.m2.3a"><mrow id="S2.p5.5.m2.3.3.2" xref="S2.p5.5.m2.3.3.3.cmml"><mo id="S2.p5.5.m2.3.3.2.3" stretchy="false" xref="S2.p5.5.m2.3.3.3.cmml">{</mo><msub id="S2.p5.5.m2.2.2.1.1" xref="S2.p5.5.m2.2.2.1.1.cmml"><mi id="S2.p5.5.m2.2.2.1.1.2" xref="S2.p5.5.m2.2.2.1.1.2.cmml">x</mi><mn id="S2.p5.5.m2.2.2.1.1.3" xref="S2.p5.5.m2.2.2.1.1.3.cmml">1</mn></msub><mo id="S2.p5.5.m2.3.3.2.4" xref="S2.p5.5.m2.3.3.3.cmml">,</mo><mi id="S2.p5.5.m2.1.1" mathvariant="normal" xref="S2.p5.5.m2.1.1.cmml">…</mi><mo id="S2.p5.5.m2.3.3.2.5" xref="S2.p5.5.m2.3.3.3.cmml">,</mo><msub id="S2.p5.5.m2.3.3.2.2" xref="S2.p5.5.m2.3.3.2.2.cmml"><mi id="S2.p5.5.m2.3.3.2.2.2" xref="S2.p5.5.m2.3.3.2.2.2.cmml">x</mi><mi id="S2.p5.5.m2.3.3.2.2.3" xref="S2.p5.5.m2.3.3.2.2.3.cmml">n</mi></msub><mo id="S2.p5.5.m2.3.3.2.6" stretchy="false" xref="S2.p5.5.m2.3.3.3.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.p5.5.m2.3b"><set id="S2.p5.5.m2.3.3.3.cmml" xref="S2.p5.5.m2.3.3.2"><apply id="S2.p5.5.m2.2.2.1.1.cmml" xref="S2.p5.5.m2.2.2.1.1"><csymbol cd="ambiguous" id="S2.p5.5.m2.2.2.1.1.1.cmml" xref="S2.p5.5.m2.2.2.1.1">subscript</csymbol><ci id="S2.p5.5.m2.2.2.1.1.2.cmml" xref="S2.p5.5.m2.2.2.1.1.2">𝑥</ci><cn id="S2.p5.5.m2.2.2.1.1.3.cmml" type="integer" xref="S2.p5.5.m2.2.2.1.1.3">1</cn></apply><ci id="S2.p5.5.m2.1.1.cmml" xref="S2.p5.5.m2.1.1">…</ci><apply id="S2.p5.5.m2.3.3.2.2.cmml" xref="S2.p5.5.m2.3.3.2.2"><csymbol cd="ambiguous" id="S2.p5.5.m2.3.3.2.2.1.cmml" xref="S2.p5.5.m2.3.3.2.2">subscript</csymbol><ci id="S2.p5.5.m2.3.3.2.2.2.cmml" xref="S2.p5.5.m2.3.3.2.2.2">𝑥</ci><ci id="S2.p5.5.m2.3.3.2.2.3.cmml" xref="S2.p5.5.m2.3.3.2.2.3">𝑛</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S2.p5.5.m2.3c">\{x_{1},\ldots,x_{n}\}</annotation><annotation encoding="application/x-llamapun" id="S2.p5.5.m2.3d">{ italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_x start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT }</annotation></semantics></math> corresponds to solving:</p>
<table class="ltx_equation ltx_eqn_table" id="S2.E4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\max_{b_{1},\ldots,b_{n}}\quad{\sum_{i}\mathbb{E}_{y_{i}\sim f(x_{i},b_{i})}[r%
(x_{i},y_{i})}]\quad\text{s.t.}\quad\sum_{i}b_{i}\leq B\cdot n" class="ltx_Math" display="block" id="S2.E4.m1.9"><semantics id="S2.E4.m1.9a"><mrow id="S2.E4.m1.9.9" xref="S2.E4.m1.9.9.cmml"><mrow id="S2.E4.m1.9.9.3.3" xref="S2.E4.m1.9.9.3.4.cmml"><munder id="S2.E4.m1.7.7.1.1.1" xref="S2.E4.m1.7.7.1.1.1.cmml"><mi id="S2.E4.m1.7.7.1.1.1.2" xref="S2.E4.m1.7.7.1.1.1.2.cmml">max</mi><mrow id="S2.E4.m1.3.3.3.3" xref="S2.E4.m1.3.3.3.4.cmml"><msub id="S2.E4.m1.2.2.2.2.1" xref="S2.E4.m1.2.2.2.2.1.cmml"><mi id="S2.E4.m1.2.2.2.2.1.2" xref="S2.E4.m1.2.2.2.2.1.2.cmml">b</mi><mn id="S2.E4.m1.2.2.2.2.1.3" xref="S2.E4.m1.2.2.2.2.1.3.cmml">1</mn></msub><mo id="S2.E4.m1.3.3.3.3.3" xref="S2.E4.m1.3.3.3.4.cmml">,</mo><mi id="S2.E4.m1.1.1.1.1" mathvariant="normal" xref="S2.E4.m1.1.1.1.1.cmml">…</mi><mo id="S2.E4.m1.3.3.3.3.4" xref="S2.E4.m1.3.3.3.4.cmml">,</mo><msub id="S2.E4.m1.3.3.3.3.2" xref="S2.E4.m1.3.3.3.3.2.cmml"><mi id="S2.E4.m1.3.3.3.3.2.2" xref="S2.E4.m1.3.3.3.3.2.2.cmml">b</mi><mi id="S2.E4.m1.3.3.3.3.2.3" xref="S2.E4.m1.3.3.3.3.2.3.cmml">n</mi></msub></mrow></munder><mspace id="S2.E4.m1.9.9.3.3.4" width="1.167em" xref="S2.E4.m1.9.9.3.4.cmml"></mspace><mrow id="S2.E4.m1.8.8.2.2.2" xref="S2.E4.m1.8.8.2.2.2.cmml"><munder id="S2.E4.m1.8.8.2.2.2.2" xref="S2.E4.m1.8.8.2.2.2.2.cmml"><mo id="S2.E4.m1.8.8.2.2.2.2.2" movablelimits="false" xref="S2.E4.m1.8.8.2.2.2.2.2.cmml">∑</mo><mi id="S2.E4.m1.8.8.2.2.2.2.3" xref="S2.E4.m1.8.8.2.2.2.2.3.cmml">i</mi></munder><mrow id="S2.E4.m1.8.8.2.2.2.1" xref="S2.E4.m1.8.8.2.2.2.1.cmml"><msub id="S2.E4.m1.8.8.2.2.2.1.3" xref="S2.E4.m1.8.8.2.2.2.1.3.cmml"><mi id="S2.E4.m1.8.8.2.2.2.1.3.2" xref="S2.E4.m1.8.8.2.2.2.1.3.2.cmml">𝔼</mi><mrow id="S2.E4.m1.5.5.2" xref="S2.E4.m1.5.5.2.cmml"><msub id="S2.E4.m1.5.5.2.4" xref="S2.E4.m1.5.5.2.4.cmml"><mi id="S2.E4.m1.5.5.2.4.2" xref="S2.E4.m1.5.5.2.4.2.cmml">y</mi><mi id="S2.E4.m1.5.5.2.4.3" xref="S2.E4.m1.5.5.2.4.3.cmml">i</mi></msub><mo id="S2.E4.m1.5.5.2.3" xref="S2.E4.m1.5.5.2.3.cmml">∼</mo><mrow id="S2.E4.m1.5.5.2.2" xref="S2.E4.m1.5.5.2.2.cmml"><mi id="S2.E4.m1.5.5.2.2.4" xref="S2.E4.m1.5.5.2.2.4.cmml">f</mi><mo id="S2.E4.m1.5.5.2.2.3" xref="S2.E4.m1.5.5.2.2.3.cmml">⁢</mo><mrow id="S2.E4.m1.5.5.2.2.2.2" xref="S2.E4.m1.5.5.2.2.2.3.cmml"><mo id="S2.E4.m1.5.5.2.2.2.2.3" stretchy="false" xref="S2.E4.m1.5.5.2.2.2.3.cmml">(</mo><msub id="S2.E4.m1.4.4.1.1.1.1.1" xref="S2.E4.m1.4.4.1.1.1.1.1.cmml"><mi id="S2.E4.m1.4.4.1.1.1.1.1.2" xref="S2.E4.m1.4.4.1.1.1.1.1.2.cmml">x</mi><mi id="S2.E4.m1.4.4.1.1.1.1.1.3" xref="S2.E4.m1.4.4.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.E4.m1.5.5.2.2.2.2.4" xref="S2.E4.m1.5.5.2.2.2.3.cmml">,</mo><msub id="S2.E4.m1.5.5.2.2.2.2.2" xref="S2.E4.m1.5.5.2.2.2.2.2.cmml"><mi id="S2.E4.m1.5.5.2.2.2.2.2.2" xref="S2.E4.m1.5.5.2.2.2.2.2.2.cmml">b</mi><mi id="S2.E4.m1.5.5.2.2.2.2.2.3" xref="S2.E4.m1.5.5.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S2.E4.m1.5.5.2.2.2.2.5" stretchy="false" xref="S2.E4.m1.5.5.2.2.2.3.cmml">)</mo></mrow></mrow></mrow></msub><mo id="S2.E4.m1.8.8.2.2.2.1.2" xref="S2.E4.m1.8.8.2.2.2.1.2.cmml">⁢</mo><mrow id="S2.E4.m1.8.8.2.2.2.1.1.1" xref="S2.E4.m1.8.8.2.2.2.1.1.2.cmml"><mo id="S2.E4.m1.8.8.2.2.2.1.1.1.2" stretchy="false" xref="S2.E4.m1.8.8.2.2.2.1.1.2.1.cmml">[</mo><mrow id="S2.E4.m1.8.8.2.2.2.1.1.1.1" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.cmml"><mi id="S2.E4.m1.8.8.2.2.2.1.1.1.1.4" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.4.cmml">r</mi><mo id="S2.E4.m1.8.8.2.2.2.1.1.1.1.3" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.3.cmml">⁢</mo><mrow id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.3.cmml"><mo id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.3" stretchy="false" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.3.cmml">(</mo><msub id="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.cmml"><mi id="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.2" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.3" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.4" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.3.cmml">,</mo><msub id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.cmml"><mi id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.2" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.2.cmml">y</mi><mi id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.3" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.3.cmml">i</mi></msub><mo id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.5" stretchy="false" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S2.E4.m1.8.8.2.2.2.1.1.1.3" stretchy="false" xref="S2.E4.m1.8.8.2.2.2.1.1.2.1.cmml">]</mo></mrow></mrow></mrow><mspace id="S2.E4.m1.9.9.3.3.5" width="1em" xref="S2.E4.m1.9.9.3.4.cmml"></mspace><mtext id="S2.E4.m1.6.6" xref="S2.E4.m1.6.6a.cmml">s.t.</mtext><mspace id="S2.E4.m1.9.9.3.3.6" width="1em" xref="S2.E4.m1.9.9.3.4.cmml"></mspace><mrow id="S2.E4.m1.9.9.3.3.3" xref="S2.E4.m1.9.9.3.3.3.cmml"><munder id="S2.E4.m1.9.9.3.3.3.1" xref="S2.E4.m1.9.9.3.3.3.1.cmml"><mo id="S2.E4.m1.9.9.3.3.3.1.2" movablelimits="false" xref="S2.E4.m1.9.9.3.3.3.1.2.cmml">∑</mo><mi id="S2.E4.m1.9.9.3.3.3.1.3" xref="S2.E4.m1.9.9.3.3.3.1.3.cmml">i</mi></munder><msub id="S2.E4.m1.9.9.3.3.3.2" xref="S2.E4.m1.9.9.3.3.3.2.cmml"><mi id="S2.E4.m1.9.9.3.3.3.2.2" xref="S2.E4.m1.9.9.3.3.3.2.2.cmml">b</mi><mi id="S2.E4.m1.9.9.3.3.3.2.3" xref="S2.E4.m1.9.9.3.3.3.2.3.cmml">i</mi></msub></mrow></mrow><mo id="S2.E4.m1.9.9.4" xref="S2.E4.m1.9.9.4.cmml">≤</mo><mrow id="S2.E4.m1.9.9.5" xref="S2.E4.m1.9.9.5.cmml"><mi id="S2.E4.m1.9.9.5.2" xref="S2.E4.m1.9.9.5.2.cmml">B</mi><mo id="S2.E4.m1.9.9.5.1" lspace="0.222em" rspace="0.222em" xref="S2.E4.m1.9.9.5.1.cmml">⋅</mo><mi id="S2.E4.m1.9.9.5.3" xref="S2.E4.m1.9.9.5.3.cmml">n</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.E4.m1.9b"><apply id="S2.E4.m1.9.9.cmml" xref="S2.E4.m1.9.9"><leq id="S2.E4.m1.9.9.4.cmml" xref="S2.E4.m1.9.9.4"></leq><list id="S2.E4.m1.9.9.3.4.cmml" xref="S2.E4.m1.9.9.3.3"><apply id="S2.E4.m1.7.7.1.1.1.cmml" xref="S2.E4.m1.7.7.1.1.1"><csymbol cd="ambiguous" id="S2.E4.m1.7.7.1.1.1.1.cmml" xref="S2.E4.m1.7.7.1.1.1">subscript</csymbol><max id="S2.E4.m1.7.7.1.1.1.2.cmml" xref="S2.E4.m1.7.7.1.1.1.2"></max><list id="S2.E4.m1.3.3.3.4.cmml" xref="S2.E4.m1.3.3.3.3"><apply id="S2.E4.m1.2.2.2.2.1.cmml" xref="S2.E4.m1.2.2.2.2.1"><csymbol cd="ambiguous" id="S2.E4.m1.2.2.2.2.1.1.cmml" xref="S2.E4.m1.2.2.2.2.1">subscript</csymbol><ci id="S2.E4.m1.2.2.2.2.1.2.cmml" xref="S2.E4.m1.2.2.2.2.1.2">𝑏</ci><cn id="S2.E4.m1.2.2.2.2.1.3.cmml" type="integer" xref="S2.E4.m1.2.2.2.2.1.3">1</cn></apply><ci id="S2.E4.m1.1.1.1.1.cmml" xref="S2.E4.m1.1.1.1.1">…</ci><apply id="S2.E4.m1.3.3.3.3.2.cmml" xref="S2.E4.m1.3.3.3.3.2"><csymbol cd="ambiguous" id="S2.E4.m1.3.3.3.3.2.1.cmml" xref="S2.E4.m1.3.3.3.3.2">subscript</csymbol><ci id="S2.E4.m1.3.3.3.3.2.2.cmml" xref="S2.E4.m1.3.3.3.3.2.2">𝑏</ci><ci id="S2.E4.m1.3.3.3.3.2.3.cmml" xref="S2.E4.m1.3.3.3.3.2.3">𝑛</ci></apply></list></apply><apply id="S2.E4.m1.8.8.2.2.2.cmml" xref="S2.E4.m1.8.8.2.2.2"><apply id="S2.E4.m1.8.8.2.2.2.2.cmml" xref="S2.E4.m1.8.8.2.2.2.2"><csymbol cd="ambiguous" id="S2.E4.m1.8.8.2.2.2.2.1.cmml" xref="S2.E4.m1.8.8.2.2.2.2">subscript</csymbol><sum id="S2.E4.m1.8.8.2.2.2.2.2.cmml" xref="S2.E4.m1.8.8.2.2.2.2.2"></sum><ci id="S2.E4.m1.8.8.2.2.2.2.3.cmml" xref="S2.E4.m1.8.8.2.2.2.2.3">𝑖</ci></apply><apply id="S2.E4.m1.8.8.2.2.2.1.cmml" xref="S2.E4.m1.8.8.2.2.2.1"><times id="S2.E4.m1.8.8.2.2.2.1.2.cmml" xref="S2.E4.m1.8.8.2.2.2.1.2"></times><apply id="S2.E4.m1.8.8.2.2.2.1.3.cmml" xref="S2.E4.m1.8.8.2.2.2.1.3"><csymbol cd="ambiguous" id="S2.E4.m1.8.8.2.2.2.1.3.1.cmml" xref="S2.E4.m1.8.8.2.2.2.1.3">subscript</csymbol><ci id="S2.E4.m1.8.8.2.2.2.1.3.2.cmml" xref="S2.E4.m1.8.8.2.2.2.1.3.2">𝔼</ci><apply id="S2.E4.m1.5.5.2.cmml" xref="S2.E4.m1.5.5.2"><csymbol cd="latexml" id="S2.E4.m1.5.5.2.3.cmml" xref="S2.E4.m1.5.5.2.3">similar-to</csymbol><apply id="S2.E4.m1.5.5.2.4.cmml" xref="S2.E4.m1.5.5.2.4"><csymbol cd="ambiguous" id="S2.E4.m1.5.5.2.4.1.cmml" xref="S2.E4.m1.5.5.2.4">subscript</csymbol><ci id="S2.E4.m1.5.5.2.4.2.cmml" xref="S2.E4.m1.5.5.2.4.2">𝑦</ci><ci id="S2.E4.m1.5.5.2.4.3.cmml" xref="S2.E4.m1.5.5.2.4.3">𝑖</ci></apply><apply id="S2.E4.m1.5.5.2.2.cmml" xref="S2.E4.m1.5.5.2.2"><times id="S2.E4.m1.5.5.2.2.3.cmml" xref="S2.E4.m1.5.5.2.2.3"></times><ci id="S2.E4.m1.5.5.2.2.4.cmml" xref="S2.E4.m1.5.5.2.2.4">𝑓</ci><interval closure="open" id="S2.E4.m1.5.5.2.2.2.3.cmml" xref="S2.E4.m1.5.5.2.2.2.2"><apply id="S2.E4.m1.4.4.1.1.1.1.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E4.m1.4.4.1.1.1.1.1.1.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1">subscript</csymbol><ci id="S2.E4.m1.4.4.1.1.1.1.1.2.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.2">𝑥</ci><ci id="S2.E4.m1.4.4.1.1.1.1.1.3.cmml" xref="S2.E4.m1.4.4.1.1.1.1.1.3">𝑖</ci></apply><apply id="S2.E4.m1.5.5.2.2.2.2.2.cmml" xref="S2.E4.m1.5.5.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.E4.m1.5.5.2.2.2.2.2.1.cmml" xref="S2.E4.m1.5.5.2.2.2.2.2">subscript</csymbol><ci id="S2.E4.m1.5.5.2.2.2.2.2.2.cmml" xref="S2.E4.m1.5.5.2.2.2.2.2.2">𝑏</ci><ci id="S2.E4.m1.5.5.2.2.2.2.2.3.cmml" xref="S2.E4.m1.5.5.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></apply></apply><apply id="S2.E4.m1.8.8.2.2.2.1.1.2.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1"><csymbol cd="latexml" id="S2.E4.m1.8.8.2.2.2.1.1.2.1.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.2">delimited-[]</csymbol><apply id="S2.E4.m1.8.8.2.2.2.1.1.1.1.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1"><times id="S2.E4.m1.8.8.2.2.2.1.1.1.1.3.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.3"></times><ci id="S2.E4.m1.8.8.2.2.2.1.1.1.1.4.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.4">𝑟</ci><interval closure="open" id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.3.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2"><apply id="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.1.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.2.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.3.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.1.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2">subscript</csymbol><ci id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.2.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.2">𝑦</ci><ci id="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.3.cmml" xref="S2.E4.m1.8.8.2.2.2.1.1.1.1.2.2.2.3">𝑖</ci></apply></interval></apply></apply></apply></apply><ci id="S2.E4.m1.6.6a.cmml" xref="S2.E4.m1.6.6"><mtext id="S2.E4.m1.6.6.cmml" xref="S2.E4.m1.6.6">s.t.</mtext></ci><apply id="S2.E4.m1.9.9.3.3.3.cmml" xref="S2.E4.m1.9.9.3.3.3"><apply id="S2.E4.m1.9.9.3.3.3.1.cmml" xref="S2.E4.m1.9.9.3.3.3.1"><csymbol cd="ambiguous" id="S2.E4.m1.9.9.3.3.3.1.1.cmml" xref="S2.E4.m1.9.9.3.3.3.1">subscript</csymbol><sum id="S2.E4.m1.9.9.3.3.3.1.2.cmml" xref="S2.E4.m1.9.9.3.3.3.1.2"></sum><ci id="S2.E4.m1.9.9.3.3.3.1.3.cmml" xref="S2.E4.m1.9.9.3.3.3.1.3">𝑖</ci></apply><apply id="S2.E4.m1.9.9.3.3.3.2.cmml" xref="S2.E4.m1.9.9.3.3.3.2"><csymbol cd="ambiguous" id="S2.E4.m1.9.9.3.3.3.2.1.cmml" xref="S2.E4.m1.9.9.3.3.3.2">subscript</csymbol><ci id="S2.E4.m1.9.9.3.3.3.2.2.cmml" xref="S2.E4.m1.9.9.3.3.3.2.2">𝑏</ci><ci id="S2.E4.m1.9.9.3.3.3.2.3.cmml" xref="S2.E4.m1.9.9.3.3.3.2.3">𝑖</ci></apply></apply></list><apply id="S2.E4.m1.9.9.5.cmml" xref="S2.E4.m1.9.9.5"><ci id="S2.E4.m1.9.9.5.1.cmml" xref="S2.E4.m1.9.9.5.1">⋅</ci><ci id="S2.E4.m1.9.9.5.2.cmml" xref="S2.E4.m1.9.9.5.2">𝐵</ci><ci id="S2.E4.m1.9.9.5.3.cmml" xref="S2.E4.m1.9.9.5.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E4.m1.9c">\max_{b_{1},\ldots,b_{n}}\quad{\sum_{i}\mathbb{E}_{y_{i}\sim f(x_{i},b_{i})}[r%
(x_{i},y_{i})}]\quad\text{s.t.}\quad\sum_{i}b_{i}\leq B\cdot n</annotation><annotation encoding="application/x-llamapun" id="S2.E4.m1.9d">roman_max start_POSTSUBSCRIPT italic_b start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_b start_POSTSUBSCRIPT italic_n end_POSTSUBSCRIPT end_POSTSUBSCRIPT ∑ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT blackboard_E start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∼ italic_f ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) end_POSTSUBSCRIPT [ italic_r ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ] s.t. ∑ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ≤ italic_B ⋅ italic_n</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(4)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.p5.6">Below, we develop a method for solving this <span class="ltx_text ltx_font_bold" id="S2.p5.6.1">adaptive comptuation scaling problem</span> efficiently.</p>
</div>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Method</h2>
<div class="ltx_para ltx_noindent" id="S3.p1">
<p class="ltx_p" id="S3.p1.9">In <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S2.E4" title="In 2 Preliminaries ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">4</span></a>, we would like to allocate computation <math alttext="b_{i}" class="ltx_Math" display="inline" id="S3.p1.1.m1.1"><semantics id="S3.p1.1.m1.1a"><msub id="S3.p1.1.m1.1.1" xref="S3.p1.1.m1.1.1.cmml"><mi id="S3.p1.1.m1.1.1.2" xref="S3.p1.1.m1.1.1.2.cmml">b</mi><mi id="S3.p1.1.m1.1.1.3" xref="S3.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p1.1.m1.1b"><apply id="S3.p1.1.m1.1.1.cmml" xref="S3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.p1.1.m1.1.1.1.cmml" xref="S3.p1.1.m1.1.1">subscript</csymbol><ci id="S3.p1.1.m1.1.1.2.cmml" xref="S3.p1.1.m1.1.1.2">𝑏</ci><ci id="S3.p1.1.m1.1.1.3.cmml" xref="S3.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.1.m1.1c">b_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.1.m1.1d">italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> to queries <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.p1.2.m2.1"><semantics id="S3.p1.2.m2.1a"><msub id="S3.p1.2.m2.1.1" xref="S3.p1.2.m2.1.1.cmml"><mi id="S3.p1.2.m2.1.1.2" xref="S3.p1.2.m2.1.1.2.cmml">x</mi><mi id="S3.p1.2.m2.1.1.3" xref="S3.p1.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p1.2.m2.1b"><apply id="S3.p1.2.m2.1.1.cmml" xref="S3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.p1.2.m2.1.1.1.cmml" xref="S3.p1.2.m2.1.1">subscript</csymbol><ci id="S3.p1.2.m2.1.1.2.cmml" xref="S3.p1.2.m2.1.1.2">𝑥</ci><ci id="S3.p1.2.m2.1.1.3.cmml" xref="S3.p1.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.2.m2.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.2.m2.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> to maximize <span class="ltx_text ltx_font_bold" id="S3.p1.9.1">expected reward</span>, which we will denote
<math alttext="q(x_{i},b_{i})=\mathbb{E}_{y_{i}\sim f(x_{i},b_{i})}[r(x_{i},y_{i})]" class="ltx_Math" display="inline" id="S3.p1.3.m3.5"><semantics id="S3.p1.3.m3.5a"><mrow id="S3.p1.3.m3.5.5" xref="S3.p1.3.m3.5.5.cmml"><mrow id="S3.p1.3.m3.4.4.2" xref="S3.p1.3.m3.4.4.2.cmml"><mi id="S3.p1.3.m3.4.4.2.4" xref="S3.p1.3.m3.4.4.2.4.cmml">q</mi><mo id="S3.p1.3.m3.4.4.2.3" xref="S3.p1.3.m3.4.4.2.3.cmml">⁢</mo><mrow id="S3.p1.3.m3.4.4.2.2.2" xref="S3.p1.3.m3.4.4.2.2.3.cmml"><mo id="S3.p1.3.m3.4.4.2.2.2.3" stretchy="false" xref="S3.p1.3.m3.4.4.2.2.3.cmml">(</mo><msub id="S3.p1.3.m3.3.3.1.1.1.1" xref="S3.p1.3.m3.3.3.1.1.1.1.cmml"><mi id="S3.p1.3.m3.3.3.1.1.1.1.2" xref="S3.p1.3.m3.3.3.1.1.1.1.2.cmml">x</mi><mi id="S3.p1.3.m3.3.3.1.1.1.1.3" xref="S3.p1.3.m3.3.3.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p1.3.m3.4.4.2.2.2.4" xref="S3.p1.3.m3.4.4.2.2.3.cmml">,</mo><msub id="S3.p1.3.m3.4.4.2.2.2.2" xref="S3.p1.3.m3.4.4.2.2.2.2.cmml"><mi id="S3.p1.3.m3.4.4.2.2.2.2.2" xref="S3.p1.3.m3.4.4.2.2.2.2.2.cmml">b</mi><mi id="S3.p1.3.m3.4.4.2.2.2.2.3" xref="S3.p1.3.m3.4.4.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.p1.3.m3.4.4.2.2.2.5" stretchy="false" xref="S3.p1.3.m3.4.4.2.2.3.cmml">)</mo></mrow></mrow><mo id="S3.p1.3.m3.5.5.4" xref="S3.p1.3.m3.5.5.4.cmml">=</mo><mrow id="S3.p1.3.m3.5.5.3" xref="S3.p1.3.m3.5.5.3.cmml"><msub id="S3.p1.3.m3.5.5.3.3" xref="S3.p1.3.m3.5.5.3.3.cmml"><mi id="S3.p1.3.m3.5.5.3.3.2" xref="S3.p1.3.m3.5.5.3.3.2.cmml">𝔼</mi><mrow id="S3.p1.3.m3.2.2.2" xref="S3.p1.3.m3.2.2.2.cmml"><msub id="S3.p1.3.m3.2.2.2.4" xref="S3.p1.3.m3.2.2.2.4.cmml"><mi id="S3.p1.3.m3.2.2.2.4.2" xref="S3.p1.3.m3.2.2.2.4.2.cmml">y</mi><mi id="S3.p1.3.m3.2.2.2.4.3" xref="S3.p1.3.m3.2.2.2.4.3.cmml">i</mi></msub><mo id="S3.p1.3.m3.2.2.2.3" xref="S3.p1.3.m3.2.2.2.3.cmml">∼</mo><mrow id="S3.p1.3.m3.2.2.2.2" xref="S3.p1.3.m3.2.2.2.2.cmml"><mi id="S3.p1.3.m3.2.2.2.2.4" xref="S3.p1.3.m3.2.2.2.2.4.cmml">f</mi><mo id="S3.p1.3.m3.2.2.2.2.3" xref="S3.p1.3.m3.2.2.2.2.3.cmml">⁢</mo><mrow id="S3.p1.3.m3.2.2.2.2.2.2" xref="S3.p1.3.m3.2.2.2.2.2.3.cmml"><mo id="S3.p1.3.m3.2.2.2.2.2.2.3" stretchy="false" xref="S3.p1.3.m3.2.2.2.2.2.3.cmml">(</mo><msub id="S3.p1.3.m3.1.1.1.1.1.1.1" xref="S3.p1.3.m3.1.1.1.1.1.1.1.cmml"><mi id="S3.p1.3.m3.1.1.1.1.1.1.1.2" xref="S3.p1.3.m3.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.p1.3.m3.1.1.1.1.1.1.1.3" xref="S3.p1.3.m3.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p1.3.m3.2.2.2.2.2.2.4" xref="S3.p1.3.m3.2.2.2.2.2.3.cmml">,</mo><msub id="S3.p1.3.m3.2.2.2.2.2.2.2" xref="S3.p1.3.m3.2.2.2.2.2.2.2.cmml"><mi id="S3.p1.3.m3.2.2.2.2.2.2.2.2" xref="S3.p1.3.m3.2.2.2.2.2.2.2.2.cmml">b</mi><mi id="S3.p1.3.m3.2.2.2.2.2.2.2.3" xref="S3.p1.3.m3.2.2.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.p1.3.m3.2.2.2.2.2.2.5" stretchy="false" xref="S3.p1.3.m3.2.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow></msub><mo id="S3.p1.3.m3.5.5.3.2" xref="S3.p1.3.m3.5.5.3.2.cmml">⁢</mo><mrow id="S3.p1.3.m3.5.5.3.1.1" xref="S3.p1.3.m3.5.5.3.1.2.cmml"><mo id="S3.p1.3.m3.5.5.3.1.1.2" stretchy="false" xref="S3.p1.3.m3.5.5.3.1.2.1.cmml">[</mo><mrow id="S3.p1.3.m3.5.5.3.1.1.1" xref="S3.p1.3.m3.5.5.3.1.1.1.cmml"><mi id="S3.p1.3.m3.5.5.3.1.1.1.4" xref="S3.p1.3.m3.5.5.3.1.1.1.4.cmml">r</mi><mo id="S3.p1.3.m3.5.5.3.1.1.1.3" xref="S3.p1.3.m3.5.5.3.1.1.1.3.cmml">⁢</mo><mrow id="S3.p1.3.m3.5.5.3.1.1.1.2.2" xref="S3.p1.3.m3.5.5.3.1.1.1.2.3.cmml"><mo id="S3.p1.3.m3.5.5.3.1.1.1.2.2.3" stretchy="false" xref="S3.p1.3.m3.5.5.3.1.1.1.2.3.cmml">(</mo><msub id="S3.p1.3.m3.5.5.3.1.1.1.1.1.1" xref="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.cmml"><mi id="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.2" xref="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.3" xref="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p1.3.m3.5.5.3.1.1.1.2.2.4" xref="S3.p1.3.m3.5.5.3.1.1.1.2.3.cmml">,</mo><msub id="S3.p1.3.m3.5.5.3.1.1.1.2.2.2" xref="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.cmml"><mi id="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.2" xref="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.2.cmml">y</mi><mi id="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.3" xref="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.3.cmml">i</mi></msub><mo id="S3.p1.3.m3.5.5.3.1.1.1.2.2.5" stretchy="false" xref="S3.p1.3.m3.5.5.3.1.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S3.p1.3.m3.5.5.3.1.1.3" stretchy="false" xref="S3.p1.3.m3.5.5.3.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.3.m3.5b"><apply id="S3.p1.3.m3.5.5.cmml" xref="S3.p1.3.m3.5.5"><eq id="S3.p1.3.m3.5.5.4.cmml" xref="S3.p1.3.m3.5.5.4"></eq><apply id="S3.p1.3.m3.4.4.2.cmml" xref="S3.p1.3.m3.4.4.2"><times id="S3.p1.3.m3.4.4.2.3.cmml" xref="S3.p1.3.m3.4.4.2.3"></times><ci id="S3.p1.3.m3.4.4.2.4.cmml" xref="S3.p1.3.m3.4.4.2.4">𝑞</ci><interval closure="open" id="S3.p1.3.m3.4.4.2.2.3.cmml" xref="S3.p1.3.m3.4.4.2.2.2"><apply id="S3.p1.3.m3.3.3.1.1.1.1.cmml" xref="S3.p1.3.m3.3.3.1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.3.m3.3.3.1.1.1.1.1.cmml" xref="S3.p1.3.m3.3.3.1.1.1.1">subscript</csymbol><ci id="S3.p1.3.m3.3.3.1.1.1.1.2.cmml" xref="S3.p1.3.m3.3.3.1.1.1.1.2">𝑥</ci><ci id="S3.p1.3.m3.3.3.1.1.1.1.3.cmml" xref="S3.p1.3.m3.3.3.1.1.1.1.3">𝑖</ci></apply><apply id="S3.p1.3.m3.4.4.2.2.2.2.cmml" xref="S3.p1.3.m3.4.4.2.2.2.2"><csymbol cd="ambiguous" id="S3.p1.3.m3.4.4.2.2.2.2.1.cmml" xref="S3.p1.3.m3.4.4.2.2.2.2">subscript</csymbol><ci id="S3.p1.3.m3.4.4.2.2.2.2.2.cmml" xref="S3.p1.3.m3.4.4.2.2.2.2.2">𝑏</ci><ci id="S3.p1.3.m3.4.4.2.2.2.2.3.cmml" xref="S3.p1.3.m3.4.4.2.2.2.2.3">𝑖</ci></apply></interval></apply><apply id="S3.p1.3.m3.5.5.3.cmml" xref="S3.p1.3.m3.5.5.3"><times id="S3.p1.3.m3.5.5.3.2.cmml" xref="S3.p1.3.m3.5.5.3.2"></times><apply id="S3.p1.3.m3.5.5.3.3.cmml" xref="S3.p1.3.m3.5.5.3.3"><csymbol cd="ambiguous" id="S3.p1.3.m3.5.5.3.3.1.cmml" xref="S3.p1.3.m3.5.5.3.3">subscript</csymbol><ci id="S3.p1.3.m3.5.5.3.3.2.cmml" xref="S3.p1.3.m3.5.5.3.3.2">𝔼</ci><apply id="S3.p1.3.m3.2.2.2.cmml" xref="S3.p1.3.m3.2.2.2"><csymbol cd="latexml" id="S3.p1.3.m3.2.2.2.3.cmml" xref="S3.p1.3.m3.2.2.2.3">similar-to</csymbol><apply id="S3.p1.3.m3.2.2.2.4.cmml" xref="S3.p1.3.m3.2.2.2.4"><csymbol cd="ambiguous" id="S3.p1.3.m3.2.2.2.4.1.cmml" xref="S3.p1.3.m3.2.2.2.4">subscript</csymbol><ci id="S3.p1.3.m3.2.2.2.4.2.cmml" xref="S3.p1.3.m3.2.2.2.4.2">𝑦</ci><ci id="S3.p1.3.m3.2.2.2.4.3.cmml" xref="S3.p1.3.m3.2.2.2.4.3">𝑖</ci></apply><apply id="S3.p1.3.m3.2.2.2.2.cmml" xref="S3.p1.3.m3.2.2.2.2"><times id="S3.p1.3.m3.2.2.2.2.3.cmml" xref="S3.p1.3.m3.2.2.2.2.3"></times><ci id="S3.p1.3.m3.2.2.2.2.4.cmml" xref="S3.p1.3.m3.2.2.2.2.4">𝑓</ci><interval closure="open" id="S3.p1.3.m3.2.2.2.2.2.3.cmml" xref="S3.p1.3.m3.2.2.2.2.2.2"><apply id="S3.p1.3.m3.1.1.1.1.1.1.1.cmml" xref="S3.p1.3.m3.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.3.m3.1.1.1.1.1.1.1.1.cmml" xref="S3.p1.3.m3.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.p1.3.m3.1.1.1.1.1.1.1.2.cmml" xref="S3.p1.3.m3.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.p1.3.m3.1.1.1.1.1.1.1.3.cmml" xref="S3.p1.3.m3.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.p1.3.m3.2.2.2.2.2.2.2.cmml" xref="S3.p1.3.m3.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p1.3.m3.2.2.2.2.2.2.2.1.cmml" xref="S3.p1.3.m3.2.2.2.2.2.2.2">subscript</csymbol><ci id="S3.p1.3.m3.2.2.2.2.2.2.2.2.cmml" xref="S3.p1.3.m3.2.2.2.2.2.2.2.2">𝑏</ci><ci id="S3.p1.3.m3.2.2.2.2.2.2.2.3.cmml" xref="S3.p1.3.m3.2.2.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></apply></apply><apply id="S3.p1.3.m3.5.5.3.1.2.cmml" xref="S3.p1.3.m3.5.5.3.1.1"><csymbol cd="latexml" id="S3.p1.3.m3.5.5.3.1.2.1.cmml" xref="S3.p1.3.m3.5.5.3.1.1.2">delimited-[]</csymbol><apply id="S3.p1.3.m3.5.5.3.1.1.1.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1"><times id="S3.p1.3.m3.5.5.3.1.1.1.3.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.3"></times><ci id="S3.p1.3.m3.5.5.3.1.1.1.4.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.4">𝑟</ci><interval closure="open" id="S3.p1.3.m3.5.5.3.1.1.1.2.3.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.2.2"><apply id="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.1.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.1.1.1">subscript</csymbol><ci id="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.2.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.3.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.1.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.2.2.2">subscript</csymbol><ci id="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.2.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.2">𝑦</ci><ci id="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.3.cmml" xref="S3.p1.3.m3.5.5.3.1.1.1.2.2.2.3">𝑖</ci></apply></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.3.m3.5c">q(x_{i},b_{i})=\mathbb{E}_{y_{i}\sim f(x_{i},b_{i})}[r(x_{i},y_{i})]</annotation><annotation encoding="application/x-llamapun" id="S3.p1.3.m3.5d">italic_q ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) = blackboard_E start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∼ italic_f ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) end_POSTSUBSCRIPT [ italic_r ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ]</annotation></semantics></math>. But there is a problem: without querying the LM, we cannot know the value of <math alttext="q(x_{i},b_{i})" class="ltx_Math" display="inline" id="S3.p1.4.m4.2"><semantics id="S3.p1.4.m4.2a"><mrow id="S3.p1.4.m4.2.2" xref="S3.p1.4.m4.2.2.cmml"><mi id="S3.p1.4.m4.2.2.4" xref="S3.p1.4.m4.2.2.4.cmml">q</mi><mo id="S3.p1.4.m4.2.2.3" xref="S3.p1.4.m4.2.2.3.cmml">⁢</mo><mrow id="S3.p1.4.m4.2.2.2.2" xref="S3.p1.4.m4.2.2.2.3.cmml"><mo id="S3.p1.4.m4.2.2.2.2.3" stretchy="false" xref="S3.p1.4.m4.2.2.2.3.cmml">(</mo><msub id="S3.p1.4.m4.1.1.1.1.1" xref="S3.p1.4.m4.1.1.1.1.1.cmml"><mi id="S3.p1.4.m4.1.1.1.1.1.2" xref="S3.p1.4.m4.1.1.1.1.1.2.cmml">x</mi><mi id="S3.p1.4.m4.1.1.1.1.1.3" xref="S3.p1.4.m4.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p1.4.m4.2.2.2.2.4" xref="S3.p1.4.m4.2.2.2.3.cmml">,</mo><msub id="S3.p1.4.m4.2.2.2.2.2" xref="S3.p1.4.m4.2.2.2.2.2.cmml"><mi id="S3.p1.4.m4.2.2.2.2.2.2" xref="S3.p1.4.m4.2.2.2.2.2.2.cmml">b</mi><mi id="S3.p1.4.m4.2.2.2.2.2.3" xref="S3.p1.4.m4.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.p1.4.m4.2.2.2.2.5" stretchy="false" xref="S3.p1.4.m4.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.4.m4.2b"><apply id="S3.p1.4.m4.2.2.cmml" xref="S3.p1.4.m4.2.2"><times id="S3.p1.4.m4.2.2.3.cmml" xref="S3.p1.4.m4.2.2.3"></times><ci id="S3.p1.4.m4.2.2.4.cmml" xref="S3.p1.4.m4.2.2.4">𝑞</ci><interval closure="open" id="S3.p1.4.m4.2.2.2.3.cmml" xref="S3.p1.4.m4.2.2.2.2"><apply id="S3.p1.4.m4.1.1.1.1.1.cmml" xref="S3.p1.4.m4.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.4.m4.1.1.1.1.1.1.cmml" xref="S3.p1.4.m4.1.1.1.1.1">subscript</csymbol><ci id="S3.p1.4.m4.1.1.1.1.1.2.cmml" xref="S3.p1.4.m4.1.1.1.1.1.2">𝑥</ci><ci id="S3.p1.4.m4.1.1.1.1.1.3.cmml" xref="S3.p1.4.m4.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.p1.4.m4.2.2.2.2.2.cmml" xref="S3.p1.4.m4.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p1.4.m4.2.2.2.2.2.1.cmml" xref="S3.p1.4.m4.2.2.2.2.2">subscript</csymbol><ci id="S3.p1.4.m4.2.2.2.2.2.2.cmml" xref="S3.p1.4.m4.2.2.2.2.2.2">𝑏</ci><ci id="S3.p1.4.m4.2.2.2.2.2.3.cmml" xref="S3.p1.4.m4.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.4.m4.2c">q(x_{i},b_{i})</annotation><annotation encoding="application/x-llamapun" id="S3.p1.4.m4.2d">italic_q ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> for some new <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.p1.5.m5.1"><semantics id="S3.p1.5.m5.1a"><msub id="S3.p1.5.m5.1.1" xref="S3.p1.5.m5.1.1.cmml"><mi id="S3.p1.5.m5.1.1.2" xref="S3.p1.5.m5.1.1.2.cmml">x</mi><mi id="S3.p1.5.m5.1.1.3" xref="S3.p1.5.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p1.5.m5.1b"><apply id="S3.p1.5.m5.1.1.cmml" xref="S3.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S3.p1.5.m5.1.1.1.cmml" xref="S3.p1.5.m5.1.1">subscript</csymbol><ci id="S3.p1.5.m5.1.1.2.cmml" xref="S3.p1.5.m5.1.1.2">𝑥</ci><ci id="S3.p1.5.m5.1.1.3.cmml" xref="S3.p1.5.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.5.m5.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.5.m5.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. To make matters worse, Monte Carlo estimation of <math alttext="q(x_{i},b_{i})" class="ltx_Math" display="inline" id="S3.p1.6.m6.2"><semantics id="S3.p1.6.m6.2a"><mrow id="S3.p1.6.m6.2.2" xref="S3.p1.6.m6.2.2.cmml"><mi id="S3.p1.6.m6.2.2.4" xref="S3.p1.6.m6.2.2.4.cmml">q</mi><mo id="S3.p1.6.m6.2.2.3" xref="S3.p1.6.m6.2.2.3.cmml">⁢</mo><mrow id="S3.p1.6.m6.2.2.2.2" xref="S3.p1.6.m6.2.2.2.3.cmml"><mo id="S3.p1.6.m6.2.2.2.2.3" stretchy="false" xref="S3.p1.6.m6.2.2.2.3.cmml">(</mo><msub id="S3.p1.6.m6.1.1.1.1.1" xref="S3.p1.6.m6.1.1.1.1.1.cmml"><mi id="S3.p1.6.m6.1.1.1.1.1.2" xref="S3.p1.6.m6.1.1.1.1.1.2.cmml">x</mi><mi id="S3.p1.6.m6.1.1.1.1.1.3" xref="S3.p1.6.m6.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p1.6.m6.2.2.2.2.4" xref="S3.p1.6.m6.2.2.2.3.cmml">,</mo><msub id="S3.p1.6.m6.2.2.2.2.2" xref="S3.p1.6.m6.2.2.2.2.2.cmml"><mi id="S3.p1.6.m6.2.2.2.2.2.2" xref="S3.p1.6.m6.2.2.2.2.2.2.cmml">b</mi><mi id="S3.p1.6.m6.2.2.2.2.2.3" xref="S3.p1.6.m6.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.p1.6.m6.2.2.2.2.5" stretchy="false" xref="S3.p1.6.m6.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.6.m6.2b"><apply id="S3.p1.6.m6.2.2.cmml" xref="S3.p1.6.m6.2.2"><times id="S3.p1.6.m6.2.2.3.cmml" xref="S3.p1.6.m6.2.2.3"></times><ci id="S3.p1.6.m6.2.2.4.cmml" xref="S3.p1.6.m6.2.2.4">𝑞</ci><interval closure="open" id="S3.p1.6.m6.2.2.2.3.cmml" xref="S3.p1.6.m6.2.2.2.2"><apply id="S3.p1.6.m6.1.1.1.1.1.cmml" xref="S3.p1.6.m6.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.6.m6.1.1.1.1.1.1.cmml" xref="S3.p1.6.m6.1.1.1.1.1">subscript</csymbol><ci id="S3.p1.6.m6.1.1.1.1.1.2.cmml" xref="S3.p1.6.m6.1.1.1.1.1.2">𝑥</ci><ci id="S3.p1.6.m6.1.1.1.1.1.3.cmml" xref="S3.p1.6.m6.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.p1.6.m6.2.2.2.2.2.cmml" xref="S3.p1.6.m6.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p1.6.m6.2.2.2.2.2.1.cmml" xref="S3.p1.6.m6.2.2.2.2.2">subscript</csymbol><ci id="S3.p1.6.m6.2.2.2.2.2.2.cmml" xref="S3.p1.6.m6.2.2.2.2.2.2">𝑏</ci><ci id="S3.p1.6.m6.2.2.2.2.2.3.cmml" xref="S3.p1.6.m6.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.6.m6.2c">q(x_{i},b_{i})</annotation><annotation encoding="application/x-llamapun" id="S3.p1.6.m6.2d">italic_q ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> (as in <cite class="ltx_cite ltx_citemacro_citep">Snell et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib22" title="">2024</a></cite>) may in general require more computation (e.g. more LM samples) than we eventually wish to allocate to <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.p1.7.m7.1"><semantics id="S3.p1.7.m7.1a"><msub id="S3.p1.7.m7.1.1" xref="S3.p1.7.m7.1.1.cmml"><mi id="S3.p1.7.m7.1.1.2" xref="S3.p1.7.m7.1.1.2.cmml">x</mi><mi id="S3.p1.7.m7.1.1.3" xref="S3.p1.7.m7.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p1.7.m7.1b"><apply id="S3.p1.7.m7.1.1.cmml" xref="S3.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S3.p1.7.m7.1.1.1.cmml" xref="S3.p1.7.m7.1.1">subscript</csymbol><ci id="S3.p1.7.m7.1.1.2.cmml" xref="S3.p1.7.m7.1.1.2">𝑥</ci><ci id="S3.p1.7.m7.1.1.3.cmml" xref="S3.p1.7.m7.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.7.m7.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.7.m7.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>! To efficiently allocate computation, we need some way to <em class="ltx_emph ltx_font_italic" id="S3.p1.9.2">predict</em> <math alttext="q(x_{i},b_{i})" class="ltx_Math" display="inline" id="S3.p1.8.m8.2"><semantics id="S3.p1.8.m8.2a"><mrow id="S3.p1.8.m8.2.2" xref="S3.p1.8.m8.2.2.cmml"><mi id="S3.p1.8.m8.2.2.4" xref="S3.p1.8.m8.2.2.4.cmml">q</mi><mo id="S3.p1.8.m8.2.2.3" xref="S3.p1.8.m8.2.2.3.cmml">⁢</mo><mrow id="S3.p1.8.m8.2.2.2.2" xref="S3.p1.8.m8.2.2.2.3.cmml"><mo id="S3.p1.8.m8.2.2.2.2.3" stretchy="false" xref="S3.p1.8.m8.2.2.2.3.cmml">(</mo><msub id="S3.p1.8.m8.1.1.1.1.1" xref="S3.p1.8.m8.1.1.1.1.1.cmml"><mi id="S3.p1.8.m8.1.1.1.1.1.2" xref="S3.p1.8.m8.1.1.1.1.1.2.cmml">x</mi><mi id="S3.p1.8.m8.1.1.1.1.1.3" xref="S3.p1.8.m8.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p1.8.m8.2.2.2.2.4" xref="S3.p1.8.m8.2.2.2.3.cmml">,</mo><msub id="S3.p1.8.m8.2.2.2.2.2" xref="S3.p1.8.m8.2.2.2.2.2.cmml"><mi id="S3.p1.8.m8.2.2.2.2.2.2" xref="S3.p1.8.m8.2.2.2.2.2.2.cmml">b</mi><mi id="S3.p1.8.m8.2.2.2.2.2.3" xref="S3.p1.8.m8.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.p1.8.m8.2.2.2.2.5" stretchy="false" xref="S3.p1.8.m8.2.2.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p1.8.m8.2b"><apply id="S3.p1.8.m8.2.2.cmml" xref="S3.p1.8.m8.2.2"><times id="S3.p1.8.m8.2.2.3.cmml" xref="S3.p1.8.m8.2.2.3"></times><ci id="S3.p1.8.m8.2.2.4.cmml" xref="S3.p1.8.m8.2.2.4">𝑞</ci><interval closure="open" id="S3.p1.8.m8.2.2.2.3.cmml" xref="S3.p1.8.m8.2.2.2.2"><apply id="S3.p1.8.m8.1.1.1.1.1.cmml" xref="S3.p1.8.m8.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p1.8.m8.1.1.1.1.1.1.cmml" xref="S3.p1.8.m8.1.1.1.1.1">subscript</csymbol><ci id="S3.p1.8.m8.1.1.1.1.1.2.cmml" xref="S3.p1.8.m8.1.1.1.1.1.2">𝑥</ci><ci id="S3.p1.8.m8.1.1.1.1.1.3.cmml" xref="S3.p1.8.m8.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.p1.8.m8.2.2.2.2.2.cmml" xref="S3.p1.8.m8.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p1.8.m8.2.2.2.2.2.1.cmml" xref="S3.p1.8.m8.2.2.2.2.2">subscript</csymbol><ci id="S3.p1.8.m8.2.2.2.2.2.2.cmml" xref="S3.p1.8.m8.2.2.2.2.2.2">𝑏</ci><ci id="S3.p1.8.m8.2.2.2.2.2.3.cmml" xref="S3.p1.8.m8.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.8.m8.2c">q(x_{i},b_{i})</annotation><annotation encoding="application/x-llamapun" id="S3.p1.8.m8.2d">italic_q ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> from <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.p1.9.m9.1"><semantics id="S3.p1.9.m9.1a"><msub id="S3.p1.9.m9.1.1" xref="S3.p1.9.m9.1.1.cmml"><mi id="S3.p1.9.m9.1.1.2" xref="S3.p1.9.m9.1.1.2.cmml">x</mi><mi id="S3.p1.9.m9.1.1.3" xref="S3.p1.9.m9.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p1.9.m9.1b"><apply id="S3.p1.9.m9.1.1.cmml" xref="S3.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S3.p1.9.m9.1.1.1.cmml" xref="S3.p1.9.m9.1.1">subscript</csymbol><ci id="S3.p1.9.m9.1.1.2.cmml" xref="S3.p1.9.m9.1.1.2">𝑥</ci><ci id="S3.p1.9.m9.1.1.3.cmml" xref="S3.p1.9.m9.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p1.9.m9.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p1.9.m9.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> alone, and then use these predictions to solve <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S2.E4" title="In 2 Preliminaries ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">4</span></a>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.p2">
<p class="ltx_p" id="S3.p2.6">When estimating problem difficulty and allocating decoding budget, it will be useful to reason about the benefits of <em class="ltx_emph ltx_font_italic" id="S3.p2.6.1">incremental</em> changes in compute budgets.
Formally, let us define the <span class="ltx_text ltx_font_bold" id="S3.p2.6.2">marginal reward</span> <math alttext="\Delta_{ij}=q(x_{i},j)-q(x_{i},j-1)" class="ltx_Math" display="inline" id="S3.p2.1.m1.4"><semantics id="S3.p2.1.m1.4a"><mrow id="S3.p2.1.m1.4.4" xref="S3.p2.1.m1.4.4.cmml"><msub id="S3.p2.1.m1.4.4.5" xref="S3.p2.1.m1.4.4.5.cmml"><mi id="S3.p2.1.m1.4.4.5.2" mathvariant="normal" xref="S3.p2.1.m1.4.4.5.2.cmml">Δ</mi><mrow id="S3.p2.1.m1.4.4.5.3" xref="S3.p2.1.m1.4.4.5.3.cmml"><mi id="S3.p2.1.m1.4.4.5.3.2" xref="S3.p2.1.m1.4.4.5.3.2.cmml">i</mi><mo id="S3.p2.1.m1.4.4.5.3.1" xref="S3.p2.1.m1.4.4.5.3.1.cmml">⁢</mo><mi id="S3.p2.1.m1.4.4.5.3.3" xref="S3.p2.1.m1.4.4.5.3.3.cmml">j</mi></mrow></msub><mo id="S3.p2.1.m1.4.4.4" xref="S3.p2.1.m1.4.4.4.cmml">=</mo><mrow id="S3.p2.1.m1.4.4.3" xref="S3.p2.1.m1.4.4.3.cmml"><mrow id="S3.p2.1.m1.2.2.1.1" xref="S3.p2.1.m1.2.2.1.1.cmml"><mi id="S3.p2.1.m1.2.2.1.1.3" xref="S3.p2.1.m1.2.2.1.1.3.cmml">q</mi><mo id="S3.p2.1.m1.2.2.1.1.2" xref="S3.p2.1.m1.2.2.1.1.2.cmml">⁢</mo><mrow id="S3.p2.1.m1.2.2.1.1.1.1" xref="S3.p2.1.m1.2.2.1.1.1.2.cmml"><mo id="S3.p2.1.m1.2.2.1.1.1.1.2" stretchy="false" xref="S3.p2.1.m1.2.2.1.1.1.2.cmml">(</mo><msub id="S3.p2.1.m1.2.2.1.1.1.1.1" xref="S3.p2.1.m1.2.2.1.1.1.1.1.cmml"><mi id="S3.p2.1.m1.2.2.1.1.1.1.1.2" xref="S3.p2.1.m1.2.2.1.1.1.1.1.2.cmml">x</mi><mi id="S3.p2.1.m1.2.2.1.1.1.1.1.3" xref="S3.p2.1.m1.2.2.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p2.1.m1.2.2.1.1.1.1.3" xref="S3.p2.1.m1.2.2.1.1.1.2.cmml">,</mo><mi id="S3.p2.1.m1.1.1" xref="S3.p2.1.m1.1.1.cmml">j</mi><mo id="S3.p2.1.m1.2.2.1.1.1.1.4" stretchy="false" xref="S3.p2.1.m1.2.2.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.p2.1.m1.4.4.3.4" xref="S3.p2.1.m1.4.4.3.4.cmml">−</mo><mrow id="S3.p2.1.m1.4.4.3.3" xref="S3.p2.1.m1.4.4.3.3.cmml"><mi id="S3.p2.1.m1.4.4.3.3.4" xref="S3.p2.1.m1.4.4.3.3.4.cmml">q</mi><mo id="S3.p2.1.m1.4.4.3.3.3" xref="S3.p2.1.m1.4.4.3.3.3.cmml">⁢</mo><mrow id="S3.p2.1.m1.4.4.3.3.2.2" xref="S3.p2.1.m1.4.4.3.3.2.3.cmml"><mo id="S3.p2.1.m1.4.4.3.3.2.2.3" stretchy="false" xref="S3.p2.1.m1.4.4.3.3.2.3.cmml">(</mo><msub id="S3.p2.1.m1.3.3.2.2.1.1.1" xref="S3.p2.1.m1.3.3.2.2.1.1.1.cmml"><mi id="S3.p2.1.m1.3.3.2.2.1.1.1.2" xref="S3.p2.1.m1.3.3.2.2.1.1.1.2.cmml">x</mi><mi id="S3.p2.1.m1.3.3.2.2.1.1.1.3" xref="S3.p2.1.m1.3.3.2.2.1.1.1.3.cmml">i</mi></msub><mo id="S3.p2.1.m1.4.4.3.3.2.2.4" xref="S3.p2.1.m1.4.4.3.3.2.3.cmml">,</mo><mrow id="S3.p2.1.m1.4.4.3.3.2.2.2" xref="S3.p2.1.m1.4.4.3.3.2.2.2.cmml"><mi id="S3.p2.1.m1.4.4.3.3.2.2.2.2" xref="S3.p2.1.m1.4.4.3.3.2.2.2.2.cmml">j</mi><mo id="S3.p2.1.m1.4.4.3.3.2.2.2.1" xref="S3.p2.1.m1.4.4.3.3.2.2.2.1.cmml">−</mo><mn id="S3.p2.1.m1.4.4.3.3.2.2.2.3" xref="S3.p2.1.m1.4.4.3.3.2.2.2.3.cmml">1</mn></mrow><mo id="S3.p2.1.m1.4.4.3.3.2.2.5" stretchy="false" xref="S3.p2.1.m1.4.4.3.3.2.3.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.1.m1.4b"><apply id="S3.p2.1.m1.4.4.cmml" xref="S3.p2.1.m1.4.4"><eq id="S3.p2.1.m1.4.4.4.cmml" xref="S3.p2.1.m1.4.4.4"></eq><apply id="S3.p2.1.m1.4.4.5.cmml" xref="S3.p2.1.m1.4.4.5"><csymbol cd="ambiguous" id="S3.p2.1.m1.4.4.5.1.cmml" xref="S3.p2.1.m1.4.4.5">subscript</csymbol><ci id="S3.p2.1.m1.4.4.5.2.cmml" xref="S3.p2.1.m1.4.4.5.2">Δ</ci><apply id="S3.p2.1.m1.4.4.5.3.cmml" xref="S3.p2.1.m1.4.4.5.3"><times id="S3.p2.1.m1.4.4.5.3.1.cmml" xref="S3.p2.1.m1.4.4.5.3.1"></times><ci id="S3.p2.1.m1.4.4.5.3.2.cmml" xref="S3.p2.1.m1.4.4.5.3.2">𝑖</ci><ci id="S3.p2.1.m1.4.4.5.3.3.cmml" xref="S3.p2.1.m1.4.4.5.3.3">𝑗</ci></apply></apply><apply id="S3.p2.1.m1.4.4.3.cmml" xref="S3.p2.1.m1.4.4.3"><minus id="S3.p2.1.m1.4.4.3.4.cmml" xref="S3.p2.1.m1.4.4.3.4"></minus><apply id="S3.p2.1.m1.2.2.1.1.cmml" xref="S3.p2.1.m1.2.2.1.1"><times id="S3.p2.1.m1.2.2.1.1.2.cmml" xref="S3.p2.1.m1.2.2.1.1.2"></times><ci id="S3.p2.1.m1.2.2.1.1.3.cmml" xref="S3.p2.1.m1.2.2.1.1.3">𝑞</ci><interval closure="open" id="S3.p2.1.m1.2.2.1.1.1.2.cmml" xref="S3.p2.1.m1.2.2.1.1.1.1"><apply id="S3.p2.1.m1.2.2.1.1.1.1.1.cmml" xref="S3.p2.1.m1.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p2.1.m1.2.2.1.1.1.1.1.1.cmml" xref="S3.p2.1.m1.2.2.1.1.1.1.1">subscript</csymbol><ci id="S3.p2.1.m1.2.2.1.1.1.1.1.2.cmml" xref="S3.p2.1.m1.2.2.1.1.1.1.1.2">𝑥</ci><ci id="S3.p2.1.m1.2.2.1.1.1.1.1.3.cmml" xref="S3.p2.1.m1.2.2.1.1.1.1.1.3">𝑖</ci></apply><ci id="S3.p2.1.m1.1.1.cmml" xref="S3.p2.1.m1.1.1">𝑗</ci></interval></apply><apply id="S3.p2.1.m1.4.4.3.3.cmml" xref="S3.p2.1.m1.4.4.3.3"><times id="S3.p2.1.m1.4.4.3.3.3.cmml" xref="S3.p2.1.m1.4.4.3.3.3"></times><ci id="S3.p2.1.m1.4.4.3.3.4.cmml" xref="S3.p2.1.m1.4.4.3.3.4">𝑞</ci><interval closure="open" id="S3.p2.1.m1.4.4.3.3.2.3.cmml" xref="S3.p2.1.m1.4.4.3.3.2.2"><apply id="S3.p2.1.m1.3.3.2.2.1.1.1.cmml" xref="S3.p2.1.m1.3.3.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.p2.1.m1.3.3.2.2.1.1.1.1.cmml" xref="S3.p2.1.m1.3.3.2.2.1.1.1">subscript</csymbol><ci id="S3.p2.1.m1.3.3.2.2.1.1.1.2.cmml" xref="S3.p2.1.m1.3.3.2.2.1.1.1.2">𝑥</ci><ci id="S3.p2.1.m1.3.3.2.2.1.1.1.3.cmml" xref="S3.p2.1.m1.3.3.2.2.1.1.1.3">𝑖</ci></apply><apply id="S3.p2.1.m1.4.4.3.3.2.2.2.cmml" xref="S3.p2.1.m1.4.4.3.3.2.2.2"><minus id="S3.p2.1.m1.4.4.3.3.2.2.2.1.cmml" xref="S3.p2.1.m1.4.4.3.3.2.2.2.1"></minus><ci id="S3.p2.1.m1.4.4.3.3.2.2.2.2.cmml" xref="S3.p2.1.m1.4.4.3.3.2.2.2.2">𝑗</ci><cn id="S3.p2.1.m1.4.4.3.3.2.2.2.3.cmml" type="integer" xref="S3.p2.1.m1.4.4.3.3.2.2.2.3">1</cn></apply></interval></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.1.m1.4c">\Delta_{ij}=q(x_{i},j)-q(x_{i},j-1)</annotation><annotation encoding="application/x-llamapun" id="S3.p2.1.m1.4d">roman_Δ start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT = italic_q ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_j ) - italic_q ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_j - 1 )</annotation></semantics></math> (with <math alttext="\Delta(\cdot,0)=0" class="ltx_Math" display="inline" id="S3.p2.2.m2.2"><semantics id="S3.p2.2.m2.2a"><mrow id="S3.p2.2.m2.2.3" xref="S3.p2.2.m2.2.3.cmml"><mrow id="S3.p2.2.m2.2.3.2" xref="S3.p2.2.m2.2.3.2.cmml"><mi id="S3.p2.2.m2.2.3.2.2" mathvariant="normal" xref="S3.p2.2.m2.2.3.2.2.cmml">Δ</mi><mo id="S3.p2.2.m2.2.3.2.1" xref="S3.p2.2.m2.2.3.2.1.cmml">⁢</mo><mrow id="S3.p2.2.m2.2.3.2.3.2" xref="S3.p2.2.m2.2.3.2.3.1.cmml"><mo id="S3.p2.2.m2.2.3.2.3.2.1" stretchy="false" xref="S3.p2.2.m2.2.3.2.3.1.cmml">(</mo><mo id="S3.p2.2.m2.1.1" lspace="0em" rspace="0em" xref="S3.p2.2.m2.1.1.cmml">⋅</mo><mo id="S3.p2.2.m2.2.3.2.3.2.2" xref="S3.p2.2.m2.2.3.2.3.1.cmml">,</mo><mn id="S3.p2.2.m2.2.2" xref="S3.p2.2.m2.2.2.cmml">0</mn><mo id="S3.p2.2.m2.2.3.2.3.2.3" stretchy="false" xref="S3.p2.2.m2.2.3.2.3.1.cmml">)</mo></mrow></mrow><mo id="S3.p2.2.m2.2.3.1" xref="S3.p2.2.m2.2.3.1.cmml">=</mo><mn id="S3.p2.2.m2.2.3.3" xref="S3.p2.2.m2.2.3.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.2.m2.2b"><apply id="S3.p2.2.m2.2.3.cmml" xref="S3.p2.2.m2.2.3"><eq id="S3.p2.2.m2.2.3.1.cmml" xref="S3.p2.2.m2.2.3.1"></eq><apply id="S3.p2.2.m2.2.3.2.cmml" xref="S3.p2.2.m2.2.3.2"><times id="S3.p2.2.m2.2.3.2.1.cmml" xref="S3.p2.2.m2.2.3.2.1"></times><ci id="S3.p2.2.m2.2.3.2.2.cmml" xref="S3.p2.2.m2.2.3.2.2">Δ</ci><interval closure="open" id="S3.p2.2.m2.2.3.2.3.1.cmml" xref="S3.p2.2.m2.2.3.2.3.2"><ci id="S3.p2.2.m2.1.1.cmml" xref="S3.p2.2.m2.1.1">⋅</ci><cn id="S3.p2.2.m2.2.2.cmml" type="integer" xref="S3.p2.2.m2.2.2">0</cn></interval></apply><cn id="S3.p2.2.m2.2.3.3.cmml" type="integer" xref="S3.p2.2.m2.2.3.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.2.m2.2c">\Delta(\cdot,0)=0</annotation><annotation encoding="application/x-llamapun" id="S3.p2.2.m2.2d">roman_Δ ( ⋅ , 0 ) = 0</annotation></semantics></math>). Under this definition, <math alttext="q(x_{i},b_{i})=\sum_{j=1}^{b_{i}}\Delta_{ij}" class="ltx_Math" display="inline" id="S3.p2.3.m3.2"><semantics id="S3.p2.3.m3.2a"><mrow id="S3.p2.3.m3.2.2" xref="S3.p2.3.m3.2.2.cmml"><mrow id="S3.p2.3.m3.2.2.2" xref="S3.p2.3.m3.2.2.2.cmml"><mi id="S3.p2.3.m3.2.2.2.4" xref="S3.p2.3.m3.2.2.2.4.cmml">q</mi><mo id="S3.p2.3.m3.2.2.2.3" xref="S3.p2.3.m3.2.2.2.3.cmml">⁢</mo><mrow id="S3.p2.3.m3.2.2.2.2.2" xref="S3.p2.3.m3.2.2.2.2.3.cmml"><mo id="S3.p2.3.m3.2.2.2.2.2.3" stretchy="false" xref="S3.p2.3.m3.2.2.2.2.3.cmml">(</mo><msub id="S3.p2.3.m3.1.1.1.1.1.1" xref="S3.p2.3.m3.1.1.1.1.1.1.cmml"><mi id="S3.p2.3.m3.1.1.1.1.1.1.2" xref="S3.p2.3.m3.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.p2.3.m3.1.1.1.1.1.1.3" xref="S3.p2.3.m3.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.p2.3.m3.2.2.2.2.2.4" xref="S3.p2.3.m3.2.2.2.2.3.cmml">,</mo><msub id="S3.p2.3.m3.2.2.2.2.2.2" xref="S3.p2.3.m3.2.2.2.2.2.2.cmml"><mi id="S3.p2.3.m3.2.2.2.2.2.2.2" xref="S3.p2.3.m3.2.2.2.2.2.2.2.cmml">b</mi><mi id="S3.p2.3.m3.2.2.2.2.2.2.3" xref="S3.p2.3.m3.2.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.p2.3.m3.2.2.2.2.2.5" stretchy="false" xref="S3.p2.3.m3.2.2.2.2.3.cmml">)</mo></mrow></mrow><mo id="S3.p2.3.m3.2.2.3" rspace="0.111em" xref="S3.p2.3.m3.2.2.3.cmml">=</mo><mrow id="S3.p2.3.m3.2.2.4" xref="S3.p2.3.m3.2.2.4.cmml"><msubsup id="S3.p2.3.m3.2.2.4.1" xref="S3.p2.3.m3.2.2.4.1.cmml"><mo id="S3.p2.3.m3.2.2.4.1.2.2" xref="S3.p2.3.m3.2.2.4.1.2.2.cmml">∑</mo><mrow id="S3.p2.3.m3.2.2.4.1.2.3" xref="S3.p2.3.m3.2.2.4.1.2.3.cmml"><mi id="S3.p2.3.m3.2.2.4.1.2.3.2" xref="S3.p2.3.m3.2.2.4.1.2.3.2.cmml">j</mi><mo id="S3.p2.3.m3.2.2.4.1.2.3.1" xref="S3.p2.3.m3.2.2.4.1.2.3.1.cmml">=</mo><mn id="S3.p2.3.m3.2.2.4.1.2.3.3" xref="S3.p2.3.m3.2.2.4.1.2.3.3.cmml">1</mn></mrow><msub id="S3.p2.3.m3.2.2.4.1.3" xref="S3.p2.3.m3.2.2.4.1.3.cmml"><mi id="S3.p2.3.m3.2.2.4.1.3.2" xref="S3.p2.3.m3.2.2.4.1.3.2.cmml">b</mi><mi id="S3.p2.3.m3.2.2.4.1.3.3" xref="S3.p2.3.m3.2.2.4.1.3.3.cmml">i</mi></msub></msubsup><msub id="S3.p2.3.m3.2.2.4.2" xref="S3.p2.3.m3.2.2.4.2.cmml"><mi id="S3.p2.3.m3.2.2.4.2.2" mathvariant="normal" xref="S3.p2.3.m3.2.2.4.2.2.cmml">Δ</mi><mrow id="S3.p2.3.m3.2.2.4.2.3" xref="S3.p2.3.m3.2.2.4.2.3.cmml"><mi id="S3.p2.3.m3.2.2.4.2.3.2" xref="S3.p2.3.m3.2.2.4.2.3.2.cmml">i</mi><mo id="S3.p2.3.m3.2.2.4.2.3.1" xref="S3.p2.3.m3.2.2.4.2.3.1.cmml">⁢</mo><mi id="S3.p2.3.m3.2.2.4.2.3.3" xref="S3.p2.3.m3.2.2.4.2.3.3.cmml">j</mi></mrow></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.3.m3.2b"><apply id="S3.p2.3.m3.2.2.cmml" xref="S3.p2.3.m3.2.2"><eq id="S3.p2.3.m3.2.2.3.cmml" xref="S3.p2.3.m3.2.2.3"></eq><apply id="S3.p2.3.m3.2.2.2.cmml" xref="S3.p2.3.m3.2.2.2"><times id="S3.p2.3.m3.2.2.2.3.cmml" xref="S3.p2.3.m3.2.2.2.3"></times><ci id="S3.p2.3.m3.2.2.2.4.cmml" xref="S3.p2.3.m3.2.2.2.4">𝑞</ci><interval closure="open" id="S3.p2.3.m3.2.2.2.2.3.cmml" xref="S3.p2.3.m3.2.2.2.2.2"><apply id="S3.p2.3.m3.1.1.1.1.1.1.cmml" xref="S3.p2.3.m3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.p2.3.m3.1.1.1.1.1.1.1.cmml" xref="S3.p2.3.m3.1.1.1.1.1.1">subscript</csymbol><ci id="S3.p2.3.m3.1.1.1.1.1.1.2.cmml" xref="S3.p2.3.m3.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.p2.3.m3.1.1.1.1.1.1.3.cmml" xref="S3.p2.3.m3.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.p2.3.m3.2.2.2.2.2.2.cmml" xref="S3.p2.3.m3.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.p2.3.m3.2.2.2.2.2.2.1.cmml" xref="S3.p2.3.m3.2.2.2.2.2.2">subscript</csymbol><ci id="S3.p2.3.m3.2.2.2.2.2.2.2.cmml" xref="S3.p2.3.m3.2.2.2.2.2.2.2">𝑏</ci><ci id="S3.p2.3.m3.2.2.2.2.2.2.3.cmml" xref="S3.p2.3.m3.2.2.2.2.2.2.3">𝑖</ci></apply></interval></apply><apply id="S3.p2.3.m3.2.2.4.cmml" xref="S3.p2.3.m3.2.2.4"><apply id="S3.p2.3.m3.2.2.4.1.cmml" xref="S3.p2.3.m3.2.2.4.1"><csymbol cd="ambiguous" id="S3.p2.3.m3.2.2.4.1.1.cmml" xref="S3.p2.3.m3.2.2.4.1">superscript</csymbol><apply id="S3.p2.3.m3.2.2.4.1.2.cmml" xref="S3.p2.3.m3.2.2.4.1"><csymbol cd="ambiguous" id="S3.p2.3.m3.2.2.4.1.2.1.cmml" xref="S3.p2.3.m3.2.2.4.1">subscript</csymbol><sum id="S3.p2.3.m3.2.2.4.1.2.2.cmml" xref="S3.p2.3.m3.2.2.4.1.2.2"></sum><apply id="S3.p2.3.m3.2.2.4.1.2.3.cmml" xref="S3.p2.3.m3.2.2.4.1.2.3"><eq id="S3.p2.3.m3.2.2.4.1.2.3.1.cmml" xref="S3.p2.3.m3.2.2.4.1.2.3.1"></eq><ci id="S3.p2.3.m3.2.2.4.1.2.3.2.cmml" xref="S3.p2.3.m3.2.2.4.1.2.3.2">𝑗</ci><cn id="S3.p2.3.m3.2.2.4.1.2.3.3.cmml" type="integer" xref="S3.p2.3.m3.2.2.4.1.2.3.3">1</cn></apply></apply><apply id="S3.p2.3.m3.2.2.4.1.3.cmml" xref="S3.p2.3.m3.2.2.4.1.3"><csymbol cd="ambiguous" id="S3.p2.3.m3.2.2.4.1.3.1.cmml" xref="S3.p2.3.m3.2.2.4.1.3">subscript</csymbol><ci id="S3.p2.3.m3.2.2.4.1.3.2.cmml" xref="S3.p2.3.m3.2.2.4.1.3.2">𝑏</ci><ci id="S3.p2.3.m3.2.2.4.1.3.3.cmml" xref="S3.p2.3.m3.2.2.4.1.3.3">𝑖</ci></apply></apply><apply id="S3.p2.3.m3.2.2.4.2.cmml" xref="S3.p2.3.m3.2.2.4.2"><csymbol cd="ambiguous" id="S3.p2.3.m3.2.2.4.2.1.cmml" xref="S3.p2.3.m3.2.2.4.2">subscript</csymbol><ci id="S3.p2.3.m3.2.2.4.2.2.cmml" xref="S3.p2.3.m3.2.2.4.2.2">Δ</ci><apply id="S3.p2.3.m3.2.2.4.2.3.cmml" xref="S3.p2.3.m3.2.2.4.2.3"><times id="S3.p2.3.m3.2.2.4.2.3.1.cmml" xref="S3.p2.3.m3.2.2.4.2.3.1"></times><ci id="S3.p2.3.m3.2.2.4.2.3.2.cmml" xref="S3.p2.3.m3.2.2.4.2.3.2">𝑖</ci><ci id="S3.p2.3.m3.2.2.4.2.3.3.cmml" xref="S3.p2.3.m3.2.2.4.2.3.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.3.m3.2c">q(x_{i},b_{i})=\sum_{j=1}^{b_{i}}\Delta_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.3.m3.2d">italic_q ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) = ∑ start_POSTSUBSCRIPT italic_j = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUPERSCRIPT roman_Δ start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math>; intuitively, <math alttext="\Delta_{ij}" class="ltx_Math" display="inline" id="S3.p2.4.m4.1"><semantics id="S3.p2.4.m4.1a"><msub id="S3.p2.4.m4.1.1" xref="S3.p2.4.m4.1.1.cmml"><mi id="S3.p2.4.m4.1.1.2" mathvariant="normal" xref="S3.p2.4.m4.1.1.2.cmml">Δ</mi><mrow id="S3.p2.4.m4.1.1.3" xref="S3.p2.4.m4.1.1.3.cmml"><mi id="S3.p2.4.m4.1.1.3.2" xref="S3.p2.4.m4.1.1.3.2.cmml">i</mi><mo id="S3.p2.4.m4.1.1.3.1" xref="S3.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.p2.4.m4.1.1.3.3" xref="S3.p2.4.m4.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.p2.4.m4.1b"><apply id="S3.p2.4.m4.1.1.cmml" xref="S3.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S3.p2.4.m4.1.1.1.cmml" xref="S3.p2.4.m4.1.1">subscript</csymbol><ci id="S3.p2.4.m4.1.1.2.cmml" xref="S3.p2.4.m4.1.1.2">Δ</ci><apply id="S3.p2.4.m4.1.1.3.cmml" xref="S3.p2.4.m4.1.1.3"><times id="S3.p2.4.m4.1.1.3.1.cmml" xref="S3.p2.4.m4.1.1.3.1"></times><ci id="S3.p2.4.m4.1.1.3.2.cmml" xref="S3.p2.4.m4.1.1.3.2">𝑖</ci><ci id="S3.p2.4.m4.1.1.3.3.cmml" xref="S3.p2.4.m4.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.4.m4.1c">\Delta_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.4.m4.1d">roman_Δ start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math> represents the expected gain from allocating one more “unit” of computation to <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.p2.5.m5.1"><semantics id="S3.p2.5.m5.1a"><msub id="S3.p2.5.m5.1.1" xref="S3.p2.5.m5.1.1.cmml"><mi id="S3.p2.5.m5.1.1.2" xref="S3.p2.5.m5.1.1.2.cmml">x</mi><mi id="S3.p2.5.m5.1.1.3" xref="S3.p2.5.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p2.5.m5.1b"><apply id="S3.p2.5.m5.1.1.cmml" xref="S3.p2.5.m5.1.1"><csymbol cd="ambiguous" id="S3.p2.5.m5.1.1.1.cmml" xref="S3.p2.5.m5.1.1">subscript</csymbol><ci id="S3.p2.5.m5.1.1.2.cmml" xref="S3.p2.5.m5.1.1.2">𝑥</ci><ci id="S3.p2.5.m5.1.1.3.cmml" xref="S3.p2.5.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.5.m5.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.5.m5.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, given that we have already allocated <math alttext="j-1" class="ltx_Math" display="inline" id="S3.p2.6.m6.1"><semantics id="S3.p2.6.m6.1a"><mrow id="S3.p2.6.m6.1.1" xref="S3.p2.6.m6.1.1.cmml"><mi id="S3.p2.6.m6.1.1.2" xref="S3.p2.6.m6.1.1.2.cmml">j</mi><mo id="S3.p2.6.m6.1.1.1" xref="S3.p2.6.m6.1.1.1.cmml">−</mo><mn id="S3.p2.6.m6.1.1.3" xref="S3.p2.6.m6.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.6.m6.1b"><apply id="S3.p2.6.m6.1.1.cmml" xref="S3.p2.6.m6.1.1"><minus id="S3.p2.6.m6.1.1.1.cmml" xref="S3.p2.6.m6.1.1.1"></minus><ci id="S3.p2.6.m6.1.1.2.cmml" xref="S3.p2.6.m6.1.1.2">𝑗</ci><cn id="S3.p2.6.m6.1.1.3.cmml" type="integer" xref="S3.p2.6.m6.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.6.m6.1c">j-1</annotation><annotation encoding="application/x-llamapun" id="S3.p2.6.m6.1d">italic_j - 1</annotation></semantics></math> units.
We may then re-write <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S2.E4" title="In 2 Preliminaries ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">4</span></a> as:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A1.EGx1">
<tbody id="S3.E5"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_center ltx_eqn_cell" colspan="2"><math alttext="\displaystyle\begin{split}\max\quad&amp;\sum_{i=1}^{n}\sum_{j=0}^{B_{\mathrm{max}}%
}c_{ij}\Delta_{ij}\quad\text{s.t.}\quad\sum_{i,j}c_{ij}\leq B\cdot n~{};\quad c%
_{ij}\leq c_{i,j-1}~{}\forall i,j\end{split}" class="ltx_math_unparsed" display="inline" id="S3.E5.m1.32"><semantics id="S3.E5.m1.32a"><mtable columnspacing="0pt" id="S3.E5.m1.32.32.2"><mtr id="S3.E5.m1.32.32.2a"><mtd class="ltx_align_right" columnalign="right" id="S3.E5.m1.32.32.2b"><mi id="S3.E5.m1.1.1.1.1.1.1">max</mi></mtd><mtd class="ltx_align_left" columnalign="left" id="S3.E5.m1.32.32.2c"><mrow id="S3.E5.m1.32.32.2.32.32.31.31"><mrow id="S3.E5.m1.31.31.1.31.31.30.30.1"><mrow id="S3.E5.m1.31.31.1.31.31.30.30.1.2.2"><mrow id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1"><mstyle displaystyle="true" id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.1"><munderover id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.1a"><mo id="S3.E5.m1.2.2.2.2.1.1" movablelimits="false">∑</mo><mrow id="S3.E5.m1.3.3.3.3.2.2.1"><mi id="S3.E5.m1.3.3.3.3.2.2.1.2">i</mi><mo id="S3.E5.m1.3.3.3.3.2.2.1.1">=</mo><mn id="S3.E5.m1.3.3.3.3.2.2.1.3">1</mn></mrow><mi id="S3.E5.m1.4.4.4.4.3.3.1">n</mi></munderover></mstyle><mrow id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.2"><mstyle displaystyle="true" id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.2.1"><munderover id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.2.1a"><mo id="S3.E5.m1.5.5.5.5.4.4" movablelimits="false">∑</mo><mrow id="S3.E5.m1.6.6.6.6.5.5.1"><mi id="S3.E5.m1.6.6.6.6.5.5.1.2">j</mi><mo id="S3.E5.m1.6.6.6.6.5.5.1.1">=</mo><mn id="S3.E5.m1.6.6.6.6.5.5.1.3">0</mn></mrow><msub id="S3.E5.m1.7.7.7.7.6.6.1"><mi id="S3.E5.m1.7.7.7.7.6.6.1.2">B</mi><mi id="S3.E5.m1.7.7.7.7.6.6.1.3">max</mi></msub></munderover></mstyle><mrow id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.2.2"><msub id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.2.2.2"><mi id="S3.E5.m1.8.8.8.8.7.7">c</mi><mrow id="S3.E5.m1.9.9.9.9.8.8.1"><mi id="S3.E5.m1.9.9.9.9.8.8.1.2">i</mi><mo id="S3.E5.m1.9.9.9.9.8.8.1.1">⁢</mo><mi id="S3.E5.m1.9.9.9.9.8.8.1.3">j</mi></mrow></msub><mo id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.2.2.1">⁢</mo><msub id="S3.E5.m1.31.31.1.31.31.30.30.1.1.1.1.2.2.3"><mi id="S3.E5.m1.10.10.10.10.9.9" mathvariant="normal">Δ</mi><mrow id="S3.E5.m1.11.11.11.11.10.10.1"><mi id="S3.E5.m1.11.11.11.11.10.10.1.2">i</mi><mo id="S3.E5.m1.11.11.11.11.10.10.1.1">⁢</mo><mi id="S3.E5.m1.11.11.11.11.10.10.1.3">j</mi></mrow></msub></mrow></mrow></mrow><mspace id="S3.E5.m1.31.31.1.31.31.30.30.1.2.2.3" width="1em"></mspace><mtext id="S3.E5.m1.12.12.12.12.11.11">s.t.</mtext><mspace id="S3.E5.m1.31.31.1.31.31.30.30.1.2.2.4" width="1em"></mspace><mrow id="S3.E5.m1.31.31.1.31.31.30.30.1.2.2.2"><mstyle displaystyle="true" id="S3.E5.m1.31.31.1.31.31.30.30.1.2.2.2.1"><munder id="S3.E5.m1.31.31.1.31.31.30.30.1.2.2.2.1a"><mo id="S3.E5.m1.13.13.13.13.12.12" movablelimits="false">∑</mo><mrow id="S3.E5.m1.14.14.14.14.13.13.1.4"><mi id="S3.E5.m1.14.14.14.14.13.13.1.1">i</mi><mo id="S3.E5.m1.14.14.14.14.13.13.1.4.1">,</mo><mi id="S3.E5.m1.14.14.14.14.13.13.1.2">j</mi></mrow></munder></mstyle><msub id="S3.E5.m1.31.31.1.31.31.30.30.1.2.2.2.2"><mi id="S3.E5.m1.15.15.15.15.14.14">c</mi><mrow id="S3.E5.m1.16.16.16.16.15.15.1"><mi id="S3.E5.m1.16.16.16.16.15.15.1.2">i</mi><mo id="S3.E5.m1.16.16.16.16.15.15.1.1">⁢</mo><mi id="S3.E5.m1.16.16.16.16.15.15.1.3">j</mi></mrow></msub></mrow></mrow><mo id="S3.E5.m1.17.17.17.17.16.16">≤</mo><mrow id="S3.E5.m1.31.31.1.31.31.30.30.1.3"><mi id="S3.E5.m1.18.18.18.18.17.17">B</mi><mo id="S3.E5.m1.19.19.19.19.18.18" lspace="0.222em" rspace="0.222em">⋅</mo><mi id="S3.E5.m1.20.20.20.20.19.19">n</mi></mrow></mrow><mo id="S3.E5.m1.21.21.21.21.20.20" lspace="0.330em" rspace="1.167em">;</mo><mrow id="S3.E5.m1.32.32.2.32.32.31.31.2"><msub id="S3.E5.m1.32.32.2.32.32.31.31.2.2"><mi id="S3.E5.m1.22.22.22.22.21.21">c</mi><mrow id="S3.E5.m1.23.23.23.23.22.22.1"><mi id="S3.E5.m1.23.23.23.23.22.22.1.2">i</mi><mo id="S3.E5.m1.23.23.23.23.22.22.1.1">⁢</mo><mi id="S3.E5.m1.23.23.23.23.22.22.1.3">j</mi></mrow></msub><mo id="S3.E5.m1.24.24.24.24.23.23">≤</mo><mrow id="S3.E5.m1.32.32.2.32.32.31.31.2.1.1"><mrow id="S3.E5.m1.32.32.2.32.32.31.31.2.1.1.1"><msub id="S3.E5.m1.32.32.2.32.32.31.31.2.1.1.1.2"><mi id="S3.E5.m1.25.25.25.25.24.24">c</mi><mrow id="S3.E5.m1.26.26.26.26.25.25.1.2"><mi id="S3.E5.m1.26.26.26.26.25.25.1.1">i</mi><mo id="S3.E5.m1.26.26.26.26.25.25.1.2.2">,</mo><mrow id="S3.E5.m1.26.26.26.26.25.25.1.2.1"><mi id="S3.E5.m1.26.26.26.26.25.25.1.2.1.2">j</mi><mo id="S3.E5.m1.26.26.26.26.25.25.1.2.1.1">−</mo><mn id="S3.E5.m1.26.26.26.26.25.25.1.2.1.3">1</mn></mrow></mrow></msub><mo id="S3.E5.m1.32.32.2.32.32.31.31.2.1.1.1.1" lspace="0.167em">⁢</mo><mrow id="S3.E5.m1.32.32.2.32.32.31.31.2.1.1.1.3"><mo id="S3.E5.m1.27.27.27.27.26.26" rspace="0.167em">∀</mo><mi id="S3.E5.m1.28.28.28.28.27.27">i</mi></mrow></mrow><mo id="S3.E5.m1.29.29.29.29.28.28">,</mo><mi id="S3.E5.m1.30.30.30.30.29.29">j</mi></mrow></mrow></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex" id="S3.E5.m1.32b">\displaystyle\begin{split}\max\quad&amp;\sum_{i=1}^{n}\sum_{j=0}^{B_{\mathrm{max}}%
}c_{ij}\Delta_{ij}\quad\text{s.t.}\quad\sum_{i,j}c_{ij}\leq B\cdot n~{};\quad c%
_{ij}\leq c_{i,j-1}~{}\forall i,j\end{split}</annotation><annotation encoding="application/x-llamapun" id="S3.E5.m1.32c">start_ROW start_CELL roman_max end_CELL start_CELL ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT ∑ start_POSTSUBSCRIPT italic_j = 0 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_B start_POSTSUBSCRIPT roman_max end_POSTSUBSCRIPT end_POSTSUPERSCRIPT italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT roman_Δ start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT s.t. ∑ start_POSTSUBSCRIPT italic_i , italic_j end_POSTSUBSCRIPT italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ≤ italic_B ⋅ italic_n ; italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ≤ italic_c start_POSTSUBSCRIPT italic_i , italic_j - 1 end_POSTSUBSCRIPT ∀ italic_i , italic_j end_CELL end_ROW</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(5)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.p2.13">Here we have introduced auxiliary variables <math alttext="c_{ij}\in\{0,1\}" class="ltx_Math" display="inline" id="S3.p2.7.m1.2"><semantics id="S3.p2.7.m1.2a"><mrow id="S3.p2.7.m1.2.3" xref="S3.p2.7.m1.2.3.cmml"><msub id="S3.p2.7.m1.2.3.2" xref="S3.p2.7.m1.2.3.2.cmml"><mi id="S3.p2.7.m1.2.3.2.2" xref="S3.p2.7.m1.2.3.2.2.cmml">c</mi><mrow id="S3.p2.7.m1.2.3.2.3" xref="S3.p2.7.m1.2.3.2.3.cmml"><mi id="S3.p2.7.m1.2.3.2.3.2" xref="S3.p2.7.m1.2.3.2.3.2.cmml">i</mi><mo id="S3.p2.7.m1.2.3.2.3.1" xref="S3.p2.7.m1.2.3.2.3.1.cmml">⁢</mo><mi id="S3.p2.7.m1.2.3.2.3.3" xref="S3.p2.7.m1.2.3.2.3.3.cmml">j</mi></mrow></msub><mo id="S3.p2.7.m1.2.3.1" xref="S3.p2.7.m1.2.3.1.cmml">∈</mo><mrow id="S3.p2.7.m1.2.3.3.2" xref="S3.p2.7.m1.2.3.3.1.cmml"><mo id="S3.p2.7.m1.2.3.3.2.1" stretchy="false" xref="S3.p2.7.m1.2.3.3.1.cmml">{</mo><mn id="S3.p2.7.m1.1.1" xref="S3.p2.7.m1.1.1.cmml">0</mn><mo id="S3.p2.7.m1.2.3.3.2.2" xref="S3.p2.7.m1.2.3.3.1.cmml">,</mo><mn id="S3.p2.7.m1.2.2" xref="S3.p2.7.m1.2.2.cmml">1</mn><mo id="S3.p2.7.m1.2.3.3.2.3" stretchy="false" xref="S3.p2.7.m1.2.3.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.7.m1.2b"><apply id="S3.p2.7.m1.2.3.cmml" xref="S3.p2.7.m1.2.3"><in id="S3.p2.7.m1.2.3.1.cmml" xref="S3.p2.7.m1.2.3.1"></in><apply id="S3.p2.7.m1.2.3.2.cmml" xref="S3.p2.7.m1.2.3.2"><csymbol cd="ambiguous" id="S3.p2.7.m1.2.3.2.1.cmml" xref="S3.p2.7.m1.2.3.2">subscript</csymbol><ci id="S3.p2.7.m1.2.3.2.2.cmml" xref="S3.p2.7.m1.2.3.2.2">𝑐</ci><apply id="S3.p2.7.m1.2.3.2.3.cmml" xref="S3.p2.7.m1.2.3.2.3"><times id="S3.p2.7.m1.2.3.2.3.1.cmml" xref="S3.p2.7.m1.2.3.2.3.1"></times><ci id="S3.p2.7.m1.2.3.2.3.2.cmml" xref="S3.p2.7.m1.2.3.2.3.2">𝑖</ci><ci id="S3.p2.7.m1.2.3.2.3.3.cmml" xref="S3.p2.7.m1.2.3.2.3.3">𝑗</ci></apply></apply><set id="S3.p2.7.m1.2.3.3.1.cmml" xref="S3.p2.7.m1.2.3.3.2"><cn id="S3.p2.7.m1.1.1.cmml" type="integer" xref="S3.p2.7.m1.1.1">0</cn><cn id="S3.p2.7.m1.2.2.cmml" type="integer" xref="S3.p2.7.m1.2.2">1</cn></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.7.m1.2c">c_{ij}\in\{0,1\}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.7.m1.2d">italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT ∈ { 0 , 1 }</annotation></semantics></math> to represent budget increments: intuitively, setting <math alttext="c_{ij}=1" class="ltx_Math" display="inline" id="S3.p2.8.m2.1"><semantics id="S3.p2.8.m2.1a"><mrow id="S3.p2.8.m2.1.1" xref="S3.p2.8.m2.1.1.cmml"><msub id="S3.p2.8.m2.1.1.2" xref="S3.p2.8.m2.1.1.2.cmml"><mi id="S3.p2.8.m2.1.1.2.2" xref="S3.p2.8.m2.1.1.2.2.cmml">c</mi><mrow id="S3.p2.8.m2.1.1.2.3" xref="S3.p2.8.m2.1.1.2.3.cmml"><mi id="S3.p2.8.m2.1.1.2.3.2" xref="S3.p2.8.m2.1.1.2.3.2.cmml">i</mi><mo id="S3.p2.8.m2.1.1.2.3.1" xref="S3.p2.8.m2.1.1.2.3.1.cmml">⁢</mo><mi id="S3.p2.8.m2.1.1.2.3.3" xref="S3.p2.8.m2.1.1.2.3.3.cmml">j</mi></mrow></msub><mo id="S3.p2.8.m2.1.1.1" xref="S3.p2.8.m2.1.1.1.cmml">=</mo><mn id="S3.p2.8.m2.1.1.3" xref="S3.p2.8.m2.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.p2.8.m2.1b"><apply id="S3.p2.8.m2.1.1.cmml" xref="S3.p2.8.m2.1.1"><eq id="S3.p2.8.m2.1.1.1.cmml" xref="S3.p2.8.m2.1.1.1"></eq><apply id="S3.p2.8.m2.1.1.2.cmml" xref="S3.p2.8.m2.1.1.2"><csymbol cd="ambiguous" id="S3.p2.8.m2.1.1.2.1.cmml" xref="S3.p2.8.m2.1.1.2">subscript</csymbol><ci id="S3.p2.8.m2.1.1.2.2.cmml" xref="S3.p2.8.m2.1.1.2.2">𝑐</ci><apply id="S3.p2.8.m2.1.1.2.3.cmml" xref="S3.p2.8.m2.1.1.2.3"><times id="S3.p2.8.m2.1.1.2.3.1.cmml" xref="S3.p2.8.m2.1.1.2.3.1"></times><ci id="S3.p2.8.m2.1.1.2.3.2.cmml" xref="S3.p2.8.m2.1.1.2.3.2">𝑖</ci><ci id="S3.p2.8.m2.1.1.2.3.3.cmml" xref="S3.p2.8.m2.1.1.2.3.3">𝑗</ci></apply></apply><cn id="S3.p2.8.m2.1.1.3.cmml" type="integer" xref="S3.p2.8.m2.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.8.m2.1c">c_{ij}=1</annotation><annotation encoding="application/x-llamapun" id="S3.p2.8.m2.1d">italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT = 1</annotation></semantics></math> means we have allocated a <math alttext="j" class="ltx_Math" display="inline" id="S3.p2.9.m3.1"><semantics id="S3.p2.9.m3.1a"><mi id="S3.p2.9.m3.1.1" xref="S3.p2.9.m3.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="S3.p2.9.m3.1b"><ci id="S3.p2.9.m3.1.1.cmml" xref="S3.p2.9.m3.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.9.m3.1c">j</annotation><annotation encoding="application/x-llamapun" id="S3.p2.9.m3.1d">italic_j</annotation></semantics></math>th unit of computation to <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.p2.10.m4.1"><semantics id="S3.p2.10.m4.1a"><msub id="S3.p2.10.m4.1.1" xref="S3.p2.10.m4.1.1.cmml"><mi id="S3.p2.10.m4.1.1.2" xref="S3.p2.10.m4.1.1.2.cmml">x</mi><mi id="S3.p2.10.m4.1.1.3" xref="S3.p2.10.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p2.10.m4.1b"><apply id="S3.p2.10.m4.1.1.cmml" xref="S3.p2.10.m4.1.1"><csymbol cd="ambiguous" id="S3.p2.10.m4.1.1.1.cmml" xref="S3.p2.10.m4.1.1">subscript</csymbol><ci id="S3.p2.10.m4.1.1.2.cmml" xref="S3.p2.10.m4.1.1.2">𝑥</ci><ci id="S3.p2.10.m4.1.1.3.cmml" xref="S3.p2.10.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.10.m4.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.10.m4.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, and constraints enforce that these units are allocated in sequence, as shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.F2" title="Figure 2 ‣ 3.2 Allocating Computation ‣ 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">2</span></a>. To determine how to allocate decoding computation across a set of queries <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.p2.11.m5.1"><semantics id="S3.p2.11.m5.1a"><msub id="S3.p2.11.m5.1.1" xref="S3.p2.11.m5.1.1.cmml"><mi id="S3.p2.11.m5.1.1.2" xref="S3.p2.11.m5.1.1.2.cmml">x</mi><mi id="S3.p2.11.m5.1.1.3" xref="S3.p2.11.m5.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.p2.11.m5.1b"><apply id="S3.p2.11.m5.1.1.cmml" xref="S3.p2.11.m5.1.1"><csymbol cd="ambiguous" id="S3.p2.11.m5.1.1.1.cmml" xref="S3.p2.11.m5.1.1">subscript</csymbol><ci id="S3.p2.11.m5.1.1.2.cmml" xref="S3.p2.11.m5.1.1.2">𝑥</ci><ci id="S3.p2.11.m5.1.1.3.cmml" xref="S3.p2.11.m5.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.11.m5.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.11.m5.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, it then suffices to predict the value of each term <math alttext="\Delta_{ij}" class="ltx_Math" display="inline" id="S3.p2.12.m6.1"><semantics id="S3.p2.12.m6.1a"><msub id="S3.p2.12.m6.1.1" xref="S3.p2.12.m6.1.1.cmml"><mi id="S3.p2.12.m6.1.1.2" mathvariant="normal" xref="S3.p2.12.m6.1.1.2.cmml">Δ</mi><mrow id="S3.p2.12.m6.1.1.3" xref="S3.p2.12.m6.1.1.3.cmml"><mi id="S3.p2.12.m6.1.1.3.2" xref="S3.p2.12.m6.1.1.3.2.cmml">i</mi><mo id="S3.p2.12.m6.1.1.3.1" xref="S3.p2.12.m6.1.1.3.1.cmml">⁢</mo><mi id="S3.p2.12.m6.1.1.3.3" xref="S3.p2.12.m6.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.p2.12.m6.1b"><apply id="S3.p2.12.m6.1.1.cmml" xref="S3.p2.12.m6.1.1"><csymbol cd="ambiguous" id="S3.p2.12.m6.1.1.1.cmml" xref="S3.p2.12.m6.1.1">subscript</csymbol><ci id="S3.p2.12.m6.1.1.2.cmml" xref="S3.p2.12.m6.1.1.2">Δ</ci><apply id="S3.p2.12.m6.1.1.3.cmml" xref="S3.p2.12.m6.1.1.3"><times id="S3.p2.12.m6.1.1.3.1.cmml" xref="S3.p2.12.m6.1.1.3.1"></times><ci id="S3.p2.12.m6.1.1.3.2.cmml" xref="S3.p2.12.m6.1.1.3.2">𝑖</ci><ci id="S3.p2.12.m6.1.1.3.3.cmml" xref="S3.p2.12.m6.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.12.m6.1c">\Delta_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.p2.12.m6.1d">roman_Δ start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math> and then solve <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.E5" title="In 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">5</span></a> to obtain <math alttext="c" class="ltx_Math" display="inline" id="S3.p2.13.m7.1"><semantics id="S3.p2.13.m7.1a"><mi id="S3.p2.13.m7.1.1" xref="S3.p2.13.m7.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="S3.p2.13.m7.1b"><ci id="S3.p2.13.m7.1.1.cmml" xref="S3.p2.13.m7.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.p2.13.m7.1c">c</annotation><annotation encoding="application/x-llamapun" id="S3.p2.13.m7.1d">italic_c</annotation></semantics></math>. Each of these steps is described in more detail below.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Estimating Problem Difficulty by Predicting Marginal Rewards</h3>
<div class="ltx_para ltx_noindent" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.7">Given a training set of queries <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><msub id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml"><mi id="S3.SS1.p1.1.m1.1.1.2" xref="S3.SS1.p1.1.m1.1.1.2.cmml">x</mi><mi id="S3.SS1.p1.1.m1.1.1.3" xref="S3.SS1.p1.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><apply id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS1.p1.1.m1.1.1.2.cmml" xref="S3.SS1.p1.1.m1.1.1.2">𝑥</ci><ci id="S3.SS1.p1.1.m1.1.1.3.cmml" xref="S3.SS1.p1.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, we collect empirical estimates of <math alttext="\Delta_{ij}" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><msub id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml"><mi id="S3.SS1.p1.2.m2.1.1.2" mathvariant="normal" xref="S3.SS1.p1.2.m2.1.1.2.cmml">Δ</mi><mrow id="S3.SS1.p1.2.m2.1.1.3" xref="S3.SS1.p1.2.m2.1.1.3.cmml"><mi id="S3.SS1.p1.2.m2.1.1.3.2" xref="S3.SS1.p1.2.m2.1.1.3.2.cmml">i</mi><mo id="S3.SS1.p1.2.m2.1.1.3.1" xref="S3.SS1.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS1.p1.2.m2.1.1.3.3" xref="S3.SS1.p1.2.m2.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><apply id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.2.m2.1.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS1.p1.2.m2.1.1.2.cmml" xref="S3.SS1.p1.2.m2.1.1.2">Δ</ci><apply id="S3.SS1.p1.2.m2.1.1.3.cmml" xref="S3.SS1.p1.2.m2.1.1.3"><times id="S3.SS1.p1.2.m2.1.1.3.1.cmml" xref="S3.SS1.p1.2.m2.1.1.3.1"></times><ci id="S3.SS1.p1.2.m2.1.1.3.2.cmml" xref="S3.SS1.p1.2.m2.1.1.3.2">𝑖</ci><ci id="S3.SS1.p1.2.m2.1.1.3.3.cmml" xref="S3.SS1.p1.2.m2.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">\Delta_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">roman_Δ start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math> by decoding from <math alttext="f(x,b)" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.2"><semantics id="S3.SS1.p1.3.m3.2a"><mrow id="S3.SS1.p1.3.m3.2.3" xref="S3.SS1.p1.3.m3.2.3.cmml"><mi id="S3.SS1.p1.3.m3.2.3.2" xref="S3.SS1.p1.3.m3.2.3.2.cmml">f</mi><mo id="S3.SS1.p1.3.m3.2.3.1" xref="S3.SS1.p1.3.m3.2.3.1.cmml">⁢</mo><mrow id="S3.SS1.p1.3.m3.2.3.3.2" xref="S3.SS1.p1.3.m3.2.3.3.1.cmml"><mo id="S3.SS1.p1.3.m3.2.3.3.2.1" stretchy="false" xref="S3.SS1.p1.3.m3.2.3.3.1.cmml">(</mo><mi id="S3.SS1.p1.3.m3.1.1" xref="S3.SS1.p1.3.m3.1.1.cmml">x</mi><mo id="S3.SS1.p1.3.m3.2.3.3.2.2" xref="S3.SS1.p1.3.m3.2.3.3.1.cmml">,</mo><mi id="S3.SS1.p1.3.m3.2.2" xref="S3.SS1.p1.3.m3.2.2.cmml">b</mi><mo id="S3.SS1.p1.3.m3.2.3.3.2.3" stretchy="false" xref="S3.SS1.p1.3.m3.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.2b"><apply id="S3.SS1.p1.3.m3.2.3.cmml" xref="S3.SS1.p1.3.m3.2.3"><times id="S3.SS1.p1.3.m3.2.3.1.cmml" xref="S3.SS1.p1.3.m3.2.3.1"></times><ci id="S3.SS1.p1.3.m3.2.3.2.cmml" xref="S3.SS1.p1.3.m3.2.3.2">𝑓</ci><interval closure="open" id="S3.SS1.p1.3.m3.2.3.3.1.cmml" xref="S3.SS1.p1.3.m3.2.3.3.2"><ci id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">𝑥</ci><ci id="S3.SS1.p1.3.m3.2.2.cmml" xref="S3.SS1.p1.3.m3.2.2">𝑏</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.2c">f(x,b)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.2d">italic_f ( italic_x , italic_b )</annotation></semantics></math> at values of <math alttext="b" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.1"><semantics id="S3.SS1.p1.4.m4.1a"><mi id="S3.SS1.p1.4.m4.1.1" xref="S3.SS1.p1.4.m4.1.1.cmml">b</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.1b"><ci id="S3.SS1.p1.4.m4.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1">𝑏</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.1c">b</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.1d">italic_b</annotation></semantics></math> up to some <math alttext="B_{\mathrm{max}}" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m5.1"><semantics id="S3.SS1.p1.5.m5.1a"><msub id="S3.SS1.p1.5.m5.1.1" xref="S3.SS1.p1.5.m5.1.1.cmml"><mi id="S3.SS1.p1.5.m5.1.1.2" xref="S3.SS1.p1.5.m5.1.1.2.cmml">B</mi><mi id="S3.SS1.p1.5.m5.1.1.3" xref="S3.SS1.p1.5.m5.1.1.3.cmml">max</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m5.1b"><apply id="S3.SS1.p1.5.m5.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.5.m5.1.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1">subscript</csymbol><ci id="S3.SS1.p1.5.m5.1.1.2.cmml" xref="S3.SS1.p1.5.m5.1.1.2">𝐵</ci><ci id="S3.SS1.p1.5.m5.1.1.3.cmml" xref="S3.SS1.p1.5.m5.1.1.3">max</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m5.1c">B_{\mathrm{max}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m5.1d">italic_B start_POSTSUBSCRIPT roman_max end_POSTSUBSCRIPT</annotation></semantics></math>.
We then train a model <math alttext="\hat{\mathbf{\Delta}}(x_{i};\theta)" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m6.2"><semantics id="S3.SS1.p1.6.m6.2a"><mrow id="S3.SS1.p1.6.m6.2.2" xref="S3.SS1.p1.6.m6.2.2.cmml"><mover accent="true" id="S3.SS1.p1.6.m6.2.2.3" xref="S3.SS1.p1.6.m6.2.2.3.cmml"><mi id="S3.SS1.p1.6.m6.2.2.3.2" xref="S3.SS1.p1.6.m6.2.2.3.2.cmml">𝚫</mi><mo id="S3.SS1.p1.6.m6.2.2.3.1" xref="S3.SS1.p1.6.m6.2.2.3.1.cmml">^</mo></mover><mo id="S3.SS1.p1.6.m6.2.2.2" xref="S3.SS1.p1.6.m6.2.2.2.cmml">⁢</mo><mrow id="S3.SS1.p1.6.m6.2.2.1.1" xref="S3.SS1.p1.6.m6.2.2.1.2.cmml"><mo id="S3.SS1.p1.6.m6.2.2.1.1.2" stretchy="false" xref="S3.SS1.p1.6.m6.2.2.1.2.cmml">(</mo><msub id="S3.SS1.p1.6.m6.2.2.1.1.1" xref="S3.SS1.p1.6.m6.2.2.1.1.1.cmml"><mi id="S3.SS1.p1.6.m6.2.2.1.1.1.2" xref="S3.SS1.p1.6.m6.2.2.1.1.1.2.cmml">x</mi><mi id="S3.SS1.p1.6.m6.2.2.1.1.1.3" xref="S3.SS1.p1.6.m6.2.2.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS1.p1.6.m6.2.2.1.1.3" xref="S3.SS1.p1.6.m6.2.2.1.2.cmml">;</mo><mi id="S3.SS1.p1.6.m6.1.1" xref="S3.SS1.p1.6.m6.1.1.cmml">θ</mi><mo id="S3.SS1.p1.6.m6.2.2.1.1.4" stretchy="false" xref="S3.SS1.p1.6.m6.2.2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m6.2b"><apply id="S3.SS1.p1.6.m6.2.2.cmml" xref="S3.SS1.p1.6.m6.2.2"><times id="S3.SS1.p1.6.m6.2.2.2.cmml" xref="S3.SS1.p1.6.m6.2.2.2"></times><apply id="S3.SS1.p1.6.m6.2.2.3.cmml" xref="S3.SS1.p1.6.m6.2.2.3"><ci id="S3.SS1.p1.6.m6.2.2.3.1.cmml" xref="S3.SS1.p1.6.m6.2.2.3.1">^</ci><ci id="S3.SS1.p1.6.m6.2.2.3.2.cmml" xref="S3.SS1.p1.6.m6.2.2.3.2">𝚫</ci></apply><list id="S3.SS1.p1.6.m6.2.2.1.2.cmml" xref="S3.SS1.p1.6.m6.2.2.1.1"><apply id="S3.SS1.p1.6.m6.2.2.1.1.1.cmml" xref="S3.SS1.p1.6.m6.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.6.m6.2.2.1.1.1.1.cmml" xref="S3.SS1.p1.6.m6.2.2.1.1.1">subscript</csymbol><ci id="S3.SS1.p1.6.m6.2.2.1.1.1.2.cmml" xref="S3.SS1.p1.6.m6.2.2.1.1.1.2">𝑥</ci><ci id="S3.SS1.p1.6.m6.2.2.1.1.1.3.cmml" xref="S3.SS1.p1.6.m6.2.2.1.1.1.3">𝑖</ci></apply><ci id="S3.SS1.p1.6.m6.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m6.2c">\hat{\mathbf{\Delta}}(x_{i};\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m6.2d">over^ start_ARG bold_Δ end_ARG ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_θ )</annotation></semantics></math> that predicts a vector of marginal rewards for all budgets <math alttext="j" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m7.1"><semantics id="S3.SS1.p1.7.m7.1a"><mi id="S3.SS1.p1.7.m7.1.1" xref="S3.SS1.p1.7.m7.1.1.cmml">j</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m7.1b"><ci id="S3.SS1.p1.7.m7.1.1.cmml" xref="S3.SS1.p1.7.m7.1.1">𝑗</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m7.1c">j</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m7.1d">italic_j</annotation></semantics></math> simultaneously
by optimizing the mean squared error:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E6">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\operatorname*{arg\,min}_{\theta}~{}\sum_{x_{i},\Delta_{i}}~{}\|\mathbf{\Delta%
}_{i}-\hat{\mathbf{\Delta}}(x_{i};\theta)\|_{2}^{2}" class="ltx_Math" display="block" id="S3.E6.m1.4"><semantics id="S3.E6.m1.4a"><mrow id="S3.E6.m1.4.4" xref="S3.E6.m1.4.4.cmml"><munder id="S3.E6.m1.4.4.3" xref="S3.E6.m1.4.4.3.cmml"><mrow id="S3.E6.m1.4.4.3.2" xref="S3.E6.m1.4.4.3.2.cmml"><mi id="S3.E6.m1.4.4.3.2.2" xref="S3.E6.m1.4.4.3.2.2.cmml">arg</mi><mo id="S3.E6.m1.4.4.3.2.1" lspace="0.170em" xref="S3.E6.m1.4.4.3.2.1.cmml">⁢</mo><mi id="S3.E6.m1.4.4.3.2.3" xref="S3.E6.m1.4.4.3.2.3.cmml">min</mi></mrow><mi id="S3.E6.m1.4.4.3.3" xref="S3.E6.m1.4.4.3.3.cmml">θ</mi></munder><mo id="S3.E6.m1.4.4.2" lspace="0.497em" xref="S3.E6.m1.4.4.2.cmml">⁢</mo><mrow id="S3.E6.m1.4.4.1" xref="S3.E6.m1.4.4.1.cmml"><munder id="S3.E6.m1.4.4.1.2" xref="S3.E6.m1.4.4.1.2.cmml"><mo id="S3.E6.m1.4.4.1.2.2" movablelimits="false" rspace="0em" xref="S3.E6.m1.4.4.1.2.2.cmml">∑</mo><mrow id="S3.E6.m1.2.2.2.2" xref="S3.E6.m1.2.2.2.3.cmml"><msub id="S3.E6.m1.1.1.1.1.1" xref="S3.E6.m1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.1.1.1.1.1.2" xref="S3.E6.m1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E6.m1.1.1.1.1.1.3" xref="S3.E6.m1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E6.m1.2.2.2.2.3" xref="S3.E6.m1.2.2.2.3.cmml">,</mo><msub id="S3.E6.m1.2.2.2.2.2" xref="S3.E6.m1.2.2.2.2.2.cmml"><mi id="S3.E6.m1.2.2.2.2.2.2" mathvariant="normal" xref="S3.E6.m1.2.2.2.2.2.2.cmml">Δ</mi><mi id="S3.E6.m1.2.2.2.2.2.3" xref="S3.E6.m1.2.2.2.2.2.3.cmml">i</mi></msub></mrow></munder><msubsup id="S3.E6.m1.4.4.1.1" xref="S3.E6.m1.4.4.1.1.cmml"><mrow id="S3.E6.m1.4.4.1.1.1.1.1" xref="S3.E6.m1.4.4.1.1.1.1.2.cmml"><mo id="S3.E6.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="S3.E6.m1.4.4.1.1.1.1.2.1.cmml">‖</mo><mrow id="S3.E6.m1.4.4.1.1.1.1.1.1" xref="S3.E6.m1.4.4.1.1.1.1.1.1.cmml"><msub id="S3.E6.m1.4.4.1.1.1.1.1.1.3" xref="S3.E6.m1.4.4.1.1.1.1.1.1.3.cmml"><mi id="S3.E6.m1.4.4.1.1.1.1.1.1.3.2" xref="S3.E6.m1.4.4.1.1.1.1.1.1.3.2.cmml">𝚫</mi><mi id="S3.E6.m1.4.4.1.1.1.1.1.1.3.3" xref="S3.E6.m1.4.4.1.1.1.1.1.1.3.3.cmml">i</mi></msub><mo id="S3.E6.m1.4.4.1.1.1.1.1.1.2" xref="S3.E6.m1.4.4.1.1.1.1.1.1.2.cmml">−</mo><mrow id="S3.E6.m1.4.4.1.1.1.1.1.1.1" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.cmml"><mover accent="true" id="S3.E6.m1.4.4.1.1.1.1.1.1.1.3" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.cmml"><mi id="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.2" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.2.cmml">𝚫</mi><mo id="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.1" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.1.cmml">^</mo></mover><mo id="S3.E6.m1.4.4.1.1.1.1.1.1.1.2" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">(</mo><msub id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">;</mo><mi id="S3.E6.m1.3.3" xref="S3.E6.m1.3.3.cmml">θ</mi><mo id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E6.m1.4.4.1.1.1.1.1.3" stretchy="false" xref="S3.E6.m1.4.4.1.1.1.1.2.1.cmml">‖</mo></mrow><mn id="S3.E6.m1.4.4.1.1.1.3" xref="S3.E6.m1.4.4.1.1.1.3.cmml">2</mn><mn id="S3.E6.m1.4.4.1.1.3" xref="S3.E6.m1.4.4.1.1.3.cmml">2</mn></msubsup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E6.m1.4b"><apply id="S3.E6.m1.4.4.cmml" xref="S3.E6.m1.4.4"><times id="S3.E6.m1.4.4.2.cmml" xref="S3.E6.m1.4.4.2"></times><apply id="S3.E6.m1.4.4.3.cmml" xref="S3.E6.m1.4.4.3"><csymbol cd="ambiguous" id="S3.E6.m1.4.4.3.1.cmml" xref="S3.E6.m1.4.4.3">subscript</csymbol><apply id="S3.E6.m1.4.4.3.2.cmml" xref="S3.E6.m1.4.4.3.2"><times id="S3.E6.m1.4.4.3.2.1.cmml" xref="S3.E6.m1.4.4.3.2.1"></times><ci id="S3.E6.m1.4.4.3.2.2.cmml" xref="S3.E6.m1.4.4.3.2.2">arg</ci><ci id="S3.E6.m1.4.4.3.2.3.cmml" xref="S3.E6.m1.4.4.3.2.3">min</ci></apply><ci id="S3.E6.m1.4.4.3.3.cmml" xref="S3.E6.m1.4.4.3.3">𝜃</ci></apply><apply id="S3.E6.m1.4.4.1.cmml" xref="S3.E6.m1.4.4.1"><apply id="S3.E6.m1.4.4.1.2.cmml" xref="S3.E6.m1.4.4.1.2"><csymbol cd="ambiguous" id="S3.E6.m1.4.4.1.2.1.cmml" xref="S3.E6.m1.4.4.1.2">subscript</csymbol><sum id="S3.E6.m1.4.4.1.2.2.cmml" xref="S3.E6.m1.4.4.1.2.2"></sum><list id="S3.E6.m1.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.2"><apply id="S3.E6.m1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E6.m1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.E6.m1.2.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E6.m1.2.2.2.2.2.1.cmml" xref="S3.E6.m1.2.2.2.2.2">subscript</csymbol><ci id="S3.E6.m1.2.2.2.2.2.2.cmml" xref="S3.E6.m1.2.2.2.2.2.2">Δ</ci><ci id="S3.E6.m1.2.2.2.2.2.3.cmml" xref="S3.E6.m1.2.2.2.2.2.3">𝑖</ci></apply></list></apply><apply id="S3.E6.m1.4.4.1.1.cmml" xref="S3.E6.m1.4.4.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.4.4.1.1.2.cmml" xref="S3.E6.m1.4.4.1.1">superscript</csymbol><apply id="S3.E6.m1.4.4.1.1.1.cmml" xref="S3.E6.m1.4.4.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.4.4.1.1.1.2.cmml" xref="S3.E6.m1.4.4.1.1">subscript</csymbol><apply id="S3.E6.m1.4.4.1.1.1.1.2.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1"><csymbol cd="latexml" id="S3.E6.m1.4.4.1.1.1.1.2.1.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.2">norm</csymbol><apply id="S3.E6.m1.4.4.1.1.1.1.1.1.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1"><minus id="S3.E6.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.2"></minus><apply id="S3.E6.m1.4.4.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E6.m1.4.4.1.1.1.1.1.1.3.1.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.E6.m1.4.4.1.1.1.1.1.1.3.2.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.3.2">𝚫</ci><ci id="S3.E6.m1.4.4.1.1.1.1.1.1.3.3.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.3.3">𝑖</ci></apply><apply id="S3.E6.m1.4.4.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1"><times id="S3.E6.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.2"></times><apply id="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.3"><ci id="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.1.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.1">^</ci><ci id="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.2.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.3.2">𝚫</ci></apply><list id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1"><apply id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E6.m1.4.4.1.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply><ci id="S3.E6.m1.3.3.cmml" xref="S3.E6.m1.3.3">𝜃</ci></list></apply></apply></apply><cn id="S3.E6.m1.4.4.1.1.1.3.cmml" type="integer" xref="S3.E6.m1.4.4.1.1.1.3">2</cn></apply><cn id="S3.E6.m1.4.4.1.1.3.cmml" type="integer" xref="S3.E6.m1.4.4.1.1.3">2</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E6.m1.4c">\operatorname*{arg\,min}_{\theta}~{}\sum_{x_{i},\Delta_{i}}~{}\|\mathbf{\Delta%
}_{i}-\hat{\mathbf{\Delta}}(x_{i};\theta)\|_{2}^{2}</annotation><annotation encoding="application/x-llamapun" id="S3.E6.m1.4d">start_OPERATOR roman_arg roman_min end_OPERATOR start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT ∑ start_POSTSUBSCRIPT italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , roman_Δ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT ∥ bold_Δ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT - over^ start_ARG bold_Δ end_ARG ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_θ ) ∥ start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(6)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p1.9">where <math alttext="\mathbf{\Delta}_{i}=[\Delta_{i1},\ldots,\Delta_{iB_{\mathrm{max}}}]" class="ltx_Math" display="inline" id="S3.SS1.p1.8.m1.3"><semantics id="S3.SS1.p1.8.m1.3a"><mrow id="S3.SS1.p1.8.m1.3.3" xref="S3.SS1.p1.8.m1.3.3.cmml"><msub id="S3.SS1.p1.8.m1.3.3.4" xref="S3.SS1.p1.8.m1.3.3.4.cmml"><mi id="S3.SS1.p1.8.m1.3.3.4.2" xref="S3.SS1.p1.8.m1.3.3.4.2.cmml">𝚫</mi><mi id="S3.SS1.p1.8.m1.3.3.4.3" xref="S3.SS1.p1.8.m1.3.3.4.3.cmml">i</mi></msub><mo id="S3.SS1.p1.8.m1.3.3.3" xref="S3.SS1.p1.8.m1.3.3.3.cmml">=</mo><mrow id="S3.SS1.p1.8.m1.3.3.2.2" xref="S3.SS1.p1.8.m1.3.3.2.3.cmml"><mo id="S3.SS1.p1.8.m1.3.3.2.2.3" stretchy="false" xref="S3.SS1.p1.8.m1.3.3.2.3.cmml">[</mo><msub id="S3.SS1.p1.8.m1.2.2.1.1.1" xref="S3.SS1.p1.8.m1.2.2.1.1.1.cmml"><mi id="S3.SS1.p1.8.m1.2.2.1.1.1.2" mathvariant="normal" xref="S3.SS1.p1.8.m1.2.2.1.1.1.2.cmml">Δ</mi><mrow id="S3.SS1.p1.8.m1.2.2.1.1.1.3" xref="S3.SS1.p1.8.m1.2.2.1.1.1.3.cmml"><mi id="S3.SS1.p1.8.m1.2.2.1.1.1.3.2" xref="S3.SS1.p1.8.m1.2.2.1.1.1.3.2.cmml">i</mi><mo id="S3.SS1.p1.8.m1.2.2.1.1.1.3.1" xref="S3.SS1.p1.8.m1.2.2.1.1.1.3.1.cmml">⁢</mo><mn id="S3.SS1.p1.8.m1.2.2.1.1.1.3.3" xref="S3.SS1.p1.8.m1.2.2.1.1.1.3.3.cmml">1</mn></mrow></msub><mo id="S3.SS1.p1.8.m1.3.3.2.2.4" xref="S3.SS1.p1.8.m1.3.3.2.3.cmml">,</mo><mi id="S3.SS1.p1.8.m1.1.1" mathvariant="normal" xref="S3.SS1.p1.8.m1.1.1.cmml">…</mi><mo id="S3.SS1.p1.8.m1.3.3.2.2.5" xref="S3.SS1.p1.8.m1.3.3.2.3.cmml">,</mo><msub id="S3.SS1.p1.8.m1.3.3.2.2.2" xref="S3.SS1.p1.8.m1.3.3.2.2.2.cmml"><mi id="S3.SS1.p1.8.m1.3.3.2.2.2.2" mathvariant="normal" xref="S3.SS1.p1.8.m1.3.3.2.2.2.2.cmml">Δ</mi><mrow id="S3.SS1.p1.8.m1.3.3.2.2.2.3" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.cmml"><mi id="S3.SS1.p1.8.m1.3.3.2.2.2.3.2" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.2.cmml">i</mi><mo id="S3.SS1.p1.8.m1.3.3.2.2.2.3.1" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.1.cmml">⁢</mo><msub id="S3.SS1.p1.8.m1.3.3.2.2.2.3.3" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.cmml"><mi id="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.2" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.2.cmml">B</mi><mi id="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.3" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.3.cmml">max</mi></msub></mrow></msub><mo id="S3.SS1.p1.8.m1.3.3.2.2.6" stretchy="false" xref="S3.SS1.p1.8.m1.3.3.2.3.cmml">]</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.8.m1.3b"><apply id="S3.SS1.p1.8.m1.3.3.cmml" xref="S3.SS1.p1.8.m1.3.3"><eq id="S3.SS1.p1.8.m1.3.3.3.cmml" xref="S3.SS1.p1.8.m1.3.3.3"></eq><apply id="S3.SS1.p1.8.m1.3.3.4.cmml" xref="S3.SS1.p1.8.m1.3.3.4"><csymbol cd="ambiguous" id="S3.SS1.p1.8.m1.3.3.4.1.cmml" xref="S3.SS1.p1.8.m1.3.3.4">subscript</csymbol><ci id="S3.SS1.p1.8.m1.3.3.4.2.cmml" xref="S3.SS1.p1.8.m1.3.3.4.2">𝚫</ci><ci id="S3.SS1.p1.8.m1.3.3.4.3.cmml" xref="S3.SS1.p1.8.m1.3.3.4.3">𝑖</ci></apply><list id="S3.SS1.p1.8.m1.3.3.2.3.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2"><apply id="S3.SS1.p1.8.m1.2.2.1.1.1.cmml" xref="S3.SS1.p1.8.m1.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.8.m1.2.2.1.1.1.1.cmml" xref="S3.SS1.p1.8.m1.2.2.1.1.1">subscript</csymbol><ci id="S3.SS1.p1.8.m1.2.2.1.1.1.2.cmml" xref="S3.SS1.p1.8.m1.2.2.1.1.1.2">Δ</ci><apply id="S3.SS1.p1.8.m1.2.2.1.1.1.3.cmml" xref="S3.SS1.p1.8.m1.2.2.1.1.1.3"><times id="S3.SS1.p1.8.m1.2.2.1.1.1.3.1.cmml" xref="S3.SS1.p1.8.m1.2.2.1.1.1.3.1"></times><ci id="S3.SS1.p1.8.m1.2.2.1.1.1.3.2.cmml" xref="S3.SS1.p1.8.m1.2.2.1.1.1.3.2">𝑖</ci><cn id="S3.SS1.p1.8.m1.2.2.1.1.1.3.3.cmml" type="integer" xref="S3.SS1.p1.8.m1.2.2.1.1.1.3.3">1</cn></apply></apply><ci id="S3.SS1.p1.8.m1.1.1.cmml" xref="S3.SS1.p1.8.m1.1.1">…</ci><apply id="S3.SS1.p1.8.m1.3.3.2.2.2.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.8.m1.3.3.2.2.2.1.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2">subscript</csymbol><ci id="S3.SS1.p1.8.m1.3.3.2.2.2.2.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2.2">Δ</ci><apply id="S3.SS1.p1.8.m1.3.3.2.2.2.3.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3"><times id="S3.SS1.p1.8.m1.3.3.2.2.2.3.1.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.1"></times><ci id="S3.SS1.p1.8.m1.3.3.2.2.2.3.2.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.2">𝑖</ci><apply id="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.3"><csymbol cd="ambiguous" id="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.1.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.3">subscript</csymbol><ci id="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.2.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.2">𝐵</ci><ci id="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.3.cmml" xref="S3.SS1.p1.8.m1.3.3.2.2.2.3.3.3">max</ci></apply></apply></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.8.m1.3c">\mathbf{\Delta}_{i}=[\Delta_{i1},\ldots,\Delta_{iB_{\mathrm{max}}}]</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.8.m1.3d">bold_Δ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = [ roman_Δ start_POSTSUBSCRIPT italic_i 1 end_POSTSUBSCRIPT , … , roman_Δ start_POSTSUBSCRIPT italic_i italic_B start_POSTSUBSCRIPT roman_max end_POSTSUBSCRIPT end_POSTSUBSCRIPT ]</annotation></semantics></math> is the vector of empirical marginal rewards for the query <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS1.p1.9.m2.1"><semantics id="S3.SS1.p1.9.m2.1a"><msub id="S3.SS1.p1.9.m2.1.1" xref="S3.SS1.p1.9.m2.1.1.cmml"><mi id="S3.SS1.p1.9.m2.1.1.2" xref="S3.SS1.p1.9.m2.1.1.2.cmml">x</mi><mi id="S3.SS1.p1.9.m2.1.1.3" xref="S3.SS1.p1.9.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.9.m2.1b"><apply id="S3.SS1.p1.9.m2.1.1.cmml" xref="S3.SS1.p1.9.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.9.m2.1.1.1.cmml" xref="S3.SS1.p1.9.m2.1.1">subscript</csymbol><ci id="S3.SS1.p1.9.m2.1.1.2.cmml" xref="S3.SS1.p1.9.m2.1.1.2">𝑥</ci><ci id="S3.SS1.p1.9.m2.1.1.3.cmml" xref="S3.SS1.p1.9.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.9.m2.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.9.m2.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. While training this model requires sampling from the LM at many budgets to obtain supervision, it can be called during inference without generating any outputs at all.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.2">We explore two simple parameterizations of <math alttext="\hat{\mathbf{\Delta}}" class="ltx_Math" display="inline" id="S3.SS1.p2.1.m1.1"><semantics id="S3.SS1.p2.1.m1.1a"><mover accent="true" id="S3.SS1.p2.1.m1.1.1" xref="S3.SS1.p2.1.m1.1.1.cmml"><mi id="S3.SS1.p2.1.m1.1.1.2" xref="S3.SS1.p2.1.m1.1.1.2.cmml">𝚫</mi><mo id="S3.SS1.p2.1.m1.1.1.1" xref="S3.SS1.p2.1.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.1.m1.1b"><apply id="S3.SS1.p2.1.m1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1"><ci id="S3.SS1.p2.1.m1.1.1.1.cmml" xref="S3.SS1.p2.1.m1.1.1.1">^</ci><ci id="S3.SS1.p2.1.m1.1.1.2.cmml" xref="S3.SS1.p2.1.m1.1.1.2">𝚫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.1.m1.1c">\hat{\mathbf{\Delta}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.1.m1.1d">over^ start_ARG bold_Δ end_ARG</annotation></semantics></math>: (1) a two-layer MLP that takes last the hidden state of the base LM <math alttext="p" class="ltx_Math" display="inline" id="S3.SS1.p2.2.m2.1"><semantics id="S3.SS1.p2.2.m2.1a"><mi id="S3.SS1.p2.2.m2.1.1" xref="S3.SS1.p2.2.m2.1.1.cmml">p</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p2.2.m2.1b"><ci id="S3.SS1.p2.2.m2.1.1.cmml" xref="S3.SS1.p2.2.m2.1.1">𝑝</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p2.2.m2.1c">p</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p2.2.m2.1d">italic_p</annotation></semantics></math> (obtained by encoding the query) as input, and (2) parameter-efficient fine-tuning of the base LM with LoRA <cite class="ltx_cite ltx_citemacro_citep">(Hu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib12" title="">2022</a>)</cite>.
During inference, the MLP variant adds extremely little overhead as its input are hidden states that are already computed as part of decoding procedure.
The LoRA variant is slightly more expensive; however, its overhead is also negligible, as the primary bottleneck during inference occurs when decoding outputs rather than encoding queries.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Allocating Computation</h3>
<figure class="ltx_figure" id="S3.F2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="157" id="S3.F2.g1" src="x2.png" width="548"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span><span class="ltx_text ltx_font_bold" id="S3.F2.8.1">Method overview</span>. In the first step, the marginal reward predictor is used to estimate the marginal reward gains for a batch of queries. In the second step, the allocation algorithm uses these predictions to assign compute budgets to individual queries.
The simple query <span class="ltx_text ltx_font_italic" id="S3.F2.9.2">what is your name?</span> is allocated a budget of <math alttext="1" class="ltx_Math" display="inline" id="S3.F2.3.m1.1"><semantics id="S3.F2.3.m1.1b"><mn id="S3.F2.3.m1.1.1" xref="S3.F2.3.m1.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S3.F2.3.m1.1c"><cn id="S3.F2.3.m1.1.1.cmml" type="integer" xref="S3.F2.3.m1.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S3.F2.3.m1.1d">1</annotation><annotation encoding="application/x-llamapun" id="S3.F2.3.m1.1e">1</annotation></semantics></math>, while the harder query <span class="ltx_text ltx_font_italic" id="S3.F2.10.3">balance a binary tree</span> is allocated a budget of <math alttext="2" class="ltx_Math" display="inline" id="S3.F2.4.m2.1"><semantics id="S3.F2.4.m2.1b"><mn id="S3.F2.4.m2.1.1" xref="S3.F2.4.m2.1.1.cmml">2</mn><annotation-xml encoding="MathML-Content" id="S3.F2.4.m2.1c"><cn id="S3.F2.4.m2.1.1.cmml" type="integer" xref="S3.F2.4.m2.1.1">2</cn></annotation-xml><annotation encoding="application/x-tex" id="S3.F2.4.m2.1d">2</annotation><annotation encoding="application/x-llamapun" id="S3.F2.4.m2.1e">2</annotation></semantics></math>.
</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.4"><a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.E5" title="In 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">5</span></a> is an integer linear program, but in fact has a very special form that allows it to be solved in <math alttext="O(B_{\mathrm{max}}\cdot n)" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><mrow id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml"><mi id="S3.SS2.p1.1.m1.1.1.3" xref="S3.SS2.p1.1.m1.1.1.3.cmml">O</mi><mo id="S3.SS2.p1.1.m1.1.1.2" xref="S3.SS2.p1.1.m1.1.1.2.cmml">⁢</mo><mrow id="S3.SS2.p1.1.m1.1.1.1.1" xref="S3.SS2.p1.1.m1.1.1.1.1.1.cmml"><mo id="S3.SS2.p1.1.m1.1.1.1.1.2" stretchy="false" xref="S3.SS2.p1.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS2.p1.1.m1.1.1.1.1.1" xref="S3.SS2.p1.1.m1.1.1.1.1.1.cmml"><msub id="S3.SS2.p1.1.m1.1.1.1.1.1.2" xref="S3.SS2.p1.1.m1.1.1.1.1.1.2.cmml"><mi id="S3.SS2.p1.1.m1.1.1.1.1.1.2.2" xref="S3.SS2.p1.1.m1.1.1.1.1.1.2.2.cmml">B</mi><mi id="S3.SS2.p1.1.m1.1.1.1.1.1.2.3" xref="S3.SS2.p1.1.m1.1.1.1.1.1.2.3.cmml">max</mi></msub><mo id="S3.SS2.p1.1.m1.1.1.1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS2.p1.1.m1.1.1.1.1.1.1.cmml">⋅</mo><mi id="S3.SS2.p1.1.m1.1.1.1.1.1.3" xref="S3.SS2.p1.1.m1.1.1.1.1.1.3.cmml">n</mi></mrow><mo id="S3.SS2.p1.1.m1.1.1.1.1.3" stretchy="false" xref="S3.SS2.p1.1.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><apply id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1"><times id="S3.SS2.p1.1.m1.1.1.2.cmml" xref="S3.SS2.p1.1.m1.1.1.2"></times><ci id="S3.SS2.p1.1.m1.1.1.3.cmml" xref="S3.SS2.p1.1.m1.1.1.3">𝑂</ci><apply id="S3.SS2.p1.1.m1.1.1.1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1.1.1"><ci id="S3.SS2.p1.1.m1.1.1.1.1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1.1.1.1.1">⋅</ci><apply id="S3.SS2.p1.1.m1.1.1.1.1.1.2.cmml" xref="S3.SS2.p1.1.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.p1.1.m1.1.1.1.1.1.2.1.cmml" xref="S3.SS2.p1.1.m1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.SS2.p1.1.m1.1.1.1.1.1.2.2.cmml" xref="S3.SS2.p1.1.m1.1.1.1.1.1.2.2">𝐵</ci><ci id="S3.SS2.p1.1.m1.1.1.1.1.1.2.3.cmml" xref="S3.SS2.p1.1.m1.1.1.1.1.1.2.3">max</ci></apply><ci id="S3.SS2.p1.1.m1.1.1.1.1.1.3.cmml" xref="S3.SS2.p1.1.m1.1.1.1.1.1.3">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">O(B_{\mathrm{max}}\cdot n)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">italic_O ( italic_B start_POSTSUBSCRIPT roman_max end_POSTSUBSCRIPT ⋅ italic_n )</annotation></semantics></math> time using a greedy algorithm that incrementally “turns on” <math alttext="c_{ij}" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1"><semantics id="S3.SS2.p1.2.m2.1a"><msub id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml"><mi id="S3.SS2.p1.2.m2.1.1.2" xref="S3.SS2.p1.2.m2.1.1.2.cmml">c</mi><mrow id="S3.SS2.p1.2.m2.1.1.3" xref="S3.SS2.p1.2.m2.1.1.3.cmml"><mi id="S3.SS2.p1.2.m2.1.1.3.2" xref="S3.SS2.p1.2.m2.1.1.3.2.cmml">i</mi><mo id="S3.SS2.p1.2.m2.1.1.3.1" xref="S3.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.2.m2.1.1.3.3" xref="S3.SS2.p1.2.m2.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><apply id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.2.m2.1.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p1.2.m2.1.1.2.cmml" xref="S3.SS2.p1.2.m2.1.1.2">𝑐</ci><apply id="S3.SS2.p1.2.m2.1.1.3.cmml" xref="S3.SS2.p1.2.m2.1.1.3"><times id="S3.SS2.p1.2.m2.1.1.3.1.cmml" xref="S3.SS2.p1.2.m2.1.1.3.1"></times><ci id="S3.SS2.p1.2.m2.1.1.3.2.cmml" xref="S3.SS2.p1.2.m2.1.1.3.2">𝑖</ci><ci id="S3.SS2.p1.2.m2.1.1.3.3.cmml" xref="S3.SS2.p1.2.m2.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">c_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.2.m2.1d">italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math> for which <math alttext="\Delta_{ij}" class="ltx_Math" display="inline" id="S3.SS2.p1.3.m3.1"><semantics id="S3.SS2.p1.3.m3.1a"><msub id="S3.SS2.p1.3.m3.1.1" xref="S3.SS2.p1.3.m3.1.1.cmml"><mi id="S3.SS2.p1.3.m3.1.1.2" mathvariant="normal" xref="S3.SS2.p1.3.m3.1.1.2.cmml">Δ</mi><mrow id="S3.SS2.p1.3.m3.1.1.3" xref="S3.SS2.p1.3.m3.1.1.3.cmml"><mi id="S3.SS2.p1.3.m3.1.1.3.2" xref="S3.SS2.p1.3.m3.1.1.3.2.cmml">i</mi><mo id="S3.SS2.p1.3.m3.1.1.3.1" xref="S3.SS2.p1.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.3.m3.1.1.3.3" xref="S3.SS2.p1.3.m3.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.3.m3.1b"><apply id="S3.SS2.p1.3.m3.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1">subscript</csymbol><ci id="S3.SS2.p1.3.m3.1.1.2.cmml" xref="S3.SS2.p1.3.m3.1.1.2">Δ</ci><apply id="S3.SS2.p1.3.m3.1.1.3.cmml" xref="S3.SS2.p1.3.m3.1.1.3"><times id="S3.SS2.p1.3.m3.1.1.3.1.cmml" xref="S3.SS2.p1.3.m3.1.1.3.1"></times><ci id="S3.SS2.p1.3.m3.1.1.3.2.cmml" xref="S3.SS2.p1.3.m3.1.1.3.2">𝑖</ci><ci id="S3.SS2.p1.3.m3.1.1.3.3.cmml" xref="S3.SS2.p1.3.m3.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.3.m3.1c">\Delta_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.3.m3.1d">roman_Δ start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math> is largest. (Formally, the feasible sets of <math alttext="c_{ij}" class="ltx_Math" display="inline" id="S3.SS2.p1.4.m4.1"><semantics id="S3.SS2.p1.4.m4.1a"><msub id="S3.SS2.p1.4.m4.1.1" xref="S3.SS2.p1.4.m4.1.1.cmml"><mi id="S3.SS2.p1.4.m4.1.1.2" xref="S3.SS2.p1.4.m4.1.1.2.cmml">c</mi><mrow id="S3.SS2.p1.4.m4.1.1.3" xref="S3.SS2.p1.4.m4.1.1.3.cmml"><mi id="S3.SS2.p1.4.m4.1.1.3.2" xref="S3.SS2.p1.4.m4.1.1.3.2.cmml">i</mi><mo id="S3.SS2.p1.4.m4.1.1.3.1" xref="S3.SS2.p1.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p1.4.m4.1.1.3.3" xref="S3.SS2.p1.4.m4.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.4.m4.1b"><apply id="S3.SS2.p1.4.m4.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.4.m4.1.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p1.4.m4.1.1.2.cmml" xref="S3.SS2.p1.4.m4.1.1.2">𝑐</ci><apply id="S3.SS2.p1.4.m4.1.1.3.cmml" xref="S3.SS2.p1.4.m4.1.1.3"><times id="S3.SS2.p1.4.m4.1.1.3.1.cmml" xref="S3.SS2.p1.4.m4.1.1.3.1"></times><ci id="S3.SS2.p1.4.m4.1.1.3.2.cmml" xref="S3.SS2.p1.4.m4.1.1.3.2">𝑖</ci><ci id="S3.SS2.p1.4.m4.1.1.3.3.cmml" xref="S3.SS2.p1.4.m4.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.4.m4.1c">c_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.4.m4.1d">italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math> form a matroid, <cite class="ltx_cite ltx_citemacro_citep">Edmonds, <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib7" title="">1971</a></cite>, so this greedy procedure is guaranteed to find an optimum.) We exploit this property in two ways:</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.5"><span class="ltx_text ltx_font_bold" id="S3.SS2.p2.5.1">Online allocation:</span> If queries <math alttext="\{x_{i}\}" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><mrow id="S3.SS2.p2.1.m1.1.1.1" xref="S3.SS2.p2.1.m1.1.1.2.cmml"><mo id="S3.SS2.p2.1.m1.1.1.1.2" stretchy="false" xref="S3.SS2.p2.1.m1.1.1.2.cmml">{</mo><msub id="S3.SS2.p2.1.m1.1.1.1.1" xref="S3.SS2.p2.1.m1.1.1.1.1.cmml"><mi id="S3.SS2.p2.1.m1.1.1.1.1.2" xref="S3.SS2.p2.1.m1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS2.p2.1.m1.1.1.1.1.3" xref="S3.SS2.p2.1.m1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS2.p2.1.m1.1.1.1.3" stretchy="false" xref="S3.SS2.p2.1.m1.1.1.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><set id="S3.SS2.p2.1.m1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.1"><apply id="S3.SS2.p2.1.m1.1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.1.m1.1.1.1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p2.1.m1.1.1.1.1.2.cmml" xref="S3.SS2.p2.1.m1.1.1.1.1.2">𝑥</ci><ci id="S3.SS2.p2.1.m1.1.1.1.1.3.cmml" xref="S3.SS2.p2.1.m1.1.1.1.1.3">𝑖</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">\{x_{i}\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">{ italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT }</annotation></semantics></math> are known <em class="ltx_emph ltx_font_italic" id="S3.SS2.p2.5.2">a priori</em>,
we simply replace each <math alttext="\Delta_{ij}" class="ltx_Math" display="inline" id="S3.SS2.p2.2.m2.1"><semantics id="S3.SS2.p2.2.m2.1a"><msub id="S3.SS2.p2.2.m2.1.1" xref="S3.SS2.p2.2.m2.1.1.cmml"><mi id="S3.SS2.p2.2.m2.1.1.2" mathvariant="normal" xref="S3.SS2.p2.2.m2.1.1.2.cmml">Δ</mi><mrow id="S3.SS2.p2.2.m2.1.1.3" xref="S3.SS2.p2.2.m2.1.1.3.cmml"><mi id="S3.SS2.p2.2.m2.1.1.3.2" xref="S3.SS2.p2.2.m2.1.1.3.2.cmml">i</mi><mo id="S3.SS2.p2.2.m2.1.1.3.1" xref="S3.SS2.p2.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.2.m2.1.1.3.3" xref="S3.SS2.p2.2.m2.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b"><apply id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.2.m2.1.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">subscript</csymbol><ci id="S3.SS2.p2.2.m2.1.1.2.cmml" xref="S3.SS2.p2.2.m2.1.1.2">Δ</ci><apply id="S3.SS2.p2.2.m2.1.1.3.cmml" xref="S3.SS2.p2.2.m2.1.1.3"><times id="S3.SS2.p2.2.m2.1.1.3.1.cmml" xref="S3.SS2.p2.2.m2.1.1.3.1"></times><ci id="S3.SS2.p2.2.m2.1.1.3.2.cmml" xref="S3.SS2.p2.2.m2.1.1.3.2">𝑖</ci><ci id="S3.SS2.p2.2.m2.1.1.3.3.cmml" xref="S3.SS2.p2.2.m2.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">\Delta_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.2.m2.1d">roman_Δ start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math> in <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.E5" title="In 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">5</span></a> with the corresponding estimate from <math alttext="\hat{\mathbf{\Delta}}(x_{i};\theta)" class="ltx_Math" display="inline" id="S3.SS2.p2.3.m3.2"><semantics id="S3.SS2.p2.3.m3.2a"><mrow id="S3.SS2.p2.3.m3.2.2" xref="S3.SS2.p2.3.m3.2.2.cmml"><mover accent="true" id="S3.SS2.p2.3.m3.2.2.3" xref="S3.SS2.p2.3.m3.2.2.3.cmml"><mi id="S3.SS2.p2.3.m3.2.2.3.2" xref="S3.SS2.p2.3.m3.2.2.3.2.cmml">𝚫</mi><mo id="S3.SS2.p2.3.m3.2.2.3.1" xref="S3.SS2.p2.3.m3.2.2.3.1.cmml">^</mo></mover><mo id="S3.SS2.p2.3.m3.2.2.2" xref="S3.SS2.p2.3.m3.2.2.2.cmml">⁢</mo><mrow id="S3.SS2.p2.3.m3.2.2.1.1" xref="S3.SS2.p2.3.m3.2.2.1.2.cmml"><mo id="S3.SS2.p2.3.m3.2.2.1.1.2" stretchy="false" xref="S3.SS2.p2.3.m3.2.2.1.2.cmml">(</mo><msub id="S3.SS2.p2.3.m3.2.2.1.1.1" xref="S3.SS2.p2.3.m3.2.2.1.1.1.cmml"><mi id="S3.SS2.p2.3.m3.2.2.1.1.1.2" xref="S3.SS2.p2.3.m3.2.2.1.1.1.2.cmml">x</mi><mi id="S3.SS2.p2.3.m3.2.2.1.1.1.3" xref="S3.SS2.p2.3.m3.2.2.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS2.p2.3.m3.2.2.1.1.3" xref="S3.SS2.p2.3.m3.2.2.1.2.cmml">;</mo><mi id="S3.SS2.p2.3.m3.1.1" xref="S3.SS2.p2.3.m3.1.1.cmml">θ</mi><mo id="S3.SS2.p2.3.m3.2.2.1.1.4" stretchy="false" xref="S3.SS2.p2.3.m3.2.2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.3.m3.2b"><apply id="S3.SS2.p2.3.m3.2.2.cmml" xref="S3.SS2.p2.3.m3.2.2"><times id="S3.SS2.p2.3.m3.2.2.2.cmml" xref="S3.SS2.p2.3.m3.2.2.2"></times><apply id="S3.SS2.p2.3.m3.2.2.3.cmml" xref="S3.SS2.p2.3.m3.2.2.3"><ci id="S3.SS2.p2.3.m3.2.2.3.1.cmml" xref="S3.SS2.p2.3.m3.2.2.3.1">^</ci><ci id="S3.SS2.p2.3.m3.2.2.3.2.cmml" xref="S3.SS2.p2.3.m3.2.2.3.2">𝚫</ci></apply><list id="S3.SS2.p2.3.m3.2.2.1.2.cmml" xref="S3.SS2.p2.3.m3.2.2.1.1"><apply id="S3.SS2.p2.3.m3.2.2.1.1.1.cmml" xref="S3.SS2.p2.3.m3.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.3.m3.2.2.1.1.1.1.cmml" xref="S3.SS2.p2.3.m3.2.2.1.1.1">subscript</csymbol><ci id="S3.SS2.p2.3.m3.2.2.1.1.1.2.cmml" xref="S3.SS2.p2.3.m3.2.2.1.1.1.2">𝑥</ci><ci id="S3.SS2.p2.3.m3.2.2.1.1.1.3.cmml" xref="S3.SS2.p2.3.m3.2.2.1.1.1.3">𝑖</ci></apply><ci id="S3.SS2.p2.3.m3.1.1.cmml" xref="S3.SS2.p2.3.m3.1.1">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.3.m3.2c">\hat{\mathbf{\Delta}}(x_{i};\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.3.m3.2d">over^ start_ARG bold_Δ end_ARG ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_θ )</annotation></semantics></math>, solve for <math alttext="c_{ij}" class="ltx_Math" display="inline" id="S3.SS2.p2.4.m4.1"><semantics id="S3.SS2.p2.4.m4.1a"><msub id="S3.SS2.p2.4.m4.1.1" xref="S3.SS2.p2.4.m4.1.1.cmml"><mi id="S3.SS2.p2.4.m4.1.1.2" xref="S3.SS2.p2.4.m4.1.1.2.cmml">c</mi><mrow id="S3.SS2.p2.4.m4.1.1.3" xref="S3.SS2.p2.4.m4.1.1.3.cmml"><mi id="S3.SS2.p2.4.m4.1.1.3.2" xref="S3.SS2.p2.4.m4.1.1.3.2.cmml">i</mi><mo id="S3.SS2.p2.4.m4.1.1.3.1" xref="S3.SS2.p2.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.4.m4.1.1.3.3" xref="S3.SS2.p2.4.m4.1.1.3.3.cmml">j</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.4.m4.1b"><apply id="S3.SS2.p2.4.m4.1.1.cmml" xref="S3.SS2.p2.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS2.p2.4.m4.1.1.1.cmml" xref="S3.SS2.p2.4.m4.1.1">subscript</csymbol><ci id="S3.SS2.p2.4.m4.1.1.2.cmml" xref="S3.SS2.p2.4.m4.1.1.2">𝑐</ci><apply id="S3.SS2.p2.4.m4.1.1.3.cmml" xref="S3.SS2.p2.4.m4.1.1.3"><times id="S3.SS2.p2.4.m4.1.1.3.1.cmml" xref="S3.SS2.p2.4.m4.1.1.3.1"></times><ci id="S3.SS2.p2.4.m4.1.1.3.2.cmml" xref="S3.SS2.p2.4.m4.1.1.3.2">𝑖</ci><ci id="S3.SS2.p2.4.m4.1.1.3.3.cmml" xref="S3.SS2.p2.4.m4.1.1.3.3">𝑗</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.4.m4.1c">c_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.4.m4.1d">italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math>, then finally set each <math alttext="b_{i}=\max_{j}c_{ij}" class="ltx_Math" display="inline" id="S3.SS2.p2.5.m5.1"><semantics id="S3.SS2.p2.5.m5.1a"><mrow id="S3.SS2.p2.5.m5.1.1" xref="S3.SS2.p2.5.m5.1.1.cmml"><msub id="S3.SS2.p2.5.m5.1.1.2" xref="S3.SS2.p2.5.m5.1.1.2.cmml"><mi id="S3.SS2.p2.5.m5.1.1.2.2" xref="S3.SS2.p2.5.m5.1.1.2.2.cmml">b</mi><mi id="S3.SS2.p2.5.m5.1.1.2.3" xref="S3.SS2.p2.5.m5.1.1.2.3.cmml">i</mi></msub><mo id="S3.SS2.p2.5.m5.1.1.1" xref="S3.SS2.p2.5.m5.1.1.1.cmml">=</mo><mrow id="S3.SS2.p2.5.m5.1.1.3" xref="S3.SS2.p2.5.m5.1.1.3.cmml"><msub id="S3.SS2.p2.5.m5.1.1.3.1" xref="S3.SS2.p2.5.m5.1.1.3.1.cmml"><mi id="S3.SS2.p2.5.m5.1.1.3.1.2" xref="S3.SS2.p2.5.m5.1.1.3.1.2.cmml">max</mi><mi id="S3.SS2.p2.5.m5.1.1.3.1.3" xref="S3.SS2.p2.5.m5.1.1.3.1.3.cmml">j</mi></msub><mo id="S3.SS2.p2.5.m5.1.1.3a" lspace="0.167em" xref="S3.SS2.p2.5.m5.1.1.3.cmml">⁡</mo><msub id="S3.SS2.p2.5.m5.1.1.3.2" xref="S3.SS2.p2.5.m5.1.1.3.2.cmml"><mi id="S3.SS2.p2.5.m5.1.1.3.2.2" xref="S3.SS2.p2.5.m5.1.1.3.2.2.cmml">c</mi><mrow id="S3.SS2.p2.5.m5.1.1.3.2.3" xref="S3.SS2.p2.5.m5.1.1.3.2.3.cmml"><mi id="S3.SS2.p2.5.m5.1.1.3.2.3.2" xref="S3.SS2.p2.5.m5.1.1.3.2.3.2.cmml">i</mi><mo id="S3.SS2.p2.5.m5.1.1.3.2.3.1" xref="S3.SS2.p2.5.m5.1.1.3.2.3.1.cmml">⁢</mo><mi id="S3.SS2.p2.5.m5.1.1.3.2.3.3" xref="S3.SS2.p2.5.m5.1.1.3.2.3.3.cmml">j</mi></mrow></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.5.m5.1b"><apply id="S3.SS2.p2.5.m5.1.1.cmml" xref="S3.SS2.p2.5.m5.1.1"><eq id="S3.SS2.p2.5.m5.1.1.1.cmml" xref="S3.SS2.p2.5.m5.1.1.1"></eq><apply id="S3.SS2.p2.5.m5.1.1.2.cmml" xref="S3.SS2.p2.5.m5.1.1.2"><csymbol cd="ambiguous" id="S3.SS2.p2.5.m5.1.1.2.1.cmml" xref="S3.SS2.p2.5.m5.1.1.2">subscript</csymbol><ci id="S3.SS2.p2.5.m5.1.1.2.2.cmml" xref="S3.SS2.p2.5.m5.1.1.2.2">𝑏</ci><ci id="S3.SS2.p2.5.m5.1.1.2.3.cmml" xref="S3.SS2.p2.5.m5.1.1.2.3">𝑖</ci></apply><apply id="S3.SS2.p2.5.m5.1.1.3.cmml" xref="S3.SS2.p2.5.m5.1.1.3"><apply id="S3.SS2.p2.5.m5.1.1.3.1.cmml" xref="S3.SS2.p2.5.m5.1.1.3.1"><csymbol cd="ambiguous" id="S3.SS2.p2.5.m5.1.1.3.1.1.cmml" xref="S3.SS2.p2.5.m5.1.1.3.1">subscript</csymbol><max id="S3.SS2.p2.5.m5.1.1.3.1.2.cmml" xref="S3.SS2.p2.5.m5.1.1.3.1.2"></max><ci id="S3.SS2.p2.5.m5.1.1.3.1.3.cmml" xref="S3.SS2.p2.5.m5.1.1.3.1.3">𝑗</ci></apply><apply id="S3.SS2.p2.5.m5.1.1.3.2.cmml" xref="S3.SS2.p2.5.m5.1.1.3.2"><csymbol cd="ambiguous" id="S3.SS2.p2.5.m5.1.1.3.2.1.cmml" xref="S3.SS2.p2.5.m5.1.1.3.2">subscript</csymbol><ci id="S3.SS2.p2.5.m5.1.1.3.2.2.cmml" xref="S3.SS2.p2.5.m5.1.1.3.2.2">𝑐</ci><apply id="S3.SS2.p2.5.m5.1.1.3.2.3.cmml" xref="S3.SS2.p2.5.m5.1.1.3.2.3"><times id="S3.SS2.p2.5.m5.1.1.3.2.3.1.cmml" xref="S3.SS2.p2.5.m5.1.1.3.2.3.1"></times><ci id="S3.SS2.p2.5.m5.1.1.3.2.3.2.cmml" xref="S3.SS2.p2.5.m5.1.1.3.2.3.2">𝑖</ci><ci id="S3.SS2.p2.5.m5.1.1.3.2.3.3.cmml" xref="S3.SS2.p2.5.m5.1.1.3.2.3.3">𝑗</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.5.m5.1c">b_{i}=\max_{j}c_{ij}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.5.m5.1d">italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = roman_max start_POSTSUBSCRIPT italic_j end_POSTSUBSCRIPT italic_c start_POSTSUBSCRIPT italic_i italic_j end_POSTSUBSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p3">
<p class="ltx_p" id="S3.SS2.p3.1">One drawback of this procedure is that responses must be processed in a batch. However, in some cases it is also possible to effectively set budgets independently for each <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS2.p3.1.m1.1"><semantics id="S3.SS2.p3.1.m1.1a"><msub id="S3.SS2.p3.1.m1.1.1" xref="S3.SS2.p3.1.m1.1.1.cmml"><mi id="S3.SS2.p3.1.m1.1.1.2" xref="S3.SS2.p3.1.m1.1.1.2.cmml">x</mi><mi id="S3.SS2.p3.1.m1.1.1.3" xref="S3.SS2.p3.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p3.1.m1.1b"><apply id="S3.SS2.p3.1.m1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p3.1.m1.1.1.1.cmml" xref="S3.SS2.p3.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p3.1.m1.1.1.2.cmml" xref="S3.SS2.p3.1.m1.1.1.2">𝑥</ci><ci id="S3.SS2.p3.1.m1.1.1.3.cmml" xref="S3.SS2.p3.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p3.1.m1.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p3.1.m1.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>:</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p4">
<p class="ltx_p" id="S3.SS2.p4.1"><span class="ltx_text ltx_font_bold" id="S3.SS2.p4.1.1">Offline allocation:</span>
If allocations must be made without access to a full batch of samples, we construct a fixed allocation policy as follows:</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p5">
<p class="ltx_p" id="S3.SS2.p5.2"><span class="ltx_text ltx_font_bold" id="S3.SS2.p5.2.1">(1)</span> Hold out a subset of the data used for training the reward estimator <math alttext="\hat{\mathbf{\Delta}}" class="ltx_Math" display="inline" id="S3.SS2.p5.1.m1.1"><semantics id="S3.SS2.p5.1.m1.1a"><mover accent="true" id="S3.SS2.p5.1.m1.1.1" xref="S3.SS2.p5.1.m1.1.1.cmml"><mi id="S3.SS2.p5.1.m1.1.1.2" xref="S3.SS2.p5.1.m1.1.1.2.cmml">𝚫</mi><mo id="S3.SS2.p5.1.m1.1.1.1" xref="S3.SS2.p5.1.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.1.m1.1b"><apply id="S3.SS2.p5.1.m1.1.1.cmml" xref="S3.SS2.p5.1.m1.1.1"><ci id="S3.SS2.p5.1.m1.1.1.1.cmml" xref="S3.SS2.p5.1.m1.1.1.1">^</ci><ci id="S3.SS2.p5.1.m1.1.1.2.cmml" xref="S3.SS2.p5.1.m1.1.1.2">𝚫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.1.m1.1c">\hat{\mathbf{\Delta}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.1.m1.1d">over^ start_ARG bold_Δ end_ARG</annotation></semantics></math>, then use it to label queries in this held-out set (e.g. based on the first-sample prediction <math alttext="\hat{\Delta}(x_{i})_{1}" class="ltx_Math" display="inline" id="S3.SS2.p5.2.m2.1"><semantics id="S3.SS2.p5.2.m2.1a"><mrow id="S3.SS2.p5.2.m2.1.1" xref="S3.SS2.p5.2.m2.1.1.cmml"><mover accent="true" id="S3.SS2.p5.2.m2.1.1.3" xref="S3.SS2.p5.2.m2.1.1.3.cmml"><mi id="S3.SS2.p5.2.m2.1.1.3.2" mathvariant="normal" xref="S3.SS2.p5.2.m2.1.1.3.2.cmml">Δ</mi><mo id="S3.SS2.p5.2.m2.1.1.3.1" xref="S3.SS2.p5.2.m2.1.1.3.1.cmml">^</mo></mover><mo id="S3.SS2.p5.2.m2.1.1.2" xref="S3.SS2.p5.2.m2.1.1.2.cmml">⁢</mo><msub id="S3.SS2.p5.2.m2.1.1.1" xref="S3.SS2.p5.2.m2.1.1.1.cmml"><mrow id="S3.SS2.p5.2.m2.1.1.1.1.1" xref="S3.SS2.p5.2.m2.1.1.1.1.1.1.cmml"><mo id="S3.SS2.p5.2.m2.1.1.1.1.1.2" stretchy="false" xref="S3.SS2.p5.2.m2.1.1.1.1.1.1.cmml">(</mo><msub id="S3.SS2.p5.2.m2.1.1.1.1.1.1" xref="S3.SS2.p5.2.m2.1.1.1.1.1.1.cmml"><mi id="S3.SS2.p5.2.m2.1.1.1.1.1.1.2" xref="S3.SS2.p5.2.m2.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS2.p5.2.m2.1.1.1.1.1.1.3" xref="S3.SS2.p5.2.m2.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS2.p5.2.m2.1.1.1.1.1.3" stretchy="false" xref="S3.SS2.p5.2.m2.1.1.1.1.1.1.cmml">)</mo></mrow><mn id="S3.SS2.p5.2.m2.1.1.1.3" xref="S3.SS2.p5.2.m2.1.1.1.3.cmml">1</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p5.2.m2.1b"><apply id="S3.SS2.p5.2.m2.1.1.cmml" xref="S3.SS2.p5.2.m2.1.1"><times id="S3.SS2.p5.2.m2.1.1.2.cmml" xref="S3.SS2.p5.2.m2.1.1.2"></times><apply id="S3.SS2.p5.2.m2.1.1.3.cmml" xref="S3.SS2.p5.2.m2.1.1.3"><ci id="S3.SS2.p5.2.m2.1.1.3.1.cmml" xref="S3.SS2.p5.2.m2.1.1.3.1">^</ci><ci id="S3.SS2.p5.2.m2.1.1.3.2.cmml" xref="S3.SS2.p5.2.m2.1.1.3.2">Δ</ci></apply><apply id="S3.SS2.p5.2.m2.1.1.1.cmml" xref="S3.SS2.p5.2.m2.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p5.2.m2.1.1.1.2.cmml" xref="S3.SS2.p5.2.m2.1.1.1">subscript</csymbol><apply id="S3.SS2.p5.2.m2.1.1.1.1.1.1.cmml" xref="S3.SS2.p5.2.m2.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p5.2.m2.1.1.1.1.1.1.1.cmml" xref="S3.SS2.p5.2.m2.1.1.1.1.1">subscript</csymbol><ci id="S3.SS2.p5.2.m2.1.1.1.1.1.1.2.cmml" xref="S3.SS2.p5.2.m2.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS2.p5.2.m2.1.1.1.1.1.1.3.cmml" xref="S3.SS2.p5.2.m2.1.1.1.1.1.1.3">𝑖</ci></apply><cn id="S3.SS2.p5.2.m2.1.1.1.3.cmml" type="integer" xref="S3.SS2.p5.2.m2.1.1.1.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p5.2.m2.1c">\hat{\Delta}(x_{i})_{1}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p5.2.m2.1d">over^ start_ARG roman_Δ end_ARG ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT</annotation></semantics></math>). Divide these queries into a fixed set of bins according to their predicted marginal rewards.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p6">
<p class="ltx_p" id="S3.SS2.p6.1"><span class="ltx_text ltx_font_bold" id="S3.SS2.p6.1.1">(2)</span> Solve the allocation problem for this held-out as in <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.E5" title="In 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">5</span></a>, with the additional constraint that all queries in a bin receive the same budget allocation.
For each bin, store the assigned budget.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p7">
<p class="ltx_p" id="S3.SS2.p7.1"><span class="ltx_text ltx_font_bold" id="S3.SS2.p7.1.1">(3)</span> During deployment, compute a reward prediction for each <math alttext="x_{i}" class="ltx_Math" display="inline" id="S3.SS2.p7.1.m1.1"><semantics id="S3.SS2.p7.1.m1.1a"><msub id="S3.SS2.p7.1.m1.1.1" xref="S3.SS2.p7.1.m1.1.1.cmml"><mi id="S3.SS2.p7.1.m1.1.1.2" xref="S3.SS2.p7.1.m1.1.1.2.cmml">x</mi><mi id="S3.SS2.p7.1.m1.1.1.3" xref="S3.SS2.p7.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS2.p7.1.m1.1b"><apply id="S3.SS2.p7.1.m1.1.1.cmml" xref="S3.SS2.p7.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p7.1.m1.1.1.1.cmml" xref="S3.SS2.p7.1.m1.1.1">subscript</csymbol><ci id="S3.SS2.p7.1.m1.1.1.2.cmml" xref="S3.SS2.p7.1.m1.1.1.2">𝑥</ci><ci id="S3.SS2.p7.1.m1.1.1.3.cmml" xref="S3.SS2.p7.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p7.1.m1.1c">x_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p7.1.m1.1d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>, map it to a bin, and return the budget associated with that bin.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p8">
<p class="ltx_p" id="S3.SS2.p8.1">During deployment, all queries can be processed independently
(at the risk of a budget violation if the distribution of queries is significantly different from those used to compute the allocation policy).</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>Interesting Special Cases</h3>
<div class="ltx_para ltx_noindent" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.1"><span class="ltx_text ltx_font_bold" id="S3.SS3.p1.1.1">Binary Reward + Best-of-<span class="ltx_text ltx_font_italic" id="S3.SS3.p1.1.1.1">k</span>:</span>
In domains such as <span class="ltx_text ltx_font_bold" id="S3.SS3.p1.1.2">coding</span> and <span class="ltx_text ltx_font_bold" id="S3.SS3.p1.1.3">math</span>, rewards are often binary, indicating success or failure.
For instance, an outcome reward model can be used to assess correctness in math while unit tests indicate correctness in coding.
In such settings, the probability that a single sample from the model succeeds may be used to analytically compute all marginal rewards.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS3.p2">
<p class="ltx_p" id="S3.SS3.p2.6">Let <math alttext="\lambda=\mathbb{E}_{y\sim p(\cdot\mid x)}[r(x,y)]" class="ltx_math_unparsed" display="inline" id="S3.SS3.p2.1.m1.3"><semantics id="S3.SS3.p2.1.m1.3a"><mrow id="S3.SS3.p2.1.m1.3.3"><mi id="S3.SS3.p2.1.m1.3.3.3">λ</mi><mo id="S3.SS3.p2.1.m1.3.3.2">=</mo><mrow id="S3.SS3.p2.1.m1.3.3.1"><msub id="S3.SS3.p2.1.m1.3.3.1.3"><mi id="S3.SS3.p2.1.m1.3.3.1.3.2">𝔼</mi><mrow id="S3.SS3.p2.1.m1.3.3.1.3.3"><mi id="S3.SS3.p2.1.m1.3.3.1.3.3.1">y</mi><mo id="S3.SS3.p2.1.m1.3.3.1.3.3.2">∼</mo><mi id="S3.SS3.p2.1.m1.3.3.1.3.3.3">p</mi><mrow id="S3.SS3.p2.1.m1.3.3.1.3.3.4"><mo id="S3.SS3.p2.1.m1.3.3.1.3.3.4.1" stretchy="false">(</mo><mo id="S3.SS3.p2.1.m1.3.3.1.3.3.4.2" lspace="0em" rspace="0em">⋅</mo><mo id="S3.SS3.p2.1.m1.3.3.1.3.3.4.3" lspace="0em" rspace="0.167em">∣</mo><mi id="S3.SS3.p2.1.m1.3.3.1.3.3.4.4">x</mi><mo id="S3.SS3.p2.1.m1.3.3.1.3.3.4.5" stretchy="false">)</mo></mrow></mrow></msub><mo id="S3.SS3.p2.1.m1.3.3.1.2">⁢</mo><mrow id="S3.SS3.p2.1.m1.3.3.1.1.1"><mo id="S3.SS3.p2.1.m1.3.3.1.1.1.2" stretchy="false">[</mo><mrow id="S3.SS3.p2.1.m1.3.3.1.1.1.1"><mi id="S3.SS3.p2.1.m1.3.3.1.1.1.1.2">r</mi><mo id="S3.SS3.p2.1.m1.3.3.1.1.1.1.1">⁢</mo><mrow id="S3.SS3.p2.1.m1.3.3.1.1.1.1.3.2"><mo id="S3.SS3.p2.1.m1.3.3.1.1.1.1.3.2.1" stretchy="false">(</mo><mi id="S3.SS3.p2.1.m1.1.1">x</mi><mo id="S3.SS3.p2.1.m1.3.3.1.1.1.1.3.2.2">,</mo><mi id="S3.SS3.p2.1.m1.2.2">y</mi><mo id="S3.SS3.p2.1.m1.3.3.1.1.1.1.3.2.3" stretchy="false">)</mo></mrow></mrow><mo id="S3.SS3.p2.1.m1.3.3.1.1.1.3" stretchy="false">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex" id="S3.SS3.p2.1.m1.3b">\lambda=\mathbb{E}_{y\sim p(\cdot\mid x)}[r(x,y)]</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.1.m1.3c">italic_λ = blackboard_E start_POSTSUBSCRIPT italic_y ∼ italic_p ( ⋅ ∣ italic_x ) end_POSTSUBSCRIPT [ italic_r ( italic_x , italic_y ) ]</annotation></semantics></math> denote the probability of obtaining a successful result from a single sample (for <math alttext="r(x,y)\in\{0,1\}" class="ltx_Math" display="inline" id="S3.SS3.p2.2.m2.4"><semantics id="S3.SS3.p2.2.m2.4a"><mrow id="S3.SS3.p2.2.m2.4.5" xref="S3.SS3.p2.2.m2.4.5.cmml"><mrow id="S3.SS3.p2.2.m2.4.5.2" xref="S3.SS3.p2.2.m2.4.5.2.cmml"><mi id="S3.SS3.p2.2.m2.4.5.2.2" xref="S3.SS3.p2.2.m2.4.5.2.2.cmml">r</mi><mo id="S3.SS3.p2.2.m2.4.5.2.1" xref="S3.SS3.p2.2.m2.4.5.2.1.cmml">⁢</mo><mrow id="S3.SS3.p2.2.m2.4.5.2.3.2" xref="S3.SS3.p2.2.m2.4.5.2.3.1.cmml"><mo id="S3.SS3.p2.2.m2.4.5.2.3.2.1" stretchy="false" xref="S3.SS3.p2.2.m2.4.5.2.3.1.cmml">(</mo><mi id="S3.SS3.p2.2.m2.1.1" xref="S3.SS3.p2.2.m2.1.1.cmml">x</mi><mo id="S3.SS3.p2.2.m2.4.5.2.3.2.2" xref="S3.SS3.p2.2.m2.4.5.2.3.1.cmml">,</mo><mi id="S3.SS3.p2.2.m2.2.2" xref="S3.SS3.p2.2.m2.2.2.cmml">y</mi><mo id="S3.SS3.p2.2.m2.4.5.2.3.2.3" stretchy="false" xref="S3.SS3.p2.2.m2.4.5.2.3.1.cmml">)</mo></mrow></mrow><mo id="S3.SS3.p2.2.m2.4.5.1" xref="S3.SS3.p2.2.m2.4.5.1.cmml">∈</mo><mrow id="S3.SS3.p2.2.m2.4.5.3.2" xref="S3.SS3.p2.2.m2.4.5.3.1.cmml"><mo id="S3.SS3.p2.2.m2.4.5.3.2.1" stretchy="false" xref="S3.SS3.p2.2.m2.4.5.3.1.cmml">{</mo><mn id="S3.SS3.p2.2.m2.3.3" xref="S3.SS3.p2.2.m2.3.3.cmml">0</mn><mo id="S3.SS3.p2.2.m2.4.5.3.2.2" xref="S3.SS3.p2.2.m2.4.5.3.1.cmml">,</mo><mn id="S3.SS3.p2.2.m2.4.4" xref="S3.SS3.p2.2.m2.4.4.cmml">1</mn><mo id="S3.SS3.p2.2.m2.4.5.3.2.3" stretchy="false" xref="S3.SS3.p2.2.m2.4.5.3.1.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.2.m2.4b"><apply id="S3.SS3.p2.2.m2.4.5.cmml" xref="S3.SS3.p2.2.m2.4.5"><in id="S3.SS3.p2.2.m2.4.5.1.cmml" xref="S3.SS3.p2.2.m2.4.5.1"></in><apply id="S3.SS3.p2.2.m2.4.5.2.cmml" xref="S3.SS3.p2.2.m2.4.5.2"><times id="S3.SS3.p2.2.m2.4.5.2.1.cmml" xref="S3.SS3.p2.2.m2.4.5.2.1"></times><ci id="S3.SS3.p2.2.m2.4.5.2.2.cmml" xref="S3.SS3.p2.2.m2.4.5.2.2">𝑟</ci><interval closure="open" id="S3.SS3.p2.2.m2.4.5.2.3.1.cmml" xref="S3.SS3.p2.2.m2.4.5.2.3.2"><ci id="S3.SS3.p2.2.m2.1.1.cmml" xref="S3.SS3.p2.2.m2.1.1">𝑥</ci><ci id="S3.SS3.p2.2.m2.2.2.cmml" xref="S3.SS3.p2.2.m2.2.2">𝑦</ci></interval></apply><set id="S3.SS3.p2.2.m2.4.5.3.1.cmml" xref="S3.SS3.p2.2.m2.4.5.3.2"><cn id="S3.SS3.p2.2.m2.3.3.cmml" type="integer" xref="S3.SS3.p2.2.m2.3.3">0</cn><cn id="S3.SS3.p2.2.m2.4.4.cmml" type="integer" xref="S3.SS3.p2.2.m2.4.4">1</cn></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.2.m2.4c">r(x,y)\in\{0,1\}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.2.m2.4d">italic_r ( italic_x , italic_y ) ∈ { 0 , 1 }</annotation></semantics></math>).
Then the reward estimate <math alttext="q(x,b)" class="ltx_Math" display="inline" id="S3.SS3.p2.3.m3.2"><semantics id="S3.SS3.p2.3.m3.2a"><mrow id="S3.SS3.p2.3.m3.2.3" xref="S3.SS3.p2.3.m3.2.3.cmml"><mi id="S3.SS3.p2.3.m3.2.3.2" xref="S3.SS3.p2.3.m3.2.3.2.cmml">q</mi><mo id="S3.SS3.p2.3.m3.2.3.1" xref="S3.SS3.p2.3.m3.2.3.1.cmml">⁢</mo><mrow id="S3.SS3.p2.3.m3.2.3.3.2" xref="S3.SS3.p2.3.m3.2.3.3.1.cmml"><mo id="S3.SS3.p2.3.m3.2.3.3.2.1" stretchy="false" xref="S3.SS3.p2.3.m3.2.3.3.1.cmml">(</mo><mi id="S3.SS3.p2.3.m3.1.1" xref="S3.SS3.p2.3.m3.1.1.cmml">x</mi><mo id="S3.SS3.p2.3.m3.2.3.3.2.2" xref="S3.SS3.p2.3.m3.2.3.3.1.cmml">,</mo><mi id="S3.SS3.p2.3.m3.2.2" xref="S3.SS3.p2.3.m3.2.2.cmml">b</mi><mo id="S3.SS3.p2.3.m3.2.3.3.2.3" stretchy="false" xref="S3.SS3.p2.3.m3.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.3.m3.2b"><apply id="S3.SS3.p2.3.m3.2.3.cmml" xref="S3.SS3.p2.3.m3.2.3"><times id="S3.SS3.p2.3.m3.2.3.1.cmml" xref="S3.SS3.p2.3.m3.2.3.1"></times><ci id="S3.SS3.p2.3.m3.2.3.2.cmml" xref="S3.SS3.p2.3.m3.2.3.2">𝑞</ci><interval closure="open" id="S3.SS3.p2.3.m3.2.3.3.1.cmml" xref="S3.SS3.p2.3.m3.2.3.3.2"><ci id="S3.SS3.p2.3.m3.1.1.cmml" xref="S3.SS3.p2.3.m3.1.1">𝑥</ci><ci id="S3.SS3.p2.3.m3.2.2.cmml" xref="S3.SS3.p2.3.m3.2.2">𝑏</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.3.m3.2c">q(x,b)</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.3.m3.2d">italic_q ( italic_x , italic_b )</annotation></semantics></math> is simply the probability of getting at least one success in <math alttext="b" class="ltx_Math" display="inline" id="S3.SS3.p2.4.m4.1"><semantics id="S3.SS3.p2.4.m4.1a"><mi id="S3.SS3.p2.4.m4.1.1" xref="S3.SS3.p2.4.m4.1.1.cmml">b</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.4.m4.1b"><ci id="S3.SS3.p2.4.m4.1.1.cmml" xref="S3.SS3.p2.4.m4.1.1">𝑏</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.4.m4.1c">b</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.4.m4.1d">italic_b</annotation></semantics></math> attempts:
<math alttext="q(x,b)=1-(1-\lambda)^{b}" class="ltx_Math" display="inline" id="S3.SS3.p2.5.m5.3"><semantics id="S3.SS3.p2.5.m5.3a"><mrow id="S3.SS3.p2.5.m5.3.3" xref="S3.SS3.p2.5.m5.3.3.cmml"><mrow id="S3.SS3.p2.5.m5.3.3.3" xref="S3.SS3.p2.5.m5.3.3.3.cmml"><mi id="S3.SS3.p2.5.m5.3.3.3.2" xref="S3.SS3.p2.5.m5.3.3.3.2.cmml">q</mi><mo id="S3.SS3.p2.5.m5.3.3.3.1" xref="S3.SS3.p2.5.m5.3.3.3.1.cmml">⁢</mo><mrow id="S3.SS3.p2.5.m5.3.3.3.3.2" xref="S3.SS3.p2.5.m5.3.3.3.3.1.cmml"><mo id="S3.SS3.p2.5.m5.3.3.3.3.2.1" stretchy="false" xref="S3.SS3.p2.5.m5.3.3.3.3.1.cmml">(</mo><mi id="S3.SS3.p2.5.m5.1.1" xref="S3.SS3.p2.5.m5.1.1.cmml">x</mi><mo id="S3.SS3.p2.5.m5.3.3.3.3.2.2" xref="S3.SS3.p2.5.m5.3.3.3.3.1.cmml">,</mo><mi id="S3.SS3.p2.5.m5.2.2" xref="S3.SS3.p2.5.m5.2.2.cmml">b</mi><mo id="S3.SS3.p2.5.m5.3.3.3.3.2.3" stretchy="false" xref="S3.SS3.p2.5.m5.3.3.3.3.1.cmml">)</mo></mrow></mrow><mo id="S3.SS3.p2.5.m5.3.3.2" xref="S3.SS3.p2.5.m5.3.3.2.cmml">=</mo><mrow id="S3.SS3.p2.5.m5.3.3.1" xref="S3.SS3.p2.5.m5.3.3.1.cmml"><mn id="S3.SS3.p2.5.m5.3.3.1.3" xref="S3.SS3.p2.5.m5.3.3.1.3.cmml">1</mn><mo id="S3.SS3.p2.5.m5.3.3.1.2" xref="S3.SS3.p2.5.m5.3.3.1.2.cmml">−</mo><msup id="S3.SS3.p2.5.m5.3.3.1.1" xref="S3.SS3.p2.5.m5.3.3.1.1.cmml"><mrow id="S3.SS3.p2.5.m5.3.3.1.1.1.1" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.cmml"><mo id="S3.SS3.p2.5.m5.3.3.1.1.1.1.2" stretchy="false" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.cmml"><mn id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.2" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.2.cmml">1</mn><mo id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.1" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.1.cmml">−</mo><mi id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.3" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.3.cmml">λ</mi></mrow><mo id="S3.SS3.p2.5.m5.3.3.1.1.1.1.3" stretchy="false" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.cmml">)</mo></mrow><mi id="S3.SS3.p2.5.m5.3.3.1.1.3" xref="S3.SS3.p2.5.m5.3.3.1.1.3.cmml">b</mi></msup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.5.m5.3b"><apply id="S3.SS3.p2.5.m5.3.3.cmml" xref="S3.SS3.p2.5.m5.3.3"><eq id="S3.SS3.p2.5.m5.3.3.2.cmml" xref="S3.SS3.p2.5.m5.3.3.2"></eq><apply id="S3.SS3.p2.5.m5.3.3.3.cmml" xref="S3.SS3.p2.5.m5.3.3.3"><times id="S3.SS3.p2.5.m5.3.3.3.1.cmml" xref="S3.SS3.p2.5.m5.3.3.3.1"></times><ci id="S3.SS3.p2.5.m5.3.3.3.2.cmml" xref="S3.SS3.p2.5.m5.3.3.3.2">𝑞</ci><interval closure="open" id="S3.SS3.p2.5.m5.3.3.3.3.1.cmml" xref="S3.SS3.p2.5.m5.3.3.3.3.2"><ci id="S3.SS3.p2.5.m5.1.1.cmml" xref="S3.SS3.p2.5.m5.1.1">𝑥</ci><ci id="S3.SS3.p2.5.m5.2.2.cmml" xref="S3.SS3.p2.5.m5.2.2">𝑏</ci></interval></apply><apply id="S3.SS3.p2.5.m5.3.3.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1"><minus id="S3.SS3.p2.5.m5.3.3.1.2.cmml" xref="S3.SS3.p2.5.m5.3.3.1.2"></minus><cn id="S3.SS3.p2.5.m5.3.3.1.3.cmml" type="integer" xref="S3.SS3.p2.5.m5.3.3.1.3">1</cn><apply id="S3.SS3.p2.5.m5.3.3.1.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.5.m5.3.3.1.1.2.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1">superscript</csymbol><apply id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1"><minus id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.1"></minus><cn id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.2.cmml" type="integer" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.2">1</cn><ci id="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1.1.1.1.3">𝜆</ci></apply><ci id="S3.SS3.p2.5.m5.3.3.1.1.3.cmml" xref="S3.SS3.p2.5.m5.3.3.1.1.3">𝑏</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.5.m5.3c">q(x,b)=1-(1-\lambda)^{b}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.5.m5.3d">italic_q ( italic_x , italic_b ) = 1 - ( 1 - italic_λ ) start_POSTSUPERSCRIPT italic_b end_POSTSUPERSCRIPT</annotation></semantics></math>.
Then <math alttext="\Delta(x_{i},b_{i})=\lambda_{i}(1-\lambda_{i})^{b_{i}}" class="ltx_Math" display="inline" id="S3.SS3.p2.6.m6.3"><semantics id="S3.SS3.p2.6.m6.3a"><mrow id="S3.SS3.p2.6.m6.3.3" xref="S3.SS3.p2.6.m6.3.3.cmml"><mrow id="S3.SS3.p2.6.m6.2.2.2" xref="S3.SS3.p2.6.m6.2.2.2.cmml"><mi id="S3.SS3.p2.6.m6.2.2.2.4" mathvariant="normal" xref="S3.SS3.p2.6.m6.2.2.2.4.cmml">Δ</mi><mo id="S3.SS3.p2.6.m6.2.2.2.3" xref="S3.SS3.p2.6.m6.2.2.2.3.cmml">⁢</mo><mrow id="S3.SS3.p2.6.m6.2.2.2.2.2" xref="S3.SS3.p2.6.m6.2.2.2.2.3.cmml"><mo id="S3.SS3.p2.6.m6.2.2.2.2.2.3" stretchy="false" xref="S3.SS3.p2.6.m6.2.2.2.2.3.cmml">(</mo><msub id="S3.SS3.p2.6.m6.1.1.1.1.1.1" xref="S3.SS3.p2.6.m6.1.1.1.1.1.1.cmml"><mi id="S3.SS3.p2.6.m6.1.1.1.1.1.1.2" xref="S3.SS3.p2.6.m6.1.1.1.1.1.1.2.cmml">x</mi><mi id="S3.SS3.p2.6.m6.1.1.1.1.1.1.3" xref="S3.SS3.p2.6.m6.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.SS3.p2.6.m6.2.2.2.2.2.4" xref="S3.SS3.p2.6.m6.2.2.2.2.3.cmml">,</mo><msub id="S3.SS3.p2.6.m6.2.2.2.2.2.2" xref="S3.SS3.p2.6.m6.2.2.2.2.2.2.cmml"><mi id="S3.SS3.p2.6.m6.2.2.2.2.2.2.2" xref="S3.SS3.p2.6.m6.2.2.2.2.2.2.2.cmml">b</mi><mi id="S3.SS3.p2.6.m6.2.2.2.2.2.2.3" xref="S3.SS3.p2.6.m6.2.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S3.SS3.p2.6.m6.2.2.2.2.2.5" stretchy="false" xref="S3.SS3.p2.6.m6.2.2.2.2.3.cmml">)</mo></mrow></mrow><mo id="S3.SS3.p2.6.m6.3.3.4" xref="S3.SS3.p2.6.m6.3.3.4.cmml">=</mo><mrow id="S3.SS3.p2.6.m6.3.3.3" xref="S3.SS3.p2.6.m6.3.3.3.cmml"><msub id="S3.SS3.p2.6.m6.3.3.3.3" xref="S3.SS3.p2.6.m6.3.3.3.3.cmml"><mi id="S3.SS3.p2.6.m6.3.3.3.3.2" xref="S3.SS3.p2.6.m6.3.3.3.3.2.cmml">λ</mi><mi id="S3.SS3.p2.6.m6.3.3.3.3.3" xref="S3.SS3.p2.6.m6.3.3.3.3.3.cmml">i</mi></msub><mo id="S3.SS3.p2.6.m6.3.3.3.2" xref="S3.SS3.p2.6.m6.3.3.3.2.cmml">⁢</mo><msup id="S3.SS3.p2.6.m6.3.3.3.1" xref="S3.SS3.p2.6.m6.3.3.3.1.cmml"><mrow id="S3.SS3.p2.6.m6.3.3.3.1.1.1" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.cmml"><mo id="S3.SS3.p2.6.m6.3.3.3.1.1.1.2" stretchy="false" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.cmml">(</mo><mrow id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.cmml"><mn id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.2" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.2.cmml">1</mn><mo id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.1" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.1.cmml">−</mo><msub id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.cmml"><mi id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.2" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.2.cmml">λ</mi><mi id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.3" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.3.cmml">i</mi></msub></mrow><mo id="S3.SS3.p2.6.m6.3.3.3.1.1.1.3" stretchy="false" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.cmml">)</mo></mrow><msub id="S3.SS3.p2.6.m6.3.3.3.1.3" xref="S3.SS3.p2.6.m6.3.3.3.1.3.cmml"><mi id="S3.SS3.p2.6.m6.3.3.3.1.3.2" xref="S3.SS3.p2.6.m6.3.3.3.1.3.2.cmml">b</mi><mi id="S3.SS3.p2.6.m6.3.3.3.1.3.3" xref="S3.SS3.p2.6.m6.3.3.3.1.3.3.cmml">i</mi></msub></msup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.6.m6.3b"><apply id="S3.SS3.p2.6.m6.3.3.cmml" xref="S3.SS3.p2.6.m6.3.3"><eq id="S3.SS3.p2.6.m6.3.3.4.cmml" xref="S3.SS3.p2.6.m6.3.3.4"></eq><apply id="S3.SS3.p2.6.m6.2.2.2.cmml" xref="S3.SS3.p2.6.m6.2.2.2"><times id="S3.SS3.p2.6.m6.2.2.2.3.cmml" xref="S3.SS3.p2.6.m6.2.2.2.3"></times><ci id="S3.SS3.p2.6.m6.2.2.2.4.cmml" xref="S3.SS3.p2.6.m6.2.2.2.4">Δ</ci><interval closure="open" id="S3.SS3.p2.6.m6.2.2.2.2.3.cmml" xref="S3.SS3.p2.6.m6.2.2.2.2.2"><apply id="S3.SS3.p2.6.m6.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.6.m6.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.1.1.1.1.1.1.1.cmml" xref="S3.SS3.p2.6.m6.1.1.1.1.1.1">subscript</csymbol><ci id="S3.SS3.p2.6.m6.1.1.1.1.1.1.2.cmml" xref="S3.SS3.p2.6.m6.1.1.1.1.1.1.2">𝑥</ci><ci id="S3.SS3.p2.6.m6.1.1.1.1.1.1.3.cmml" xref="S3.SS3.p2.6.m6.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S3.SS3.p2.6.m6.2.2.2.2.2.2.cmml" xref="S3.SS3.p2.6.m6.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.2.2.2.2.2.2.1.cmml" xref="S3.SS3.p2.6.m6.2.2.2.2.2.2">subscript</csymbol><ci id="S3.SS3.p2.6.m6.2.2.2.2.2.2.2.cmml" xref="S3.SS3.p2.6.m6.2.2.2.2.2.2.2">𝑏</ci><ci id="S3.SS3.p2.6.m6.2.2.2.2.2.2.3.cmml" xref="S3.SS3.p2.6.m6.2.2.2.2.2.2.3">𝑖</ci></apply></interval></apply><apply id="S3.SS3.p2.6.m6.3.3.3.cmml" xref="S3.SS3.p2.6.m6.3.3.3"><times id="S3.SS3.p2.6.m6.3.3.3.2.cmml" xref="S3.SS3.p2.6.m6.3.3.3.2"></times><apply id="S3.SS3.p2.6.m6.3.3.3.3.cmml" xref="S3.SS3.p2.6.m6.3.3.3.3"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.3.3.3.3.1.cmml" xref="S3.SS3.p2.6.m6.3.3.3.3">subscript</csymbol><ci id="S3.SS3.p2.6.m6.3.3.3.3.2.cmml" xref="S3.SS3.p2.6.m6.3.3.3.3.2">𝜆</ci><ci id="S3.SS3.p2.6.m6.3.3.3.3.3.cmml" xref="S3.SS3.p2.6.m6.3.3.3.3.3">𝑖</ci></apply><apply id="S3.SS3.p2.6.m6.3.3.3.1.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.3.3.3.1.2.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1">superscript</csymbol><apply id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1"><minus id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.1.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.1"></minus><cn id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.2.cmml" type="integer" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.2">1</cn><apply id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.1.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3">subscript</csymbol><ci id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.2.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.2">𝜆</ci><ci id="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.3.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.1.1.1.3.3">𝑖</ci></apply></apply><apply id="S3.SS3.p2.6.m6.3.3.3.1.3.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.3"><csymbol cd="ambiguous" id="S3.SS3.p2.6.m6.3.3.3.1.3.1.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.3">subscript</csymbol><ci id="S3.SS3.p2.6.m6.3.3.3.1.3.2.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.3.2">𝑏</ci><ci id="S3.SS3.p2.6.m6.3.3.3.1.3.3.cmml" xref="S3.SS3.p2.6.m6.3.3.3.1.3.3">𝑖</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.6.m6.3c">\Delta(x_{i},b_{i})=\lambda_{i}(1-\lambda_{i})^{b_{i}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.6.m6.3d">roman_Δ ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) = italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ( 1 - italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) start_POSTSUPERSCRIPT italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS3.p3">
<p class="ltx_p" id="S3.SS3.p3.2">In this case, rather than training the reward predictor <math alttext="\hat{\mathbf{\Delta}}" class="ltx_Math" display="inline" id="S3.SS3.p3.1.m1.1"><semantics id="S3.SS3.p3.1.m1.1a"><mover accent="true" id="S3.SS3.p3.1.m1.1.1" xref="S3.SS3.p3.1.m1.1.1.cmml"><mi id="S3.SS3.p3.1.m1.1.1.2" xref="S3.SS3.p3.1.m1.1.1.2.cmml">𝚫</mi><mo id="S3.SS3.p3.1.m1.1.1.1" xref="S3.SS3.p3.1.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.1.m1.1b"><apply id="S3.SS3.p3.1.m1.1.1.cmml" xref="S3.SS3.p3.1.m1.1.1"><ci id="S3.SS3.p3.1.m1.1.1.1.cmml" xref="S3.SS3.p3.1.m1.1.1.1">^</ci><ci id="S3.SS3.p3.1.m1.1.1.2.cmml" xref="S3.SS3.p3.1.m1.1.1.2">𝚫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.1.m1.1c">\hat{\mathbf{\Delta}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.1.m1.1d">over^ start_ARG bold_Δ end_ARG</annotation></semantics></math> using a squared loss as in <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.E6" title="In 3.1 Estimating Problem Difficulty by Predicting Marginal Rewards ‣ 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">Eq.</span> <span class="ltx_text ltx_ref_tag">6</span></a>, we obtain empirical estimates of <math alttext="\lambda_{i}" class="ltx_Math" display="inline" id="S3.SS3.p3.2.m2.1"><semantics id="S3.SS3.p3.2.m2.1a"><msub id="S3.SS3.p3.2.m2.1.1" xref="S3.SS3.p3.2.m2.1.1.cmml"><mi id="S3.SS3.p3.2.m2.1.1.2" xref="S3.SS3.p3.2.m2.1.1.2.cmml">λ</mi><mi id="S3.SS3.p3.2.m2.1.1.3" xref="S3.SS3.p3.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.2.m2.1b"><apply id="S3.SS3.p3.2.m2.1.1.cmml" xref="S3.SS3.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.p3.2.m2.1.1.1.cmml" xref="S3.SS3.p3.2.m2.1.1">subscript</csymbol><ci id="S3.SS3.p3.2.m2.1.1.2.cmml" xref="S3.SS3.p3.2.m2.1.1.2">𝜆</ci><ci id="S3.SS3.p3.2.m2.1.1.3.cmml" xref="S3.SS3.p3.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.2.m2.1c">\lambda_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.2.m2.1d">italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> at training, then minimize the cross-entropy:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E7">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\sum_{x_{i},\lambda_{i}}\Big{[}\lambda_{i}\log(\hat{{\lambda}}(x_{i};\theta))+%
(1-\lambda_{i})(\log(1-\hat{{\lambda}}(x_{i};\theta))\Big{]}" class="ltx_math_unparsed" display="block" id="S3.E7.m1.6"><semantics id="S3.E7.m1.6a"><mrow id="S3.E7.m1.6b"><munder id="S3.E7.m1.6.7"><mo id="S3.E7.m1.6.7.2" movablelimits="false">∑</mo><mrow id="S3.E7.m1.2.2.2.2"><msub id="S3.E7.m1.1.1.1.1.1"><mi id="S3.E7.m1.1.1.1.1.1.2">x</mi><mi id="S3.E7.m1.1.1.1.1.1.3">i</mi></msub><mo id="S3.E7.m1.2.2.2.2.3">,</mo><msub id="S3.E7.m1.2.2.2.2.2"><mi id="S3.E7.m1.2.2.2.2.2.2">λ</mi><mi id="S3.E7.m1.2.2.2.2.2.3">i</mi></msub></mrow></munder><mrow id="S3.E7.m1.6.8"><mo id="S3.E7.m1.6.8.1" lspace="0em" maxsize="160%" minsize="160%">[</mo><msub id="S3.E7.m1.6.8.2"><mi id="S3.E7.m1.6.8.2.2">λ</mi><mi id="S3.E7.m1.6.8.2.3">i</mi></msub><mi id="S3.E7.m1.4.4">log</mi><mrow id="S3.E7.m1.6.8.3"><mo id="S3.E7.m1.6.8.3.1" stretchy="false">(</mo><mover accent="true" id="S3.E7.m1.6.8.3.2"><mi id="S3.E7.m1.6.8.3.2.2">λ</mi><mo id="S3.E7.m1.6.8.3.2.1">^</mo></mover><mrow id="S3.E7.m1.6.8.3.3"><mo id="S3.E7.m1.6.8.3.3.1" stretchy="false">(</mo><msub id="S3.E7.m1.6.8.3.3.2"><mi id="S3.E7.m1.6.8.3.3.2.2">x</mi><mi id="S3.E7.m1.6.8.3.3.2.3">i</mi></msub><mo id="S3.E7.m1.6.8.3.3.3">;</mo><mi id="S3.E7.m1.3.3">θ</mi><mo id="S3.E7.m1.6.8.3.3.4" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.6.8.3.4" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.6.8.4">+</mo><mrow id="S3.E7.m1.6.8.5"><mo id="S3.E7.m1.6.8.5.1" stretchy="false">(</mo><mn id="S3.E7.m1.6.8.5.2">1</mn><mo id="S3.E7.m1.6.8.5.3">−</mo><msub id="S3.E7.m1.6.8.5.4"><mi id="S3.E7.m1.6.8.5.4.2">λ</mi><mi id="S3.E7.m1.6.8.5.4.3">i</mi></msub><mo id="S3.E7.m1.6.8.5.5" stretchy="false">)</mo></mrow><mrow id="S3.E7.m1.6.8.6"><mo id="S3.E7.m1.6.8.6.1" stretchy="false">(</mo><mi id="S3.E7.m1.6.6">log</mi><mrow id="S3.E7.m1.6.8.6.2"><mo id="S3.E7.m1.6.8.6.2.1" stretchy="false">(</mo><mn id="S3.E7.m1.6.8.6.2.2">1</mn><mo id="S3.E7.m1.6.8.6.2.3">−</mo><mover accent="true" id="S3.E7.m1.6.8.6.2.4"><mi id="S3.E7.m1.6.8.6.2.4.2">λ</mi><mo id="S3.E7.m1.6.8.6.2.4.1">^</mo></mover><mrow id="S3.E7.m1.6.8.6.2.5"><mo id="S3.E7.m1.6.8.6.2.5.1" stretchy="false">(</mo><msub id="S3.E7.m1.6.8.6.2.5.2"><mi id="S3.E7.m1.6.8.6.2.5.2.2">x</mi><mi id="S3.E7.m1.6.8.6.2.5.2.3">i</mi></msub><mo id="S3.E7.m1.6.8.6.2.5.3">;</mo><mi id="S3.E7.m1.5.5">θ</mi><mo id="S3.E7.m1.6.8.6.2.5.4" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.6.8.6.2.6" stretchy="false">)</mo></mrow><mo id="S3.E7.m1.6.8.6.3" maxsize="160%" minsize="160%">]</mo></mrow></mrow></mrow><annotation encoding="application/x-tex" id="S3.E7.m1.6c">\sum_{x_{i},\lambda_{i}}\Big{[}\lambda_{i}\log(\hat{{\lambda}}(x_{i};\theta))+%
(1-\lambda_{i})(\log(1-\hat{{\lambda}}(x_{i};\theta))\Big{]}</annotation><annotation encoding="application/x-llamapun" id="S3.E7.m1.6d">∑ start_POSTSUBSCRIPT italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT end_POSTSUBSCRIPT [ italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT roman_log ( over^ start_ARG italic_λ end_ARG ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_θ ) ) + ( 1 - italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ( roman_log ( 1 - over^ start_ARG italic_λ end_ARG ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_θ ) ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(7)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p3.3">with an appropriately parameterized <math alttext="\hat{{\lambda}}(x;\theta)" class="ltx_Math" display="inline" id="S3.SS3.p3.3.m1.2"><semantics id="S3.SS3.p3.3.m1.2a"><mrow id="S3.SS3.p3.3.m1.2.3" xref="S3.SS3.p3.3.m1.2.3.cmml"><mover accent="true" id="S3.SS3.p3.3.m1.2.3.2" xref="S3.SS3.p3.3.m1.2.3.2.cmml"><mi id="S3.SS3.p3.3.m1.2.3.2.2" xref="S3.SS3.p3.3.m1.2.3.2.2.cmml">λ</mi><mo id="S3.SS3.p3.3.m1.2.3.2.1" xref="S3.SS3.p3.3.m1.2.3.2.1.cmml">^</mo></mover><mo id="S3.SS3.p3.3.m1.2.3.1" xref="S3.SS3.p3.3.m1.2.3.1.cmml">⁢</mo><mrow id="S3.SS3.p3.3.m1.2.3.3.2" xref="S3.SS3.p3.3.m1.2.3.3.1.cmml"><mo id="S3.SS3.p3.3.m1.2.3.3.2.1" stretchy="false" xref="S3.SS3.p3.3.m1.2.3.3.1.cmml">(</mo><mi id="S3.SS3.p3.3.m1.1.1" xref="S3.SS3.p3.3.m1.1.1.cmml">x</mi><mo id="S3.SS3.p3.3.m1.2.3.3.2.2" xref="S3.SS3.p3.3.m1.2.3.3.1.cmml">;</mo><mi id="S3.SS3.p3.3.m1.2.2" xref="S3.SS3.p3.3.m1.2.2.cmml">θ</mi><mo id="S3.SS3.p3.3.m1.2.3.3.2.3" stretchy="false" xref="S3.SS3.p3.3.m1.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.3.m1.2b"><apply id="S3.SS3.p3.3.m1.2.3.cmml" xref="S3.SS3.p3.3.m1.2.3"><times id="S3.SS3.p3.3.m1.2.3.1.cmml" xref="S3.SS3.p3.3.m1.2.3.1"></times><apply id="S3.SS3.p3.3.m1.2.3.2.cmml" xref="S3.SS3.p3.3.m1.2.3.2"><ci id="S3.SS3.p3.3.m1.2.3.2.1.cmml" xref="S3.SS3.p3.3.m1.2.3.2.1">^</ci><ci id="S3.SS3.p3.3.m1.2.3.2.2.cmml" xref="S3.SS3.p3.3.m1.2.3.2.2">𝜆</ci></apply><list id="S3.SS3.p3.3.m1.2.3.3.1.cmml" xref="S3.SS3.p3.3.m1.2.3.3.2"><ci id="S3.SS3.p3.3.m1.1.1.cmml" xref="S3.SS3.p3.3.m1.1.1">𝑥</ci><ci id="S3.SS3.p3.3.m1.2.2.cmml" xref="S3.SS3.p3.3.m1.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.3.m1.2c">\hat{{\lambda}}(x;\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.3.m1.2d">over^ start_ARG italic_λ end_ARG ( italic_x ; italic_θ )</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS3.p4">
<p class="ltx_p" id="S3.SS3.p4.3"><span class="ltx_text ltx_font_bold" id="S3.SS3.p4.3.1">Routing:</span>
For the routing setting, we learn <math alttext="\hat{\mathbf{\Delta}}" class="ltx_Math" display="inline" id="S3.SS3.p4.1.m1.1"><semantics id="S3.SS3.p4.1.m1.1a"><mover accent="true" id="S3.SS3.p4.1.m1.1.1" xref="S3.SS3.p4.1.m1.1.1.cmml"><mi id="S3.SS3.p4.1.m1.1.1.2" xref="S3.SS3.p4.1.m1.1.1.2.cmml">𝚫</mi><mo id="S3.SS3.p4.1.m1.1.1.1" xref="S3.SS3.p4.1.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S3.SS3.p4.1.m1.1b"><apply id="S3.SS3.p4.1.m1.1.1.cmml" xref="S3.SS3.p4.1.m1.1.1"><ci id="S3.SS3.p4.1.m1.1.1.1.cmml" xref="S3.SS3.p4.1.m1.1.1.1">^</ci><ci id="S3.SS3.p4.1.m1.1.1.2.cmml" xref="S3.SS3.p4.1.m1.1.1.2">𝚫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p4.1.m1.1c">\hat{\mathbf{\Delta}}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p4.1.m1.1d">over^ start_ARG bold_Δ end_ARG</annotation></semantics></math> in a special form that models the probability of outputs from the strong model <math alttext="p^{S}" class="ltx_Math" display="inline" id="S3.SS3.p4.2.m2.1"><semantics id="S3.SS3.p4.2.m2.1a"><msup id="S3.SS3.p4.2.m2.1.1" xref="S3.SS3.p4.2.m2.1.1.cmml"><mi id="S3.SS3.p4.2.m2.1.1.2" xref="S3.SS3.p4.2.m2.1.1.2.cmml">p</mi><mi id="S3.SS3.p4.2.m2.1.1.3" xref="S3.SS3.p4.2.m2.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p4.2.m2.1b"><apply id="S3.SS3.p4.2.m2.1.1.cmml" xref="S3.SS3.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.p4.2.m2.1.1.1.cmml" xref="S3.SS3.p4.2.m2.1.1">superscript</csymbol><ci id="S3.SS3.p4.2.m2.1.1.2.cmml" xref="S3.SS3.p4.2.m2.1.1.2">𝑝</ci><ci id="S3.SS3.p4.2.m2.1.1.3.cmml" xref="S3.SS3.p4.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p4.2.m2.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p4.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math> being preferred over the weak model <math alttext="p^{W}" class="ltx_Math" display="inline" id="S3.SS3.p4.3.m3.1"><semantics id="S3.SS3.p4.3.m3.1a"><msup id="S3.SS3.p4.3.m3.1.1" xref="S3.SS3.p4.3.m3.1.1.cmml"><mi id="S3.SS3.p4.3.m3.1.1.2" xref="S3.SS3.p4.3.m3.1.1.2.cmml">p</mi><mi id="S3.SS3.p4.3.m3.1.1.3" xref="S3.SS3.p4.3.m3.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p4.3.m3.1b"><apply id="S3.SS3.p4.3.m3.1.1.cmml" xref="S3.SS3.p4.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS3.p4.3.m3.1.1.1.cmml" xref="S3.SS3.p4.3.m3.1.1">superscript</csymbol><ci id="S3.SS3.p4.3.m3.1.1.2.cmml" xref="S3.SS3.p4.3.m3.1.1.2">𝑝</ci><ci id="S3.SS3.p4.3.m3.1.1.3.cmml" xref="S3.SS3.p4.3.m3.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p4.3.m3.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p4.3.m3.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> as:</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E8">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\hat{\Delta}(x_{i};\theta)_{b^{S}}\approx p(p^{S}\succ p^{W}|x)=\mathbb{E}_{y_%
{1}\sim p^{S},y_{2}\sim p^{W}}[\sigma(r(x,y_{1})-r(x,y_{2}))]" class="ltx_Math" display="block" id="S3.E8.m1.8"><semantics id="S3.E8.m1.8a"><mrow id="S3.E8.m1.8.8" xref="S3.E8.m1.8.8.cmml"><mrow id="S3.E8.m1.6.6.1" xref="S3.E8.m1.6.6.1.cmml"><mover accent="true" id="S3.E8.m1.6.6.1.3" xref="S3.E8.m1.6.6.1.3.cmml"><mi id="S3.E8.m1.6.6.1.3.2" mathvariant="normal" xref="S3.E8.m1.6.6.1.3.2.cmml">Δ</mi><mo id="S3.E8.m1.6.6.1.3.1" xref="S3.E8.m1.6.6.1.3.1.cmml">^</mo></mover><mo id="S3.E8.m1.6.6.1.2" xref="S3.E8.m1.6.6.1.2.cmml">⁢</mo><msub id="S3.E8.m1.6.6.1.1" xref="S3.E8.m1.6.6.1.1.cmml"><mrow id="S3.E8.m1.6.6.1.1.1.1" xref="S3.E8.m1.6.6.1.1.1.2.cmml"><mo id="S3.E8.m1.6.6.1.1.1.1.2" stretchy="false" xref="S3.E8.m1.6.6.1.1.1.2.cmml">(</mo><msub id="S3.E8.m1.6.6.1.1.1.1.1" xref="S3.E8.m1.6.6.1.1.1.1.1.cmml"><mi id="S3.E8.m1.6.6.1.1.1.1.1.2" xref="S3.E8.m1.6.6.1.1.1.1.1.2.cmml">x</mi><mi id="S3.E8.m1.6.6.1.1.1.1.1.3" xref="S3.E8.m1.6.6.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S3.E8.m1.6.6.1.1.1.1.3" xref="S3.E8.m1.6.6.1.1.1.2.cmml">;</mo><mi id="S3.E8.m1.3.3" xref="S3.E8.m1.3.3.cmml">θ</mi><mo id="S3.E8.m1.6.6.1.1.1.1.4" stretchy="false" xref="S3.E8.m1.6.6.1.1.1.2.cmml">)</mo></mrow><msup id="S3.E8.m1.6.6.1.1.3" xref="S3.E8.m1.6.6.1.1.3.cmml"><mi id="S3.E8.m1.6.6.1.1.3.2" xref="S3.E8.m1.6.6.1.1.3.2.cmml">b</mi><mi id="S3.E8.m1.6.6.1.1.3.3" xref="S3.E8.m1.6.6.1.1.3.3.cmml">S</mi></msup></msub></mrow><mo id="S3.E8.m1.8.8.5" xref="S3.E8.m1.8.8.5.cmml">≈</mo><mrow id="S3.E8.m1.7.7.2" xref="S3.E8.m1.7.7.2.cmml"><mi id="S3.E8.m1.7.7.2.3" xref="S3.E8.m1.7.7.2.3.cmml">p</mi><mo id="S3.E8.m1.7.7.2.2" xref="S3.E8.m1.7.7.2.2.cmml">⁢</mo><mrow id="S3.E8.m1.7.7.2.1.1" xref="S3.E8.m1.7.7.2.1.1.1.cmml"><mo id="S3.E8.m1.7.7.2.1.1.2" stretchy="false" xref="S3.E8.m1.7.7.2.1.1.1.cmml">(</mo><mrow id="S3.E8.m1.7.7.2.1.1.1" xref="S3.E8.m1.7.7.2.1.1.1.cmml"><msup id="S3.E8.m1.7.7.2.1.1.1.2" xref="S3.E8.m1.7.7.2.1.1.1.2.cmml"><mi id="S3.E8.m1.7.7.2.1.1.1.2.2" xref="S3.E8.m1.7.7.2.1.1.1.2.2.cmml">p</mi><mi id="S3.E8.m1.7.7.2.1.1.1.2.3" xref="S3.E8.m1.7.7.2.1.1.1.2.3.cmml">S</mi></msup><mo id="S3.E8.m1.7.7.2.1.1.1.1" xref="S3.E8.m1.7.7.2.1.1.1.1.cmml">≻</mo><mrow id="S3.E8.m1.7.7.2.1.1.1.3" xref="S3.E8.m1.7.7.2.1.1.1.3.cmml"><msup id="S3.E8.m1.7.7.2.1.1.1.3.2" xref="S3.E8.m1.7.7.2.1.1.1.3.2.cmml"><mi id="S3.E8.m1.7.7.2.1.1.1.3.2.2" xref="S3.E8.m1.7.7.2.1.1.1.3.2.2.cmml">p</mi><mi id="S3.E8.m1.7.7.2.1.1.1.3.2.3" xref="S3.E8.m1.7.7.2.1.1.1.3.2.3.cmml">W</mi></msup><mo fence="false" id="S3.E8.m1.7.7.2.1.1.1.3.1" xref="S3.E8.m1.7.7.2.1.1.1.3.1.cmml">|</mo><mi id="S3.E8.m1.7.7.2.1.1.1.3.3" xref="S3.E8.m1.7.7.2.1.1.1.3.3.cmml">x</mi></mrow></mrow><mo id="S3.E8.m1.7.7.2.1.1.3" stretchy="false" xref="S3.E8.m1.7.7.2.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E8.m1.8.8.6" xref="S3.E8.m1.8.8.6.cmml">=</mo><mrow id="S3.E8.m1.8.8.3" xref="S3.E8.m1.8.8.3.cmml"><msub id="S3.E8.m1.8.8.3.3" xref="S3.E8.m1.8.8.3.3.cmml"><mi id="S3.E8.m1.8.8.3.3.2" xref="S3.E8.m1.8.8.3.3.2.cmml">𝔼</mi><mrow id="S3.E8.m1.2.2.2.2" xref="S3.E8.m1.2.2.2.3.cmml"><mrow id="S3.E8.m1.1.1.1.1.1" xref="S3.E8.m1.1.1.1.1.1.cmml"><msub id="S3.E8.m1.1.1.1.1.1.2" xref="S3.E8.m1.1.1.1.1.1.2.cmml"><mi id="S3.E8.m1.1.1.1.1.1.2.2" xref="S3.E8.m1.1.1.1.1.1.2.2.cmml">y</mi><mn id="S3.E8.m1.1.1.1.1.1.2.3" xref="S3.E8.m1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="S3.E8.m1.1.1.1.1.1.1" xref="S3.E8.m1.1.1.1.1.1.1.cmml">∼</mo><msup id="S3.E8.m1.1.1.1.1.1.3" xref="S3.E8.m1.1.1.1.1.1.3.cmml"><mi id="S3.E8.m1.1.1.1.1.1.3.2" xref="S3.E8.m1.1.1.1.1.1.3.2.cmml">p</mi><mi id="S3.E8.m1.1.1.1.1.1.3.3" xref="S3.E8.m1.1.1.1.1.1.3.3.cmml">S</mi></msup></mrow><mo id="S3.E8.m1.2.2.2.2.3" xref="S3.E8.m1.2.2.2.3a.cmml">,</mo><mrow id="S3.E8.m1.2.2.2.2.2" xref="S3.E8.m1.2.2.2.2.2.cmml"><msub id="S3.E8.m1.2.2.2.2.2.2" xref="S3.E8.m1.2.2.2.2.2.2.cmml"><mi id="S3.E8.m1.2.2.2.2.2.2.2" xref="S3.E8.m1.2.2.2.2.2.2.2.cmml">y</mi><mn id="S3.E8.m1.2.2.2.2.2.2.3" xref="S3.E8.m1.2.2.2.2.2.2.3.cmml">2</mn></msub><mo id="S3.E8.m1.2.2.2.2.2.1" xref="S3.E8.m1.2.2.2.2.2.1.cmml">∼</mo><msup id="S3.E8.m1.2.2.2.2.2.3" xref="S3.E8.m1.2.2.2.2.2.3.cmml"><mi id="S3.E8.m1.2.2.2.2.2.3.2" xref="S3.E8.m1.2.2.2.2.2.3.2.cmml">p</mi><mi id="S3.E8.m1.2.2.2.2.2.3.3" xref="S3.E8.m1.2.2.2.2.2.3.3.cmml">W</mi></msup></mrow></mrow></msub><mo id="S3.E8.m1.8.8.3.2" xref="S3.E8.m1.8.8.3.2.cmml">⁢</mo><mrow id="S3.E8.m1.8.8.3.1.1" xref="S3.E8.m1.8.8.3.1.2.cmml"><mo id="S3.E8.m1.8.8.3.1.1.2" stretchy="false" xref="S3.E8.m1.8.8.3.1.2.1.cmml">[</mo><mrow id="S3.E8.m1.8.8.3.1.1.1" xref="S3.E8.m1.8.8.3.1.1.1.cmml"><mi id="S3.E8.m1.8.8.3.1.1.1.3" xref="S3.E8.m1.8.8.3.1.1.1.3.cmml">σ</mi><mo id="S3.E8.m1.8.8.3.1.1.1.2" xref="S3.E8.m1.8.8.3.1.1.1.2.cmml">⁢</mo><mrow id="S3.E8.m1.8.8.3.1.1.1.1.1" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.cmml"><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.2" stretchy="false" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E8.m1.8.8.3.1.1.1.1.1.1" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.cmml"><mrow id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.cmml"><mi id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.3" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.3.cmml">r</mi><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.2" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.2.cmml"><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.2.cmml">(</mo><mi id="S3.E8.m1.4.4" xref="S3.E8.m1.4.4.cmml">x</mi><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.3" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.2" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mn id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.3" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.3" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.3.cmml">−</mo><mrow id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.cmml"><mi id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.3" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.3.cmml">r</mi><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.2" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.2.cmml">⁢</mo><mrow id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.2.cmml"><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.2" stretchy="false" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.2.cmml">(</mo><mi id="S3.E8.m1.5.5" xref="S3.E8.m1.5.5.cmml">x</mi><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.3" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.2.cmml">,</mo><msub id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.cmml"><mi id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.2" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.2.cmml">y</mi><mn id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.3" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.3.cmml">2</mn></msub><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.4" stretchy="false" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S3.E8.m1.8.8.3.1.1.1.1.1.3" stretchy="false" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.E8.m1.8.8.3.1.1.3" stretchy="false" xref="S3.E8.m1.8.8.3.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E8.m1.8b"><apply id="S3.E8.m1.8.8.cmml" xref="S3.E8.m1.8.8"><and id="S3.E8.m1.8.8a.cmml" xref="S3.E8.m1.8.8"></and><apply id="S3.E8.m1.8.8b.cmml" xref="S3.E8.m1.8.8"><approx id="S3.E8.m1.8.8.5.cmml" xref="S3.E8.m1.8.8.5"></approx><apply id="S3.E8.m1.6.6.1.cmml" xref="S3.E8.m1.6.6.1"><times id="S3.E8.m1.6.6.1.2.cmml" xref="S3.E8.m1.6.6.1.2"></times><apply id="S3.E8.m1.6.6.1.3.cmml" xref="S3.E8.m1.6.6.1.3"><ci id="S3.E8.m1.6.6.1.3.1.cmml" xref="S3.E8.m1.6.6.1.3.1">^</ci><ci id="S3.E8.m1.6.6.1.3.2.cmml" xref="S3.E8.m1.6.6.1.3.2">Δ</ci></apply><apply id="S3.E8.m1.6.6.1.1.cmml" xref="S3.E8.m1.6.6.1.1"><csymbol cd="ambiguous" id="S3.E8.m1.6.6.1.1.2.cmml" xref="S3.E8.m1.6.6.1.1">subscript</csymbol><list id="S3.E8.m1.6.6.1.1.1.2.cmml" xref="S3.E8.m1.6.6.1.1.1.1"><apply id="S3.E8.m1.6.6.1.1.1.1.1.cmml" xref="S3.E8.m1.6.6.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E8.m1.6.6.1.1.1.1.1.1.cmml" xref="S3.E8.m1.6.6.1.1.1.1.1">subscript</csymbol><ci id="S3.E8.m1.6.6.1.1.1.1.1.2.cmml" xref="S3.E8.m1.6.6.1.1.1.1.1.2">𝑥</ci><ci id="S3.E8.m1.6.6.1.1.1.1.1.3.cmml" xref="S3.E8.m1.6.6.1.1.1.1.1.3">𝑖</ci></apply><ci id="S3.E8.m1.3.3.cmml" xref="S3.E8.m1.3.3">𝜃</ci></list><apply id="S3.E8.m1.6.6.1.1.3.cmml" xref="S3.E8.m1.6.6.1.1.3"><csymbol cd="ambiguous" id="S3.E8.m1.6.6.1.1.3.1.cmml" xref="S3.E8.m1.6.6.1.1.3">superscript</csymbol><ci id="S3.E8.m1.6.6.1.1.3.2.cmml" xref="S3.E8.m1.6.6.1.1.3.2">𝑏</ci><ci id="S3.E8.m1.6.6.1.1.3.3.cmml" xref="S3.E8.m1.6.6.1.1.3.3">𝑆</ci></apply></apply></apply><apply id="S3.E8.m1.7.7.2.cmml" xref="S3.E8.m1.7.7.2"><times id="S3.E8.m1.7.7.2.2.cmml" xref="S3.E8.m1.7.7.2.2"></times><ci id="S3.E8.m1.7.7.2.3.cmml" xref="S3.E8.m1.7.7.2.3">𝑝</ci><apply id="S3.E8.m1.7.7.2.1.1.1.cmml" xref="S3.E8.m1.7.7.2.1.1"><csymbol cd="latexml" id="S3.E8.m1.7.7.2.1.1.1.1.cmml" xref="S3.E8.m1.7.7.2.1.1.1.1">succeeds</csymbol><apply id="S3.E8.m1.7.7.2.1.1.1.2.cmml" xref="S3.E8.m1.7.7.2.1.1.1.2"><csymbol cd="ambiguous" id="S3.E8.m1.7.7.2.1.1.1.2.1.cmml" xref="S3.E8.m1.7.7.2.1.1.1.2">superscript</csymbol><ci id="S3.E8.m1.7.7.2.1.1.1.2.2.cmml" xref="S3.E8.m1.7.7.2.1.1.1.2.2">𝑝</ci><ci id="S3.E8.m1.7.7.2.1.1.1.2.3.cmml" xref="S3.E8.m1.7.7.2.1.1.1.2.3">𝑆</ci></apply><apply id="S3.E8.m1.7.7.2.1.1.1.3.cmml" xref="S3.E8.m1.7.7.2.1.1.1.3"><csymbol cd="latexml" id="S3.E8.m1.7.7.2.1.1.1.3.1.cmml" xref="S3.E8.m1.7.7.2.1.1.1.3.1">conditional</csymbol><apply id="S3.E8.m1.7.7.2.1.1.1.3.2.cmml" xref="S3.E8.m1.7.7.2.1.1.1.3.2"><csymbol cd="ambiguous" id="S3.E8.m1.7.7.2.1.1.1.3.2.1.cmml" xref="S3.E8.m1.7.7.2.1.1.1.3.2">superscript</csymbol><ci id="S3.E8.m1.7.7.2.1.1.1.3.2.2.cmml" xref="S3.E8.m1.7.7.2.1.1.1.3.2.2">𝑝</ci><ci id="S3.E8.m1.7.7.2.1.1.1.3.2.3.cmml" xref="S3.E8.m1.7.7.2.1.1.1.3.2.3">𝑊</ci></apply><ci id="S3.E8.m1.7.7.2.1.1.1.3.3.cmml" xref="S3.E8.m1.7.7.2.1.1.1.3.3">𝑥</ci></apply></apply></apply></apply><apply id="S3.E8.m1.8.8c.cmml" xref="S3.E8.m1.8.8"><eq id="S3.E8.m1.8.8.6.cmml" xref="S3.E8.m1.8.8.6"></eq><share href="https://arxiv.org/html/2410.04707v1#S3.E8.m1.7.7.2.cmml" id="S3.E8.m1.8.8d.cmml" xref="S3.E8.m1.8.8"></share><apply id="S3.E8.m1.8.8.3.cmml" xref="S3.E8.m1.8.8.3"><times id="S3.E8.m1.8.8.3.2.cmml" xref="S3.E8.m1.8.8.3.2"></times><apply id="S3.E8.m1.8.8.3.3.cmml" xref="S3.E8.m1.8.8.3.3"><csymbol cd="ambiguous" id="S3.E8.m1.8.8.3.3.1.cmml" xref="S3.E8.m1.8.8.3.3">subscript</csymbol><ci id="S3.E8.m1.8.8.3.3.2.cmml" xref="S3.E8.m1.8.8.3.3.2">𝔼</ci><apply id="S3.E8.m1.2.2.2.3.cmml" xref="S3.E8.m1.2.2.2.2"><csymbol cd="ambiguous" id="S3.E8.m1.2.2.2.3a.cmml" xref="S3.E8.m1.2.2.2.2.3">formulae-sequence</csymbol><apply id="S3.E8.m1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1"><csymbol cd="latexml" id="S3.E8.m1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.1.1.1.1.1.1">similar-to</csymbol><apply id="S3.E8.m1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.E8.m1.1.1.1.1.1.2.1.cmml" xref="S3.E8.m1.1.1.1.1.1.2">subscript</csymbol><ci id="S3.E8.m1.1.1.1.1.1.2.2.cmml" xref="S3.E8.m1.1.1.1.1.1.2.2">𝑦</ci><cn id="S3.E8.m1.1.1.1.1.1.2.3.cmml" type="integer" xref="S3.E8.m1.1.1.1.1.1.2.3">1</cn></apply><apply id="S3.E8.m1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E8.m1.1.1.1.1.1.3.1.cmml" xref="S3.E8.m1.1.1.1.1.1.3">superscript</csymbol><ci id="S3.E8.m1.1.1.1.1.1.3.2.cmml" xref="S3.E8.m1.1.1.1.1.1.3.2">𝑝</ci><ci id="S3.E8.m1.1.1.1.1.1.3.3.cmml" xref="S3.E8.m1.1.1.1.1.1.3.3">𝑆</ci></apply></apply><apply id="S3.E8.m1.2.2.2.2.2.cmml" xref="S3.E8.m1.2.2.2.2.2"><csymbol cd="latexml" id="S3.E8.m1.2.2.2.2.2.1.cmml" xref="S3.E8.m1.2.2.2.2.2.1">similar-to</csymbol><apply id="S3.E8.m1.2.2.2.2.2.2.cmml" xref="S3.E8.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S3.E8.m1.2.2.2.2.2.2.1.cmml" xref="S3.E8.m1.2.2.2.2.2.2">subscript</csymbol><ci id="S3.E8.m1.2.2.2.2.2.2.2.cmml" xref="S3.E8.m1.2.2.2.2.2.2.2">𝑦</ci><cn id="S3.E8.m1.2.2.2.2.2.2.3.cmml" type="integer" xref="S3.E8.m1.2.2.2.2.2.2.3">2</cn></apply><apply id="S3.E8.m1.2.2.2.2.2.3.cmml" xref="S3.E8.m1.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S3.E8.m1.2.2.2.2.2.3.1.cmml" xref="S3.E8.m1.2.2.2.2.2.3">superscript</csymbol><ci id="S3.E8.m1.2.2.2.2.2.3.2.cmml" xref="S3.E8.m1.2.2.2.2.2.3.2">𝑝</ci><ci id="S3.E8.m1.2.2.2.2.2.3.3.cmml" xref="S3.E8.m1.2.2.2.2.2.3.3">𝑊</ci></apply></apply></apply></apply><apply id="S3.E8.m1.8.8.3.1.2.cmml" xref="S3.E8.m1.8.8.3.1.1"><csymbol cd="latexml" id="S3.E8.m1.8.8.3.1.2.1.cmml" xref="S3.E8.m1.8.8.3.1.1.2">delimited-[]</csymbol><apply id="S3.E8.m1.8.8.3.1.1.1.cmml" xref="S3.E8.m1.8.8.3.1.1.1"><times id="S3.E8.m1.8.8.3.1.1.1.2.cmml" xref="S3.E8.m1.8.8.3.1.1.1.2"></times><ci id="S3.E8.m1.8.8.3.1.1.1.3.cmml" xref="S3.E8.m1.8.8.3.1.1.1.3">𝜎</ci><apply id="S3.E8.m1.8.8.3.1.1.1.1.1.1.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1"><minus id="S3.E8.m1.8.8.3.1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.3"></minus><apply id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1"><times id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.2"></times><ci id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.3.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.3">𝑟</ci><interval closure="open" id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1"><ci id="S3.E8.m1.4.4.cmml" xref="S3.E8.m1.4.4">𝑥</ci><apply id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.2">𝑦</ci><cn id="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.3.cmml" type="integer" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.1.1.1.1.3">1</cn></apply></interval></apply><apply id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2"><times id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.2.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.2"></times><ci id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.3.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.3">𝑟</ci><interval closure="open" id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.2.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1"><ci id="S3.E8.m1.5.5.cmml" xref="S3.E8.m1.5.5">𝑥</ci><apply id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1"><csymbol cd="ambiguous" id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.1.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1">subscript</csymbol><ci id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.2.cmml" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.2">𝑦</ci><cn id="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.3.cmml" type="integer" xref="S3.E8.m1.8.8.3.1.1.1.1.1.1.2.1.1.1.3">2</cn></apply></interval></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E8.m1.8c">\hat{\Delta}(x_{i};\theta)_{b^{S}}\approx p(p^{S}\succ p^{W}|x)=\mathbb{E}_{y_%
{1}\sim p^{S},y_{2}\sim p^{W}}[\sigma(r(x,y_{1})-r(x,y_{2}))]</annotation><annotation encoding="application/x-llamapun" id="S3.E8.m1.8d">over^ start_ARG roman_Δ end_ARG ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_θ ) start_POSTSUBSCRIPT italic_b start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT end_POSTSUBSCRIPT ≈ italic_p ( italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT ≻ italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT | italic_x ) = blackboard_E start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∼ italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∼ italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT end_POSTSUBSCRIPT [ italic_σ ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) - italic_r ( italic_x , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(8)</span></td>
</tr></tbody>
</table>
</div>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments</h2>
<div class="ltx_para ltx_noindent" id="S4.p1">
<p class="ltx_p" id="S4.p1.2">We apply our method to several adaptive decoding procedures: best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.p1.1.m1.1"><semantics id="S4.p1.1.m1.1a"><mi id="S4.p1.1.m1.1.1" xref="S4.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.p1.1.m1.1b"><ci id="S4.p1.1.m1.1.1.cmml" xref="S4.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.p1.1.m1.1d">italic_k</annotation></semantics></math> and routing (to either a large model or a sophisticated search algorithm). We evaluate improvements over standard decoding and procedures that allocate computation uniformly across problem instances, as well as performance relative to the theoretical upper bound. In addition, we provide <em class="ltx_emph ltx_font_italic" id="S4.p1.2.1">intrinsic</em> evaluations of the accuracy and calibration of reward predictors <math alttext="\hat{\mathbf{\Delta}}" class="ltx_Math" display="inline" id="S4.p1.2.m2.1"><semantics id="S4.p1.2.m2.1a"><mover accent="true" id="S4.p1.2.m2.1.1" xref="S4.p1.2.m2.1.1.cmml"><mi id="S4.p1.2.m2.1.1.2" xref="S4.p1.2.m2.1.1.2.cmml">𝚫</mi><mo id="S4.p1.2.m2.1.1.1" xref="S4.p1.2.m2.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S4.p1.2.m2.1b"><apply id="S4.p1.2.m2.1.1.cmml" xref="S4.p1.2.m2.1.1"><ci id="S4.p1.2.m2.1.1.1.cmml" xref="S4.p1.2.m2.1.1.1">^</ci><ci id="S4.p1.2.m2.1.1.2.cmml" xref="S4.p1.2.m2.1.1.2">𝚫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p1.2.m2.1c">\hat{\mathbf{\Delta}}</annotation><annotation encoding="application/x-llamapun" id="S4.p1.2.m2.1d">over^ start_ARG bold_Δ end_ARG</annotation></semantics></math>.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Adaptive Best-of-k</h3>
<div class="ltx_para ltx_noindent" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">We use best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.p1.1.m1.1"><semantics id="S4.SS1.p1.1.m1.1a"><mi id="S4.SS1.p1.1.m1.1.1" xref="S4.SS1.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p1.1.m1.1b"><ci id="S4.SS1.p1.1.m1.1.1.cmml" xref="S4.SS1.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p1.1.m1.1d">italic_k</annotation></semantics></math> reranking with a reward model in three settings: Math, Code and Chat.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.p2.1.1">Methods:</span>
We evaluate the following methods:</p>
<ol class="ltx_enumerate" id="S4.I1">
<li class="ltx_item" id="S4.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="S4.I1.i1.p1">
<p class="ltx_p" id="S4.I1.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I1.i1.p1.1.1">Online Ada-BoK (ours):</span> The online variant of our method that solves a joint optimization problem, as detailed in Section <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.F2" title="Figure 2 ‣ 3.2 Allocating Computation ‣ 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">2</span></a>.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para" id="S4.I1.i2.p1">
<p class="ltx_p" id="S4.I1.i2.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I1.i2.p1.1.1">Offline Ada-BoK (ours):</span> The offline variant that solves the allocation problem on a held-out dataset, as detailed in Section <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S3.F2" title="Figure 2 ‣ 3.2 Allocating Computation ‣ 3 Method ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">2</span></a>. This method is only used in Math and Code domains.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span>
<div class="ltx_para" id="S4.I1.i3.p1">
<p class="ltx_p" id="S4.I1.i3.p1.2"><span class="ltx_text ltx_font_bold" id="S4.I1.i3.p1.1.1">Best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.I1.i3.p1.1.1.m1.1"><semantics id="S4.I1.i3.p1.1.1.m1.1a"><mi id="S4.I1.i3.p1.1.1.m1.1.1" xref="S4.I1.i3.p1.1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.I1.i3.p1.1.1.m1.1b"><ci id="S4.I1.i3.p1.1.1.m1.1.1.cmml" xref="S4.I1.i3.p1.1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.I1.i3.p1.1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.I1.i3.p1.1.1.m1.1d">italic_k</annotation></semantics></math>:</span> This baseline allocates the same number of samples <math alttext="k=B" class="ltx_Math" display="inline" id="S4.I1.i3.p1.2.m1.1"><semantics id="S4.I1.i3.p1.2.m1.1a"><mrow id="S4.I1.i3.p1.2.m1.1.1" xref="S4.I1.i3.p1.2.m1.1.1.cmml"><mi id="S4.I1.i3.p1.2.m1.1.1.2" xref="S4.I1.i3.p1.2.m1.1.1.2.cmml">k</mi><mo id="S4.I1.i3.p1.2.m1.1.1.1" xref="S4.I1.i3.p1.2.m1.1.1.1.cmml">=</mo><mi id="S4.I1.i3.p1.2.m1.1.1.3" xref="S4.I1.i3.p1.2.m1.1.1.3.cmml">B</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.I1.i3.p1.2.m1.1b"><apply id="S4.I1.i3.p1.2.m1.1.1.cmml" xref="S4.I1.i3.p1.2.m1.1.1"><eq id="S4.I1.i3.p1.2.m1.1.1.1.cmml" xref="S4.I1.i3.p1.2.m1.1.1.1"></eq><ci id="S4.I1.i3.p1.2.m1.1.1.2.cmml" xref="S4.I1.i3.p1.2.m1.1.1.2">𝑘</ci><ci id="S4.I1.i3.p1.2.m1.1.1.3.cmml" xref="S4.I1.i3.p1.2.m1.1.1.3">𝐵</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I1.i3.p1.2.m1.1c">k=B</annotation><annotation encoding="application/x-llamapun" id="S4.I1.i3.p1.2.m1.1d">italic_k = italic_B</annotation></semantics></math> to every query.</p>
</div>
</li>
<li class="ltx_item" id="S4.I1.i4" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">4.</span>
<div class="ltx_para ltx_noindent" id="S4.I1.i4.p1">
<p class="ltx_p" id="S4.I1.i4.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I1.i4.p1.1.1">Oracle:</span> Oracle is a non-implementable method that uses the ground truth marginal rewards to solve the allocation problem.
This method solves the allocation problem by plugging in the true marginal rewards.
It is <span class="ltx_text ltx_font_bold" id="S4.I1.i4.p1.1.2">unrealizable</span> in practice, but provides an upper bound on the reward that could be obtained if the learned marginal reward predictor <math alttext="\hat{\mathbf{\Delta}}" class="ltx_Math" display="inline" id="S4.I1.i4.p1.1.m1.1"><semantics id="S4.I1.i4.p1.1.m1.1a"><mover accent="true" id="S4.I1.i4.p1.1.m1.1.1" xref="S4.I1.i4.p1.1.m1.1.1.cmml"><mi id="S4.I1.i4.p1.1.m1.1.1.2" xref="S4.I1.i4.p1.1.m1.1.1.2.cmml">𝚫</mi><mo id="S4.I1.i4.p1.1.m1.1.1.1" xref="S4.I1.i4.p1.1.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S4.I1.i4.p1.1.m1.1b"><apply id="S4.I1.i4.p1.1.m1.1.1.cmml" xref="S4.I1.i4.p1.1.m1.1.1"><ci id="S4.I1.i4.p1.1.m1.1.1.1.cmml" xref="S4.I1.i4.p1.1.m1.1.1.1">^</ci><ci id="S4.I1.i4.p1.1.m1.1.1.2.cmml" xref="S4.I1.i4.p1.1.m1.1.1.2">𝚫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I1.i4.p1.1.m1.1c">\hat{\mathbf{\Delta}}</annotation><annotation encoding="application/x-llamapun" id="S4.I1.i4.p1.1.m1.1d">over^ start_ARG bold_Δ end_ARG</annotation></semantics></math> were perfect.</p>
</div>
</li>
</ol>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.p3">
<p class="ltx_p" id="S4.SS1.p3.4"><span class="ltx_text ltx_font_bold" id="S4.SS1.p3.4.1">Evaluation Metrics:</span>
Our main evaluation metric for Math and Code is the expected success rate under an oracle verification procedure:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E9">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\textbf{Expected Success Rate}=\dfrac{1}{n}\sum_{i=1}^{n}\mathbb{E}_{y_{i}\sim
f%
(x_{i},b_{i})}[\mathds{1}\text{\{$y_{i}$ is correct\}}]" class="ltx_Math" display="block" id="S4.E9.m1.4"><semantics id="S4.E9.m1.4a"><mrow id="S4.E9.m1.4.4" xref="S4.E9.m1.4.4.cmml"><mtext class="ltx_mathvariant_bold" id="S4.E9.m1.4.4.3" xref="S4.E9.m1.4.4.3a.cmml">Expected Success Rate</mtext><mo id="S4.E9.m1.4.4.2" xref="S4.E9.m1.4.4.2.cmml">=</mo><mrow id="S4.E9.m1.4.4.1" xref="S4.E9.m1.4.4.1.cmml"><mfrac id="S4.E9.m1.4.4.1.3" xref="S4.E9.m1.4.4.1.3.cmml"><mn id="S4.E9.m1.4.4.1.3.2" xref="S4.E9.m1.4.4.1.3.2.cmml">1</mn><mi id="S4.E9.m1.4.4.1.3.3" xref="S4.E9.m1.4.4.1.3.3.cmml">n</mi></mfrac><mo id="S4.E9.m1.4.4.1.2" xref="S4.E9.m1.4.4.1.2.cmml">⁢</mo><mrow id="S4.E9.m1.4.4.1.1" xref="S4.E9.m1.4.4.1.1.cmml"><munderover id="S4.E9.m1.4.4.1.1.2" xref="S4.E9.m1.4.4.1.1.2.cmml"><mo id="S4.E9.m1.4.4.1.1.2.2.2" movablelimits="false" xref="S4.E9.m1.4.4.1.1.2.2.2.cmml">∑</mo><mrow id="S4.E9.m1.4.4.1.1.2.2.3" xref="S4.E9.m1.4.4.1.1.2.2.3.cmml"><mi id="S4.E9.m1.4.4.1.1.2.2.3.2" xref="S4.E9.m1.4.4.1.1.2.2.3.2.cmml">i</mi><mo id="S4.E9.m1.4.4.1.1.2.2.3.1" xref="S4.E9.m1.4.4.1.1.2.2.3.1.cmml">=</mo><mn id="S4.E9.m1.4.4.1.1.2.2.3.3" xref="S4.E9.m1.4.4.1.1.2.2.3.3.cmml">1</mn></mrow><mi id="S4.E9.m1.4.4.1.1.2.3" xref="S4.E9.m1.4.4.1.1.2.3.cmml">n</mi></munderover><mrow id="S4.E9.m1.4.4.1.1.1" xref="S4.E9.m1.4.4.1.1.1.cmml"><msub id="S4.E9.m1.4.4.1.1.1.3" xref="S4.E9.m1.4.4.1.1.1.3.cmml"><mi id="S4.E9.m1.4.4.1.1.1.3.2" xref="S4.E9.m1.4.4.1.1.1.3.2.cmml">𝔼</mi><mrow id="S4.E9.m1.3.3.2" xref="S4.E9.m1.3.3.2.cmml"><msub id="S4.E9.m1.3.3.2.4" xref="S4.E9.m1.3.3.2.4.cmml"><mi id="S4.E9.m1.3.3.2.4.2" xref="S4.E9.m1.3.3.2.4.2.cmml">y</mi><mi id="S4.E9.m1.3.3.2.4.3" xref="S4.E9.m1.3.3.2.4.3.cmml">i</mi></msub><mo id="S4.E9.m1.3.3.2.3" xref="S4.E9.m1.3.3.2.3.cmml">∼</mo><mrow id="S4.E9.m1.3.3.2.2" xref="S4.E9.m1.3.3.2.2.cmml"><mi id="S4.E9.m1.3.3.2.2.4" xref="S4.E9.m1.3.3.2.2.4.cmml">f</mi><mo id="S4.E9.m1.3.3.2.2.3" xref="S4.E9.m1.3.3.2.2.3.cmml">⁢</mo><mrow id="S4.E9.m1.3.3.2.2.2.2" xref="S4.E9.m1.3.3.2.2.2.3.cmml"><mo id="S4.E9.m1.3.3.2.2.2.2.3" stretchy="false" xref="S4.E9.m1.3.3.2.2.2.3.cmml">(</mo><msub id="S4.E9.m1.2.2.1.1.1.1.1" xref="S4.E9.m1.2.2.1.1.1.1.1.cmml"><mi id="S4.E9.m1.2.2.1.1.1.1.1.2" xref="S4.E9.m1.2.2.1.1.1.1.1.2.cmml">x</mi><mi id="S4.E9.m1.2.2.1.1.1.1.1.3" xref="S4.E9.m1.2.2.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.E9.m1.3.3.2.2.2.2.4" xref="S4.E9.m1.3.3.2.2.2.3.cmml">,</mo><msub id="S4.E9.m1.3.3.2.2.2.2.2" xref="S4.E9.m1.3.3.2.2.2.2.2.cmml"><mi id="S4.E9.m1.3.3.2.2.2.2.2.2" xref="S4.E9.m1.3.3.2.2.2.2.2.2.cmml">b</mi><mi id="S4.E9.m1.3.3.2.2.2.2.2.3" xref="S4.E9.m1.3.3.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S4.E9.m1.3.3.2.2.2.2.5" stretchy="false" xref="S4.E9.m1.3.3.2.2.2.3.cmml">)</mo></mrow></mrow></mrow></msub><mo id="S4.E9.m1.4.4.1.1.1.2" xref="S4.E9.m1.4.4.1.1.1.2.cmml">⁢</mo><mrow id="S4.E9.m1.4.4.1.1.1.1.1" xref="S4.E9.m1.4.4.1.1.1.1.2.cmml"><mo id="S4.E9.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="S4.E9.m1.4.4.1.1.1.1.2.1.cmml">[</mo><mrow id="S4.E9.m1.4.4.1.1.1.1.1.1" xref="S4.E9.m1.4.4.1.1.1.1.1.1.cmml"><mn id="S4.E9.m1.4.4.1.1.1.1.1.1.2" xref="S4.E9.m1.4.4.1.1.1.1.1.1.2.cmml">𝟙</mn><mo id="S4.E9.m1.4.4.1.1.1.1.1.1.1" xref="S4.E9.m1.4.4.1.1.1.1.1.1.1.cmml">⁢</mo><mrow id="S4.E9.m1.1.1.1" xref="S4.E9.m1.1.1.1c.cmml"><mtext id="S4.E9.m1.1.1.1a" xref="S4.E9.m1.1.1.1c.cmml">{</mtext><msub id="S4.E9.m1.1.1.1.m1.1.1" xref="S4.E9.m1.1.1.1.m1.1.1.cmml"><mi id="S4.E9.m1.1.1.1.m1.1.1.2" xref="S4.E9.m1.1.1.1.m1.1.1.2.cmml">y</mi><mi id="S4.E9.m1.1.1.1.m1.1.1.3" xref="S4.E9.m1.1.1.1.m1.1.1.3.cmml">i</mi></msub><mtext id="S4.E9.m1.1.1.1b" xref="S4.E9.m1.1.1.1c.cmml"> is correct}</mtext></mrow></mrow><mo id="S4.E9.m1.4.4.1.1.1.1.1.3" stretchy="false" xref="S4.E9.m1.4.4.1.1.1.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E9.m1.4b"><apply id="S4.E9.m1.4.4.cmml" xref="S4.E9.m1.4.4"><eq id="S4.E9.m1.4.4.2.cmml" xref="S4.E9.m1.4.4.2"></eq><ci id="S4.E9.m1.4.4.3a.cmml" xref="S4.E9.m1.4.4.3"><mtext class="ltx_mathvariant_bold" id="S4.E9.m1.4.4.3.cmml" xref="S4.E9.m1.4.4.3">Expected Success Rate</mtext></ci><apply id="S4.E9.m1.4.4.1.cmml" xref="S4.E9.m1.4.4.1"><times id="S4.E9.m1.4.4.1.2.cmml" xref="S4.E9.m1.4.4.1.2"></times><apply id="S4.E9.m1.4.4.1.3.cmml" xref="S4.E9.m1.4.4.1.3"><divide id="S4.E9.m1.4.4.1.3.1.cmml" xref="S4.E9.m1.4.4.1.3"></divide><cn id="S4.E9.m1.4.4.1.3.2.cmml" type="integer" xref="S4.E9.m1.4.4.1.3.2">1</cn><ci id="S4.E9.m1.4.4.1.3.3.cmml" xref="S4.E9.m1.4.4.1.3.3">𝑛</ci></apply><apply id="S4.E9.m1.4.4.1.1.cmml" xref="S4.E9.m1.4.4.1.1"><apply id="S4.E9.m1.4.4.1.1.2.cmml" xref="S4.E9.m1.4.4.1.1.2"><csymbol cd="ambiguous" id="S4.E9.m1.4.4.1.1.2.1.cmml" xref="S4.E9.m1.4.4.1.1.2">superscript</csymbol><apply id="S4.E9.m1.4.4.1.1.2.2.cmml" xref="S4.E9.m1.4.4.1.1.2"><csymbol cd="ambiguous" id="S4.E9.m1.4.4.1.1.2.2.1.cmml" xref="S4.E9.m1.4.4.1.1.2">subscript</csymbol><sum id="S4.E9.m1.4.4.1.1.2.2.2.cmml" xref="S4.E9.m1.4.4.1.1.2.2.2"></sum><apply id="S4.E9.m1.4.4.1.1.2.2.3.cmml" xref="S4.E9.m1.4.4.1.1.2.2.3"><eq id="S4.E9.m1.4.4.1.1.2.2.3.1.cmml" xref="S4.E9.m1.4.4.1.1.2.2.3.1"></eq><ci id="S4.E9.m1.4.4.1.1.2.2.3.2.cmml" xref="S4.E9.m1.4.4.1.1.2.2.3.2">𝑖</ci><cn id="S4.E9.m1.4.4.1.1.2.2.3.3.cmml" type="integer" xref="S4.E9.m1.4.4.1.1.2.2.3.3">1</cn></apply></apply><ci id="S4.E9.m1.4.4.1.1.2.3.cmml" xref="S4.E9.m1.4.4.1.1.2.3">𝑛</ci></apply><apply id="S4.E9.m1.4.4.1.1.1.cmml" xref="S4.E9.m1.4.4.1.1.1"><times id="S4.E9.m1.4.4.1.1.1.2.cmml" xref="S4.E9.m1.4.4.1.1.1.2"></times><apply id="S4.E9.m1.4.4.1.1.1.3.cmml" xref="S4.E9.m1.4.4.1.1.1.3"><csymbol cd="ambiguous" id="S4.E9.m1.4.4.1.1.1.3.1.cmml" xref="S4.E9.m1.4.4.1.1.1.3">subscript</csymbol><ci id="S4.E9.m1.4.4.1.1.1.3.2.cmml" xref="S4.E9.m1.4.4.1.1.1.3.2">𝔼</ci><apply id="S4.E9.m1.3.3.2.cmml" xref="S4.E9.m1.3.3.2"><csymbol cd="latexml" id="S4.E9.m1.3.3.2.3.cmml" xref="S4.E9.m1.3.3.2.3">similar-to</csymbol><apply id="S4.E9.m1.3.3.2.4.cmml" xref="S4.E9.m1.3.3.2.4"><csymbol cd="ambiguous" id="S4.E9.m1.3.3.2.4.1.cmml" xref="S4.E9.m1.3.3.2.4">subscript</csymbol><ci id="S4.E9.m1.3.3.2.4.2.cmml" xref="S4.E9.m1.3.3.2.4.2">𝑦</ci><ci id="S4.E9.m1.3.3.2.4.3.cmml" xref="S4.E9.m1.3.3.2.4.3">𝑖</ci></apply><apply id="S4.E9.m1.3.3.2.2.cmml" xref="S4.E9.m1.3.3.2.2"><times id="S4.E9.m1.3.3.2.2.3.cmml" xref="S4.E9.m1.3.3.2.2.3"></times><ci id="S4.E9.m1.3.3.2.2.4.cmml" xref="S4.E9.m1.3.3.2.2.4">𝑓</ci><interval closure="open" id="S4.E9.m1.3.3.2.2.2.3.cmml" xref="S4.E9.m1.3.3.2.2.2.2"><apply id="S4.E9.m1.2.2.1.1.1.1.1.cmml" xref="S4.E9.m1.2.2.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E9.m1.2.2.1.1.1.1.1.1.cmml" xref="S4.E9.m1.2.2.1.1.1.1.1">subscript</csymbol><ci id="S4.E9.m1.2.2.1.1.1.1.1.2.cmml" xref="S4.E9.m1.2.2.1.1.1.1.1.2">𝑥</ci><ci id="S4.E9.m1.2.2.1.1.1.1.1.3.cmml" xref="S4.E9.m1.2.2.1.1.1.1.1.3">𝑖</ci></apply><apply id="S4.E9.m1.3.3.2.2.2.2.2.cmml" xref="S4.E9.m1.3.3.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E9.m1.3.3.2.2.2.2.2.1.cmml" xref="S4.E9.m1.3.3.2.2.2.2.2">subscript</csymbol><ci id="S4.E9.m1.3.3.2.2.2.2.2.2.cmml" xref="S4.E9.m1.3.3.2.2.2.2.2.2">𝑏</ci><ci id="S4.E9.m1.3.3.2.2.2.2.2.3.cmml" xref="S4.E9.m1.3.3.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></apply></apply><apply id="S4.E9.m1.4.4.1.1.1.1.2.cmml" xref="S4.E9.m1.4.4.1.1.1.1.1"><csymbol cd="latexml" id="S4.E9.m1.4.4.1.1.1.1.2.1.cmml" xref="S4.E9.m1.4.4.1.1.1.1.1.2">delimited-[]</csymbol><apply id="S4.E9.m1.4.4.1.1.1.1.1.1.cmml" xref="S4.E9.m1.4.4.1.1.1.1.1.1"><times id="S4.E9.m1.4.4.1.1.1.1.1.1.1.cmml" xref="S4.E9.m1.4.4.1.1.1.1.1.1.1"></times><cn id="S4.E9.m1.4.4.1.1.1.1.1.1.2.cmml" type="integer" xref="S4.E9.m1.4.4.1.1.1.1.1.1.2">1</cn><ci id="S4.E9.m1.1.1.1c.cmml" xref="S4.E9.m1.1.1.1"><mrow id="S4.E9.m1.1.1.1.cmml" xref="S4.E9.m1.1.1.1"><mtext id="S4.E9.m1.1.1.1a.cmml" xref="S4.E9.m1.1.1.1">{</mtext><msub id="S4.E9.m1.1.1.1.m1.1.1.cmml" xref="S4.E9.m1.1.1.1.m1.1.1"><mi id="S4.E9.m1.1.1.1.m1.1.1.2.cmml" xref="S4.E9.m1.1.1.1.m1.1.1.2">y</mi><mi id="S4.E9.m1.1.1.1.m1.1.1.3.cmml" xref="S4.E9.m1.1.1.1.m1.1.1.3">i</mi></msub><mtext id="S4.E9.m1.1.1.1b.cmml" xref="S4.E9.m1.1.1.1"> is correct}</mtext></mrow></ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E9.m1.4c">\textbf{Expected Success Rate}=\dfrac{1}{n}\sum_{i=1}^{n}\mathbb{E}_{y_{i}\sim
f%
(x_{i},b_{i})}[\mathds{1}\text{\{$y_{i}$ is correct\}}]</annotation><annotation encoding="application/x-llamapun" id="S4.E9.m1.4d">Expected Success Rate = divide start_ARG 1 end_ARG start_ARG italic_n end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_n end_POSTSUPERSCRIPT blackboard_E start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∼ italic_f ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) end_POSTSUBSCRIPT [ blackboard_1 { italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT is correct} ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(9)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS1.p3.1">where <math alttext="n" class="ltx_Math" display="inline" id="S4.SS1.p3.1.m1.1"><semantics id="S4.SS1.p3.1.m1.1a"><mi id="S4.SS1.p3.1.m1.1.1" xref="S4.SS1.p3.1.m1.1.1.cmml">n</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.1.m1.1b"><ci id="S4.SS1.p3.1.m1.1.1.cmml" xref="S4.SS1.p3.1.m1.1.1">𝑛</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.1.m1.1c">n</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.1.m1.1d">italic_n</annotation></semantics></math> is the number of queries.
Similarly, for Chat, it is the expected reward:</p>
<table class="ltx_equation ltx_eqn_table" id="S4.E10">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="\textbf{Expected Reward}=\dfrac{1}{n}\sum_{i=1}^{N}\mathbb{E}_{y_{i}\sim f(x_{%
i},b_{i})}[r(x,y_{i})]" class="ltx_Math" display="block" id="S4.E10.m1.4"><semantics id="S4.E10.m1.4a"><mrow id="S4.E10.m1.4.4" xref="S4.E10.m1.4.4.cmml"><mtext class="ltx_mathvariant_bold" id="S4.E10.m1.4.4.3" xref="S4.E10.m1.4.4.3a.cmml">Expected Reward</mtext><mo id="S4.E10.m1.4.4.2" xref="S4.E10.m1.4.4.2.cmml">=</mo><mrow id="S4.E10.m1.4.4.1" xref="S4.E10.m1.4.4.1.cmml"><mfrac id="S4.E10.m1.4.4.1.3" xref="S4.E10.m1.4.4.1.3.cmml"><mn id="S4.E10.m1.4.4.1.3.2" xref="S4.E10.m1.4.4.1.3.2.cmml">1</mn><mi id="S4.E10.m1.4.4.1.3.3" xref="S4.E10.m1.4.4.1.3.3.cmml">n</mi></mfrac><mo id="S4.E10.m1.4.4.1.2" xref="S4.E10.m1.4.4.1.2.cmml">⁢</mo><mrow id="S4.E10.m1.4.4.1.1" xref="S4.E10.m1.4.4.1.1.cmml"><munderover id="S4.E10.m1.4.4.1.1.2" xref="S4.E10.m1.4.4.1.1.2.cmml"><mo id="S4.E10.m1.4.4.1.1.2.2.2" movablelimits="false" xref="S4.E10.m1.4.4.1.1.2.2.2.cmml">∑</mo><mrow id="S4.E10.m1.4.4.1.1.2.2.3" xref="S4.E10.m1.4.4.1.1.2.2.3.cmml"><mi id="S4.E10.m1.4.4.1.1.2.2.3.2" xref="S4.E10.m1.4.4.1.1.2.2.3.2.cmml">i</mi><mo id="S4.E10.m1.4.4.1.1.2.2.3.1" xref="S4.E10.m1.4.4.1.1.2.2.3.1.cmml">=</mo><mn id="S4.E10.m1.4.4.1.1.2.2.3.3" xref="S4.E10.m1.4.4.1.1.2.2.3.3.cmml">1</mn></mrow><mi id="S4.E10.m1.4.4.1.1.2.3" xref="S4.E10.m1.4.4.1.1.2.3.cmml">N</mi></munderover><mrow id="S4.E10.m1.4.4.1.1.1" xref="S4.E10.m1.4.4.1.1.1.cmml"><msub id="S4.E10.m1.4.4.1.1.1.3" xref="S4.E10.m1.4.4.1.1.1.3.cmml"><mi id="S4.E10.m1.4.4.1.1.1.3.2" xref="S4.E10.m1.4.4.1.1.1.3.2.cmml">𝔼</mi><mrow id="S4.E10.m1.2.2.2" xref="S4.E10.m1.2.2.2.cmml"><msub id="S4.E10.m1.2.2.2.4" xref="S4.E10.m1.2.2.2.4.cmml"><mi id="S4.E10.m1.2.2.2.4.2" xref="S4.E10.m1.2.2.2.4.2.cmml">y</mi><mi id="S4.E10.m1.2.2.2.4.3" xref="S4.E10.m1.2.2.2.4.3.cmml">i</mi></msub><mo id="S4.E10.m1.2.2.2.3" xref="S4.E10.m1.2.2.2.3.cmml">∼</mo><mrow id="S4.E10.m1.2.2.2.2" xref="S4.E10.m1.2.2.2.2.cmml"><mi id="S4.E10.m1.2.2.2.2.4" xref="S4.E10.m1.2.2.2.2.4.cmml">f</mi><mo id="S4.E10.m1.2.2.2.2.3" xref="S4.E10.m1.2.2.2.2.3.cmml">⁢</mo><mrow id="S4.E10.m1.2.2.2.2.2.2" xref="S4.E10.m1.2.2.2.2.2.3.cmml"><mo id="S4.E10.m1.2.2.2.2.2.2.3" stretchy="false" xref="S4.E10.m1.2.2.2.2.2.3.cmml">(</mo><msub id="S4.E10.m1.1.1.1.1.1.1.1" xref="S4.E10.m1.1.1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.1.1.1.1.1.1.1.2" xref="S4.E10.m1.1.1.1.1.1.1.1.2.cmml">x</mi><mi id="S4.E10.m1.1.1.1.1.1.1.1.3" xref="S4.E10.m1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.E10.m1.2.2.2.2.2.2.4" xref="S4.E10.m1.2.2.2.2.2.3.cmml">,</mo><msub id="S4.E10.m1.2.2.2.2.2.2.2" xref="S4.E10.m1.2.2.2.2.2.2.2.cmml"><mi id="S4.E10.m1.2.2.2.2.2.2.2.2" xref="S4.E10.m1.2.2.2.2.2.2.2.2.cmml">b</mi><mi id="S4.E10.m1.2.2.2.2.2.2.2.3" xref="S4.E10.m1.2.2.2.2.2.2.2.3.cmml">i</mi></msub><mo id="S4.E10.m1.2.2.2.2.2.2.5" stretchy="false" xref="S4.E10.m1.2.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow></msub><mo id="S4.E10.m1.4.4.1.1.1.2" xref="S4.E10.m1.4.4.1.1.1.2.cmml">⁢</mo><mrow id="S4.E10.m1.4.4.1.1.1.1.1" xref="S4.E10.m1.4.4.1.1.1.1.2.cmml"><mo id="S4.E10.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="S4.E10.m1.4.4.1.1.1.1.2.1.cmml">[</mo><mrow id="S4.E10.m1.4.4.1.1.1.1.1.1" xref="S4.E10.m1.4.4.1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.4.4.1.1.1.1.1.1.3" xref="S4.E10.m1.4.4.1.1.1.1.1.1.3.cmml">r</mi><mo id="S4.E10.m1.4.4.1.1.1.1.1.1.2" xref="S4.E10.m1.4.4.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.2.cmml"><mo id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.2.cmml">(</mo><mi id="S4.E10.m1.3.3" xref="S4.E10.m1.3.3.cmml">x</mi><mo id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.3" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.cmml"><mi id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.2" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mi id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.3" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml">i</mi></msub><mo id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.4" stretchy="false" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S4.E10.m1.4.4.1.1.1.1.1.3" stretchy="false" xref="S4.E10.m1.4.4.1.1.1.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.E10.m1.4b"><apply id="S4.E10.m1.4.4.cmml" xref="S4.E10.m1.4.4"><eq id="S4.E10.m1.4.4.2.cmml" xref="S4.E10.m1.4.4.2"></eq><ci id="S4.E10.m1.4.4.3a.cmml" xref="S4.E10.m1.4.4.3"><mtext class="ltx_mathvariant_bold" id="S4.E10.m1.4.4.3.cmml" xref="S4.E10.m1.4.4.3">Expected Reward</mtext></ci><apply id="S4.E10.m1.4.4.1.cmml" xref="S4.E10.m1.4.4.1"><times id="S4.E10.m1.4.4.1.2.cmml" xref="S4.E10.m1.4.4.1.2"></times><apply id="S4.E10.m1.4.4.1.3.cmml" xref="S4.E10.m1.4.4.1.3"><divide id="S4.E10.m1.4.4.1.3.1.cmml" xref="S4.E10.m1.4.4.1.3"></divide><cn id="S4.E10.m1.4.4.1.3.2.cmml" type="integer" xref="S4.E10.m1.4.4.1.3.2">1</cn><ci id="S4.E10.m1.4.4.1.3.3.cmml" xref="S4.E10.m1.4.4.1.3.3">𝑛</ci></apply><apply id="S4.E10.m1.4.4.1.1.cmml" xref="S4.E10.m1.4.4.1.1"><apply id="S4.E10.m1.4.4.1.1.2.cmml" xref="S4.E10.m1.4.4.1.1.2"><csymbol cd="ambiguous" id="S4.E10.m1.4.4.1.1.2.1.cmml" xref="S4.E10.m1.4.4.1.1.2">superscript</csymbol><apply id="S4.E10.m1.4.4.1.1.2.2.cmml" xref="S4.E10.m1.4.4.1.1.2"><csymbol cd="ambiguous" id="S4.E10.m1.4.4.1.1.2.2.1.cmml" xref="S4.E10.m1.4.4.1.1.2">subscript</csymbol><sum id="S4.E10.m1.4.4.1.1.2.2.2.cmml" xref="S4.E10.m1.4.4.1.1.2.2.2"></sum><apply id="S4.E10.m1.4.4.1.1.2.2.3.cmml" xref="S4.E10.m1.4.4.1.1.2.2.3"><eq id="S4.E10.m1.4.4.1.1.2.2.3.1.cmml" xref="S4.E10.m1.4.4.1.1.2.2.3.1"></eq><ci id="S4.E10.m1.4.4.1.1.2.2.3.2.cmml" xref="S4.E10.m1.4.4.1.1.2.2.3.2">𝑖</ci><cn id="S4.E10.m1.4.4.1.1.2.2.3.3.cmml" type="integer" xref="S4.E10.m1.4.4.1.1.2.2.3.3">1</cn></apply></apply><ci id="S4.E10.m1.4.4.1.1.2.3.cmml" xref="S4.E10.m1.4.4.1.1.2.3">𝑁</ci></apply><apply id="S4.E10.m1.4.4.1.1.1.cmml" xref="S4.E10.m1.4.4.1.1.1"><times id="S4.E10.m1.4.4.1.1.1.2.cmml" xref="S4.E10.m1.4.4.1.1.1.2"></times><apply id="S4.E10.m1.4.4.1.1.1.3.cmml" xref="S4.E10.m1.4.4.1.1.1.3"><csymbol cd="ambiguous" id="S4.E10.m1.4.4.1.1.1.3.1.cmml" xref="S4.E10.m1.4.4.1.1.1.3">subscript</csymbol><ci id="S4.E10.m1.4.4.1.1.1.3.2.cmml" xref="S4.E10.m1.4.4.1.1.1.3.2">𝔼</ci><apply id="S4.E10.m1.2.2.2.cmml" xref="S4.E10.m1.2.2.2"><csymbol cd="latexml" id="S4.E10.m1.2.2.2.3.cmml" xref="S4.E10.m1.2.2.2.3">similar-to</csymbol><apply id="S4.E10.m1.2.2.2.4.cmml" xref="S4.E10.m1.2.2.2.4"><csymbol cd="ambiguous" id="S4.E10.m1.2.2.2.4.1.cmml" xref="S4.E10.m1.2.2.2.4">subscript</csymbol><ci id="S4.E10.m1.2.2.2.4.2.cmml" xref="S4.E10.m1.2.2.2.4.2">𝑦</ci><ci id="S4.E10.m1.2.2.2.4.3.cmml" xref="S4.E10.m1.2.2.2.4.3">𝑖</ci></apply><apply id="S4.E10.m1.2.2.2.2.cmml" xref="S4.E10.m1.2.2.2.2"><times id="S4.E10.m1.2.2.2.2.3.cmml" xref="S4.E10.m1.2.2.2.2.3"></times><ci id="S4.E10.m1.2.2.2.2.4.cmml" xref="S4.E10.m1.2.2.2.2.4">𝑓</ci><interval closure="open" id="S4.E10.m1.2.2.2.2.2.3.cmml" xref="S4.E10.m1.2.2.2.2.2.2"><apply id="S4.E10.m1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E10.m1.1.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.2">𝑥</ci><ci id="S4.E10.m1.1.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.1.1.1.1.1.1.1.3">𝑖</ci></apply><apply id="S4.E10.m1.2.2.2.2.2.2.2.cmml" xref="S4.E10.m1.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S4.E10.m1.2.2.2.2.2.2.2.1.cmml" xref="S4.E10.m1.2.2.2.2.2.2.2">subscript</csymbol><ci id="S4.E10.m1.2.2.2.2.2.2.2.2.cmml" xref="S4.E10.m1.2.2.2.2.2.2.2.2">𝑏</ci><ci id="S4.E10.m1.2.2.2.2.2.2.2.3.cmml" xref="S4.E10.m1.2.2.2.2.2.2.2.3">𝑖</ci></apply></interval></apply></apply></apply><apply id="S4.E10.m1.4.4.1.1.1.1.2.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1"><csymbol cd="latexml" id="S4.E10.m1.4.4.1.1.1.1.2.1.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.2">delimited-[]</csymbol><apply id="S4.E10.m1.4.4.1.1.1.1.1.1.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.1"><times id="S4.E10.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.1.2"></times><ci id="S4.E10.m1.4.4.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.1.3">𝑟</ci><interval closure="open" id="S4.E10.m1.4.4.1.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.1"><ci id="S4.E10.m1.3.3.cmml" xref="S4.E10.m1.3.3">𝑥</ci><apply id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.1.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.2.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.2">𝑦</ci><ci id="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.3.cmml" xref="S4.E10.m1.4.4.1.1.1.1.1.1.1.1.1.3">𝑖</ci></apply></interval></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.E10.m1.4c">\textbf{Expected Reward}=\dfrac{1}{n}\sum_{i=1}^{N}\mathbb{E}_{y_{i}\sim f(x_{%
i},b_{i})}[r(x,y_{i})]</annotation><annotation encoding="application/x-llamapun" id="S4.E10.m1.4d">Expected Reward = divide start_ARG 1 end_ARG start_ARG italic_n end_ARG ∑ start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_N end_POSTSUPERSCRIPT blackboard_E start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∼ italic_f ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT , italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) end_POSTSUBSCRIPT [ italic_r ( italic_x , italic_y start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(10)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S4.SS1.p3.3">To estimate these in practice, we sample a large number of generations <math alttext="B_{max}" class="ltx_Math" display="inline" id="S4.SS1.p3.2.m1.1"><semantics id="S4.SS1.p3.2.m1.1a"><msub id="S4.SS1.p3.2.m1.1.1" xref="S4.SS1.p3.2.m1.1.1.cmml"><mi id="S4.SS1.p3.2.m1.1.1.2" xref="S4.SS1.p3.2.m1.1.1.2.cmml">B</mi><mrow id="S4.SS1.p3.2.m1.1.1.3" xref="S4.SS1.p3.2.m1.1.1.3.cmml"><mi id="S4.SS1.p3.2.m1.1.1.3.2" xref="S4.SS1.p3.2.m1.1.1.3.2.cmml">m</mi><mo id="S4.SS1.p3.2.m1.1.1.3.1" xref="S4.SS1.p3.2.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m1.1.1.3.3" xref="S4.SS1.p3.2.m1.1.1.3.3.cmml">a</mi><mo id="S4.SS1.p3.2.m1.1.1.3.1a" xref="S4.SS1.p3.2.m1.1.1.3.1.cmml">⁢</mo><mi id="S4.SS1.p3.2.m1.1.1.3.4" xref="S4.SS1.p3.2.m1.1.1.3.4.cmml">x</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.2.m1.1b"><apply id="S4.SS1.p3.2.m1.1.1.cmml" xref="S4.SS1.p3.2.m1.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.2.m1.1.1.1.cmml" xref="S4.SS1.p3.2.m1.1.1">subscript</csymbol><ci id="S4.SS1.p3.2.m1.1.1.2.cmml" xref="S4.SS1.p3.2.m1.1.1.2">𝐵</ci><apply id="S4.SS1.p3.2.m1.1.1.3.cmml" xref="S4.SS1.p3.2.m1.1.1.3"><times id="S4.SS1.p3.2.m1.1.1.3.1.cmml" xref="S4.SS1.p3.2.m1.1.1.3.1"></times><ci id="S4.SS1.p3.2.m1.1.1.3.2.cmml" xref="S4.SS1.p3.2.m1.1.1.3.2">𝑚</ci><ci id="S4.SS1.p3.2.m1.1.1.3.3.cmml" xref="S4.SS1.p3.2.m1.1.1.3.3">𝑎</ci><ci id="S4.SS1.p3.2.m1.1.1.3.4.cmml" xref="S4.SS1.p3.2.m1.1.1.3.4">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.2.m1.1c">B_{max}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.2.m1.1d">italic_B start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> for each query and then use bootstrapping to approximate the expectation for different <math alttext="b_{i}" class="ltx_Math" display="inline" id="S4.SS1.p3.3.m2.1"><semantics id="S4.SS1.p3.3.m2.1a"><msub id="S4.SS1.p3.3.m2.1.1" xref="S4.SS1.p3.3.m2.1.1.cmml"><mi id="S4.SS1.p3.3.m2.1.1.2" xref="S4.SS1.p3.3.m2.1.1.2.cmml">b</mi><mi id="S4.SS1.p3.3.m2.1.1.3" xref="S4.SS1.p3.3.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS1.p3.3.m2.1b"><apply id="S4.SS1.p3.3.m2.1.1.cmml" xref="S4.SS1.p3.3.m2.1.1"><csymbol cd="ambiguous" id="S4.SS1.p3.3.m2.1.1.1.cmml" xref="S4.SS1.p3.3.m2.1.1">subscript</csymbol><ci id="S4.SS1.p3.3.m2.1.1.2.cmml" xref="S4.SS1.p3.3.m2.1.1.2">𝑏</ci><ci id="S4.SS1.p3.3.m2.1.1.3.cmml" xref="S4.SS1.p3.3.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p3.3.m2.1c">b_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p3.3.m2.1d">italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> .</p>
</div>
<figure class="ltx_figure" id="S4.F3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="428" id="S4.F3.g1" src="x3.png" width="761"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span><span class="ltx_text ltx_font_bold" id="S4.F3.6.1">Results on Code and Math</span>. The left column shows the distribution of LM success probabilities across queries. A significant number of problems on Code have <math alttext="0\%" class="ltx_Math" display="inline" id="S4.F3.3.m1.1"><semantics id="S4.F3.3.m1.1b"><mrow id="S4.F3.3.m1.1.1" xref="S4.F3.3.m1.1.1.cmml"><mn id="S4.F3.3.m1.1.1.2" xref="S4.F3.3.m1.1.1.2.cmml">0</mn><mo id="S4.F3.3.m1.1.1.1" xref="S4.F3.3.m1.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.F3.3.m1.1c"><apply id="S4.F3.3.m1.1.1.cmml" xref="S4.F3.3.m1.1.1"><csymbol cd="latexml" id="S4.F3.3.m1.1.1.1.cmml" xref="S4.F3.3.m1.1.1.1">percent</csymbol><cn id="S4.F3.3.m1.1.1.2.cmml" type="integer" xref="S4.F3.3.m1.1.1.2">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.F3.3.m1.1d">0\%</annotation><annotation encoding="application/x-llamapun" id="S4.F3.3.m1.1e">0 %</annotation></semantics></math> success rate, while Math has a flatter distribution of difficulty. The middle column compares predicted marginal reward predictors to ground-truth values, alongside calibration curves (our predictors are well calibrated with the ground truth). Finally, the right column shows the performance curves for tested methods. Here, we observe that adaptive computation generally outperforms the best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.F3.4.m2.1"><semantics id="S4.F3.4.m2.1b"><mi id="S4.F3.4.m2.1.1" xref="S4.F3.4.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.F3.4.m2.1c"><ci id="S4.F3.4.m2.1.1.cmml" xref="S4.F3.4.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F3.4.m2.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.F3.4.m2.1e">italic_k</annotation></semantics></math> baseline.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S4.SS1.p4">
<p class="ltx_p" id="S4.SS1.p4.4">The compute budget <math alttext="B" class="ltx_Math" display="inline" id="S4.SS1.p4.1.m1.1"><semantics id="S4.SS1.p4.1.m1.1a"><mi id="S4.SS1.p4.1.m1.1.1" xref="S4.SS1.p4.1.m1.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p4.1.m1.1b"><ci id="S4.SS1.p4.1.m1.1.1.cmml" xref="S4.SS1.p4.1.m1.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p4.1.m1.1c">B</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p4.1.m1.1d">italic_B</annotation></semantics></math> is the average number of samples that may be drawn per query. Best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.p4.2.m2.1"><semantics id="S4.SS1.p4.2.m2.1a"><mi id="S4.SS1.p4.2.m2.1.1" xref="S4.SS1.p4.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p4.2.m2.1b"><ci id="S4.SS1.p4.2.m2.1.1.cmml" xref="S4.SS1.p4.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p4.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p4.2.m2.1d">italic_k</annotation></semantics></math> with <math alttext="k=B" class="ltx_Math" display="inline" id="S4.SS1.p4.3.m3.1"><semantics id="S4.SS1.p4.3.m3.1a"><mrow id="S4.SS1.p4.3.m3.1.1" xref="S4.SS1.p4.3.m3.1.1.cmml"><mi id="S4.SS1.p4.3.m3.1.1.2" xref="S4.SS1.p4.3.m3.1.1.2.cmml">k</mi><mo id="S4.SS1.p4.3.m3.1.1.1" xref="S4.SS1.p4.3.m3.1.1.1.cmml">=</mo><mi id="S4.SS1.p4.3.m3.1.1.3" xref="S4.SS1.p4.3.m3.1.1.3.cmml">B</mi></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p4.3.m3.1b"><apply id="S4.SS1.p4.3.m3.1.1.cmml" xref="S4.SS1.p4.3.m3.1.1"><eq id="S4.SS1.p4.3.m3.1.1.1.cmml" xref="S4.SS1.p4.3.m3.1.1.1"></eq><ci id="S4.SS1.p4.3.m3.1.1.2.cmml" xref="S4.SS1.p4.3.m3.1.1.2">𝑘</ci><ci id="S4.SS1.p4.3.m3.1.1.3.cmml" xref="S4.SS1.p4.3.m3.1.1.3">𝐵</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p4.3.m3.1c">k=B</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p4.3.m3.1d">italic_k = italic_B</annotation></semantics></math> uses the same number of total samples as our adaptive method.
We plot the performance of different methods for different compute budgets, where budgets are specified in terms of <math alttext="B" class="ltx_Math" display="inline" id="S4.SS1.p4.4.m4.1"><semantics id="S4.SS1.p4.4.m4.1a"><mi id="S4.SS1.p4.4.m4.1.1" xref="S4.SS1.p4.4.m4.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.p4.4.m4.1b"><ci id="S4.SS1.p4.4.m4.1.1.cmml" xref="S4.SS1.p4.4.m4.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p4.4.m4.1c">B</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p4.4.m4.1d">italic_B</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.p5">
<p class="ltx_p" id="S4.SS1.p5.3">Note that, in the binary reward-based Math and Code domains, it may be efficient to set <math alttext="b_{i}=0" class="ltx_Math" display="inline" id="S4.SS1.p5.1.m1.1"><semantics id="S4.SS1.p5.1.m1.1a"><mrow id="S4.SS1.p5.1.m1.1.1" xref="S4.SS1.p5.1.m1.1.1.cmml"><msub id="S4.SS1.p5.1.m1.1.1.2" xref="S4.SS1.p5.1.m1.1.1.2.cmml"><mi id="S4.SS1.p5.1.m1.1.1.2.2" xref="S4.SS1.p5.1.m1.1.1.2.2.cmml">b</mi><mi id="S4.SS1.p5.1.m1.1.1.2.3" xref="S4.SS1.p5.1.m1.1.1.2.3.cmml">i</mi></msub><mo id="S4.SS1.p5.1.m1.1.1.1" xref="S4.SS1.p5.1.m1.1.1.1.cmml">=</mo><mn id="S4.SS1.p5.1.m1.1.1.3" xref="S4.SS1.p5.1.m1.1.1.3.cmml">0</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p5.1.m1.1b"><apply id="S4.SS1.p5.1.m1.1.1.cmml" xref="S4.SS1.p5.1.m1.1.1"><eq id="S4.SS1.p5.1.m1.1.1.1.cmml" xref="S4.SS1.p5.1.m1.1.1.1"></eq><apply id="S4.SS1.p5.1.m1.1.1.2.cmml" xref="S4.SS1.p5.1.m1.1.1.2"><csymbol cd="ambiguous" id="S4.SS1.p5.1.m1.1.1.2.1.cmml" xref="S4.SS1.p5.1.m1.1.1.2">subscript</csymbol><ci id="S4.SS1.p5.1.m1.1.1.2.2.cmml" xref="S4.SS1.p5.1.m1.1.1.2.2">𝑏</ci><ci id="S4.SS1.p5.1.m1.1.1.2.3.cmml" xref="S4.SS1.p5.1.m1.1.1.2.3">𝑖</ci></apply><cn id="S4.SS1.p5.1.m1.1.1.3.cmml" type="integer" xref="S4.SS1.p5.1.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p5.1.m1.1c">b_{i}=0</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p5.1.m1.1d">italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT = 0</annotation></semantics></math> for some queries, as many problems have a <math alttext="0" class="ltx_Math" display="inline" id="S4.SS1.p5.2.m2.1"><semantics id="S4.SS1.p5.2.m2.1a"><mn id="S4.SS1.p5.2.m2.1.1" xref="S4.SS1.p5.2.m2.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S4.SS1.p5.2.m2.1b"><cn id="S4.SS1.p5.2.m2.1.1.cmml" type="integer" xref="S4.SS1.p5.2.m2.1.1">0</cn></annotation-xml></semantics></math>% success rate. In these cases, a default response such as <span class="ltx_text ltx_font_italic" id="S4.SS1.p5.3.1">I don’t know</span> may be returned, allowing the sample budget to be allocated more effectively elsewhere. For chat experiments, we require all <math alttext="b_{i}\geq 1" class="ltx_Math" display="inline" id="S4.SS1.p5.3.m3.1"><semantics id="S4.SS1.p5.3.m3.1a"><mrow id="S4.SS1.p5.3.m3.1.1" xref="S4.SS1.p5.3.m3.1.1.cmml"><msub id="S4.SS1.p5.3.m3.1.1.2" xref="S4.SS1.p5.3.m3.1.1.2.cmml"><mi id="S4.SS1.p5.3.m3.1.1.2.2" xref="S4.SS1.p5.3.m3.1.1.2.2.cmml">b</mi><mi id="S4.SS1.p5.3.m3.1.1.2.3" xref="S4.SS1.p5.3.m3.1.1.2.3.cmml">i</mi></msub><mo id="S4.SS1.p5.3.m3.1.1.1" xref="S4.SS1.p5.3.m3.1.1.1.cmml">≥</mo><mn id="S4.SS1.p5.3.m3.1.1.3" xref="S4.SS1.p5.3.m3.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.p5.3.m3.1b"><apply id="S4.SS1.p5.3.m3.1.1.cmml" xref="S4.SS1.p5.3.m3.1.1"><geq id="S4.SS1.p5.3.m3.1.1.1.cmml" xref="S4.SS1.p5.3.m3.1.1.1"></geq><apply id="S4.SS1.p5.3.m3.1.1.2.cmml" xref="S4.SS1.p5.3.m3.1.1.2"><csymbol cd="ambiguous" id="S4.SS1.p5.3.m3.1.1.2.1.cmml" xref="S4.SS1.p5.3.m3.1.1.2">subscript</csymbol><ci id="S4.SS1.p5.3.m3.1.1.2.2.cmml" xref="S4.SS1.p5.3.m3.1.1.2.2">𝑏</ci><ci id="S4.SS1.p5.3.m3.1.1.2.3.cmml" xref="S4.SS1.p5.3.m3.1.1.2.3">𝑖</ci></apply><cn id="S4.SS1.p5.3.m3.1.1.3.cmml" type="integer" xref="S4.SS1.p5.3.m3.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.p5.3.m3.1c">b_{i}\geq 1</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.p5.3.m3.1d">italic_b start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ≥ 1</annotation></semantics></math> .</p>
</div>
<section class="ltx_subsubsection" id="S4.SS1.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">Code</h4>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSSx1.p1">
<p class="ltx_p" id="S4.SS1.SSSx1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx1.p1.1.1">Setup:</span> For the coding experiments, we adopt a subset of <span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx1.p1.1.2">TACO</span>, a dataset focused on algorithmic code generation with problems sourced from various programming contest platforms <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib16" title="">2023</a>)</cite>.
We use a custom off-the-shelf <span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx1.p1.1.3">Starcoder-15B</span> model, which was released by the creators of the TACO dataset after fine-tuning on the dataset.
We use the official open-source evaluation framework released with TACO. A generation is classified as a success if it passes all test cases.
Finally, as unit tests serve as a verifier, a method is considered successful on a query if at least one of its <math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx1.p1.1.m1.1"><semantics id="S4.SS1.SSSx1.p1.1.m1.1a"><mi id="S4.SS1.SSSx1.p1.1.m1.1.1" xref="S4.SS1.SSSx1.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx1.p1.1.m1.1b"><ci id="S4.SS1.SSSx1.p1.1.m1.1.1.cmml" xref="S4.SS1.SSSx1.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx1.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx1.p1.1.m1.1d">italic_k</annotation></semantics></math> generations passes all test cases.
We use the MLP variant to learn the marginal rewards.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSSx1.p2">
<p class="ltx_p" id="S4.SS1.SSSx1.p2.3"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx1.p2.3.1">Results:</span>
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.F3" title="Figure 3 ‣ 4.1 Adaptive Best-of-k ‣ 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">3</span></a> present success rates for the code dataset.
We first observe that while our methods perform significantly better in the low-budget regime (<math alttext="B&lt;8" class="ltx_Math" display="inline" id="S4.SS1.SSSx1.p2.1.m1.1"><semantics id="S4.SS1.SSSx1.p2.1.m1.1a"><mrow id="S4.SS1.SSSx1.p2.1.m1.1.1" xref="S4.SS1.SSSx1.p2.1.m1.1.1.cmml"><mi id="S4.SS1.SSSx1.p2.1.m1.1.1.2" xref="S4.SS1.SSSx1.p2.1.m1.1.1.2.cmml">B</mi><mo id="S4.SS1.SSSx1.p2.1.m1.1.1.1" xref="S4.SS1.SSSx1.p2.1.m1.1.1.1.cmml">&lt;</mo><mn id="S4.SS1.SSSx1.p2.1.m1.1.1.3" xref="S4.SS1.SSSx1.p2.1.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx1.p2.1.m1.1b"><apply id="S4.SS1.SSSx1.p2.1.m1.1.1.cmml" xref="S4.SS1.SSSx1.p2.1.m1.1.1"><lt id="S4.SS1.SSSx1.p2.1.m1.1.1.1.cmml" xref="S4.SS1.SSSx1.p2.1.m1.1.1.1"></lt><ci id="S4.SS1.SSSx1.p2.1.m1.1.1.2.cmml" xref="S4.SS1.SSSx1.p2.1.m1.1.1.2">𝐵</ci><cn id="S4.SS1.SSSx1.p2.1.m1.1.1.3.cmml" type="integer" xref="S4.SS1.SSSx1.p2.1.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx1.p2.1.m1.1c">B&lt;8</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx1.p2.1.m1.1d">italic_B &lt; 8</annotation></semantics></math>), the results in the moderate-to-high budget regime are mixed.
Counter-intuitively, while our offline variant always outperforms best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx1.p2.2.m2.1"><semantics id="S4.SS1.SSSx1.p2.2.m2.1a"><mi id="S4.SS1.SSSx1.p2.2.m2.1.1" xref="S4.SS1.SSSx1.p2.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx1.p2.2.m2.1b"><ci id="S4.SS1.SSSx1.p2.2.m2.1.1.cmml" xref="S4.SS1.SSSx1.p2.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx1.p2.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx1.p2.2.m2.1d">italic_k</annotation></semantics></math>, our online variant actually falls below the best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx1.p2.3.m3.1"><semantics id="S4.SS1.SSSx1.p2.3.m3.1a"><mi id="S4.SS1.SSSx1.p2.3.m3.1.1" xref="S4.SS1.SSSx1.p2.3.m3.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx1.p2.3.m3.1b"><ci id="S4.SS1.SSSx1.p2.3.m3.1.1.cmml" xref="S4.SS1.SSSx1.p2.3.m3.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx1.p2.3.m3.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx1.p2.3.m3.1d">italic_k</annotation></semantics></math> curve in the high-budget regime.
This is because small errors in the learned marginal reward predictor can hugely impact solutions to the allocation problem (if a problem has a true success rate of 0%, but its success rate is predicted to be 1%, it becomes an attractive candidate for a large budget).
50% of problems in the coding dataset have 0 success probability (for Math, this is only 5%).
The offline variant avoids this pathology by binning impossible and low-probability solutions together, effectively “regularizing” allocations.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSSx1.p3">
<p class="ltx_p" id="S4.SS1.SSSx1.p3.1">In summary, the coding results bring to light the fact that prediction errors in marginal reward can adversely impact online allocation.
At the same time, the consistent outperformance of the offline variant over best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx1.p3.1.m1.1"><semantics id="S4.SS1.SSSx1.p3.1.m1.1a"><mi id="S4.SS1.SSSx1.p3.1.m1.1.1" xref="S4.SS1.SSSx1.p3.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx1.p3.1.m1.1b"><ci id="S4.SS1.SSSx1.p3.1.m1.1.1.cmml" xref="S4.SS1.SSSx1.p3.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx1.p3.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx1.p3.1.m1.1d">italic_k</annotation></semantics></math> reinforces the value of adaptive compute budget allocation.</p>
</div>
</section>
<section class="ltx_subsubsection" id="S4.SS1.SSSx2">
<h4 class="ltx_title ltx_title_subsubsection">Math</h4>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSSx2.p1">
<p class="ltx_p" id="S4.SS1.SSSx2.p1.3"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx2.p1.3.1">Setup:</span> We use a subset of the <span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx2.p1.3.2">Numina-COT Dataset</span> <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib15" title="">2024</a>)</cite>, which contains Math problems obtained from diverse sources.
We use Mistral AI’s <span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx2.p1.3.3">Mathstral-7B</span> model, which is specialized for mathematical tasks, and is based on Mistral 7B <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib14" title="">2023</a>)</cite>.
We use this model directly off-the-shelf and do not perform any fine-tuning.
We use an oracle verifier to select the best answer out of <math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx2.p1.1.m1.1"><semantics id="S4.SS1.SSSx2.p1.1.m1.1a"><mi id="S4.SS1.SSSx2.p1.1.m1.1.1" xref="S4.SS1.SSSx2.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx2.p1.1.m1.1b"><ci id="S4.SS1.SSSx2.p1.1.m1.1.1.cmml" xref="S4.SS1.SSSx2.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p1.1.m1.1d">italic_k</annotation></semantics></math>.
This implies that if the model generates at least one correct answer out of <math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx2.p1.2.m2.1"><semantics id="S4.SS1.SSSx2.p1.2.m2.1a"><mi id="S4.SS1.SSSx2.p1.2.m2.1.1" xref="S4.SS1.SSSx2.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx2.p1.2.m2.1b"><ci id="S4.SS1.SSSx2.p1.2.m2.1.1.cmml" xref="S4.SS1.SSSx2.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p1.2.m2.1d">italic_k</annotation></semantics></math>, it will be successful.
The verifier uses a <math alttext="2" class="ltx_Math" display="inline" id="S4.SS1.SSSx2.p1.3.m3.1"><semantics id="S4.SS1.SSSx2.p1.3.m3.1a"><mn id="S4.SS1.SSSx2.p1.3.m3.1.1" xref="S4.SS1.SSSx2.p1.3.m3.1.1.cmml">2</mn><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx2.p1.3.m3.1b"><cn id="S4.SS1.SSSx2.p1.3.m3.1.1.cmml" type="integer" xref="S4.SS1.SSSx2.p1.3.m3.1.1">2</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p1.3.m3.1c">2</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p1.3.m3.1d">2</annotation></semantics></math>-stage pipeline that employs the evaluation framework of Hendrycks et al. in the first stage and a custom LLM-verifier in the second stage <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib11" title="">2021</a>)</cite>. This pipeline is detailed in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#A1" title="Appendix A Experiment Details ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">A</span></a>.
We used the LoRa variant to learn the marginal rewards.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSSx2.p2">
<p class="ltx_p" id="S4.SS1.SSSx2.p2.6"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx2.p2.6.1">Results:</span>
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.F3" title="Figure 3 ‣ 4.1 Adaptive Best-of-k ‣ 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">3</span></a> illustrates the success rate across different compute budgets.
Our online and offline methods consistently outperform best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx2.p2.1.m1.1"><semantics id="S4.SS1.SSSx2.p2.1.m1.1a"><mi id="S4.SS1.SSSx2.p2.1.m1.1.1" xref="S4.SS1.SSSx2.p2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx2.p2.1.m1.1b"><ci id="S4.SS1.SSSx2.p2.1.m1.1.1.cmml" xref="S4.SS1.SSSx2.p2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p2.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p2.1.m1.1d">italic_k</annotation></semantics></math> for all compute budgets.
While the improvements are marginal in the low-budget regime (<math alttext="B&lt;8)" class="ltx_math_unparsed" display="inline" id="S4.SS1.SSSx2.p2.2.m2.1"><semantics id="S4.SS1.SSSx2.p2.2.m2.1a"><mrow id="S4.SS1.SSSx2.p2.2.m2.1b"><mi id="S4.SS1.SSSx2.p2.2.m2.1.1">B</mi><mo id="S4.SS1.SSSx2.p2.2.m2.1.2">&lt;</mo><mn id="S4.SS1.SSSx2.p2.2.m2.1.3">8</mn><mo id="S4.SS1.SSSx2.p2.2.m2.1.4" stretchy="false">)</mo></mrow><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p2.2.m2.1c">B&lt;8)</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p2.2.m2.1d">italic_B &lt; 8 )</annotation></semantics></math>, adaptive computation shines in the moderate-to-high budget settings (<math alttext="B\geq 8)" class="ltx_math_unparsed" display="inline" id="S4.SS1.SSSx2.p2.3.m3.1"><semantics id="S4.SS1.SSSx2.p2.3.m3.1a"><mrow id="S4.SS1.SSSx2.p2.3.m3.1b"><mi id="S4.SS1.SSSx2.p2.3.m3.1.1">B</mi><mo id="S4.SS1.SSSx2.p2.3.m3.1.2">≥</mo><mn id="S4.SS1.SSSx2.p2.3.m3.1.3">8</mn><mo id="S4.SS1.SSSx2.p2.3.m3.1.4" stretchy="false">)</mo></mrow><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p2.3.m3.1c">B\geq 8)</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p2.3.m3.1d">italic_B ≥ 8 )</annotation></semantics></math>,
where they can achieve the same success rate as best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx2.p2.4.m4.1"><semantics id="S4.SS1.SSSx2.p2.4.m4.1a"><mi id="S4.SS1.SSSx2.p2.4.m4.1.1" xref="S4.SS1.SSSx2.p2.4.m4.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx2.p2.4.m4.1b"><ci id="S4.SS1.SSSx2.p2.4.m4.1.1.cmml" xref="S4.SS1.SSSx2.p2.4.m4.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p2.4.m4.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p2.4.m4.1d">italic_k</annotation></semantics></math> while using 25–50% less computation.
This efficiency likely stems from allocation of most of the compute resources to medium and hard problems, which require more samples, while easy problems need only a few to be solved optimally.
Both the online and offline variants perform nearly identically, indicating that solving the optimization problem offline does not lead to any performance degradation in this setting.
Finally, although we significantly outperform best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx2.p2.5.m5.1"><semantics id="S4.SS1.SSSx2.p2.5.m5.1a"><mi id="S4.SS1.SSSx2.p2.5.m5.1.1" xref="S4.SS1.SSSx2.p2.5.m5.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx2.p2.5.m5.1b"><ci id="S4.SS1.SSSx2.p2.5.m5.1.1.cmml" xref="S4.SS1.SSSx2.p2.5.m5.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p2.5.m5.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p2.5.m5.1d">italic_k</annotation></semantics></math>, the oracle curve suggests that further improvements in the marginal reward predictor <math alttext="\hat{\mathbf{\Delta}}" class="ltx_Math" display="inline" id="S4.SS1.SSSx2.p2.6.m6.1"><semantics id="S4.SS1.SSSx2.p2.6.m6.1a"><mover accent="true" id="S4.SS1.SSSx2.p2.6.m6.1.1" xref="S4.SS1.SSSx2.p2.6.m6.1.1.cmml"><mi id="S4.SS1.SSSx2.p2.6.m6.1.1.2" xref="S4.SS1.SSSx2.p2.6.m6.1.1.2.cmml">𝚫</mi><mo id="S4.SS1.SSSx2.p2.6.m6.1.1.1" xref="S4.SS1.SSSx2.p2.6.m6.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx2.p2.6.m6.1b"><apply id="S4.SS1.SSSx2.p2.6.m6.1.1.cmml" xref="S4.SS1.SSSx2.p2.6.m6.1.1"><ci id="S4.SS1.SSSx2.p2.6.m6.1.1.1.cmml" xref="S4.SS1.SSSx2.p2.6.m6.1.1.1">^</ci><ci id="S4.SS1.SSSx2.p2.6.m6.1.1.2.cmml" xref="S4.SS1.SSSx2.p2.6.m6.1.1.2">𝚫</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx2.p2.6.m6.1c">\hat{\mathbf{\Delta}}</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx2.p2.6.m6.1d">over^ start_ARG bold_Δ end_ARG</annotation></semantics></math> could provide even greater gains.</p>
</div>
<figure class="ltx_figure" id="S4.F4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="256" id="S4.F4.g1" src="x4.png" width="609"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span><span class="ltx_text ltx_font_bold" id="S4.F4.2.1">Results of adaptive best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.F4.2.1.m1.1"><semantics id="S4.F4.2.1.m1.1b"><mi id="S4.F4.2.1.m1.1.1" xref="S4.F4.2.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.F4.2.1.m1.1c"><ci id="S4.F4.2.1.m1.1.1.cmml" xref="S4.F4.2.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.F4.2.1.m1.1d">k</annotation><annotation encoding="application/x-llamapun" id="S4.F4.2.1.m1.1e">italic_k</annotation></semantics></math> in the Chat domain</span>. Our <span class="ltx_text ltx_font_bold" id="S4.F4.5.2">full</span> variant achieves marginal improvements, enabling a 0-10% reduction in compute budget while maintaining equivalent reward levels. More notably, the <span class="ltx_text ltx_font_bold" id="S4.F4.6.3">tranches</span> variant exhibits substantial gains, achieving the same reward levels with a 25-40% reduction in compute budget. </figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S4.SS1.SSSx3">
<h4 class="ltx_title ltx_title_subsubsection">Chat</h4>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSSx3.p1">
<p class="ltx_p" id="S4.SS1.SSSx3.p1.3"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx3.p1.3.1">Setup:</span> For chat, we use a subset of the LMSYS-Chat dataset, which contains real-world conversations with <math alttext="25" class="ltx_Math" display="inline" id="S4.SS1.SSSx3.p1.1.m1.1"><semantics id="S4.SS1.SSSx3.p1.1.m1.1a"><mn id="S4.SS1.SSSx3.p1.1.m1.1.1" xref="S4.SS1.SSSx3.p1.1.m1.1.1.cmml">25</mn><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx3.p1.1.m1.1b"><cn id="S4.SS1.SSSx3.p1.1.m1.1.1.cmml" type="integer" xref="S4.SS1.SSSx3.p1.1.m1.1.1">25</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx3.p1.1.m1.1c">25</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx3.p1.1.m1.1d">25</annotation></semantics></math> LLMs <cite class="ltx_cite ltx_citemacro_citep">(Zheng et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib27" title="">2024</a>)</cite>.
We use the popular <span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx3.p1.3.2">Gemma-7b-it</span> model, which in an instruction-tuned model for chat <cite class="ltx_cite ltx_citemacro_citep">(Team et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib23" title="">2024</a>)</cite>.
We use reward as our primary evaluation metric. We use an off-the-shelf reward model called <span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx3.p1.3.3">NCSOFT/Llama-3-OffsetBias-RM-8B</span>, which was ranked amongst the top <math alttext="10" class="ltx_Math" display="inline" id="S4.SS1.SSSx3.p1.2.m2.1"><semantics id="S4.SS1.SSSx3.p1.2.m2.1a"><mn id="S4.SS1.SSSx3.p1.2.m2.1.1" xref="S4.SS1.SSSx3.p1.2.m2.1.1.cmml">10</mn><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx3.p1.2.m2.1b"><cn id="S4.SS1.SSSx3.p1.2.m2.1.1.cmml" type="integer" xref="S4.SS1.SSSx3.p1.2.m2.1.1">10</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx3.p1.2.m2.1c">10</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx3.p1.2.m2.1d">10</annotation></semantics></math> on RewardBench at the time of writing.
We used the MLP variant to learn the marginal rewards.
Finally, we conduct evaluation on <math alttext="2" class="ltx_Math" display="inline" id="S4.SS1.SSSx3.p1.3.m3.1"><semantics id="S4.SS1.SSSx3.p1.3.m3.1a"><mn id="S4.SS1.SSSx3.p1.3.m3.1.1" xref="S4.SS1.SSSx3.p1.3.m3.1.1.cmml">2</mn><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx3.p1.3.m3.1b"><cn id="S4.SS1.SSSx3.p1.3.m3.1.1.cmml" type="integer" xref="S4.SS1.SSSx3.p1.3.m3.1.1">2</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx3.p1.3.m3.1c">2</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx3.p1.3.m3.1d">2</annotation></semantics></math> different subsets of the dataset-</p>
<ol class="ltx_enumerate" id="S4.I2">
<li class="ltx_item" id="S4.I2.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="S4.I2.i1.p1">
<p class="ltx_p" id="S4.I2.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I2.i1.p1.1.1">Full:</span> The vanilla experiment uses the the entire test set.</p>
</div>
</li>
<li class="ltx_item" id="S4.I2.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para ltx_noindent" id="S4.I2.i2.p1">
<p class="ltx_p" id="S4.I2.i2.p1.3"><span class="ltx_text ltx_font_bold" id="S4.I2.i2.p1.3.1">Tranches:</span> The tranches experiment that uses a subset of <math alttext="20\%" class="ltx_Math" display="inline" id="S4.I2.i2.p1.1.m1.1"><semantics id="S4.I2.i2.p1.1.m1.1a"><mrow id="S4.I2.i2.p1.1.m1.1.1" xref="S4.I2.i2.p1.1.m1.1.1.cmml"><mn id="S4.I2.i2.p1.1.m1.1.1.2" xref="S4.I2.i2.p1.1.m1.1.1.2.cmml">20</mn><mo id="S4.I2.i2.p1.1.m1.1.1.1" xref="S4.I2.i2.p1.1.m1.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.I2.i2.p1.1.m1.1b"><apply id="S4.I2.i2.p1.1.m1.1.1.cmml" xref="S4.I2.i2.p1.1.m1.1.1"><csymbol cd="latexml" id="S4.I2.i2.p1.1.m1.1.1.1.cmml" xref="S4.I2.i2.p1.1.m1.1.1.1">percent</csymbol><cn id="S4.I2.i2.p1.1.m1.1.1.2.cmml" type="integer" xref="S4.I2.i2.p1.1.m1.1.1.2">20</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I2.i2.p1.1.m1.1c">20\%</annotation><annotation encoding="application/x-llamapun" id="S4.I2.i2.p1.1.m1.1d">20 %</annotation></semantics></math> from the full test set.
To create this subset, we first generated multiple responses for each query in the test set and labeled them using the reward model.
We then calculated the reward variance for each query and selected only those queries that fall in the lowest <math alttext="10\%" class="ltx_Math" display="inline" id="S4.I2.i2.p1.2.m2.1"><semantics id="S4.I2.i2.p1.2.m2.1a"><mrow id="S4.I2.i2.p1.2.m2.1.1" xref="S4.I2.i2.p1.2.m2.1.1.cmml"><mn id="S4.I2.i2.p1.2.m2.1.1.2" xref="S4.I2.i2.p1.2.m2.1.1.2.cmml">10</mn><mo id="S4.I2.i2.p1.2.m2.1.1.1" xref="S4.I2.i2.p1.2.m2.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.I2.i2.p1.2.m2.1b"><apply id="S4.I2.i2.p1.2.m2.1.1.cmml" xref="S4.I2.i2.p1.2.m2.1.1"><csymbol cd="latexml" id="S4.I2.i2.p1.2.m2.1.1.1.cmml" xref="S4.I2.i2.p1.2.m2.1.1.1">percent</csymbol><cn id="S4.I2.i2.p1.2.m2.1.1.2.cmml" type="integer" xref="S4.I2.i2.p1.2.m2.1.1.2">10</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I2.i2.p1.2.m2.1c">10\%</annotation><annotation encoding="application/x-llamapun" id="S4.I2.i2.p1.2.m2.1d">10 %</annotation></semantics></math> or highest <math alttext="10\%" class="ltx_Math" display="inline" id="S4.I2.i2.p1.3.m3.1"><semantics id="S4.I2.i2.p1.3.m3.1a"><mrow id="S4.I2.i2.p1.3.m3.1.1" xref="S4.I2.i2.p1.3.m3.1.1.cmml"><mn id="S4.I2.i2.p1.3.m3.1.1.2" xref="S4.I2.i2.p1.3.m3.1.1.2.cmml">10</mn><mo id="S4.I2.i2.p1.3.m3.1.1.1" xref="S4.I2.i2.p1.3.m3.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.I2.i2.p1.3.m3.1b"><apply id="S4.I2.i2.p1.3.m3.1.1.cmml" xref="S4.I2.i2.p1.3.m3.1.1"><csymbol cd="latexml" id="S4.I2.i2.p1.3.m3.1.1.1.cmml" xref="S4.I2.i2.p1.3.m3.1.1.1">percent</csymbol><cn id="S4.I2.i2.p1.3.m3.1.1.2.cmml" type="integer" xref="S4.I2.i2.p1.3.m3.1.1.2">10</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I2.i2.p1.3.m3.1c">10\%</annotation><annotation encoding="application/x-llamapun" id="S4.I2.i2.p1.3.m3.1d">10 %</annotation></semantics></math> of variance.
In essence, the tranches test set is composed of queries with the lowest and highest variance in rewards, representing the two extremes.</p>
</div>
</li>
</ol>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSSx3.p2">
<p class="ltx_p" id="S4.SS1.SSSx3.p2.1">The main goal of the <span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx3.p2.1.1">tranches</span> experiment is to evaluate our method when the distribution of queries differs from typical datasets, which are often collected in somewhat controlled settings.
Such datasets may not fully capture the true diversity of user queries that are encountered by general chatbots. While understanding the true distribution of user queries is beyond the scope of this work, the tranches experiment simulates a more extreme distribution to provide performance insights.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.SSSx3.p3">
<p class="ltx_p" id="S4.SS1.SSSx3.p3.1"><span class="ltx_text ltx_font_bold" id="S4.SS1.SSSx3.p3.1.1">Results:</span>
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.F4" title="Figure 4 ‣ Math ‣ 4.1 Adaptive Best-of-k ‣ 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">4</span></a> present the results for the two subsets.
We focus on the small compute budget regime as chat requires much lesser search and we empirically observed rewards saturating quickly.
In the case of the <span class="ltx_text ltx_font_italic" id="S4.SS1.SSSx3.p3.1.2">full</span> variant, the gains are relatively modest.
The Oracle curve shows a 15–25% reduction in compute budget while maintaining the same average reward.
Although our adaptive method consistently outperforms best-of-k everywhere, the reductions in compute budget are relatively small, ranging from 0–10%.
This indicates that while adaptive allocation can provide some benefit, an equitable allocation performs almost at par.
For the <span class="ltx_text ltx_font_italic" id="S4.SS1.SSSx3.p3.1.3">tranches</span> variant, the results are notably different.
Our adaptive method achieves substantial gains, reducing the budget by 25–40% while matching the rewards of best-of-<math alttext="k" class="ltx_Math" display="inline" id="S4.SS1.SSSx3.p3.1.m1.1"><semantics id="S4.SS1.SSSx3.p3.1.m1.1a"><mi id="S4.SS1.SSSx3.p3.1.m1.1.1" xref="S4.SS1.SSSx3.p3.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S4.SS1.SSSx3.p3.1.m1.1b"><ci id="S4.SS1.SSSx3.p3.1.m1.1.1.cmml" xref="S4.SS1.SSSx3.p3.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.SS1.SSSx3.p3.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S4.SS1.SSSx3.p3.1.m1.1d">italic_k</annotation></semantics></math>.</p>
</div>
</section>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Routing</h3>
<figure class="ltx_figure" id="S4.F5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="428" id="S4.F5.g1" src="x5.png" width="761"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 5: </span><span class="ltx_text ltx_font_bold" id="S4.F5.2.1">Results for different routing procedures</span>. The left column shows the distribution of ground-truth preference probabilities for model size and value-augmented sampling. The middle column compares our learned preference predictors to ground-truth values, alongside calibration curves (our predictors are well calibrated). Finally, the right column shows the performance curves for tested methods. We observe that adaptive routing outperforms the random routing baseline, demonstrating that our learned predictor is able to effectively route more challenging queries to the stronger model while leaving simpler queries to the weaker model.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.2">Through this set of experiments, we aim to evaluate the effectiveness of our learned preference predictor in routing queries between a weak decoding procedure <math alttext="p^{W}" class="ltx_Math" display="inline" id="S4.SS2.p1.1.m1.1"><semantics id="S4.SS2.p1.1.m1.1a"><msup id="S4.SS2.p1.1.m1.1.1" xref="S4.SS2.p1.1.m1.1.1.cmml"><mi id="S4.SS2.p1.1.m1.1.1.2" xref="S4.SS2.p1.1.m1.1.1.2.cmml">p</mi><mi id="S4.SS2.p1.1.m1.1.1.3" xref="S4.SS2.p1.1.m1.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.1.m1.1b"><apply id="S4.SS2.p1.1.m1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.1.m1.1.1.1.cmml" xref="S4.SS2.p1.1.m1.1.1">superscript</csymbol><ci id="S4.SS2.p1.1.m1.1.1.2.cmml" xref="S4.SS2.p1.1.m1.1.1.2">𝑝</ci><ci id="S4.SS2.p1.1.m1.1.1.3.cmml" xref="S4.SS2.p1.1.m1.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.1.m1.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.1.m1.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> and a strong procedure <math alttext="p^{S}" class="ltx_Math" display="inline" id="S4.SS2.p1.2.m2.1"><semantics id="S4.SS2.p1.2.m2.1a"><msup id="S4.SS2.p1.2.m2.1.1" xref="S4.SS2.p1.2.m2.1.1.cmml"><mi id="S4.SS2.p1.2.m2.1.1.2" xref="S4.SS2.p1.2.m2.1.1.2.cmml">p</mi><mi id="S4.SS2.p1.2.m2.1.1.3" xref="S4.SS2.p1.2.m2.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.p1.2.m2.1b"><apply id="S4.SS2.p1.2.m2.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p1.2.m2.1.1.1.cmml" xref="S4.SS2.p1.2.m2.1.1">superscript</csymbol><ci id="S4.SS2.p1.2.m2.1.1.2.cmml" xref="S4.SS2.p1.2.m2.1.1.2">𝑝</ci><ci id="S4.SS2.p1.2.m2.1.1.3.cmml" xref="S4.SS2.p1.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p1.2.m2.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p1.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.2"><span class="ltx_text ltx_font_bold" id="S4.SS2.p2.2.1">Settings:</span> We present results for two different (<math alttext="p^{W}" class="ltx_Math" display="inline" id="S4.SS2.p2.1.m1.1"><semantics id="S4.SS2.p2.1.m1.1a"><msup id="S4.SS2.p2.1.m1.1.1" xref="S4.SS2.p2.1.m1.1.1.cmml"><mi id="S4.SS2.p2.1.m1.1.1.2" xref="S4.SS2.p2.1.m1.1.1.2.cmml">p</mi><mi id="S4.SS2.p2.1.m1.1.1.3" xref="S4.SS2.p2.1.m1.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.1.m1.1b"><apply id="S4.SS2.p2.1.m1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.1.m1.1.1.1.cmml" xref="S4.SS2.p2.1.m1.1.1">superscript</csymbol><ci id="S4.SS2.p2.1.m1.1.1.2.cmml" xref="S4.SS2.p2.1.m1.1.1.2">𝑝</ci><ci id="S4.SS2.p2.1.m1.1.1.3.cmml" xref="S4.SS2.p2.1.m1.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.1.m1.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.1.m1.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="p^{S}" class="ltx_Math" display="inline" id="S4.SS2.p2.2.m2.1"><semantics id="S4.SS2.p2.2.m2.1a"><msup id="S4.SS2.p2.2.m2.1.1" xref="S4.SS2.p2.2.m2.1.1.cmml"><mi id="S4.SS2.p2.2.m2.1.1.2" xref="S4.SS2.p2.2.m2.1.1.2.cmml">p</mi><mi id="S4.SS2.p2.2.m2.1.1.3" xref="S4.SS2.p2.2.m2.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.p2.2.m2.1b"><apply id="S4.SS2.p2.2.m2.1.1.cmml" xref="S4.SS2.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p2.2.m2.1.1.1.cmml" xref="S4.SS2.p2.2.m2.1.1">superscript</csymbol><ci id="S4.SS2.p2.2.m2.1.1.2.cmml" xref="S4.SS2.p2.2.m2.1.1.2">𝑝</ci><ci id="S4.SS2.p2.2.m2.1.1.3.cmml" xref="S4.SS2.p2.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p2.2.m2.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p2.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math>) pairs which are based on:</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p3">
<ol class="ltx_enumerate" id="S4.I3">
<li class="ltx_item" id="S4.I3.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para ltx_noindent" id="S4.I3.i1.p1">
<p class="ltx_p" id="S4.I3.i1.p1.4"><span class="ltx_text ltx_font_bold" id="S4.I3.i1.p1.4.1">Model Size:</span> In this setting, <math alttext="p^{W}" class="ltx_Math" display="inline" id="S4.I3.i1.p1.1.m1.1"><semantics id="S4.I3.i1.p1.1.m1.1a"><msup id="S4.I3.i1.p1.1.m1.1.1" xref="S4.I3.i1.p1.1.m1.1.1.cmml"><mi id="S4.I3.i1.p1.1.m1.1.1.2" xref="S4.I3.i1.p1.1.m1.1.1.2.cmml">p</mi><mi id="S4.I3.i1.p1.1.m1.1.1.3" xref="S4.I3.i1.p1.1.m1.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S4.I3.i1.p1.1.m1.1b"><apply id="S4.I3.i1.p1.1.m1.1.1.cmml" xref="S4.I3.i1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.I3.i1.p1.1.m1.1.1.1.cmml" xref="S4.I3.i1.p1.1.m1.1.1">superscript</csymbol><ci id="S4.I3.i1.p1.1.m1.1.1.2.cmml" xref="S4.I3.i1.p1.1.m1.1.1.2">𝑝</ci><ci id="S4.I3.i1.p1.1.m1.1.1.3.cmml" xref="S4.I3.i1.p1.1.m1.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I3.i1.p1.1.m1.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S4.I3.i1.p1.1.m1.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="p^{S}" class="ltx_Math" display="inline" id="S4.I3.i1.p1.2.m2.1"><semantics id="S4.I3.i1.p1.2.m2.1a"><msup id="S4.I3.i1.p1.2.m2.1.1" xref="S4.I3.i1.p1.2.m2.1.1.cmml"><mi id="S4.I3.i1.p1.2.m2.1.1.2" xref="S4.I3.i1.p1.2.m2.1.1.2.cmml">p</mi><mi id="S4.I3.i1.p1.2.m2.1.1.3" xref="S4.I3.i1.p1.2.m2.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S4.I3.i1.p1.2.m2.1b"><apply id="S4.I3.i1.p1.2.m2.1.1.cmml" xref="S4.I3.i1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.I3.i1.p1.2.m2.1.1.1.cmml" xref="S4.I3.i1.p1.2.m2.1.1">superscript</csymbol><ci id="S4.I3.i1.p1.2.m2.1.1.2.cmml" xref="S4.I3.i1.p1.2.m2.1.1.2">𝑝</ci><ci id="S4.I3.i1.p1.2.m2.1.1.3.cmml" xref="S4.I3.i1.p1.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I3.i1.p1.2.m2.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="S4.I3.i1.p1.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math> are models from the same family but with different model sizes. We use the instruction-tuned <span class="ltx_text ltx_font_bold" id="S4.I3.i1.p1.4.2">Gemma-2b-it</span> and <span class="ltx_text ltx_font_bold" id="S4.I3.i1.p1.4.3">Gemma-7b-it</span> models as <math alttext="p^{W}" class="ltx_Math" display="inline" id="S4.I3.i1.p1.3.m3.1"><semantics id="S4.I3.i1.p1.3.m3.1a"><msup id="S4.I3.i1.p1.3.m3.1.1" xref="S4.I3.i1.p1.3.m3.1.1.cmml"><mi id="S4.I3.i1.p1.3.m3.1.1.2" xref="S4.I3.i1.p1.3.m3.1.1.2.cmml">p</mi><mi id="S4.I3.i1.p1.3.m3.1.1.3" xref="S4.I3.i1.p1.3.m3.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S4.I3.i1.p1.3.m3.1b"><apply id="S4.I3.i1.p1.3.m3.1.1.cmml" xref="S4.I3.i1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S4.I3.i1.p1.3.m3.1.1.1.cmml" xref="S4.I3.i1.p1.3.m3.1.1">superscript</csymbol><ci id="S4.I3.i1.p1.3.m3.1.1.2.cmml" xref="S4.I3.i1.p1.3.m3.1.1.2">𝑝</ci><ci id="S4.I3.i1.p1.3.m3.1.1.3.cmml" xref="S4.I3.i1.p1.3.m3.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I3.i1.p1.3.m3.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S4.I3.i1.p1.3.m3.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="p^{S}" class="ltx_Math" display="inline" id="S4.I3.i1.p1.4.m4.1"><semantics id="S4.I3.i1.p1.4.m4.1a"><msup id="S4.I3.i1.p1.4.m4.1.1" xref="S4.I3.i1.p1.4.m4.1.1.cmml"><mi id="S4.I3.i1.p1.4.m4.1.1.2" xref="S4.I3.i1.p1.4.m4.1.1.2.cmml">p</mi><mi id="S4.I3.i1.p1.4.m4.1.1.3" xref="S4.I3.i1.p1.4.m4.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S4.I3.i1.p1.4.m4.1b"><apply id="S4.I3.i1.p1.4.m4.1.1.cmml" xref="S4.I3.i1.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S4.I3.i1.p1.4.m4.1.1.1.cmml" xref="S4.I3.i1.p1.4.m4.1.1">superscript</csymbol><ci id="S4.I3.i1.p1.4.m4.1.1.2.cmml" xref="S4.I3.i1.p1.4.m4.1.1.2">𝑝</ci><ci id="S4.I3.i1.p1.4.m4.1.1.3.cmml" xref="S4.I3.i1.p1.4.m4.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I3.i1.p1.4.m4.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="S4.I3.i1.p1.4.m4.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math>. We use the <span class="ltx_text ltx_font_italic" id="S4.I3.i1.p1.4.4">full</span> variant of the LMSYS dataset described in Section <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.SS1.SSSx3" title="Chat ‣ 4.1 Adaptive Best-of-k ‣ 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">4.1</span></a> .</p>
</div>
</li>
<li class="ltx_item" id="S4.I3.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para ltx_noindent" id="S4.I3.i2.p1">
<p class="ltx_p" id="S4.I3.i2.p1.2"><span class="ltx_text ltx_font_bold" id="S4.I3.i2.p1.2.1">Value-Augmented Sampling:</span> In this setting, <math alttext="p^{W}" class="ltx_Math" display="inline" id="S4.I3.i2.p1.1.m1.1"><semantics id="S4.I3.i2.p1.1.m1.1a"><msup id="S4.I3.i2.p1.1.m1.1.1" xref="S4.I3.i2.p1.1.m1.1.1.cmml"><mi id="S4.I3.i2.p1.1.m1.1.1.2" xref="S4.I3.i2.p1.1.m1.1.1.2.cmml">p</mi><mi id="S4.I3.i2.p1.1.m1.1.1.3" xref="S4.I3.i2.p1.1.m1.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S4.I3.i2.p1.1.m1.1b"><apply id="S4.I3.i2.p1.1.m1.1.1.cmml" xref="S4.I3.i2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.I3.i2.p1.1.m1.1.1.1.cmml" xref="S4.I3.i2.p1.1.m1.1.1">superscript</csymbol><ci id="S4.I3.i2.p1.1.m1.1.1.2.cmml" xref="S4.I3.i2.p1.1.m1.1.1.2">𝑝</ci><ci id="S4.I3.i2.p1.1.m1.1.1.3.cmml" xref="S4.I3.i2.p1.1.m1.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I3.i2.p1.1.m1.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S4.I3.i2.p1.1.m1.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="p^{S}" class="ltx_Math" display="inline" id="S4.I3.i2.p1.2.m2.1"><semantics id="S4.I3.i2.p1.2.m2.1a"><msup id="S4.I3.i2.p1.2.m2.1.1" xref="S4.I3.i2.p1.2.m2.1.1.cmml"><mi id="S4.I3.i2.p1.2.m2.1.1.2" xref="S4.I3.i2.p1.2.m2.1.1.2.cmml">p</mi><mi id="S4.I3.i2.p1.2.m2.1.1.3" xref="S4.I3.i2.p1.2.m2.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S4.I3.i2.p1.2.m2.1b"><apply id="S4.I3.i2.p1.2.m2.1.1.cmml" xref="S4.I3.i2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S4.I3.i2.p1.2.m2.1.1.1.cmml" xref="S4.I3.i2.p1.2.m2.1.1">superscript</csymbol><ci id="S4.I3.i2.p1.2.m2.1.1.2.cmml" xref="S4.I3.i2.p1.2.m2.1.1.2">𝑝</ci><ci id="S4.I3.i2.p1.2.m2.1.1.3.cmml" xref="S4.I3.i2.p1.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I3.i2.p1.2.m2.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="S4.I3.i2.p1.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math> have the same base LLM model. During decoding, a value function is used to guide search, improving performance but with significant computational overhead. In this experiment we use <span class="ltx_text ltx_font_bold" id="S4.I3.i2.p1.2.2">Llama-2 7B</span> for both the LLM and the value function. In each decoding step, we compute the value of 10 possible tokens, increasing the cost of decoding by a factor of 10.
We use the harmless subset of the popular Anthropic HH dataset <cite class="ltx_cite ltx_citemacro_citep">(Bai et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib1" title="">2022</a>)</cite>.</p>
</div>
</li>
</ol>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p4">
<p class="ltx_p" id="S4.SS2.p4.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.p4.1.1">Methods:</span>
We present results for the following methods:</p>
<ol class="ltx_enumerate" id="S4.I4">
<li class="ltx_item" id="S4.I4.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="S4.I4.i1.p1">
<p class="ltx_p" id="S4.I4.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I4.i1.p1.1.1">Online Routing (ours):</span> <math alttext="\hat{\Delta}" class="ltx_Math" display="inline" id="S4.I4.i1.p1.1.m1.1"><semantics id="S4.I4.i1.p1.1.m1.1a"><mover accent="true" id="S4.I4.i1.p1.1.m1.1.1" xref="S4.I4.i1.p1.1.m1.1.1.cmml"><mi id="S4.I4.i1.p1.1.m1.1.1.2" mathvariant="normal" xref="S4.I4.i1.p1.1.m1.1.1.2.cmml">Δ</mi><mo id="S4.I4.i1.p1.1.m1.1.1.1" xref="S4.I4.i1.p1.1.m1.1.1.1.cmml">^</mo></mover><annotation-xml encoding="MathML-Content" id="S4.I4.i1.p1.1.m1.1b"><apply id="S4.I4.i1.p1.1.m1.1.1.cmml" xref="S4.I4.i1.p1.1.m1.1.1"><ci id="S4.I4.i1.p1.1.m1.1.1.1.cmml" xref="S4.I4.i1.p1.1.m1.1.1.1">^</ci><ci id="S4.I4.i1.p1.1.m1.1.1.2.cmml" xref="S4.I4.i1.p1.1.m1.1.1.2">Δ</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I4.i1.p1.1.m1.1c">\hat{\Delta}</annotation><annotation encoding="application/x-llamapun" id="S4.I4.i1.p1.1.m1.1d">over^ start_ARG roman_Δ end_ARG</annotation></semantics></math> is used to predict the preference probabilities for a set of queries. These predictions are then routed using the online allocation procedure.</p>
</div>
</li>
<li class="ltx_item" id="S4.I4.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para" id="S4.I4.i2.p1">
<p class="ltx_p" id="S4.I4.i2.p1.2"><span class="ltx_text ltx_font_bold" id="S4.I4.i2.p1.2.1">Random:</span> A simple baseline that randomly routes a fixed fraction of queries to <math alttext="\pi^{S}" class="ltx_Math" display="inline" id="S4.I4.i2.p1.1.m1.1"><semantics id="S4.I4.i2.p1.1.m1.1a"><msup id="S4.I4.i2.p1.1.m1.1.1" xref="S4.I4.i2.p1.1.m1.1.1.cmml"><mi id="S4.I4.i2.p1.1.m1.1.1.2" xref="S4.I4.i2.p1.1.m1.1.1.2.cmml">π</mi><mi id="S4.I4.i2.p1.1.m1.1.1.3" xref="S4.I4.i2.p1.1.m1.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S4.I4.i2.p1.1.m1.1b"><apply id="S4.I4.i2.p1.1.m1.1.1.cmml" xref="S4.I4.i2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.I4.i2.p1.1.m1.1.1.1.cmml" xref="S4.I4.i2.p1.1.m1.1.1">superscript</csymbol><ci id="S4.I4.i2.p1.1.m1.1.1.2.cmml" xref="S4.I4.i2.p1.1.m1.1.1.2">𝜋</ci><ci id="S4.I4.i2.p1.1.m1.1.1.3.cmml" xref="S4.I4.i2.p1.1.m1.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I4.i2.p1.1.m1.1c">\pi^{S}</annotation><annotation encoding="application/x-llamapun" id="S4.I4.i2.p1.1.m1.1d">italic_π start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math>.
Any target <math alttext="B" class="ltx_Math" display="inline" id="S4.I4.i2.p1.2.m2.1"><semantics id="S4.I4.i2.p1.2.m2.1a"><mi id="S4.I4.i2.p1.2.m2.1.1" xref="S4.I4.i2.p1.2.m2.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="S4.I4.i2.p1.2.m2.1b"><ci id="S4.I4.i2.p1.2.m2.1.1.cmml" xref="S4.I4.i2.p1.2.m2.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.I4.i2.p1.2.m2.1c">B</annotation><annotation encoding="application/x-llamapun" id="S4.I4.i2.p1.2.m2.1d">italic_B</annotation></semantics></math> may be obtained by changing this fraction.</p>
</div>
</li>
<li class="ltx_item" id="S4.I4.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span>
<div class="ltx_para ltx_noindent" id="S4.I4.i3.p1">
<p class="ltx_p" id="S4.I4.i3.p1.2"><span class="ltx_text ltx_font_bold" id="S4.I4.i3.p1.2.1">Oracle:</span> As above, a non-realizable skyline that uses ground-truth information about the reward distribution of <math alttext="p^{W}(\cdot\mid x_{i})" class="ltx_math_unparsed" display="inline" id="S4.I4.i3.p1.1.m1.1"><semantics id="S4.I4.i3.p1.1.m1.1a"><mrow id="S4.I4.i3.p1.1.m1.1b"><msup id="S4.I4.i3.p1.1.m1.1.1"><mi id="S4.I4.i3.p1.1.m1.1.1.2">p</mi><mi id="S4.I4.i3.p1.1.m1.1.1.3">W</mi></msup><mrow id="S4.I4.i3.p1.1.m1.1.2"><mo id="S4.I4.i3.p1.1.m1.1.2.1" stretchy="false">(</mo><mo id="S4.I4.i3.p1.1.m1.1.2.2" lspace="0em" rspace="0em">⋅</mo><mo id="S4.I4.i3.p1.1.m1.1.2.3" lspace="0em" rspace="0.167em">∣</mo><msub id="S4.I4.i3.p1.1.m1.1.2.4"><mi id="S4.I4.i3.p1.1.m1.1.2.4.2">x</mi><mi id="S4.I4.i3.p1.1.m1.1.2.4.3">i</mi></msub><mo id="S4.I4.i3.p1.1.m1.1.2.5" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S4.I4.i3.p1.1.m1.1c">p^{W}(\cdot\mid x_{i})</annotation><annotation encoding="application/x-llamapun" id="S4.I4.i3.p1.1.m1.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT ( ⋅ ∣ italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> and <math alttext="p^{S}(\cdot\mid x_{i})" class="ltx_math_unparsed" display="inline" id="S4.I4.i3.p1.2.m2.1"><semantics id="S4.I4.i3.p1.2.m2.1a"><mrow id="S4.I4.i3.p1.2.m2.1b"><msup id="S4.I4.i3.p1.2.m2.1.1"><mi id="S4.I4.i3.p1.2.m2.1.1.2">p</mi><mi id="S4.I4.i3.p1.2.m2.1.1.3">S</mi></msup><mrow id="S4.I4.i3.p1.2.m2.1.2"><mo id="S4.I4.i3.p1.2.m2.1.2.1" stretchy="false">(</mo><mo id="S4.I4.i3.p1.2.m2.1.2.2" lspace="0em" rspace="0em">⋅</mo><mo id="S4.I4.i3.p1.2.m2.1.2.3" lspace="0em" rspace="0.167em">∣</mo><msub id="S4.I4.i3.p1.2.m2.1.2.4"><mi id="S4.I4.i3.p1.2.m2.1.2.4.2">x</mi><mi id="S4.I4.i3.p1.2.m2.1.2.4.3">i</mi></msub><mo id="S4.I4.i3.p1.2.m2.1.2.5" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S4.I4.i3.p1.2.m2.1c">p^{S}(\cdot\mid x_{i})</annotation><annotation encoding="application/x-llamapun" id="S4.I4.i3.p1.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT ( ⋅ ∣ italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT )</annotation></semantics></math> for routing.</p>
</div>
</li>
</ol>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p5">
<p class="ltx_p" id="S4.SS2.p5.4"><span class="ltx_text ltx_font_bold" id="S4.SS2.p5.4.1">Setup:</span>
We use expected reward, defined in Eq <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.E10" title="Equation 10 ‣ 4.1 Adaptive Best-of-k ‣ 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">10</span></a>, as our main evaluation metric.
For reward prediction in experiments with variable model size, we use the smaller <math alttext="p^{W}" class="ltx_Math" display="inline" id="S4.SS2.p5.1.m1.1"><semantics id="S4.SS2.p5.1.m1.1a"><msup id="S4.SS2.p5.1.m1.1.1" xref="S4.SS2.p5.1.m1.1.1.cmml"><mi id="S4.SS2.p5.1.m1.1.1.2" xref="S4.SS2.p5.1.m1.1.1.2.cmml">p</mi><mi id="S4.SS2.p5.1.m1.1.1.3" xref="S4.SS2.p5.1.m1.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.1.m1.1b"><apply id="S4.SS2.p5.1.m1.1.1.cmml" xref="S4.SS2.p5.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.1.m1.1.1.1.cmml" xref="S4.SS2.p5.1.m1.1.1">superscript</csymbol><ci id="S4.SS2.p5.1.m1.1.1.2.cmml" xref="S4.SS2.p5.1.m1.1.1.2">𝑝</ci><ci id="S4.SS2.p5.1.m1.1.1.3.cmml" xref="S4.SS2.p5.1.m1.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.1.m1.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.1.m1.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> as the base LLM.
That is, we train using the hidden states of <math alttext="p^{W}" class="ltx_Math" display="inline" id="S4.SS2.p5.2.m2.1"><semantics id="S4.SS2.p5.2.m2.1a"><msup id="S4.SS2.p5.2.m2.1.1" xref="S4.SS2.p5.2.m2.1.1.cmml"><mi id="S4.SS2.p5.2.m2.1.1.2" xref="S4.SS2.p5.2.m2.1.1.2.cmml">p</mi><mi id="S4.SS2.p5.2.m2.1.1.3" xref="S4.SS2.p5.2.m2.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.2.m2.1b"><apply id="S4.SS2.p5.2.m2.1.1.cmml" xref="S4.SS2.p5.2.m2.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.2.m2.1.1.1.cmml" xref="S4.SS2.p5.2.m2.1.1">superscript</csymbol><ci id="S4.SS2.p5.2.m2.1.1.2.cmml" xref="S4.SS2.p5.2.m2.1.1.2">𝑝</ci><ci id="S4.SS2.p5.2.m2.1.1.3.cmml" xref="S4.SS2.p5.2.m2.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.2.m2.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math> or perform LoRA fine-tuning of <math alttext="p^{W}" class="ltx_Math" display="inline" id="S4.SS2.p5.3.m3.1"><semantics id="S4.SS2.p5.3.m3.1a"><msup id="S4.SS2.p5.3.m3.1.1" xref="S4.SS2.p5.3.m3.1.1.cmml"><mi id="S4.SS2.p5.3.m3.1.1.2" xref="S4.SS2.p5.3.m3.1.1.2.cmml">p</mi><mi id="S4.SS2.p5.3.m3.1.1.3" xref="S4.SS2.p5.3.m3.1.1.3.cmml">W</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.3.m3.1b"><apply id="S4.SS2.p5.3.m3.1.1.cmml" xref="S4.SS2.p5.3.m3.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.3.m3.1.1.1.cmml" xref="S4.SS2.p5.3.m3.1.1">superscript</csymbol><ci id="S4.SS2.p5.3.m3.1.1.2.cmml" xref="S4.SS2.p5.3.m3.1.1.2">𝑝</ci><ci id="S4.SS2.p5.3.m3.1.1.3.cmml" xref="S4.SS2.p5.3.m3.1.1.3">𝑊</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.3.m3.1c">p^{W}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.3.m3.1d">italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT</annotation></semantics></math>.
This ensures that computational overhead during inference is minimal, and <math alttext="p^{S}" class="ltx_Math" display="inline" id="S4.SS2.p5.4.m4.1"><semantics id="S4.SS2.p5.4.m4.1a"><msup id="S4.SS2.p5.4.m4.1.1" xref="S4.SS2.p5.4.m4.1.1.cmml"><mi id="S4.SS2.p5.4.m4.1.1.2" xref="S4.SS2.p5.4.m4.1.1.2.cmml">p</mi><mi id="S4.SS2.p5.4.m4.1.1.3" xref="S4.SS2.p5.4.m4.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="S4.SS2.p5.4.m4.1b"><apply id="S4.SS2.p5.4.m4.1.1.cmml" xref="S4.SS2.p5.4.m4.1.1"><csymbol cd="ambiguous" id="S4.SS2.p5.4.m4.1.1.1.cmml" xref="S4.SS2.p5.4.m4.1.1">superscript</csymbol><ci id="S4.SS2.p5.4.m4.1.1.2.cmml" xref="S4.SS2.p5.4.m4.1.1.2">𝑝</ci><ci id="S4.SS2.p5.4.m4.1.1.3.cmml" xref="S4.SS2.p5.4.m4.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS2.p5.4.m4.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="S4.SS2.p5.4.m4.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math> does not even have to be called at all for some queries.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p6">
<p class="ltx_p" id="S4.SS2.p6.1"><span class="ltx_text ltx_font_bold" id="S4.SS2.p6.1.1">Results:</span>
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.F5" title="Figure 5 ‣ 4.2 Routing ‣ 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">5</span></a> shows that for both experiments, the learned predictor effectively routes the more challenging queries to the stronger model, while simpler queries are handled by the weaker model. This leads to substantial compute savings without a significant loss in overall performance. For example, in Value augmentation, we achieve up to a 25-40% reduction in calls to the more expensive decoding scheme while maintaining similar levels of reward.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p7">
<p class="ltx_p" id="S4.SS2.p7.1">Strikingly, in some cases our routing scheme actually outperforms the strong decoder—because the weak decoder sometimes outperforms the strong one, careful routing can achieve better overall performance. Our reward predictor learns and exploits this pattern.</p>
</div>
</section>
<section class="ltx_subsection" id="S4.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.3 </span>Analysis</h3>
<section class="ltx_subsubsection" id="S4.SS3.SSSx1">
<h4 class="ltx_title ltx_title_subsubsection">How do the learned marginal reward predictors perform?</h4>
<div class="ltx_para ltx_noindent" id="S4.SS3.SSSx1.p1">
<p class="ltx_p" id="S4.SS3.SSSx1.p1.1">So far, we have seen that our learned marginal reward predictors can be used effectively in adaptive compute allocation.
However, we also evaluate their performance independently of the adaptive compute allocation.
To this end, we introduce three evaluation metrics:</p>
<ol class="ltx_enumerate" id="S4.I5">
<li class="ltx_item" id="S4.I5.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="S4.I5.i1.p1">
<p class="ltx_p" id="S4.I5.i1.p1.1"><span class="ltx_text ltx_font_bold" id="S4.I5.i1.p1.1.1">Avg. (Average Loss):</span> The empirical loss when the prediction for every query is the average marginal reward, i.e., <math alttext="\bar{\Delta}=\frac{1}{N}\sum_{i}\Delta_{i}" class="ltx_Math" display="inline" id="S4.I5.i1.p1.1.m1.1"><semantics id="S4.I5.i1.p1.1.m1.1a"><mrow id="S4.I5.i1.p1.1.m1.1.1" xref="S4.I5.i1.p1.1.m1.1.1.cmml"><mover accent="true" id="S4.I5.i1.p1.1.m1.1.1.2" xref="S4.I5.i1.p1.1.m1.1.1.2.cmml"><mi id="S4.I5.i1.p1.1.m1.1.1.2.2" mathvariant="normal" xref="S4.I5.i1.p1.1.m1.1.1.2.2.cmml">Δ</mi><mo id="S4.I5.i1.p1.1.m1.1.1.2.1" xref="S4.I5.i1.p1.1.m1.1.1.2.1.cmml">¯</mo></mover><mo id="S4.I5.i1.p1.1.m1.1.1.1" xref="S4.I5.i1.p1.1.m1.1.1.1.cmml">=</mo><mrow id="S4.I5.i1.p1.1.m1.1.1.3" xref="S4.I5.i1.p1.1.m1.1.1.3.cmml"><mfrac id="S4.I5.i1.p1.1.m1.1.1.3.2" xref="S4.I5.i1.p1.1.m1.1.1.3.2.cmml"><mn id="S4.I5.i1.p1.1.m1.1.1.3.2.2" xref="S4.I5.i1.p1.1.m1.1.1.3.2.2.cmml">1</mn><mi id="S4.I5.i1.p1.1.m1.1.1.3.2.3" xref="S4.I5.i1.p1.1.m1.1.1.3.2.3.cmml">N</mi></mfrac><mo id="S4.I5.i1.p1.1.m1.1.1.3.1" xref="S4.I5.i1.p1.1.m1.1.1.3.1.cmml">⁢</mo><mrow id="S4.I5.i1.p1.1.m1.1.1.3.3" xref="S4.I5.i1.p1.1.m1.1.1.3.3.cmml"><msub id="S4.I5.i1.p1.1.m1.1.1.3.3.1" xref="S4.I5.i1.p1.1.m1.1.1.3.3.1.cmml"><mo id="S4.I5.i1.p1.1.m1.1.1.3.3.1.2" xref="S4.I5.i1.p1.1.m1.1.1.3.3.1.2.cmml">∑</mo><mi id="S4.I5.i1.p1.1.m1.1.1.3.3.1.3" xref="S4.I5.i1.p1.1.m1.1.1.3.3.1.3.cmml">i</mi></msub><msub id="S4.I5.i1.p1.1.m1.1.1.3.3.2" xref="S4.I5.i1.p1.1.m1.1.1.3.3.2.cmml"><mi id="S4.I5.i1.p1.1.m1.1.1.3.3.2.2" mathvariant="normal" xref="S4.I5.i1.p1.1.m1.1.1.3.3.2.2.cmml">Δ</mi><mi id="S4.I5.i1.p1.1.m1.1.1.3.3.2.3" xref="S4.I5.i1.p1.1.m1.1.1.3.3.2.3.cmml">i</mi></msub></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.I5.i1.p1.1.m1.1b"><apply id="S4.I5.i1.p1.1.m1.1.1.cmml" xref="S4.I5.i1.p1.1.m1.1.1"><eq id="S4.I5.i1.p1.1.m1.1.1.1.cmml" xref="S4.I5.i1.p1.1.m1.1.1.1"></eq><apply id="S4.I5.i1.p1.1.m1.1.1.2.cmml" xref="S4.I5.i1.p1.1.m1.1.1.2"><ci id="S4.I5.i1.p1.1.m1.1.1.2.1.cmml" xref="S4.I5.i1.p1.1.m1.1.1.2.1">¯</ci><ci id="S4.I5.i1.p1.1.m1.1.1.2.2.cmml" xref="S4.I5.i1.p1.1.m1.1.1.2.2">Δ</ci></apply><apply id="S4.I5.i1.p1.1.m1.1.1.3.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3"><times id="S4.I5.i1.p1.1.m1.1.1.3.1.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.1"></times><apply id="S4.I5.i1.p1.1.m1.1.1.3.2.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.2"><divide id="S4.I5.i1.p1.1.m1.1.1.3.2.1.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.2"></divide><cn id="S4.I5.i1.p1.1.m1.1.1.3.2.2.cmml" type="integer" xref="S4.I5.i1.p1.1.m1.1.1.3.2.2">1</cn><ci id="S4.I5.i1.p1.1.m1.1.1.3.2.3.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.2.3">𝑁</ci></apply><apply id="S4.I5.i1.p1.1.m1.1.1.3.3.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3"><apply id="S4.I5.i1.p1.1.m1.1.1.3.3.1.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3.1"><csymbol cd="ambiguous" id="S4.I5.i1.p1.1.m1.1.1.3.3.1.1.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3.1">subscript</csymbol><sum id="S4.I5.i1.p1.1.m1.1.1.3.3.1.2.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3.1.2"></sum><ci id="S4.I5.i1.p1.1.m1.1.1.3.3.1.3.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3.1.3">𝑖</ci></apply><apply id="S4.I5.i1.p1.1.m1.1.1.3.3.2.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3.2"><csymbol cd="ambiguous" id="S4.I5.i1.p1.1.m1.1.1.3.3.2.1.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3.2">subscript</csymbol><ci id="S4.I5.i1.p1.1.m1.1.1.3.3.2.2.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3.2.2">Δ</ci><ci id="S4.I5.i1.p1.1.m1.1.1.3.3.2.3.cmml" xref="S4.I5.i1.p1.1.m1.1.1.3.3.2.3">𝑖</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I5.i1.p1.1.m1.1c">\bar{\Delta}=\frac{1}{N}\sum_{i}\Delta_{i}</annotation><annotation encoding="application/x-llamapun" id="S4.I5.i1.p1.1.m1.1d">over¯ start_ARG roman_Δ end_ARG = divide start_ARG 1 end_ARG start_ARG italic_N end_ARG ∑ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT roman_Δ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. In this case, the model predicts the same marginal reward for each input. If the representations of the language model do not carry any meaningful information, we expect the performance to approximately equal this average loss.</p>
</div>
</li>
<li class="ltx_item" id="S4.I5.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para" id="S4.I5.i2.p1">
<p class="ltx_p" id="S4.I5.i2.p1.3"><span class="ltx_text ltx_font_bold" id="S4.I5.i2.p1.1.1">Opt.<sup class="ltx_sup" id="S4.I5.i2.p1.1.1.1"><span class="ltx_text ltx_font_medium" id="S4.I5.i2.p1.1.1.1.1">∗</span></sup> (Oracle Loss):</span> The loss that a perfect predictor would achieve. Since we use soft labels rather than binary (<math alttext="0" class="ltx_Math" display="inline" id="S4.I5.i2.p1.2.m1.1"><semantics id="S4.I5.i2.p1.2.m1.1a"><mn id="S4.I5.i2.p1.2.m1.1.1" xref="S4.I5.i2.p1.2.m1.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S4.I5.i2.p1.2.m1.1b"><cn id="S4.I5.i2.p1.2.m1.1.1.cmml" type="integer" xref="S4.I5.i2.p1.2.m1.1.1">0</cn></annotation-xml></semantics></math>-<math alttext="1" class="ltx_Math" display="inline" id="S4.I5.i2.p1.3.m2.1"><semantics id="S4.I5.i2.p1.3.m2.1a"><mn id="S4.I5.i2.p1.3.m2.1.1" xref="S4.I5.i2.p1.3.m2.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S4.I5.i2.p1.3.m2.1b"><cn id="S4.I5.i2.p1.3.m2.1.1.cmml" type="integer" xref="S4.I5.i2.p1.3.m2.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.I5.i2.p1.3.m2.1c">1</annotation><annotation encoding="application/x-llamapun" id="S4.I5.i2.p1.3.m2.1d">1</annotation></semantics></math>) labels, the minimum possible loss is a positive value.</p>
</div>
</li>
<li class="ltx_item" id="S4.I5.i3" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">3.</span>
<div class="ltx_para ltx_noindent" id="S4.I5.i3.p1">
<p class="ltx_p" id="S4.I5.i3.p1.5"><span class="ltx_text ltx_font_bold" id="S4.I5.i3.p1.5.1">Acc. (Accuracy):</span> The accuracy of predictions if the median of <math alttext="\Delta" class="ltx_Math" display="inline" id="S4.I5.i3.p1.1.m1.1"><semantics id="S4.I5.i3.p1.1.m1.1a"><mi id="S4.I5.i3.p1.1.m1.1.1" mathvariant="normal" xref="S4.I5.i3.p1.1.m1.1.1.cmml">Δ</mi><annotation-xml encoding="MathML-Content" id="S4.I5.i3.p1.1.m1.1b"><ci id="S4.I5.i3.p1.1.m1.1.1.cmml" xref="S4.I5.i3.p1.1.m1.1.1">Δ</ci></annotation-xml><annotation encoding="application/x-tex" id="S4.I5.i3.p1.1.m1.1c">\Delta</annotation><annotation encoding="application/x-llamapun" id="S4.I5.i3.p1.1.m1.1d">roman_Δ</annotation></semantics></math> values is used as a threshold. That is, if <math alttext="\Delta_{i}&gt;median" class="ltx_Math" display="inline" id="S4.I5.i3.p1.2.m2.1"><semantics id="S4.I5.i3.p1.2.m2.1a"><mrow id="S4.I5.i3.p1.2.m2.1.1" xref="S4.I5.i3.p1.2.m2.1.1.cmml"><msub id="S4.I5.i3.p1.2.m2.1.1.2" xref="S4.I5.i3.p1.2.m2.1.1.2.cmml"><mi id="S4.I5.i3.p1.2.m2.1.1.2.2" mathvariant="normal" xref="S4.I5.i3.p1.2.m2.1.1.2.2.cmml">Δ</mi><mi id="S4.I5.i3.p1.2.m2.1.1.2.3" xref="S4.I5.i3.p1.2.m2.1.1.2.3.cmml">i</mi></msub><mo id="S4.I5.i3.p1.2.m2.1.1.1" xref="S4.I5.i3.p1.2.m2.1.1.1.cmml">&gt;</mo><mrow id="S4.I5.i3.p1.2.m2.1.1.3" xref="S4.I5.i3.p1.2.m2.1.1.3.cmml"><mi id="S4.I5.i3.p1.2.m2.1.1.3.2" xref="S4.I5.i3.p1.2.m2.1.1.3.2.cmml">m</mi><mo id="S4.I5.i3.p1.2.m2.1.1.3.1" xref="S4.I5.i3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.I5.i3.p1.2.m2.1.1.3.3" xref="S4.I5.i3.p1.2.m2.1.1.3.3.cmml">e</mi><mo id="S4.I5.i3.p1.2.m2.1.1.3.1a" xref="S4.I5.i3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.I5.i3.p1.2.m2.1.1.3.4" xref="S4.I5.i3.p1.2.m2.1.1.3.4.cmml">d</mi><mo id="S4.I5.i3.p1.2.m2.1.1.3.1b" xref="S4.I5.i3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.I5.i3.p1.2.m2.1.1.3.5" xref="S4.I5.i3.p1.2.m2.1.1.3.5.cmml">i</mi><mo id="S4.I5.i3.p1.2.m2.1.1.3.1c" xref="S4.I5.i3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.I5.i3.p1.2.m2.1.1.3.6" xref="S4.I5.i3.p1.2.m2.1.1.3.6.cmml">a</mi><mo id="S4.I5.i3.p1.2.m2.1.1.3.1d" xref="S4.I5.i3.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S4.I5.i3.p1.2.m2.1.1.3.7" xref="S4.I5.i3.p1.2.m2.1.1.3.7.cmml">n</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="S4.I5.i3.p1.2.m2.1b"><apply id="S4.I5.i3.p1.2.m2.1.1.cmml" xref="S4.I5.i3.p1.2.m2.1.1"><gt id="S4.I5.i3.p1.2.m2.1.1.1.cmml" xref="S4.I5.i3.p1.2.m2.1.1.1"></gt><apply id="S4.I5.i3.p1.2.m2.1.1.2.cmml" xref="S4.I5.i3.p1.2.m2.1.1.2"><csymbol cd="ambiguous" id="S4.I5.i3.p1.2.m2.1.1.2.1.cmml" xref="S4.I5.i3.p1.2.m2.1.1.2">subscript</csymbol><ci id="S4.I5.i3.p1.2.m2.1.1.2.2.cmml" xref="S4.I5.i3.p1.2.m2.1.1.2.2">Δ</ci><ci id="S4.I5.i3.p1.2.m2.1.1.2.3.cmml" xref="S4.I5.i3.p1.2.m2.1.1.2.3">𝑖</ci></apply><apply id="S4.I5.i3.p1.2.m2.1.1.3.cmml" xref="S4.I5.i3.p1.2.m2.1.1.3"><times id="S4.I5.i3.p1.2.m2.1.1.3.1.cmml" xref="S4.I5.i3.p1.2.m2.1.1.3.1"></times><ci id="S4.I5.i3.p1.2.m2.1.1.3.2.cmml" xref="S4.I5.i3.p1.2.m2.1.1.3.2">𝑚</ci><ci id="S4.I5.i3.p1.2.m2.1.1.3.3.cmml" xref="S4.I5.i3.p1.2.m2.1.1.3.3">𝑒</ci><ci id="S4.I5.i3.p1.2.m2.1.1.3.4.cmml" xref="S4.I5.i3.p1.2.m2.1.1.3.4">𝑑</ci><ci id="S4.I5.i3.p1.2.m2.1.1.3.5.cmml" xref="S4.I5.i3.p1.2.m2.1.1.3.5">𝑖</ci><ci id="S4.I5.i3.p1.2.m2.1.1.3.6.cmml" xref="S4.I5.i3.p1.2.m2.1.1.3.6">𝑎</ci><ci id="S4.I5.i3.p1.2.m2.1.1.3.7.cmml" xref="S4.I5.i3.p1.2.m2.1.1.3.7">𝑛</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I5.i3.p1.2.m2.1c">\Delta_{i}&gt;median</annotation><annotation encoding="application/x-llamapun" id="S4.I5.i3.p1.2.m2.1d">roman_Δ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT &gt; italic_m italic_e italic_d italic_i italic_a italic_n</annotation></semantics></math>, the label for that query is <math alttext="1" class="ltx_Math" display="inline" id="S4.I5.i3.p1.3.m3.1"><semantics id="S4.I5.i3.p1.3.m3.1a"><mn id="S4.I5.i3.p1.3.m3.1.1" xref="S4.I5.i3.p1.3.m3.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="S4.I5.i3.p1.3.m3.1b"><cn id="S4.I5.i3.p1.3.m3.1.1.cmml" type="integer" xref="S4.I5.i3.p1.3.m3.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.I5.i3.p1.3.m3.1c">1</annotation><annotation encoding="application/x-llamapun" id="S4.I5.i3.p1.3.m3.1d">1</annotation></semantics></math>, and otherwise <math alttext="0" class="ltx_Math" display="inline" id="S4.I5.i3.p1.4.m4.1"><semantics id="S4.I5.i3.p1.4.m4.1a"><mn id="S4.I5.i3.p1.4.m4.1.1" xref="S4.I5.i3.p1.4.m4.1.1.cmml">0</mn><annotation-xml encoding="MathML-Content" id="S4.I5.i3.p1.4.m4.1b"><cn id="S4.I5.i3.p1.4.m4.1.1.cmml" type="integer" xref="S4.I5.i3.p1.4.m4.1.1">0</cn></annotation-xml></semantics></math>. The accuracy of a random predictor would <math alttext="50\%" class="ltx_Math" display="inline" id="S4.I5.i3.p1.5.m5.1"><semantics id="S4.I5.i3.p1.5.m5.1a"><mrow id="S4.I5.i3.p1.5.m5.1.1" xref="S4.I5.i3.p1.5.m5.1.1.cmml"><mn id="S4.I5.i3.p1.5.m5.1.1.2" xref="S4.I5.i3.p1.5.m5.1.1.2.cmml">50</mn><mo id="S4.I5.i3.p1.5.m5.1.1.1" xref="S4.I5.i3.p1.5.m5.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S4.I5.i3.p1.5.m5.1b"><apply id="S4.I5.i3.p1.5.m5.1.1.cmml" xref="S4.I5.i3.p1.5.m5.1.1"><csymbol cd="latexml" id="S4.I5.i3.p1.5.m5.1.1.1.cmml" xref="S4.I5.i3.p1.5.m5.1.1.1">percent</csymbol><cn id="S4.I5.i3.p1.5.m5.1.1.2.cmml" type="integer" xref="S4.I5.i3.p1.5.m5.1.1.2">50</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.I5.i3.p1.5.m5.1c">50\%</annotation><annotation encoding="application/x-llamapun" id="S4.I5.i3.p1.5.m5.1d">50 %</annotation></semantics></math>.</p>
</div>
</li>
</ol>
</div>
<figure class="ltx_table ltx_align_floatright" id="S4.T1">
<div class="ltx_inline-block ltx_align_center ltx_transformed_outer" id="S4.T1.1" style="width:198.7pt;height:73.1pt;vertical-align:-0.0pt;"><span class="ltx_transformed_inner" style="transform:translate(-22.9pt,8.4pt) scale(0.812592779017708,0.812592779017708) ;">
<table class="ltx_tabular ltx_guessed_headers ltx_align_middle" id="S4.T1.1.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S4.T1.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S4.T1.1.1.1.2" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.1.2.1">Setting</span></th>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.1.3" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.1.3.1">Ours</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.1.4" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.1.4.1">Avg.</span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.1.1" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.1.1.1">Opt.<sup class="ltx_sup" id="S4.T1.1.1.1.1.1.1"><span class="ltx_text ltx_font_medium" id="S4.T1.1.1.1.1.1.1.1">∗</span></sup></span></td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.1.5" style="padding-top:1.25pt;padding-bottom:1.25pt;"><span class="ltx_text ltx_font_bold" id="S4.T1.1.1.1.5.1">Acc</span></td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Code</th>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.33</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.58</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.20</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.2.1.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">74%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S4.T1.1.1.3.2.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Math</th>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.3.2.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.48</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.3.2.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.69</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.3.2.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.34</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.3.2.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">84%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_l ltx_border_r ltx_border_t" id="S4.T1.1.1.4.3.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Chat (Model routing)</th>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.4.3.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.64</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.4.3.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.67</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.4.3.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.58</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S4.T1.1.1.4.3.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">72%</td>
</tr>
<tr class="ltx_tr" id="S4.T1.1.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b ltx_border_l ltx_border_r ltx_border_t" id="S4.T1.1.1.5.4.1" style="padding-top:1.25pt;padding-bottom:1.25pt;">Chat (VAS routing)</th>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.5.4.2" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.55</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.5.4.3" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.57</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.5.4.4" style="padding-top:1.25pt;padding-bottom:1.25pt;">0.51</td>
<td class="ltx_td ltx_align_center ltx_border_b ltx_border_r ltx_border_t" id="S4.T1.1.1.5.4.5" style="padding-top:1.25pt;padding-bottom:1.25pt;">72%</td>
</tr>
</tbody>
</table>
</span></div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span>Learned predictors achieve lower loss than fixed baselines (Avg.), approach optimal values (Min.), and accurately discriminate queries of above- and below-median difficulty (Acc.).</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S4.SS3.SSSx1.p2">
<p class="ltx_p" id="S4.SS3.SSSx1.p2.1">Table 1 summarizes the results.
In all cases, the achieved loss is lower than the baseline, indicating that the queries contain meaningful signals about the model’s response distributions.
In routing, the test loss is closer to the baseline, which can be attributed to the low entropy in the reward distribution, as shown in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.F5" title="Figure 5 ‣ 4.2 Routing ‣ 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">5</span></a>.
Across all settings, accuracy exceeds 70%, showing that difficulty is predictable but highlighting potential scope for improvement.</p>
</div>
<figure class="ltx_figure" id="S4.F6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="251" id="S4.F6.g1" src="x6.png" width="609"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 6: </span><span class="ltx_text ltx_font_bold" id="S4.F6.2.1">Allocation of compute at different budgets.</span> The “Easy”, “Medium”, and “Hard” categories are obtained by binning queries according to their predicted success probability.
In the low-budget regime, the majority of the budget is allocated to easy and medium queries; as budget increases, it is primarily allocated to hard queries. </figcaption>
</figure>
</section>
<section class="ltx_subsubsection" id="S4.SS3.SSSx2">
<h4 class="ltx_title ltx_title_subsubsection">How does allocation vary with predicted difficulty?</h4>
<div class="ltx_para ltx_noindent" id="S4.SS3.SSSx2.p1">
<p class="ltx_p" id="S4.SS3.SSSx2.p1.1">Having established the performance benefits of adaptive allocation, we now explore what the distribution of compute budget for different marginal reward predictions looks like.
To investigate this, we focus on the Code and Math domains, where allocation is performed using <math alttext="\lambda_{x}" class="ltx_Math" display="inline" id="S4.SS3.SSSx2.p1.1.m1.1"><semantics id="S4.SS3.SSSx2.p1.1.m1.1a"><msub id="S4.SS3.SSSx2.p1.1.m1.1.1" xref="S4.SS3.SSSx2.p1.1.m1.1.1.cmml"><mi id="S4.SS3.SSSx2.p1.1.m1.1.1.2" xref="S4.SS3.SSSx2.p1.1.m1.1.1.2.cmml">λ</mi><mi id="S4.SS3.SSSx2.p1.1.m1.1.1.3" xref="S4.SS3.SSSx2.p1.1.m1.1.1.3.cmml">x</mi></msub><annotation-xml encoding="MathML-Content" id="S4.SS3.SSSx2.p1.1.m1.1b"><apply id="S4.SS3.SSSx2.p1.1.m1.1.1.cmml" xref="S4.SS3.SSSx2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S4.SS3.SSSx2.p1.1.m1.1.1.1.cmml" xref="S4.SS3.SSSx2.p1.1.m1.1.1">subscript</csymbol><ci id="S4.SS3.SSSx2.p1.1.m1.1.1.2.cmml" xref="S4.SS3.SSSx2.p1.1.m1.1.1.2">𝜆</ci><ci id="S4.SS3.SSSx2.p1.1.m1.1.1.3.cmml" xref="S4.SS3.SSSx2.p1.1.m1.1.1.3">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.SS3.SSSx2.p1.1.m1.1c">\lambda_{x}</annotation><annotation encoding="application/x-llamapun" id="S4.SS3.SSSx2.p1.1.m1.1d">italic_λ start_POSTSUBSCRIPT italic_x end_POSTSUBSCRIPT</annotation></semantics></math>, the success probability of a query.
We stratify the predicted success probabilities into three <span class="ltx_text ltx_font_bold" id="S4.SS3.SSSx2.p1.1.1">evenly-sized</span> bins according to their predicted success probability.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS3.SSSx2.p2">
<p class="ltx_p" id="S4.SS3.SSSx2.p2.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#S4.F6" title="Figure 6 ‣ How do the learned marginal reward predictors perform? ‣ 4.3 Analysis ‣ 4 Experiments ‣ Learning How Hard to Think: Input-Adaptive Allocation of LM Computation"><span class="ltx_text ltx_ref_tag">6</span></a> illustrates how the compute allocation changes across bins as the budget increases.
At the lowest budget, the majority of the allocation goes to queries predicted to be easy or medium in difficulty.
At the highest compute budget, by contrast, most of the compute is allocated to the hard bin.
This shift can be understood intuitively: easy-to-moderate queries typically require only a few samples to solve, beyond which the marginal gain of additional samples decays rapidly. In contrast, for queries with low success probabilities, the marginal gain remains high even with a large number of samples and decays extremely slowly.
Finally, the distinct allocation patterns between Math and Code domains highlight how the underlying difficulty distributions of datasets significantly impact budget allocation strategies.</p>
</div>
</section>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Related Work</h2>
<div class="ltx_para ltx_noindent" id="S5.p1">
<p class="ltx_p" id="S5.p1.2"><span class="ltx_text ltx_font_bold" id="S5.p1.2.1">Decoding Procedures in LLMs.</span>
There has been extensive research into utilizing different decoding schemes to enhance LLM capabilities, usually by expending inference-time compute.
One of the most straightforward approaches is best-of-<math alttext="k" class="ltx_Math" display="inline" id="S5.p1.1.m1.1"><semantics id="S5.p1.1.m1.1a"><mi id="S5.p1.1.m1.1.1" xref="S5.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S5.p1.1.m1.1b"><ci id="S5.p1.1.m1.1.1.cmml" xref="S5.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S5.p1.1.m1.1d">italic_k</annotation></semantics></math> sampling, where <math alttext="k" class="ltx_Math" display="inline" id="S5.p1.2.m2.1"><semantics id="S5.p1.2.m2.1a"><mi id="S5.p1.2.m2.1.1" xref="S5.p1.2.m2.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S5.p1.2.m2.1b"><ci id="S5.p1.2.m2.1.1.cmml" xref="S5.p1.2.m2.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.p1.2.m2.1c">k</annotation><annotation encoding="application/x-llamapun" id="S5.p1.2.m2.1d">italic_k</annotation></semantics></math> different model responses are generated per user query, and the final model output is selected using a reward model <cite class="ltx_cite ltx_citemacro_citep">(Gao et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib8" title="">2023</a>; Beirami et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib3" title="">2024</a>)</cite>, majority voting <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib24" title="">2023</a>)</cite>, or verifiers <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib17" title="">2022</a>)</cite>.
Another line of work has shown that allowing LLMs to generate intermediate “reasoning” steps, or “chain-of-thoughts” (CoTs) can significantly improve their final answer across various tasks <cite class="ltx_cite ltx_citemacro_citep">(Wei et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib25" title="">2022</a>; Nye et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib20" title="">2021</a>; Zhou et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib28" title="">2023</a>)</cite>.
However, while this type of test-time search can boost performance, it incurs additional computational costs due to the need to decode (potentially many more) reasoning tokens.
LLM decoding can also be framed as sampling from a tree of possible sequences, inspiring research that uses inference-time compute to search through this tree more effectively <cite class="ltx_cite ltx_citemacro_citep">(Yao et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib26" title="">2024</a>; Liu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib18" title="">2024</a>; Han et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib10" title="">2024</a>)</cite>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.p2">
<p class="ltx_p" id="S5.p2.1"><span class="ltx_text ltx_font_bold" id="S5.p2.1.1">Adaptive Computation Time in NN.</span> Several works explored the idea of learning how to adapt inference-time compute in neural networks <cite class="ltx_cite ltx_citemacro_citep">(Graves, <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib9" title="">2016</a>; Dehghani et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib5" title="">2019</a>; Banino et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib2" title="">2021</a>)</cite>. These works focus on networks with recurring components, where the decision is the number of times to pass the input through these components. Our work, however, is architecture-agnostic and focuses on adaptively selecting a decoding procedure.
Recently, <cite class="ltx_cite ltx_citemacro_cite">Snell et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib22" title="">2024</a>)</cite> demonstrated that allocating inference-time compute optimally can outperform simply using a larger model. Here, we show how to realize these improvements in practice using learned difficulty predictors.</p>
</div>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Conclusion</h2>
<div class="ltx_para ltx_noindent" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">We have introduced an approach for adaptively scaling test-time computation by predicting which queries would benefit the most from additional computation.
We first showed that it is possible to learn lightweight models that predict marginal rewards on top of pre-trained LMs—indicating that LMs encode usable information about the reward distribution of their responses to inputs.
We then presented an allocation algorithm that adaptively allocates computation to queries.
Results in programming, mathematics, and chat show our approach gives significant reductions in computation at a target level of output quality, or improvements in quality given a fixed computation budget.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p2">
<p class="ltx_p" id="S6.p2.1"><span class="ltx_text ltx_font_bold" id="S6.p2.1.1">Limitations:</span>
In this work, we assumed that we have access to a verifier in the Math experiments.
However, such verifiers will generally not be available, and using reward models specializing in Math might be the more practical implementation of our method.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p3">
<p class="ltx_p" id="S6.p3.1"><span class="ltx_text ltx_font_bold" id="S6.p3.1.1">Future Work:</span>
The gap between our current performance and the oracle indicates that there is room for improvement in marginal reward prediction. This could be addressed by exploring more advanced prediction models or by developing techniques that allocate additional inference-time computation specifically to obtain better marginal reward estimates.</p>
</div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Acknowledgments</h2>
<div class="ltx_para ltx_noindent" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">This work was supported by Intel and the National Science Foundation under grants CCF-2217064 and IIS-2212310.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bai et al. (2022)</span>
<span class="ltx_bibblock">
Yuntao Bai, Andy Jones, Kamal Ndousse, Amanda Askell, Anna Chen, Nova DasSarma, Dawn Drain, Stanislav Fort, Deep Ganguli, Tom Henighan, et al.

</span>
<span class="ltx_bibblock">Training a helpful and harmless assistant with reinforcement learning from human feedback.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">arXiv preprint arXiv:2204.05862</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Banino et al. (2021)</span>
<span class="ltx_bibblock">
Andrea Banino, Jan Balaguer, and Charles Blundell.

</span>
<span class="ltx_bibblock">Pondernet: Learning to ponder.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">8th ICML Workshop on Automated Machine Learning (AutoML)</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Beirami et al. (2024)</span>
<span class="ltx_bibblock">
Ahmad Beirami, Alekh Agarwal, Jonathan Berant, Alexander D’Amour, Jacob Eisenstein, Chirag Nagpal, and Ananda Theertha Suresh.

</span>
<span class="ltx_bibblock">Theoretical guarantees on the best-of-n alignment policy.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">arXiv preprint arXiv:2401.01879</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Brown et al. (2024)</span>
<span class="ltx_bibblock">
Bradley Brown, Jordan Juravsky, Ryan Ehrlich, Ronald Clark, Quoc V Le, Christopher Ré, and Azalia Mirhoseini.

</span>
<span class="ltx_bibblock">Large language monkeys: Scaling inference compute with repeated sampling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib4.1.1">arXiv preprint arXiv:2407.21787</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dehghani et al. (2019)</span>
<span class="ltx_bibblock">
Mostafa Dehghani, Stephan Gouws, Oriol Vinyals, Jakob Uszkoreit, and Lukasz Kaiser.

</span>
<span class="ltx_bibblock">Universal transformers.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">International Conference on Learning Representations</em>, 2019.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Du et al. (2024)</span>
<span class="ltx_bibblock">
Yilun Du, Shuang Li, Antonio Torralba, Joshua B. Tenenbaum, and Igor Mordatch.

</span>
<span class="ltx_bibblock">Improving factuality and reasoning in language models through multiagent debate.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">Forty-first International Conference on Machine Learning</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Edmonds (1971)</span>
<span class="ltx_bibblock">
Jack Edmonds.

</span>
<span class="ltx_bibblock">Matroids and the greedy algorithm.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Mathematical programming</em>, 1:127–136, 1971.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gao et al. (2023)</span>
<span class="ltx_bibblock">
Leo Gao, John Schulman, and Jacob Hilton.

</span>
<span class="ltx_bibblock">Scaling laws for reward model overoptimization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">International Conference on Machine Learning</em>, pp.  10835–10866. PMLR, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Graves (2016)</span>
<span class="ltx_bibblock">
Alex Graves.

</span>
<span class="ltx_bibblock">Adaptive computation time for recurrent neural networks.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">arXiv preprint arXiv:1603.08983</em>, 2016.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Han et al. (2024)</span>
<span class="ltx_bibblock">
Seungwook Han, Idan Shenfeld, Akash Srivastava, Yoon Kim, and Pulkit Agrawal.

</span>
<span class="ltx_bibblock">Value augmented sampling for language model alignment and personalization.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib10.1.1">arXiv preprint arXiv:2405.06639</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hendrycks et al. (2021)</span>
<span class="ltx_bibblock">
Dan Hendrycks, Collin Burns, Saurav Kadavath, Akul Arora, Steven Basart, Eric Tang, Dawn Song, and Jacob Steinhardt.

</span>
<span class="ltx_bibblock">Measuring mathematical problem solving with the MATH dataset.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">Thirty-fifth Conference on Neural Information Processing Systems Datasets and Benchmarks Track (Round 2)</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hu et al. (2022)</span>
<span class="ltx_bibblock">
Edward J Hu, yelong shen, Phillip Wallis, Zeyuan Allen-Zhu, Yuanzhi Li, Shean Wang, Lu Wang, and Weizhu Chen.

</span>
<span class="ltx_bibblock">LoRA: Low-rank adaptation of large language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">International Conference on Learning Representations</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jacob et al. (2024)</span>
<span class="ltx_bibblock">
Athul Paul Jacob, Yikang Shen, Gabriele Farina, and Jacob Andreas.

</span>
<span class="ltx_bibblock">The consensus game: Language model generation via equilibrium search.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">The Twelfth International Conference on Learning Representations</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al. (2023)</span>
<span class="ltx_bibblock">
Albert Q Jiang, Alexandre Sablayrolles, Arthur Mensch, Chris Bamford, Devendra Singh Chaplot, Diego de las Casas, Florian Bressand, Gianna Lengyel, Guillaume Lample, Lucile Saulnier, et al.

</span>
<span class="ltx_bibblock">Mistral 7b.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">arXiv preprint arXiv:2310.06825</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2024)</span>
<span class="ltx_bibblock">
Jia Li, Edward Beeching, Lewis Tunstall, Ben Lipkin, Roman Soletskyi, Shengyi Costa Huang, Kashif Rasul, Longhui Yu, Albert Jiang, Ziju Shen, Zihan Qin, Bin Dong, Li Zhou, Yann Fleureau, Guillaume Lample, and Stanislas Polu.

</span>
<span class="ltx_bibblock">Numinamath.

</span>
<span class="ltx_bibblock"><a class="ltx_ref ltx_url ltx_font_typewriter" href="%5Bhttps://huggingface.co/AI-MO/NuminaMath-CoT%5D(https://github.com/project-numina/aimo-progress-prize/blob/main/report/numina_dataset.pdf)" title="">[https://huggingface.co/AI-MO/NuminaMath-CoT](https://github.com/project-numina/aimo-progress-prize/blob/main/report/numina_dataset.pdf)</a>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2023)</span>
<span class="ltx_bibblock">
Rongao Li, Jie Fu, Bo-Wen Zhang, Tao Huang, Zhihong Sun, Chen Lyu, Guang Liu, Zhi Jin, and Ge Li.

</span>
<span class="ltx_bibblock">Taco: Topics in algorithmic code generation dataset.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">arXiv preprint arXiv:2312.14852</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2022)</span>
<span class="ltx_bibblock">
Yujia Li, David Choi, Junyoung Chung, Nate Kushman, Julian Schrittwieser, Rémi Leblond, Tom Eccles, James Keeling, Felix Gimeno, Agustin Dal Lago, et al.

</span>
<span class="ltx_bibblock">Competition-level code generation with alphacode.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Science</em>, 378(6624):1092–1097, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al. (2024)</span>
<span class="ltx_bibblock">
Jiacheng Liu, Andrew Cohen, Ramakanth Pasunuru, Yejin Choi, Hannaneh Hajishirzi, and Asli Celikyilmaz.

</span>
<span class="ltx_bibblock">Don’t throw away your value model! generating more preferable text with value-guided monte-carlo tree search decoding.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">First Conference on Language Modeling</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Luo et al. (2024)</span>
<span class="ltx_bibblock">
Ziqin Luo, Haixia Han, Haokun Zhao, Guochao Jiang, Chengyu Du, Tingyun Li, Jiaqing Liang, Deqing Yang, and Yanghua Xiao.

</span>
<span class="ltx_bibblock">Sed: Self-evaluation decoding enhances large language models for better generation.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib19.1.1">arXiv preprint arXiv:2405.16552</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Nye et al. (2021)</span>
<span class="ltx_bibblock">
Maxwell Nye, Anders Johan Andreassen, Guy Gur-Ari, Henryk Michalewski, Jacob Austin, David Bieber, David Dohan, Aitor Lewkowycz, Maarten Bosma, David Luan, et al.

</span>
<span class="ltx_bibblock">Show your work: Scratchpads for intermediate computation with language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">arXiv preprint arXiv:2112.00114</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Silver et al. (2016)</span>
<span class="ltx_bibblock">
David Silver, Aja Huang, Chris J Maddison, Arthur Guez, Laurent Sifre, George Van Den Driessche, Julian Schrittwieser, Ioannis Antonoglou, Veda Panneershelvam, Marc Lanctot, et al.

</span>
<span class="ltx_bibblock">Mastering the game of go with deep neural networks and tree search.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib21.1.1">nature</em>, 529(7587):484–489, 2016.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Snell et al. (2024)</span>
<span class="ltx_bibblock">
Charlie Snell, Jaehoon Lee, Kelvin Xu, and Aviral Kumar.

</span>
<span class="ltx_bibblock">Scaling llm test-time compute optimally can be more effective than scaling model parameters.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib22.1.1">arXiv preprint arXiv:2408.03314</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Team et al. (2024)</span>
<span class="ltx_bibblock">
Gemma Team, Thomas Mesnard, Cassidy Hardin, Robert Dadashi, Surya Bhupatiraju, Shreya Pathak, Laurent Sifre, Morgane Rivière, Mihir Sanjay Kale, Juliette Love, et al.

</span>
<span class="ltx_bibblock">Gemma: Open models based on gemini research and technology.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">arXiv preprint arXiv:2403.08295</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2023)</span>
<span class="ltx_bibblock">
Xuezhi Wang, Jason Wei, Dale Schuurmans, Quoc V Le, Ed H. Chi, Sharan Narang, Aakanksha Chowdhery, and Denny Zhou.

</span>
<span class="ltx_bibblock">Self-consistency improves chain of thought reasoning in language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">The Eleventh International Conference on Learning Representations</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wei et al. (2022)</span>
<span class="ltx_bibblock">
Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, Fei Xia, Ed Chi, Quoc V Le, Denny Zhou, et al.

</span>
<span class="ltx_bibblock">Chain-of-thought prompting elicits reasoning in large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">Advances in neural information processing systems</em>, 35:24824–24837, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yao et al. (2024)</span>
<span class="ltx_bibblock">
Shunyu Yao, Dian Yu, Jeffrey Zhao, Izhak Shafran, Tom Griffiths, Yuan Cao, and Karthik Narasimhan.

</span>
<span class="ltx_bibblock">Tree of thoughts: Deliberate problem solving with large language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">Advances in Neural Information Processing Systems</em>, 36, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zheng et al. (2024)</span>
<span class="ltx_bibblock">
Lianmin Zheng, Wei-Lin Chiang, Ying Sheng, Tianle Li, Siyuan Zhuang, Zhanghao Wu, Yonghao Zhuang, Zhuohan Li, Zi Lin, Eric Xing, Joseph E. Gonzalez, Ion Stoica, and Hao Zhang.

</span>
<span class="ltx_bibblock">LMSYS-chat-1m: A large-scale real-world LLM conversation dataset.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">The Twelfth International Conference on Learning Representations</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhou et al. (2023)</span>
<span class="ltx_bibblock">
Denny Zhou, Nathanael Schärli, Le Hou, Jason Wei, Nathan Scales, Xuezhi Wang, Dale Schuurmans, Claire Cui, Olivier Bousquet, Quoc V Le, and Ed H. Chi.

</span>
<span class="ltx_bibblock">Least-to-most prompting enables complex reasoning in large language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">The Eleventh International Conference on Learning Representations</em>, 2023.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Experiment Details</h2>
<section class="ltx_subsection" id="A1.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.1 </span>Math</h3>
<div class="ltx_para ltx_noindent" id="A1.SS1.p1">
<p class="ltx_p" id="A1.SS1.p1.1"><span class="ltx_text ltx_font_bold" id="A1.SS1.p1.1.1">Dataset:</span>
We use a subset of the Numina-COT Dataset <cite class="ltx_cite ltx_citemacro_citep">(Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib15" title="">2024</a>)</cite>,which contains math problems from various sources.
We filtered out multiple choice questions from the dataset.
Our final dataset contained 15K training samples, 2K validation samples and 3K test samples.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p2">
<p class="ltx_p" id="A1.SS1.p2.1"><span class="ltx_text ltx_font_bold" id="A1.SS1.p2.1.1">Model:</span>
We use Mistral AI’s <span class="ltx_text ltx_font_bold" id="A1.SS1.p2.1.2">Mathstral-7B</span> model, which is specialized for mathematical tasks, and is based on Mistral 7B <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib14" title="">2023</a>)</cite>.
We use this model directly off-the-shelf and do not perform any fine-tuning.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p3">
<p class="ltx_p" id="A1.SS1.p3.1"><span class="ltx_text ltx_font_bold" id="A1.SS1.p3.1.1">Verification Pipeline:</span>
We used a <math alttext="2" class="ltx_Math" display="inline" id="A1.SS1.p3.1.m1.1"><semantics id="A1.SS1.p3.1.m1.1a"><mn id="A1.SS1.p3.1.m1.1.1" xref="A1.SS1.p3.1.m1.1.1.cmml">2</mn><annotation-xml encoding="MathML-Content" id="A1.SS1.p3.1.m1.1b"><cn id="A1.SS1.p3.1.m1.1.1.cmml" type="integer" xref="A1.SS1.p3.1.m1.1.1">2</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p3.1.m1.1c">2</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p3.1.m1.1d">2</annotation></semantics></math> stage pipeline to verify the correctness of an answer.
The first stage used the evaluation framework of <cite class="ltx_cite ltx_citemacro_citet">Hendrycks et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.04707v1#bib.bib11" title="">2021</a>)</cite>.
This framework expects the LM to enclose its answer within <span class="ltx_text ltx_font_italic" id="A1.SS1.p3.1.2">boxed </span>{} and then runs an automated evaluation of the extracted answer against the ground truth answer.
However, we found that the automated evaluation had a high false negative rate for various reasons:</p>
<ol class="ltx_enumerate" id="A1.I1">
<li class="ltx_item" id="A1.I1.i1" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">1.</span>
<div class="ltx_para" id="A1.I1.i1.p1">
<p class="ltx_p" id="A1.I1.i1.p1.1"><span class="ltx_text ltx_font_bold" id="A1.I1.i1.p1.1.1">Answer not enclosed within <span class="ltx_text ltx_font_italic" id="A1.I1.i1.p1.1.1.1">boxed </span>{}:</span> For some queries, the model had the right answer but did not enclose it inside <span class="ltx_text ltx_font_italic" id="A1.I1.i1.p1.1.2">boxed </span>{}. This led to the responses being classified as incorrect.</p>
</div>
</li>
<li class="ltx_item" id="A1.I1.i2" style="list-style-type:none;">
<span class="ltx_tag ltx_tag_item">2.</span>
<div class="ltx_para ltx_noindent" id="A1.I1.i2.p1">
<p class="ltx_p" id="A1.I1.i2.p1.1"><span class="ltx_text ltx_font_bold" id="A1.I1.i2.p1.1.1">Errors in Checking:</span> We found that due to errors in checking, many correct responses were marked incorrect. Some examples of false negatives are:</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.I1.i2.p2">
<p class="ltx_p" id="A1.I1.i2.p2.1">1. <span class="ltx_text ltx_font_bold" id="A1.I1.i2.p2.1.1">Model Response:</span> frac{25}{2} ; <span class="ltx_text ltx_font_bold" id="A1.I1.i2.p2.1.2">Ground Truth Answer</span>: 12.5</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.I1.i2.p3">
<p class="ltx_p" id="A1.I1.i2.p3.1">2. <span class="ltx_text ltx_font_bold" id="A1.I1.i2.p3.1.1">Model Response:</span> x=2 ; <span class="ltx_text ltx_font_bold" id="A1.I1.i2.p3.1.2">Ground Truth Answer</span>: 2</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.I1.i2.p4">
<p class="ltx_p" id="A1.I1.i2.p4.1">3. <span class="ltx_text ltx_font_bold" id="A1.I1.i2.p4.1.1">Model Response:</span> -0.5 ; <span class="ltx_text ltx_font_bold" id="A1.I1.i2.p4.1.2">Ground Truth Answer</span>: -frac{1}{2}</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.I1.i2.p5">
<p class="ltx_p" id="A1.I1.i2.p5.1">4. <span class="ltx_text ltx_font_bold" id="A1.I1.i2.p5.1.1">Model Response:</span> 11.00 ; <span class="ltx_text ltx_font_bold" id="A1.I1.i2.p5.1.2">Ground Truth Answer</span>: 11</p>
</div>
</li>
</ol>
<p class="ltx_p" id="A1.SS1.p3.2">These errors were particularly harmful for the training of our marginal reward predictors.
because queries predicted to be (and empirically) easy were being marked incorrect.
Furthermore, our online allocation exacerbated this issue, by assigning very few samples to such queries.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p4">
<p class="ltx_p" id="A1.SS1.p4.3">To address this issue, we introduced a second stage in the verification pipeline that used a LM as an evaluator.
Because stage <math alttext="1" class="ltx_Math" display="inline" id="A1.SS1.p4.1.m1.1"><semantics id="A1.SS1.p4.1.m1.1a"><mn id="A1.SS1.p4.1.m1.1.1" xref="A1.SS1.p4.1.m1.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.1.m1.1b"><cn id="A1.SS1.p4.1.m1.1.1.cmml" type="integer" xref="A1.SS1.p4.1.m1.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.1.m1.1c">1</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.1.m1.1d">1</annotation></semantics></math> does not have false positives, we only used stage <math alttext="2" class="ltx_Math" display="inline" id="A1.SS1.p4.2.m2.1"><semantics id="A1.SS1.p4.2.m2.1a"><mn id="A1.SS1.p4.2.m2.1.1" xref="A1.SS1.p4.2.m2.1.1.cmml">2</mn><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.2.m2.1b"><cn id="A1.SS1.p4.2.m2.1.1.cmml" type="integer" xref="A1.SS1.p4.2.m2.1.1">2</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.2.m2.1c">2</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.2.m2.1d">2</annotation></semantics></math> for responses that were marked incorrect in stage <math alttext="1" class="ltx_Math" display="inline" id="A1.SS1.p4.3.m3.1"><semantics id="A1.SS1.p4.3.m3.1a"><mn id="A1.SS1.p4.3.m3.1.1" xref="A1.SS1.p4.3.m3.1.1.cmml">1</mn><annotation-xml encoding="MathML-Content" id="A1.SS1.p4.3.m3.1b"><cn id="A1.SS1.p4.3.m3.1.1.cmml" type="integer" xref="A1.SS1.p4.3.m3.1.1">1</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p4.3.m3.1c">1</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p4.3.m3.1d">1</annotation></semantics></math>.
We used Llama-3.1-8B-Instruct with temperature set to 0.1 as our evaluation LM, and prompted it as follows:</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p5">
<svg class="ltx_picture" height="172.69" id="A1.SS1.p5.pic1" overflow="visible" version="1.1" width="600"><g fill="#000000" stroke="#000000" stroke-width="0.4pt" transform="translate(0,172.69) matrix(1 0 0 -1 0 0)"><g fill="#404040" fill-opacity="1.0"><path d="M 0 5.91 L 0 166.79 C 0 170.05 2.64 172.69 5.91 172.69 L 594.09 172.69 C 597.36 172.69 600 170.05 600 166.79 L 600 5.91 C 600 2.64 597.36 0 594.09 0 L 5.91 0 C 2.64 0 0 2.64 0 5.91 Z" style="stroke:none"></path></g><g fill="#E6E6E6" fill-opacity="1.0"><path d="M 1.97 5.91 L 1.97 166.79 C 1.97 168.96 3.73 170.73 5.91 170.73 L 594.09 170.73 C 596.27 170.73 598.03 168.96 598.03 166.79 L 598.03 5.91 C 598.03 3.73 596.27 1.97 594.09 1.97 L 5.91 1.97 C 3.73 1.97 1.97 3.73 1.97 5.91 Z" style="stroke:none"></path></g><g fill-opacity="1.0" transform="matrix(1.0 0.0 0.0 1.0 21.65 13.78)"><foreignobject color="#000000" height="145.13" overflow="visible" transform="matrix(1 0 0 -1 0 16.6)" width="556.69">
<span class="ltx_inline-block ltx_minipage ltx_align_bottom" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2" style="width:402.3pt;">
<span class="ltx_p" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.3"><span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.3.1">You are a math evaluation agent. You are tasked with evaluating if the final answer from an excerpt of the
response matches the given gold truth answer. The format or units of the response and gold truth answer
might be different. However, you must evaluate if the answers are numerically equivalent/identical. Be extra careful when evaluating fractions,
they must simplify to the same value
Your response should be a single word followed by an explanation. ’YES’ if the answers are equivalent and ’NO’ if they are not.</span></span>
<span class="ltx_p" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.4"><span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.4.1">Examples:</span></span>
<span class="ltx_p" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.5"><span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.5.1">A) 7% and 7 are equivalent</span></span>
<span class="ltx_p" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.6"><span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.6.1">B) frac</span>{<span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.6.2">10</span>}{<span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.6.3">2</span>}<span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.6.4"> and frac </span>{<span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.6.5">20</span>}{<span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.6.6">4</span>}<span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.6.7"> are equivalent.</span></span>
<span class="ltx_p" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.7"><span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.7.1">C) 3,5,7 and 3,8,9 are not equivalent. 
<br class="ltx_break"/></span></span>
<span class="ltx_p" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1"><span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1">Ground Truth Answer: <math alttext="&lt;\text{ }&gt;" class="ltx_Math" display="inline" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1"><semantics id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1a"><mrow id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.2" xref="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.1.cmml"><mo fence="true" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.2.1" rspace="0em" xref="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.1.1.cmml">&lt;</mo><mtext class="ltx_mathvariant_italic" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1" xref="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1a.cmml"> </mtext><mo fence="true" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.2.2" lspace="0em" xref="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.1.1.cmml">&gt;</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1b"><apply id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.1.cmml" xref="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.2"><csymbol cd="latexml" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.1.1.cmml" xref="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.2.2.1">expectation</csymbol><ci id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1a.cmml" xref="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1"><mtext class="ltx_mathvariant_italic" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1.cmml" xref="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1.1"> </mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1c">&lt;\text{ }&gt;</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p5.pic1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.1.m1.1d">&lt; &gt;</annotation></semantics></math></span></span>
<span class="ltx_p" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2"><span class="ltx_text ltx_font_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1">Response: <math alttext="&lt;\text{ }&gt;" class="ltx_Math" display="inline" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1"><semantics id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1a"><mrow id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.2" xref="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.1.cmml"><mo fence="true" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.2.1" rspace="0em" xref="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.1.1.cmml">&lt;</mo><mtext class="ltx_mathvariant_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.1" xref="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.1a.cmml"> </mtext><mo fence="true" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.2.2" lspace="0em" xref="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.1.1.cmml">&gt;</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1b"><apply id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.1.cmml" xref="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.2"><csymbol cd="latexml" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.1.1.cmml" xref="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.2.2.1">expectation</csymbol><ci id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.1a.cmml" xref="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.1"><mtext class="ltx_mathvariant_italic" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.1.cmml" xref="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1.1"> </mtext></ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1c">&lt;\text{ }&gt;</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p5.pic1.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.2.1.m1.1d">&lt; &gt;</annotation></semantics></math></span></span>
</span></foreignobject></g></g></svg>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p6">
<p class="ltx_p" id="A1.SS1.p6.1">Note that if the model’s response had an answer enclosed inside <span class="ltx_text ltx_font_italic" id="A1.SS1.p6.1.1">boxed </span>{}, we only provided that extracted answer.
If this was not the case, then we provided the model’s entire response to the LLM evaluation agent.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p7">
<p class="ltx_p" id="A1.SS1.p7.1"><span class="ltx_text ltx_font_bold" id="A1.SS1.p7.1.1">The 2-stage pipeline helped us significantly improve the evaluation process, as well as stabilize the training process for our marginal reward predictors.
However, this pipeline is not without flaws, as we did notice examples a small number of false positives in the second stage.</span></p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p8">
<p class="ltx_p" id="A1.SS1.p8.4"><span class="ltx_text ltx_font_bold" id="A1.SS1.p8.4.1">Training:</span>
We generate <math alttext="128" class="ltx_Math" display="inline" id="A1.SS1.p8.1.m1.1"><semantics id="A1.SS1.p8.1.m1.1a"><mn id="A1.SS1.p8.1.m1.1.1" xref="A1.SS1.p8.1.m1.1.1.cmml">128</mn><annotation-xml encoding="MathML-Content" id="A1.SS1.p8.1.m1.1b"><cn id="A1.SS1.p8.1.m1.1.1.cmml" type="integer" xref="A1.SS1.p8.1.m1.1.1">128</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p8.1.m1.1c">128</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p8.1.m1.1d">128</annotation></semantics></math> responses for every query (temperature=0.7) and label them using the verification pipeline.
We use the labels to compute the empirical mean success probabilities <math alttext="\lambda_{i}" class="ltx_Math" display="inline" id="A1.SS1.p8.2.m2.1"><semantics id="A1.SS1.p8.2.m2.1a"><msub id="A1.SS1.p8.2.m2.1.1" xref="A1.SS1.p8.2.m2.1.1.cmml"><mi id="A1.SS1.p8.2.m2.1.1.2" xref="A1.SS1.p8.2.m2.1.1.2.cmml">λ</mi><mi id="A1.SS1.p8.2.m2.1.1.3" xref="A1.SS1.p8.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p8.2.m2.1b"><apply id="A1.SS1.p8.2.m2.1.1.cmml" xref="A1.SS1.p8.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS1.p8.2.m2.1.1.1.cmml" xref="A1.SS1.p8.2.m2.1.1">subscript</csymbol><ci id="A1.SS1.p8.2.m2.1.1.2.cmml" xref="A1.SS1.p8.2.m2.1.1.2">𝜆</ci><ci id="A1.SS1.p8.2.m2.1.1.3.cmml" xref="A1.SS1.p8.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p8.2.m2.1c">\lambda_{i}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p8.2.m2.1d">italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.
The estimated <math alttext="\lambda_{i}" class="ltx_Math" display="inline" id="A1.SS1.p8.3.m3.1"><semantics id="A1.SS1.p8.3.m3.1a"><msub id="A1.SS1.p8.3.m3.1.1" xref="A1.SS1.p8.3.m3.1.1.cmml"><mi id="A1.SS1.p8.3.m3.1.1.2" xref="A1.SS1.p8.3.m3.1.1.2.cmml">λ</mi><mi id="A1.SS1.p8.3.m3.1.1.3" xref="A1.SS1.p8.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS1.p8.3.m3.1b"><apply id="A1.SS1.p8.3.m3.1.1.cmml" xref="A1.SS1.p8.3.m3.1.1"><csymbol cd="ambiguous" id="A1.SS1.p8.3.m3.1.1.1.cmml" xref="A1.SS1.p8.3.m3.1.1">subscript</csymbol><ci id="A1.SS1.p8.3.m3.1.1.2.cmml" xref="A1.SS1.p8.3.m3.1.1.2">𝜆</ci><ci id="A1.SS1.p8.3.m3.1.1.3.cmml" xref="A1.SS1.p8.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p8.3.m3.1c">\lambda_{i}</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p8.3.m3.1d">italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> are then used as targets to train <math alttext="\hat{\mathbf{\Delta}}(x;\theta)" class="ltx_Math" display="inline" id="A1.SS1.p8.4.m4.2"><semantics id="A1.SS1.p8.4.m4.2a"><mrow id="A1.SS1.p8.4.m4.2.3" xref="A1.SS1.p8.4.m4.2.3.cmml"><mover accent="true" id="A1.SS1.p8.4.m4.2.3.2" xref="A1.SS1.p8.4.m4.2.3.2.cmml"><mi id="A1.SS1.p8.4.m4.2.3.2.2" xref="A1.SS1.p8.4.m4.2.3.2.2.cmml">𝚫</mi><mo id="A1.SS1.p8.4.m4.2.3.2.1" xref="A1.SS1.p8.4.m4.2.3.2.1.cmml">^</mo></mover><mo id="A1.SS1.p8.4.m4.2.3.1" xref="A1.SS1.p8.4.m4.2.3.1.cmml">⁢</mo><mrow id="A1.SS1.p8.4.m4.2.3.3.2" xref="A1.SS1.p8.4.m4.2.3.3.1.cmml"><mo id="A1.SS1.p8.4.m4.2.3.3.2.1" stretchy="false" xref="A1.SS1.p8.4.m4.2.3.3.1.cmml">(</mo><mi id="A1.SS1.p8.4.m4.1.1" xref="A1.SS1.p8.4.m4.1.1.cmml">x</mi><mo id="A1.SS1.p8.4.m4.2.3.3.2.2" xref="A1.SS1.p8.4.m4.2.3.3.1.cmml">;</mo><mi id="A1.SS1.p8.4.m4.2.2" xref="A1.SS1.p8.4.m4.2.2.cmml">θ</mi><mo id="A1.SS1.p8.4.m4.2.3.3.2.3" stretchy="false" xref="A1.SS1.p8.4.m4.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p8.4.m4.2b"><apply id="A1.SS1.p8.4.m4.2.3.cmml" xref="A1.SS1.p8.4.m4.2.3"><times id="A1.SS1.p8.4.m4.2.3.1.cmml" xref="A1.SS1.p8.4.m4.2.3.1"></times><apply id="A1.SS1.p8.4.m4.2.3.2.cmml" xref="A1.SS1.p8.4.m4.2.3.2"><ci id="A1.SS1.p8.4.m4.2.3.2.1.cmml" xref="A1.SS1.p8.4.m4.2.3.2.1">^</ci><ci id="A1.SS1.p8.4.m4.2.3.2.2.cmml" xref="A1.SS1.p8.4.m4.2.3.2.2">𝚫</ci></apply><list id="A1.SS1.p8.4.m4.2.3.3.1.cmml" xref="A1.SS1.p8.4.m4.2.3.3.2"><ci id="A1.SS1.p8.4.m4.1.1.cmml" xref="A1.SS1.p8.4.m4.1.1">𝑥</ci><ci id="A1.SS1.p8.4.m4.2.2.cmml" xref="A1.SS1.p8.4.m4.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p8.4.m4.2c">\hat{\mathbf{\Delta}}(x;\theta)</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p8.4.m4.2d">over^ start_ARG bold_Δ end_ARG ( italic_x ; italic_θ )</annotation></semantics></math>, the marginal reward predictor.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS1.p9">
<p class="ltx_p" id="A1.SS1.p9.1"><span class="ltx_text ltx_font_bold" id="A1.SS1.p9.1.1">Evaluation:</span>
Our adaptive allocation algorithms are assigned a maximum budget of <math alttext="B_{max}=128" class="ltx_Math" display="inline" id="A1.SS1.p9.1.m1.1"><semantics id="A1.SS1.p9.1.m1.1a"><mrow id="A1.SS1.p9.1.m1.1.1" xref="A1.SS1.p9.1.m1.1.1.cmml"><msub id="A1.SS1.p9.1.m1.1.1.2" xref="A1.SS1.p9.1.m1.1.1.2.cmml"><mi id="A1.SS1.p9.1.m1.1.1.2.2" xref="A1.SS1.p9.1.m1.1.1.2.2.cmml">B</mi><mrow id="A1.SS1.p9.1.m1.1.1.2.3" xref="A1.SS1.p9.1.m1.1.1.2.3.cmml"><mi id="A1.SS1.p9.1.m1.1.1.2.3.2" xref="A1.SS1.p9.1.m1.1.1.2.3.2.cmml">m</mi><mo id="A1.SS1.p9.1.m1.1.1.2.3.1" xref="A1.SS1.p9.1.m1.1.1.2.3.1.cmml">⁢</mo><mi id="A1.SS1.p9.1.m1.1.1.2.3.3" xref="A1.SS1.p9.1.m1.1.1.2.3.3.cmml">a</mi><mo id="A1.SS1.p9.1.m1.1.1.2.3.1a" xref="A1.SS1.p9.1.m1.1.1.2.3.1.cmml">⁢</mo><mi id="A1.SS1.p9.1.m1.1.1.2.3.4" xref="A1.SS1.p9.1.m1.1.1.2.3.4.cmml">x</mi></mrow></msub><mo id="A1.SS1.p9.1.m1.1.1.1" xref="A1.SS1.p9.1.m1.1.1.1.cmml">=</mo><mn id="A1.SS1.p9.1.m1.1.1.3" xref="A1.SS1.p9.1.m1.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS1.p9.1.m1.1b"><apply id="A1.SS1.p9.1.m1.1.1.cmml" xref="A1.SS1.p9.1.m1.1.1"><eq id="A1.SS1.p9.1.m1.1.1.1.cmml" xref="A1.SS1.p9.1.m1.1.1.1"></eq><apply id="A1.SS1.p9.1.m1.1.1.2.cmml" xref="A1.SS1.p9.1.m1.1.1.2"><csymbol cd="ambiguous" id="A1.SS1.p9.1.m1.1.1.2.1.cmml" xref="A1.SS1.p9.1.m1.1.1.2">subscript</csymbol><ci id="A1.SS1.p9.1.m1.1.1.2.2.cmml" xref="A1.SS1.p9.1.m1.1.1.2.2">𝐵</ci><apply id="A1.SS1.p9.1.m1.1.1.2.3.cmml" xref="A1.SS1.p9.1.m1.1.1.2.3"><times id="A1.SS1.p9.1.m1.1.1.2.3.1.cmml" xref="A1.SS1.p9.1.m1.1.1.2.3.1"></times><ci id="A1.SS1.p9.1.m1.1.1.2.3.2.cmml" xref="A1.SS1.p9.1.m1.1.1.2.3.2">𝑚</ci><ci id="A1.SS1.p9.1.m1.1.1.2.3.3.cmml" xref="A1.SS1.p9.1.m1.1.1.2.3.3">𝑎</ci><ci id="A1.SS1.p9.1.m1.1.1.2.3.4.cmml" xref="A1.SS1.p9.1.m1.1.1.2.3.4">𝑥</ci></apply></apply><cn id="A1.SS1.p9.1.m1.1.1.3.cmml" type="integer" xref="A1.SS1.p9.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS1.p9.1.m1.1c">B_{max}=128</annotation><annotation encoding="application/x-llamapun" id="A1.SS1.p9.1.m1.1d">italic_B start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT = 128</annotation></semantics></math> samples per query (that is the allocation for any query is capped at 128 samples).</p>
</div>
</section>
<section class="ltx_subsection" id="A1.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.2 </span>Code</h3>
<div class="ltx_para ltx_noindent" id="A1.SS2.p1">
<p class="ltx_p" id="A1.SS2.p1.1"><span class="ltx_text ltx_font_bold" id="A1.SS2.p1.1.1">Dataset:</span>
We use a subset of TACO, a dataset focused on algorithmic code generation with problems sourced from various programming contest platforms such as CodeChef, CodeForces and HackerRank.
Our primary reason for selecting TACO was the availability of test cases for most problems, which is required to train a predictor of success probability.
We filtered out problems that did not have a single unit test.
We also filtered out problems that were sourced from <span class="ltx_text ltx_font_italic" id="A1.SS2.p1.1.2">geeksforgeeks</span> and <span class="ltx_text ltx_font_italic" id="A1.SS2.p1.1.3">aizu</span>, as the official evaluation framework did not support those.
Our final dataset consisted of 10K training samples, 1K validation samples and 1K test samples.
Note that these three splits in our experiments were extracted from official TACO <em class="ltx_emph ltx_font_italic" id="A1.SS2.p1.1.4">training set</em>.
This is because the TACO test set has a very different distribution of problem difficulties, while our method aims to produce accurate <em class="ltx_emph ltx_font_italic" id="A1.SS2.p1.1.5">in-distribution</em> allocation of computation. We believe producing distributionally robust predictors is an important topic for future work.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS2.p2">
<p class="ltx_p" id="A1.SS2.p2.1"><span class="ltx_text ltx_font_bold" id="A1.SS2.p2.1.1">Model:</span>
We used the <span class="ltx_text ltx_font_bold" id="A1.SS2.p2.1.2">Starcoder-15B</span> model, which was finetuned and open-sourced by the authors of Taco.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS2.p3">
<p class="ltx_p" id="A1.SS2.p3.4"><span class="ltx_text ltx_font_bold" id="A1.SS2.p3.4.1">Training:</span>
We generate <math alttext="100" class="ltx_Math" display="inline" id="A1.SS2.p3.1.m1.1"><semantics id="A1.SS2.p3.1.m1.1a"><mn id="A1.SS2.p3.1.m1.1.1" xref="A1.SS2.p3.1.m1.1.1.cmml">100</mn><annotation-xml encoding="MathML-Content" id="A1.SS2.p3.1.m1.1b"><cn id="A1.SS2.p3.1.m1.1.1.cmml" type="integer" xref="A1.SS2.p3.1.m1.1.1">100</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS2.p3.1.m1.1c">100</annotation><annotation encoding="application/x-llamapun" id="A1.SS2.p3.1.m1.1d">100</annotation></semantics></math> responses for every query (temperature=0.7) and label them using the unit-test verifier to obtain the mean success probability <math alttext="\lambda_{i}" class="ltx_Math" display="inline" id="A1.SS2.p3.2.m2.1"><semantics id="A1.SS2.p3.2.m2.1a"><msub id="A1.SS2.p3.2.m2.1.1" xref="A1.SS2.p3.2.m2.1.1.cmml"><mi id="A1.SS2.p3.2.m2.1.1.2" xref="A1.SS2.p3.2.m2.1.1.2.cmml">λ</mi><mi id="A1.SS2.p3.2.m2.1.1.3" xref="A1.SS2.p3.2.m2.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS2.p3.2.m2.1b"><apply id="A1.SS2.p3.2.m2.1.1.cmml" xref="A1.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS2.p3.2.m2.1.1.1.cmml" xref="A1.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="A1.SS2.p3.2.m2.1.1.2.cmml" xref="A1.SS2.p3.2.m2.1.1.2">𝜆</ci><ci id="A1.SS2.p3.2.m2.1.1.3.cmml" xref="A1.SS2.p3.2.m2.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS2.p3.2.m2.1c">\lambda_{i}</annotation><annotation encoding="application/x-llamapun" id="A1.SS2.p3.2.m2.1d">italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.
The estimated <math alttext="\lambda_{i}" class="ltx_Math" display="inline" id="A1.SS2.p3.3.m3.1"><semantics id="A1.SS2.p3.3.m3.1a"><msub id="A1.SS2.p3.3.m3.1.1" xref="A1.SS2.p3.3.m3.1.1.cmml"><mi id="A1.SS2.p3.3.m3.1.1.2" xref="A1.SS2.p3.3.m3.1.1.2.cmml">λ</mi><mi id="A1.SS2.p3.3.m3.1.1.3" xref="A1.SS2.p3.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS2.p3.3.m3.1b"><apply id="A1.SS2.p3.3.m3.1.1.cmml" xref="A1.SS2.p3.3.m3.1.1"><csymbol cd="ambiguous" id="A1.SS2.p3.3.m3.1.1.1.cmml" xref="A1.SS2.p3.3.m3.1.1">subscript</csymbol><ci id="A1.SS2.p3.3.m3.1.1.2.cmml" xref="A1.SS2.p3.3.m3.1.1.2">𝜆</ci><ci id="A1.SS2.p3.3.m3.1.1.3.cmml" xref="A1.SS2.p3.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS2.p3.3.m3.1c">\lambda_{i}</annotation><annotation encoding="application/x-llamapun" id="A1.SS2.p3.3.m3.1d">italic_λ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> are then used as targets to train <math alttext="\hat{\mathbf{\Delta}}(x;\theta)" class="ltx_Math" display="inline" id="A1.SS2.p3.4.m4.2"><semantics id="A1.SS2.p3.4.m4.2a"><mrow id="A1.SS2.p3.4.m4.2.3" xref="A1.SS2.p3.4.m4.2.3.cmml"><mover accent="true" id="A1.SS2.p3.4.m4.2.3.2" xref="A1.SS2.p3.4.m4.2.3.2.cmml"><mi id="A1.SS2.p3.4.m4.2.3.2.2" xref="A1.SS2.p3.4.m4.2.3.2.2.cmml">𝚫</mi><mo id="A1.SS2.p3.4.m4.2.3.2.1" xref="A1.SS2.p3.4.m4.2.3.2.1.cmml">^</mo></mover><mo id="A1.SS2.p3.4.m4.2.3.1" xref="A1.SS2.p3.4.m4.2.3.1.cmml">⁢</mo><mrow id="A1.SS2.p3.4.m4.2.3.3.2" xref="A1.SS2.p3.4.m4.2.3.3.1.cmml"><mo id="A1.SS2.p3.4.m4.2.3.3.2.1" stretchy="false" xref="A1.SS2.p3.4.m4.2.3.3.1.cmml">(</mo><mi id="A1.SS2.p3.4.m4.1.1" xref="A1.SS2.p3.4.m4.1.1.cmml">x</mi><mo id="A1.SS2.p3.4.m4.2.3.3.2.2" xref="A1.SS2.p3.4.m4.2.3.3.1.cmml">;</mo><mi id="A1.SS2.p3.4.m4.2.2" xref="A1.SS2.p3.4.m4.2.2.cmml">θ</mi><mo id="A1.SS2.p3.4.m4.2.3.3.2.3" stretchy="false" xref="A1.SS2.p3.4.m4.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS2.p3.4.m4.2b"><apply id="A1.SS2.p3.4.m4.2.3.cmml" xref="A1.SS2.p3.4.m4.2.3"><times id="A1.SS2.p3.4.m4.2.3.1.cmml" xref="A1.SS2.p3.4.m4.2.3.1"></times><apply id="A1.SS2.p3.4.m4.2.3.2.cmml" xref="A1.SS2.p3.4.m4.2.3.2"><ci id="A1.SS2.p3.4.m4.2.3.2.1.cmml" xref="A1.SS2.p3.4.m4.2.3.2.1">^</ci><ci id="A1.SS2.p3.4.m4.2.3.2.2.cmml" xref="A1.SS2.p3.4.m4.2.3.2.2">𝚫</ci></apply><list id="A1.SS2.p3.4.m4.2.3.3.1.cmml" xref="A1.SS2.p3.4.m4.2.3.3.2"><ci id="A1.SS2.p3.4.m4.1.1.cmml" xref="A1.SS2.p3.4.m4.1.1">𝑥</ci><ci id="A1.SS2.p3.4.m4.2.2.cmml" xref="A1.SS2.p3.4.m4.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS2.p3.4.m4.2c">\hat{\mathbf{\Delta}}(x;\theta)</annotation><annotation encoding="application/x-llamapun" id="A1.SS2.p3.4.m4.2d">over^ start_ARG bold_Δ end_ARG ( italic_x ; italic_θ )</annotation></semantics></math>, the marginal reward predictor.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS2.p4">
<p class="ltx_p" id="A1.SS2.p4.1"><span class="ltx_text ltx_font_bold" id="A1.SS2.p4.1.1">Evaluation:</span>
We used the official evaluation framework released by the creators of the TACO dataset. A response was considered a success if it passed all available test cases.
Our adaptive allocation algorithms are assigned a maximum budget of <math alttext="B_{max}=100" class="ltx_Math" display="inline" id="A1.SS2.p4.1.m1.1"><semantics id="A1.SS2.p4.1.m1.1a"><mrow id="A1.SS2.p4.1.m1.1.1" xref="A1.SS2.p4.1.m1.1.1.cmml"><msub id="A1.SS2.p4.1.m1.1.1.2" xref="A1.SS2.p4.1.m1.1.1.2.cmml"><mi id="A1.SS2.p4.1.m1.1.1.2.2" xref="A1.SS2.p4.1.m1.1.1.2.2.cmml">B</mi><mrow id="A1.SS2.p4.1.m1.1.1.2.3" xref="A1.SS2.p4.1.m1.1.1.2.3.cmml"><mi id="A1.SS2.p4.1.m1.1.1.2.3.2" xref="A1.SS2.p4.1.m1.1.1.2.3.2.cmml">m</mi><mo id="A1.SS2.p4.1.m1.1.1.2.3.1" xref="A1.SS2.p4.1.m1.1.1.2.3.1.cmml">⁢</mo><mi id="A1.SS2.p4.1.m1.1.1.2.3.3" xref="A1.SS2.p4.1.m1.1.1.2.3.3.cmml">a</mi><mo id="A1.SS2.p4.1.m1.1.1.2.3.1a" xref="A1.SS2.p4.1.m1.1.1.2.3.1.cmml">⁢</mo><mi id="A1.SS2.p4.1.m1.1.1.2.3.4" xref="A1.SS2.p4.1.m1.1.1.2.3.4.cmml">x</mi></mrow></msub><mo id="A1.SS2.p4.1.m1.1.1.1" xref="A1.SS2.p4.1.m1.1.1.1.cmml">=</mo><mn id="A1.SS2.p4.1.m1.1.1.3" xref="A1.SS2.p4.1.m1.1.1.3.cmml">100</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS2.p4.1.m1.1b"><apply id="A1.SS2.p4.1.m1.1.1.cmml" xref="A1.SS2.p4.1.m1.1.1"><eq id="A1.SS2.p4.1.m1.1.1.1.cmml" xref="A1.SS2.p4.1.m1.1.1.1"></eq><apply id="A1.SS2.p4.1.m1.1.1.2.cmml" xref="A1.SS2.p4.1.m1.1.1.2"><csymbol cd="ambiguous" id="A1.SS2.p4.1.m1.1.1.2.1.cmml" xref="A1.SS2.p4.1.m1.1.1.2">subscript</csymbol><ci id="A1.SS2.p4.1.m1.1.1.2.2.cmml" xref="A1.SS2.p4.1.m1.1.1.2.2">𝐵</ci><apply id="A1.SS2.p4.1.m1.1.1.2.3.cmml" xref="A1.SS2.p4.1.m1.1.1.2.3"><times id="A1.SS2.p4.1.m1.1.1.2.3.1.cmml" xref="A1.SS2.p4.1.m1.1.1.2.3.1"></times><ci id="A1.SS2.p4.1.m1.1.1.2.3.2.cmml" xref="A1.SS2.p4.1.m1.1.1.2.3.2">𝑚</ci><ci id="A1.SS2.p4.1.m1.1.1.2.3.3.cmml" xref="A1.SS2.p4.1.m1.1.1.2.3.3">𝑎</ci><ci id="A1.SS2.p4.1.m1.1.1.2.3.4.cmml" xref="A1.SS2.p4.1.m1.1.1.2.3.4">𝑥</ci></apply></apply><cn id="A1.SS2.p4.1.m1.1.1.3.cmml" type="integer" xref="A1.SS2.p4.1.m1.1.1.3">100</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS2.p4.1.m1.1c">B_{max}=100</annotation><annotation encoding="application/x-llamapun" id="A1.SS2.p4.1.m1.1d">italic_B start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT = 100</annotation></semantics></math> samples per query (that is the allocation for any query was capped at 100 samples).</p>
</div>
</section>
<section class="ltx_subsection" id="A1.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.3 </span>Chat</h3>
<div class="ltx_para ltx_noindent" id="A1.SS3.p1">
<p class="ltx_p" id="A1.SS3.p1.1"><span class="ltx_text ltx_font_bold" id="A1.SS3.p1.1.1">Dataset:</span>
We use a subset of the LMSYS-Chat dataset, which contains one million real-world conversations with <math alttext="25" class="ltx_Math" display="inline" id="A1.SS3.p1.1.m1.1"><semantics id="A1.SS3.p1.1.m1.1a"><mn id="A1.SS3.p1.1.m1.1.1" xref="A1.SS3.p1.1.m1.1.1.cmml">25</mn><annotation-xml encoding="MathML-Content" id="A1.SS3.p1.1.m1.1b"><cn id="A1.SS3.p1.1.m1.1.1.cmml" type="integer" xref="A1.SS3.p1.1.m1.1.1">25</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p1.1.m1.1c">25</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p1.1.m1.1d">25</annotation></semantics></math> LLMs.
We filter the dataset to only select samples in English and with less than 10 turns.
We also filter out samples which were labelled redacted, as these were often artificially modified.
Our final dataset consisted of 50K training samples and 5K test samples.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS3.p2">
<p class="ltx_p" id="A1.SS3.p2.1"><span class="ltx_text ltx_font_bold" id="A1.SS3.p2.1.1">Model:</span>
We used the <span class="ltx_text ltx_font_bold" id="A1.SS3.p2.1.2">Gemma-2B-it</span> model. We did not perform any fine-tuning.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS3.p3">
<p class="ltx_p" id="A1.SS3.p3.5"><span class="ltx_text ltx_font_bold" id="A1.SS3.p3.5.1">Training:</span>
We generate <math alttext="8" class="ltx_Math" display="inline" id="A1.SS3.p3.1.m1.1"><semantics id="A1.SS3.p3.1.m1.1a"><mn id="A1.SS3.p3.1.m1.1.1" xref="A1.SS3.p3.1.m1.1.1.cmml">8</mn><annotation-xml encoding="MathML-Content" id="A1.SS3.p3.1.m1.1b"><cn id="A1.SS3.p3.1.m1.1.1.cmml" type="integer" xref="A1.SS3.p3.1.m1.1.1">8</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p3.1.m1.1c">8</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p3.1.m1.1d">8</annotation></semantics></math> responses (temperature=0.7) for every query and label them using <span class="ltx_text ltx_font_bold" id="A1.SS3.p3.5.2">NCSOFT/Llama-3-OffsetBias-RM-8B</span>, which was ranked amongst the top <math alttext="10" class="ltx_Math" display="inline" id="A1.SS3.p3.2.m2.1"><semantics id="A1.SS3.p3.2.m2.1a"><mn id="A1.SS3.p3.2.m2.1.1" xref="A1.SS3.p3.2.m2.1.1.cmml">10</mn><annotation-xml encoding="MathML-Content" id="A1.SS3.p3.2.m2.1b"><cn id="A1.SS3.p3.2.m2.1.1.cmml" type="integer" xref="A1.SS3.p3.2.m2.1.1">10</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p3.2.m2.1c">10</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p3.2.m2.1d">10</annotation></semantics></math> on RewardBench at the time of writing.
We then use bootstrapping to approximate <math alttext="\mathbf{\Delta}_{i}" class="ltx_Math" display="inline" id="A1.SS3.p3.3.m3.1"><semantics id="A1.SS3.p3.3.m3.1a"><msub id="A1.SS3.p3.3.m3.1.1" xref="A1.SS3.p3.3.m3.1.1.cmml"><mi id="A1.SS3.p3.3.m3.1.1.2" xref="A1.SS3.p3.3.m3.1.1.2.cmml">𝚫</mi><mi id="A1.SS3.p3.3.m3.1.1.3" xref="A1.SS3.p3.3.m3.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS3.p3.3.m3.1b"><apply id="A1.SS3.p3.3.m3.1.1.cmml" xref="A1.SS3.p3.3.m3.1.1"><csymbol cd="ambiguous" id="A1.SS3.p3.3.m3.1.1.1.cmml" xref="A1.SS3.p3.3.m3.1.1">subscript</csymbol><ci id="A1.SS3.p3.3.m3.1.1.2.cmml" xref="A1.SS3.p3.3.m3.1.1.2">𝚫</ci><ci id="A1.SS3.p3.3.m3.1.1.3.cmml" xref="A1.SS3.p3.3.m3.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p3.3.m3.1c">\mathbf{\Delta}_{i}</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p3.3.m3.1d">bold_Δ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>.
The approximated <math alttext="\mathbf{\Delta}_{i}" class="ltx_Math" display="inline" id="A1.SS3.p3.4.m4.1"><semantics id="A1.SS3.p3.4.m4.1a"><msub id="A1.SS3.p3.4.m4.1.1" xref="A1.SS3.p3.4.m4.1.1.cmml"><mi id="A1.SS3.p3.4.m4.1.1.2" xref="A1.SS3.p3.4.m4.1.1.2.cmml">𝚫</mi><mi id="A1.SS3.p3.4.m4.1.1.3" xref="A1.SS3.p3.4.m4.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="A1.SS3.p3.4.m4.1b"><apply id="A1.SS3.p3.4.m4.1.1.cmml" xref="A1.SS3.p3.4.m4.1.1"><csymbol cd="ambiguous" id="A1.SS3.p3.4.m4.1.1.1.cmml" xref="A1.SS3.p3.4.m4.1.1">subscript</csymbol><ci id="A1.SS3.p3.4.m4.1.1.2.cmml" xref="A1.SS3.p3.4.m4.1.1.2">𝚫</ci><ci id="A1.SS3.p3.4.m4.1.1.3.cmml" xref="A1.SS3.p3.4.m4.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p3.4.m4.1c">\mathbf{\Delta}_{i}</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p3.4.m4.1d">bold_Δ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> are then used as targets to train <math alttext="\hat{\mathbf{\Delta}}(x;\theta)" class="ltx_Math" display="inline" id="A1.SS3.p3.5.m5.2"><semantics id="A1.SS3.p3.5.m5.2a"><mrow id="A1.SS3.p3.5.m5.2.3" xref="A1.SS3.p3.5.m5.2.3.cmml"><mover accent="true" id="A1.SS3.p3.5.m5.2.3.2" xref="A1.SS3.p3.5.m5.2.3.2.cmml"><mi id="A1.SS3.p3.5.m5.2.3.2.2" xref="A1.SS3.p3.5.m5.2.3.2.2.cmml">𝚫</mi><mo id="A1.SS3.p3.5.m5.2.3.2.1" xref="A1.SS3.p3.5.m5.2.3.2.1.cmml">^</mo></mover><mo id="A1.SS3.p3.5.m5.2.3.1" xref="A1.SS3.p3.5.m5.2.3.1.cmml">⁢</mo><mrow id="A1.SS3.p3.5.m5.2.3.3.2" xref="A1.SS3.p3.5.m5.2.3.3.1.cmml"><mo id="A1.SS3.p3.5.m5.2.3.3.2.1" stretchy="false" xref="A1.SS3.p3.5.m5.2.3.3.1.cmml">(</mo><mi id="A1.SS3.p3.5.m5.1.1" xref="A1.SS3.p3.5.m5.1.1.cmml">x</mi><mo id="A1.SS3.p3.5.m5.2.3.3.2.2" xref="A1.SS3.p3.5.m5.2.3.3.1.cmml">;</mo><mi id="A1.SS3.p3.5.m5.2.2" xref="A1.SS3.p3.5.m5.2.2.cmml">θ</mi><mo id="A1.SS3.p3.5.m5.2.3.3.2.3" stretchy="false" xref="A1.SS3.p3.5.m5.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.SS3.p3.5.m5.2b"><apply id="A1.SS3.p3.5.m5.2.3.cmml" xref="A1.SS3.p3.5.m5.2.3"><times id="A1.SS3.p3.5.m5.2.3.1.cmml" xref="A1.SS3.p3.5.m5.2.3.1"></times><apply id="A1.SS3.p3.5.m5.2.3.2.cmml" xref="A1.SS3.p3.5.m5.2.3.2"><ci id="A1.SS3.p3.5.m5.2.3.2.1.cmml" xref="A1.SS3.p3.5.m5.2.3.2.1">^</ci><ci id="A1.SS3.p3.5.m5.2.3.2.2.cmml" xref="A1.SS3.p3.5.m5.2.3.2.2">𝚫</ci></apply><list id="A1.SS3.p3.5.m5.2.3.3.1.cmml" xref="A1.SS3.p3.5.m5.2.3.3.2"><ci id="A1.SS3.p3.5.m5.1.1.cmml" xref="A1.SS3.p3.5.m5.1.1">𝑥</ci><ci id="A1.SS3.p3.5.m5.2.2.cmml" xref="A1.SS3.p3.5.m5.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p3.5.m5.2c">\hat{\mathbf{\Delta}}(x;\theta)</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p3.5.m5.2d">over^ start_ARG bold_Δ end_ARG ( italic_x ; italic_θ )</annotation></semantics></math>, the marginal reward predictor.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS3.p4">
<p class="ltx_p" id="A1.SS3.p4.1"><span class="ltx_text ltx_font_bold" id="A1.SS3.p4.1.1">Evaluation:</span>
We evaluate using the same reward model as above.
Our adaptive allocation algorithm was assigned a maximum budget of <math alttext="B_{max}=8" class="ltx_Math" display="inline" id="A1.SS3.p4.1.m1.1"><semantics id="A1.SS3.p4.1.m1.1a"><mrow id="A1.SS3.p4.1.m1.1.1" xref="A1.SS3.p4.1.m1.1.1.cmml"><msub id="A1.SS3.p4.1.m1.1.1.2" xref="A1.SS3.p4.1.m1.1.1.2.cmml"><mi id="A1.SS3.p4.1.m1.1.1.2.2" xref="A1.SS3.p4.1.m1.1.1.2.2.cmml">B</mi><mrow id="A1.SS3.p4.1.m1.1.1.2.3" xref="A1.SS3.p4.1.m1.1.1.2.3.cmml"><mi id="A1.SS3.p4.1.m1.1.1.2.3.2" xref="A1.SS3.p4.1.m1.1.1.2.3.2.cmml">m</mi><mo id="A1.SS3.p4.1.m1.1.1.2.3.1" xref="A1.SS3.p4.1.m1.1.1.2.3.1.cmml">⁢</mo><mi id="A1.SS3.p4.1.m1.1.1.2.3.3" xref="A1.SS3.p4.1.m1.1.1.2.3.3.cmml">a</mi><mo id="A1.SS3.p4.1.m1.1.1.2.3.1a" xref="A1.SS3.p4.1.m1.1.1.2.3.1.cmml">⁢</mo><mi id="A1.SS3.p4.1.m1.1.1.2.3.4" xref="A1.SS3.p4.1.m1.1.1.2.3.4.cmml">x</mi></mrow></msub><mo id="A1.SS3.p4.1.m1.1.1.1" xref="A1.SS3.p4.1.m1.1.1.1.cmml">=</mo><mn id="A1.SS3.p4.1.m1.1.1.3" xref="A1.SS3.p4.1.m1.1.1.3.cmml">8</mn></mrow><annotation-xml encoding="MathML-Content" id="A1.SS3.p4.1.m1.1b"><apply id="A1.SS3.p4.1.m1.1.1.cmml" xref="A1.SS3.p4.1.m1.1.1"><eq id="A1.SS3.p4.1.m1.1.1.1.cmml" xref="A1.SS3.p4.1.m1.1.1.1"></eq><apply id="A1.SS3.p4.1.m1.1.1.2.cmml" xref="A1.SS3.p4.1.m1.1.1.2"><csymbol cd="ambiguous" id="A1.SS3.p4.1.m1.1.1.2.1.cmml" xref="A1.SS3.p4.1.m1.1.1.2">subscript</csymbol><ci id="A1.SS3.p4.1.m1.1.1.2.2.cmml" xref="A1.SS3.p4.1.m1.1.1.2.2">𝐵</ci><apply id="A1.SS3.p4.1.m1.1.1.2.3.cmml" xref="A1.SS3.p4.1.m1.1.1.2.3"><times id="A1.SS3.p4.1.m1.1.1.2.3.1.cmml" xref="A1.SS3.p4.1.m1.1.1.2.3.1"></times><ci id="A1.SS3.p4.1.m1.1.1.2.3.2.cmml" xref="A1.SS3.p4.1.m1.1.1.2.3.2">𝑚</ci><ci id="A1.SS3.p4.1.m1.1.1.2.3.3.cmml" xref="A1.SS3.p4.1.m1.1.1.2.3.3">𝑎</ci><ci id="A1.SS3.p4.1.m1.1.1.2.3.4.cmml" xref="A1.SS3.p4.1.m1.1.1.2.3.4">𝑥</ci></apply></apply><cn id="A1.SS3.p4.1.m1.1.1.3.cmml" type="integer" xref="A1.SS3.p4.1.m1.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS3.p4.1.m1.1c">B_{max}=8</annotation><annotation encoding="application/x-llamapun" id="A1.SS3.p4.1.m1.1d">italic_B start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT = 8</annotation></semantics></math> samples per query.</p>
</div>
</section>
<section class="ltx_subsection" id="A1.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.4 </span>Routing: Model Size</h3>
<div class="ltx_para ltx_noindent" id="A1.SS4.p1">
<p class="ltx_p" id="A1.SS4.p1.1"><span class="ltx_text ltx_font_bold" id="A1.SS4.p1.1.1">Dataset:</span>
We used the same LLMSYS-Chat dataset that we used for the best-of-<math alttext="k" class="ltx_Math" display="inline" id="A1.SS4.p1.1.m1.1"><semantics id="A1.SS4.p1.1.m1.1a"><mi id="A1.SS4.p1.1.m1.1.1" xref="A1.SS4.p1.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="A1.SS4.p1.1.m1.1b"><ci id="A1.SS4.p1.1.m1.1.1.cmml" xref="A1.SS4.p1.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p1.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p1.1.m1.1d">italic_k</annotation></semantics></math> chat experiments.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS4.p2">
<p class="ltx_p" id="A1.SS4.p2.2"><span class="ltx_text ltx_font_bold" id="A1.SS4.p2.2.1">Model:</span>
Our weak model was <span class="ltx_text ltx_markedasmath ltx_font_bold" id="A1.SS4.p2.2.2">Gemma-2B-it</span>.
Our strong model was <span class="ltx_text ltx_markedasmath ltx_font_bold" id="A1.SS4.p2.2.3">Gemma-7B-it</span>.
We did not perform any fine-tuning on either of these models.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS4.p3">
<p class="ltx_p" id="A1.SS4.p3.1"><span class="ltx_text ltx_font_bold" id="A1.SS4.p3.1.1">Training:</span>
We generate <math alttext="8" class="ltx_Math" display="inline" id="A1.SS4.p3.1.m1.1"><semantics id="A1.SS4.p3.1.m1.1a"><mn id="A1.SS4.p3.1.m1.1.1" xref="A1.SS4.p3.1.m1.1.1.cmml">8</mn><annotation-xml encoding="MathML-Content" id="A1.SS4.p3.1.m1.1b"><cn id="A1.SS4.p3.1.m1.1.1.cmml" type="integer" xref="A1.SS4.p3.1.m1.1.1">8</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p3.1.m1.1c">8</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p3.1.m1.1d">8</annotation></semantics></math> responses (at a temperature of 0.7) for every query with both the models.
We labelled them using <span class="ltx_text ltx_font_bold" id="A1.SS4.p3.1.2">NCSOFT/Llama-3-OffsetBias-RM-8B</span> as the reward model.
Supervision for the reward model was then computed using a Monte Carlo estimate of:</p>
<table class="ltx_equation ltx_eqn_table" id="A1.E11">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="(p^{S}\succ p^{W}|x)=\mathbb{E}_{y_{1}\sim p^{S},y_{2}\sim p^{W}}[\sigma(r(x,y%
_{1})-r(x,y_{2}))]" class="ltx_Math" display="block" id="A1.E11.m1.6"><semantics id="A1.E11.m1.6a"><mrow id="A1.E11.m1.6.6" xref="A1.E11.m1.6.6.cmml"><mrow id="A1.E11.m1.5.5.1.1" xref="A1.E11.m1.5.5.1.1.1.cmml"><mo id="A1.E11.m1.5.5.1.1.2" stretchy="false" xref="A1.E11.m1.5.5.1.1.1.cmml">(</mo><mrow id="A1.E11.m1.5.5.1.1.1" xref="A1.E11.m1.5.5.1.1.1.cmml"><msup id="A1.E11.m1.5.5.1.1.1.2" xref="A1.E11.m1.5.5.1.1.1.2.cmml"><mi id="A1.E11.m1.5.5.1.1.1.2.2" xref="A1.E11.m1.5.5.1.1.1.2.2.cmml">p</mi><mi id="A1.E11.m1.5.5.1.1.1.2.3" xref="A1.E11.m1.5.5.1.1.1.2.3.cmml">S</mi></msup><mo id="A1.E11.m1.5.5.1.1.1.1" xref="A1.E11.m1.5.5.1.1.1.1.cmml">≻</mo><mrow id="A1.E11.m1.5.5.1.1.1.3" xref="A1.E11.m1.5.5.1.1.1.3.cmml"><msup id="A1.E11.m1.5.5.1.1.1.3.2" xref="A1.E11.m1.5.5.1.1.1.3.2.cmml"><mi id="A1.E11.m1.5.5.1.1.1.3.2.2" xref="A1.E11.m1.5.5.1.1.1.3.2.2.cmml">p</mi><mi id="A1.E11.m1.5.5.1.1.1.3.2.3" xref="A1.E11.m1.5.5.1.1.1.3.2.3.cmml">W</mi></msup><mo fence="false" id="A1.E11.m1.5.5.1.1.1.3.1" xref="A1.E11.m1.5.5.1.1.1.3.1.cmml">|</mo><mi id="A1.E11.m1.5.5.1.1.1.3.3" xref="A1.E11.m1.5.5.1.1.1.3.3.cmml">x</mi></mrow></mrow><mo id="A1.E11.m1.5.5.1.1.3" stretchy="false" xref="A1.E11.m1.5.5.1.1.1.cmml">)</mo></mrow><mo id="A1.E11.m1.6.6.3" xref="A1.E11.m1.6.6.3.cmml">=</mo><mrow id="A1.E11.m1.6.6.2" xref="A1.E11.m1.6.6.2.cmml"><msub id="A1.E11.m1.6.6.2.3" xref="A1.E11.m1.6.6.2.3.cmml"><mi id="A1.E11.m1.6.6.2.3.2" xref="A1.E11.m1.6.6.2.3.2.cmml">𝔼</mi><mrow id="A1.E11.m1.2.2.2.2" xref="A1.E11.m1.2.2.2.3.cmml"><mrow id="A1.E11.m1.1.1.1.1.1" xref="A1.E11.m1.1.1.1.1.1.cmml"><msub id="A1.E11.m1.1.1.1.1.1.2" xref="A1.E11.m1.1.1.1.1.1.2.cmml"><mi id="A1.E11.m1.1.1.1.1.1.2.2" xref="A1.E11.m1.1.1.1.1.1.2.2.cmml">y</mi><mn id="A1.E11.m1.1.1.1.1.1.2.3" xref="A1.E11.m1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="A1.E11.m1.1.1.1.1.1.1" xref="A1.E11.m1.1.1.1.1.1.1.cmml">∼</mo><msup id="A1.E11.m1.1.1.1.1.1.3" xref="A1.E11.m1.1.1.1.1.1.3.cmml"><mi id="A1.E11.m1.1.1.1.1.1.3.2" xref="A1.E11.m1.1.1.1.1.1.3.2.cmml">p</mi><mi id="A1.E11.m1.1.1.1.1.1.3.3" xref="A1.E11.m1.1.1.1.1.1.3.3.cmml">S</mi></msup></mrow><mo id="A1.E11.m1.2.2.2.2.3" xref="A1.E11.m1.2.2.2.3a.cmml">,</mo><mrow id="A1.E11.m1.2.2.2.2.2" xref="A1.E11.m1.2.2.2.2.2.cmml"><msub id="A1.E11.m1.2.2.2.2.2.2" xref="A1.E11.m1.2.2.2.2.2.2.cmml"><mi id="A1.E11.m1.2.2.2.2.2.2.2" xref="A1.E11.m1.2.2.2.2.2.2.2.cmml">y</mi><mn id="A1.E11.m1.2.2.2.2.2.2.3" xref="A1.E11.m1.2.2.2.2.2.2.3.cmml">2</mn></msub><mo id="A1.E11.m1.2.2.2.2.2.1" xref="A1.E11.m1.2.2.2.2.2.1.cmml">∼</mo><msup id="A1.E11.m1.2.2.2.2.2.3" xref="A1.E11.m1.2.2.2.2.2.3.cmml"><mi id="A1.E11.m1.2.2.2.2.2.3.2" xref="A1.E11.m1.2.2.2.2.2.3.2.cmml">p</mi><mi id="A1.E11.m1.2.2.2.2.2.3.3" xref="A1.E11.m1.2.2.2.2.2.3.3.cmml">W</mi></msup></mrow></mrow></msub><mo id="A1.E11.m1.6.6.2.2" xref="A1.E11.m1.6.6.2.2.cmml">⁢</mo><mrow id="A1.E11.m1.6.6.2.1.1" xref="A1.E11.m1.6.6.2.1.2.cmml"><mo id="A1.E11.m1.6.6.2.1.1.2" stretchy="false" xref="A1.E11.m1.6.6.2.1.2.1.cmml">[</mo><mrow id="A1.E11.m1.6.6.2.1.1.1" xref="A1.E11.m1.6.6.2.1.1.1.cmml"><mi id="A1.E11.m1.6.6.2.1.1.1.3" xref="A1.E11.m1.6.6.2.1.1.1.3.cmml">σ</mi><mo id="A1.E11.m1.6.6.2.1.1.1.2" xref="A1.E11.m1.6.6.2.1.1.1.2.cmml">⁢</mo><mrow id="A1.E11.m1.6.6.2.1.1.1.1.1" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.cmml"><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.2" stretchy="false" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.E11.m1.6.6.2.1.1.1.1.1.1" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.cmml"><mrow id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.cmml"><mi id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.3" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.3.cmml">r</mi><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.2" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml"><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml">(</mo><mi id="A1.E11.m1.3.3" xref="A1.E11.m1.3.3.cmml">x</mi><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.3" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.2" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mn id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.3" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.3" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.3.cmml">−</mo><mrow id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.cmml"><mi id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.3" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.3.cmml">r</mi><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.2" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.2.cmml">⁢</mo><mrow id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml"><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.2" stretchy="false" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml">(</mo><mi id="A1.E11.m1.4.4" xref="A1.E11.m1.4.4.cmml">x</mi><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.3" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml">,</mo><msub id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.cmml"><mi id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.2" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.2.cmml">y</mi><mn id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.3" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.3.cmml">2</mn></msub><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.4" stretchy="false" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="A1.E11.m1.6.6.2.1.1.1.1.1.3" stretchy="false" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E11.m1.6.6.2.1.1.3" stretchy="false" xref="A1.E11.m1.6.6.2.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E11.m1.6b"><apply id="A1.E11.m1.6.6.cmml" xref="A1.E11.m1.6.6"><eq id="A1.E11.m1.6.6.3.cmml" xref="A1.E11.m1.6.6.3"></eq><apply id="A1.E11.m1.5.5.1.1.1.cmml" xref="A1.E11.m1.5.5.1.1"><csymbol cd="latexml" id="A1.E11.m1.5.5.1.1.1.1.cmml" xref="A1.E11.m1.5.5.1.1.1.1">succeeds</csymbol><apply id="A1.E11.m1.5.5.1.1.1.2.cmml" xref="A1.E11.m1.5.5.1.1.1.2"><csymbol cd="ambiguous" id="A1.E11.m1.5.5.1.1.1.2.1.cmml" xref="A1.E11.m1.5.5.1.1.1.2">superscript</csymbol><ci id="A1.E11.m1.5.5.1.1.1.2.2.cmml" xref="A1.E11.m1.5.5.1.1.1.2.2">𝑝</ci><ci id="A1.E11.m1.5.5.1.1.1.2.3.cmml" xref="A1.E11.m1.5.5.1.1.1.2.3">𝑆</ci></apply><apply id="A1.E11.m1.5.5.1.1.1.3.cmml" xref="A1.E11.m1.5.5.1.1.1.3"><csymbol cd="latexml" id="A1.E11.m1.5.5.1.1.1.3.1.cmml" xref="A1.E11.m1.5.5.1.1.1.3.1">conditional</csymbol><apply id="A1.E11.m1.5.5.1.1.1.3.2.cmml" xref="A1.E11.m1.5.5.1.1.1.3.2"><csymbol cd="ambiguous" id="A1.E11.m1.5.5.1.1.1.3.2.1.cmml" xref="A1.E11.m1.5.5.1.1.1.3.2">superscript</csymbol><ci id="A1.E11.m1.5.5.1.1.1.3.2.2.cmml" xref="A1.E11.m1.5.5.1.1.1.3.2.2">𝑝</ci><ci id="A1.E11.m1.5.5.1.1.1.3.2.3.cmml" xref="A1.E11.m1.5.5.1.1.1.3.2.3">𝑊</ci></apply><ci id="A1.E11.m1.5.5.1.1.1.3.3.cmml" xref="A1.E11.m1.5.5.1.1.1.3.3">𝑥</ci></apply></apply><apply id="A1.E11.m1.6.6.2.cmml" xref="A1.E11.m1.6.6.2"><times id="A1.E11.m1.6.6.2.2.cmml" xref="A1.E11.m1.6.6.2.2"></times><apply id="A1.E11.m1.6.6.2.3.cmml" xref="A1.E11.m1.6.6.2.3"><csymbol cd="ambiguous" id="A1.E11.m1.6.6.2.3.1.cmml" xref="A1.E11.m1.6.6.2.3">subscript</csymbol><ci id="A1.E11.m1.6.6.2.3.2.cmml" xref="A1.E11.m1.6.6.2.3.2">𝔼</ci><apply id="A1.E11.m1.2.2.2.3.cmml" xref="A1.E11.m1.2.2.2.2"><csymbol cd="ambiguous" id="A1.E11.m1.2.2.2.3a.cmml" xref="A1.E11.m1.2.2.2.2.3">formulae-sequence</csymbol><apply id="A1.E11.m1.1.1.1.1.1.cmml" xref="A1.E11.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.E11.m1.1.1.1.1.1.1.cmml" xref="A1.E11.m1.1.1.1.1.1.1">similar-to</csymbol><apply id="A1.E11.m1.1.1.1.1.1.2.cmml" xref="A1.E11.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.E11.m1.1.1.1.1.1.2.1.cmml" xref="A1.E11.m1.1.1.1.1.1.2">subscript</csymbol><ci id="A1.E11.m1.1.1.1.1.1.2.2.cmml" xref="A1.E11.m1.1.1.1.1.1.2.2">𝑦</ci><cn id="A1.E11.m1.1.1.1.1.1.2.3.cmml" type="integer" xref="A1.E11.m1.1.1.1.1.1.2.3">1</cn></apply><apply id="A1.E11.m1.1.1.1.1.1.3.cmml" xref="A1.E11.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="A1.E11.m1.1.1.1.1.1.3.1.cmml" xref="A1.E11.m1.1.1.1.1.1.3">superscript</csymbol><ci id="A1.E11.m1.1.1.1.1.1.3.2.cmml" xref="A1.E11.m1.1.1.1.1.1.3.2">𝑝</ci><ci id="A1.E11.m1.1.1.1.1.1.3.3.cmml" xref="A1.E11.m1.1.1.1.1.1.3.3">𝑆</ci></apply></apply><apply id="A1.E11.m1.2.2.2.2.2.cmml" xref="A1.E11.m1.2.2.2.2.2"><csymbol cd="latexml" id="A1.E11.m1.2.2.2.2.2.1.cmml" xref="A1.E11.m1.2.2.2.2.2.1">similar-to</csymbol><apply id="A1.E11.m1.2.2.2.2.2.2.cmml" xref="A1.E11.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="A1.E11.m1.2.2.2.2.2.2.1.cmml" xref="A1.E11.m1.2.2.2.2.2.2">subscript</csymbol><ci id="A1.E11.m1.2.2.2.2.2.2.2.cmml" xref="A1.E11.m1.2.2.2.2.2.2.2">𝑦</ci><cn id="A1.E11.m1.2.2.2.2.2.2.3.cmml" type="integer" xref="A1.E11.m1.2.2.2.2.2.2.3">2</cn></apply><apply id="A1.E11.m1.2.2.2.2.2.3.cmml" xref="A1.E11.m1.2.2.2.2.2.3"><csymbol cd="ambiguous" id="A1.E11.m1.2.2.2.2.2.3.1.cmml" xref="A1.E11.m1.2.2.2.2.2.3">superscript</csymbol><ci id="A1.E11.m1.2.2.2.2.2.3.2.cmml" xref="A1.E11.m1.2.2.2.2.2.3.2">𝑝</ci><ci id="A1.E11.m1.2.2.2.2.2.3.3.cmml" xref="A1.E11.m1.2.2.2.2.2.3.3">𝑊</ci></apply></apply></apply></apply><apply id="A1.E11.m1.6.6.2.1.2.cmml" xref="A1.E11.m1.6.6.2.1.1"><csymbol cd="latexml" id="A1.E11.m1.6.6.2.1.2.1.cmml" xref="A1.E11.m1.6.6.2.1.1.2">delimited-[]</csymbol><apply id="A1.E11.m1.6.6.2.1.1.1.cmml" xref="A1.E11.m1.6.6.2.1.1.1"><times id="A1.E11.m1.6.6.2.1.1.1.2.cmml" xref="A1.E11.m1.6.6.2.1.1.1.2"></times><ci id="A1.E11.m1.6.6.2.1.1.1.3.cmml" xref="A1.E11.m1.6.6.2.1.1.1.3">𝜎</ci><apply id="A1.E11.m1.6.6.2.1.1.1.1.1.1.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1"><minus id="A1.E11.m1.6.6.2.1.1.1.1.1.1.3.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.3"></minus><apply id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1"><times id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.2.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.2"></times><ci id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.3.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.3">𝑟</ci><interval closure="open" id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1"><ci id="A1.E11.m1.3.3.cmml" xref="A1.E11.m1.3.3">𝑥</ci><apply id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.2">𝑦</ci><cn id="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.3.cmml" type="integer" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.3">1</cn></apply></interval></apply><apply id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2"><times id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.2.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.2"></times><ci id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.3.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.3">𝑟</ci><interval closure="open" id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1"><ci id="A1.E11.m1.4.4.cmml" xref="A1.E11.m1.4.4">𝑥</ci><apply id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1"><csymbol cd="ambiguous" id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.1.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1">subscript</csymbol><ci id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.2.cmml" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.2">𝑦</ci><cn id="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.3.cmml" type="integer" xref="A1.E11.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.3">2</cn></apply></interval></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E11.m1.6c">(p^{S}\succ p^{W}|x)=\mathbb{E}_{y_{1}\sim p^{S},y_{2}\sim p^{W}}[\sigma(r(x,y%
_{1})-r(x,y_{2}))]</annotation><annotation encoding="application/x-llamapun" id="A1.E11.m1.6d">( italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT ≻ italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT | italic_x ) = blackboard_E start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∼ italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∼ italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT end_POSTSUBSCRIPT [ italic_σ ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) - italic_r ( italic_x , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(11)</span></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS4.p4">
<p class="ltx_p" id="A1.SS4.p4.2"><span class="ltx_text ltx_font_bold" id="A1.SS4.p4.2.1">Evaluation:</span>
The adaptive allocation procedure uses the predictions of the marginal reward predictor to route the top <math alttext="B^{th}" class="ltx_Math" display="inline" id="A1.SS4.p4.1.m1.1"><semantics id="A1.SS4.p4.1.m1.1a"><msup id="A1.SS4.p4.1.m1.1.1" xref="A1.SS4.p4.1.m1.1.1.cmml"><mi id="A1.SS4.p4.1.m1.1.1.2" xref="A1.SS4.p4.1.m1.1.1.2.cmml">B</mi><mrow id="A1.SS4.p4.1.m1.1.1.3" xref="A1.SS4.p4.1.m1.1.1.3.cmml"><mi id="A1.SS4.p4.1.m1.1.1.3.2" xref="A1.SS4.p4.1.m1.1.1.3.2.cmml">t</mi><mo id="A1.SS4.p4.1.m1.1.1.3.1" xref="A1.SS4.p4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="A1.SS4.p4.1.m1.1.1.3.3" xref="A1.SS4.p4.1.m1.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="A1.SS4.p4.1.m1.1b"><apply id="A1.SS4.p4.1.m1.1.1.cmml" xref="A1.SS4.p4.1.m1.1.1"><csymbol cd="ambiguous" id="A1.SS4.p4.1.m1.1.1.1.cmml" xref="A1.SS4.p4.1.m1.1.1">superscript</csymbol><ci id="A1.SS4.p4.1.m1.1.1.2.cmml" xref="A1.SS4.p4.1.m1.1.1.2">𝐵</ci><apply id="A1.SS4.p4.1.m1.1.1.3.cmml" xref="A1.SS4.p4.1.m1.1.1.3"><times id="A1.SS4.p4.1.m1.1.1.3.1.cmml" xref="A1.SS4.p4.1.m1.1.1.3.1"></times><ci id="A1.SS4.p4.1.m1.1.1.3.2.cmml" xref="A1.SS4.p4.1.m1.1.1.3.2">𝑡</ci><ci id="A1.SS4.p4.1.m1.1.1.3.3.cmml" xref="A1.SS4.p4.1.m1.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p4.1.m1.1c">B^{th}</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p4.1.m1.1d">italic_B start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> percentile of queries to <math alttext="p^{S}" class="ltx_Math" display="inline" id="A1.SS4.p4.2.m2.1"><semantics id="A1.SS4.p4.2.m2.1a"><msup id="A1.SS4.p4.2.m2.1.1" xref="A1.SS4.p4.2.m2.1.1.cmml"><mi id="A1.SS4.p4.2.m2.1.1.2" xref="A1.SS4.p4.2.m2.1.1.2.cmml">p</mi><mi id="A1.SS4.p4.2.m2.1.1.3" xref="A1.SS4.p4.2.m2.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="A1.SS4.p4.2.m2.1b"><apply id="A1.SS4.p4.2.m2.1.1.cmml" xref="A1.SS4.p4.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS4.p4.2.m2.1.1.1.cmml" xref="A1.SS4.p4.2.m2.1.1">superscript</csymbol><ci id="A1.SS4.p4.2.m2.1.1.2.cmml" xref="A1.SS4.p4.2.m2.1.1.2">𝑝</ci><ci id="A1.SS4.p4.2.m2.1.1.3.cmml" xref="A1.SS4.p4.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS4.p4.2.m2.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="A1.SS4.p4.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math>.
We evaluated using the same reward model mentioned above.</p>
</div>
</section>
<section class="ltx_subsection" id="A1.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">A.5 </span>Routing: VAS</h3>
<div class="ltx_para ltx_noindent" id="A1.SS5.p1">
<p class="ltx_p" id="A1.SS5.p1.1"><span class="ltx_text ltx_font_bold" id="A1.SS5.p1.1.1">Dataset:</span>
We use the harmless subset of the popular Anthropic-HH dataset.
We sampled 8K samples randomly from the train set, and 400 samples from the test set.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS5.p2">
<p class="ltx_p" id="A1.SS5.p2.1"><span class="ltx_text ltx_font_bold" id="A1.SS5.p2.1.1">Model:</span>
Our weak decoding procedure was a fine-tuned <span class="ltx_text ltx_font_bold" id="A1.SS5.p2.1.2">Llama-7B</span> model.
Our strong decoding procedure used an additional value function that was also based on the <span class="ltx_text ltx_font_bold" id="A1.SS5.p2.1.3">Llama-7B</span> model.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS5.p3">
<p class="ltx_p" id="A1.SS5.p3.1"><span class="ltx_text ltx_font_bold" id="A1.SS5.p3.1.1">Training:</span>
We generated <math alttext="4" class="ltx_Math" display="inline" id="A1.SS5.p3.1.m1.1"><semantics id="A1.SS5.p3.1.m1.1a"><mn id="A1.SS5.p3.1.m1.1.1" xref="A1.SS5.p3.1.m1.1.1.cmml">4</mn><annotation-xml encoding="MathML-Content" id="A1.SS5.p3.1.m1.1b"><cn id="A1.SS5.p3.1.m1.1.1.cmml" type="integer" xref="A1.SS5.p3.1.m1.1.1">4</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.p3.1.m1.1c">4</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.p3.1.m1.1d">4</annotation></semantics></math> responses per query.
The preference probability was then computed using a Monte Carlo estimate of:</p>
<table class="ltx_equation ltx_eqn_table" id="A1.E12">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="p(p^{S}\succ p^{W}|x)=\mathbb{E}_{y_{1}\sim p^{S},y_{2}\sim p^{W}}[\sigma(r(x,%
y_{1})-r(x,y_{2}))]" class="ltx_Math" display="block" id="A1.E12.m1.6"><semantics id="A1.E12.m1.6a"><mrow id="A1.E12.m1.6.6" xref="A1.E12.m1.6.6.cmml"><mrow id="A1.E12.m1.5.5.1" xref="A1.E12.m1.5.5.1.cmml"><mi id="A1.E12.m1.5.5.1.3" xref="A1.E12.m1.5.5.1.3.cmml">p</mi><mo id="A1.E12.m1.5.5.1.2" xref="A1.E12.m1.5.5.1.2.cmml">⁢</mo><mrow id="A1.E12.m1.5.5.1.1.1" xref="A1.E12.m1.5.5.1.1.1.1.cmml"><mo id="A1.E12.m1.5.5.1.1.1.2" stretchy="false" xref="A1.E12.m1.5.5.1.1.1.1.cmml">(</mo><mrow id="A1.E12.m1.5.5.1.1.1.1" xref="A1.E12.m1.5.5.1.1.1.1.cmml"><msup id="A1.E12.m1.5.5.1.1.1.1.2" xref="A1.E12.m1.5.5.1.1.1.1.2.cmml"><mi id="A1.E12.m1.5.5.1.1.1.1.2.2" xref="A1.E12.m1.5.5.1.1.1.1.2.2.cmml">p</mi><mi id="A1.E12.m1.5.5.1.1.1.1.2.3" xref="A1.E12.m1.5.5.1.1.1.1.2.3.cmml">S</mi></msup><mo id="A1.E12.m1.5.5.1.1.1.1.1" xref="A1.E12.m1.5.5.1.1.1.1.1.cmml">≻</mo><mrow id="A1.E12.m1.5.5.1.1.1.1.3" xref="A1.E12.m1.5.5.1.1.1.1.3.cmml"><msup id="A1.E12.m1.5.5.1.1.1.1.3.2" xref="A1.E12.m1.5.5.1.1.1.1.3.2.cmml"><mi id="A1.E12.m1.5.5.1.1.1.1.3.2.2" xref="A1.E12.m1.5.5.1.1.1.1.3.2.2.cmml">p</mi><mi id="A1.E12.m1.5.5.1.1.1.1.3.2.3" xref="A1.E12.m1.5.5.1.1.1.1.3.2.3.cmml">W</mi></msup><mo fence="false" id="A1.E12.m1.5.5.1.1.1.1.3.1" xref="A1.E12.m1.5.5.1.1.1.1.3.1.cmml">|</mo><mi id="A1.E12.m1.5.5.1.1.1.1.3.3" xref="A1.E12.m1.5.5.1.1.1.1.3.3.cmml">x</mi></mrow></mrow><mo id="A1.E12.m1.5.5.1.1.1.3" stretchy="false" xref="A1.E12.m1.5.5.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E12.m1.6.6.3" xref="A1.E12.m1.6.6.3.cmml">=</mo><mrow id="A1.E12.m1.6.6.2" xref="A1.E12.m1.6.6.2.cmml"><msub id="A1.E12.m1.6.6.2.3" xref="A1.E12.m1.6.6.2.3.cmml"><mi id="A1.E12.m1.6.6.2.3.2" xref="A1.E12.m1.6.6.2.3.2.cmml">𝔼</mi><mrow id="A1.E12.m1.2.2.2.2" xref="A1.E12.m1.2.2.2.3.cmml"><mrow id="A1.E12.m1.1.1.1.1.1" xref="A1.E12.m1.1.1.1.1.1.cmml"><msub id="A1.E12.m1.1.1.1.1.1.2" xref="A1.E12.m1.1.1.1.1.1.2.cmml"><mi id="A1.E12.m1.1.1.1.1.1.2.2" xref="A1.E12.m1.1.1.1.1.1.2.2.cmml">y</mi><mn id="A1.E12.m1.1.1.1.1.1.2.3" xref="A1.E12.m1.1.1.1.1.1.2.3.cmml">1</mn></msub><mo id="A1.E12.m1.1.1.1.1.1.1" xref="A1.E12.m1.1.1.1.1.1.1.cmml">∼</mo><msup id="A1.E12.m1.1.1.1.1.1.3" xref="A1.E12.m1.1.1.1.1.1.3.cmml"><mi id="A1.E12.m1.1.1.1.1.1.3.2" xref="A1.E12.m1.1.1.1.1.1.3.2.cmml">p</mi><mi id="A1.E12.m1.1.1.1.1.1.3.3" xref="A1.E12.m1.1.1.1.1.1.3.3.cmml">S</mi></msup></mrow><mo id="A1.E12.m1.2.2.2.2.3" xref="A1.E12.m1.2.2.2.3a.cmml">,</mo><mrow id="A1.E12.m1.2.2.2.2.2" xref="A1.E12.m1.2.2.2.2.2.cmml"><msub id="A1.E12.m1.2.2.2.2.2.2" xref="A1.E12.m1.2.2.2.2.2.2.cmml"><mi id="A1.E12.m1.2.2.2.2.2.2.2" xref="A1.E12.m1.2.2.2.2.2.2.2.cmml">y</mi><mn id="A1.E12.m1.2.2.2.2.2.2.3" xref="A1.E12.m1.2.2.2.2.2.2.3.cmml">2</mn></msub><mo id="A1.E12.m1.2.2.2.2.2.1" xref="A1.E12.m1.2.2.2.2.2.1.cmml">∼</mo><msup id="A1.E12.m1.2.2.2.2.2.3" xref="A1.E12.m1.2.2.2.2.2.3.cmml"><mi id="A1.E12.m1.2.2.2.2.2.3.2" xref="A1.E12.m1.2.2.2.2.2.3.2.cmml">p</mi><mi id="A1.E12.m1.2.2.2.2.2.3.3" xref="A1.E12.m1.2.2.2.2.2.3.3.cmml">W</mi></msup></mrow></mrow></msub><mo id="A1.E12.m1.6.6.2.2" xref="A1.E12.m1.6.6.2.2.cmml">⁢</mo><mrow id="A1.E12.m1.6.6.2.1.1" xref="A1.E12.m1.6.6.2.1.2.cmml"><mo id="A1.E12.m1.6.6.2.1.1.2" stretchy="false" xref="A1.E12.m1.6.6.2.1.2.1.cmml">[</mo><mrow id="A1.E12.m1.6.6.2.1.1.1" xref="A1.E12.m1.6.6.2.1.1.1.cmml"><mi id="A1.E12.m1.6.6.2.1.1.1.3" xref="A1.E12.m1.6.6.2.1.1.1.3.cmml">σ</mi><mo id="A1.E12.m1.6.6.2.1.1.1.2" xref="A1.E12.m1.6.6.2.1.1.1.2.cmml">⁢</mo><mrow id="A1.E12.m1.6.6.2.1.1.1.1.1" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.cmml"><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.2" stretchy="false" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.cmml">(</mo><mrow id="A1.E12.m1.6.6.2.1.1.1.1.1.1" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.cmml"><mrow id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.cmml"><mi id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.3" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.3.cmml">r</mi><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.2" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml"><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.2" stretchy="false" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml">(</mo><mi id="A1.E12.m1.3.3" xref="A1.E12.m1.3.3.cmml">x</mi><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.3" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml">,</mo><msub id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.2" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.2.cmml">y</mi><mn id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.3" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.3.cmml">1</mn></msub><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.4" stretchy="false" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.3" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.3.cmml">−</mo><mrow id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.cmml"><mi id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.3" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.3.cmml">r</mi><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.2" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.2.cmml">⁢</mo><mrow id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml"><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.2" stretchy="false" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml">(</mo><mi id="A1.E12.m1.4.4" xref="A1.E12.m1.4.4.cmml">x</mi><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.3" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml">,</mo><msub id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.cmml"><mi id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.2" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.2.cmml">y</mi><mn id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.3" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.3.cmml">2</mn></msub><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.4" stretchy="false" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="A1.E12.m1.6.6.2.1.1.1.1.1.3" stretchy="false" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="A1.E12.m1.6.6.2.1.1.3" stretchy="false" xref="A1.E12.m1.6.6.2.1.2.1.cmml">]</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="A1.E12.m1.6b"><apply id="A1.E12.m1.6.6.cmml" xref="A1.E12.m1.6.6"><eq id="A1.E12.m1.6.6.3.cmml" xref="A1.E12.m1.6.6.3"></eq><apply id="A1.E12.m1.5.5.1.cmml" xref="A1.E12.m1.5.5.1"><times id="A1.E12.m1.5.5.1.2.cmml" xref="A1.E12.m1.5.5.1.2"></times><ci id="A1.E12.m1.5.5.1.3.cmml" xref="A1.E12.m1.5.5.1.3">𝑝</ci><apply id="A1.E12.m1.5.5.1.1.1.1.cmml" xref="A1.E12.m1.5.5.1.1.1"><csymbol cd="latexml" id="A1.E12.m1.5.5.1.1.1.1.1.cmml" xref="A1.E12.m1.5.5.1.1.1.1.1">succeeds</csymbol><apply id="A1.E12.m1.5.5.1.1.1.1.2.cmml" xref="A1.E12.m1.5.5.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.E12.m1.5.5.1.1.1.1.2.1.cmml" xref="A1.E12.m1.5.5.1.1.1.1.2">superscript</csymbol><ci id="A1.E12.m1.5.5.1.1.1.1.2.2.cmml" xref="A1.E12.m1.5.5.1.1.1.1.2.2">𝑝</ci><ci id="A1.E12.m1.5.5.1.1.1.1.2.3.cmml" xref="A1.E12.m1.5.5.1.1.1.1.2.3">𝑆</ci></apply><apply id="A1.E12.m1.5.5.1.1.1.1.3.cmml" xref="A1.E12.m1.5.5.1.1.1.1.3"><csymbol cd="latexml" id="A1.E12.m1.5.5.1.1.1.1.3.1.cmml" xref="A1.E12.m1.5.5.1.1.1.1.3.1">conditional</csymbol><apply id="A1.E12.m1.5.5.1.1.1.1.3.2.cmml" xref="A1.E12.m1.5.5.1.1.1.1.3.2"><csymbol cd="ambiguous" id="A1.E12.m1.5.5.1.1.1.1.3.2.1.cmml" xref="A1.E12.m1.5.5.1.1.1.1.3.2">superscript</csymbol><ci id="A1.E12.m1.5.5.1.1.1.1.3.2.2.cmml" xref="A1.E12.m1.5.5.1.1.1.1.3.2.2">𝑝</ci><ci id="A1.E12.m1.5.5.1.1.1.1.3.2.3.cmml" xref="A1.E12.m1.5.5.1.1.1.1.3.2.3">𝑊</ci></apply><ci id="A1.E12.m1.5.5.1.1.1.1.3.3.cmml" xref="A1.E12.m1.5.5.1.1.1.1.3.3">𝑥</ci></apply></apply></apply><apply id="A1.E12.m1.6.6.2.cmml" xref="A1.E12.m1.6.6.2"><times id="A1.E12.m1.6.6.2.2.cmml" xref="A1.E12.m1.6.6.2.2"></times><apply id="A1.E12.m1.6.6.2.3.cmml" xref="A1.E12.m1.6.6.2.3"><csymbol cd="ambiguous" id="A1.E12.m1.6.6.2.3.1.cmml" xref="A1.E12.m1.6.6.2.3">subscript</csymbol><ci id="A1.E12.m1.6.6.2.3.2.cmml" xref="A1.E12.m1.6.6.2.3.2">𝔼</ci><apply id="A1.E12.m1.2.2.2.3.cmml" xref="A1.E12.m1.2.2.2.2"><csymbol cd="ambiguous" id="A1.E12.m1.2.2.2.3a.cmml" xref="A1.E12.m1.2.2.2.2.3">formulae-sequence</csymbol><apply id="A1.E12.m1.1.1.1.1.1.cmml" xref="A1.E12.m1.1.1.1.1.1"><csymbol cd="latexml" id="A1.E12.m1.1.1.1.1.1.1.cmml" xref="A1.E12.m1.1.1.1.1.1.1">similar-to</csymbol><apply id="A1.E12.m1.1.1.1.1.1.2.cmml" xref="A1.E12.m1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="A1.E12.m1.1.1.1.1.1.2.1.cmml" xref="A1.E12.m1.1.1.1.1.1.2">subscript</csymbol><ci id="A1.E12.m1.1.1.1.1.1.2.2.cmml" xref="A1.E12.m1.1.1.1.1.1.2.2">𝑦</ci><cn id="A1.E12.m1.1.1.1.1.1.2.3.cmml" type="integer" xref="A1.E12.m1.1.1.1.1.1.2.3">1</cn></apply><apply id="A1.E12.m1.1.1.1.1.1.3.cmml" xref="A1.E12.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="A1.E12.m1.1.1.1.1.1.3.1.cmml" xref="A1.E12.m1.1.1.1.1.1.3">superscript</csymbol><ci id="A1.E12.m1.1.1.1.1.1.3.2.cmml" xref="A1.E12.m1.1.1.1.1.1.3.2">𝑝</ci><ci id="A1.E12.m1.1.1.1.1.1.3.3.cmml" xref="A1.E12.m1.1.1.1.1.1.3.3">𝑆</ci></apply></apply><apply id="A1.E12.m1.2.2.2.2.2.cmml" xref="A1.E12.m1.2.2.2.2.2"><csymbol cd="latexml" id="A1.E12.m1.2.2.2.2.2.1.cmml" xref="A1.E12.m1.2.2.2.2.2.1">similar-to</csymbol><apply id="A1.E12.m1.2.2.2.2.2.2.cmml" xref="A1.E12.m1.2.2.2.2.2.2"><csymbol cd="ambiguous" id="A1.E12.m1.2.2.2.2.2.2.1.cmml" xref="A1.E12.m1.2.2.2.2.2.2">subscript</csymbol><ci id="A1.E12.m1.2.2.2.2.2.2.2.cmml" xref="A1.E12.m1.2.2.2.2.2.2.2">𝑦</ci><cn id="A1.E12.m1.2.2.2.2.2.2.3.cmml" type="integer" xref="A1.E12.m1.2.2.2.2.2.2.3">2</cn></apply><apply id="A1.E12.m1.2.2.2.2.2.3.cmml" xref="A1.E12.m1.2.2.2.2.2.3"><csymbol cd="ambiguous" id="A1.E12.m1.2.2.2.2.2.3.1.cmml" xref="A1.E12.m1.2.2.2.2.2.3">superscript</csymbol><ci id="A1.E12.m1.2.2.2.2.2.3.2.cmml" xref="A1.E12.m1.2.2.2.2.2.3.2">𝑝</ci><ci id="A1.E12.m1.2.2.2.2.2.3.3.cmml" xref="A1.E12.m1.2.2.2.2.2.3.3">𝑊</ci></apply></apply></apply></apply><apply id="A1.E12.m1.6.6.2.1.2.cmml" xref="A1.E12.m1.6.6.2.1.1"><csymbol cd="latexml" id="A1.E12.m1.6.6.2.1.2.1.cmml" xref="A1.E12.m1.6.6.2.1.1.2">delimited-[]</csymbol><apply id="A1.E12.m1.6.6.2.1.1.1.cmml" xref="A1.E12.m1.6.6.2.1.1.1"><times id="A1.E12.m1.6.6.2.1.1.1.2.cmml" xref="A1.E12.m1.6.6.2.1.1.1.2"></times><ci id="A1.E12.m1.6.6.2.1.1.1.3.cmml" xref="A1.E12.m1.6.6.2.1.1.1.3">𝜎</ci><apply id="A1.E12.m1.6.6.2.1.1.1.1.1.1.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1"><minus id="A1.E12.m1.6.6.2.1.1.1.1.1.1.3.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.3"></minus><apply id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1"><times id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.2.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.2"></times><ci id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.3.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.3">𝑟</ci><interval closure="open" id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.2.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1"><ci id="A1.E12.m1.3.3.cmml" xref="A1.E12.m1.3.3">𝑥</ci><apply id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.2">𝑦</ci><cn id="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.3.cmml" type="integer" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.1.1.1.1.3">1</cn></apply></interval></apply><apply id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2"><times id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.2.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.2"></times><ci id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.3.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.3">𝑟</ci><interval closure="open" id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.2.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1"><ci id="A1.E12.m1.4.4.cmml" xref="A1.E12.m1.4.4">𝑥</ci><apply id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1"><csymbol cd="ambiguous" id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.1.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1">subscript</csymbol><ci id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.2.cmml" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.2">𝑦</ci><cn id="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.3.cmml" type="integer" xref="A1.E12.m1.6.6.2.1.1.1.1.1.1.2.1.1.1.3">2</cn></apply></interval></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.E12.m1.6c">p(p^{S}\succ p^{W}|x)=\mathbb{E}_{y_{1}\sim p^{S},y_{2}\sim p^{W}}[\sigma(r(x,%
y_{1})-r(x,y_{2}))]</annotation><annotation encoding="application/x-llamapun" id="A1.E12.m1.6d">italic_p ( italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT ≻ italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT | italic_x ) = blackboard_E start_POSTSUBSCRIPT italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ∼ italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ∼ italic_p start_POSTSUPERSCRIPT italic_W end_POSTSUPERSCRIPT end_POSTSUBSCRIPT [ italic_σ ( italic_r ( italic_x , italic_y start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ) - italic_r ( italic_x , italic_y start_POSTSUBSCRIPT 2 end_POSTSUBSCRIPT ) ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(12)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="A1.SS5.p3.2">We labelled the responses using <span class="ltx_text ltx_font_bold" id="A1.SS5.p3.2.1">OpenAssistant/reward-model-deberta-v3-large-v2</span> as the reward model.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.SS5.p4">
<p class="ltx_p" id="A1.SS5.p4.2"><span class="ltx_text ltx_font_bold" id="A1.SS5.p4.2.1">Evaluation:</span>
Our adaptive allocation used the predictions of the marginal reward predictor to route the top <math alttext="B^{th}" class="ltx_Math" display="inline" id="A1.SS5.p4.1.m1.1"><semantics id="A1.SS5.p4.1.m1.1a"><msup id="A1.SS5.p4.1.m1.1.1" xref="A1.SS5.p4.1.m1.1.1.cmml"><mi id="A1.SS5.p4.1.m1.1.1.2" xref="A1.SS5.p4.1.m1.1.1.2.cmml">B</mi><mrow id="A1.SS5.p4.1.m1.1.1.3" xref="A1.SS5.p4.1.m1.1.1.3.cmml"><mi id="A1.SS5.p4.1.m1.1.1.3.2" xref="A1.SS5.p4.1.m1.1.1.3.2.cmml">t</mi><mo id="A1.SS5.p4.1.m1.1.1.3.1" xref="A1.SS5.p4.1.m1.1.1.3.1.cmml">⁢</mo><mi id="A1.SS5.p4.1.m1.1.1.3.3" xref="A1.SS5.p4.1.m1.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="A1.SS5.p4.1.m1.1b"><apply id="A1.SS5.p4.1.m1.1.1.cmml" xref="A1.SS5.p4.1.m1.1.1"><csymbol cd="ambiguous" id="A1.SS5.p4.1.m1.1.1.1.cmml" xref="A1.SS5.p4.1.m1.1.1">superscript</csymbol><ci id="A1.SS5.p4.1.m1.1.1.2.cmml" xref="A1.SS5.p4.1.m1.1.1.2">𝐵</ci><apply id="A1.SS5.p4.1.m1.1.1.3.cmml" xref="A1.SS5.p4.1.m1.1.1.3"><times id="A1.SS5.p4.1.m1.1.1.3.1.cmml" xref="A1.SS5.p4.1.m1.1.1.3.1"></times><ci id="A1.SS5.p4.1.m1.1.1.3.2.cmml" xref="A1.SS5.p4.1.m1.1.1.3.2">𝑡</ci><ci id="A1.SS5.p4.1.m1.1.1.3.3.cmml" xref="A1.SS5.p4.1.m1.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.p4.1.m1.1c">B^{th}</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.p4.1.m1.1d">italic_B start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> percentile of queries to <math alttext="p^{S}" class="ltx_Math" display="inline" id="A1.SS5.p4.2.m2.1"><semantics id="A1.SS5.p4.2.m2.1a"><msup id="A1.SS5.p4.2.m2.1.1" xref="A1.SS5.p4.2.m2.1.1.cmml"><mi id="A1.SS5.p4.2.m2.1.1.2" xref="A1.SS5.p4.2.m2.1.1.2.cmml">p</mi><mi id="A1.SS5.p4.2.m2.1.1.3" xref="A1.SS5.p4.2.m2.1.1.3.cmml">S</mi></msup><annotation-xml encoding="MathML-Content" id="A1.SS5.p4.2.m2.1b"><apply id="A1.SS5.p4.2.m2.1.1.cmml" xref="A1.SS5.p4.2.m2.1.1"><csymbol cd="ambiguous" id="A1.SS5.p4.2.m2.1.1.1.cmml" xref="A1.SS5.p4.2.m2.1.1">superscript</csymbol><ci id="A1.SS5.p4.2.m2.1.1.2.cmml" xref="A1.SS5.p4.2.m2.1.1.2">𝑝</ci><ci id="A1.SS5.p4.2.m2.1.1.3.cmml" xref="A1.SS5.p4.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.SS5.p4.2.m2.1c">p^{S}</annotation><annotation encoding="application/x-llamapun" id="A1.SS5.p4.2.m2.1d">italic_p start_POSTSUPERSCRIPT italic_S end_POSTSUPERSCRIPT</annotation></semantics></math>.
We evaluated using the same reward model mentioned above.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Fri Oct  4 13:47:08 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
