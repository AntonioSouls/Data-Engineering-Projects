<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Melodi: Exploring Memory Compression for Long Contexts</title>
<!--Generated on Fri Oct  4 05:24:09 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2410.03156v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S1" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Our Method: Melodi</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2.SS1" title="In 2 Our Method: Melodi ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.1 </span>Architecture Overview</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2.SS2" title="In 2 Our Method: Melodi ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.2 </span>Short-Term Memory: Multi-Layer Recurrent Compression</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2.SS3" title="In 2 Our Method: Melodi ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2.3 </span>Long-Term Memory: Single-Layer Memorizing Compressed Key-Value Pairs</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Experimental Results</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.SS1" title="In 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Datasets</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.SS2" title="In 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Setup</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.SS3" title="In 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Comparison with Baselines</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.SS4" title="In 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>Ablations</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S4" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S5" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Conclusion</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A1" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Limitations</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A2" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>Training Details</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A3" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C </span>More Comparison with Baselines</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A4" title="In Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D </span>More Ablations</span></a></li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Melodi: Exploring Memory Compression for Long Contexts</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">  Yinpeng Chen,   DeLesley Hutchins,   Aren Jansen,   Andrey Zhmoginov, <span class="ltx_ERROR undefined" id="id1.1.id1">\AND</span>           David Racz,   Jesper Andersen 
<br class="ltx_break"/>
<br class="ltx_break"/>
              Google DeepMind 
<br class="ltx_break"/>
<span class="ltx_text ltx_font_typewriter" id="id2.2.id2">{yinpengc,delesley,arenjansen,azhmogin,dracz,jespera}@google.com</span>
<br class="ltx_break"/>
</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id3.id1">We present <span class="ltx_text ltx_font_smallcaps" id="id3.id1.1">Melodi</span>, a novel memory architecture designed to efficiently process long documents using short context windows. The key principle behind <span class="ltx_text ltx_font_smallcaps" id="id3.id1.2">Melodi</span> is to represent short-term and long-term memory as a hierarchical compression scheme across both network layers and context windows. Specifically, the short-term memory is achieved through recurrent compression of context windows across multiple layers, ensuring smooth transitions between windows. In contrast, the long-term memory performs further compression within a single middle layer and aggregates information across context windows, effectively consolidating crucial information from the entire history. Compared to a strong baseline - the Memorizing Transformer employing dense attention over a large long-term memory (64K key-value pairs) - our method demonstrates superior performance on various long-context datasets while remarkably reducing the memory footprint by a factor of 8.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<figure class="ltx_figure" id="S1.F1">
<p class="ltx_p ltx_align_center ltx_align_center" id="S1.F1.1.1"><span class="ltx_text" id="S1.F1.1.1.1"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="229" id="S1.F1.1.1.1.g1" src="extracted/5900799/figure/intro.png" width="479"/></span></p>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span><span class="ltx_text ltx_font_bold" id="S1.F1.16.1">Overview of <span class="ltx_text ltx_font_smallcaps" id="S1.F1.16.1.1">Melodi</span>.</span> <span class="ltx_text ltx_font_smallcaps" id="S1.F1.17.2">Melodi</span> employs a hierarchical memory representation, incorporating both short-term and long-term compression mechanisms, integrated with a transformer-based language model. It utilizes a stack of short-term layers to recurrently compress each context window <math alttext="x_{k}^{0}" class="ltx_Math" display="inline" id="S1.F1.8.8.m1.1"><semantics id="S1.F1.8.8.m1.1b"><msubsup id="S1.F1.8.8.m1.1.1" xref="S1.F1.8.8.m1.1.1.cmml"><mi id="S1.F1.8.8.m1.1.1.2.2" xref="S1.F1.8.8.m1.1.1.2.2.cmml">x</mi><mi id="S1.F1.8.8.m1.1.1.2.3" xref="S1.F1.8.8.m1.1.1.2.3.cmml">k</mi><mn id="S1.F1.8.8.m1.1.1.3" xref="S1.F1.8.8.m1.1.1.3.cmml">0</mn></msubsup><annotation-xml encoding="MathML-Content" id="S1.F1.8.8.m1.1c"><apply id="S1.F1.8.8.m1.1.1.cmml" xref="S1.F1.8.8.m1.1.1"><csymbol cd="ambiguous" id="S1.F1.8.8.m1.1.1.1.cmml" xref="S1.F1.8.8.m1.1.1">superscript</csymbol><apply id="S1.F1.8.8.m1.1.1.2.cmml" xref="S1.F1.8.8.m1.1.1"><csymbol cd="ambiguous" id="S1.F1.8.8.m1.1.1.2.1.cmml" xref="S1.F1.8.8.m1.1.1">subscript</csymbol><ci id="S1.F1.8.8.m1.1.1.2.2.cmml" xref="S1.F1.8.8.m1.1.1.2.2">𝑥</ci><ci id="S1.F1.8.8.m1.1.1.2.3.cmml" xref="S1.F1.8.8.m1.1.1.2.3">𝑘</ci></apply><cn id="S1.F1.8.8.m1.1.1.3.cmml" type="integer" xref="S1.F1.8.8.m1.1.1.3">0</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.8.8.m1.1d">x_{k}^{0}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.8.8.m1.1e">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT 0 end_POSTSUPERSCRIPT</annotation></semantics></math> into short-term memory tokens <math alttext="\{z^{l}_{k}\}" class="ltx_Math" display="inline" id="S1.F1.9.9.m2.1"><semantics id="S1.F1.9.9.m2.1b"><mrow id="S1.F1.9.9.m2.1.1.1" xref="S1.F1.9.9.m2.1.1.2.cmml"><mo id="S1.F1.9.9.m2.1.1.1.2" stretchy="false" xref="S1.F1.9.9.m2.1.1.2.cmml">{</mo><msubsup id="S1.F1.9.9.m2.1.1.1.1" xref="S1.F1.9.9.m2.1.1.1.1.cmml"><mi id="S1.F1.9.9.m2.1.1.1.1.2.2" xref="S1.F1.9.9.m2.1.1.1.1.2.2.cmml">z</mi><mi id="S1.F1.9.9.m2.1.1.1.1.3" xref="S1.F1.9.9.m2.1.1.1.1.3.cmml">k</mi><mi id="S1.F1.9.9.m2.1.1.1.1.2.3" xref="S1.F1.9.9.m2.1.1.1.1.2.3.cmml">l</mi></msubsup><mo id="S1.F1.9.9.m2.1.1.1.3" stretchy="false" xref="S1.F1.9.9.m2.1.1.2.cmml">}</mo></mrow><annotation-xml encoding="MathML-Content" id="S1.F1.9.9.m2.1c"><set id="S1.F1.9.9.m2.1.1.2.cmml" xref="S1.F1.9.9.m2.1.1.1"><apply id="S1.F1.9.9.m2.1.1.1.1.cmml" xref="S1.F1.9.9.m2.1.1.1.1"><csymbol cd="ambiguous" id="S1.F1.9.9.m2.1.1.1.1.1.cmml" xref="S1.F1.9.9.m2.1.1.1.1">subscript</csymbol><apply id="S1.F1.9.9.m2.1.1.1.1.2.cmml" xref="S1.F1.9.9.m2.1.1.1.1"><csymbol cd="ambiguous" id="S1.F1.9.9.m2.1.1.1.1.2.1.cmml" xref="S1.F1.9.9.m2.1.1.1.1">superscript</csymbol><ci id="S1.F1.9.9.m2.1.1.1.1.2.2.cmml" xref="S1.F1.9.9.m2.1.1.1.1.2.2">𝑧</ci><ci id="S1.F1.9.9.m2.1.1.1.1.2.3.cmml" xref="S1.F1.9.9.m2.1.1.1.1.2.3">𝑙</ci></apply><ci id="S1.F1.9.9.m2.1.1.1.1.3.cmml" xref="S1.F1.9.9.m2.1.1.1.1.3">𝑘</ci></apply></set></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.9.9.m2.1d">\{z^{l}_{k}\}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.9.9.m2.1e">{ italic_z start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT }</annotation></semantics></math>, and inserts a long-term layer to store compressed key-value pairs within a long-term memory <math alttext="m_{1:k}" class="ltx_Math" display="inline" id="S1.F1.10.10.m3.1"><semantics id="S1.F1.10.10.m3.1b"><msub id="S1.F1.10.10.m3.1.1" xref="S1.F1.10.10.m3.1.1.cmml"><mi id="S1.F1.10.10.m3.1.1.2" xref="S1.F1.10.10.m3.1.1.2.cmml">m</mi><mrow id="S1.F1.10.10.m3.1.1.3" xref="S1.F1.10.10.m3.1.1.3.cmml"><mn id="S1.F1.10.10.m3.1.1.3.2" xref="S1.F1.10.10.m3.1.1.3.2.cmml">1</mn><mo id="S1.F1.10.10.m3.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="S1.F1.10.10.m3.1.1.3.1.cmml">:</mo><mi id="S1.F1.10.10.m3.1.1.3.3" xref="S1.F1.10.10.m3.1.1.3.3.cmml">k</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S1.F1.10.10.m3.1c"><apply id="S1.F1.10.10.m3.1.1.cmml" xref="S1.F1.10.10.m3.1.1"><csymbol cd="ambiguous" id="S1.F1.10.10.m3.1.1.1.cmml" xref="S1.F1.10.10.m3.1.1">subscript</csymbol><ci id="S1.F1.10.10.m3.1.1.2.cmml" xref="S1.F1.10.10.m3.1.1.2">𝑚</ci><apply id="S1.F1.10.10.m3.1.1.3.cmml" xref="S1.F1.10.10.m3.1.1.3"><ci id="S1.F1.10.10.m3.1.1.3.1.cmml" xref="S1.F1.10.10.m3.1.1.3.1">:</ci><cn id="S1.F1.10.10.m3.1.1.3.2.cmml" type="integer" xref="S1.F1.10.10.m3.1.1.3.2">1</cn><ci id="S1.F1.10.10.m3.1.1.3.3.cmml" xref="S1.F1.10.10.m3.1.1.3.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.10.10.m3.1d">m_{1:k}</annotation><annotation encoding="application/x-llamapun" id="S1.F1.10.10.m3.1e">italic_m start_POSTSUBSCRIPT 1 : italic_k end_POSTSUBSCRIPT</annotation></semantics></math>. Both short-term and long-term layers leverage modified transformer blocks. In this illustration, we assume a total of <math alttext="N" class="ltx_Math" display="inline" id="S1.F1.11.11.m4.1"><semantics id="S1.F1.11.11.m4.1b"><mi id="S1.F1.11.11.m4.1.1" xref="S1.F1.11.11.m4.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S1.F1.11.11.m4.1c"><ci id="S1.F1.11.11.m4.1.1.cmml" xref="S1.F1.11.11.m4.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.11.11.m4.1d">N</annotation><annotation encoding="application/x-llamapun" id="S1.F1.11.11.m4.1e">italic_N</annotation></semantics></math> layers, with <math alttext="M" class="ltx_Math" display="inline" id="S1.F1.12.12.m5.1"><semantics id="S1.F1.12.12.m5.1b"><mi id="S1.F1.12.12.m5.1.1" xref="S1.F1.12.12.m5.1.1.cmml">M</mi><annotation-xml encoding="MathML-Content" id="S1.F1.12.12.m5.1c"><ci id="S1.F1.12.12.m5.1.1.cmml" xref="S1.F1.12.12.m5.1.1">𝑀</ci></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.12.12.m5.1d">M</annotation><annotation encoding="application/x-llamapun" id="S1.F1.12.12.m5.1e">italic_M</annotation></semantics></math> short-term layers preceding 1 long-term layer and <math alttext="N-M-1" class="ltx_Math" display="inline" id="S1.F1.13.13.m6.1"><semantics id="S1.F1.13.13.m6.1b"><mrow id="S1.F1.13.13.m6.1.1" xref="S1.F1.13.13.m6.1.1.cmml"><mi id="S1.F1.13.13.m6.1.1.2" xref="S1.F1.13.13.m6.1.1.2.cmml">N</mi><mo id="S1.F1.13.13.m6.1.1.1" xref="S1.F1.13.13.m6.1.1.1.cmml">−</mo><mi id="S1.F1.13.13.m6.1.1.3" xref="S1.F1.13.13.m6.1.1.3.cmml">M</mi><mo id="S1.F1.13.13.m6.1.1.1b" xref="S1.F1.13.13.m6.1.1.1.cmml">−</mo><mn id="S1.F1.13.13.m6.1.1.4" xref="S1.F1.13.13.m6.1.1.4.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S1.F1.13.13.m6.1c"><apply id="S1.F1.13.13.m6.1.1.cmml" xref="S1.F1.13.13.m6.1.1"><minus id="S1.F1.13.13.m6.1.1.1.cmml" xref="S1.F1.13.13.m6.1.1.1"></minus><ci id="S1.F1.13.13.m6.1.1.2.cmml" xref="S1.F1.13.13.m6.1.1.2">𝑁</ci><ci id="S1.F1.13.13.m6.1.1.3.cmml" xref="S1.F1.13.13.m6.1.1.3">𝑀</ci><cn id="S1.F1.13.13.m6.1.1.4.cmml" type="integer" xref="S1.F1.13.13.m6.1.1.4">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S1.F1.13.13.m6.1d">N-M-1</annotation><annotation encoding="application/x-llamapun" id="S1.F1.13.13.m6.1e">italic_N - italic_M - 1</annotation></semantics></math> short-term layers following it.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Long-context language models, exemplified by Gemini <cite class="ltx_cite ltx_citemacro_citep">(Gemini-Team, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib10" title="">2024</a>)</cite> and GPT <cite class="ltx_cite ltx_citemacro_citep">(OpenAI, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib21" title="">2024</a>)</cite>, showcase remarkable capabilities across diverse modalities (e.g., text, images, audio, code, video) and seamlessly integrate various machine learning techniques, including many-shot in-context learning <cite class="ltx_cite ltx_citemacro_citep">(Agarwal et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib1" title="">2024</a>)</cite>, chain-of-thought prompting <cite class="ltx_cite ltx_citemacro_citep">(Wei et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib36" title="">2022b</a>)</cite>, and the incorporation of explicit instructions <cite class="ltx_cite ltx_citemacro_citep">(Chung et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib6" title="">2024</a>; Wei et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib35" title="">2022a</a>)</cite>. However, the quadratic complexity of attention mechanisms within transformer models necessitates significant computational resources to handle long contexts effectively. This has spurred the development of efficient solutions <cite class="ltx_cite ltx_citemacro_citep">(Dai et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib7" title="">2019</a>; Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib37" title="">2022</a>; Bulatov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib2" title="">2022</a>)</cite> that process long contexts via short context windows, much like how humans process information by reading a book chapter by chapter. A central question underlying these solutions is: <span class="ltx_text ltx_font_italic" id="S1.p1.1.1">how can we effectively model and manage memory to bridge the gaps between these short context windows over long context?</span></p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Memory fundamentally revolves around compressing and storing information for future utilization, all within the constraints of limited capacity. The Long Short-Term Memory (LSTM) architecture <cite class="ltx_cite ltx_citemacro_citep">(Hochreiter &amp; Schmidhuber, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib11" title="">1997</a>)</cite> tackles this by recurrently compressing historical information into hidden states after processing each token. With the rise of Transformer models <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib33" title="">2017</a>)</cite> dominating the language modeling landscape, recent memory designs have shifted towards utilizing Transformers to process a context window, thereby moving the focus of memory management from the token level to the context window level.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">Transformer-XL <cite class="ltx_cite ltx_citemacro_citep">(Dai et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib7" title="">2019</a>)</cite> employs a caching mechanism to store multi-layer key-value (KV) pairs from the preceding window as memory. Memorizing Transformer <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib37" title="">2022</a>)</cite> builds upon this foundation by incorporating a dedicated layer to memorize all KV pairs from that layer across all prior windows. Meanwhile, Block Recurrent Transformer <cite class="ltx_cite ltx_citemacro_citep">(Hutchins et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib15" title="">2022</a>)</cite> and Recurrent Memory Transformer <cite class="ltx_cite ltx_citemacro_citep">(Bulatov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib2" title="">2022</a>)</cite> introduce distinct recurrent compression mechanisms, implemented in a middle layer and at the output, respectively.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">In this paper, we introduce <span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.1">Melodi</span> (short for “<span class="ltx_text ltx_framed ltx_framed_underline" id="S1.p4.1.2">ME</span>mory with <span class="ltx_text ltx_framed ltx_framed_underline" id="S1.p4.1.3">LO</span>w <span class="ltx_text ltx_framed ltx_framed_underline" id="S1.p4.1.4">DI</span>mension”), an efficient memory architecture designed to handle long contexts despite operating on short context windows (e.g., 512 tokens per window). <span class="ltx_text ltx_font_smallcaps" id="S1.p4.1.5">Melodi</span> integrates both short-term and long-term memory through a compression-based approach. The short-term memory, recurrent in nature and possessing low capacity, spans multiple network layers, progressively compressing context tokens and prior memory at each layer. In contrast, the long-term memory, incremental and high-capacity, resides within a single network layer. It maintains a record of the entire history by further compressing each context window and stacking them. Both short-term and long-term memory are seamlessly incorporated into a multi-layer transformer model using a “sandwich” structure (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">1</span></a>), incurring negligible additional parameters.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p5">
<p class="ltx_p" id="S1.p5.1"><span class="ltx_text ltx_font_smallcaps" id="S1.p5.1.1">Melodi</span> demonstrates strong performance on various long-context datasets. For instance, utilizing a 13-layer transformer network with 1024 embedding dimensions and 512-token context windows, <span class="ltx_text ltx_font_smallcaps" id="S1.p5.1.2">Melodi</span> achieves perplexity scores of 10.44 and 2.11 on PG-19 (T5 vocabulary) and arXiv Math (Meena vocabulary), respectively. This represents a clear improvement over the Memorizing Transformer (10.62 on PG-19, 2.14 on arXiv) with dense attention (as opposed to top-k attention), while significantly reducing memory usage by a factor of 8. Furthermore, ablation studies confirm the complementary nature of short-term and long-term memory in <span class="ltx_text ltx_font_smallcaps" id="S1.p5.1.3">Melodi</span>, highlighting their synergistic contribution to an efficient and effective memory architecture.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Our Method: Melodi</h2>
<div class="ltx_para ltx_noindent" id="S2.p1">
<p class="ltx_p" id="S2.p1.1"><span class="ltx_text ltx_font_smallcaps" id="S2.p1.1.1">Melodi</span> focuses on efficiently comprehending <span class="ltx_text ltx_font_italic" id="S2.p1.1.2">long contexts</span> through the utilization of <span class="ltx_text ltx_font_italic" id="S2.p1.1.3">short context windows</span>, thus circumventing the quadratic complexity associated with attention mechanisms over long sequences. This approach necessitates a memory design that not only ensures smooth transitions between windows but also preserves crucial information from all preceding windows.</p>
</div>
<section class="ltx_subsection" id="S2.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.1 </span>Architecture Overview</h3>
<div class="ltx_para ltx_noindent" id="S2.SS1.p1">
<p class="ltx_p" id="S2.SS1.p1.1"><span class="ltx_text ltx_font_bold" id="S2.SS1.p1.1.1">Design principle:</span>
The core principle behind <span class="ltx_text ltx_font_smallcaps" id="S2.SS1.p1.1.2">Melodi</span> is to represent short-term and long-term memory through a hierarchical compression scheme. Specifically, the short-term memory recurrently compresses context tokens across multiple network layers (e.g., condensing a 512-token context window into 128 memory tokens). This process not only facilitates seamless transitions between context windows but also aggregates information across them, effectively functioning as a fixed-size multi-layer long short-term memory (LSTM) mechanism <cite class="ltx_cite ltx_citemacro_citep">(Hochreiter &amp; Schmidhuber, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib11" title="">1997</a>)</cite>. Furthermore, each context window undergoes additional compression within a middle layer and is then stacked into a long-term memory. This long-term memory retains essential information from the entire history, thus compensating for any potential forgetting in the short-term memory. Both short-term and long-term memory are seamlessly integrated into a transformer-based language model, enabling the comprehension of long contexts even under the constraint of short context windows.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS1.p2">
<p class="ltx_p" id="S2.SS1.p2.1"><span class="ltx_text ltx_font_bold" id="S2.SS1.p2.1.1">Sandwich architecture:</span>
<span class="ltx_text ltx_font_smallcaps" id="S2.SS1.p2.1.2">Melodi</span>’s network architecture (Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">1</span></a>) features a ”sandwich” structure, with a long-term compression layer inserted between multiple recurrent short-term compression layers. Both layer types utilize a standard transformer block (attention and feed-forward network) with tailored compression modifications. The short-term layers recurrently compress the current context window and update short-term memory, while the long-term layer further compresses information and appends it to long-term memory.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS1.p3">
<p class="ltx_p" id="S2.SS1.p3.11"><span class="ltx_text ltx_font_bold" id="S2.SS1.p3.11.1">Terminology:</span>
In the remainder of this paper, we adopt the following notation. We use <math alttext="k" class="ltx_Math" display="inline" id="S2.SS1.p3.1.m1.1"><semantics id="S2.SS1.p3.1.m1.1a"><mi id="S2.SS1.p3.1.m1.1.1" xref="S2.SS1.p3.1.m1.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.1.m1.1b"><ci id="S2.SS1.p3.1.m1.1.1.cmml" xref="S2.SS1.p3.1.m1.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.1.m1.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.1.m1.1d">italic_k</annotation></semantics></math> to index context windows and <math alttext="l" class="ltx_Math" display="inline" id="S2.SS1.p3.2.m2.1"><semantics id="S2.SS1.p3.2.m2.1a"><mi id="S2.SS1.p3.2.m2.1.1" xref="S2.SS1.p3.2.m2.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.2.m2.1b"><ci id="S2.SS1.p3.2.m2.1.1.cmml" xref="S2.SS1.p3.2.m2.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.2.m2.1c">l</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.2.m2.1d">italic_l</annotation></semantics></math> to index network layers. Within the <math alttext="l^{th}" class="ltx_Math" display="inline" id="S2.SS1.p3.3.m3.1"><semantics id="S2.SS1.p3.3.m3.1a"><msup id="S2.SS1.p3.3.m3.1.1" xref="S2.SS1.p3.3.m3.1.1.cmml"><mi id="S2.SS1.p3.3.m3.1.1.2" xref="S2.SS1.p3.3.m3.1.1.2.cmml">l</mi><mrow id="S2.SS1.p3.3.m3.1.1.3" xref="S2.SS1.p3.3.m3.1.1.3.cmml"><mi id="S2.SS1.p3.3.m3.1.1.3.2" xref="S2.SS1.p3.3.m3.1.1.3.2.cmml">t</mi><mo id="S2.SS1.p3.3.m3.1.1.3.1" xref="S2.SS1.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S2.SS1.p3.3.m3.1.1.3.3" xref="S2.SS1.p3.3.m3.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.3.m3.1b"><apply id="S2.SS1.p3.3.m3.1.1.cmml" xref="S2.SS1.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.3.m3.1.1.1.cmml" xref="S2.SS1.p3.3.m3.1.1">superscript</csymbol><ci id="S2.SS1.p3.3.m3.1.1.2.cmml" xref="S2.SS1.p3.3.m3.1.1.2">𝑙</ci><apply id="S2.SS1.p3.3.m3.1.1.3.cmml" xref="S2.SS1.p3.3.m3.1.1.3"><times id="S2.SS1.p3.3.m3.1.1.3.1.cmml" xref="S2.SS1.p3.3.m3.1.1.3.1"></times><ci id="S2.SS1.p3.3.m3.1.1.3.2.cmml" xref="S2.SS1.p3.3.m3.1.1.3.2">𝑡</ci><ci id="S2.SS1.p3.3.m3.1.1.3.3.cmml" xref="S2.SS1.p3.3.m3.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.3.m3.1c">l^{th}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.3.m3.1d">italic_l start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> layer of the <math alttext="k^{th}" class="ltx_Math" display="inline" id="S2.SS1.p3.4.m4.1"><semantics id="S2.SS1.p3.4.m4.1a"><msup id="S2.SS1.p3.4.m4.1.1" xref="S2.SS1.p3.4.m4.1.1.cmml"><mi id="S2.SS1.p3.4.m4.1.1.2" xref="S2.SS1.p3.4.m4.1.1.2.cmml">k</mi><mrow id="S2.SS1.p3.4.m4.1.1.3" xref="S2.SS1.p3.4.m4.1.1.3.cmml"><mi id="S2.SS1.p3.4.m4.1.1.3.2" xref="S2.SS1.p3.4.m4.1.1.3.2.cmml">t</mi><mo id="S2.SS1.p3.4.m4.1.1.3.1" xref="S2.SS1.p3.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S2.SS1.p3.4.m4.1.1.3.3" xref="S2.SS1.p3.4.m4.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.4.m4.1b"><apply id="S2.SS1.p3.4.m4.1.1.cmml" xref="S2.SS1.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.4.m4.1.1.1.cmml" xref="S2.SS1.p3.4.m4.1.1">superscript</csymbol><ci id="S2.SS1.p3.4.m4.1.1.2.cmml" xref="S2.SS1.p3.4.m4.1.1.2">𝑘</ci><apply id="S2.SS1.p3.4.m4.1.1.3.cmml" xref="S2.SS1.p3.4.m4.1.1.3"><times id="S2.SS1.p3.4.m4.1.1.3.1.cmml" xref="S2.SS1.p3.4.m4.1.1.3.1"></times><ci id="S2.SS1.p3.4.m4.1.1.3.2.cmml" xref="S2.SS1.p3.4.m4.1.1.3.2">𝑡</ci><ci id="S2.SS1.p3.4.m4.1.1.3.3.cmml" xref="S2.SS1.p3.4.m4.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.4.m4.1c">k^{th}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.4.m4.1d">italic_k start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> context window, the input context tokens are represented by <math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS1.p3.5.m5.1"><semantics id="S2.SS1.p3.5.m5.1a"><msubsup id="S2.SS1.p3.5.m5.1.1" xref="S2.SS1.p3.5.m5.1.1.cmml"><mi id="S2.SS1.p3.5.m5.1.1.2.2" xref="S2.SS1.p3.5.m5.1.1.2.2.cmml">x</mi><mi id="S2.SS1.p3.5.m5.1.1.2.3" xref="S2.SS1.p3.5.m5.1.1.2.3.cmml">k</mi><mrow id="S2.SS1.p3.5.m5.1.1.3" xref="S2.SS1.p3.5.m5.1.1.3.cmml"><mi id="S2.SS1.p3.5.m5.1.1.3.2" xref="S2.SS1.p3.5.m5.1.1.3.2.cmml">l</mi><mo id="S2.SS1.p3.5.m5.1.1.3.1" xref="S2.SS1.p3.5.m5.1.1.3.1.cmml">−</mo><mn id="S2.SS1.p3.5.m5.1.1.3.3" xref="S2.SS1.p3.5.m5.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.5.m5.1b"><apply id="S2.SS1.p3.5.m5.1.1.cmml" xref="S2.SS1.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.5.m5.1.1.1.cmml" xref="S2.SS1.p3.5.m5.1.1">superscript</csymbol><apply id="S2.SS1.p3.5.m5.1.1.2.cmml" xref="S2.SS1.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.5.m5.1.1.2.1.cmml" xref="S2.SS1.p3.5.m5.1.1">subscript</csymbol><ci id="S2.SS1.p3.5.m5.1.1.2.2.cmml" xref="S2.SS1.p3.5.m5.1.1.2.2">𝑥</ci><ci id="S2.SS1.p3.5.m5.1.1.2.3.cmml" xref="S2.SS1.p3.5.m5.1.1.2.3">𝑘</ci></apply><apply id="S2.SS1.p3.5.m5.1.1.3.cmml" xref="S2.SS1.p3.5.m5.1.1.3"><minus id="S2.SS1.p3.5.m5.1.1.3.1.cmml" xref="S2.SS1.p3.5.m5.1.1.3.1"></minus><ci id="S2.SS1.p3.5.m5.1.1.3.2.cmml" xref="S2.SS1.p3.5.m5.1.1.3.2">𝑙</ci><cn id="S2.SS1.p3.5.m5.1.1.3.3.cmml" type="integer" xref="S2.SS1.p3.5.m5.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.5.m5.1c">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.5.m5.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>. The output context tokens, denoted as <math alttext="x_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS1.p3.6.m6.1"><semantics id="S2.SS1.p3.6.m6.1a"><msubsup id="S2.SS1.p3.6.m6.1.1" xref="S2.SS1.p3.6.m6.1.1.cmml"><mi id="S2.SS1.p3.6.m6.1.1.2.2" xref="S2.SS1.p3.6.m6.1.1.2.2.cmml">x</mi><mi id="S2.SS1.p3.6.m6.1.1.2.3" xref="S2.SS1.p3.6.m6.1.1.2.3.cmml">k</mi><mi id="S2.SS1.p3.6.m6.1.1.3" xref="S2.SS1.p3.6.m6.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.6.m6.1b"><apply id="S2.SS1.p3.6.m6.1.1.cmml" xref="S2.SS1.p3.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.6.m6.1.1.1.cmml" xref="S2.SS1.p3.6.m6.1.1">superscript</csymbol><apply id="S2.SS1.p3.6.m6.1.1.2.cmml" xref="S2.SS1.p3.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.6.m6.1.1.2.1.cmml" xref="S2.SS1.p3.6.m6.1.1">subscript</csymbol><ci id="S2.SS1.p3.6.m6.1.1.2.2.cmml" xref="S2.SS1.p3.6.m6.1.1.2.2">𝑥</ci><ci id="S2.SS1.p3.6.m6.1.1.2.3.cmml" xref="S2.SS1.p3.6.m6.1.1.2.3">𝑘</ci></apply><ci id="S2.SS1.p3.6.m6.1.1.3.cmml" xref="S2.SS1.p3.6.m6.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.6.m6.1c">x_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.6.m6.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>, serve as input for the subsequent layer. The input and output of the short-term memory are <math alttext="z_{k-1}^{l}" class="ltx_Math" display="inline" id="S2.SS1.p3.7.m7.1"><semantics id="S2.SS1.p3.7.m7.1a"><msubsup id="S2.SS1.p3.7.m7.1.1" xref="S2.SS1.p3.7.m7.1.1.cmml"><mi id="S2.SS1.p3.7.m7.1.1.2.2" xref="S2.SS1.p3.7.m7.1.1.2.2.cmml">z</mi><mrow id="S2.SS1.p3.7.m7.1.1.2.3" xref="S2.SS1.p3.7.m7.1.1.2.3.cmml"><mi id="S2.SS1.p3.7.m7.1.1.2.3.2" xref="S2.SS1.p3.7.m7.1.1.2.3.2.cmml">k</mi><mo id="S2.SS1.p3.7.m7.1.1.2.3.1" xref="S2.SS1.p3.7.m7.1.1.2.3.1.cmml">−</mo><mn id="S2.SS1.p3.7.m7.1.1.2.3.3" xref="S2.SS1.p3.7.m7.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.SS1.p3.7.m7.1.1.3" xref="S2.SS1.p3.7.m7.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.7.m7.1b"><apply id="S2.SS1.p3.7.m7.1.1.cmml" xref="S2.SS1.p3.7.m7.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.7.m7.1.1.1.cmml" xref="S2.SS1.p3.7.m7.1.1">superscript</csymbol><apply id="S2.SS1.p3.7.m7.1.1.2.cmml" xref="S2.SS1.p3.7.m7.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.7.m7.1.1.2.1.cmml" xref="S2.SS1.p3.7.m7.1.1">subscript</csymbol><ci id="S2.SS1.p3.7.m7.1.1.2.2.cmml" xref="S2.SS1.p3.7.m7.1.1.2.2">𝑧</ci><apply id="S2.SS1.p3.7.m7.1.1.2.3.cmml" xref="S2.SS1.p3.7.m7.1.1.2.3"><minus id="S2.SS1.p3.7.m7.1.1.2.3.1.cmml" xref="S2.SS1.p3.7.m7.1.1.2.3.1"></minus><ci id="S2.SS1.p3.7.m7.1.1.2.3.2.cmml" xref="S2.SS1.p3.7.m7.1.1.2.3.2">𝑘</ci><cn id="S2.SS1.p3.7.m7.1.1.2.3.3.cmml" type="integer" xref="S2.SS1.p3.7.m7.1.1.2.3.3">1</cn></apply></apply><ci id="S2.SS1.p3.7.m7.1.1.3.cmml" xref="S2.SS1.p3.7.m7.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.7.m7.1c">z_{k-1}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.7.m7.1d">italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="z_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS1.p3.8.m8.1"><semantics id="S2.SS1.p3.8.m8.1a"><msubsup id="S2.SS1.p3.8.m8.1.1" xref="S2.SS1.p3.8.m8.1.1.cmml"><mi id="S2.SS1.p3.8.m8.1.1.2.2" xref="S2.SS1.p3.8.m8.1.1.2.2.cmml">z</mi><mi id="S2.SS1.p3.8.m8.1.1.2.3" xref="S2.SS1.p3.8.m8.1.1.2.3.cmml">k</mi><mi id="S2.SS1.p3.8.m8.1.1.3" xref="S2.SS1.p3.8.m8.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.8.m8.1b"><apply id="S2.SS1.p3.8.m8.1.1.cmml" xref="S2.SS1.p3.8.m8.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.8.m8.1.1.1.cmml" xref="S2.SS1.p3.8.m8.1.1">superscript</csymbol><apply id="S2.SS1.p3.8.m8.1.1.2.cmml" xref="S2.SS1.p3.8.m8.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.8.m8.1.1.2.1.cmml" xref="S2.SS1.p3.8.m8.1.1">subscript</csymbol><ci id="S2.SS1.p3.8.m8.1.1.2.2.cmml" xref="S2.SS1.p3.8.m8.1.1.2.2">𝑧</ci><ci id="S2.SS1.p3.8.m8.1.1.2.3.cmml" xref="S2.SS1.p3.8.m8.1.1.2.3">𝑘</ci></apply><ci id="S2.SS1.p3.8.m8.1.1.3.cmml" xref="S2.SS1.p3.8.m8.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.8.m8.1c">z_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.8.m8.1d">italic_z start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>, respectively. The long-term memory preceding window <math alttext="k" class="ltx_Math" display="inline" id="S2.SS1.p3.9.m9.1"><semantics id="S2.SS1.p3.9.m9.1a"><mi id="S2.SS1.p3.9.m9.1.1" xref="S2.SS1.p3.9.m9.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.9.m9.1b"><ci id="S2.SS1.p3.9.m9.1.1.cmml" xref="S2.SS1.p3.9.m9.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.9.m9.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.9.m9.1d">italic_k</annotation></semantics></math> is denoted as <math alttext="m_{1:k-1}" class="ltx_Math" display="inline" id="S2.SS1.p3.10.m10.1"><semantics id="S2.SS1.p3.10.m10.1a"><msub id="S2.SS1.p3.10.m10.1.1" xref="S2.SS1.p3.10.m10.1.1.cmml"><mi id="S2.SS1.p3.10.m10.1.1.2" xref="S2.SS1.p3.10.m10.1.1.2.cmml">m</mi><mrow id="S2.SS1.p3.10.m10.1.1.3" xref="S2.SS1.p3.10.m10.1.1.3.cmml"><mn id="S2.SS1.p3.10.m10.1.1.3.2" xref="S2.SS1.p3.10.m10.1.1.3.2.cmml">1</mn><mo id="S2.SS1.p3.10.m10.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="S2.SS1.p3.10.m10.1.1.3.1.cmml">:</mo><mrow id="S2.SS1.p3.10.m10.1.1.3.3" xref="S2.SS1.p3.10.m10.1.1.3.3.cmml"><mi id="S2.SS1.p3.10.m10.1.1.3.3.2" xref="S2.SS1.p3.10.m10.1.1.3.3.2.cmml">k</mi><mo id="S2.SS1.p3.10.m10.1.1.3.3.1" xref="S2.SS1.p3.10.m10.1.1.3.3.1.cmml">−</mo><mn id="S2.SS1.p3.10.m10.1.1.3.3.3" xref="S2.SS1.p3.10.m10.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.10.m10.1b"><apply id="S2.SS1.p3.10.m10.1.1.cmml" xref="S2.SS1.p3.10.m10.1.1"><csymbol cd="ambiguous" id="S2.SS1.p3.10.m10.1.1.1.cmml" xref="S2.SS1.p3.10.m10.1.1">subscript</csymbol><ci id="S2.SS1.p3.10.m10.1.1.2.cmml" xref="S2.SS1.p3.10.m10.1.1.2">𝑚</ci><apply id="S2.SS1.p3.10.m10.1.1.3.cmml" xref="S2.SS1.p3.10.m10.1.1.3"><ci id="S2.SS1.p3.10.m10.1.1.3.1.cmml" xref="S2.SS1.p3.10.m10.1.1.3.1">:</ci><cn id="S2.SS1.p3.10.m10.1.1.3.2.cmml" type="integer" xref="S2.SS1.p3.10.m10.1.1.3.2">1</cn><apply id="S2.SS1.p3.10.m10.1.1.3.3.cmml" xref="S2.SS1.p3.10.m10.1.1.3.3"><minus id="S2.SS1.p3.10.m10.1.1.3.3.1.cmml" xref="S2.SS1.p3.10.m10.1.1.3.3.1"></minus><ci id="S2.SS1.p3.10.m10.1.1.3.3.2.cmml" xref="S2.SS1.p3.10.m10.1.1.3.3.2">𝑘</ci><cn id="S2.SS1.p3.10.m10.1.1.3.3.3.cmml" type="integer" xref="S2.SS1.p3.10.m10.1.1.3.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.10.m10.1c">m_{1:k-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.10.m10.1d">italic_m start_POSTSUBSCRIPT 1 : italic_k - 1 end_POSTSUBSCRIPT</annotation></semantics></math>. Note that we omit the subscript <math alttext="l" class="ltx_Math" display="inline" id="S2.SS1.p3.11.m11.1"><semantics id="S2.SS1.p3.11.m11.1a"><mi id="S2.SS1.p3.11.m11.1.1" xref="S2.SS1.p3.11.m11.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S2.SS1.p3.11.m11.1b"><ci id="S2.SS1.p3.11.m11.1.1.cmml" xref="S2.SS1.p3.11.m11.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS1.p3.11.m11.1c">l</annotation><annotation encoding="application/x-llamapun" id="S2.SS1.p3.11.m11.1d">italic_l</annotation></semantics></math> for the long-term memory since it resides within a single long-term layer.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS1.p4">
<p class="ltx_p" id="S2.SS1.p4.1">Next, we will discuss both short-term and long-term layers in detail.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.2 </span>Short-Term Memory: Multi-Layer Recurrent Compression</h3>
<figure class="ltx_figure ltx_align_floatright" id="S2.F2">
<p class="ltx_p ltx_align_center ltx_align_center" id="S2.F2.1.1"><span class="ltx_text" id="S2.F2.1.1.1"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="279" id="S2.F2.1.1.1.g1" src="extracted/5900799/figure/short-term-2.png" width="281"/></span></p>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 2: </span><span class="ltx_text ltx_font_bold" id="S2.F2.17.1">Short-term layer.</span> The figure illustrates the processing of the <math alttext="k^{th}" class="ltx_Math" display="inline" id="S2.F2.9.9.m1.1"><semantics id="S2.F2.9.9.m1.1b"><msup id="S2.F2.9.9.m1.1.1" xref="S2.F2.9.9.m1.1.1.cmml"><mi id="S2.F2.9.9.m1.1.1.2" xref="S2.F2.9.9.m1.1.1.2.cmml">k</mi><mrow id="S2.F2.9.9.m1.1.1.3" xref="S2.F2.9.9.m1.1.1.3.cmml"><mi id="S2.F2.9.9.m1.1.1.3.2" xref="S2.F2.9.9.m1.1.1.3.2.cmml">t</mi><mo id="S2.F2.9.9.m1.1.1.3.1" xref="S2.F2.9.9.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.9.9.m1.1.1.3.3" xref="S2.F2.9.9.m1.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S2.F2.9.9.m1.1c"><apply id="S2.F2.9.9.m1.1.1.cmml" xref="S2.F2.9.9.m1.1.1"><csymbol cd="ambiguous" id="S2.F2.9.9.m1.1.1.1.cmml" xref="S2.F2.9.9.m1.1.1">superscript</csymbol><ci id="S2.F2.9.9.m1.1.1.2.cmml" xref="S2.F2.9.9.m1.1.1.2">𝑘</ci><apply id="S2.F2.9.9.m1.1.1.3.cmml" xref="S2.F2.9.9.m1.1.1.3"><times id="S2.F2.9.9.m1.1.1.3.1.cmml" xref="S2.F2.9.9.m1.1.1.3.1"></times><ci id="S2.F2.9.9.m1.1.1.3.2.cmml" xref="S2.F2.9.9.m1.1.1.3.2">𝑡</ci><ci id="S2.F2.9.9.m1.1.1.3.3.cmml" xref="S2.F2.9.9.m1.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.9.9.m1.1d">k^{th}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.9.9.m1.1e">italic_k start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> context window at the <math alttext="l^{th}" class="ltx_Math" display="inline" id="S2.F2.10.10.m2.1"><semantics id="S2.F2.10.10.m2.1b"><msup id="S2.F2.10.10.m2.1.1" xref="S2.F2.10.10.m2.1.1.cmml"><mi id="S2.F2.10.10.m2.1.1.2" xref="S2.F2.10.10.m2.1.1.2.cmml">l</mi><mrow id="S2.F2.10.10.m2.1.1.3" xref="S2.F2.10.10.m2.1.1.3.cmml"><mi id="S2.F2.10.10.m2.1.1.3.2" xref="S2.F2.10.10.m2.1.1.3.2.cmml">t</mi><mo id="S2.F2.10.10.m2.1.1.3.1" xref="S2.F2.10.10.m2.1.1.3.1.cmml">⁢</mo><mi id="S2.F2.10.10.m2.1.1.3.3" xref="S2.F2.10.10.m2.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S2.F2.10.10.m2.1c"><apply id="S2.F2.10.10.m2.1.1.cmml" xref="S2.F2.10.10.m2.1.1"><csymbol cd="ambiguous" id="S2.F2.10.10.m2.1.1.1.cmml" xref="S2.F2.10.10.m2.1.1">superscript</csymbol><ci id="S2.F2.10.10.m2.1.1.2.cmml" xref="S2.F2.10.10.m2.1.1.2">𝑙</ci><apply id="S2.F2.10.10.m2.1.1.3.cmml" xref="S2.F2.10.10.m2.1.1.3"><times id="S2.F2.10.10.m2.1.1.3.1.cmml" xref="S2.F2.10.10.m2.1.1.3.1"></times><ci id="S2.F2.10.10.m2.1.1.3.2.cmml" xref="S2.F2.10.10.m2.1.1.3.2">𝑡</ci><ci id="S2.F2.10.10.m2.1.1.3.3.cmml" xref="S2.F2.10.10.m2.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.10.10.m2.1d">l^{th}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.10.10.m2.1e">italic_l start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> short-term layer. It takes the memory from the previous window <math alttext="z_{k-1}^{l}" class="ltx_Math" display="inline" id="S2.F2.11.11.m3.1"><semantics id="S2.F2.11.11.m3.1b"><msubsup id="S2.F2.11.11.m3.1.1" xref="S2.F2.11.11.m3.1.1.cmml"><mi id="S2.F2.11.11.m3.1.1.2.2" xref="S2.F2.11.11.m3.1.1.2.2.cmml">z</mi><mrow id="S2.F2.11.11.m3.1.1.2.3" xref="S2.F2.11.11.m3.1.1.2.3.cmml"><mi id="S2.F2.11.11.m3.1.1.2.3.2" xref="S2.F2.11.11.m3.1.1.2.3.2.cmml">k</mi><mo id="S2.F2.11.11.m3.1.1.2.3.1" xref="S2.F2.11.11.m3.1.1.2.3.1.cmml">−</mo><mn id="S2.F2.11.11.m3.1.1.2.3.3" xref="S2.F2.11.11.m3.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.F2.11.11.m3.1.1.3" xref="S2.F2.11.11.m3.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.F2.11.11.m3.1c"><apply id="S2.F2.11.11.m3.1.1.cmml" xref="S2.F2.11.11.m3.1.1"><csymbol cd="ambiguous" id="S2.F2.11.11.m3.1.1.1.cmml" xref="S2.F2.11.11.m3.1.1">superscript</csymbol><apply id="S2.F2.11.11.m3.1.1.2.cmml" xref="S2.F2.11.11.m3.1.1"><csymbol cd="ambiguous" id="S2.F2.11.11.m3.1.1.2.1.cmml" xref="S2.F2.11.11.m3.1.1">subscript</csymbol><ci id="S2.F2.11.11.m3.1.1.2.2.cmml" xref="S2.F2.11.11.m3.1.1.2.2">𝑧</ci><apply id="S2.F2.11.11.m3.1.1.2.3.cmml" xref="S2.F2.11.11.m3.1.1.2.3"><minus id="S2.F2.11.11.m3.1.1.2.3.1.cmml" xref="S2.F2.11.11.m3.1.1.2.3.1"></minus><ci id="S2.F2.11.11.m3.1.1.2.3.2.cmml" xref="S2.F2.11.11.m3.1.1.2.3.2">𝑘</ci><cn id="S2.F2.11.11.m3.1.1.2.3.3.cmml" type="integer" xref="S2.F2.11.11.m3.1.1.2.3.3">1</cn></apply></apply><ci id="S2.F2.11.11.m3.1.1.3.cmml" xref="S2.F2.11.11.m3.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.11.11.m3.1d">z_{k-1}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.11.11.m3.1e">italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> and the current context/summary (<math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.F2.12.12.m4.1"><semantics id="S2.F2.12.12.m4.1b"><msubsup id="S2.F2.12.12.m4.1.1" xref="S2.F2.12.12.m4.1.1.cmml"><mi id="S2.F2.12.12.m4.1.1.2.2" xref="S2.F2.12.12.m4.1.1.2.2.cmml">x</mi><mi id="S2.F2.12.12.m4.1.1.2.3" xref="S2.F2.12.12.m4.1.1.2.3.cmml">k</mi><mrow id="S2.F2.12.12.m4.1.1.3" xref="S2.F2.12.12.m4.1.1.3.cmml"><mi id="S2.F2.12.12.m4.1.1.3.2" xref="S2.F2.12.12.m4.1.1.3.2.cmml">l</mi><mo id="S2.F2.12.12.m4.1.1.3.1" xref="S2.F2.12.12.m4.1.1.3.1.cmml">−</mo><mn id="S2.F2.12.12.m4.1.1.3.3" xref="S2.F2.12.12.m4.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.F2.12.12.m4.1c"><apply id="S2.F2.12.12.m4.1.1.cmml" xref="S2.F2.12.12.m4.1.1"><csymbol cd="ambiguous" id="S2.F2.12.12.m4.1.1.1.cmml" xref="S2.F2.12.12.m4.1.1">superscript</csymbol><apply id="S2.F2.12.12.m4.1.1.2.cmml" xref="S2.F2.12.12.m4.1.1"><csymbol cd="ambiguous" id="S2.F2.12.12.m4.1.1.2.1.cmml" xref="S2.F2.12.12.m4.1.1">subscript</csymbol><ci id="S2.F2.12.12.m4.1.1.2.2.cmml" xref="S2.F2.12.12.m4.1.1.2.2">𝑥</ci><ci id="S2.F2.12.12.m4.1.1.2.3.cmml" xref="S2.F2.12.12.m4.1.1.2.3">𝑘</ci></apply><apply id="S2.F2.12.12.m4.1.1.3.cmml" xref="S2.F2.12.12.m4.1.1.3"><minus id="S2.F2.12.12.m4.1.1.3.1.cmml" xref="S2.F2.12.12.m4.1.1.3.1"></minus><ci id="S2.F2.12.12.m4.1.1.3.2.cmml" xref="S2.F2.12.12.m4.1.1.3.2">𝑙</ci><cn id="S2.F2.12.12.m4.1.1.3.3.cmml" type="integer" xref="S2.F2.12.12.m4.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.12.12.m4.1d">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.12.12.m4.1e">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="u_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.F2.13.13.m5.1"><semantics id="S2.F2.13.13.m5.1b"><msubsup id="S2.F2.13.13.m5.1.1" xref="S2.F2.13.13.m5.1.1.cmml"><mi id="S2.F2.13.13.m5.1.1.2.2" xref="S2.F2.13.13.m5.1.1.2.2.cmml">u</mi><mi id="S2.F2.13.13.m5.1.1.2.3" xref="S2.F2.13.13.m5.1.1.2.3.cmml">k</mi><mrow id="S2.F2.13.13.m5.1.1.3" xref="S2.F2.13.13.m5.1.1.3.cmml"><mi id="S2.F2.13.13.m5.1.1.3.2" xref="S2.F2.13.13.m5.1.1.3.2.cmml">l</mi><mo id="S2.F2.13.13.m5.1.1.3.1" xref="S2.F2.13.13.m5.1.1.3.1.cmml">−</mo><mn id="S2.F2.13.13.m5.1.1.3.3" xref="S2.F2.13.13.m5.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.F2.13.13.m5.1c"><apply id="S2.F2.13.13.m5.1.1.cmml" xref="S2.F2.13.13.m5.1.1"><csymbol cd="ambiguous" id="S2.F2.13.13.m5.1.1.1.cmml" xref="S2.F2.13.13.m5.1.1">superscript</csymbol><apply id="S2.F2.13.13.m5.1.1.2.cmml" xref="S2.F2.13.13.m5.1.1"><csymbol cd="ambiguous" id="S2.F2.13.13.m5.1.1.2.1.cmml" xref="S2.F2.13.13.m5.1.1">subscript</csymbol><ci id="S2.F2.13.13.m5.1.1.2.2.cmml" xref="S2.F2.13.13.m5.1.1.2.2">𝑢</ci><ci id="S2.F2.13.13.m5.1.1.2.3.cmml" xref="S2.F2.13.13.m5.1.1.2.3">𝑘</ci></apply><apply id="S2.F2.13.13.m5.1.1.3.cmml" xref="S2.F2.13.13.m5.1.1.3"><minus id="S2.F2.13.13.m5.1.1.3.1.cmml" xref="S2.F2.13.13.m5.1.1.3.1"></minus><ci id="S2.F2.13.13.m5.1.1.3.2.cmml" xref="S2.F2.13.13.m5.1.1.3.2">𝑙</ci><cn id="S2.F2.13.13.m5.1.1.3.3.cmml" type="integer" xref="S2.F2.13.13.m5.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.13.13.m5.1d">u_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.13.13.m5.1e">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>) from the previous layer as input. The short-term layer adds two linear token mixers <cite class="ltx_cite ltx_citemacro_citep">(Tolstikhin et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib31" title="">2021</a>)</cite> on top of a standard transformer layer (including attention and FFN) to separate the summary for the next layer <math alttext="u_{k}^{l}" class="ltx_Math" display="inline" id="S2.F2.14.14.m6.1"><semantics id="S2.F2.14.14.m6.1b"><msubsup id="S2.F2.14.14.m6.1.1" xref="S2.F2.14.14.m6.1.1.cmml"><mi id="S2.F2.14.14.m6.1.1.2.2" xref="S2.F2.14.14.m6.1.1.2.2.cmml">u</mi><mi id="S2.F2.14.14.m6.1.1.2.3" xref="S2.F2.14.14.m6.1.1.2.3.cmml">k</mi><mi id="S2.F2.14.14.m6.1.1.3" xref="S2.F2.14.14.m6.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.F2.14.14.m6.1c"><apply id="S2.F2.14.14.m6.1.1.cmml" xref="S2.F2.14.14.m6.1.1"><csymbol cd="ambiguous" id="S2.F2.14.14.m6.1.1.1.cmml" xref="S2.F2.14.14.m6.1.1">superscript</csymbol><apply id="S2.F2.14.14.m6.1.1.2.cmml" xref="S2.F2.14.14.m6.1.1"><csymbol cd="ambiguous" id="S2.F2.14.14.m6.1.1.2.1.cmml" xref="S2.F2.14.14.m6.1.1">subscript</csymbol><ci id="S2.F2.14.14.m6.1.1.2.2.cmml" xref="S2.F2.14.14.m6.1.1.2.2">𝑢</ci><ci id="S2.F2.14.14.m6.1.1.2.3.cmml" xref="S2.F2.14.14.m6.1.1.2.3">𝑘</ci></apply><ci id="S2.F2.14.14.m6.1.1.3.cmml" xref="S2.F2.14.14.m6.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.14.14.m6.1d">u_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.14.14.m6.1e">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> and the memory for the next window <math alttext="z_{k}^{l}" class="ltx_Math" display="inline" id="S2.F2.15.15.m7.1"><semantics id="S2.F2.15.15.m7.1b"><msubsup id="S2.F2.15.15.m7.1.1" xref="S2.F2.15.15.m7.1.1.cmml"><mi id="S2.F2.15.15.m7.1.1.2.2" xref="S2.F2.15.15.m7.1.1.2.2.cmml">z</mi><mi id="S2.F2.15.15.m7.1.1.2.3" xref="S2.F2.15.15.m7.1.1.2.3.cmml">k</mi><mi id="S2.F2.15.15.m7.1.1.3" xref="S2.F2.15.15.m7.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.F2.15.15.m7.1c"><apply id="S2.F2.15.15.m7.1.1.cmml" xref="S2.F2.15.15.m7.1.1"><csymbol cd="ambiguous" id="S2.F2.15.15.m7.1.1.1.cmml" xref="S2.F2.15.15.m7.1.1">superscript</csymbol><apply id="S2.F2.15.15.m7.1.1.2.cmml" xref="S2.F2.15.15.m7.1.1"><csymbol cd="ambiguous" id="S2.F2.15.15.m7.1.1.2.1.cmml" xref="S2.F2.15.15.m7.1.1">subscript</csymbol><ci id="S2.F2.15.15.m7.1.1.2.2.cmml" xref="S2.F2.15.15.m7.1.1.2.2">𝑧</ci><ci id="S2.F2.15.15.m7.1.1.2.3.cmml" xref="S2.F2.15.15.m7.1.1.2.3">𝑘</ci></apply><ci id="S2.F2.15.15.m7.1.1.3.cmml" xref="S2.F2.15.15.m7.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F2.15.15.m7.1d">z_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.F2.15.15.m7.1e">italic_z start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>. Best viewed in color.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S2.SS2.p1">
<p class="ltx_p" id="S2.SS2.p1.10">The short-term memory is distributed across multiple short-term layers (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">1</span></a>). This subsection delves into the specifics of the short-term layer, using the <math alttext="l^{th}" class="ltx_Math" display="inline" id="S2.SS2.p1.1.m1.1"><semantics id="S2.SS2.p1.1.m1.1a"><msup id="S2.SS2.p1.1.m1.1.1" xref="S2.SS2.p1.1.m1.1.1.cmml"><mi id="S2.SS2.p1.1.m1.1.1.2" xref="S2.SS2.p1.1.m1.1.1.2.cmml">l</mi><mrow id="S2.SS2.p1.1.m1.1.1.3" xref="S2.SS2.p1.1.m1.1.1.3.cmml"><mi id="S2.SS2.p1.1.m1.1.1.3.2" xref="S2.SS2.p1.1.m1.1.1.3.2.cmml">t</mi><mo id="S2.SS2.p1.1.m1.1.1.3.1" xref="S2.SS2.p1.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.1.m1.1.1.3.3" xref="S2.SS2.p1.1.m1.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.1.m1.1b"><apply id="S2.SS2.p1.1.m1.1.1.cmml" xref="S2.SS2.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.1.m1.1.1.1.cmml" xref="S2.SS2.p1.1.m1.1.1">superscript</csymbol><ci id="S2.SS2.p1.1.m1.1.1.2.cmml" xref="S2.SS2.p1.1.m1.1.1.2">𝑙</ci><apply id="S2.SS2.p1.1.m1.1.1.3.cmml" xref="S2.SS2.p1.1.m1.1.1.3"><times id="S2.SS2.p1.1.m1.1.1.3.1.cmml" xref="S2.SS2.p1.1.m1.1.1.3.1"></times><ci id="S2.SS2.p1.1.m1.1.1.3.2.cmml" xref="S2.SS2.p1.1.m1.1.1.3.2">𝑡</ci><ci id="S2.SS2.p1.1.m1.1.1.3.3.cmml" xref="S2.SS2.p1.1.m1.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.1.m1.1c">l^{th}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.1.m1.1d">italic_l start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> layer as an illustrative example for processing the <math alttext="k^{th}" class="ltx_Math" display="inline" id="S2.SS2.p1.2.m2.1"><semantics id="S2.SS2.p1.2.m2.1a"><msup id="S2.SS2.p1.2.m2.1.1" xref="S2.SS2.p1.2.m2.1.1.cmml"><mi id="S2.SS2.p1.2.m2.1.1.2" xref="S2.SS2.p1.2.m2.1.1.2.cmml">k</mi><mrow id="S2.SS2.p1.2.m2.1.1.3" xref="S2.SS2.p1.2.m2.1.1.3.cmml"><mi id="S2.SS2.p1.2.m2.1.1.3.2" xref="S2.SS2.p1.2.m2.1.1.3.2.cmml">t</mi><mo id="S2.SS2.p1.2.m2.1.1.3.1" xref="S2.SS2.p1.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S2.SS2.p1.2.m2.1.1.3.3" xref="S2.SS2.p1.2.m2.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.2.m2.1b"><apply id="S2.SS2.p1.2.m2.1.1.cmml" xref="S2.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.2.m2.1.1.1.cmml" xref="S2.SS2.p1.2.m2.1.1">superscript</csymbol><ci id="S2.SS2.p1.2.m2.1.1.2.cmml" xref="S2.SS2.p1.2.m2.1.1.2">𝑘</ci><apply id="S2.SS2.p1.2.m2.1.1.3.cmml" xref="S2.SS2.p1.2.m2.1.1.3"><times id="S2.SS2.p1.2.m2.1.1.3.1.cmml" xref="S2.SS2.p1.2.m2.1.1.3.1"></times><ci id="S2.SS2.p1.2.m2.1.1.3.2.cmml" xref="S2.SS2.p1.2.m2.1.1.3.2">𝑡</ci><ci id="S2.SS2.p1.2.m2.1.1.3.3.cmml" xref="S2.SS2.p1.2.m2.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.2.m2.1c">k^{th}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.2.m2.1d">italic_k start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> context window.
The short-term layer serves a dual purpose: (a) transforming context tokens <math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p1.3.m3.1"><semantics id="S2.SS2.p1.3.m3.1a"><msubsup id="S2.SS2.p1.3.m3.1.1" xref="S2.SS2.p1.3.m3.1.1.cmml"><mi id="S2.SS2.p1.3.m3.1.1.2.2" xref="S2.SS2.p1.3.m3.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p1.3.m3.1.1.2.3" xref="S2.SS2.p1.3.m3.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p1.3.m3.1.1.3" xref="S2.SS2.p1.3.m3.1.1.3.cmml"><mi id="S2.SS2.p1.3.m3.1.1.3.2" xref="S2.SS2.p1.3.m3.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p1.3.m3.1.1.3.1" xref="S2.SS2.p1.3.m3.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p1.3.m3.1.1.3.3" xref="S2.SS2.p1.3.m3.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.3.m3.1b"><apply id="S2.SS2.p1.3.m3.1.1.cmml" xref="S2.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.3.m3.1.1.1.cmml" xref="S2.SS2.p1.3.m3.1.1">superscript</csymbol><apply id="S2.SS2.p1.3.m3.1.1.2.cmml" xref="S2.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.3.m3.1.1.2.1.cmml" xref="S2.SS2.p1.3.m3.1.1">subscript</csymbol><ci id="S2.SS2.p1.3.m3.1.1.2.2.cmml" xref="S2.SS2.p1.3.m3.1.1.2.2">𝑥</ci><ci id="S2.SS2.p1.3.m3.1.1.2.3.cmml" xref="S2.SS2.p1.3.m3.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p1.3.m3.1.1.3.cmml" xref="S2.SS2.p1.3.m3.1.1.3"><minus id="S2.SS2.p1.3.m3.1.1.3.1.cmml" xref="S2.SS2.p1.3.m3.1.1.3.1"></minus><ci id="S2.SS2.p1.3.m3.1.1.3.2.cmml" xref="S2.SS2.p1.3.m3.1.1.3.2">𝑙</ci><cn id="S2.SS2.p1.3.m3.1.1.3.3.cmml" type="integer" xref="S2.SS2.p1.3.m3.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.3.m3.1c">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.3.m3.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> via a transformer block (yielding output <math alttext="x_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p1.4.m4.1"><semantics id="S2.SS2.p1.4.m4.1a"><msubsup id="S2.SS2.p1.4.m4.1.1" xref="S2.SS2.p1.4.m4.1.1.cmml"><mi id="S2.SS2.p1.4.m4.1.1.2.2" xref="S2.SS2.p1.4.m4.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p1.4.m4.1.1.2.3" xref="S2.SS2.p1.4.m4.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p1.4.m4.1.1.3" xref="S2.SS2.p1.4.m4.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.4.m4.1b"><apply id="S2.SS2.p1.4.m4.1.1.cmml" xref="S2.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.4.m4.1.1.1.cmml" xref="S2.SS2.p1.4.m4.1.1">superscript</csymbol><apply id="S2.SS2.p1.4.m4.1.1.2.cmml" xref="S2.SS2.p1.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.4.m4.1.1.2.1.cmml" xref="S2.SS2.p1.4.m4.1.1">subscript</csymbol><ci id="S2.SS2.p1.4.m4.1.1.2.2.cmml" xref="S2.SS2.p1.4.m4.1.1.2.2">𝑥</ci><ci id="S2.SS2.p1.4.m4.1.1.2.3.cmml" xref="S2.SS2.p1.4.m4.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p1.4.m4.1.1.3.cmml" xref="S2.SS2.p1.4.m4.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.4.m4.1c">x_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.4.m4.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>), and (b) recurrently compressing the current context window into the short-term memory <math alttext="z_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p1.5.m5.1"><semantics id="S2.SS2.p1.5.m5.1a"><msubsup id="S2.SS2.p1.5.m5.1.1" xref="S2.SS2.p1.5.m5.1.1.cmml"><mi id="S2.SS2.p1.5.m5.1.1.2.2" xref="S2.SS2.p1.5.m5.1.1.2.2.cmml">z</mi><mi id="S2.SS2.p1.5.m5.1.1.2.3" xref="S2.SS2.p1.5.m5.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p1.5.m5.1.1.3" xref="S2.SS2.p1.5.m5.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.5.m5.1b"><apply id="S2.SS2.p1.5.m5.1.1.cmml" xref="S2.SS2.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.5.m5.1.1.1.cmml" xref="S2.SS2.p1.5.m5.1.1">superscript</csymbol><apply id="S2.SS2.p1.5.m5.1.1.2.cmml" xref="S2.SS2.p1.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.5.m5.1.1.2.1.cmml" xref="S2.SS2.p1.5.m5.1.1">subscript</csymbol><ci id="S2.SS2.p1.5.m5.1.1.2.2.cmml" xref="S2.SS2.p1.5.m5.1.1.2.2">𝑧</ci><ci id="S2.SS2.p1.5.m5.1.1.2.3.cmml" xref="S2.SS2.p1.5.m5.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p1.5.m5.1.1.3.cmml" xref="S2.SS2.p1.5.m5.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.5.m5.1c">z_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.5.m5.1d">italic_z start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>. It accomplishes this by updating both context tokens and short-term memory through a shared transformer block, albeit along separate pathways. As visualized in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2.F2" title="Figure 2 ‣ 2.2 Short-Term Memory: Multi-Layer Recurrent Compression ‣ 2 Our Method: Melodi ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">2</span></a>, context tokens traverse vertically across layers (from <math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p1.6.m6.1"><semantics id="S2.SS2.p1.6.m6.1a"><msubsup id="S2.SS2.p1.6.m6.1.1" xref="S2.SS2.p1.6.m6.1.1.cmml"><mi id="S2.SS2.p1.6.m6.1.1.2.2" xref="S2.SS2.p1.6.m6.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p1.6.m6.1.1.2.3" xref="S2.SS2.p1.6.m6.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p1.6.m6.1.1.3" xref="S2.SS2.p1.6.m6.1.1.3.cmml"><mi id="S2.SS2.p1.6.m6.1.1.3.2" xref="S2.SS2.p1.6.m6.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p1.6.m6.1.1.3.1" xref="S2.SS2.p1.6.m6.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p1.6.m6.1.1.3.3" xref="S2.SS2.p1.6.m6.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.6.m6.1b"><apply id="S2.SS2.p1.6.m6.1.1.cmml" xref="S2.SS2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.6.m6.1.1.1.cmml" xref="S2.SS2.p1.6.m6.1.1">superscript</csymbol><apply id="S2.SS2.p1.6.m6.1.1.2.cmml" xref="S2.SS2.p1.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.6.m6.1.1.2.1.cmml" xref="S2.SS2.p1.6.m6.1.1">subscript</csymbol><ci id="S2.SS2.p1.6.m6.1.1.2.2.cmml" xref="S2.SS2.p1.6.m6.1.1.2.2">𝑥</ci><ci id="S2.SS2.p1.6.m6.1.1.2.3.cmml" xref="S2.SS2.p1.6.m6.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p1.6.m6.1.1.3.cmml" xref="S2.SS2.p1.6.m6.1.1.3"><minus id="S2.SS2.p1.6.m6.1.1.3.1.cmml" xref="S2.SS2.p1.6.m6.1.1.3.1"></minus><ci id="S2.SS2.p1.6.m6.1.1.3.2.cmml" xref="S2.SS2.p1.6.m6.1.1.3.2">𝑙</ci><cn id="S2.SS2.p1.6.m6.1.1.3.3.cmml" type="integer" xref="S2.SS2.p1.6.m6.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.6.m6.1c">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.6.m6.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> to <math alttext="x_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p1.7.m7.1"><semantics id="S2.SS2.p1.7.m7.1a"><msubsup id="S2.SS2.p1.7.m7.1.1" xref="S2.SS2.p1.7.m7.1.1.cmml"><mi id="S2.SS2.p1.7.m7.1.1.2.2" xref="S2.SS2.p1.7.m7.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p1.7.m7.1.1.2.3" xref="S2.SS2.p1.7.m7.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p1.7.m7.1.1.3" xref="S2.SS2.p1.7.m7.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.7.m7.1b"><apply id="S2.SS2.p1.7.m7.1.1.cmml" xref="S2.SS2.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.7.m7.1.1.1.cmml" xref="S2.SS2.p1.7.m7.1.1">superscript</csymbol><apply id="S2.SS2.p1.7.m7.1.1.2.cmml" xref="S2.SS2.p1.7.m7.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.7.m7.1.1.2.1.cmml" xref="S2.SS2.p1.7.m7.1.1">subscript</csymbol><ci id="S2.SS2.p1.7.m7.1.1.2.2.cmml" xref="S2.SS2.p1.7.m7.1.1.2.2">𝑥</ci><ci id="S2.SS2.p1.7.m7.1.1.2.3.cmml" xref="S2.SS2.p1.7.m7.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p1.7.m7.1.1.3.cmml" xref="S2.SS2.p1.7.m7.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.7.m7.1c">x_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.7.m7.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>), whereas short-term memory flows horizontally across context windows (from <math alttext="z_{k-1}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p1.8.m8.1"><semantics id="S2.SS2.p1.8.m8.1a"><msubsup id="S2.SS2.p1.8.m8.1.1" xref="S2.SS2.p1.8.m8.1.1.cmml"><mi id="S2.SS2.p1.8.m8.1.1.2.2" xref="S2.SS2.p1.8.m8.1.1.2.2.cmml">z</mi><mrow id="S2.SS2.p1.8.m8.1.1.2.3" xref="S2.SS2.p1.8.m8.1.1.2.3.cmml"><mi id="S2.SS2.p1.8.m8.1.1.2.3.2" xref="S2.SS2.p1.8.m8.1.1.2.3.2.cmml">k</mi><mo id="S2.SS2.p1.8.m8.1.1.2.3.1" xref="S2.SS2.p1.8.m8.1.1.2.3.1.cmml">−</mo><mn id="S2.SS2.p1.8.m8.1.1.2.3.3" xref="S2.SS2.p1.8.m8.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.SS2.p1.8.m8.1.1.3" xref="S2.SS2.p1.8.m8.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.8.m8.1b"><apply id="S2.SS2.p1.8.m8.1.1.cmml" xref="S2.SS2.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.8.m8.1.1.1.cmml" xref="S2.SS2.p1.8.m8.1.1">superscript</csymbol><apply id="S2.SS2.p1.8.m8.1.1.2.cmml" xref="S2.SS2.p1.8.m8.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.8.m8.1.1.2.1.cmml" xref="S2.SS2.p1.8.m8.1.1">subscript</csymbol><ci id="S2.SS2.p1.8.m8.1.1.2.2.cmml" xref="S2.SS2.p1.8.m8.1.1.2.2">𝑧</ci><apply id="S2.SS2.p1.8.m8.1.1.2.3.cmml" xref="S2.SS2.p1.8.m8.1.1.2.3"><minus id="S2.SS2.p1.8.m8.1.1.2.3.1.cmml" xref="S2.SS2.p1.8.m8.1.1.2.3.1"></minus><ci id="S2.SS2.p1.8.m8.1.1.2.3.2.cmml" xref="S2.SS2.p1.8.m8.1.1.2.3.2">𝑘</ci><cn id="S2.SS2.p1.8.m8.1.1.2.3.3.cmml" type="integer" xref="S2.SS2.p1.8.m8.1.1.2.3.3">1</cn></apply></apply><ci id="S2.SS2.p1.8.m8.1.1.3.cmml" xref="S2.SS2.p1.8.m8.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.8.m8.1c">z_{k-1}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.8.m8.1d">italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> to <math alttext="z_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p1.9.m9.1"><semantics id="S2.SS2.p1.9.m9.1a"><msubsup id="S2.SS2.p1.9.m9.1.1" xref="S2.SS2.p1.9.m9.1.1.cmml"><mi id="S2.SS2.p1.9.m9.1.1.2.2" xref="S2.SS2.p1.9.m9.1.1.2.2.cmml">z</mi><mi id="S2.SS2.p1.9.m9.1.1.2.3" xref="S2.SS2.p1.9.m9.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p1.9.m9.1.1.3" xref="S2.SS2.p1.9.m9.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.9.m9.1b"><apply id="S2.SS2.p1.9.m9.1.1.cmml" xref="S2.SS2.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.9.m9.1.1.1.cmml" xref="S2.SS2.p1.9.m9.1.1">superscript</csymbol><apply id="S2.SS2.p1.9.m9.1.1.2.cmml" xref="S2.SS2.p1.9.m9.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.9.m9.1.1.2.1.cmml" xref="S2.SS2.p1.9.m9.1.1">subscript</csymbol><ci id="S2.SS2.p1.9.m9.1.1.2.2.cmml" xref="S2.SS2.p1.9.m9.1.1.2.2">𝑧</ci><ci id="S2.SS2.p1.9.m9.1.1.2.3.cmml" xref="S2.SS2.p1.9.m9.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p1.9.m9.1.1.3.cmml" xref="S2.SS2.p1.9.m9.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.9.m9.1c">z_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.9.m9.1d">italic_z start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>). To enable inter-layer communication within the short-term memory, we introduce summary tokens <math alttext="u_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p1.10.m10.1"><semantics id="S2.SS2.p1.10.m10.1a"><msubsup id="S2.SS2.p1.10.m10.1.1" xref="S2.SS2.p1.10.m10.1.1.cmml"><mi id="S2.SS2.p1.10.m10.1.1.2.2" xref="S2.SS2.p1.10.m10.1.1.2.2.cmml">u</mi><mi id="S2.SS2.p1.10.m10.1.1.2.3" xref="S2.SS2.p1.10.m10.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p1.10.m10.1.1.3" xref="S2.SS2.p1.10.m10.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p1.10.m10.1b"><apply id="S2.SS2.p1.10.m10.1.1.cmml" xref="S2.SS2.p1.10.m10.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.10.m10.1.1.1.cmml" xref="S2.SS2.p1.10.m10.1.1">superscript</csymbol><apply id="S2.SS2.p1.10.m10.1.1.2.cmml" xref="S2.SS2.p1.10.m10.1.1"><csymbol cd="ambiguous" id="S2.SS2.p1.10.m10.1.1.2.1.cmml" xref="S2.SS2.p1.10.m10.1.1">subscript</csymbol><ci id="S2.SS2.p1.10.m10.1.1.2.2.cmml" xref="S2.SS2.p1.10.m10.1.1.2.2">𝑢</ci><ci id="S2.SS2.p1.10.m10.1.1.2.3.cmml" xref="S2.SS2.p1.10.m10.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p1.10.m10.1.1.3.cmml" xref="S2.SS2.p1.10.m10.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p1.10.m10.1c">u_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p1.10.m10.1d">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> that propagate through the layers. We elaborate on the key components below.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS2.p2">
<p class="ltx_p" id="S2.SS2.p2.2"><span class="ltx_text ltx_font_bold" id="S2.SS2.p2.1.1">Short-term memory <math alttext="z_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p2.1.1.m1.1"><semantics id="S2.SS2.p2.1.1.m1.1a"><msubsup id="S2.SS2.p2.1.1.m1.1.1" xref="S2.SS2.p2.1.1.m1.1.1.cmml"><mi id="S2.SS2.p2.1.1.m1.1.1.2.2" xref="S2.SS2.p2.1.1.m1.1.1.2.2.cmml">z</mi><mi id="S2.SS2.p2.1.1.m1.1.1.2.3" xref="S2.SS2.p2.1.1.m1.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p2.1.1.m1.1.1.3" xref="S2.SS2.p2.1.1.m1.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p2.1.1.m1.1b"><apply id="S2.SS2.p2.1.1.m1.1.1.cmml" xref="S2.SS2.p2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p2.1.1.m1.1.1.1.cmml" xref="S2.SS2.p2.1.1.m1.1.1">superscript</csymbol><apply id="S2.SS2.p2.1.1.m1.1.1.2.cmml" xref="S2.SS2.p2.1.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p2.1.1.m1.1.1.2.1.cmml" xref="S2.SS2.p2.1.1.m1.1.1">subscript</csymbol><ci id="S2.SS2.p2.1.1.m1.1.1.2.2.cmml" xref="S2.SS2.p2.1.1.m1.1.1.2.2">𝑧</ci><ci id="S2.SS2.p2.1.1.m1.1.1.2.3.cmml" xref="S2.SS2.p2.1.1.m1.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p2.1.1.m1.1.1.3.cmml" xref="S2.SS2.p2.1.1.m1.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p2.1.1.m1.1c">z_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p2.1.1.m1.1d">italic_z start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>:</span>
The short-term memory (illustrated in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2.F2" title="Figure 2 ‣ 2.2 Short-Term Memory: Multi-Layer Recurrent Compression ‣ 2 Our Method: Melodi ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">2</span></a>) is implemented as a sequence of vectors with length <math alttext="S" class="ltx_Math" display="inline" id="S2.SS2.p2.2.m1.1"><semantics id="S2.SS2.p2.2.m1.1a"><mi id="S2.SS2.p2.2.m1.1.1" xref="S2.SS2.p2.2.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p2.2.m1.1b"><ci id="S2.SS2.p2.2.m1.1.1.cmml" xref="S2.SS2.p2.2.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p2.2.m1.1c">S</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p2.2.m1.1d">italic_S</annotation></semantics></math>, each having the same dimensionality as context tokens (e.g., 1024 channels). Notably, the number of short-term memory vectors is substantially smaller than the length of the context window (e.g., 128 memory tokens per window of 512 context tokens). Within each context window, the short-term memory serves initially as a previous context for auto-regressive prediction of subsequent context tokens (except for the first window in which the short-term memory is empty). It is then updated by compressing and incorporating information from the context tokens within the current window.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS2.p3">
<p class="ltx_p" id="S2.SS2.p3.4"><span class="ltx_text ltx_font_bold" id="S2.SS2.p3.4.1">Transforming context tokens:</span>
The context tokens <math alttext="x_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p3.1.m1.1"><semantics id="S2.SS2.p3.1.m1.1a"><msubsup id="S2.SS2.p3.1.m1.1.1" xref="S2.SS2.p3.1.m1.1.1.cmml"><mi id="S2.SS2.p3.1.m1.1.1.2.2" xref="S2.SS2.p3.1.m1.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p3.1.m1.1.1.2.3" xref="S2.SS2.p3.1.m1.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p3.1.m1.1.1.3" xref="S2.SS2.p3.1.m1.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p3.1.m1.1b"><apply id="S2.SS2.p3.1.m1.1.1.cmml" xref="S2.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p3.1.m1.1.1.1.cmml" xref="S2.SS2.p3.1.m1.1.1">superscript</csymbol><apply id="S2.SS2.p3.1.m1.1.1.2.cmml" xref="S2.SS2.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p3.1.m1.1.1.2.1.cmml" xref="S2.SS2.p3.1.m1.1.1">subscript</csymbol><ci id="S2.SS2.p3.1.m1.1.1.2.2.cmml" xref="S2.SS2.p3.1.m1.1.1.2.2">𝑥</ci><ci id="S2.SS2.p3.1.m1.1.1.2.3.cmml" xref="S2.SS2.p3.1.m1.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p3.1.m1.1.1.3.cmml" xref="S2.SS2.p3.1.m1.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p3.1.m1.1c">x_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p3.1.m1.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> are generated through causal attention to both (a) the preceding short-term memory <math alttext="z_{k-1}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p3.2.m2.1"><semantics id="S2.SS2.p3.2.m2.1a"><msubsup id="S2.SS2.p3.2.m2.1.1" xref="S2.SS2.p3.2.m2.1.1.cmml"><mi id="S2.SS2.p3.2.m2.1.1.2.2" xref="S2.SS2.p3.2.m2.1.1.2.2.cmml">z</mi><mrow id="S2.SS2.p3.2.m2.1.1.2.3" xref="S2.SS2.p3.2.m2.1.1.2.3.cmml"><mi id="S2.SS2.p3.2.m2.1.1.2.3.2" xref="S2.SS2.p3.2.m2.1.1.2.3.2.cmml">k</mi><mo id="S2.SS2.p3.2.m2.1.1.2.3.1" xref="S2.SS2.p3.2.m2.1.1.2.3.1.cmml">−</mo><mn id="S2.SS2.p3.2.m2.1.1.2.3.3" xref="S2.SS2.p3.2.m2.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.SS2.p3.2.m2.1.1.3" xref="S2.SS2.p3.2.m2.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p3.2.m2.1b"><apply id="S2.SS2.p3.2.m2.1.1.cmml" xref="S2.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS2.p3.2.m2.1.1.1.cmml" xref="S2.SS2.p3.2.m2.1.1">superscript</csymbol><apply id="S2.SS2.p3.2.m2.1.1.2.cmml" xref="S2.SS2.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS2.p3.2.m2.1.1.2.1.cmml" xref="S2.SS2.p3.2.m2.1.1">subscript</csymbol><ci id="S2.SS2.p3.2.m2.1.1.2.2.cmml" xref="S2.SS2.p3.2.m2.1.1.2.2">𝑧</ci><apply id="S2.SS2.p3.2.m2.1.1.2.3.cmml" xref="S2.SS2.p3.2.m2.1.1.2.3"><minus id="S2.SS2.p3.2.m2.1.1.2.3.1.cmml" xref="S2.SS2.p3.2.m2.1.1.2.3.1"></minus><ci id="S2.SS2.p3.2.m2.1.1.2.3.2.cmml" xref="S2.SS2.p3.2.m2.1.1.2.3.2">𝑘</ci><cn id="S2.SS2.p3.2.m2.1.1.2.3.3.cmml" type="integer" xref="S2.SS2.p3.2.m2.1.1.2.3.3">1</cn></apply></apply><ci id="S2.SS2.p3.2.m2.1.1.3.cmml" xref="S2.SS2.p3.2.m2.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p3.2.m2.1c">z_{k-1}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p3.2.m2.1d">italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> and (b) preceding tokens within the current context window. This attention mechanism is followed by the application of a feed-forward network (FFN). Relative position embeddings are employed for both the context tokens <math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p3.3.m3.1"><semantics id="S2.SS2.p3.3.m3.1a"><msubsup id="S2.SS2.p3.3.m3.1.1" xref="S2.SS2.p3.3.m3.1.1.cmml"><mi id="S2.SS2.p3.3.m3.1.1.2.2" xref="S2.SS2.p3.3.m3.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p3.3.m3.1.1.2.3" xref="S2.SS2.p3.3.m3.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p3.3.m3.1.1.3" xref="S2.SS2.p3.3.m3.1.1.3.cmml"><mi id="S2.SS2.p3.3.m3.1.1.3.2" xref="S2.SS2.p3.3.m3.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p3.3.m3.1.1.3.1" xref="S2.SS2.p3.3.m3.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p3.3.m3.1.1.3.3" xref="S2.SS2.p3.3.m3.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p3.3.m3.1b"><apply id="S2.SS2.p3.3.m3.1.1.cmml" xref="S2.SS2.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.p3.3.m3.1.1.1.cmml" xref="S2.SS2.p3.3.m3.1.1">superscript</csymbol><apply id="S2.SS2.p3.3.m3.1.1.2.cmml" xref="S2.SS2.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.p3.3.m3.1.1.2.1.cmml" xref="S2.SS2.p3.3.m3.1.1">subscript</csymbol><ci id="S2.SS2.p3.3.m3.1.1.2.2.cmml" xref="S2.SS2.p3.3.m3.1.1.2.2">𝑥</ci><ci id="S2.SS2.p3.3.m3.1.1.2.3.cmml" xref="S2.SS2.p3.3.m3.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p3.3.m3.1.1.3.cmml" xref="S2.SS2.p3.3.m3.1.1.3"><minus id="S2.SS2.p3.3.m3.1.1.3.1.cmml" xref="S2.SS2.p3.3.m3.1.1.3.1"></minus><ci id="S2.SS2.p3.3.m3.1.1.3.2.cmml" xref="S2.SS2.p3.3.m3.1.1.3.2">𝑙</ci><cn id="S2.SS2.p3.3.m3.1.1.3.3.cmml" type="integer" xref="S2.SS2.p3.3.m3.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p3.3.m3.1c">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p3.3.m3.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> and the preceding short-term memory <math alttext="z_{k-1}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p3.4.m4.1"><semantics id="S2.SS2.p3.4.m4.1a"><msubsup id="S2.SS2.p3.4.m4.1.1" xref="S2.SS2.p3.4.m4.1.1.cmml"><mi id="S2.SS2.p3.4.m4.1.1.2.2" xref="S2.SS2.p3.4.m4.1.1.2.2.cmml">z</mi><mrow id="S2.SS2.p3.4.m4.1.1.2.3" xref="S2.SS2.p3.4.m4.1.1.2.3.cmml"><mi id="S2.SS2.p3.4.m4.1.1.2.3.2" xref="S2.SS2.p3.4.m4.1.1.2.3.2.cmml">k</mi><mo id="S2.SS2.p3.4.m4.1.1.2.3.1" xref="S2.SS2.p3.4.m4.1.1.2.3.1.cmml">−</mo><mn id="S2.SS2.p3.4.m4.1.1.2.3.3" xref="S2.SS2.p3.4.m4.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.SS2.p3.4.m4.1.1.3" xref="S2.SS2.p3.4.m4.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p3.4.m4.1b"><apply id="S2.SS2.p3.4.m4.1.1.cmml" xref="S2.SS2.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS2.p3.4.m4.1.1.1.cmml" xref="S2.SS2.p3.4.m4.1.1">superscript</csymbol><apply id="S2.SS2.p3.4.m4.1.1.2.cmml" xref="S2.SS2.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS2.p3.4.m4.1.1.2.1.cmml" xref="S2.SS2.p3.4.m4.1.1">subscript</csymbol><ci id="S2.SS2.p3.4.m4.1.1.2.2.cmml" xref="S2.SS2.p3.4.m4.1.1.2.2">𝑧</ci><apply id="S2.SS2.p3.4.m4.1.1.2.3.cmml" xref="S2.SS2.p3.4.m4.1.1.2.3"><minus id="S2.SS2.p3.4.m4.1.1.2.3.1.cmml" xref="S2.SS2.p3.4.m4.1.1.2.3.1"></minus><ci id="S2.SS2.p3.4.m4.1.1.2.3.2.cmml" xref="S2.SS2.p3.4.m4.1.1.2.3.2">𝑘</ci><cn id="S2.SS2.p3.4.m4.1.1.2.3.3.cmml" type="integer" xref="S2.SS2.p3.4.m4.1.1.2.3.3">1</cn></apply></apply><ci id="S2.SS2.p3.4.m4.1.1.3.cmml" xref="S2.SS2.p3.4.m4.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p3.4.m4.1c">z_{k-1}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p3.4.m4.1d">italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>. Mathematically, this can be represented as:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx1">
<tbody id="S2.E1"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle x_{k}^{l}=\mathcal{T}(x_{k}^{l-1}|z_{k-1}^{l})," class="ltx_Math" display="inline" id="S2.E1.m1.1"><semantics id="S2.E1.m1.1a"><mrow id="S2.E1.m1.1.1.1" xref="S2.E1.m1.1.1.1.1.cmml"><mrow id="S2.E1.m1.1.1.1.1" xref="S2.E1.m1.1.1.1.1.cmml"><msubsup id="S2.E1.m1.1.1.1.1.3" xref="S2.E1.m1.1.1.1.1.3.cmml"><mi id="S2.E1.m1.1.1.1.1.3.2.2" xref="S2.E1.m1.1.1.1.1.3.2.2.cmml">x</mi><mi id="S2.E1.m1.1.1.1.1.3.2.3" xref="S2.E1.m1.1.1.1.1.3.2.3.cmml">k</mi><mi id="S2.E1.m1.1.1.1.1.3.3" xref="S2.E1.m1.1.1.1.1.3.3.cmml">l</mi></msubsup><mo id="S2.E1.m1.1.1.1.1.2" xref="S2.E1.m1.1.1.1.1.2.cmml">=</mo><mrow id="S2.E1.m1.1.1.1.1.1" xref="S2.E1.m1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E1.m1.1.1.1.1.1.3" xref="S2.E1.m1.1.1.1.1.1.3.cmml">𝒯</mi><mo id="S2.E1.m1.1.1.1.1.1.2" xref="S2.E1.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S2.E1.m1.1.1.1.1.1.1.1" xref="S2.E1.m1.1.1.1.1.1.1.1.1.cmml"><mo id="S2.E1.m1.1.1.1.1.1.1.1.2" stretchy="false" xref="S2.E1.m1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.E1.m1.1.1.1.1.1.1.1.1" xref="S2.E1.m1.1.1.1.1.1.1.1.1.cmml"><msubsup id="S2.E1.m1.1.1.1.1.1.1.1.1.2" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.cmml"><mi id="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.2" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.2.cmml">x</mi><mi id="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.3" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.3.cmml">k</mi><mrow id="S2.E1.m1.1.1.1.1.1.1.1.1.2.3" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.cmml"><mi id="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.2" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.2.cmml">l</mi><mo id="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.1" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.1.cmml">−</mo><mn id="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.3" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.3.cmml">1</mn></mrow></msubsup><mo fence="false" id="S2.E1.m1.1.1.1.1.1.1.1.1.1" xref="S2.E1.m1.1.1.1.1.1.1.1.1.1.cmml">|</mo><msubsup id="S2.E1.m1.1.1.1.1.1.1.1.1.3" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.2" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.2.cmml">z</mi><mrow id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.cmml"><mi id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.2" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.2.cmml">k</mi><mo id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.1" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.1.cmml">−</mo><mn id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.3" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.3.cmml">1</mn></mrow><mi id="S2.E1.m1.1.1.1.1.1.1.1.1.3.3" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.3.cmml">l</mi></msubsup></mrow><mo id="S2.E1.m1.1.1.1.1.1.1.1.3" stretchy="false" xref="S2.E1.m1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E1.m1.1.1.1.2" xref="S2.E1.m1.1.1.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E1.m1.1b"><apply id="S2.E1.m1.1.1.1.1.cmml" xref="S2.E1.m1.1.1.1"><eq id="S2.E1.m1.1.1.1.1.2.cmml" xref="S2.E1.m1.1.1.1.1.2"></eq><apply id="S2.E1.m1.1.1.1.1.3.cmml" xref="S2.E1.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E1.m1.1.1.1.1.3.1.cmml" xref="S2.E1.m1.1.1.1.1.3">superscript</csymbol><apply id="S2.E1.m1.1.1.1.1.3.2.cmml" xref="S2.E1.m1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E1.m1.1.1.1.1.3.2.1.cmml" xref="S2.E1.m1.1.1.1.1.3">subscript</csymbol><ci id="S2.E1.m1.1.1.1.1.3.2.2.cmml" xref="S2.E1.m1.1.1.1.1.3.2.2">𝑥</ci><ci id="S2.E1.m1.1.1.1.1.3.2.3.cmml" xref="S2.E1.m1.1.1.1.1.3.2.3">𝑘</ci></apply><ci id="S2.E1.m1.1.1.1.1.3.3.cmml" xref="S2.E1.m1.1.1.1.1.3.3">𝑙</ci></apply><apply id="S2.E1.m1.1.1.1.1.1.cmml" xref="S2.E1.m1.1.1.1.1.1"><times id="S2.E1.m1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.1.1.1.1.1.2"></times><ci id="S2.E1.m1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.1.1.1.1.1.3">𝒯</ci><apply id="S2.E1.m1.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1"><csymbol cd="latexml" id="S2.E1.m1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.1">conditional</csymbol><apply id="S2.E1.m1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E1.m1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2">superscript</csymbol><apply id="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.1.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2">subscript</csymbol><ci id="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.2.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.2">𝑥</ci><ci id="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.3.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.2.3">𝑘</ci></apply><apply id="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.3"><minus id="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.1.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.1"></minus><ci id="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.2.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.2">𝑙</ci><cn id="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.3.cmml" type="integer" xref="S2.E1.m1.1.1.1.1.1.1.1.1.2.3.3">1</cn></apply></apply><apply id="S2.E1.m1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E1.m1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3">superscript</csymbol><apply id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.1.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.2.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.2">𝑧</ci><apply id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3"><minus id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.1.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.1"></minus><ci id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.2.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.2">𝑘</ci><cn id="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.3.cmml" type="integer" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.2.3.3">1</cn></apply></apply><ci id="S2.E1.m1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S2.E1.m1.1.1.1.1.1.1.1.1.3.3">𝑙</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E1.m1.1c">\displaystyle x_{k}^{l}=\mathcal{T}(x_{k}^{l-1}|z_{k-1}^{l}),</annotation><annotation encoding="application/x-llamapun" id="S2.E1.m1.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = caligraphic_T ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT | italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS2.p3.7">where <math alttext="\mathcal{T}(x|z)" class="ltx_Math" display="inline" id="S2.SS2.p3.5.m1.1"><semantics id="S2.SS2.p3.5.m1.1a"><mrow id="S2.SS2.p3.5.m1.1.1" xref="S2.SS2.p3.5.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p3.5.m1.1.1.3" xref="S2.SS2.p3.5.m1.1.1.3.cmml">𝒯</mi><mo id="S2.SS2.p3.5.m1.1.1.2" xref="S2.SS2.p3.5.m1.1.1.2.cmml">⁢</mo><mrow id="S2.SS2.p3.5.m1.1.1.1.1" xref="S2.SS2.p3.5.m1.1.1.1.1.1.cmml"><mo id="S2.SS2.p3.5.m1.1.1.1.1.2" stretchy="false" xref="S2.SS2.p3.5.m1.1.1.1.1.1.cmml">(</mo><mrow id="S2.SS2.p3.5.m1.1.1.1.1.1" xref="S2.SS2.p3.5.m1.1.1.1.1.1.cmml"><mi id="S2.SS2.p3.5.m1.1.1.1.1.1.2" xref="S2.SS2.p3.5.m1.1.1.1.1.1.2.cmml">x</mi><mo fence="false" id="S2.SS2.p3.5.m1.1.1.1.1.1.1" xref="S2.SS2.p3.5.m1.1.1.1.1.1.1.cmml">|</mo><mi id="S2.SS2.p3.5.m1.1.1.1.1.1.3" xref="S2.SS2.p3.5.m1.1.1.1.1.1.3.cmml">z</mi></mrow><mo id="S2.SS2.p3.5.m1.1.1.1.1.3" stretchy="false" xref="S2.SS2.p3.5.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p3.5.m1.1b"><apply id="S2.SS2.p3.5.m1.1.1.cmml" xref="S2.SS2.p3.5.m1.1.1"><times id="S2.SS2.p3.5.m1.1.1.2.cmml" xref="S2.SS2.p3.5.m1.1.1.2"></times><ci id="S2.SS2.p3.5.m1.1.1.3.cmml" xref="S2.SS2.p3.5.m1.1.1.3">𝒯</ci><apply id="S2.SS2.p3.5.m1.1.1.1.1.1.cmml" xref="S2.SS2.p3.5.m1.1.1.1.1"><csymbol cd="latexml" id="S2.SS2.p3.5.m1.1.1.1.1.1.1.cmml" xref="S2.SS2.p3.5.m1.1.1.1.1.1.1">conditional</csymbol><ci id="S2.SS2.p3.5.m1.1.1.1.1.1.2.cmml" xref="S2.SS2.p3.5.m1.1.1.1.1.1.2">𝑥</ci><ci id="S2.SS2.p3.5.m1.1.1.1.1.1.3.cmml" xref="S2.SS2.p3.5.m1.1.1.1.1.1.3">𝑧</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p3.5.m1.1c">\mathcal{T}(x|z)</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p3.5.m1.1d">caligraphic_T ( italic_x | italic_z )</annotation></semantics></math> indicates applying a transformer block on <math alttext="x" class="ltx_Math" display="inline" id="S2.SS2.p3.6.m2.1"><semantics id="S2.SS2.p3.6.m2.1a"><mi id="S2.SS2.p3.6.m2.1.1" xref="S2.SS2.p3.6.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p3.6.m2.1b"><ci id="S2.SS2.p3.6.m2.1.1.cmml" xref="S2.SS2.p3.6.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p3.6.m2.1c">x</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p3.6.m2.1d">italic_x</annotation></semantics></math> for a given preceding context <math alttext="z" class="ltx_Math" display="inline" id="S2.SS2.p3.7.m3.1"><semantics id="S2.SS2.p3.7.m3.1a"><mi id="S2.SS2.p3.7.m3.1.1" xref="S2.SS2.p3.7.m3.1.1.cmml">z</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p3.7.m3.1b"><ci id="S2.SS2.p3.7.m3.1.1.cmml" xref="S2.SS2.p3.7.m3.1.1">𝑧</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p3.7.m3.1c">z</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p3.7.m3.1d">italic_z</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS2.p4">
<p class="ltx_p" id="S2.SS2.p4.12"><span class="ltx_text ltx_font_bold" id="S2.SS2.p4.12.1">Recurrent compression:</span>
Beyond transforming context tokens, the short-term layer also recurrently compresses the current context window into short-term memory. Similar to the approach in RMT <cite class="ltx_cite ltx_citemacro_citep">(Bulatov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib2" title="">2022</a>)</cite> and AutoCompressors <cite class="ltx_cite ltx_citemacro_citep">(Chevalier et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib5" title="">2023</a>)</cite>, this compression is achieved by appending summary tokens <math alttext="u" class="ltx_Math" display="inline" id="S2.SS2.p4.1.m1.1"><semantics id="S2.SS2.p4.1.m1.1a"><mi id="S2.SS2.p4.1.m1.1.1" xref="S2.SS2.p4.1.m1.1.1.cmml">u</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.1.m1.1b"><ci id="S2.SS2.p4.1.m1.1.1.cmml" xref="S2.SS2.p4.1.m1.1.1">𝑢</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.1.m1.1c">u</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.1.m1.1d">italic_u</annotation></semantics></math> after context tokens <math alttext="x" class="ltx_Math" display="inline" id="S2.SS2.p4.2.m2.1"><semantics id="S2.SS2.p4.2.m2.1a"><mi id="S2.SS2.p4.2.m2.1.1" xref="S2.SS2.p4.2.m2.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.2.m2.1b"><ci id="S2.SS2.p4.2.m2.1.1.cmml" xref="S2.SS2.p4.2.m2.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.2.m2.1c">x</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.2.m2.1d">italic_x</annotation></semantics></math> and passing the combined sequence through the transformer block. Consequently, the resulting summary tokens compresses both the preceding short-term memory and the current context window via attentional pooling, expressed as: <math alttext="\hat{u}_{k}^{l}=\mathcal{T}(u_{k}^{l-1}|z_{k-1}^{l},x_{k}^{l-1})" class="ltx_Math" display="inline" id="S2.SS2.p4.3.m3.1"><semantics id="S2.SS2.p4.3.m3.1a"><mrow id="S2.SS2.p4.3.m3.1.1" xref="S2.SS2.p4.3.m3.1.1.cmml"><msubsup id="S2.SS2.p4.3.m3.1.1.3" xref="S2.SS2.p4.3.m3.1.1.3.cmml"><mover accent="true" id="S2.SS2.p4.3.m3.1.1.3.2.2" xref="S2.SS2.p4.3.m3.1.1.3.2.2.cmml"><mi id="S2.SS2.p4.3.m3.1.1.3.2.2.2" xref="S2.SS2.p4.3.m3.1.1.3.2.2.2.cmml">u</mi><mo id="S2.SS2.p4.3.m3.1.1.3.2.2.1" xref="S2.SS2.p4.3.m3.1.1.3.2.2.1.cmml">^</mo></mover><mi id="S2.SS2.p4.3.m3.1.1.3.2.3" xref="S2.SS2.p4.3.m3.1.1.3.2.3.cmml">k</mi><mi id="S2.SS2.p4.3.m3.1.1.3.3" xref="S2.SS2.p4.3.m3.1.1.3.3.cmml">l</mi></msubsup><mo id="S2.SS2.p4.3.m3.1.1.2" xref="S2.SS2.p4.3.m3.1.1.2.cmml">=</mo><mrow id="S2.SS2.p4.3.m3.1.1.1" xref="S2.SS2.p4.3.m3.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p4.3.m3.1.1.1.3" xref="S2.SS2.p4.3.m3.1.1.1.3.cmml">𝒯</mi><mo id="S2.SS2.p4.3.m3.1.1.1.2" xref="S2.SS2.p4.3.m3.1.1.1.2.cmml">⁢</mo><mrow id="S2.SS2.p4.3.m3.1.1.1.1.1" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.cmml"><mo id="S2.SS2.p4.3.m3.1.1.1.1.1.2" stretchy="false" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.SS2.p4.3.m3.1.1.1.1.1.1" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.cmml"><msubsup id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.cmml"><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.2" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.2.cmml">u</mi><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.3.cmml">k</mi><mrow id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.cmml"><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.2" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.2.cmml">l</mi><mo id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.1" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.1.cmml">−</mo><mn id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.3.cmml">1</mn></mrow></msubsup><mo fence="false" id="S2.SS2.p4.3.m3.1.1.1.1.1.1.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.3.cmml">|</mo><mrow id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.3.cmml"><msubsup id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.cmml"><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.2" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.2.cmml">z</mi><mrow id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.cmml"><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.2" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.2.cmml">k</mi><mo id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.1" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.1.cmml">−</mo><mn id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.3.cmml">l</mi></msubsup><mo id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.3.cmml">,</mo><msubsup id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.cmml"><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.2" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.2.cmml">x</mi><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.3.cmml">k</mi><mrow id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.cmml"><mi id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.2" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.2.cmml">l</mi><mo id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.1" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.1.cmml">−</mo><mn id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.3" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.3.cmml">1</mn></mrow></msubsup></mrow></mrow><mo id="S2.SS2.p4.3.m3.1.1.1.1.1.3" stretchy="false" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.3.m3.1b"><apply id="S2.SS2.p4.3.m3.1.1.cmml" xref="S2.SS2.p4.3.m3.1.1"><eq id="S2.SS2.p4.3.m3.1.1.2.cmml" xref="S2.SS2.p4.3.m3.1.1.2"></eq><apply id="S2.SS2.p4.3.m3.1.1.3.cmml" xref="S2.SS2.p4.3.m3.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.p4.3.m3.1.1.3.1.cmml" xref="S2.SS2.p4.3.m3.1.1.3">superscript</csymbol><apply id="S2.SS2.p4.3.m3.1.1.3.2.cmml" xref="S2.SS2.p4.3.m3.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.p4.3.m3.1.1.3.2.1.cmml" xref="S2.SS2.p4.3.m3.1.1.3">subscript</csymbol><apply id="S2.SS2.p4.3.m3.1.1.3.2.2.cmml" xref="S2.SS2.p4.3.m3.1.1.3.2.2"><ci id="S2.SS2.p4.3.m3.1.1.3.2.2.1.cmml" xref="S2.SS2.p4.3.m3.1.1.3.2.2.1">^</ci><ci id="S2.SS2.p4.3.m3.1.1.3.2.2.2.cmml" xref="S2.SS2.p4.3.m3.1.1.3.2.2.2">𝑢</ci></apply><ci id="S2.SS2.p4.3.m3.1.1.3.2.3.cmml" xref="S2.SS2.p4.3.m3.1.1.3.2.3">𝑘</ci></apply><ci id="S2.SS2.p4.3.m3.1.1.3.3.cmml" xref="S2.SS2.p4.3.m3.1.1.3.3">𝑙</ci></apply><apply id="S2.SS2.p4.3.m3.1.1.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1"><times id="S2.SS2.p4.3.m3.1.1.1.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.2"></times><ci id="S2.SS2.p4.3.m3.1.1.1.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.3">𝒯</ci><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1"><csymbol cd="latexml" id="S2.SS2.p4.3.m3.1.1.1.1.1.1.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.3">conditional</csymbol><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4">superscript</csymbol><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4">subscript</csymbol><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.2">𝑢</ci><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3"><minus id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.1"></minus><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.2">𝑙</ci><cn id="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.3.cmml" type="integer" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.4.3.3">1</cn></apply></apply><list id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2"><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1">superscript</csymbol><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.2">𝑧</ci><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3"><minus id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.1"></minus><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.2">𝑘</ci><cn id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.3.cmml" type="integer" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.2.3.3">1</cn></apply></apply><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.1.1.1.3">𝑙</ci></apply><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2">superscript</csymbol><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2">subscript</csymbol><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.2">𝑥</ci><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3"><minus id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.1.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.1"></minus><ci id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.2.cmml" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.2">𝑙</ci><cn id="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.3.cmml" type="integer" xref="S2.SS2.p4.3.m3.1.1.1.1.1.1.2.2.2.3.3">1</cn></apply></apply></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.3.m3.1c">\hat{u}_{k}^{l}=\mathcal{T}(u_{k}^{l-1}|z_{k-1}^{l},x_{k}^{l-1})</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.3.m3.1d">over^ start_ARG italic_u end_ARG start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = caligraphic_T ( italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT | italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT , italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT )</annotation></semantics></math>, where the input summary tokens <math alttext="u_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p4.4.m4.1"><semantics id="S2.SS2.p4.4.m4.1a"><msubsup id="S2.SS2.p4.4.m4.1.1" xref="S2.SS2.p4.4.m4.1.1.cmml"><mi id="S2.SS2.p4.4.m4.1.1.2.2" xref="S2.SS2.p4.4.m4.1.1.2.2.cmml">u</mi><mi id="S2.SS2.p4.4.m4.1.1.2.3" xref="S2.SS2.p4.4.m4.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p4.4.m4.1.1.3" xref="S2.SS2.p4.4.m4.1.1.3.cmml"><mi id="S2.SS2.p4.4.m4.1.1.3.2" xref="S2.SS2.p4.4.m4.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p4.4.m4.1.1.3.1" xref="S2.SS2.p4.4.m4.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p4.4.m4.1.1.3.3" xref="S2.SS2.p4.4.m4.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.4.m4.1b"><apply id="S2.SS2.p4.4.m4.1.1.cmml" xref="S2.SS2.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.4.m4.1.1.1.cmml" xref="S2.SS2.p4.4.m4.1.1">superscript</csymbol><apply id="S2.SS2.p4.4.m4.1.1.2.cmml" xref="S2.SS2.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.4.m4.1.1.2.1.cmml" xref="S2.SS2.p4.4.m4.1.1">subscript</csymbol><ci id="S2.SS2.p4.4.m4.1.1.2.2.cmml" xref="S2.SS2.p4.4.m4.1.1.2.2">𝑢</ci><ci id="S2.SS2.p4.4.m4.1.1.2.3.cmml" xref="S2.SS2.p4.4.m4.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.4.m4.1.1.3.cmml" xref="S2.SS2.p4.4.m4.1.1.3"><minus id="S2.SS2.p4.4.m4.1.1.3.1.cmml" xref="S2.SS2.p4.4.m4.1.1.3.1"></minus><ci id="S2.SS2.p4.4.m4.1.1.3.2.cmml" xref="S2.SS2.p4.4.m4.1.1.3.2">𝑙</ci><cn id="S2.SS2.p4.4.m4.1.1.3.3.cmml" type="integer" xref="S2.SS2.p4.4.m4.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.4.m4.1c">u_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.4.m4.1d">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> originate from the previous layer (refer to Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2.F2" title="Figure 2 ‣ 2.2 Short-Term Memory: Multi-Layer Recurrent Compression ‣ 2 Our Method: Melodi ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">2</span></a>). We use <math alttext="\hat{u}_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p4.5.m5.1"><semantics id="S2.SS2.p4.5.m5.1a"><msubsup id="S2.SS2.p4.5.m5.1.1" xref="S2.SS2.p4.5.m5.1.1.cmml"><mover accent="true" id="S2.SS2.p4.5.m5.1.1.2.2" xref="S2.SS2.p4.5.m5.1.1.2.2.cmml"><mi id="S2.SS2.p4.5.m5.1.1.2.2.2" xref="S2.SS2.p4.5.m5.1.1.2.2.2.cmml">u</mi><mo id="S2.SS2.p4.5.m5.1.1.2.2.1" xref="S2.SS2.p4.5.m5.1.1.2.2.1.cmml">^</mo></mover><mi id="S2.SS2.p4.5.m5.1.1.2.3" xref="S2.SS2.p4.5.m5.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p4.5.m5.1.1.3" xref="S2.SS2.p4.5.m5.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.5.m5.1b"><apply id="S2.SS2.p4.5.m5.1.1.cmml" xref="S2.SS2.p4.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.5.m5.1.1.1.cmml" xref="S2.SS2.p4.5.m5.1.1">superscript</csymbol><apply id="S2.SS2.p4.5.m5.1.1.2.cmml" xref="S2.SS2.p4.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.5.m5.1.1.2.1.cmml" xref="S2.SS2.p4.5.m5.1.1">subscript</csymbol><apply id="S2.SS2.p4.5.m5.1.1.2.2.cmml" xref="S2.SS2.p4.5.m5.1.1.2.2"><ci id="S2.SS2.p4.5.m5.1.1.2.2.1.cmml" xref="S2.SS2.p4.5.m5.1.1.2.2.1">^</ci><ci id="S2.SS2.p4.5.m5.1.1.2.2.2.cmml" xref="S2.SS2.p4.5.m5.1.1.2.2.2">𝑢</ci></apply><ci id="S2.SS2.p4.5.m5.1.1.2.3.cmml" xref="S2.SS2.p4.5.m5.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p4.5.m5.1.1.3.cmml" xref="S2.SS2.p4.5.m5.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.5.m5.1c">\hat{u}_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.5.m5.1d">over^ start_ARG italic_u end_ARG start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> (instead of <math alttext="u_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p4.6.m6.1"><semantics id="S2.SS2.p4.6.m6.1a"><msubsup id="S2.SS2.p4.6.m6.1.1" xref="S2.SS2.p4.6.m6.1.1.cmml"><mi id="S2.SS2.p4.6.m6.1.1.2.2" xref="S2.SS2.p4.6.m6.1.1.2.2.cmml">u</mi><mi id="S2.SS2.p4.6.m6.1.1.2.3" xref="S2.SS2.p4.6.m6.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p4.6.m6.1.1.3" xref="S2.SS2.p4.6.m6.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.6.m6.1b"><apply id="S2.SS2.p4.6.m6.1.1.cmml" xref="S2.SS2.p4.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.6.m6.1.1.1.cmml" xref="S2.SS2.p4.6.m6.1.1">superscript</csymbol><apply id="S2.SS2.p4.6.m6.1.1.2.cmml" xref="S2.SS2.p4.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.6.m6.1.1.2.1.cmml" xref="S2.SS2.p4.6.m6.1.1">subscript</csymbol><ci id="S2.SS2.p4.6.m6.1.1.2.2.cmml" xref="S2.SS2.p4.6.m6.1.1.2.2">𝑢</ci><ci id="S2.SS2.p4.6.m6.1.1.2.3.cmml" xref="S2.SS2.p4.6.m6.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p4.6.m6.1.1.3.cmml" xref="S2.SS2.p4.6.m6.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.6.m6.1c">u_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.6.m6.1d">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>) to denote an intermediate result that is further processed in the subsequent summary branching step. In practice, both context and summary tokens can be updated simultaneously within a single transformer operation: <math alttext="x_{k}^{l},\hat{u}_{k}^{l}=\mathcal{T}(x_{k}^{l-1},u_{k}^{l-1}|z_{k-1}^{l})" class="ltx_Math" display="inline" id="S2.SS2.p4.7.m7.4"><semantics id="S2.SS2.p4.7.m7.4a"><mrow id="S2.SS2.p4.7.m7.4.4" xref="S2.SS2.p4.7.m7.4.4.cmml"><mrow id="S2.SS2.p4.7.m7.2.2.2.2" xref="S2.SS2.p4.7.m7.2.2.2.3.cmml"><msubsup id="S2.SS2.p4.7.m7.1.1.1.1.1" xref="S2.SS2.p4.7.m7.1.1.1.1.1.cmml"><mi id="S2.SS2.p4.7.m7.1.1.1.1.1.2.2" xref="S2.SS2.p4.7.m7.1.1.1.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p4.7.m7.1.1.1.1.1.2.3" xref="S2.SS2.p4.7.m7.1.1.1.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p4.7.m7.1.1.1.1.1.3" xref="S2.SS2.p4.7.m7.1.1.1.1.1.3.cmml">l</mi></msubsup><mo id="S2.SS2.p4.7.m7.2.2.2.2.3" xref="S2.SS2.p4.7.m7.2.2.2.3.cmml">,</mo><msubsup id="S2.SS2.p4.7.m7.2.2.2.2.2" xref="S2.SS2.p4.7.m7.2.2.2.2.2.cmml"><mover accent="true" id="S2.SS2.p4.7.m7.2.2.2.2.2.2.2" xref="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.cmml"><mi id="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.2" xref="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.2.cmml">u</mi><mo id="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.1" xref="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.1.cmml">^</mo></mover><mi id="S2.SS2.p4.7.m7.2.2.2.2.2.2.3" xref="S2.SS2.p4.7.m7.2.2.2.2.2.2.3.cmml">k</mi><mi id="S2.SS2.p4.7.m7.2.2.2.2.2.3" xref="S2.SS2.p4.7.m7.2.2.2.2.2.3.cmml">l</mi></msubsup></mrow><mo id="S2.SS2.p4.7.m7.4.4.5" xref="S2.SS2.p4.7.m7.4.4.5.cmml">=</mo><mrow id="S2.SS2.p4.7.m7.4.4.4" xref="S2.SS2.p4.7.m7.4.4.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p4.7.m7.4.4.4.4" xref="S2.SS2.p4.7.m7.4.4.4.4.cmml">𝒯</mi><mo id="S2.SS2.p4.7.m7.4.4.4.3" xref="S2.SS2.p4.7.m7.4.4.4.3.cmml">⁢</mo><mrow id="S2.SS2.p4.7.m7.4.4.4.2.2" xref="S2.SS2.p4.7.m7.4.4.4.2.3.cmml"><mo id="S2.SS2.p4.7.m7.4.4.4.2.2.3" stretchy="false" xref="S2.SS2.p4.7.m7.4.4.4.2.3.cmml">(</mo><msubsup id="S2.SS2.p4.7.m7.3.3.3.1.1.1" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.cmml"><mi id="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.2" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.3" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p4.7.m7.3.3.3.1.1.1.3" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.cmml"><mi id="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.2" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.1" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.3" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.3.cmml">1</mn></mrow></msubsup><mo id="S2.SS2.p4.7.m7.4.4.4.2.2.4" xref="S2.SS2.p4.7.m7.4.4.4.2.3.cmml">,</mo><mrow id="S2.SS2.p4.7.m7.4.4.4.2.2.2" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.cmml"><msubsup id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.cmml"><mi id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.2" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.2.cmml">u</mi><mi id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.3" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.3.cmml">k</mi><mrow id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.cmml"><mi id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.2" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.2.cmml">l</mi><mo id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.1" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.1.cmml">−</mo><mn id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.3" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.3.cmml">1</mn></mrow></msubsup><mo fence="false" id="S2.SS2.p4.7.m7.4.4.4.2.2.2.1" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.1.cmml">|</mo><msubsup id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.cmml"><mi id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.2" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.2.cmml">z</mi><mrow id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.cmml"><mi id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.2" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.2.cmml">k</mi><mo id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.1" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.1.cmml">−</mo><mn id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.3" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.3.cmml">1</mn></mrow><mi id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.3" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.3.cmml">l</mi></msubsup></mrow><mo id="S2.SS2.p4.7.m7.4.4.4.2.2.5" stretchy="false" xref="S2.SS2.p4.7.m7.4.4.4.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.7.m7.4b"><apply id="S2.SS2.p4.7.m7.4.4.cmml" xref="S2.SS2.p4.7.m7.4.4"><eq id="S2.SS2.p4.7.m7.4.4.5.cmml" xref="S2.SS2.p4.7.m7.4.4.5"></eq><list id="S2.SS2.p4.7.m7.2.2.2.3.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2"><apply id="S2.SS2.p4.7.m7.1.1.1.1.1.cmml" xref="S2.SS2.p4.7.m7.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.1.1.1.1.1.1.cmml" xref="S2.SS2.p4.7.m7.1.1.1.1.1">superscript</csymbol><apply id="S2.SS2.p4.7.m7.1.1.1.1.1.2.cmml" xref="S2.SS2.p4.7.m7.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.1.1.1.1.1.2.1.cmml" xref="S2.SS2.p4.7.m7.1.1.1.1.1">subscript</csymbol><ci id="S2.SS2.p4.7.m7.1.1.1.1.1.2.2.cmml" xref="S2.SS2.p4.7.m7.1.1.1.1.1.2.2">𝑥</ci><ci id="S2.SS2.p4.7.m7.1.1.1.1.1.2.3.cmml" xref="S2.SS2.p4.7.m7.1.1.1.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p4.7.m7.1.1.1.1.1.3.cmml" xref="S2.SS2.p4.7.m7.1.1.1.1.1.3">𝑙</ci></apply><apply id="S2.SS2.p4.7.m7.2.2.2.2.2.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.2.2.2.2.2.1.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2">superscript</csymbol><apply id="S2.SS2.p4.7.m7.2.2.2.2.2.2.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.2.2.2.2.2.2.1.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2">subscript</csymbol><apply id="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2.2.2"><ci id="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.1.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.1">^</ci><ci id="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.2.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2.2.2.2">𝑢</ci></apply><ci id="S2.SS2.p4.7.m7.2.2.2.2.2.2.3.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2.2.3">𝑘</ci></apply><ci id="S2.SS2.p4.7.m7.2.2.2.2.2.3.cmml" xref="S2.SS2.p4.7.m7.2.2.2.2.2.3">𝑙</ci></apply></list><apply id="S2.SS2.p4.7.m7.4.4.4.cmml" xref="S2.SS2.p4.7.m7.4.4.4"><times id="S2.SS2.p4.7.m7.4.4.4.3.cmml" xref="S2.SS2.p4.7.m7.4.4.4.3"></times><ci id="S2.SS2.p4.7.m7.4.4.4.4.cmml" xref="S2.SS2.p4.7.m7.4.4.4.4">𝒯</ci><interval closure="open" id="S2.SS2.p4.7.m7.4.4.4.2.3.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2"><apply id="S2.SS2.p4.7.m7.3.3.3.1.1.1.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.3.3.3.1.1.1.1.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1">superscript</csymbol><apply id="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.1.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1">subscript</csymbol><ci id="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.2.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.2">𝑥</ci><ci id="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.3.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.3"><minus id="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.1.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.1"></minus><ci id="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.2.cmml" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.2">𝑙</ci><cn id="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.3.cmml" type="integer" xref="S2.SS2.p4.7.m7.3.3.3.1.1.1.3.3">1</cn></apply></apply><apply id="S2.SS2.p4.7.m7.4.4.4.2.2.2.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2"><csymbol cd="latexml" id="S2.SS2.p4.7.m7.4.4.4.2.2.2.1.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.1">conditional</csymbol><apply id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.1.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2">superscript</csymbol><apply id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.1.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2">subscript</csymbol><ci id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.2.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.2">𝑢</ci><ci id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.3.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3"><minus id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.1.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.1"></minus><ci id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.2.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.2">𝑙</ci><cn id="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.3.cmml" type="integer" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.2.3.3">1</cn></apply></apply><apply id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.1.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3">superscript</csymbol><apply id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3"><csymbol cd="ambiguous" id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.1.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3">subscript</csymbol><ci id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.2.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.2">𝑧</ci><apply id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3"><minus id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.1.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.1"></minus><ci id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.2.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.2">𝑘</ci><cn id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.3.cmml" type="integer" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.2.3.3">1</cn></apply></apply><ci id="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.3.cmml" xref="S2.SS2.p4.7.m7.4.4.4.2.2.2.3.3">𝑙</ci></apply></apply></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.7.m7.4c">x_{k}^{l},\hat{u}_{k}^{l}=\mathcal{T}(x_{k}^{l-1},u_{k}^{l-1}|z_{k-1}^{l})</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.7.m7.4d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT , over^ start_ARG italic_u end_ARG start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = caligraphic_T ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT , italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT | italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT )</annotation></semantics></math>. Relative position embeddings are applied on the short-term memory <math alttext="z_{k-1}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p4.8.m8.1"><semantics id="S2.SS2.p4.8.m8.1a"><msubsup id="S2.SS2.p4.8.m8.1.1" xref="S2.SS2.p4.8.m8.1.1.cmml"><mi id="S2.SS2.p4.8.m8.1.1.2.2" xref="S2.SS2.p4.8.m8.1.1.2.2.cmml">z</mi><mrow id="S2.SS2.p4.8.m8.1.1.2.3" xref="S2.SS2.p4.8.m8.1.1.2.3.cmml"><mi id="S2.SS2.p4.8.m8.1.1.2.3.2" xref="S2.SS2.p4.8.m8.1.1.2.3.2.cmml">k</mi><mo id="S2.SS2.p4.8.m8.1.1.2.3.1" xref="S2.SS2.p4.8.m8.1.1.2.3.1.cmml">−</mo><mn id="S2.SS2.p4.8.m8.1.1.2.3.3" xref="S2.SS2.p4.8.m8.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.SS2.p4.8.m8.1.1.3" xref="S2.SS2.p4.8.m8.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.8.m8.1b"><apply id="S2.SS2.p4.8.m8.1.1.cmml" xref="S2.SS2.p4.8.m8.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.8.m8.1.1.1.cmml" xref="S2.SS2.p4.8.m8.1.1">superscript</csymbol><apply id="S2.SS2.p4.8.m8.1.1.2.cmml" xref="S2.SS2.p4.8.m8.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.8.m8.1.1.2.1.cmml" xref="S2.SS2.p4.8.m8.1.1">subscript</csymbol><ci id="S2.SS2.p4.8.m8.1.1.2.2.cmml" xref="S2.SS2.p4.8.m8.1.1.2.2">𝑧</ci><apply id="S2.SS2.p4.8.m8.1.1.2.3.cmml" xref="S2.SS2.p4.8.m8.1.1.2.3"><minus id="S2.SS2.p4.8.m8.1.1.2.3.1.cmml" xref="S2.SS2.p4.8.m8.1.1.2.3.1"></minus><ci id="S2.SS2.p4.8.m8.1.1.2.3.2.cmml" xref="S2.SS2.p4.8.m8.1.1.2.3.2">𝑘</ci><cn id="S2.SS2.p4.8.m8.1.1.2.3.3.cmml" type="integer" xref="S2.SS2.p4.8.m8.1.1.2.3.3">1</cn></apply></apply><ci id="S2.SS2.p4.8.m8.1.1.3.cmml" xref="S2.SS2.p4.8.m8.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.8.m8.1c">z_{k-1}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.8.m8.1d">italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>, context <math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p4.9.m9.1"><semantics id="S2.SS2.p4.9.m9.1a"><msubsup id="S2.SS2.p4.9.m9.1.1" xref="S2.SS2.p4.9.m9.1.1.cmml"><mi id="S2.SS2.p4.9.m9.1.1.2.2" xref="S2.SS2.p4.9.m9.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p4.9.m9.1.1.2.3" xref="S2.SS2.p4.9.m9.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p4.9.m9.1.1.3" xref="S2.SS2.p4.9.m9.1.1.3.cmml"><mi id="S2.SS2.p4.9.m9.1.1.3.2" xref="S2.SS2.p4.9.m9.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p4.9.m9.1.1.3.1" xref="S2.SS2.p4.9.m9.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p4.9.m9.1.1.3.3" xref="S2.SS2.p4.9.m9.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.9.m9.1b"><apply id="S2.SS2.p4.9.m9.1.1.cmml" xref="S2.SS2.p4.9.m9.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.9.m9.1.1.1.cmml" xref="S2.SS2.p4.9.m9.1.1">superscript</csymbol><apply id="S2.SS2.p4.9.m9.1.1.2.cmml" xref="S2.SS2.p4.9.m9.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.9.m9.1.1.2.1.cmml" xref="S2.SS2.p4.9.m9.1.1">subscript</csymbol><ci id="S2.SS2.p4.9.m9.1.1.2.2.cmml" xref="S2.SS2.p4.9.m9.1.1.2.2">𝑥</ci><ci id="S2.SS2.p4.9.m9.1.1.2.3.cmml" xref="S2.SS2.p4.9.m9.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.9.m9.1.1.3.cmml" xref="S2.SS2.p4.9.m9.1.1.3"><minus id="S2.SS2.p4.9.m9.1.1.3.1.cmml" xref="S2.SS2.p4.9.m9.1.1.3.1"></minus><ci id="S2.SS2.p4.9.m9.1.1.3.2.cmml" xref="S2.SS2.p4.9.m9.1.1.3.2">𝑙</ci><cn id="S2.SS2.p4.9.m9.1.1.3.3.cmml" type="integer" xref="S2.SS2.p4.9.m9.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.9.m9.1c">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.9.m9.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>, and summary <math alttext="u_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p4.10.m10.1"><semantics id="S2.SS2.p4.10.m10.1a"><msubsup id="S2.SS2.p4.10.m10.1.1" xref="S2.SS2.p4.10.m10.1.1.cmml"><mi id="S2.SS2.p4.10.m10.1.1.2.2" xref="S2.SS2.p4.10.m10.1.1.2.2.cmml">u</mi><mi id="S2.SS2.p4.10.m10.1.1.2.3" xref="S2.SS2.p4.10.m10.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p4.10.m10.1.1.3" xref="S2.SS2.p4.10.m10.1.1.3.cmml"><mi id="S2.SS2.p4.10.m10.1.1.3.2" xref="S2.SS2.p4.10.m10.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p4.10.m10.1.1.3.1" xref="S2.SS2.p4.10.m10.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p4.10.m10.1.1.3.3" xref="S2.SS2.p4.10.m10.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.10.m10.1b"><apply id="S2.SS2.p4.10.m10.1.1.cmml" xref="S2.SS2.p4.10.m10.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.10.m10.1.1.1.cmml" xref="S2.SS2.p4.10.m10.1.1">superscript</csymbol><apply id="S2.SS2.p4.10.m10.1.1.2.cmml" xref="S2.SS2.p4.10.m10.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.10.m10.1.1.2.1.cmml" xref="S2.SS2.p4.10.m10.1.1">subscript</csymbol><ci id="S2.SS2.p4.10.m10.1.1.2.2.cmml" xref="S2.SS2.p4.10.m10.1.1.2.2">𝑢</ci><ci id="S2.SS2.p4.10.m10.1.1.2.3.cmml" xref="S2.SS2.p4.10.m10.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.10.m10.1.1.3.cmml" xref="S2.SS2.p4.10.m10.1.1.3"><minus id="S2.SS2.p4.10.m10.1.1.3.1.cmml" xref="S2.SS2.p4.10.m10.1.1.3.1"></minus><ci id="S2.SS2.p4.10.m10.1.1.3.2.cmml" xref="S2.SS2.p4.10.m10.1.1.3.2">𝑙</ci><cn id="S2.SS2.p4.10.m10.1.1.3.3.cmml" type="integer" xref="S2.SS2.p4.10.m10.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.10.m10.1c">u_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.10.m10.1d">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>, while a causal mask is applied on the combined sequence of <math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p4.11.m11.1"><semantics id="S2.SS2.p4.11.m11.1a"><msubsup id="S2.SS2.p4.11.m11.1.1" xref="S2.SS2.p4.11.m11.1.1.cmml"><mi id="S2.SS2.p4.11.m11.1.1.2.2" xref="S2.SS2.p4.11.m11.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p4.11.m11.1.1.2.3" xref="S2.SS2.p4.11.m11.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p4.11.m11.1.1.3" xref="S2.SS2.p4.11.m11.1.1.3.cmml"><mi id="S2.SS2.p4.11.m11.1.1.3.2" xref="S2.SS2.p4.11.m11.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p4.11.m11.1.1.3.1" xref="S2.SS2.p4.11.m11.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p4.11.m11.1.1.3.3" xref="S2.SS2.p4.11.m11.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.11.m11.1b"><apply id="S2.SS2.p4.11.m11.1.1.cmml" xref="S2.SS2.p4.11.m11.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.11.m11.1.1.1.cmml" xref="S2.SS2.p4.11.m11.1.1">superscript</csymbol><apply id="S2.SS2.p4.11.m11.1.1.2.cmml" xref="S2.SS2.p4.11.m11.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.11.m11.1.1.2.1.cmml" xref="S2.SS2.p4.11.m11.1.1">subscript</csymbol><ci id="S2.SS2.p4.11.m11.1.1.2.2.cmml" xref="S2.SS2.p4.11.m11.1.1.2.2">𝑥</ci><ci id="S2.SS2.p4.11.m11.1.1.2.3.cmml" xref="S2.SS2.p4.11.m11.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.11.m11.1.1.3.cmml" xref="S2.SS2.p4.11.m11.1.1.3"><minus id="S2.SS2.p4.11.m11.1.1.3.1.cmml" xref="S2.SS2.p4.11.m11.1.1.3.1"></minus><ci id="S2.SS2.p4.11.m11.1.1.3.2.cmml" xref="S2.SS2.p4.11.m11.1.1.3.2">𝑙</ci><cn id="S2.SS2.p4.11.m11.1.1.3.3.cmml" type="integer" xref="S2.SS2.p4.11.m11.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.11.m11.1c">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.11.m11.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> and <math alttext="u_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p4.12.m12.1"><semantics id="S2.SS2.p4.12.m12.1a"><msubsup id="S2.SS2.p4.12.m12.1.1" xref="S2.SS2.p4.12.m12.1.1.cmml"><mi id="S2.SS2.p4.12.m12.1.1.2.2" xref="S2.SS2.p4.12.m12.1.1.2.2.cmml">u</mi><mi id="S2.SS2.p4.12.m12.1.1.2.3" xref="S2.SS2.p4.12.m12.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p4.12.m12.1.1.3" xref="S2.SS2.p4.12.m12.1.1.3.cmml"><mi id="S2.SS2.p4.12.m12.1.1.3.2" xref="S2.SS2.p4.12.m12.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p4.12.m12.1.1.3.1" xref="S2.SS2.p4.12.m12.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p4.12.m12.1.1.3.3" xref="S2.SS2.p4.12.m12.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p4.12.m12.1b"><apply id="S2.SS2.p4.12.m12.1.1.cmml" xref="S2.SS2.p4.12.m12.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.12.m12.1.1.1.cmml" xref="S2.SS2.p4.12.m12.1.1">superscript</csymbol><apply id="S2.SS2.p4.12.m12.1.1.2.cmml" xref="S2.SS2.p4.12.m12.1.1"><csymbol cd="ambiguous" id="S2.SS2.p4.12.m12.1.1.2.1.cmml" xref="S2.SS2.p4.12.m12.1.1">subscript</csymbol><ci id="S2.SS2.p4.12.m12.1.1.2.2.cmml" xref="S2.SS2.p4.12.m12.1.1.2.2">𝑢</ci><ci id="S2.SS2.p4.12.m12.1.1.2.3.cmml" xref="S2.SS2.p4.12.m12.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p4.12.m12.1.1.3.cmml" xref="S2.SS2.p4.12.m12.1.1.3"><minus id="S2.SS2.p4.12.m12.1.1.3.1.cmml" xref="S2.SS2.p4.12.m12.1.1.3.1"></minus><ci id="S2.SS2.p4.12.m12.1.1.3.2.cmml" xref="S2.SS2.p4.12.m12.1.1.3.2">𝑙</ci><cn id="S2.SS2.p4.12.m12.1.1.3.3.cmml" type="integer" xref="S2.SS2.p4.12.m12.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p4.12.m12.1c">u_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p4.12.m12.1d">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS2.p5">
<p class="ltx_p" id="S2.SS2.p5.2">Summary tokens (containing <math alttext="U" class="ltx_Math" display="inline" id="S2.SS2.p5.1.m1.1"><semantics id="S2.SS2.p5.1.m1.1a"><mi id="S2.SS2.p5.1.m1.1.1" xref="S2.SS2.p5.1.m1.1.1.cmml">U</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p5.1.m1.1b"><ci id="S2.SS2.p5.1.m1.1.1.cmml" xref="S2.SS2.p5.1.m1.1.1">𝑈</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p5.1.m1.1c">U</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p5.1.m1.1d">italic_U</annotation></semantics></math> tokens) are initialized from learnable embeddings (prior to the first layer) and set to the same length as the short-term memory (<math alttext="U=S" class="ltx_Math" display="inline" id="S2.SS2.p5.2.m2.1"><semantics id="S2.SS2.p5.2.m2.1a"><mrow id="S2.SS2.p5.2.m2.1.1" xref="S2.SS2.p5.2.m2.1.1.cmml"><mi id="S2.SS2.p5.2.m2.1.1.2" xref="S2.SS2.p5.2.m2.1.1.2.cmml">U</mi><mo id="S2.SS2.p5.2.m2.1.1.1" xref="S2.SS2.p5.2.m2.1.1.1.cmml">=</mo><mi id="S2.SS2.p5.2.m2.1.1.3" xref="S2.SS2.p5.2.m2.1.1.3.cmml">S</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p5.2.m2.1b"><apply id="S2.SS2.p5.2.m2.1.1.cmml" xref="S2.SS2.p5.2.m2.1.1"><eq id="S2.SS2.p5.2.m2.1.1.1.cmml" xref="S2.SS2.p5.2.m2.1.1.1"></eq><ci id="S2.SS2.p5.2.m2.1.1.2.cmml" xref="S2.SS2.p5.2.m2.1.1.2">𝑈</ci><ci id="S2.SS2.p5.2.m2.1.1.3.cmml" xref="S2.SS2.p5.2.m2.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p5.2.m2.1c">U=S</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p5.2.m2.1d">italic_U = italic_S</annotation></semantics></math>). Propagating through all layers, they facilitate inter-layer communication within the short-term memory.
Moreover, branching summary tokens both upwards to the next layer and rightwards to the next window improves performance, a strategy we will discuss in more detail subsequently.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS2.p6">
<p class="ltx_p" id="S2.SS2.p6.3"><span class="ltx_text ltx_font_bold" id="S2.SS2.p6.3.1">Summary branching:</span>
We employ distinct linear token mixers <cite class="ltx_cite ltx_citemacro_citep">(Tolstikhin et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib31" title="">2021</a>)</cite> on the context and summary tokens to generate separate summary tokens for the subsequent layer and short-term memory tokens for the next window. Unlike channel mixing,
a linear token mixer linearly combines the <math alttext="M_{i}" class="ltx_Math" display="inline" id="S2.SS2.p6.1.m1.1"><semantics id="S2.SS2.p6.1.m1.1a"><msub id="S2.SS2.p6.1.m1.1.1" xref="S2.SS2.p6.1.m1.1.1.cmml"><mi id="S2.SS2.p6.1.m1.1.1.2" xref="S2.SS2.p6.1.m1.1.1.2.cmml">M</mi><mi id="S2.SS2.p6.1.m1.1.1.3" xref="S2.SS2.p6.1.m1.1.1.3.cmml">i</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.1.m1.1b"><apply id="S2.SS2.p6.1.m1.1.1.cmml" xref="S2.SS2.p6.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p6.1.m1.1.1.1.cmml" xref="S2.SS2.p6.1.m1.1.1">subscript</csymbol><ci id="S2.SS2.p6.1.m1.1.1.2.cmml" xref="S2.SS2.p6.1.m1.1.1.2">𝑀</ci><ci id="S2.SS2.p6.1.m1.1.1.3.cmml" xref="S2.SS2.p6.1.m1.1.1.3">𝑖</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.1.m1.1c">M_{i}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.1.m1.1d">italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math> input tokens across each channel to produce <math alttext="M_{o}" class="ltx_Math" display="inline" id="S2.SS2.p6.2.m2.1"><semantics id="S2.SS2.p6.2.m2.1a"><msub id="S2.SS2.p6.2.m2.1.1" xref="S2.SS2.p6.2.m2.1.1.cmml"><mi id="S2.SS2.p6.2.m2.1.1.2" xref="S2.SS2.p6.2.m2.1.1.2.cmml">M</mi><mi id="S2.SS2.p6.2.m2.1.1.3" xref="S2.SS2.p6.2.m2.1.1.3.cmml">o</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.2.m2.1b"><apply id="S2.SS2.p6.2.m2.1.1.cmml" xref="S2.SS2.p6.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS2.p6.2.m2.1.1.1.cmml" xref="S2.SS2.p6.2.m2.1.1">subscript</csymbol><ci id="S2.SS2.p6.2.m2.1.1.2.cmml" xref="S2.SS2.p6.2.m2.1.1.2">𝑀</ci><ci id="S2.SS2.p6.2.m2.1.1.3.cmml" xref="S2.SS2.p6.2.m2.1.1.3">𝑜</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.2.m2.1c">M_{o}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.2.m2.1d">italic_M start_POSTSUBSCRIPT italic_o end_POSTSUBSCRIPT</annotation></semantics></math> output tokens with the same dimensionality by using an <math alttext="M_{i}\times M_{o}" class="ltx_Math" display="inline" id="S2.SS2.p6.3.m3.1"><semantics id="S2.SS2.p6.3.m3.1a"><mrow id="S2.SS2.p6.3.m3.1.1" xref="S2.SS2.p6.3.m3.1.1.cmml"><msub id="S2.SS2.p6.3.m3.1.1.2" xref="S2.SS2.p6.3.m3.1.1.2.cmml"><mi id="S2.SS2.p6.3.m3.1.1.2.2" xref="S2.SS2.p6.3.m3.1.1.2.2.cmml">M</mi><mi id="S2.SS2.p6.3.m3.1.1.2.3" xref="S2.SS2.p6.3.m3.1.1.2.3.cmml">i</mi></msub><mo id="S2.SS2.p6.3.m3.1.1.1" lspace="0.222em" rspace="0.222em" xref="S2.SS2.p6.3.m3.1.1.1.cmml">×</mo><msub id="S2.SS2.p6.3.m3.1.1.3" xref="S2.SS2.p6.3.m3.1.1.3.cmml"><mi id="S2.SS2.p6.3.m3.1.1.3.2" xref="S2.SS2.p6.3.m3.1.1.3.2.cmml">M</mi><mi id="S2.SS2.p6.3.m3.1.1.3.3" xref="S2.SS2.p6.3.m3.1.1.3.3.cmml">o</mi></msub></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.3.m3.1b"><apply id="S2.SS2.p6.3.m3.1.1.cmml" xref="S2.SS2.p6.3.m3.1.1"><times id="S2.SS2.p6.3.m3.1.1.1.cmml" xref="S2.SS2.p6.3.m3.1.1.1"></times><apply id="S2.SS2.p6.3.m3.1.1.2.cmml" xref="S2.SS2.p6.3.m3.1.1.2"><csymbol cd="ambiguous" id="S2.SS2.p6.3.m3.1.1.2.1.cmml" xref="S2.SS2.p6.3.m3.1.1.2">subscript</csymbol><ci id="S2.SS2.p6.3.m3.1.1.2.2.cmml" xref="S2.SS2.p6.3.m3.1.1.2.2">𝑀</ci><ci id="S2.SS2.p6.3.m3.1.1.2.3.cmml" xref="S2.SS2.p6.3.m3.1.1.2.3">𝑖</ci></apply><apply id="S2.SS2.p6.3.m3.1.1.3.cmml" xref="S2.SS2.p6.3.m3.1.1.3"><csymbol cd="ambiguous" id="S2.SS2.p6.3.m3.1.1.3.1.cmml" xref="S2.SS2.p6.3.m3.1.1.3">subscript</csymbol><ci id="S2.SS2.p6.3.m3.1.1.3.2.cmml" xref="S2.SS2.p6.3.m3.1.1.3.2">𝑀</ci><ci id="S2.SS2.p6.3.m3.1.1.3.3.cmml" xref="S2.SS2.p6.3.m3.1.1.3.3">𝑜</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.3.m3.1c">M_{i}\times M_{o}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.3.m3.1d">italic_M start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT × italic_M start_POSTSUBSCRIPT italic_o end_POSTSUBSCRIPT</annotation></semantics></math> matrix. This is mathematically represented as follows:</p>
<table class="ltx_equationgroup ltx_eqn_align ltx_eqn_table" id="A4.EGx2">
<tbody id="S2.E2"><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_td ltx_align_right ltx_eqn_cell"><math alttext="\displaystyle u_{k}^{l}=\mathcal{M}_{\uparrow}(x_{k}^{l},\hat{u}_{k}^{l}),\;\;%
z_{k}^{l}=\mathcal{M}_{\rightarrow}(x_{k}^{l},\hat{u}_{k}^{l}),\;\;\text{where%
}\;\;x_{k}^{l},\hat{u}_{k}^{l}=\mathcal{T}(x_{k}^{l-1},u_{k}^{l-1}|z_{k-1}^{l})," class="ltx_Math" display="inline" id="S2.E2.m1.1"><semantics id="S2.E2.m1.1a"><mrow id="S2.E2.m1.1.1.1"><mrow id="S2.E2.m1.1.1.1.1.2" xref="S2.E2.m1.1.1.1.1.3.cmml"><mrow id="S2.E2.m1.1.1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.1.1.cmml"><msubsup id="S2.E2.m1.1.1.1.1.1.1.4" xref="S2.E2.m1.1.1.1.1.1.1.4.cmml"><mi id="S2.E2.m1.1.1.1.1.1.1.4.2.2" xref="S2.E2.m1.1.1.1.1.1.1.4.2.2.cmml">u</mi><mi id="S2.E2.m1.1.1.1.1.1.1.4.2.3" xref="S2.E2.m1.1.1.1.1.1.1.4.2.3.cmml">k</mi><mi id="S2.E2.m1.1.1.1.1.1.1.4.3" xref="S2.E2.m1.1.1.1.1.1.1.4.3.cmml">l</mi></msubsup><mo id="S2.E2.m1.1.1.1.1.1.1.3" xref="S2.E2.m1.1.1.1.1.1.1.3.cmml">=</mo><mrow id="S2.E2.m1.1.1.1.1.1.1.2" xref="S2.E2.m1.1.1.1.1.1.1.2.cmml"><msub id="S2.E2.m1.1.1.1.1.1.1.2.4" xref="S2.E2.m1.1.1.1.1.1.1.2.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E2.m1.1.1.1.1.1.1.2.4.2" xref="S2.E2.m1.1.1.1.1.1.1.2.4.2.cmml">ℳ</mi><mo id="S2.E2.m1.1.1.1.1.1.1.2.4.3" stretchy="false" xref="S2.E2.m1.1.1.1.1.1.1.2.4.3.cmml">↑</mo></msub><mo id="S2.E2.m1.1.1.1.1.1.1.2.3" xref="S2.E2.m1.1.1.1.1.1.1.2.3.cmml">⁢</mo><mrow id="S2.E2.m1.1.1.1.1.1.1.2.2.2" xref="S2.E2.m1.1.1.1.1.1.1.2.2.3.cmml"><mo id="S2.E2.m1.1.1.1.1.1.1.2.2.2.3" stretchy="false" xref="S2.E2.m1.1.1.1.1.1.1.2.2.3.cmml">(</mo><msubsup id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.2" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.2.cmml">x</mi><mi id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.3" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.3.cmml">k</mi><mi id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.3" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.3.cmml">l</mi></msubsup><mo id="S2.E2.m1.1.1.1.1.1.1.2.2.2.4" xref="S2.E2.m1.1.1.1.1.1.1.2.2.3.cmml">,</mo><msubsup id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.cmml"><mover accent="true" id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.cmml"><mi id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.2.cmml">u</mi><mo id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.1" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.1.cmml">^</mo></mover><mi id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.3" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.3.cmml">k</mi><mi id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.3" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.3.cmml">l</mi></msubsup><mo id="S2.E2.m1.1.1.1.1.1.1.2.2.2.5" stretchy="false" xref="S2.E2.m1.1.1.1.1.1.1.2.2.3.cmml">)</mo></mrow></mrow></mrow><mo id="S2.E2.m1.1.1.1.1.2.3" rspace="0.727em" xref="S2.E2.m1.1.1.1.1.3a.cmml">,</mo><mrow id="S2.E2.m1.1.1.1.1.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.3.cmml"><mrow id="S2.E2.m1.1.1.1.1.2.2.1.1" xref="S2.E2.m1.1.1.1.1.2.2.1.1.cmml"><msubsup id="S2.E2.m1.1.1.1.1.2.2.1.1.4" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.2.cmml">z</mi><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.3.cmml">k</mi><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.4.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4.3.cmml">l</mi></msubsup><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.3.cmml">=</mo><mrow id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.3.cmml"><mrow id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.cmml"><msub id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.2.cmml">ℳ</mi><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.3" stretchy="false" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.3.cmml">→</mo></msub><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.3.cmml">⁢</mo><mrow id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.3.cmml"><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.3" stretchy="false" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.3.cmml">(</mo><msubsup id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.2.cmml">x</mi><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.3.cmml">k</mi><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.3.cmml">l</mi></msubsup><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.4" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.3.cmml">,</mo><msubsup id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.cmml"><mover accent="true" id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.2.cmml">u</mi><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.1" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.1.cmml">^</mo></mover><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.3.cmml">k</mi><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.3.cmml">l</mi></msubsup><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.5" stretchy="false" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.3.cmml">)</mo></mrow></mrow><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.3" rspace="0.727em" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.3.cmml">,</mo><mrow id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.cmml"><mtext id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.2a.cmml">where</mtext><mo id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.1" lspace="0.560em" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.1.cmml">⁢</mo><msubsup id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.2" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.2.cmml">x</mi><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.3.cmml">k</mi><mi id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.3" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.3.cmml">l</mi></msubsup></mrow></mrow></mrow><mo id="S2.E2.m1.1.1.1.1.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.3a.cmml">,</mo><mrow id="S2.E2.m1.1.1.1.1.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.cmml"><msubsup id="S2.E2.m1.1.1.1.1.2.2.2.2.4" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.cmml"><mover accent="true" id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.2.cmml">u</mi><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.1" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.1.cmml">^</mo></mover><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.3.cmml">k</mi><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.4.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.3.cmml">l</mi></msubsup><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.3.cmml">=</mo><mrow id="S2.E2.m1.1.1.1.1.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.E2.m1.1.1.1.1.2.2.2.2.2.4" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.4.cmml">𝒯</mi><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.3.cmml">⁢</mo><mrow id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.3.cmml"><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.3" stretchy="false" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.3.cmml">(</mo><msubsup id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.2.cmml">x</mi><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.3.cmml">k</mi><mrow id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.2.cmml">l</mi><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.1" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.1.cmml">−</mo><mn id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.3.cmml">1</mn></mrow></msubsup><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.4" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.3.cmml">,</mo><mrow id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.cmml"><msubsup id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.2.cmml">u</mi><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.3.cmml">k</mi><mrow id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.2.cmml">l</mi><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.1" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.1.cmml">−</mo><mn id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.3.cmml">1</mn></mrow></msubsup><mo fence="false" id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.1" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.1.cmml">|</mo><msubsup id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.2.cmml">z</mi><mrow id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.cmml"><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.2" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.2.cmml">k</mi><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.1" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.1.cmml">−</mo><mn id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.3.cmml">1</mn></mrow><mi id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.3" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.3.cmml">l</mi></msubsup></mrow><mo id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.5" stretchy="false" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.3.cmml">)</mo></mrow></mrow></mrow></mrow></mrow><mo id="S2.E2.m1.1.1.1.2">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S2.E2.m1.1b"><apply id="S2.E2.m1.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.3a.cmml" xref="S2.E2.m1.1.1.1.1.2.3">formulae-sequence</csymbol><apply id="S2.E2.m1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1"><eq id="S2.E2.m1.1.1.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.3"></eq><apply id="S2.E2.m1.1.1.1.1.1.1.4.cmml" xref="S2.E2.m1.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.1.1.4.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.4">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.1.1.4.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.1.1.4.2.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.4">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.1.1.4.2.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.4.2.2">𝑢</ci><ci id="S2.E2.m1.1.1.1.1.1.1.4.2.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.4.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.1.1.4.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.4.3">𝑙</ci></apply><apply id="S2.E2.m1.1.1.1.1.1.1.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2"><times id="S2.E2.m1.1.1.1.1.1.1.2.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.3"></times><apply id="S2.E2.m1.1.1.1.1.1.1.2.4.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.4"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.1.1.2.4.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.4">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.1.1.2.4.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.4.2">ℳ</ci><ci id="S2.E2.m1.1.1.1.1.1.1.2.4.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.4.3">↑</ci></apply><interval closure="open" id="S2.E2.m1.1.1.1.1.1.1.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2"><apply id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.2">𝑥</ci><ci id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.1.1.1.1.3">𝑙</ci></apply><apply id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2">subscript</csymbol><apply id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2"><ci id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.1">^</ci><ci id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.2.2">𝑢</ci></apply><ci id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.1.1.2.2.2.2.3">𝑙</ci></apply></interval></apply></apply><apply id="S2.E2.m1.1.1.1.1.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.3a.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.3">formulae-sequence</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1"><eq id="S2.E2.m1.1.1.1.1.2.2.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.3"></eq><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.4.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.4.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.2">𝑧</ci><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.4.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.4.3">𝑙</ci></apply><list id="S2.E2.m1.1.1.1.1.2.2.1.1.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2"><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1"><times id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.3"></times><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.2">ℳ</ci><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.4.3">→</ci></apply><interval closure="open" id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2"><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.2">𝑥</ci><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.1.1.1.3">𝑙</ci></apply><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2">subscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2"><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.1">^</ci><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.2.2">𝑢</ci></apply><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.1.1.1.2.2.2.3">𝑙</ci></apply></interval></apply><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2"><times id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.1"></times><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.2a.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.2"><mtext id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.2">where</mtext></ci><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.2">𝑥</ci><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.1.1.2.2.2.3.3">𝑙</ci></apply></apply></list></apply><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2"><eq id="S2.E2.m1.1.1.1.1.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.3"></eq><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.4.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.2.2.4.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4">subscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2"><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.1">^</ci><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.2.2">𝑢</ci></apply><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.2.3">𝑘</ci></apply><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.4.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.4.3">𝑙</ci></apply><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2"><times id="S2.E2.m1.1.1.1.1.2.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.3"></times><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.2.4.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.4">𝒯</ci><interval closure="open" id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2"><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.2">𝑥</ci><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.2.3">𝑘</ci></apply><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3"><minus id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.1"></minus><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.2">𝑙</ci><cn id="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.3.cmml" type="integer" xref="S2.E2.m1.1.1.1.1.2.2.2.2.1.1.1.1.3.3">1</cn></apply></apply><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2"><csymbol cd="latexml" id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.1">conditional</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.2">𝑢</ci><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.2.3">𝑘</ci></apply><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3"><minus id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.1"></minus><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.2">𝑙</ci><cn id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.3.cmml" type="integer" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.2.3.3">1</cn></apply></apply><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3">superscript</csymbol><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3"><csymbol cd="ambiguous" id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3">subscript</csymbol><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.2">𝑧</ci><apply id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3"><minus id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.1.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.1"></minus><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.2.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.2">𝑘</ci><cn id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.3.cmml" type="integer" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.2.3.3">1</cn></apply></apply><ci id="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.3.cmml" xref="S2.E2.m1.1.1.1.1.2.2.2.2.2.2.2.2.3.3">𝑙</ci></apply></apply></interval></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.E2.m1.1c">\displaystyle u_{k}^{l}=\mathcal{M}_{\uparrow}(x_{k}^{l},\hat{u}_{k}^{l}),\;\;%
z_{k}^{l}=\mathcal{M}_{\rightarrow}(x_{k}^{l},\hat{u}_{k}^{l}),\;\;\text{where%
}\;\;x_{k}^{l},\hat{u}_{k}^{l}=\mathcal{T}(x_{k}^{l-1},u_{k}^{l-1}|z_{k-1}^{l}),</annotation><annotation encoding="application/x-llamapun" id="S2.E2.m1.1d">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = caligraphic_M start_POSTSUBSCRIPT ↑ end_POSTSUBSCRIPT ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT , over^ start_ARG italic_u end_ARG start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ) , italic_z start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = caligraphic_M start_POSTSUBSCRIPT → end_POSTSUBSCRIPT ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT , over^ start_ARG italic_u end_ARG start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ) , where italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT , over^ start_ARG italic_u end_ARG start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = caligraphic_T ( italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT , italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT | italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S2.SS2.p6.12">where <math alttext="\mathcal{M}_{\uparrow}" class="ltx_Math" display="inline" id="S2.SS2.p6.4.m1.1"><semantics id="S2.SS2.p6.4.m1.1a"><msub id="S2.SS2.p6.4.m1.1.1" xref="S2.SS2.p6.4.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p6.4.m1.1.1.2" xref="S2.SS2.p6.4.m1.1.1.2.cmml">ℳ</mi><mo id="S2.SS2.p6.4.m1.1.1.3" stretchy="false" xref="S2.SS2.p6.4.m1.1.1.3.cmml">↑</mo></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.4.m1.1b"><apply id="S2.SS2.p6.4.m1.1.1.cmml" xref="S2.SS2.p6.4.m1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p6.4.m1.1.1.1.cmml" xref="S2.SS2.p6.4.m1.1.1">subscript</csymbol><ci id="S2.SS2.p6.4.m1.1.1.2.cmml" xref="S2.SS2.p6.4.m1.1.1.2">ℳ</ci><ci id="S2.SS2.p6.4.m1.1.1.3.cmml" xref="S2.SS2.p6.4.m1.1.1.3">↑</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.4.m1.1c">\mathcal{M}_{\uparrow}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.4.m1.1d">caligraphic_M start_POSTSUBSCRIPT ↑ end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="\mathcal{M}_{\rightarrow}" class="ltx_Math" display="inline" id="S2.SS2.p6.5.m2.1"><semantics id="S2.SS2.p6.5.m2.1a"><msub id="S2.SS2.p6.5.m2.1.1" xref="S2.SS2.p6.5.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS2.p6.5.m2.1.1.2" xref="S2.SS2.p6.5.m2.1.1.2.cmml">ℳ</mi><mo id="S2.SS2.p6.5.m2.1.1.3" stretchy="false" xref="S2.SS2.p6.5.m2.1.1.3.cmml">→</mo></msub><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.5.m2.1b"><apply id="S2.SS2.p6.5.m2.1.1.cmml" xref="S2.SS2.p6.5.m2.1.1"><csymbol cd="ambiguous" id="S2.SS2.p6.5.m2.1.1.1.cmml" xref="S2.SS2.p6.5.m2.1.1">subscript</csymbol><ci id="S2.SS2.p6.5.m2.1.1.2.cmml" xref="S2.SS2.p6.5.m2.1.1.2">ℳ</ci><ci id="S2.SS2.p6.5.m2.1.1.3.cmml" xref="S2.SS2.p6.5.m2.1.1.3">→</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.5.m2.1c">\mathcal{M}_{\rightarrow}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.5.m2.1d">caligraphic_M start_POSTSUBSCRIPT → end_POSTSUBSCRIPT</annotation></semantics></math> denote the two linear token mixers towards the subsequent layer and the next window respectively. The resulting summary and memory tokens exhibit distinct linear combination of context <math alttext="x_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p6.6.m3.1"><semantics id="S2.SS2.p6.6.m3.1a"><msubsup id="S2.SS2.p6.6.m3.1.1" xref="S2.SS2.p6.6.m3.1.1.cmml"><mi id="S2.SS2.p6.6.m3.1.1.2.2" xref="S2.SS2.p6.6.m3.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p6.6.m3.1.1.2.3" xref="S2.SS2.p6.6.m3.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p6.6.m3.1.1.3" xref="S2.SS2.p6.6.m3.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.6.m3.1b"><apply id="S2.SS2.p6.6.m3.1.1.cmml" xref="S2.SS2.p6.6.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.p6.6.m3.1.1.1.cmml" xref="S2.SS2.p6.6.m3.1.1">superscript</csymbol><apply id="S2.SS2.p6.6.m3.1.1.2.cmml" xref="S2.SS2.p6.6.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.p6.6.m3.1.1.2.1.cmml" xref="S2.SS2.p6.6.m3.1.1">subscript</csymbol><ci id="S2.SS2.p6.6.m3.1.1.2.2.cmml" xref="S2.SS2.p6.6.m3.1.1.2.2">𝑥</ci><ci id="S2.SS2.p6.6.m3.1.1.2.3.cmml" xref="S2.SS2.p6.6.m3.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p6.6.m3.1.1.3.cmml" xref="S2.SS2.p6.6.m3.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.6.m3.1c">x_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.6.m3.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> and summary tokens <math alttext="\hat{u}_{k}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p6.7.m4.1"><semantics id="S2.SS2.p6.7.m4.1a"><msubsup id="S2.SS2.p6.7.m4.1.1" xref="S2.SS2.p6.7.m4.1.1.cmml"><mover accent="true" id="S2.SS2.p6.7.m4.1.1.2.2" xref="S2.SS2.p6.7.m4.1.1.2.2.cmml"><mi id="S2.SS2.p6.7.m4.1.1.2.2.2" xref="S2.SS2.p6.7.m4.1.1.2.2.2.cmml">u</mi><mo id="S2.SS2.p6.7.m4.1.1.2.2.1" xref="S2.SS2.p6.7.m4.1.1.2.2.1.cmml">^</mo></mover><mi id="S2.SS2.p6.7.m4.1.1.2.3" xref="S2.SS2.p6.7.m4.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p6.7.m4.1.1.3" xref="S2.SS2.p6.7.m4.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.7.m4.1b"><apply id="S2.SS2.p6.7.m4.1.1.cmml" xref="S2.SS2.p6.7.m4.1.1"><csymbol cd="ambiguous" id="S2.SS2.p6.7.m4.1.1.1.cmml" xref="S2.SS2.p6.7.m4.1.1">superscript</csymbol><apply id="S2.SS2.p6.7.m4.1.1.2.cmml" xref="S2.SS2.p6.7.m4.1.1"><csymbol cd="ambiguous" id="S2.SS2.p6.7.m4.1.1.2.1.cmml" xref="S2.SS2.p6.7.m4.1.1">subscript</csymbol><apply id="S2.SS2.p6.7.m4.1.1.2.2.cmml" xref="S2.SS2.p6.7.m4.1.1.2.2"><ci id="S2.SS2.p6.7.m4.1.1.2.2.1.cmml" xref="S2.SS2.p6.7.m4.1.1.2.2.1">^</ci><ci id="S2.SS2.p6.7.m4.1.1.2.2.2.cmml" xref="S2.SS2.p6.7.m4.1.1.2.2.2">𝑢</ci></apply><ci id="S2.SS2.p6.7.m4.1.1.2.3.cmml" xref="S2.SS2.p6.7.m4.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p6.7.m4.1.1.3.cmml" xref="S2.SS2.p6.7.m4.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.7.m4.1c">\hat{u}_{k}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.7.m4.1d">over^ start_ARG italic_u end_ARG start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math>, implying divergent compression flows across layers and windows. Since the summary and short-term memory share the same number of tokens (<math alttext="S" class="ltx_Math" display="inline" id="S2.SS2.p6.8.m5.1"><semantics id="S2.SS2.p6.8.m5.1a"><mi id="S2.SS2.p6.8.m5.1.1" xref="S2.SS2.p6.8.m5.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.8.m5.1b"><ci id="S2.SS2.p6.8.m5.1.1.cmml" xref="S2.SS2.p6.8.m5.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.8.m5.1c">S</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.8.m5.1d">italic_S</annotation></semantics></math>), each mixer
comprises <math alttext="(W+S)\times S" class="ltx_Math" display="inline" id="S2.SS2.p6.9.m6.1"><semantics id="S2.SS2.p6.9.m6.1a"><mrow id="S2.SS2.p6.9.m6.1.1" xref="S2.SS2.p6.9.m6.1.1.cmml"><mrow id="S2.SS2.p6.9.m6.1.1.1.1" xref="S2.SS2.p6.9.m6.1.1.1.1.1.cmml"><mo id="S2.SS2.p6.9.m6.1.1.1.1.2" stretchy="false" xref="S2.SS2.p6.9.m6.1.1.1.1.1.cmml">(</mo><mrow id="S2.SS2.p6.9.m6.1.1.1.1.1" xref="S2.SS2.p6.9.m6.1.1.1.1.1.cmml"><mi id="S2.SS2.p6.9.m6.1.1.1.1.1.2" xref="S2.SS2.p6.9.m6.1.1.1.1.1.2.cmml">W</mi><mo id="S2.SS2.p6.9.m6.1.1.1.1.1.1" xref="S2.SS2.p6.9.m6.1.1.1.1.1.1.cmml">+</mo><mi id="S2.SS2.p6.9.m6.1.1.1.1.1.3" xref="S2.SS2.p6.9.m6.1.1.1.1.1.3.cmml">S</mi></mrow><mo id="S2.SS2.p6.9.m6.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S2.SS2.p6.9.m6.1.1.1.1.1.cmml">)</mo></mrow><mo id="S2.SS2.p6.9.m6.1.1.2" rspace="0.222em" xref="S2.SS2.p6.9.m6.1.1.2.cmml">×</mo><mi id="S2.SS2.p6.9.m6.1.1.3" xref="S2.SS2.p6.9.m6.1.1.3.cmml">S</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.9.m6.1b"><apply id="S2.SS2.p6.9.m6.1.1.cmml" xref="S2.SS2.p6.9.m6.1.1"><times id="S2.SS2.p6.9.m6.1.1.2.cmml" xref="S2.SS2.p6.9.m6.1.1.2"></times><apply id="S2.SS2.p6.9.m6.1.1.1.1.1.cmml" xref="S2.SS2.p6.9.m6.1.1.1.1"><plus id="S2.SS2.p6.9.m6.1.1.1.1.1.1.cmml" xref="S2.SS2.p6.9.m6.1.1.1.1.1.1"></plus><ci id="S2.SS2.p6.9.m6.1.1.1.1.1.2.cmml" xref="S2.SS2.p6.9.m6.1.1.1.1.1.2">𝑊</ci><ci id="S2.SS2.p6.9.m6.1.1.1.1.1.3.cmml" xref="S2.SS2.p6.9.m6.1.1.1.1.1.3">𝑆</ci></apply><ci id="S2.SS2.p6.9.m6.1.1.3.cmml" xref="S2.SS2.p6.9.m6.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.9.m6.1c">(W+S)\times S</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.9.m6.1d">( italic_W + italic_S ) × italic_S</annotation></semantics></math> parameters, where <math alttext="W" class="ltx_Math" display="inline" id="S2.SS2.p6.10.m7.1"><semantics id="S2.SS2.p6.10.m7.1a"><mi id="S2.SS2.p6.10.m7.1.1" xref="S2.SS2.p6.10.m7.1.1.cmml">W</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.10.m7.1b"><ci id="S2.SS2.p6.10.m7.1.1.cmml" xref="S2.SS2.p6.10.m7.1.1">𝑊</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.10.m7.1c">W</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.10.m7.1d">italic_W</annotation></semantics></math> represent the number of context tokens per window. This parameter count is negligible for short context windows. For instance, with a context window of 512 tokens and 128 summary tokens, the two mixers collectively require (512+128)<math alttext="\times" class="ltx_Math" display="inline" id="S2.SS2.p6.11.m8.1"><semantics id="S2.SS2.p6.11.m8.1a"><mo id="S2.SS2.p6.11.m8.1.1" xref="S2.SS2.p6.11.m8.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.11.m8.1b"><times id="S2.SS2.p6.11.m8.1.1.cmml" xref="S2.SS2.p6.11.m8.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.11.m8.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.11.m8.1d">×</annotation></semantics></math>128<math alttext="\times" class="ltx_Math" display="inline" id="S2.SS2.p6.12.m9.1"><semantics id="S2.SS2.p6.12.m9.1a"><mo id="S2.SS2.p6.12.m9.1.1" xref="S2.SS2.p6.12.m9.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S2.SS2.p6.12.m9.1b"><times id="S2.SS2.p6.12.m9.1.1.cmml" xref="S2.SS2.p6.12.m9.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p6.12.m9.1c">\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p6.12.m9.1d">×</annotation></semantics></math>2=164K parameters, constituting a mere 1.3% of a transformer block with 1024 dimensions.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS2.p7">
<p class="ltx_p" id="S2.SS2.p7.8"><span class="ltx_text ltx_font_bold" id="S2.SS2.p7.8.1">Summary:</span>
The short-term memory layer can be succinctly represented as a function <math alttext="z_{k}^{l},x_{k}^{l},u_{k}^{l}=h(z_{k-1}^{l},x_{k}^{l-1},u_{k}^{l-1})" class="ltx_Math" display="inline" id="S2.SS2.p7.1.m1.6"><semantics id="S2.SS2.p7.1.m1.6a"><mrow id="S2.SS2.p7.1.m1.6.6" xref="S2.SS2.p7.1.m1.6.6.cmml"><mrow id="S2.SS2.p7.1.m1.3.3.3.3" xref="S2.SS2.p7.1.m1.3.3.3.4.cmml"><msubsup id="S2.SS2.p7.1.m1.1.1.1.1.1" xref="S2.SS2.p7.1.m1.1.1.1.1.1.cmml"><mi id="S2.SS2.p7.1.m1.1.1.1.1.1.2.2" xref="S2.SS2.p7.1.m1.1.1.1.1.1.2.2.cmml">z</mi><mi id="S2.SS2.p7.1.m1.1.1.1.1.1.2.3" xref="S2.SS2.p7.1.m1.1.1.1.1.1.2.3.cmml">k</mi><mi id="S2.SS2.p7.1.m1.1.1.1.1.1.3" xref="S2.SS2.p7.1.m1.1.1.1.1.1.3.cmml">l</mi></msubsup><mo id="S2.SS2.p7.1.m1.3.3.3.3.4" xref="S2.SS2.p7.1.m1.3.3.3.4.cmml">,</mo><msubsup id="S2.SS2.p7.1.m1.2.2.2.2.2" xref="S2.SS2.p7.1.m1.2.2.2.2.2.cmml"><mi id="S2.SS2.p7.1.m1.2.2.2.2.2.2.2" xref="S2.SS2.p7.1.m1.2.2.2.2.2.2.2.cmml">x</mi><mi id="S2.SS2.p7.1.m1.2.2.2.2.2.2.3" xref="S2.SS2.p7.1.m1.2.2.2.2.2.2.3.cmml">k</mi><mi id="S2.SS2.p7.1.m1.2.2.2.2.2.3" xref="S2.SS2.p7.1.m1.2.2.2.2.2.3.cmml">l</mi></msubsup><mo id="S2.SS2.p7.1.m1.3.3.3.3.5" xref="S2.SS2.p7.1.m1.3.3.3.4.cmml">,</mo><msubsup id="S2.SS2.p7.1.m1.3.3.3.3.3" xref="S2.SS2.p7.1.m1.3.3.3.3.3.cmml"><mi id="S2.SS2.p7.1.m1.3.3.3.3.3.2.2" xref="S2.SS2.p7.1.m1.3.3.3.3.3.2.2.cmml">u</mi><mi id="S2.SS2.p7.1.m1.3.3.3.3.3.2.3" xref="S2.SS2.p7.1.m1.3.3.3.3.3.2.3.cmml">k</mi><mi id="S2.SS2.p7.1.m1.3.3.3.3.3.3" xref="S2.SS2.p7.1.m1.3.3.3.3.3.3.cmml">l</mi></msubsup></mrow><mo id="S2.SS2.p7.1.m1.6.6.7" xref="S2.SS2.p7.1.m1.6.6.7.cmml">=</mo><mrow id="S2.SS2.p7.1.m1.6.6.6" xref="S2.SS2.p7.1.m1.6.6.6.cmml"><mi id="S2.SS2.p7.1.m1.6.6.6.5" xref="S2.SS2.p7.1.m1.6.6.6.5.cmml">h</mi><mo id="S2.SS2.p7.1.m1.6.6.6.4" xref="S2.SS2.p7.1.m1.6.6.6.4.cmml">⁢</mo><mrow id="S2.SS2.p7.1.m1.6.6.6.3.3" xref="S2.SS2.p7.1.m1.6.6.6.3.4.cmml"><mo id="S2.SS2.p7.1.m1.6.6.6.3.3.4" stretchy="false" xref="S2.SS2.p7.1.m1.6.6.6.3.4.cmml">(</mo><msubsup id="S2.SS2.p7.1.m1.4.4.4.1.1.1" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.cmml"><mi id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.2" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.2.cmml">z</mi><mrow id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.cmml"><mi id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.2" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.2.cmml">k</mi><mo id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.1" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.1.cmml">−</mo><mn id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.3" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.SS2.p7.1.m1.4.4.4.1.1.1.3" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.3.cmml">l</mi></msubsup><mo id="S2.SS2.p7.1.m1.6.6.6.3.3.5" xref="S2.SS2.p7.1.m1.6.6.6.3.4.cmml">,</mo><msubsup id="S2.SS2.p7.1.m1.5.5.5.2.2.2" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.cmml"><mi id="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.2" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.2.cmml">x</mi><mi id="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.3" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.3.cmml">k</mi><mrow id="S2.SS2.p7.1.m1.5.5.5.2.2.2.3" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.cmml"><mi id="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.2" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.2.cmml">l</mi><mo id="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.1" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.1.cmml">−</mo><mn id="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.3" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.3.cmml">1</mn></mrow></msubsup><mo id="S2.SS2.p7.1.m1.6.6.6.3.3.6" xref="S2.SS2.p7.1.m1.6.6.6.3.4.cmml">,</mo><msubsup id="S2.SS2.p7.1.m1.6.6.6.3.3.3" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.cmml"><mi id="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.2" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.2.cmml">u</mi><mi id="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.3" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.3.cmml">k</mi><mrow id="S2.SS2.p7.1.m1.6.6.6.3.3.3.3" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.cmml"><mi id="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.2" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.2.cmml">l</mi><mo id="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.1" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.1.cmml">−</mo><mn id="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.3" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.3.cmml">1</mn></mrow></msubsup><mo id="S2.SS2.p7.1.m1.6.6.6.3.3.7" stretchy="false" xref="S2.SS2.p7.1.m1.6.6.6.3.4.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.1.m1.6b"><apply id="S2.SS2.p7.1.m1.6.6.cmml" xref="S2.SS2.p7.1.m1.6.6"><eq id="S2.SS2.p7.1.m1.6.6.7.cmml" xref="S2.SS2.p7.1.m1.6.6.7"></eq><list id="S2.SS2.p7.1.m1.3.3.3.4.cmml" xref="S2.SS2.p7.1.m1.3.3.3.3"><apply id="S2.SS2.p7.1.m1.1.1.1.1.1.cmml" xref="S2.SS2.p7.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.1.1.1.1.1.1.cmml" xref="S2.SS2.p7.1.m1.1.1.1.1.1">superscript</csymbol><apply id="S2.SS2.p7.1.m1.1.1.1.1.1.2.cmml" xref="S2.SS2.p7.1.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.1.1.1.1.1.2.1.cmml" xref="S2.SS2.p7.1.m1.1.1.1.1.1">subscript</csymbol><ci id="S2.SS2.p7.1.m1.1.1.1.1.1.2.2.cmml" xref="S2.SS2.p7.1.m1.1.1.1.1.1.2.2">𝑧</ci><ci id="S2.SS2.p7.1.m1.1.1.1.1.1.2.3.cmml" xref="S2.SS2.p7.1.m1.1.1.1.1.1.2.3">𝑘</ci></apply><ci id="S2.SS2.p7.1.m1.1.1.1.1.1.3.cmml" xref="S2.SS2.p7.1.m1.1.1.1.1.1.3">𝑙</ci></apply><apply id="S2.SS2.p7.1.m1.2.2.2.2.2.cmml" xref="S2.SS2.p7.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.2.2.2.2.2.1.cmml" xref="S2.SS2.p7.1.m1.2.2.2.2.2">superscript</csymbol><apply id="S2.SS2.p7.1.m1.2.2.2.2.2.2.cmml" xref="S2.SS2.p7.1.m1.2.2.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.2.2.2.2.2.2.1.cmml" xref="S2.SS2.p7.1.m1.2.2.2.2.2">subscript</csymbol><ci id="S2.SS2.p7.1.m1.2.2.2.2.2.2.2.cmml" xref="S2.SS2.p7.1.m1.2.2.2.2.2.2.2">𝑥</ci><ci id="S2.SS2.p7.1.m1.2.2.2.2.2.2.3.cmml" xref="S2.SS2.p7.1.m1.2.2.2.2.2.2.3">𝑘</ci></apply><ci id="S2.SS2.p7.1.m1.2.2.2.2.2.3.cmml" xref="S2.SS2.p7.1.m1.2.2.2.2.2.3">𝑙</ci></apply><apply id="S2.SS2.p7.1.m1.3.3.3.3.3.cmml" xref="S2.SS2.p7.1.m1.3.3.3.3.3"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.3.3.3.3.3.1.cmml" xref="S2.SS2.p7.1.m1.3.3.3.3.3">superscript</csymbol><apply id="S2.SS2.p7.1.m1.3.3.3.3.3.2.cmml" xref="S2.SS2.p7.1.m1.3.3.3.3.3"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.3.3.3.3.3.2.1.cmml" xref="S2.SS2.p7.1.m1.3.3.3.3.3">subscript</csymbol><ci id="S2.SS2.p7.1.m1.3.3.3.3.3.2.2.cmml" xref="S2.SS2.p7.1.m1.3.3.3.3.3.2.2">𝑢</ci><ci id="S2.SS2.p7.1.m1.3.3.3.3.3.2.3.cmml" xref="S2.SS2.p7.1.m1.3.3.3.3.3.2.3">𝑘</ci></apply><ci id="S2.SS2.p7.1.m1.3.3.3.3.3.3.cmml" xref="S2.SS2.p7.1.m1.3.3.3.3.3.3">𝑙</ci></apply></list><apply id="S2.SS2.p7.1.m1.6.6.6.cmml" xref="S2.SS2.p7.1.m1.6.6.6"><times id="S2.SS2.p7.1.m1.6.6.6.4.cmml" xref="S2.SS2.p7.1.m1.6.6.6.4"></times><ci id="S2.SS2.p7.1.m1.6.6.6.5.cmml" xref="S2.SS2.p7.1.m1.6.6.6.5">ℎ</ci><vector id="S2.SS2.p7.1.m1.6.6.6.3.4.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3"><apply id="S2.SS2.p7.1.m1.4.4.4.1.1.1.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.4.4.4.1.1.1.1.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1">superscript</csymbol><apply id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.1.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1">subscript</csymbol><ci id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.2.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.2">𝑧</ci><apply id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3"><minus id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.1.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.1"></minus><ci id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.2.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.2">𝑘</ci><cn id="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.3.cmml" type="integer" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.2.3.3">1</cn></apply></apply><ci id="S2.SS2.p7.1.m1.4.4.4.1.1.1.3.cmml" xref="S2.SS2.p7.1.m1.4.4.4.1.1.1.3">𝑙</ci></apply><apply id="S2.SS2.p7.1.m1.5.5.5.2.2.2.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.5.5.5.2.2.2.1.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2">superscript</csymbol><apply id="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.1.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2">subscript</csymbol><ci id="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.2.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.2">𝑥</ci><ci id="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.3.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.2.3">𝑘</ci></apply><apply id="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.3"><minus id="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.1.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.1"></minus><ci id="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.2.cmml" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.2">𝑙</ci><cn id="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.3.cmml" type="integer" xref="S2.SS2.p7.1.m1.5.5.5.2.2.2.3.3">1</cn></apply></apply><apply id="S2.SS2.p7.1.m1.6.6.6.3.3.3.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.6.6.6.3.3.3.1.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3">superscript</csymbol><apply id="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3"><csymbol cd="ambiguous" id="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.1.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3">subscript</csymbol><ci id="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.2.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.2">𝑢</ci><ci id="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.3.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.2.3">𝑘</ci></apply><apply id="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.3"><minus id="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.1.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.1"></minus><ci id="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.2.cmml" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.2">𝑙</ci><cn id="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.3.cmml" type="integer" xref="S2.SS2.p7.1.m1.6.6.6.3.3.3.3.3">1</cn></apply></apply></vector></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.1.m1.6c">z_{k}^{l},x_{k}^{l},u_{k}^{l}=h(z_{k-1}^{l},x_{k}^{l-1},u_{k}^{l-1})</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p7.1.m1.6d">italic_z start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT , italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT , italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT = italic_h ( italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT , italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT , italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT )</annotation></semantics></math>. This function transforms context tokens <math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p7.2.m2.1"><semantics id="S2.SS2.p7.2.m2.1a"><msubsup id="S2.SS2.p7.2.m2.1.1" xref="S2.SS2.p7.2.m2.1.1.cmml"><mi id="S2.SS2.p7.2.m2.1.1.2.2" xref="S2.SS2.p7.2.m2.1.1.2.2.cmml">x</mi><mi id="S2.SS2.p7.2.m2.1.1.2.3" xref="S2.SS2.p7.2.m2.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p7.2.m2.1.1.3" xref="S2.SS2.p7.2.m2.1.1.3.cmml"><mi id="S2.SS2.p7.2.m2.1.1.3.2" xref="S2.SS2.p7.2.m2.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p7.2.m2.1.1.3.1" xref="S2.SS2.p7.2.m2.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p7.2.m2.1.1.3.3" xref="S2.SS2.p7.2.m2.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.2.m2.1b"><apply id="S2.SS2.p7.2.m2.1.1.cmml" xref="S2.SS2.p7.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.2.m2.1.1.1.cmml" xref="S2.SS2.p7.2.m2.1.1">superscript</csymbol><apply id="S2.SS2.p7.2.m2.1.1.2.cmml" xref="S2.SS2.p7.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.2.m2.1.1.2.1.cmml" xref="S2.SS2.p7.2.m2.1.1">subscript</csymbol><ci id="S2.SS2.p7.2.m2.1.1.2.2.cmml" xref="S2.SS2.p7.2.m2.1.1.2.2">𝑥</ci><ci id="S2.SS2.p7.2.m2.1.1.2.3.cmml" xref="S2.SS2.p7.2.m2.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p7.2.m2.1.1.3.cmml" xref="S2.SS2.p7.2.m2.1.1.3"><minus id="S2.SS2.p7.2.m2.1.1.3.1.cmml" xref="S2.SS2.p7.2.m2.1.1.3.1"></minus><ci id="S2.SS2.p7.2.m2.1.1.3.2.cmml" xref="S2.SS2.p7.2.m2.1.1.3.2">𝑙</ci><cn id="S2.SS2.p7.2.m2.1.1.3.3.cmml" type="integer" xref="S2.SS2.p7.2.m2.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.2.m2.1c">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p7.2.m2.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> and summary tokens <math alttext="u_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.SS2.p7.3.m3.1"><semantics id="S2.SS2.p7.3.m3.1a"><msubsup id="S2.SS2.p7.3.m3.1.1" xref="S2.SS2.p7.3.m3.1.1.cmml"><mi id="S2.SS2.p7.3.m3.1.1.2.2" xref="S2.SS2.p7.3.m3.1.1.2.2.cmml">u</mi><mi id="S2.SS2.p7.3.m3.1.1.2.3" xref="S2.SS2.p7.3.m3.1.1.2.3.cmml">k</mi><mrow id="S2.SS2.p7.3.m3.1.1.3" xref="S2.SS2.p7.3.m3.1.1.3.cmml"><mi id="S2.SS2.p7.3.m3.1.1.3.2" xref="S2.SS2.p7.3.m3.1.1.3.2.cmml">l</mi><mo id="S2.SS2.p7.3.m3.1.1.3.1" xref="S2.SS2.p7.3.m3.1.1.3.1.cmml">−</mo><mn id="S2.SS2.p7.3.m3.1.1.3.3" xref="S2.SS2.p7.3.m3.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.3.m3.1b"><apply id="S2.SS2.p7.3.m3.1.1.cmml" xref="S2.SS2.p7.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.3.m3.1.1.1.cmml" xref="S2.SS2.p7.3.m3.1.1">superscript</csymbol><apply id="S2.SS2.p7.3.m3.1.1.2.cmml" xref="S2.SS2.p7.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.3.m3.1.1.2.1.cmml" xref="S2.SS2.p7.3.m3.1.1">subscript</csymbol><ci id="S2.SS2.p7.3.m3.1.1.2.2.cmml" xref="S2.SS2.p7.3.m3.1.1.2.2">𝑢</ci><ci id="S2.SS2.p7.3.m3.1.1.2.3.cmml" xref="S2.SS2.p7.3.m3.1.1.2.3">𝑘</ci></apply><apply id="S2.SS2.p7.3.m3.1.1.3.cmml" xref="S2.SS2.p7.3.m3.1.1.3"><minus id="S2.SS2.p7.3.m3.1.1.3.1.cmml" xref="S2.SS2.p7.3.m3.1.1.3.1"></minus><ci id="S2.SS2.p7.3.m3.1.1.3.2.cmml" xref="S2.SS2.p7.3.m3.1.1.3.2">𝑙</ci><cn id="S2.SS2.p7.3.m3.1.1.3.3.cmml" type="integer" xref="S2.SS2.p7.3.m3.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.3.m3.1c">u_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p7.3.m3.1d">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math> upward to the next layer (from <math alttext="l-1" class="ltx_Math" display="inline" id="S2.SS2.p7.4.m4.1"><semantics id="S2.SS2.p7.4.m4.1a"><mrow id="S2.SS2.p7.4.m4.1.1" xref="S2.SS2.p7.4.m4.1.1.cmml"><mi id="S2.SS2.p7.4.m4.1.1.2" xref="S2.SS2.p7.4.m4.1.1.2.cmml">l</mi><mo id="S2.SS2.p7.4.m4.1.1.1" xref="S2.SS2.p7.4.m4.1.1.1.cmml">−</mo><mn id="S2.SS2.p7.4.m4.1.1.3" xref="S2.SS2.p7.4.m4.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.4.m4.1b"><apply id="S2.SS2.p7.4.m4.1.1.cmml" xref="S2.SS2.p7.4.m4.1.1"><minus id="S2.SS2.p7.4.m4.1.1.1.cmml" xref="S2.SS2.p7.4.m4.1.1.1"></minus><ci id="S2.SS2.p7.4.m4.1.1.2.cmml" xref="S2.SS2.p7.4.m4.1.1.2">𝑙</ci><cn id="S2.SS2.p7.4.m4.1.1.3.cmml" type="integer" xref="S2.SS2.p7.4.m4.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.4.m4.1c">l-1</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p7.4.m4.1d">italic_l - 1</annotation></semantics></math> to <math alttext="l" class="ltx_Math" display="inline" id="S2.SS2.p7.5.m5.1"><semantics id="S2.SS2.p7.5.m5.1a"><mi id="S2.SS2.p7.5.m5.1.1" xref="S2.SS2.p7.5.m5.1.1.cmml">l</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.5.m5.1b"><ci id="S2.SS2.p7.5.m5.1.1.cmml" xref="S2.SS2.p7.5.m5.1.1">𝑙</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.5.m5.1c">l</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p7.5.m5.1d">italic_l</annotation></semantics></math>) while simultaneously propagating short-term memory <math alttext="z_{k-1}^{l}" class="ltx_Math" display="inline" id="S2.SS2.p7.6.m6.1"><semantics id="S2.SS2.p7.6.m6.1a"><msubsup id="S2.SS2.p7.6.m6.1.1" xref="S2.SS2.p7.6.m6.1.1.cmml"><mi id="S2.SS2.p7.6.m6.1.1.2.2" xref="S2.SS2.p7.6.m6.1.1.2.2.cmml">z</mi><mrow id="S2.SS2.p7.6.m6.1.1.2.3" xref="S2.SS2.p7.6.m6.1.1.2.3.cmml"><mi id="S2.SS2.p7.6.m6.1.1.2.3.2" xref="S2.SS2.p7.6.m6.1.1.2.3.2.cmml">k</mi><mo id="S2.SS2.p7.6.m6.1.1.2.3.1" xref="S2.SS2.p7.6.m6.1.1.2.3.1.cmml">−</mo><mn id="S2.SS2.p7.6.m6.1.1.2.3.3" xref="S2.SS2.p7.6.m6.1.1.2.3.3.cmml">1</mn></mrow><mi id="S2.SS2.p7.6.m6.1.1.3" xref="S2.SS2.p7.6.m6.1.1.3.cmml">l</mi></msubsup><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.6.m6.1b"><apply id="S2.SS2.p7.6.m6.1.1.cmml" xref="S2.SS2.p7.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.6.m6.1.1.1.cmml" xref="S2.SS2.p7.6.m6.1.1">superscript</csymbol><apply id="S2.SS2.p7.6.m6.1.1.2.cmml" xref="S2.SS2.p7.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS2.p7.6.m6.1.1.2.1.cmml" xref="S2.SS2.p7.6.m6.1.1">subscript</csymbol><ci id="S2.SS2.p7.6.m6.1.1.2.2.cmml" xref="S2.SS2.p7.6.m6.1.1.2.2">𝑧</ci><apply id="S2.SS2.p7.6.m6.1.1.2.3.cmml" xref="S2.SS2.p7.6.m6.1.1.2.3"><minus id="S2.SS2.p7.6.m6.1.1.2.3.1.cmml" xref="S2.SS2.p7.6.m6.1.1.2.3.1"></minus><ci id="S2.SS2.p7.6.m6.1.1.2.3.2.cmml" xref="S2.SS2.p7.6.m6.1.1.2.3.2">𝑘</ci><cn id="S2.SS2.p7.6.m6.1.1.2.3.3.cmml" type="integer" xref="S2.SS2.p7.6.m6.1.1.2.3.3">1</cn></apply></apply><ci id="S2.SS2.p7.6.m6.1.1.3.cmml" xref="S2.SS2.p7.6.m6.1.1.3">𝑙</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.6.m6.1c">z_{k-1}^{l}</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p7.6.m6.1d">italic_z start_POSTSUBSCRIPT italic_k - 1 end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l end_POSTSUPERSCRIPT</annotation></semantics></math> rightward to the next window (from <math alttext="k-1" class="ltx_Math" display="inline" id="S2.SS2.p7.7.m7.1"><semantics id="S2.SS2.p7.7.m7.1a"><mrow id="S2.SS2.p7.7.m7.1.1" xref="S2.SS2.p7.7.m7.1.1.cmml"><mi id="S2.SS2.p7.7.m7.1.1.2" xref="S2.SS2.p7.7.m7.1.1.2.cmml">k</mi><mo id="S2.SS2.p7.7.m7.1.1.1" xref="S2.SS2.p7.7.m7.1.1.1.cmml">−</mo><mn id="S2.SS2.p7.7.m7.1.1.3" xref="S2.SS2.p7.7.m7.1.1.3.cmml">1</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.7.m7.1b"><apply id="S2.SS2.p7.7.m7.1.1.cmml" xref="S2.SS2.p7.7.m7.1.1"><minus id="S2.SS2.p7.7.m7.1.1.1.cmml" xref="S2.SS2.p7.7.m7.1.1.1"></minus><ci id="S2.SS2.p7.7.m7.1.1.2.cmml" xref="S2.SS2.p7.7.m7.1.1.2">𝑘</ci><cn id="S2.SS2.p7.7.m7.1.1.3.cmml" type="integer" xref="S2.SS2.p7.7.m7.1.1.3">1</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.7.m7.1c">k-1</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p7.7.m7.1d">italic_k - 1</annotation></semantics></math> to <math alttext="k" class="ltx_Math" display="inline" id="S2.SS2.p7.8.m8.1"><semantics id="S2.SS2.p7.8.m8.1a"><mi id="S2.SS2.p7.8.m8.1.1" xref="S2.SS2.p7.8.m8.1.1.cmml">k</mi><annotation-xml encoding="MathML-Content" id="S2.SS2.p7.8.m8.1b"><ci id="S2.SS2.p7.8.m8.1.1.cmml" xref="S2.SS2.p7.8.m8.1.1">𝑘</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS2.p7.8.m8.1c">k</annotation><annotation encoding="application/x-llamapun" id="S2.SS2.p7.8.m8.1d">italic_k</annotation></semantics></math>). Built upon a standard transformer block, this layer introduces negligible additional parameters through the summary branching mechanism.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS2.p8">
<p class="ltx_p" id="S2.SS2.p8.1"><span class="ltx_text ltx_font_bold" id="S2.SS2.p8.1.1">Relation to Block Recurrent Transformer (BRT) <cite class="ltx_cite ltx_citemacro_citep">(Hutchins et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib15" title="">2022</a>)</cite>:</span>
While BRT represents short-term memory by combining multi-layer KV caching from Transformer XL with a dedicated recurrent memory layer, Melodi models short-term memory as a consistent recurrent compression mechanism across multiple layers. Moreover, <span class="ltx_text ltx_font_smallcaps" id="S2.SS2.p8.1.2">Melodi</span> updates the short-term tokens by adding residual connections (cross-attending to the previous memory) over the previous layer, instead of over the previous memory tokens directly as in BRT.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS2.p9">
<p class="ltx_p" id="S2.SS2.p9.1">While short-term memory facilitates smooth transitions between context windows, the inherent limitation of its capacity can lead to the inevitable loss of information, particularly for contexts located further back in the sequence. In the following subsection, we will demonstrate how long-term memory can be leveraged to mitigate this forgetting issue.</p>
</div>
</section>
<section class="ltx_subsection" id="S2.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">2.3 </span>Long-Term Memory: Single-Layer Memorizing Compressed Key-Value Pairs</h3>
<figure class="ltx_figure" id="S2.F3">
<p class="ltx_p ltx_align_center ltx_align_center" id="S2.F3.1.1"><span class="ltx_text" id="S2.F3.1.1.1"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="304" id="S2.F3.1.1.1.g1" src="extracted/5900799/figure/long-term.png" width="538"/></span></p>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 3: </span><span class="ltx_text ltx_font_bold" id="S2.F3.13.1">Long-term layer.</span> The long-term layer adds three components on top of the short-term layer (see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2.F2" title="Figure 2 ‣ 2.2 Short-Term Memory: Multi-Layer Recurrent Compression ‣ 2 Our Method: Melodi ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">2</span></a>). Firstly, it introduces a long-term memory <math alttext="m_{1:k-1}" class="ltx_Math" display="inline" id="S2.F3.7.7.m1.1"><semantics id="S2.F3.7.7.m1.1b"><msub id="S2.F3.7.7.m1.1.1" xref="S2.F3.7.7.m1.1.1.cmml"><mi id="S2.F3.7.7.m1.1.1.2" xref="S2.F3.7.7.m1.1.1.2.cmml">m</mi><mrow id="S2.F3.7.7.m1.1.1.3" xref="S2.F3.7.7.m1.1.1.3.cmml"><mn id="S2.F3.7.7.m1.1.1.3.2" xref="S2.F3.7.7.m1.1.1.3.2.cmml">1</mn><mo id="S2.F3.7.7.m1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="S2.F3.7.7.m1.1.1.3.1.cmml">:</mo><mrow id="S2.F3.7.7.m1.1.1.3.3" xref="S2.F3.7.7.m1.1.1.3.3.cmml"><mi id="S2.F3.7.7.m1.1.1.3.3.2" xref="S2.F3.7.7.m1.1.1.3.3.2.cmml">k</mi><mo id="S2.F3.7.7.m1.1.1.3.3.1" xref="S2.F3.7.7.m1.1.1.3.3.1.cmml">−</mo><mn id="S2.F3.7.7.m1.1.1.3.3.3" xref="S2.F3.7.7.m1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.F3.7.7.m1.1c"><apply id="S2.F3.7.7.m1.1.1.cmml" xref="S2.F3.7.7.m1.1.1"><csymbol cd="ambiguous" id="S2.F3.7.7.m1.1.1.1.cmml" xref="S2.F3.7.7.m1.1.1">subscript</csymbol><ci id="S2.F3.7.7.m1.1.1.2.cmml" xref="S2.F3.7.7.m1.1.1.2">𝑚</ci><apply id="S2.F3.7.7.m1.1.1.3.cmml" xref="S2.F3.7.7.m1.1.1.3"><ci id="S2.F3.7.7.m1.1.1.3.1.cmml" xref="S2.F3.7.7.m1.1.1.3.1">:</ci><cn id="S2.F3.7.7.m1.1.1.3.2.cmml" type="integer" xref="S2.F3.7.7.m1.1.1.3.2">1</cn><apply id="S2.F3.7.7.m1.1.1.3.3.cmml" xref="S2.F3.7.7.m1.1.1.3.3"><minus id="S2.F3.7.7.m1.1.1.3.3.1.cmml" xref="S2.F3.7.7.m1.1.1.3.3.1"></minus><ci id="S2.F3.7.7.m1.1.1.3.3.2.cmml" xref="S2.F3.7.7.m1.1.1.3.3.2">𝑘</ci><cn id="S2.F3.7.7.m1.1.1.3.3.3.cmml" type="integer" xref="S2.F3.7.7.m1.1.1.3.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.7.7.m1.1d">m_{1:k-1}</annotation><annotation encoding="application/x-llamapun" id="S2.F3.7.7.m1.1e">italic_m start_POSTSUBSCRIPT 1 : italic_k - 1 end_POSTSUBSCRIPT</annotation></semantics></math> by caching the compressed key-value pairs and allows the current context/summary (<math alttext="x_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.F3.8.8.m2.1"><semantics id="S2.F3.8.8.m2.1b"><msubsup id="S2.F3.8.8.m2.1.1" xref="S2.F3.8.8.m2.1.1.cmml"><mi id="S2.F3.8.8.m2.1.1.2.2" xref="S2.F3.8.8.m2.1.1.2.2.cmml">x</mi><mi id="S2.F3.8.8.m2.1.1.2.3" xref="S2.F3.8.8.m2.1.1.2.3.cmml">k</mi><mrow id="S2.F3.8.8.m2.1.1.3" xref="S2.F3.8.8.m2.1.1.3.cmml"><mi id="S2.F3.8.8.m2.1.1.3.2" xref="S2.F3.8.8.m2.1.1.3.2.cmml">l</mi><mo id="S2.F3.8.8.m2.1.1.3.1" xref="S2.F3.8.8.m2.1.1.3.1.cmml">−</mo><mn id="S2.F3.8.8.m2.1.1.3.3" xref="S2.F3.8.8.m2.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.F3.8.8.m2.1c"><apply id="S2.F3.8.8.m2.1.1.cmml" xref="S2.F3.8.8.m2.1.1"><csymbol cd="ambiguous" id="S2.F3.8.8.m2.1.1.1.cmml" xref="S2.F3.8.8.m2.1.1">superscript</csymbol><apply id="S2.F3.8.8.m2.1.1.2.cmml" xref="S2.F3.8.8.m2.1.1"><csymbol cd="ambiguous" id="S2.F3.8.8.m2.1.1.2.1.cmml" xref="S2.F3.8.8.m2.1.1">subscript</csymbol><ci id="S2.F3.8.8.m2.1.1.2.2.cmml" xref="S2.F3.8.8.m2.1.1.2.2">𝑥</ci><ci id="S2.F3.8.8.m2.1.1.2.3.cmml" xref="S2.F3.8.8.m2.1.1.2.3">𝑘</ci></apply><apply id="S2.F3.8.8.m2.1.1.3.cmml" xref="S2.F3.8.8.m2.1.1.3"><minus id="S2.F3.8.8.m2.1.1.3.1.cmml" xref="S2.F3.8.8.m2.1.1.3.1"></minus><ci id="S2.F3.8.8.m2.1.1.3.2.cmml" xref="S2.F3.8.8.m2.1.1.3.2">𝑙</ci><cn id="S2.F3.8.8.m2.1.1.3.3.cmml" type="integer" xref="S2.F3.8.8.m2.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.8.8.m2.1d">x_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.F3.8.8.m2.1e">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>, <math alttext="u_{k}^{l-1}" class="ltx_Math" display="inline" id="S2.F3.9.9.m3.1"><semantics id="S2.F3.9.9.m3.1b"><msubsup id="S2.F3.9.9.m3.1.1" xref="S2.F3.9.9.m3.1.1.cmml"><mi id="S2.F3.9.9.m3.1.1.2.2" xref="S2.F3.9.9.m3.1.1.2.2.cmml">u</mi><mi id="S2.F3.9.9.m3.1.1.2.3" xref="S2.F3.9.9.m3.1.1.2.3.cmml">k</mi><mrow id="S2.F3.9.9.m3.1.1.3" xref="S2.F3.9.9.m3.1.1.3.cmml"><mi id="S2.F3.9.9.m3.1.1.3.2" xref="S2.F3.9.9.m3.1.1.3.2.cmml">l</mi><mo id="S2.F3.9.9.m3.1.1.3.1" xref="S2.F3.9.9.m3.1.1.3.1.cmml">−</mo><mn id="S2.F3.9.9.m3.1.1.3.3" xref="S2.F3.9.9.m3.1.1.3.3.cmml">1</mn></mrow></msubsup><annotation-xml encoding="MathML-Content" id="S2.F3.9.9.m3.1c"><apply id="S2.F3.9.9.m3.1.1.cmml" xref="S2.F3.9.9.m3.1.1"><csymbol cd="ambiguous" id="S2.F3.9.9.m3.1.1.1.cmml" xref="S2.F3.9.9.m3.1.1">superscript</csymbol><apply id="S2.F3.9.9.m3.1.1.2.cmml" xref="S2.F3.9.9.m3.1.1"><csymbol cd="ambiguous" id="S2.F3.9.9.m3.1.1.2.1.cmml" xref="S2.F3.9.9.m3.1.1">subscript</csymbol><ci id="S2.F3.9.9.m3.1.1.2.2.cmml" xref="S2.F3.9.9.m3.1.1.2.2">𝑢</ci><ci id="S2.F3.9.9.m3.1.1.2.3.cmml" xref="S2.F3.9.9.m3.1.1.2.3">𝑘</ci></apply><apply id="S2.F3.9.9.m3.1.1.3.cmml" xref="S2.F3.9.9.m3.1.1.3"><minus id="S2.F3.9.9.m3.1.1.3.1.cmml" xref="S2.F3.9.9.m3.1.1.3.1"></minus><ci id="S2.F3.9.9.m3.1.1.3.2.cmml" xref="S2.F3.9.9.m3.1.1.3.2">𝑙</ci><cn id="S2.F3.9.9.m3.1.1.3.3.cmml" type="integer" xref="S2.F3.9.9.m3.1.1.3.3">1</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.9.9.m3.1d">u_{k}^{l-1}</annotation><annotation encoding="application/x-llamapun" id="S2.F3.9.9.m3.1e">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT start_POSTSUPERSCRIPT italic_l - 1 end_POSTSUPERSCRIPT</annotation></semantics></math>) to cross attend to them. Secondly, the self-attention and cross-attention are integrated via gating. Finally, the linear token mixing output additional compressed tokens and appends their key-value pairs <math alttext="m_{k}" class="ltx_Math" display="inline" id="S2.F3.10.10.m4.1"><semantics id="S2.F3.10.10.m4.1b"><msub id="S2.F3.10.10.m4.1.1" xref="S2.F3.10.10.m4.1.1.cmml"><mi id="S2.F3.10.10.m4.1.1.2" xref="S2.F3.10.10.m4.1.1.2.cmml">m</mi><mi id="S2.F3.10.10.m4.1.1.3" xref="S2.F3.10.10.m4.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S2.F3.10.10.m4.1c"><apply id="S2.F3.10.10.m4.1.1.cmml" xref="S2.F3.10.10.m4.1.1"><csymbol cd="ambiguous" id="S2.F3.10.10.m4.1.1.1.cmml" xref="S2.F3.10.10.m4.1.1">subscript</csymbol><ci id="S2.F3.10.10.m4.1.1.2.cmml" xref="S2.F3.10.10.m4.1.1.2">𝑚</ci><ci id="S2.F3.10.10.m4.1.1.3.cmml" xref="S2.F3.10.10.m4.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.10.10.m4.1d">m_{k}</annotation><annotation encoding="application/x-llamapun" id="S2.F3.10.10.m4.1e">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> into the long-term memory (as <math alttext="m_{1:k}" class="ltx_Math" display="inline" id="S2.F3.11.11.m5.1"><semantics id="S2.F3.11.11.m5.1b"><msub id="S2.F3.11.11.m5.1.1" xref="S2.F3.11.11.m5.1.1.cmml"><mi id="S2.F3.11.11.m5.1.1.2" xref="S2.F3.11.11.m5.1.1.2.cmml">m</mi><mrow id="S2.F3.11.11.m5.1.1.3" xref="S2.F3.11.11.m5.1.1.3.cmml"><mn id="S2.F3.11.11.m5.1.1.3.2" xref="S2.F3.11.11.m5.1.1.3.2.cmml">1</mn><mo id="S2.F3.11.11.m5.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="S2.F3.11.11.m5.1.1.3.1.cmml">:</mo><mi id="S2.F3.11.11.m5.1.1.3.3" xref="S2.F3.11.11.m5.1.1.3.3.cmml">k</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.F3.11.11.m5.1c"><apply id="S2.F3.11.11.m5.1.1.cmml" xref="S2.F3.11.11.m5.1.1"><csymbol cd="ambiguous" id="S2.F3.11.11.m5.1.1.1.cmml" xref="S2.F3.11.11.m5.1.1">subscript</csymbol><ci id="S2.F3.11.11.m5.1.1.2.cmml" xref="S2.F3.11.11.m5.1.1.2">𝑚</ci><apply id="S2.F3.11.11.m5.1.1.3.cmml" xref="S2.F3.11.11.m5.1.1.3"><ci id="S2.F3.11.11.m5.1.1.3.1.cmml" xref="S2.F3.11.11.m5.1.1.3.1">:</ci><cn id="S2.F3.11.11.m5.1.1.3.2.cmml" type="integer" xref="S2.F3.11.11.m5.1.1.3.2">1</cn><ci id="S2.F3.11.11.m5.1.1.3.3.cmml" xref="S2.F3.11.11.m5.1.1.3.3">𝑘</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.F3.11.11.m5.1d">m_{1:k}</annotation><annotation encoding="application/x-llamapun" id="S2.F3.11.11.m5.1e">italic_m start_POSTSUBSCRIPT 1 : italic_k end_POSTSUBSCRIPT</annotation></semantics></math>) for the next window. Best viewed in color.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S2.SS3.p1">
<p class="ltx_p" id="S2.SS3.p1.1">In this subsection, we utilize long-term memory to retain information from all previous windows, thereby alleviating the forgetting inherent in short-term memory. The key idea involves further compressing the context window and storing the compressed representations across the entire history.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS3.p2">
<p class="ltx_p" id="S2.SS3.p2.5"><span class="ltx_text ltx_font_bold" id="S2.SS3.p2.5.1">Further compression:</span>
In contrast to the short-term memory, which compresses information across multiple layers, the long-term memory achieves a higher compression rate within <span class="ltx_text ltx_font_italic" id="S2.SS3.p2.5.2">a single layer</span>. Specifically, it compresses a context window into <math alttext="L" class="ltx_Math" display="inline" id="S2.SS3.p2.1.m1.1"><semantics id="S2.SS3.p2.1.m1.1a"><mi id="S2.SS3.p2.1.m1.1.1" xref="S2.SS3.p2.1.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p2.1.m1.1b"><ci id="S2.SS3.p2.1.m1.1.1.cmml" xref="S2.SS3.p2.1.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p2.1.m1.1c">L</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p2.1.m1.1d">italic_L</annotation></semantics></math> long-term tokens at a designated middle layer (refer to Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S1.F1" title="Figure 1 ‣ 1 Introduction ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">1</span></a>), where <math alttext="L" class="ltx_Math" display="inline" id="S2.SS3.p2.2.m2.1"><semantics id="S2.SS3.p2.2.m2.1a"><mi id="S2.SS3.p2.2.m2.1.1" xref="S2.SS3.p2.2.m2.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p2.2.m2.1b"><ci id="S2.SS3.p2.2.m2.1.1.cmml" xref="S2.SS3.p2.2.m2.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p2.2.m2.1c">L</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p2.2.m2.1d">italic_L</annotation></semantics></math> is less than the number of short-term tokens per layer (<math alttext="L&lt;S" class="ltx_Math" display="inline" id="S2.SS3.p2.3.m3.1"><semantics id="S2.SS3.p2.3.m3.1a"><mrow id="S2.SS3.p2.3.m3.1.1" xref="S2.SS3.p2.3.m3.1.1.cmml"><mi id="S2.SS3.p2.3.m3.1.1.2" xref="S2.SS3.p2.3.m3.1.1.2.cmml">L</mi><mo id="S2.SS3.p2.3.m3.1.1.1" xref="S2.SS3.p2.3.m3.1.1.1.cmml">&lt;</mo><mi id="S2.SS3.p2.3.m3.1.1.3" xref="S2.SS3.p2.3.m3.1.1.3.cmml">S</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p2.3.m3.1b"><apply id="S2.SS3.p2.3.m3.1.1.cmml" xref="S2.SS3.p2.3.m3.1.1"><lt id="S2.SS3.p2.3.m3.1.1.1.cmml" xref="S2.SS3.p2.3.m3.1.1.1"></lt><ci id="S2.SS3.p2.3.m3.1.1.2.cmml" xref="S2.SS3.p2.3.m3.1.1.2">𝐿</ci><ci id="S2.SS3.p2.3.m3.1.1.3.cmml" xref="S2.SS3.p2.3.m3.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p2.3.m3.1c">L&lt;S</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p2.3.m3.1d">italic_L &lt; italic_S</annotation></semantics></math>). Illustratively, we might compress a context window of 512 tokens into <math alttext="S=128" class="ltx_Math" display="inline" id="S2.SS3.p2.4.m4.1"><semantics id="S2.SS3.p2.4.m4.1a"><mrow id="S2.SS3.p2.4.m4.1.1" xref="S2.SS3.p2.4.m4.1.1.cmml"><mi id="S2.SS3.p2.4.m4.1.1.2" xref="S2.SS3.p2.4.m4.1.1.2.cmml">S</mi><mo id="S2.SS3.p2.4.m4.1.1.1" xref="S2.SS3.p2.4.m4.1.1.1.cmml">=</mo><mn id="S2.SS3.p2.4.m4.1.1.3" xref="S2.SS3.p2.4.m4.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p2.4.m4.1b"><apply id="S2.SS3.p2.4.m4.1.1.cmml" xref="S2.SS3.p2.4.m4.1.1"><eq id="S2.SS3.p2.4.m4.1.1.1.cmml" xref="S2.SS3.p2.4.m4.1.1.1"></eq><ci id="S2.SS3.p2.4.m4.1.1.2.cmml" xref="S2.SS3.p2.4.m4.1.1.2">𝑆</ci><cn id="S2.SS3.p2.4.m4.1.1.3.cmml" type="integer" xref="S2.SS3.p2.4.m4.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p2.4.m4.1c">S=128</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p2.4.m4.1d">italic_S = 128</annotation></semantics></math> short-term tokens at each layer, but further condense it into <math alttext="L=64" class="ltx_Math" display="inline" id="S2.SS3.p2.5.m5.1"><semantics id="S2.SS3.p2.5.m5.1a"><mrow id="S2.SS3.p2.5.m5.1.1" xref="S2.SS3.p2.5.m5.1.1.cmml"><mi id="S2.SS3.p2.5.m5.1.1.2" xref="S2.SS3.p2.5.m5.1.1.2.cmml">L</mi><mo id="S2.SS3.p2.5.m5.1.1.1" xref="S2.SS3.p2.5.m5.1.1.1.cmml">=</mo><mn id="S2.SS3.p2.5.m5.1.1.3" xref="S2.SS3.p2.5.m5.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p2.5.m5.1b"><apply id="S2.SS3.p2.5.m5.1.1.cmml" xref="S2.SS3.p2.5.m5.1.1"><eq id="S2.SS3.p2.5.m5.1.1.1.cmml" xref="S2.SS3.p2.5.m5.1.1.1"></eq><ci id="S2.SS3.p2.5.m5.1.1.2.cmml" xref="S2.SS3.p2.5.m5.1.1.2">𝐿</ci><cn id="S2.SS3.p2.5.m5.1.1.3.cmml" type="integer" xref="S2.SS3.p2.5.m5.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p2.5.m5.1c">L=64</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p2.5.m5.1d">italic_L = 64</annotation></semantics></math> long-term tokens at a single layer.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS3.p3">
<p class="ltx_p" id="S2.SS3.p3.5"><span class="ltx_text ltx_font_bold" id="S2.SS3.p3.5.1">Storing long-term memory:</span>
The key-value (KV) pairs of long-term tokens are sequentially stored in a first-in-first-out (FIFO) queue with a maximum capacity of <math alttext="Q_{max}" class="ltx_Math" display="inline" id="S2.SS3.p3.1.m1.1"><semantics id="S2.SS3.p3.1.m1.1a"><msub id="S2.SS3.p3.1.m1.1.1" xref="S2.SS3.p3.1.m1.1.1.cmml"><mi id="S2.SS3.p3.1.m1.1.1.2" xref="S2.SS3.p3.1.m1.1.1.2.cmml">Q</mi><mrow id="S2.SS3.p3.1.m1.1.1.3" xref="S2.SS3.p3.1.m1.1.1.3.cmml"><mi id="S2.SS3.p3.1.m1.1.1.3.2" xref="S2.SS3.p3.1.m1.1.1.3.2.cmml">m</mi><mo id="S2.SS3.p3.1.m1.1.1.3.1" xref="S2.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.1.m1.1.1.3.3" xref="S2.SS3.p3.1.m1.1.1.3.3.cmml">a</mi><mo id="S2.SS3.p3.1.m1.1.1.3.1a" xref="S2.SS3.p3.1.m1.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.1.m1.1.1.3.4" xref="S2.SS3.p3.1.m1.1.1.3.4.cmml">x</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p3.1.m1.1b"><apply id="S2.SS3.p3.1.m1.1.1.cmml" xref="S2.SS3.p3.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS3.p3.1.m1.1.1.1.cmml" xref="S2.SS3.p3.1.m1.1.1">subscript</csymbol><ci id="S2.SS3.p3.1.m1.1.1.2.cmml" xref="S2.SS3.p3.1.m1.1.1.2">𝑄</ci><apply id="S2.SS3.p3.1.m1.1.1.3.cmml" xref="S2.SS3.p3.1.m1.1.1.3"><times id="S2.SS3.p3.1.m1.1.1.3.1.cmml" xref="S2.SS3.p3.1.m1.1.1.3.1"></times><ci id="S2.SS3.p3.1.m1.1.1.3.2.cmml" xref="S2.SS3.p3.1.m1.1.1.3.2">𝑚</ci><ci id="S2.SS3.p3.1.m1.1.1.3.3.cmml" xref="S2.SS3.p3.1.m1.1.1.3.3">𝑎</ci><ci id="S2.SS3.p3.1.m1.1.1.3.4.cmml" xref="S2.SS3.p3.1.m1.1.1.3.4">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p3.1.m1.1c">Q_{max}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p3.1.m1.1d">italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> windows. Consequently, the long-term memory can hold up to <math alttext="L\times Q_{max}" class="ltx_Math" display="inline" id="S2.SS3.p3.2.m2.1"><semantics id="S2.SS3.p3.2.m2.1a"><mrow id="S2.SS3.p3.2.m2.1.1" xref="S2.SS3.p3.2.m2.1.1.cmml"><mi id="S2.SS3.p3.2.m2.1.1.2" xref="S2.SS3.p3.2.m2.1.1.2.cmml">L</mi><mo id="S2.SS3.p3.2.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S2.SS3.p3.2.m2.1.1.1.cmml">×</mo><msub id="S2.SS3.p3.2.m2.1.1.3" xref="S2.SS3.p3.2.m2.1.1.3.cmml"><mi id="S2.SS3.p3.2.m2.1.1.3.2" xref="S2.SS3.p3.2.m2.1.1.3.2.cmml">Q</mi><mrow id="S2.SS3.p3.2.m2.1.1.3.3" xref="S2.SS3.p3.2.m2.1.1.3.3.cmml"><mi id="S2.SS3.p3.2.m2.1.1.3.3.2" xref="S2.SS3.p3.2.m2.1.1.3.3.2.cmml">m</mi><mo id="S2.SS3.p3.2.m2.1.1.3.3.1" xref="S2.SS3.p3.2.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.2.m2.1.1.3.3.3" xref="S2.SS3.p3.2.m2.1.1.3.3.3.cmml">a</mi><mo id="S2.SS3.p3.2.m2.1.1.3.3.1a" xref="S2.SS3.p3.2.m2.1.1.3.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.2.m2.1.1.3.3.4" xref="S2.SS3.p3.2.m2.1.1.3.3.4.cmml">x</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p3.2.m2.1b"><apply id="S2.SS3.p3.2.m2.1.1.cmml" xref="S2.SS3.p3.2.m2.1.1"><times id="S2.SS3.p3.2.m2.1.1.1.cmml" xref="S2.SS3.p3.2.m2.1.1.1"></times><ci id="S2.SS3.p3.2.m2.1.1.2.cmml" xref="S2.SS3.p3.2.m2.1.1.2">𝐿</ci><apply id="S2.SS3.p3.2.m2.1.1.3.cmml" xref="S2.SS3.p3.2.m2.1.1.3"><csymbol cd="ambiguous" id="S2.SS3.p3.2.m2.1.1.3.1.cmml" xref="S2.SS3.p3.2.m2.1.1.3">subscript</csymbol><ci id="S2.SS3.p3.2.m2.1.1.3.2.cmml" xref="S2.SS3.p3.2.m2.1.1.3.2">𝑄</ci><apply id="S2.SS3.p3.2.m2.1.1.3.3.cmml" xref="S2.SS3.p3.2.m2.1.1.3.3"><times id="S2.SS3.p3.2.m2.1.1.3.3.1.cmml" xref="S2.SS3.p3.2.m2.1.1.3.3.1"></times><ci id="S2.SS3.p3.2.m2.1.1.3.3.2.cmml" xref="S2.SS3.p3.2.m2.1.1.3.3.2">𝑚</ci><ci id="S2.SS3.p3.2.m2.1.1.3.3.3.cmml" xref="S2.SS3.p3.2.m2.1.1.3.3.3">𝑎</ci><ci id="S2.SS3.p3.2.m2.1.1.3.3.4.cmml" xref="S2.SS3.p3.2.m2.1.1.3.3.4">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p3.2.m2.1c">L\times Q_{max}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p3.2.m2.1d">italic_L × italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> KV pairs. For contexts shorter than <math alttext="Q_{max}" class="ltx_Math" display="inline" id="S2.SS3.p3.3.m3.1"><semantics id="S2.SS3.p3.3.m3.1a"><msub id="S2.SS3.p3.3.m3.1.1" xref="S2.SS3.p3.3.m3.1.1.cmml"><mi id="S2.SS3.p3.3.m3.1.1.2" xref="S2.SS3.p3.3.m3.1.1.2.cmml">Q</mi><mrow id="S2.SS3.p3.3.m3.1.1.3" xref="S2.SS3.p3.3.m3.1.1.3.cmml"><mi id="S2.SS3.p3.3.m3.1.1.3.2" xref="S2.SS3.p3.3.m3.1.1.3.2.cmml">m</mi><mo id="S2.SS3.p3.3.m3.1.1.3.1" xref="S2.SS3.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.3.m3.1.1.3.3" xref="S2.SS3.p3.3.m3.1.1.3.3.cmml">a</mi><mo id="S2.SS3.p3.3.m3.1.1.3.1a" xref="S2.SS3.p3.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.3.m3.1.1.3.4" xref="S2.SS3.p3.3.m3.1.1.3.4.cmml">x</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p3.3.m3.1b"><apply id="S2.SS3.p3.3.m3.1.1.cmml" xref="S2.SS3.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS3.p3.3.m3.1.1.1.cmml" xref="S2.SS3.p3.3.m3.1.1">subscript</csymbol><ci id="S2.SS3.p3.3.m3.1.1.2.cmml" xref="S2.SS3.p3.3.m3.1.1.2">𝑄</ci><apply id="S2.SS3.p3.3.m3.1.1.3.cmml" xref="S2.SS3.p3.3.m3.1.1.3"><times id="S2.SS3.p3.3.m3.1.1.3.1.cmml" xref="S2.SS3.p3.3.m3.1.1.3.1"></times><ci id="S2.SS3.p3.3.m3.1.1.3.2.cmml" xref="S2.SS3.p3.3.m3.1.1.3.2">𝑚</ci><ci id="S2.SS3.p3.3.m3.1.1.3.3.cmml" xref="S2.SS3.p3.3.m3.1.1.3.3">𝑎</ci><ci id="S2.SS3.p3.3.m3.1.1.3.4.cmml" xref="S2.SS3.p3.3.m3.1.1.3.4">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p3.3.m3.1c">Q_{max}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p3.3.m3.1d">italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> windows, a compressed representation of the entire prior history is preserved. For longer documents exceeding <math alttext="Q_{max}" class="ltx_Math" display="inline" id="S2.SS3.p3.4.m4.1"><semantics id="S2.SS3.p3.4.m4.1a"><msub id="S2.SS3.p3.4.m4.1.1" xref="S2.SS3.p3.4.m4.1.1.cmml"><mi id="S2.SS3.p3.4.m4.1.1.2" xref="S2.SS3.p3.4.m4.1.1.2.cmml">Q</mi><mrow id="S2.SS3.p3.4.m4.1.1.3" xref="S2.SS3.p3.4.m4.1.1.3.cmml"><mi id="S2.SS3.p3.4.m4.1.1.3.2" xref="S2.SS3.p3.4.m4.1.1.3.2.cmml">m</mi><mo id="S2.SS3.p3.4.m4.1.1.3.1" xref="S2.SS3.p3.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.4.m4.1.1.3.3" xref="S2.SS3.p3.4.m4.1.1.3.3.cmml">a</mi><mo id="S2.SS3.p3.4.m4.1.1.3.1a" xref="S2.SS3.p3.4.m4.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.4.m4.1.1.3.4" xref="S2.SS3.p3.4.m4.1.1.3.4.cmml">x</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p3.4.m4.1b"><apply id="S2.SS3.p3.4.m4.1.1.cmml" xref="S2.SS3.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS3.p3.4.m4.1.1.1.cmml" xref="S2.SS3.p3.4.m4.1.1">subscript</csymbol><ci id="S2.SS3.p3.4.m4.1.1.2.cmml" xref="S2.SS3.p3.4.m4.1.1.2">𝑄</ci><apply id="S2.SS3.p3.4.m4.1.1.3.cmml" xref="S2.SS3.p3.4.m4.1.1.3"><times id="S2.SS3.p3.4.m4.1.1.3.1.cmml" xref="S2.SS3.p3.4.m4.1.1.3.1"></times><ci id="S2.SS3.p3.4.m4.1.1.3.2.cmml" xref="S2.SS3.p3.4.m4.1.1.3.2">𝑚</ci><ci id="S2.SS3.p3.4.m4.1.1.3.3.cmml" xref="S2.SS3.p3.4.m4.1.1.3.3">𝑎</ci><ci id="S2.SS3.p3.4.m4.1.1.3.4.cmml" xref="S2.SS3.p3.4.m4.1.1.3.4">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p3.4.m4.1c">Q_{max}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p3.4.m4.1d">italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> windows, a substantial portion of the recent history (<math alttext="Q_{max}" class="ltx_Math" display="inline" id="S2.SS3.p3.5.m5.1"><semantics id="S2.SS3.p3.5.m5.1a"><msub id="S2.SS3.p3.5.m5.1.1" xref="S2.SS3.p3.5.m5.1.1.cmml"><mi id="S2.SS3.p3.5.m5.1.1.2" xref="S2.SS3.p3.5.m5.1.1.2.cmml">Q</mi><mrow id="S2.SS3.p3.5.m5.1.1.3" xref="S2.SS3.p3.5.m5.1.1.3.cmml"><mi id="S2.SS3.p3.5.m5.1.1.3.2" xref="S2.SS3.p3.5.m5.1.1.3.2.cmml">m</mi><mo id="S2.SS3.p3.5.m5.1.1.3.1" xref="S2.SS3.p3.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.5.m5.1.1.3.3" xref="S2.SS3.p3.5.m5.1.1.3.3.cmml">a</mi><mo id="S2.SS3.p3.5.m5.1.1.3.1a" xref="S2.SS3.p3.5.m5.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p3.5.m5.1.1.3.4" xref="S2.SS3.p3.5.m5.1.1.3.4.cmml">x</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p3.5.m5.1b"><apply id="S2.SS3.p3.5.m5.1.1.cmml" xref="S2.SS3.p3.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS3.p3.5.m5.1.1.1.cmml" xref="S2.SS3.p3.5.m5.1.1">subscript</csymbol><ci id="S2.SS3.p3.5.m5.1.1.2.cmml" xref="S2.SS3.p3.5.m5.1.1.2">𝑄</ci><apply id="S2.SS3.p3.5.m5.1.1.3.cmml" xref="S2.SS3.p3.5.m5.1.1.3"><times id="S2.SS3.p3.5.m5.1.1.3.1.cmml" xref="S2.SS3.p3.5.m5.1.1.3.1"></times><ci id="S2.SS3.p3.5.m5.1.1.3.2.cmml" xref="S2.SS3.p3.5.m5.1.1.3.2">𝑚</ci><ci id="S2.SS3.p3.5.m5.1.1.3.3.cmml" xref="S2.SS3.p3.5.m5.1.1.3.3">𝑎</ci><ci id="S2.SS3.p3.5.m5.1.1.3.4.cmml" xref="S2.SS3.p3.5.m5.1.1.3.4">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p3.5.m5.1c">Q_{max}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p3.5.m5.1d">italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> windows) is still retained. We opt to store KV pairs (rather than the tokens themselves) because they are repeatedly utilized in cross-attention mechanisms for subsequent context windows, a point we will elaborate on later.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS3.p4">
<p class="ltx_p" id="S2.SS3.p4.15"><span class="ltx_text ltx_font_bold" id="S2.SS3.p4.15.1">Long-term layer:</span>
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S2.F3" title="Figure 3 ‣ 2.3 Long-Term Memory: Single-Layer Memorizing Compressed Key-Value Pairs ‣ 2 Our Method: Melodi ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">3</span></a> illustrates the implementation of a long-term layer, which builds upon a short-term layer but incorporates three key additions. First, it introduces a long-term memory component (denoted as <math alttext="m_{1:k-1}" class="ltx_Math" display="inline" id="S2.SS3.p4.1.m1.1"><semantics id="S2.SS3.p4.1.m1.1a"><msub id="S2.SS3.p4.1.m1.1.1" xref="S2.SS3.p4.1.m1.1.1.cmml"><mi id="S2.SS3.p4.1.m1.1.1.2" xref="S2.SS3.p4.1.m1.1.1.2.cmml">m</mi><mrow id="S2.SS3.p4.1.m1.1.1.3" xref="S2.SS3.p4.1.m1.1.1.3.cmml"><mn id="S2.SS3.p4.1.m1.1.1.3.2" xref="S2.SS3.p4.1.m1.1.1.3.2.cmml">1</mn><mo id="S2.SS3.p4.1.m1.1.1.3.1" lspace="0.278em" rspace="0.278em" xref="S2.SS3.p4.1.m1.1.1.3.1.cmml">:</mo><mrow id="S2.SS3.p4.1.m1.1.1.3.3" xref="S2.SS3.p4.1.m1.1.1.3.3.cmml"><mi id="S2.SS3.p4.1.m1.1.1.3.3.2" xref="S2.SS3.p4.1.m1.1.1.3.3.2.cmml">k</mi><mo id="S2.SS3.p4.1.m1.1.1.3.3.1" xref="S2.SS3.p4.1.m1.1.1.3.3.1.cmml">−</mo><mn id="S2.SS3.p4.1.m1.1.1.3.3.3" xref="S2.SS3.p4.1.m1.1.1.3.3.3.cmml">1</mn></mrow></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.1.m1.1b"><apply id="S2.SS3.p4.1.m1.1.1.cmml" xref="S2.SS3.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S2.SS3.p4.1.m1.1.1.1.cmml" xref="S2.SS3.p4.1.m1.1.1">subscript</csymbol><ci id="S2.SS3.p4.1.m1.1.1.2.cmml" xref="S2.SS3.p4.1.m1.1.1.2">𝑚</ci><apply id="S2.SS3.p4.1.m1.1.1.3.cmml" xref="S2.SS3.p4.1.m1.1.1.3"><ci id="S2.SS3.p4.1.m1.1.1.3.1.cmml" xref="S2.SS3.p4.1.m1.1.1.3.1">:</ci><cn id="S2.SS3.p4.1.m1.1.1.3.2.cmml" type="integer" xref="S2.SS3.p4.1.m1.1.1.3.2">1</cn><apply id="S2.SS3.p4.1.m1.1.1.3.3.cmml" xref="S2.SS3.p4.1.m1.1.1.3.3"><minus id="S2.SS3.p4.1.m1.1.1.3.3.1.cmml" xref="S2.SS3.p4.1.m1.1.1.3.3.1"></minus><ci id="S2.SS3.p4.1.m1.1.1.3.3.2.cmml" xref="S2.SS3.p4.1.m1.1.1.3.3.2">𝑘</ci><cn id="S2.SS3.p4.1.m1.1.1.3.3.3.cmml" type="integer" xref="S2.SS3.p4.1.m1.1.1.3.3.3">1</cn></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.1.m1.1c">m_{1:k-1}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.1.m1.1d">italic_m start_POSTSUBSCRIPT 1 : italic_k - 1 end_POSTSUBSCRIPT</annotation></semantics></math> prior to the <math alttext="k^{th}" class="ltx_Math" display="inline" id="S2.SS3.p4.2.m2.1"><semantics id="S2.SS3.p4.2.m2.1a"><msup id="S2.SS3.p4.2.m2.1.1" xref="S2.SS3.p4.2.m2.1.1.cmml"><mi id="S2.SS3.p4.2.m2.1.1.2" xref="S2.SS3.p4.2.m2.1.1.2.cmml">k</mi><mrow id="S2.SS3.p4.2.m2.1.1.3" xref="S2.SS3.p4.2.m2.1.1.3.cmml"><mi id="S2.SS3.p4.2.m2.1.1.3.2" xref="S2.SS3.p4.2.m2.1.1.3.2.cmml">t</mi><mo id="S2.SS3.p4.2.m2.1.1.3.1" xref="S2.SS3.p4.2.m2.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p4.2.m2.1.1.3.3" xref="S2.SS3.p4.2.m2.1.1.3.3.cmml">h</mi></mrow></msup><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.2.m2.1b"><apply id="S2.SS3.p4.2.m2.1.1.cmml" xref="S2.SS3.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S2.SS3.p4.2.m2.1.1.1.cmml" xref="S2.SS3.p4.2.m2.1.1">superscript</csymbol><ci id="S2.SS3.p4.2.m2.1.1.2.cmml" xref="S2.SS3.p4.2.m2.1.1.2">𝑘</ci><apply id="S2.SS3.p4.2.m2.1.1.3.cmml" xref="S2.SS3.p4.2.m2.1.1.3"><times id="S2.SS3.p4.2.m2.1.1.3.1.cmml" xref="S2.SS3.p4.2.m2.1.1.3.1"></times><ci id="S2.SS3.p4.2.m2.1.1.3.2.cmml" xref="S2.SS3.p4.2.m2.1.1.3.2">𝑡</ci><ci id="S2.SS3.p4.2.m2.1.1.3.3.cmml" xref="S2.SS3.p4.2.m2.1.1.3.3">ℎ</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.2.m2.1c">k^{th}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.2.m2.1d">italic_k start_POSTSUPERSCRIPT italic_t italic_h end_POSTSUPERSCRIPT</annotation></semantics></math> context window) and enables the current context tokens <math alttext="x_{k}" class="ltx_Math" display="inline" id="S2.SS3.p4.3.m3.1"><semantics id="S2.SS3.p4.3.m3.1a"><msub id="S2.SS3.p4.3.m3.1.1" xref="S2.SS3.p4.3.m3.1.1.cmml"><mi id="S2.SS3.p4.3.m3.1.1.2" xref="S2.SS3.p4.3.m3.1.1.2.cmml">x</mi><mi id="S2.SS3.p4.3.m3.1.1.3" xref="S2.SS3.p4.3.m3.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.3.m3.1b"><apply id="S2.SS3.p4.3.m3.1.1.cmml" xref="S2.SS3.p4.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS3.p4.3.m3.1.1.1.cmml" xref="S2.SS3.p4.3.m3.1.1">subscript</csymbol><ci id="S2.SS3.p4.3.m3.1.1.2.cmml" xref="S2.SS3.p4.3.m3.1.1.2">𝑥</ci><ci id="S2.SS3.p4.3.m3.1.1.3.cmml" xref="S2.SS3.p4.3.m3.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.3.m3.1c">x_{k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.3.m3.1d">italic_x start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> and summary tokens <math alttext="u_{k}" class="ltx_Math" display="inline" id="S2.SS3.p4.4.m4.1"><semantics id="S2.SS3.p4.4.m4.1a"><msub id="S2.SS3.p4.4.m4.1.1" xref="S2.SS3.p4.4.m4.1.1.cmml"><mi id="S2.SS3.p4.4.m4.1.1.2" xref="S2.SS3.p4.4.m4.1.1.2.cmml">u</mi><mi id="S2.SS3.p4.4.m4.1.1.3" xref="S2.SS3.p4.4.m4.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.4.m4.1b"><apply id="S2.SS3.p4.4.m4.1.1.cmml" xref="S2.SS3.p4.4.m4.1.1"><csymbol cd="ambiguous" id="S2.SS3.p4.4.m4.1.1.1.cmml" xref="S2.SS3.p4.4.m4.1.1">subscript</csymbol><ci id="S2.SS3.p4.4.m4.1.1.2.cmml" xref="S2.SS3.p4.4.m4.1.1.2">𝑢</ci><ci id="S2.SS3.p4.4.m4.1.1.3.cmml" xref="S2.SS3.p4.4.m4.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.4.m4.1c">u_{k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.4.m4.1d">italic_u start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> to cross-attend to it. Second, the cross-attention shares parameters with the self-attention and their results (cross attention: <math alttext="\mathcal{A}_{x}" class="ltx_Math" display="inline" id="S2.SS3.p4.5.m5.1"><semantics id="S2.SS3.p4.5.m5.1a"><msub id="S2.SS3.p4.5.m5.1.1" xref="S2.SS3.p4.5.m5.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS3.p4.5.m5.1.1.2" xref="S2.SS3.p4.5.m5.1.1.2.cmml">𝒜</mi><mi id="S2.SS3.p4.5.m5.1.1.3" xref="S2.SS3.p4.5.m5.1.1.3.cmml">x</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.5.m5.1b"><apply id="S2.SS3.p4.5.m5.1.1.cmml" xref="S2.SS3.p4.5.m5.1.1"><csymbol cd="ambiguous" id="S2.SS3.p4.5.m5.1.1.1.cmml" xref="S2.SS3.p4.5.m5.1.1">subscript</csymbol><ci id="S2.SS3.p4.5.m5.1.1.2.cmml" xref="S2.SS3.p4.5.m5.1.1.2">𝒜</ci><ci id="S2.SS3.p4.5.m5.1.1.3.cmml" xref="S2.SS3.p4.5.m5.1.1.3">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.5.m5.1c">\mathcal{A}_{x}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.5.m5.1d">caligraphic_A start_POSTSUBSCRIPT italic_x end_POSTSUBSCRIPT</annotation></semantics></math>, self-attention: <math alttext="\mathcal{A}_{s}" class="ltx_Math" display="inline" id="S2.SS3.p4.6.m6.1"><semantics id="S2.SS3.p4.6.m6.1a"><msub id="S2.SS3.p4.6.m6.1.1" xref="S2.SS3.p4.6.m6.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS3.p4.6.m6.1.1.2" xref="S2.SS3.p4.6.m6.1.1.2.cmml">𝒜</mi><mi id="S2.SS3.p4.6.m6.1.1.3" xref="S2.SS3.p4.6.m6.1.1.3.cmml">s</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.6.m6.1b"><apply id="S2.SS3.p4.6.m6.1.1.cmml" xref="S2.SS3.p4.6.m6.1.1"><csymbol cd="ambiguous" id="S2.SS3.p4.6.m6.1.1.1.cmml" xref="S2.SS3.p4.6.m6.1.1">subscript</csymbol><ci id="S2.SS3.p4.6.m6.1.1.2.cmml" xref="S2.SS3.p4.6.m6.1.1.2">𝒜</ci><ci id="S2.SS3.p4.6.m6.1.1.3.cmml" xref="S2.SS3.p4.6.m6.1.1.3">𝑠</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.6.m6.1c">\mathcal{A}_{s}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.6.m6.1d">caligraphic_A start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT</annotation></semantics></math>) are combined through a gating mechanism using a learnable scalar <math alttext="\alpha" class="ltx_Math" display="inline" id="S2.SS3.p4.7.m7.1"><semantics id="S2.SS3.p4.7.m7.1a"><mi id="S2.SS3.p4.7.m7.1.1" xref="S2.SS3.p4.7.m7.1.1.cmml">α</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.7.m7.1b"><ci id="S2.SS3.p4.7.m7.1.1.cmml" xref="S2.SS3.p4.7.m7.1.1">𝛼</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.7.m7.1c">\alpha</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.7.m7.1d">italic_α</annotation></semantics></math> per attention head, formulated as <math alttext="\alpha\mathcal{A}_{x}+(1-\alpha)\mathcal{A}_{s}" class="ltx_Math" display="inline" id="S2.SS3.p4.8.m8.1"><semantics id="S2.SS3.p4.8.m8.1a"><mrow id="S2.SS3.p4.8.m8.1.1" xref="S2.SS3.p4.8.m8.1.1.cmml"><mrow id="S2.SS3.p4.8.m8.1.1.3" xref="S2.SS3.p4.8.m8.1.1.3.cmml"><mi id="S2.SS3.p4.8.m8.1.1.3.2" xref="S2.SS3.p4.8.m8.1.1.3.2.cmml">α</mi><mo id="S2.SS3.p4.8.m8.1.1.3.1" xref="S2.SS3.p4.8.m8.1.1.3.1.cmml">⁢</mo><msub id="S2.SS3.p4.8.m8.1.1.3.3" xref="S2.SS3.p4.8.m8.1.1.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS3.p4.8.m8.1.1.3.3.2" xref="S2.SS3.p4.8.m8.1.1.3.3.2.cmml">𝒜</mi><mi id="S2.SS3.p4.8.m8.1.1.3.3.3" xref="S2.SS3.p4.8.m8.1.1.3.3.3.cmml">x</mi></msub></mrow><mo id="S2.SS3.p4.8.m8.1.1.2" xref="S2.SS3.p4.8.m8.1.1.2.cmml">+</mo><mrow id="S2.SS3.p4.8.m8.1.1.1" xref="S2.SS3.p4.8.m8.1.1.1.cmml"><mrow id="S2.SS3.p4.8.m8.1.1.1.1.1" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.cmml"><mo id="S2.SS3.p4.8.m8.1.1.1.1.1.2" stretchy="false" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.cmml">(</mo><mrow id="S2.SS3.p4.8.m8.1.1.1.1.1.1" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.cmml"><mn id="S2.SS3.p4.8.m8.1.1.1.1.1.1.2" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.2.cmml">1</mn><mo id="S2.SS3.p4.8.m8.1.1.1.1.1.1.1" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.1.cmml">−</mo><mi id="S2.SS3.p4.8.m8.1.1.1.1.1.1.3" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.3.cmml">α</mi></mrow><mo id="S2.SS3.p4.8.m8.1.1.1.1.1.3" stretchy="false" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.cmml">)</mo></mrow><mo id="S2.SS3.p4.8.m8.1.1.1.2" xref="S2.SS3.p4.8.m8.1.1.1.2.cmml">⁢</mo><msub id="S2.SS3.p4.8.m8.1.1.1.3" xref="S2.SS3.p4.8.m8.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S2.SS3.p4.8.m8.1.1.1.3.2" xref="S2.SS3.p4.8.m8.1.1.1.3.2.cmml">𝒜</mi><mi id="S2.SS3.p4.8.m8.1.1.1.3.3" xref="S2.SS3.p4.8.m8.1.1.1.3.3.cmml">s</mi></msub></mrow></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.8.m8.1b"><apply id="S2.SS3.p4.8.m8.1.1.cmml" xref="S2.SS3.p4.8.m8.1.1"><plus id="S2.SS3.p4.8.m8.1.1.2.cmml" xref="S2.SS3.p4.8.m8.1.1.2"></plus><apply id="S2.SS3.p4.8.m8.1.1.3.cmml" xref="S2.SS3.p4.8.m8.1.1.3"><times id="S2.SS3.p4.8.m8.1.1.3.1.cmml" xref="S2.SS3.p4.8.m8.1.1.3.1"></times><ci id="S2.SS3.p4.8.m8.1.1.3.2.cmml" xref="S2.SS3.p4.8.m8.1.1.3.2">𝛼</ci><apply id="S2.SS3.p4.8.m8.1.1.3.3.cmml" xref="S2.SS3.p4.8.m8.1.1.3.3"><csymbol cd="ambiguous" id="S2.SS3.p4.8.m8.1.1.3.3.1.cmml" xref="S2.SS3.p4.8.m8.1.1.3.3">subscript</csymbol><ci id="S2.SS3.p4.8.m8.1.1.3.3.2.cmml" xref="S2.SS3.p4.8.m8.1.1.3.3.2">𝒜</ci><ci id="S2.SS3.p4.8.m8.1.1.3.3.3.cmml" xref="S2.SS3.p4.8.m8.1.1.3.3.3">𝑥</ci></apply></apply><apply id="S2.SS3.p4.8.m8.1.1.1.cmml" xref="S2.SS3.p4.8.m8.1.1.1"><times id="S2.SS3.p4.8.m8.1.1.1.2.cmml" xref="S2.SS3.p4.8.m8.1.1.1.2"></times><apply id="S2.SS3.p4.8.m8.1.1.1.1.1.1.cmml" xref="S2.SS3.p4.8.m8.1.1.1.1.1"><minus id="S2.SS3.p4.8.m8.1.1.1.1.1.1.1.cmml" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.1"></minus><cn id="S2.SS3.p4.8.m8.1.1.1.1.1.1.2.cmml" type="integer" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.2">1</cn><ci id="S2.SS3.p4.8.m8.1.1.1.1.1.1.3.cmml" xref="S2.SS3.p4.8.m8.1.1.1.1.1.1.3">𝛼</ci></apply><apply id="S2.SS3.p4.8.m8.1.1.1.3.cmml" xref="S2.SS3.p4.8.m8.1.1.1.3"><csymbol cd="ambiguous" id="S2.SS3.p4.8.m8.1.1.1.3.1.cmml" xref="S2.SS3.p4.8.m8.1.1.1.3">subscript</csymbol><ci id="S2.SS3.p4.8.m8.1.1.1.3.2.cmml" xref="S2.SS3.p4.8.m8.1.1.1.3.2">𝒜</ci><ci id="S2.SS3.p4.8.m8.1.1.1.3.3.cmml" xref="S2.SS3.p4.8.m8.1.1.1.3.3">𝑠</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.8.m8.1c">\alpha\mathcal{A}_{x}+(1-\alpha)\mathcal{A}_{s}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.8.m8.1d">italic_α caligraphic_A start_POSTSUBSCRIPT italic_x end_POSTSUBSCRIPT + ( 1 - italic_α ) caligraphic_A start_POSTSUBSCRIPT italic_s end_POSTSUBSCRIPT</annotation></semantics></math>. Finally, an additional linear token mixer is introduced to generate long-term tokens for the current window, and their key-value (KV) pairs <math alttext="m_{k}" class="ltx_Math" display="inline" id="S2.SS3.p4.9.m9.1"><semantics id="S2.SS3.p4.9.m9.1a"><msub id="S2.SS3.p4.9.m9.1.1" xref="S2.SS3.p4.9.m9.1.1.cmml"><mi id="S2.SS3.p4.9.m9.1.1.2" xref="S2.SS3.p4.9.m9.1.1.2.cmml">m</mi><mi id="S2.SS3.p4.9.m9.1.1.3" xref="S2.SS3.p4.9.m9.1.1.3.cmml">k</mi></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.9.m9.1b"><apply id="S2.SS3.p4.9.m9.1.1.cmml" xref="S2.SS3.p4.9.m9.1.1"><csymbol cd="ambiguous" id="S2.SS3.p4.9.m9.1.1.1.cmml" xref="S2.SS3.p4.9.m9.1.1">subscript</csymbol><ci id="S2.SS3.p4.9.m9.1.1.2.cmml" xref="S2.SS3.p4.9.m9.1.1.2">𝑚</ci><ci id="S2.SS3.p4.9.m9.1.1.3.cmml" xref="S2.SS3.p4.9.m9.1.1.3">𝑘</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.9.m9.1c">m_{k}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.9.m9.1d">italic_m start_POSTSUBSCRIPT italic_k end_POSTSUBSCRIPT</annotation></semantics></math> are appended to the long-term memory. This token mixer comprises <math alttext="(W+U)\times L" class="ltx_Math" display="inline" id="S2.SS3.p4.10.m10.1"><semantics id="S2.SS3.p4.10.m10.1a"><mrow id="S2.SS3.p4.10.m10.1.1" xref="S2.SS3.p4.10.m10.1.1.cmml"><mrow id="S2.SS3.p4.10.m10.1.1.1.1" xref="S2.SS3.p4.10.m10.1.1.1.1.1.cmml"><mo id="S2.SS3.p4.10.m10.1.1.1.1.2" stretchy="false" xref="S2.SS3.p4.10.m10.1.1.1.1.1.cmml">(</mo><mrow id="S2.SS3.p4.10.m10.1.1.1.1.1" xref="S2.SS3.p4.10.m10.1.1.1.1.1.cmml"><mi id="S2.SS3.p4.10.m10.1.1.1.1.1.2" xref="S2.SS3.p4.10.m10.1.1.1.1.1.2.cmml">W</mi><mo id="S2.SS3.p4.10.m10.1.1.1.1.1.1" xref="S2.SS3.p4.10.m10.1.1.1.1.1.1.cmml">+</mo><mi id="S2.SS3.p4.10.m10.1.1.1.1.1.3" xref="S2.SS3.p4.10.m10.1.1.1.1.1.3.cmml">U</mi></mrow><mo id="S2.SS3.p4.10.m10.1.1.1.1.3" rspace="0.055em" stretchy="false" xref="S2.SS3.p4.10.m10.1.1.1.1.1.cmml">)</mo></mrow><mo id="S2.SS3.p4.10.m10.1.1.2" rspace="0.222em" xref="S2.SS3.p4.10.m10.1.1.2.cmml">×</mo><mi id="S2.SS3.p4.10.m10.1.1.3" xref="S2.SS3.p4.10.m10.1.1.3.cmml">L</mi></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.10.m10.1b"><apply id="S2.SS3.p4.10.m10.1.1.cmml" xref="S2.SS3.p4.10.m10.1.1"><times id="S2.SS3.p4.10.m10.1.1.2.cmml" xref="S2.SS3.p4.10.m10.1.1.2"></times><apply id="S2.SS3.p4.10.m10.1.1.1.1.1.cmml" xref="S2.SS3.p4.10.m10.1.1.1.1"><plus id="S2.SS3.p4.10.m10.1.1.1.1.1.1.cmml" xref="S2.SS3.p4.10.m10.1.1.1.1.1.1"></plus><ci id="S2.SS3.p4.10.m10.1.1.1.1.1.2.cmml" xref="S2.SS3.p4.10.m10.1.1.1.1.1.2">𝑊</ci><ci id="S2.SS3.p4.10.m10.1.1.1.1.1.3.cmml" xref="S2.SS3.p4.10.m10.1.1.1.1.1.3">𝑈</ci></apply><ci id="S2.SS3.p4.10.m10.1.1.3.cmml" xref="S2.SS3.p4.10.m10.1.1.3">𝐿</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.10.m10.1c">(W+U)\times L</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.10.m10.1d">( italic_W + italic_U ) × italic_L</annotation></semantics></math> parameters, where <math alttext="W" class="ltx_Math" display="inline" id="S2.SS3.p4.11.m11.1"><semantics id="S2.SS3.p4.11.m11.1a"><mi id="S2.SS3.p4.11.m11.1.1" xref="S2.SS3.p4.11.m11.1.1.cmml">W</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.11.m11.1b"><ci id="S2.SS3.p4.11.m11.1.1.cmml" xref="S2.SS3.p4.11.m11.1.1">𝑊</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.11.m11.1c">W</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.11.m11.1d">italic_W</annotation></semantics></math>, <math alttext="U" class="ltx_Math" display="inline" id="S2.SS3.p4.12.m12.1"><semantics id="S2.SS3.p4.12.m12.1a"><mi id="S2.SS3.p4.12.m12.1.1" xref="S2.SS3.p4.12.m12.1.1.cmml">U</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.12.m12.1b"><ci id="S2.SS3.p4.12.m12.1.1.cmml" xref="S2.SS3.p4.12.m12.1.1">𝑈</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.12.m12.1c">U</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.12.m12.1d">italic_U</annotation></semantics></math> and <math alttext="L" class="ltx_Math" display="inline" id="S2.SS3.p4.13.m13.1"><semantics id="S2.SS3.p4.13.m13.1a"><mi id="S2.SS3.p4.13.m13.1.1" xref="S2.SS3.p4.13.m13.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.13.m13.1b"><ci id="S2.SS3.p4.13.m13.1.1.cmml" xref="S2.SS3.p4.13.m13.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.13.m13.1c">L</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.13.m13.1d">italic_L</annotation></semantics></math> represent the number of context, summary and long-term memory tokens, respectively. It is notably smaller than the mixers in the short-term layer because: (a) <math alttext="L" class="ltx_Math" display="inline" id="S2.SS3.p4.14.m14.1"><semantics id="S2.SS3.p4.14.m14.1a"><mi id="S2.SS3.p4.14.m14.1.1" xref="S2.SS3.p4.14.m14.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.14.m14.1b"><ci id="S2.SS3.p4.14.m14.1.1.cmml" xref="S2.SS3.p4.14.m14.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.14.m14.1c">L</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.14.m14.1d">italic_L</annotation></semantics></math> is less than <math alttext="S" class="ltx_Math" display="inline" id="S2.SS3.p4.15.m15.1"><semantics id="S2.SS3.p4.15.m15.1a"><mi id="S2.SS3.p4.15.m15.1.1" xref="S2.SS3.p4.15.m15.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p4.15.m15.1b"><ci id="S2.SS3.p4.15.m15.1.1.cmml" xref="S2.SS3.p4.15.m15.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p4.15.m15.1c">S</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p4.15.m15.1d">italic_S</annotation></semantics></math> (the number of short-term memory tokens), and (b) it is present in only one layer.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS3.p5">
<p class="ltx_p" id="S2.SS3.p5.14"><span class="ltx_text ltx_font_bold" id="S2.SS3.p5.14.1">Long-term vs short-term memory:</span>
Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.T2" title="Table 2 ‣ 3.1 Datasets ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">2</span></a> provides a comparative overview of the long-term and short-term memory mechanisms. In contrast to the short-term memory, which operates recurrently across multiple layers, the long-term memory functions incrementally within a single layer. The short-term memory spans <math alttext="N" class="ltx_Math" display="inline" id="S2.SS3.p5.1.m1.1"><semantics id="S2.SS3.p5.1.m1.1a"><mi id="S2.SS3.p5.1.m1.1.1" xref="S2.SS3.p5.1.m1.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p5.1.m1.1b"><ci id="S2.SS3.p5.1.m1.1.1.cmml" xref="S2.SS3.p5.1.m1.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p5.1.m1.1c">N</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.1.m1.1d">italic_N</annotation></semantics></math> network layers, with each layer utilizing <math alttext="S" class="ltx_Math" display="inline" id="S2.SS3.p5.2.m2.1"><semantics id="S2.SS3.p5.2.m2.1a"><mi id="S2.SS3.p5.2.m2.1.1" xref="S2.SS3.p5.2.m2.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p5.2.m2.1b"><ci id="S2.SS3.p5.2.m2.1.1.cmml" xref="S2.SS3.p5.2.m2.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p5.2.m2.1c">S</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.2.m2.1d">italic_S</annotation></semantics></math> tokens, while the long-term memory queue spans <math alttext="Q_{max}" class="ltx_Math" display="inline" id="S2.SS3.p5.3.m3.1"><semantics id="S2.SS3.p5.3.m3.1a"><msub id="S2.SS3.p5.3.m3.1.1" xref="S2.SS3.p5.3.m3.1.1.cmml"><mi id="S2.SS3.p5.3.m3.1.1.2" xref="S2.SS3.p5.3.m3.1.1.2.cmml">Q</mi><mrow id="S2.SS3.p5.3.m3.1.1.3" xref="S2.SS3.p5.3.m3.1.1.3.cmml"><mi id="S2.SS3.p5.3.m3.1.1.3.2" xref="S2.SS3.p5.3.m3.1.1.3.2.cmml">m</mi><mo id="S2.SS3.p5.3.m3.1.1.3.1" xref="S2.SS3.p5.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p5.3.m3.1.1.3.3" xref="S2.SS3.p5.3.m3.1.1.3.3.cmml">a</mi><mo id="S2.SS3.p5.3.m3.1.1.3.1a" xref="S2.SS3.p5.3.m3.1.1.3.1.cmml">⁢</mo><mi id="S2.SS3.p5.3.m3.1.1.3.4" xref="S2.SS3.p5.3.m3.1.1.3.4.cmml">x</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S2.SS3.p5.3.m3.1b"><apply id="S2.SS3.p5.3.m3.1.1.cmml" xref="S2.SS3.p5.3.m3.1.1"><csymbol cd="ambiguous" id="S2.SS3.p5.3.m3.1.1.1.cmml" xref="S2.SS3.p5.3.m3.1.1">subscript</csymbol><ci id="S2.SS3.p5.3.m3.1.1.2.cmml" xref="S2.SS3.p5.3.m3.1.1.2">𝑄</ci><apply id="S2.SS3.p5.3.m3.1.1.3.cmml" xref="S2.SS3.p5.3.m3.1.1.3"><times id="S2.SS3.p5.3.m3.1.1.3.1.cmml" xref="S2.SS3.p5.3.m3.1.1.3.1"></times><ci id="S2.SS3.p5.3.m3.1.1.3.2.cmml" xref="S2.SS3.p5.3.m3.1.1.3.2">𝑚</ci><ci id="S2.SS3.p5.3.m3.1.1.3.3.cmml" xref="S2.SS3.p5.3.m3.1.1.3.3">𝑎</ci><ci id="S2.SS3.p5.3.m3.1.1.3.4.cmml" xref="S2.SS3.p5.3.m3.1.1.3.4">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p5.3.m3.1c">Q_{max}</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.3.m3.1d">italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> context windows, with each window represented by <math alttext="L" class="ltx_Math" display="inline" id="S2.SS3.p5.4.m4.1"><semantics id="S2.SS3.p5.4.m4.1a"><mi id="S2.SS3.p5.4.m4.1.1" xref="S2.SS3.p5.4.m4.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S2.SS3.p5.4.m4.1b"><ci id="S2.SS3.p5.4.m4.1.1.cmml" xref="S2.SS3.p5.4.m4.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p5.4.m4.1c">L</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.4.m4.1d">italic_L</annotation></semantics></math> tokens.
To illustrate, consider a 12-layer transformer model processing context windows of 512 tokens each, with embedding dimension 1024. If we employ <math alttext="S=128" class="ltx_Math" display="inline" id="S2.SS3.p5.5.m5.1"><semantics id="S2.SS3.p5.5.m5.1a"><mrow id="S2.SS3.p5.5.m5.1.1" xref="S2.SS3.p5.5.m5.1.1.cmml"><mi id="S2.SS3.p5.5.m5.1.1.2" xref="S2.SS3.p5.5.m5.1.1.2.cmml">S</mi><mo id="S2.SS3.p5.5.m5.1.1.1" xref="S2.SS3.p5.5.m5.1.1.1.cmml">=</mo><mn id="S2.SS3.p5.5.m5.1.1.3" xref="S2.SS3.p5.5.m5.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p5.5.m5.1b"><apply id="S2.SS3.p5.5.m5.1.1.cmml" xref="S2.SS3.p5.5.m5.1.1"><eq id="S2.SS3.p5.5.m5.1.1.1.cmml" xref="S2.SS3.p5.5.m5.1.1.1"></eq><ci id="S2.SS3.p5.5.m5.1.1.2.cmml" xref="S2.SS3.p5.5.m5.1.1.2">𝑆</ci><cn id="S2.SS3.p5.5.m5.1.1.3.cmml" type="integer" xref="S2.SS3.p5.5.m5.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p5.5.m5.1c">S=128</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.5.m5.1d">italic_S = 128</annotation></semantics></math> short-term tokens per layer and <math alttext="L=64" class="ltx_Math" display="inline" id="S2.SS3.p5.6.m6.1"><semantics id="S2.SS3.p5.6.m6.1a"><mrow id="S2.SS3.p5.6.m6.1.1" xref="S2.SS3.p5.6.m6.1.1.cmml"><mi id="S2.SS3.p5.6.m6.1.1.2" xref="S2.SS3.p5.6.m6.1.1.2.cmml">L</mi><mo id="S2.SS3.p5.6.m6.1.1.1" xref="S2.SS3.p5.6.m6.1.1.1.cmml">=</mo><mn id="S2.SS3.p5.6.m6.1.1.3" xref="S2.SS3.p5.6.m6.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p5.6.m6.1b"><apply id="S2.SS3.p5.6.m6.1.1.cmml" xref="S2.SS3.p5.6.m6.1.1"><eq id="S2.SS3.p5.6.m6.1.1.1.cmml" xref="S2.SS3.p5.6.m6.1.1.1"></eq><ci id="S2.SS3.p5.6.m6.1.1.2.cmml" xref="S2.SS3.p5.6.m6.1.1.2">𝐿</ci><cn id="S2.SS3.p5.6.m6.1.1.3.cmml" type="integer" xref="S2.SS3.p5.6.m6.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p5.6.m6.1c">L=64</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.6.m6.1d">italic_L = 64</annotation></semantics></math> long-term tokens per window, with a maximum capacity of <math alttext="Q_{max}=128" class="ltx_Math" display="inline" id="S2.SS3.p5.7.m7.1"><semantics id="S2.SS3.p5.7.m7.1a"><mrow id="S2.SS3.p5.7.m7.1.1" xref="S2.SS3.p5.7.m7.1.1.cmml"><msub id="S2.SS3.p5.7.m7.1.1.2" xref="S2.SS3.p5.7.m7.1.1.2.cmml"><mi id="S2.SS3.p5.7.m7.1.1.2.2" xref="S2.SS3.p5.7.m7.1.1.2.2.cmml">Q</mi><mrow id="S2.SS3.p5.7.m7.1.1.2.3" xref="S2.SS3.p5.7.m7.1.1.2.3.cmml"><mi id="S2.SS3.p5.7.m7.1.1.2.3.2" xref="S2.SS3.p5.7.m7.1.1.2.3.2.cmml">m</mi><mo id="S2.SS3.p5.7.m7.1.1.2.3.1" xref="S2.SS3.p5.7.m7.1.1.2.3.1.cmml">⁢</mo><mi id="S2.SS3.p5.7.m7.1.1.2.3.3" xref="S2.SS3.p5.7.m7.1.1.2.3.3.cmml">a</mi><mo id="S2.SS3.p5.7.m7.1.1.2.3.1a" xref="S2.SS3.p5.7.m7.1.1.2.3.1.cmml">⁢</mo><mi id="S2.SS3.p5.7.m7.1.1.2.3.4" xref="S2.SS3.p5.7.m7.1.1.2.3.4.cmml">x</mi></mrow></msub><mo id="S2.SS3.p5.7.m7.1.1.1" xref="S2.SS3.p5.7.m7.1.1.1.cmml">=</mo><mn id="S2.SS3.p5.7.m7.1.1.3" xref="S2.SS3.p5.7.m7.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S2.SS3.p5.7.m7.1b"><apply id="S2.SS3.p5.7.m7.1.1.cmml" xref="S2.SS3.p5.7.m7.1.1"><eq id="S2.SS3.p5.7.m7.1.1.1.cmml" xref="S2.SS3.p5.7.m7.1.1.1"></eq><apply id="S2.SS3.p5.7.m7.1.1.2.cmml" xref="S2.SS3.p5.7.m7.1.1.2"><csymbol cd="ambiguous" id="S2.SS3.p5.7.m7.1.1.2.1.cmml" xref="S2.SS3.p5.7.m7.1.1.2">subscript</csymbol><ci id="S2.SS3.p5.7.m7.1.1.2.2.cmml" xref="S2.SS3.p5.7.m7.1.1.2.2">𝑄</ci><apply id="S2.SS3.p5.7.m7.1.1.2.3.cmml" xref="S2.SS3.p5.7.m7.1.1.2.3"><times id="S2.SS3.p5.7.m7.1.1.2.3.1.cmml" xref="S2.SS3.p5.7.m7.1.1.2.3.1"></times><ci id="S2.SS3.p5.7.m7.1.1.2.3.2.cmml" xref="S2.SS3.p5.7.m7.1.1.2.3.2">𝑚</ci><ci id="S2.SS3.p5.7.m7.1.1.2.3.3.cmml" xref="S2.SS3.p5.7.m7.1.1.2.3.3">𝑎</ci><ci id="S2.SS3.p5.7.m7.1.1.2.3.4.cmml" xref="S2.SS3.p5.7.m7.1.1.2.3.4">𝑥</ci></apply></apply><cn id="S2.SS3.p5.7.m7.1.1.3.cmml" type="integer" xref="S2.SS3.p5.7.m7.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S2.SS3.p5.7.m7.1c">Q_{max}=128</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.7.m7.1d">italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT = 128</annotation></semantics></math> windows for the long-term memory, the short-term and long-term memory caches would have capacities of 1.6M (128<math alttext="{}^{tokens}\times" class="ltx_math_unparsed" display="inline" id="S2.SS3.p5.8.m8.1"><semantics id="S2.SS3.p5.8.m8.1a"><mmultiscripts id="S2.SS3.p5.8.m8.1.1"><mo id="S2.SS3.p5.8.m8.1.1.2">×</mo><mprescripts id="S2.SS3.p5.8.m8.1.1a"></mprescripts><mrow id="S2.SS3.p5.8.m8.1.1b"></mrow><mrow id="S2.SS3.p5.8.m8.1.1.3"><mi id="S2.SS3.p5.8.m8.1.1.3.2">t</mi><mo id="S2.SS3.p5.8.m8.1.1.3.1">⁢</mo><mi id="S2.SS3.p5.8.m8.1.1.3.3">o</mi><mo id="S2.SS3.p5.8.m8.1.1.3.1a">⁢</mo><mi id="S2.SS3.p5.8.m8.1.1.3.4">k</mi><mo id="S2.SS3.p5.8.m8.1.1.3.1b">⁢</mo><mi id="S2.SS3.p5.8.m8.1.1.3.5">e</mi><mo id="S2.SS3.p5.8.m8.1.1.3.1c">⁢</mo><mi id="S2.SS3.p5.8.m8.1.1.3.6">n</mi><mo id="S2.SS3.p5.8.m8.1.1.3.1d">⁢</mo><mi id="S2.SS3.p5.8.m8.1.1.3.7">s</mi></mrow></mmultiscripts><annotation encoding="application/x-tex" id="S2.SS3.p5.8.m8.1b">{}^{tokens}\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.8.m8.1c">start_FLOATSUPERSCRIPT italic_t italic_o italic_k italic_e italic_n italic_s end_FLOATSUPERSCRIPT ×</annotation></semantics></math>1024 <math alttext="{}^{dim}\times" class="ltx_math_unparsed" display="inline" id="S2.SS3.p5.9.m9.1"><semantics id="S2.SS3.p5.9.m9.1a"><mmultiscripts id="S2.SS3.p5.9.m9.1.1"><mo id="S2.SS3.p5.9.m9.1.1.2">×</mo><mprescripts id="S2.SS3.p5.9.m9.1.1a"></mprescripts><mrow id="S2.SS3.p5.9.m9.1.1b"></mrow><mrow id="S2.SS3.p5.9.m9.1.1.3"><mi id="S2.SS3.p5.9.m9.1.1.3.2">d</mi><mo id="S2.SS3.p5.9.m9.1.1.3.1">⁢</mo><mi id="S2.SS3.p5.9.m9.1.1.3.3">i</mi><mo id="S2.SS3.p5.9.m9.1.1.3.1a">⁢</mo><mi id="S2.SS3.p5.9.m9.1.1.3.4">m</mi></mrow></mmultiscripts><annotation encoding="application/x-tex" id="S2.SS3.p5.9.m9.1b">{}^{dim}\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.9.m9.1c">start_FLOATSUPERSCRIPT italic_d italic_i italic_m end_FLOATSUPERSCRIPT ×</annotation></semantics></math>12 <sup class="ltx_sup" id="S2.SS3.p5.14.2"><span class="ltx_text ltx_font_italic" id="S2.SS3.p5.14.2.1">layers</span></sup>) and 16.8M (64<math alttext="{}^{pairs}\times" class="ltx_math_unparsed" display="inline" id="S2.SS3.p5.11.m11.1"><semantics id="S2.SS3.p5.11.m11.1a"><mmultiscripts id="S2.SS3.p5.11.m11.1.1"><mo id="S2.SS3.p5.11.m11.1.1.2">×</mo><mprescripts id="S2.SS3.p5.11.m11.1.1a"></mprescripts><mrow id="S2.SS3.p5.11.m11.1.1b"></mrow><mrow id="S2.SS3.p5.11.m11.1.1.3"><mi id="S2.SS3.p5.11.m11.1.1.3.2">p</mi><mo id="S2.SS3.p5.11.m11.1.1.3.1">⁢</mo><mi id="S2.SS3.p5.11.m11.1.1.3.3">a</mi><mo id="S2.SS3.p5.11.m11.1.1.3.1a">⁢</mo><mi id="S2.SS3.p5.11.m11.1.1.3.4">i</mi><mo id="S2.SS3.p5.11.m11.1.1.3.1b">⁢</mo><mi id="S2.SS3.p5.11.m11.1.1.3.5">r</mi><mo id="S2.SS3.p5.11.m11.1.1.3.1c">⁢</mo><mi id="S2.SS3.p5.11.m11.1.1.3.6">s</mi></mrow></mmultiscripts><annotation encoding="application/x-tex" id="S2.SS3.p5.11.m11.1b">{}^{pairs}\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.11.m11.1c">start_FLOATSUPERSCRIPT italic_p italic_a italic_i italic_r italic_s end_FLOATSUPERSCRIPT ×</annotation></semantics></math>2<math alttext="{}^{tokens/pair}\times" class="ltx_math_unparsed" display="inline" id="S2.SS3.p5.12.m12.1"><semantics id="S2.SS3.p5.12.m12.1a"><mmultiscripts id="S2.SS3.p5.12.m12.1.1"><mo id="S2.SS3.p5.12.m12.1.1.2">×</mo><mprescripts id="S2.SS3.p5.12.m12.1.1a"></mprescripts><mrow id="S2.SS3.p5.12.m12.1.1b"></mrow><mrow id="S2.SS3.p5.12.m12.1.1.3"><mrow id="S2.SS3.p5.12.m12.1.1.3.2"><mrow id="S2.SS3.p5.12.m12.1.1.3.2.2"><mi id="S2.SS3.p5.12.m12.1.1.3.2.2.2">t</mi><mo id="S2.SS3.p5.12.m12.1.1.3.2.2.1">⁢</mo><mi id="S2.SS3.p5.12.m12.1.1.3.2.2.3">o</mi><mo id="S2.SS3.p5.12.m12.1.1.3.2.2.1a">⁢</mo><mi id="S2.SS3.p5.12.m12.1.1.3.2.2.4">k</mi><mo id="S2.SS3.p5.12.m12.1.1.3.2.2.1b">⁢</mo><mi id="S2.SS3.p5.12.m12.1.1.3.2.2.5">e</mi><mo id="S2.SS3.p5.12.m12.1.1.3.2.2.1c">⁢</mo><mi id="S2.SS3.p5.12.m12.1.1.3.2.2.6">n</mi><mo id="S2.SS3.p5.12.m12.1.1.3.2.2.1d">⁢</mo><mi id="S2.SS3.p5.12.m12.1.1.3.2.2.7">s</mi></mrow><mo id="S2.SS3.p5.12.m12.1.1.3.2.1">/</mo><mi id="S2.SS3.p5.12.m12.1.1.3.2.3">p</mi></mrow><mo id="S2.SS3.p5.12.m12.1.1.3.1">⁢</mo><mi id="S2.SS3.p5.12.m12.1.1.3.3">a</mi><mo id="S2.SS3.p5.12.m12.1.1.3.1a">⁢</mo><mi id="S2.SS3.p5.12.m12.1.1.3.4">i</mi><mo id="S2.SS3.p5.12.m12.1.1.3.1b">⁢</mo><mi id="S2.SS3.p5.12.m12.1.1.3.5">r</mi></mrow></mmultiscripts><annotation encoding="application/x-tex" id="S2.SS3.p5.12.m12.1b">{}^{tokens/pair}\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.12.m12.1c">start_FLOATSUPERSCRIPT italic_t italic_o italic_k italic_e italic_n italic_s / italic_p italic_a italic_i italic_r end_FLOATSUPERSCRIPT ×</annotation></semantics></math>1024<math alttext="{}^{dim}\times" class="ltx_math_unparsed" display="inline" id="S2.SS3.p5.13.m13.1"><semantics id="S2.SS3.p5.13.m13.1a"><mmultiscripts id="S2.SS3.p5.13.m13.1.1"><mo id="S2.SS3.p5.13.m13.1.1.2">×</mo><mprescripts id="S2.SS3.p5.13.m13.1.1a"></mprescripts><mrow id="S2.SS3.p5.13.m13.1.1b"></mrow><mrow id="S2.SS3.p5.13.m13.1.1.3"><mi id="S2.SS3.p5.13.m13.1.1.3.2">d</mi><mo id="S2.SS3.p5.13.m13.1.1.3.1">⁢</mo><mi id="S2.SS3.p5.13.m13.1.1.3.3">i</mi><mo id="S2.SS3.p5.13.m13.1.1.3.1a">⁢</mo><mi id="S2.SS3.p5.13.m13.1.1.3.4">m</mi></mrow></mmultiscripts><annotation encoding="application/x-tex" id="S2.SS3.p5.13.m13.1b">{}^{dim}\times</annotation><annotation encoding="application/x-llamapun" id="S2.SS3.p5.13.m13.1c">start_FLOATSUPERSCRIPT italic_d italic_i italic_m end_FLOATSUPERSCRIPT ×</annotation></semantics></math>128<sup class="ltx_sup" id="S2.SS3.p5.14.3"><span class="ltx_text ltx_font_italic" id="S2.SS3.p5.14.3.1">windows</span></sup>) floats, respectively. It’s worth noting that, for computational efficiency, we store key-value (KV) pairs in the long-term memory, whereas tokens are stored directly in the short-term memory.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.SS3.p6">
<p class="ltx_p" id="S2.SS3.p6.1"><span class="ltx_text ltx_font_bold" id="S2.SS3.p6.1.1">Relation to Memorizing Transformer (MT) <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib37" title="">2022</a>)</cite>:</span>
Similar to Memorizing Transformer, <span class="ltx_text ltx_font_smallcaps" id="S2.SS3.p6.1.2">Melodi</span> incorporates key-value pairs from a middle layer into its long-term memory. Experiments corroborate the finding in MT that employing additional long-term layers yields only incremental gains. However, a key distinction lies in the fact that <span class="ltx_text ltx_font_smallcaps" id="S2.SS3.p6.1.3">Melodi</span> stores <span class="ltx_text ltx_font_italic" id="S2.SS3.p6.1.4">compressed</span> KV pairs, rather than the KV pairs of context tokens directly, as in MT. This modification substantially reduces the size of the long-term memory. For instance, when compressing a context window of 512 tokens into 64 long-term tokens, <span class="ltx_text ltx_font_smallcaps" id="S2.SS3.p6.1.5">Melodi</span> achieves an <span class="ltx_text ltx_font_italic" id="S2.SS3.p6.1.6">8-fold reduction</span> in long-term memory size.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Experimental Results</h2>
<div class="ltx_para ltx_noindent" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">We evaluate <span class="ltx_text ltx_font_smallcaps" id="S3.p1.1.1">Melodi</span> on three long-context datasets: PG19 <cite class="ltx_cite ltx_citemacro_citep">(Rae et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib23" title="">2019</a>)</cite>, arXiv Math <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib37" title="">2022</a>)</cite>, and C4 <cite class="ltx_cite ltx_citemacro_citep">(Raffel et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib24" title="">2020a</a>)</cite>, using the standard auto-regressive language modeling task, where the objective is to predict the next token in a sequence. All models are trained from scratch, and we report the average perplexity on the respective test sets as our evaluation metric.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Datasets</h3>
<div class="ltx_para ltx_noindent" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.1"><span class="ltx_text ltx_font_bold" id="S3.SS1.p1.1.1">PG19:</span>
The PG19 dataset <cite class="ltx_cite ltx_citemacro_citep">(Rae et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib23" title="">2019</a>)</cite> consists of 28,752 English books published before 1919, averaging around 68,972 tokens per book. We utilize three 32k vocabularies: (a) Meena <cite class="ltx_cite ltx_citemacro_citep">(Thoppilan et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib30" title="">2022</a>)</cite>, (b) T5 <cite class="ltx_cite ltx_citemacro_citep">(Raffel et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib25" title="">2020b</a>)</cite> and (c) a custom SentencePiece vocabulary <cite class="ltx_cite ltx_citemacro_citep">(Kudo &amp; Richardson, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib17" title="">2018</a>)</cite> trained specifically on PG19.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS1.p2">
<p class="ltx_p" id="S3.SS1.p2.1"><span class="ltx_text ltx_font_bold" id="S3.SS1.p2.1.1">arXiv Math:</span>
The arXiv dataset <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib37" title="">2022</a>)</cite> comprises technical math papers from arXiv, with token counts comparable to PG19 due to LaTeX’s use of special characters, resulting in smaller subwords. We use a 32k Meena vocabulary <cite class="ltx_cite ltx_citemacro_citep">(Thoppilan et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib30" title="">2022</a>)</cite> and a 32k custom vocabulary.</p>
</div>
<figure class="ltx_table" id="S3.T2">
<div class="ltx_flex_figure ltx_flex_table">
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_top" id="S3.T2.12" style="width:201.6pt;">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Table 1: </span><span class="ltx_text ltx_font_bold" id="S3.T2.12.14.1">Long-term vs. short-term memory.</span> In our notation, <math alttext="L" class="ltx_Math" display="inline" id="S3.T2.6.6.m1.1"><semantics id="S3.T2.6.6.m1.1b"><mi id="S3.T2.6.6.m1.1.1" xref="S3.T2.6.6.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S3.T2.6.6.m1.1c"><ci id="S3.T2.6.6.m1.1.1.cmml" xref="S3.T2.6.6.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.6.6.m1.1d">L</annotation><annotation encoding="application/x-llamapun" id="S3.T2.6.6.m1.1e">italic_L</annotation></semantics></math> and <math alttext="S" class="ltx_Math" display="inline" id="S3.T2.7.7.m2.1"><semantics id="S3.T2.7.7.m2.1b"><mi id="S3.T2.7.7.m2.1.1" xref="S3.T2.7.7.m2.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.T2.7.7.m2.1c"><ci id="S3.T2.7.7.m2.1.1.cmml" xref="S3.T2.7.7.m2.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.7.7.m2.1d">S</annotation><annotation encoding="application/x-llamapun" id="S3.T2.7.7.m2.1e">italic_S</annotation></semantics></math> represent the number of long-term and short-term tokens per network layer, respectively. Note that long-term has fewer tokens (<math alttext="L&lt;S" class="ltx_Math" display="inline" id="S3.T2.8.8.m3.1"><semantics id="S3.T2.8.8.m3.1b"><mrow id="S3.T2.8.8.m3.1.1" xref="S3.T2.8.8.m3.1.1.cmml"><mi id="S3.T2.8.8.m3.1.1.2" xref="S3.T2.8.8.m3.1.1.2.cmml">L</mi><mo id="S3.T2.8.8.m3.1.1.1" xref="S3.T2.8.8.m3.1.1.1.cmml">&lt;</mo><mi id="S3.T2.8.8.m3.1.1.3" xref="S3.T2.8.8.m3.1.1.3.cmml">S</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.8.8.m3.1c"><apply id="S3.T2.8.8.m3.1.1.cmml" xref="S3.T2.8.8.m3.1.1"><lt id="S3.T2.8.8.m3.1.1.1.cmml" xref="S3.T2.8.8.m3.1.1.1"></lt><ci id="S3.T2.8.8.m3.1.1.2.cmml" xref="S3.T2.8.8.m3.1.1.2">𝐿</ci><ci id="S3.T2.8.8.m3.1.1.3.cmml" xref="S3.T2.8.8.m3.1.1.3">𝑆</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.8.8.m3.1d">L&lt;S</annotation><annotation encoding="application/x-llamapun" id="S3.T2.8.8.m3.1e">italic_L &lt; italic_S</annotation></semantics></math>). <math alttext="Q_{max}" class="ltx_Math" display="inline" id="S3.T2.9.9.m4.1"><semantics id="S3.T2.9.9.m4.1b"><msub id="S3.T2.9.9.m4.1.1" xref="S3.T2.9.9.m4.1.1.cmml"><mi id="S3.T2.9.9.m4.1.1.2" xref="S3.T2.9.9.m4.1.1.2.cmml">Q</mi><mrow id="S3.T2.9.9.m4.1.1.3" xref="S3.T2.9.9.m4.1.1.3.cmml"><mi id="S3.T2.9.9.m4.1.1.3.2" xref="S3.T2.9.9.m4.1.1.3.2.cmml">m</mi><mo id="S3.T2.9.9.m4.1.1.3.1" xref="S3.T2.9.9.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.T2.9.9.m4.1.1.3.3" xref="S3.T2.9.9.m4.1.1.3.3.cmml">a</mi><mo id="S3.T2.9.9.m4.1.1.3.1b" xref="S3.T2.9.9.m4.1.1.3.1.cmml">⁢</mo><mi id="S3.T2.9.9.m4.1.1.3.4" xref="S3.T2.9.9.m4.1.1.3.4.cmml">x</mi></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.T2.9.9.m4.1c"><apply id="S3.T2.9.9.m4.1.1.cmml" xref="S3.T2.9.9.m4.1.1"><csymbol cd="ambiguous" id="S3.T2.9.9.m4.1.1.1.cmml" xref="S3.T2.9.9.m4.1.1">subscript</csymbol><ci id="S3.T2.9.9.m4.1.1.2.cmml" xref="S3.T2.9.9.m4.1.1.2">𝑄</ci><apply id="S3.T2.9.9.m4.1.1.3.cmml" xref="S3.T2.9.9.m4.1.1.3"><times id="S3.T2.9.9.m4.1.1.3.1.cmml" xref="S3.T2.9.9.m4.1.1.3.1"></times><ci id="S3.T2.9.9.m4.1.1.3.2.cmml" xref="S3.T2.9.9.m4.1.1.3.2">𝑚</ci><ci id="S3.T2.9.9.m4.1.1.3.3.cmml" xref="S3.T2.9.9.m4.1.1.3.3">𝑎</ci><ci id="S3.T2.9.9.m4.1.1.3.4.cmml" xref="S3.T2.9.9.m4.1.1.3.4">𝑥</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.9.9.m4.1d">Q_{max}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.9.9.m4.1e">italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math> denotes the maximum number of windows encompassed by the long-term memory queue. <math alttext="N" class="ltx_Math" display="inline" id="S3.T2.10.10.m5.1"><semantics id="S3.T2.10.10.m5.1b"><mi id="S3.T2.10.10.m5.1.1" xref="S3.T2.10.10.m5.1.1.cmml">N</mi><annotation-xml encoding="MathML-Content" id="S3.T2.10.10.m5.1c"><ci id="S3.T2.10.10.m5.1.1.cmml" xref="S3.T2.10.10.m5.1.1">𝑁</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.10.10.m5.1d">N</annotation><annotation encoding="application/x-llamapun" id="S3.T2.10.10.m5.1e">italic_N</annotation></semantics></math> signifies the total number of network layers.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S3.T2.12.12.2">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T2.12.12.2.3.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row" id="S3.T2.12.12.2.3.1.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.12.12.2.3.1.1.1">PROPERTY</span></th>
<td class="ltx_td ltx_align_center" id="S3.T2.12.12.2.3.1.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.12.12.2.3.1.2.1">LONG</span></td>
<td class="ltx_td ltx_align_center" id="S3.T2.12.12.2.3.1.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.12.12.2.3.1.3.1">SHORT</span></td>
</tr>
<tr class="ltx_tr" id="S3.T2.12.12.2.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S3.T2.12.12.2.4.2.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.12.12.2.4.2.1.1">Number of layers</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.12.12.2.4.2.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_italic" id="S3.T2.12.12.2.4.2.2.1">single</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.12.12.2.4.2.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_italic" id="S3.T2.12.12.2.4.2.3.1">multiple</span></td>
</tr>
<tr class="ltx_tr" id="S3.T2.12.12.2.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T2.12.12.2.5.3.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.12.12.2.5.3.1.1">Update per window</span></th>
<td class="ltx_td ltx_align_center" id="S3.T2.12.12.2.5.3.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_italic" id="S3.T2.12.12.2.5.3.2.1">incremental</span></td>
<td class="ltx_td ltx_align_center" id="S3.T2.12.12.2.5.3.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_italic" id="S3.T2.12.12.2.5.3.3.1">recurrent</span></td>
</tr>
<tr class="ltx_tr" id="S3.T2.12.12.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="S3.T2.12.12.2.2.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.12.12.2.2.3.1">Capacity</span></th>
<td class="ltx_td ltx_align_center" id="S3.T2.11.11.1.1.1" style="padding-left:2.8pt;padding-right:2.8pt;"><math alttext="L\times Q_{max}" class="ltx_Math" display="inline" id="S3.T2.11.11.1.1.1.m1.1"><semantics id="S3.T2.11.11.1.1.1.m1.1a"><mrow id="S3.T2.11.11.1.1.1.m1.1.1" xref="S3.T2.11.11.1.1.1.m1.1.1.cmml"><mi id="S3.T2.11.11.1.1.1.m1.1.1.2" xref="S3.T2.11.11.1.1.1.m1.1.1.2.cmml">L</mi><mo id="S3.T2.11.11.1.1.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.T2.11.11.1.1.1.m1.1.1.1.cmml">×</mo><msub id="S3.T2.11.11.1.1.1.m1.1.1.3" xref="S3.T2.11.11.1.1.1.m1.1.1.3.cmml"><mi id="S3.T2.11.11.1.1.1.m1.1.1.3.2" xref="S3.T2.11.11.1.1.1.m1.1.1.3.2.cmml">Q</mi><mrow id="S3.T2.11.11.1.1.1.m1.1.1.3.3" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.cmml"><mi id="S3.T2.11.11.1.1.1.m1.1.1.3.3.2" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.2.cmml">m</mi><mo id="S3.T2.11.11.1.1.1.m1.1.1.3.3.1" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.T2.11.11.1.1.1.m1.1.1.3.3.3" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.3.cmml">a</mi><mo id="S3.T2.11.11.1.1.1.m1.1.1.3.3.1a" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.1.cmml">⁢</mo><mi id="S3.T2.11.11.1.1.1.m1.1.1.3.3.4" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.4.cmml">x</mi></mrow></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.11.11.1.1.1.m1.1b"><apply id="S3.T2.11.11.1.1.1.m1.1.1.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1"><times id="S3.T2.11.11.1.1.1.m1.1.1.1.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.1"></times><ci id="S3.T2.11.11.1.1.1.m1.1.1.2.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.2">𝐿</ci><apply id="S3.T2.11.11.1.1.1.m1.1.1.3.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T2.11.11.1.1.1.m1.1.1.3.1.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.3">subscript</csymbol><ci id="S3.T2.11.11.1.1.1.m1.1.1.3.2.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.3.2">𝑄</ci><apply id="S3.T2.11.11.1.1.1.m1.1.1.3.3.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3"><times id="S3.T2.11.11.1.1.1.m1.1.1.3.3.1.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.1"></times><ci id="S3.T2.11.11.1.1.1.m1.1.1.3.3.2.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.2">𝑚</ci><ci id="S3.T2.11.11.1.1.1.m1.1.1.3.3.3.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.3">𝑎</ci><ci id="S3.T2.11.11.1.1.1.m1.1.1.3.3.4.cmml" xref="S3.T2.11.11.1.1.1.m1.1.1.3.3.4">𝑥</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.11.11.1.1.1.m1.1c">L\times Q_{max}</annotation><annotation encoding="application/x-llamapun" id="S3.T2.11.11.1.1.1.m1.1d">italic_L × italic_Q start_POSTSUBSCRIPT italic_m italic_a italic_x end_POSTSUBSCRIPT</annotation></semantics></math></td>
<td class="ltx_td ltx_align_center" id="S3.T2.12.12.2.2.2" style="padding-left:2.8pt;padding-right:2.8pt;"><math alttext="S\times N" class="ltx_Math" display="inline" id="S3.T2.12.12.2.2.2.m1.1"><semantics id="S3.T2.12.12.2.2.2.m1.1a"><mrow id="S3.T2.12.12.2.2.2.m1.1.1" xref="S3.T2.12.12.2.2.2.m1.1.1.cmml"><mi id="S3.T2.12.12.2.2.2.m1.1.1.2" xref="S3.T2.12.12.2.2.2.m1.1.1.2.cmml">S</mi><mo id="S3.T2.12.12.2.2.2.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.T2.12.12.2.2.2.m1.1.1.1.cmml">×</mo><mi id="S3.T2.12.12.2.2.2.m1.1.1.3" xref="S3.T2.12.12.2.2.2.m1.1.1.3.cmml">N</mi></mrow><annotation-xml encoding="MathML-Content" id="S3.T2.12.12.2.2.2.m1.1b"><apply id="S3.T2.12.12.2.2.2.m1.1.1.cmml" xref="S3.T2.12.12.2.2.2.m1.1.1"><times id="S3.T2.12.12.2.2.2.m1.1.1.1.cmml" xref="S3.T2.12.12.2.2.2.m1.1.1.1"></times><ci id="S3.T2.12.12.2.2.2.m1.1.1.2.cmml" xref="S3.T2.12.12.2.2.2.m1.1.1.2">𝑆</ci><ci id="S3.T2.12.12.2.2.2.m1.1.1.3.cmml" xref="S3.T2.12.12.2.2.2.m1.1.1.3">𝑁</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T2.12.12.2.2.2.m1.1c">S\times N</annotation><annotation encoding="application/x-llamapun" id="S3.T2.12.12.2.2.2.m1.1d">italic_S × italic_N</annotation></semantics></math></td>
</tr>
</tbody>
</table>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_top" id="S3.T2.fig1" style="width:219.0pt;">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Table 2: </span><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.2.1">Baseline implementations.</span> Our re-implementations utilize a cosine decay learning rate schedule (replacing inverse square root decay) and dense cross-attention for the Memorizing Transformer (replacing top-k attention). This results in improved performance compared to prior reported results.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S3.T2.fig1.3">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S3.T2.fig1.3.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r" id="S3.T2.fig1.3.1.1.1" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.1.1.1.1">Baseline</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" colspan="2" id="S3.T2.fig1.3.1.1.2" style="padding-left:2.3pt;padding-right:2.3pt;">
<span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.1.1.2.1">PG-19</span> (T5)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" colspan="2" id="S3.T2.fig1.3.1.1.3" style="padding-left:2.3pt;padding-right:2.3pt;">
<span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.1.1.3.1">arXiv</span> (Meena)</th>
</tr>
<tr class="ltx_tr" id="S3.T2.fig1.3.2.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r" id="S3.T2.fig1.3.2.2.1" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.2.2.1.1">Method</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T2.fig1.3.2.2.2" style="padding-left:2.3pt;padding-right:2.3pt;">prior</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" id="S3.T2.fig1.3.2.2.3" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.2.2.3.1">our</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T2.fig1.3.2.2.4" style="padding-left:2.3pt;padding-right:2.3pt;">prior</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T2.fig1.3.2.2.5" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.2.2.5.1">our</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T2.fig1.3.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S3.T2.fig1.3.3.1.1" style="padding-left:2.3pt;padding-right:2.3pt;">Transformer XL</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.fig1.3.3.1.2" style="padding-left:2.3pt;padding-right:2.3pt;">11.96</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T2.fig1.3.3.1.3" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.3.1.3.1">11.54</span></td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.fig1.3.3.1.4" style="padding-left:2.3pt;padding-right:2.3pt;">2.67</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T2.fig1.3.3.1.5" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.3.1.5.1">2.61</span></td>
</tr>
<tr class="ltx_tr" id="S3.T2.fig1.3.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S3.T2.fig1.3.4.2.1" style="padding-left:2.3pt;padding-right:2.3pt;">Block Recurrent</th>
<td class="ltx_td ltx_align_center" id="S3.T2.fig1.3.4.2.2" style="padding-left:2.3pt;padding-right:2.3pt;">11.55</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T2.fig1.3.4.2.3" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.4.2.3.1">10.98</span></td>
<td class="ltx_td ltx_align_center" id="S3.T2.fig1.3.4.2.4" style="padding-left:2.3pt;padding-right:2.3pt;">2.36</td>
<td class="ltx_td ltx_align_center" id="S3.T2.fig1.3.4.2.5" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.4.2.5.1">2.26</span></td>
</tr>
<tr class="ltx_tr" id="S3.T2.fig1.3.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S3.T2.fig1.3.5.3.1" style="padding-left:2.3pt;padding-right:2.3pt;">Memorizing Trans.</th>
<td class="ltx_td ltx_align_center" id="S3.T2.fig1.3.5.3.2" style="padding-left:2.3pt;padding-right:2.3pt;">11.62</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T2.fig1.3.5.3.3" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.5.3.3.1">10.74</span></td>
<td class="ltx_td ltx_align_center" id="S3.T2.fig1.3.5.3.4" style="padding-left:2.3pt;padding-right:2.3pt;">2.31</td>
<td class="ltx_td ltx_align_center" id="S3.T2.fig1.3.5.3.5" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T2.fig1.3.5.3.5.1">2.15</span></td>
</tr>
</tbody>
</table>
</figure>
</div>
</div>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS1.p3">
<p class="ltx_p" id="S3.SS1.p3.1"><span class="ltx_text ltx_font_bold" id="S3.SS1.p3.1.1">C4(4K+):</span>
The C4 dataset <cite class="ltx_cite ltx_citemacro_citep">(Raffel et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib24" title="">2020a</a>)</cite> is a large collection of internet documents. To emphasize long documents where memory is crucial, we filter out those with fewer than 4,096 tokens and utilize a 32k custom vocabulary.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Setup</h3>
<div class="ltx_para ltx_noindent" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.1">We utilized a decoder-only transformer architecture (with 12 or 13 layers), incorporating both short-term and long-term memory caches. The model had an embedding size of 1024, 8 attention heads with a dimensionality of 128 each, and an FFN hidden layer of size 4096. All models were implemented in JAX and Flax and trained from scratch for 500k steps on 32 TPU cores. Further training details are provided in the Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A2" title="Appendix B Training Details ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">B</span></a>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS2.p2">
<p class="ltx_p" id="S3.SS2.p2.2">During training, each long document was segmented into 4096-token chunks to facilitate batch processing. These chunks were then organized into training batches, each comprising 8 context windows of 512 tokens. In our ablation study, <span class="ltx_text ltx_font_smallcaps" id="S3.SS2.p2.2.1">Melodi</span>’s default configuration compressed each context window into <math alttext="S" class="ltx_Math" display="inline" id="S3.SS2.p2.1.m1.1"><semantics id="S3.SS2.p2.1.m1.1a"><mi id="S3.SS2.p2.1.m1.1.1" xref="S3.SS2.p2.1.m1.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.1.m1.1b"><ci id="S3.SS2.p2.1.m1.1.1.cmml" xref="S3.SS2.p2.1.m1.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.1.m1.1c">S</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.1.m1.1d">italic_S</annotation></semantics></math>=128 short-term memory tokens per layer and <math alttext="L" class="ltx_Math" display="inline" id="S3.SS2.p2.2.m2.1"><semantics id="S3.SS2.p2.2.m2.1a"><mi id="S3.SS2.p2.2.m2.1.1" xref="S3.SS2.p2.2.m2.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p2.2.m2.1b"><ci id="S3.SS2.p2.2.m2.1.1.cmml" xref="S3.SS2.p2.2.m2.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p2.2.m2.1c">L</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p2.2.m2.1d">italic_L</annotation></semantics></math>=64 long-term memory tokens.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>Comparison with Baselines</h3>
<div class="ltx_para ltx_noindent" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.1"><span class="ltx_text ltx_font_bold" id="S3.SS3.p1.1.1">Baselines:</span>
We benchmark <span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p1.1.2">Melodi</span> against three well-established prior works: Transformer XL <cite class="ltx_cite ltx_citemacro_citep">(Dai et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib7" title="">2019</a>)</cite>, Block Recurrent Transformer <cite class="ltx_cite ltx_citemacro_citep">(Hutchins et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib15" title="">2022</a>)</cite>, and Memorizing Transformer <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib37" title="">2022</a>)</cite>. To ensure a fair comparison, we re-implement these baselines within our framework and evaluate them under identical settings.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS3.p2">
<p class="ltx_p" id="S3.SS3.p2.1">Our re-implementations of the baseline models achieve superior performance compared to the results reported in their original papers (see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.T2" title="Table 2 ‣ 3.1 Datasets ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">2</span></a>). This improvement can be primarily attributed to two key factors: (a) using cosine decay learning rate schedule <cite class="ltx_cite ltx_citemacro_citep">(Hoffmann et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib12" title="">2022</a>)</cite> instead of the inverse square root decay, (b) using dense cross-attention instead of top-k attention for the Memorizing Transformer. Our re-implementations provide stronger baselines against which to evaluate <span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p2.1.1">Melodi</span>’s effectiveness.</p>
</div>
<figure class="ltx_table" id="S3.T3">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 3: </span><span class="ltx_text ltx_font_bold" id="S3.T3.28.1">Comparisons with baselines on three datasets</span>. The table reports average token-level perplexities for various models on three datasets. All models were trained under the same settings (e.g. segment length 4096, context window 512, 500k training steps). Three <span class="ltx_text ltx_font_smallcaps" id="S3.T3.29.2">Melodi</span> configurations were used: <math alttext="S_{192}+L_{32}" class="ltx_Math" display="inline" id="S3.T3.9.m1.1"><semantics id="S3.T3.9.m1.1b"><mrow id="S3.T3.9.m1.1.1" xref="S3.T3.9.m1.1.1.cmml"><msub id="S3.T3.9.m1.1.1.2" xref="S3.T3.9.m1.1.1.2.cmml"><mi id="S3.T3.9.m1.1.1.2.2" xref="S3.T3.9.m1.1.1.2.2.cmml">S</mi><mn id="S3.T3.9.m1.1.1.2.3" xref="S3.T3.9.m1.1.1.2.3.cmml">192</mn></msub><mo id="S3.T3.9.m1.1.1.1" xref="S3.T3.9.m1.1.1.1.cmml">+</mo><msub id="S3.T3.9.m1.1.1.3" xref="S3.T3.9.m1.1.1.3.cmml"><mi id="S3.T3.9.m1.1.1.3.2" xref="S3.T3.9.m1.1.1.3.2.cmml">L</mi><mn id="S3.T3.9.m1.1.1.3.3" xref="S3.T3.9.m1.1.1.3.3.cmml">32</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T3.9.m1.1c"><apply id="S3.T3.9.m1.1.1.cmml" xref="S3.T3.9.m1.1.1"><plus id="S3.T3.9.m1.1.1.1.cmml" xref="S3.T3.9.m1.1.1.1"></plus><apply id="S3.T3.9.m1.1.1.2.cmml" xref="S3.T3.9.m1.1.1.2"><csymbol cd="ambiguous" id="S3.T3.9.m1.1.1.2.1.cmml" xref="S3.T3.9.m1.1.1.2">subscript</csymbol><ci id="S3.T3.9.m1.1.1.2.2.cmml" xref="S3.T3.9.m1.1.1.2.2">𝑆</ci><cn id="S3.T3.9.m1.1.1.2.3.cmml" type="integer" xref="S3.T3.9.m1.1.1.2.3">192</cn></apply><apply id="S3.T3.9.m1.1.1.3.cmml" xref="S3.T3.9.m1.1.1.3"><csymbol cd="ambiguous" id="S3.T3.9.m1.1.1.3.1.cmml" xref="S3.T3.9.m1.1.1.3">subscript</csymbol><ci id="S3.T3.9.m1.1.1.3.2.cmml" xref="S3.T3.9.m1.1.1.3.2">𝐿</ci><cn id="S3.T3.9.m1.1.1.3.3.cmml" type="integer" xref="S3.T3.9.m1.1.1.3.3">32</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.9.m1.1d">S_{192}+L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.9.m1.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="S_{128}+L_{64}" class="ltx_Math" display="inline" id="S3.T3.10.m2.1"><semantics id="S3.T3.10.m2.1b"><mrow id="S3.T3.10.m2.1.1" xref="S3.T3.10.m2.1.1.cmml"><msub id="S3.T3.10.m2.1.1.2" xref="S3.T3.10.m2.1.1.2.cmml"><mi id="S3.T3.10.m2.1.1.2.2" xref="S3.T3.10.m2.1.1.2.2.cmml">S</mi><mn id="S3.T3.10.m2.1.1.2.3" xref="S3.T3.10.m2.1.1.2.3.cmml">128</mn></msub><mo id="S3.T3.10.m2.1.1.1" xref="S3.T3.10.m2.1.1.1.cmml">+</mo><msub id="S3.T3.10.m2.1.1.3" xref="S3.T3.10.m2.1.1.3.cmml"><mi id="S3.T3.10.m2.1.1.3.2" xref="S3.T3.10.m2.1.1.3.2.cmml">L</mi><mn id="S3.T3.10.m2.1.1.3.3" xref="S3.T3.10.m2.1.1.3.3.cmml">64</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T3.10.m2.1c"><apply id="S3.T3.10.m2.1.1.cmml" xref="S3.T3.10.m2.1.1"><plus id="S3.T3.10.m2.1.1.1.cmml" xref="S3.T3.10.m2.1.1.1"></plus><apply id="S3.T3.10.m2.1.1.2.cmml" xref="S3.T3.10.m2.1.1.2"><csymbol cd="ambiguous" id="S3.T3.10.m2.1.1.2.1.cmml" xref="S3.T3.10.m2.1.1.2">subscript</csymbol><ci id="S3.T3.10.m2.1.1.2.2.cmml" xref="S3.T3.10.m2.1.1.2.2">𝑆</ci><cn id="S3.T3.10.m2.1.1.2.3.cmml" type="integer" xref="S3.T3.10.m2.1.1.2.3">128</cn></apply><apply id="S3.T3.10.m2.1.1.3.cmml" xref="S3.T3.10.m2.1.1.3"><csymbol cd="ambiguous" id="S3.T3.10.m2.1.1.3.1.cmml" xref="S3.T3.10.m2.1.1.3">subscript</csymbol><ci id="S3.T3.10.m2.1.1.3.2.cmml" xref="S3.T3.10.m2.1.1.3.2">𝐿</ci><cn id="S3.T3.10.m2.1.1.3.3.cmml" type="integer" xref="S3.T3.10.m2.1.1.3.3">64</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.10.m2.1d">S_{128}+L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.10.m2.1e">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>, and <math alttext="S_{192}+L_{96}" class="ltx_Math" display="inline" id="S3.T3.11.m3.1"><semantics id="S3.T3.11.m3.1b"><mrow id="S3.T3.11.m3.1.1" xref="S3.T3.11.m3.1.1.cmml"><msub id="S3.T3.11.m3.1.1.2" xref="S3.T3.11.m3.1.1.2.cmml"><mi id="S3.T3.11.m3.1.1.2.2" xref="S3.T3.11.m3.1.1.2.2.cmml">S</mi><mn id="S3.T3.11.m3.1.1.2.3" xref="S3.T3.11.m3.1.1.2.3.cmml">192</mn></msub><mo id="S3.T3.11.m3.1.1.1" xref="S3.T3.11.m3.1.1.1.cmml">+</mo><msub id="S3.T3.11.m3.1.1.3" xref="S3.T3.11.m3.1.1.3.cmml"><mi id="S3.T3.11.m3.1.1.3.2" xref="S3.T3.11.m3.1.1.3.2.cmml">L</mi><mn id="S3.T3.11.m3.1.1.3.3" xref="S3.T3.11.m3.1.1.3.3.cmml">96</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T3.11.m3.1c"><apply id="S3.T3.11.m3.1.1.cmml" xref="S3.T3.11.m3.1.1"><plus id="S3.T3.11.m3.1.1.1.cmml" xref="S3.T3.11.m3.1.1.1"></plus><apply id="S3.T3.11.m3.1.1.2.cmml" xref="S3.T3.11.m3.1.1.2"><csymbol cd="ambiguous" id="S3.T3.11.m3.1.1.2.1.cmml" xref="S3.T3.11.m3.1.1.2">subscript</csymbol><ci id="S3.T3.11.m3.1.1.2.2.cmml" xref="S3.T3.11.m3.1.1.2.2">𝑆</ci><cn id="S3.T3.11.m3.1.1.2.3.cmml" type="integer" xref="S3.T3.11.m3.1.1.2.3">192</cn></apply><apply id="S3.T3.11.m3.1.1.3.cmml" xref="S3.T3.11.m3.1.1.3"><csymbol cd="ambiguous" id="S3.T3.11.m3.1.1.3.1.cmml" xref="S3.T3.11.m3.1.1.3">subscript</csymbol><ci id="S3.T3.11.m3.1.1.3.2.cmml" xref="S3.T3.11.m3.1.1.3.2">𝐿</ci><cn id="S3.T3.11.m3.1.1.3.3.cmml" type="integer" xref="S3.T3.11.m3.1.1.3.3">96</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.11.m3.1d">S_{192}+L_{96}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.11.m3.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>. For instance, <math alttext="S_{192}+L_{32}" class="ltx_Math" display="inline" id="S3.T3.12.m4.1"><semantics id="S3.T3.12.m4.1b"><mrow id="S3.T3.12.m4.1.1" xref="S3.T3.12.m4.1.1.cmml"><msub id="S3.T3.12.m4.1.1.2" xref="S3.T3.12.m4.1.1.2.cmml"><mi id="S3.T3.12.m4.1.1.2.2" xref="S3.T3.12.m4.1.1.2.2.cmml">S</mi><mn id="S3.T3.12.m4.1.1.2.3" xref="S3.T3.12.m4.1.1.2.3.cmml">192</mn></msub><mo id="S3.T3.12.m4.1.1.1" xref="S3.T3.12.m4.1.1.1.cmml">+</mo><msub id="S3.T3.12.m4.1.1.3" xref="S3.T3.12.m4.1.1.3.cmml"><mi id="S3.T3.12.m4.1.1.3.2" xref="S3.T3.12.m4.1.1.3.2.cmml">L</mi><mn id="S3.T3.12.m4.1.1.3.3" xref="S3.T3.12.m4.1.1.3.3.cmml">32</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T3.12.m4.1c"><apply id="S3.T3.12.m4.1.1.cmml" xref="S3.T3.12.m4.1.1"><plus id="S3.T3.12.m4.1.1.1.cmml" xref="S3.T3.12.m4.1.1.1"></plus><apply id="S3.T3.12.m4.1.1.2.cmml" xref="S3.T3.12.m4.1.1.2"><csymbol cd="ambiguous" id="S3.T3.12.m4.1.1.2.1.cmml" xref="S3.T3.12.m4.1.1.2">subscript</csymbol><ci id="S3.T3.12.m4.1.1.2.2.cmml" xref="S3.T3.12.m4.1.1.2.2">𝑆</ci><cn id="S3.T3.12.m4.1.1.2.3.cmml" type="integer" xref="S3.T3.12.m4.1.1.2.3">192</cn></apply><apply id="S3.T3.12.m4.1.1.3.cmml" xref="S3.T3.12.m4.1.1.3"><csymbol cd="ambiguous" id="S3.T3.12.m4.1.1.3.1.cmml" xref="S3.T3.12.m4.1.1.3">subscript</csymbol><ci id="S3.T3.12.m4.1.1.3.2.cmml" xref="S3.T3.12.m4.1.1.3.2">𝐿</ci><cn id="S3.T3.12.m4.1.1.3.3.cmml" type="integer" xref="S3.T3.12.m4.1.1.3.3">32</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.12.m4.1d">S_{192}+L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.12.m4.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math> indicates <math alttext="S=192" class="ltx_Math" display="inline" id="S3.T3.13.m5.1"><semantics id="S3.T3.13.m5.1b"><mrow id="S3.T3.13.m5.1.1" xref="S3.T3.13.m5.1.1.cmml"><mi id="S3.T3.13.m5.1.1.2" xref="S3.T3.13.m5.1.1.2.cmml">S</mi><mo id="S3.T3.13.m5.1.1.1" xref="S3.T3.13.m5.1.1.1.cmml">=</mo><mn id="S3.T3.13.m5.1.1.3" xref="S3.T3.13.m5.1.1.3.cmml">192</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.T3.13.m5.1c"><apply id="S3.T3.13.m5.1.1.cmml" xref="S3.T3.13.m5.1.1"><eq id="S3.T3.13.m5.1.1.1.cmml" xref="S3.T3.13.m5.1.1.1"></eq><ci id="S3.T3.13.m5.1.1.2.cmml" xref="S3.T3.13.m5.1.1.2">𝑆</ci><cn id="S3.T3.13.m5.1.1.3.cmml" type="integer" xref="S3.T3.13.m5.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.13.m5.1d">S=192</annotation><annotation encoding="application/x-llamapun" id="S3.T3.13.m5.1e">italic_S = 192</annotation></semantics></math> short-term and <math alttext="L=32" class="ltx_Math" display="inline" id="S3.T3.14.m6.1"><semantics id="S3.T3.14.m6.1b"><mrow id="S3.T3.14.m6.1.1" xref="S3.T3.14.m6.1.1.cmml"><mi id="S3.T3.14.m6.1.1.2" xref="S3.T3.14.m6.1.1.2.cmml">L</mi><mo id="S3.T3.14.m6.1.1.1" xref="S3.T3.14.m6.1.1.1.cmml">=</mo><mn id="S3.T3.14.m6.1.1.3" xref="S3.T3.14.m6.1.1.3.cmml">32</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.T3.14.m6.1c"><apply id="S3.T3.14.m6.1.1.cmml" xref="S3.T3.14.m6.1.1"><eq id="S3.T3.14.m6.1.1.1.cmml" xref="S3.T3.14.m6.1.1.1"></eq><ci id="S3.T3.14.m6.1.1.2.cmml" xref="S3.T3.14.m6.1.1.2">𝐿</ci><cn id="S3.T3.14.m6.1.1.3.cmml" type="integer" xref="S3.T3.14.m6.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.14.m6.1d">L=32</annotation><annotation encoding="application/x-llamapun" id="S3.T3.14.m6.1e">italic_L = 32</annotation></semantics></math> long-term tokens per context window. All <span class="ltx_text ltx_font_smallcaps" id="S3.T3.30.3">Melodi</span> models utilized a long-term memory spanning 128 context windows.
<span class="ltx_text ltx_font_smallcaps" id="S3.T3.31.4">Melodi</span> <math alttext="S_{192}+L_{32}" class="ltx_Math" display="inline" id="S3.T3.15.m7.1"><semantics id="S3.T3.15.m7.1b"><mrow id="S3.T3.15.m7.1.1" xref="S3.T3.15.m7.1.1.cmml"><msub id="S3.T3.15.m7.1.1.2" xref="S3.T3.15.m7.1.1.2.cmml"><mi id="S3.T3.15.m7.1.1.2.2" xref="S3.T3.15.m7.1.1.2.2.cmml">S</mi><mn id="S3.T3.15.m7.1.1.2.3" xref="S3.T3.15.m7.1.1.2.3.cmml">192</mn></msub><mo id="S3.T3.15.m7.1.1.1" xref="S3.T3.15.m7.1.1.1.cmml">+</mo><msub id="S3.T3.15.m7.1.1.3" xref="S3.T3.15.m7.1.1.3.cmml"><mi id="S3.T3.15.m7.1.1.3.2" xref="S3.T3.15.m7.1.1.3.2.cmml">L</mi><mn id="S3.T3.15.m7.1.1.3.3" xref="S3.T3.15.m7.1.1.3.3.cmml">32</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T3.15.m7.1c"><apply id="S3.T3.15.m7.1.1.cmml" xref="S3.T3.15.m7.1.1"><plus id="S3.T3.15.m7.1.1.1.cmml" xref="S3.T3.15.m7.1.1.1"></plus><apply id="S3.T3.15.m7.1.1.2.cmml" xref="S3.T3.15.m7.1.1.2"><csymbol cd="ambiguous" id="S3.T3.15.m7.1.1.2.1.cmml" xref="S3.T3.15.m7.1.1.2">subscript</csymbol><ci id="S3.T3.15.m7.1.1.2.2.cmml" xref="S3.T3.15.m7.1.1.2.2">𝑆</ci><cn id="S3.T3.15.m7.1.1.2.3.cmml" type="integer" xref="S3.T3.15.m7.1.1.2.3">192</cn></apply><apply id="S3.T3.15.m7.1.1.3.cmml" xref="S3.T3.15.m7.1.1.3"><csymbol cd="ambiguous" id="S3.T3.15.m7.1.1.3.1.cmml" xref="S3.T3.15.m7.1.1.3">subscript</csymbol><ci id="S3.T3.15.m7.1.1.3.2.cmml" xref="S3.T3.15.m7.1.1.3.2">𝐿</ci><cn id="S3.T3.15.m7.1.1.3.3.cmml" type="integer" xref="S3.T3.15.m7.1.1.3.3">32</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.15.m7.1d">S_{192}+L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.15.m7.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math> outperformed Transformer XL and Block Recurrent Transformer while consuming less memory. Notably, <span class="ltx_text ltx_font_smallcaps" id="S3.T3.32.5">Melodi</span> <math alttext="S_{192}+L_{96}" class="ltx_Math" display="inline" id="S3.T3.16.m8.1"><semantics id="S3.T3.16.m8.1b"><mrow id="S3.T3.16.m8.1.1" xref="S3.T3.16.m8.1.1.cmml"><msub id="S3.T3.16.m8.1.1.2" xref="S3.T3.16.m8.1.1.2.cmml"><mi id="S3.T3.16.m8.1.1.2.2" xref="S3.T3.16.m8.1.1.2.2.cmml">S</mi><mn id="S3.T3.16.m8.1.1.2.3" xref="S3.T3.16.m8.1.1.2.3.cmml">192</mn></msub><mo id="S3.T3.16.m8.1.1.1" xref="S3.T3.16.m8.1.1.1.cmml">+</mo><msub id="S3.T3.16.m8.1.1.3" xref="S3.T3.16.m8.1.1.3.cmml"><mi id="S3.T3.16.m8.1.1.3.2" xref="S3.T3.16.m8.1.1.3.2.cmml">L</mi><mn id="S3.T3.16.m8.1.1.3.3" xref="S3.T3.16.m8.1.1.3.3.cmml">96</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.T3.16.m8.1c"><apply id="S3.T3.16.m8.1.1.cmml" xref="S3.T3.16.m8.1.1"><plus id="S3.T3.16.m8.1.1.1.cmml" xref="S3.T3.16.m8.1.1.1"></plus><apply id="S3.T3.16.m8.1.1.2.cmml" xref="S3.T3.16.m8.1.1.2"><csymbol cd="ambiguous" id="S3.T3.16.m8.1.1.2.1.cmml" xref="S3.T3.16.m8.1.1.2">subscript</csymbol><ci id="S3.T3.16.m8.1.1.2.2.cmml" xref="S3.T3.16.m8.1.1.2.2">𝑆</ci><cn id="S3.T3.16.m8.1.1.2.3.cmml" type="integer" xref="S3.T3.16.m8.1.1.2.3">192</cn></apply><apply id="S3.T3.16.m8.1.1.3.cmml" xref="S3.T3.16.m8.1.1.3"><csymbol cd="ambiguous" id="S3.T3.16.m8.1.1.3.1.cmml" xref="S3.T3.16.m8.1.1.3">subscript</csymbol><ci id="S3.T3.16.m8.1.1.3.2.cmml" xref="S3.T3.16.m8.1.1.3.2">𝐿</ci><cn id="S3.T3.16.m8.1.1.3.3.cmml" type="integer" xref="S3.T3.16.m8.1.1.3.3">96</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.16.m8.1d">S_{192}+L_{96}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.16.m8.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math> clearly surpassed Memorizing Transformer, using only a fifth of its memory.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S3.T3.22.6">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S3.T3.22.6.7.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" id="S3.T3.22.6.7.1.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.7.1.1.1">MODEL</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" colspan="3" id="S3.T3.22.6.7.1.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.7.1.2.1">MEMORY</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" colspan="3" id="S3.T3.22.6.7.1.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.7.1.3.1">PG19</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" colspan="2" id="S3.T3.22.6.7.1.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.7.1.4.1">arXiv</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T3.22.6.7.1.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.7.1.5.1">C4(4K+)</span></th>
</tr>
<tr class="ltx_tr" id="S3.T3.22.6.8.2">
<th class="ltx_td ltx_th ltx_th_column ltx_border_r" id="S3.T3.22.6.8.2.1" style="padding-left:2.8pt;padding-right:2.8pt;"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T3.22.6.8.2.2" style="padding-left:2.8pt;padding-right:2.8pt;">All</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T3.22.6.8.2.3" style="padding-left:2.8pt;padding-right:2.8pt;">Short</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="S3.T3.22.6.8.2.4" style="padding-left:2.8pt;padding-right:2.8pt;">Long</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T3.22.6.8.2.5" style="padding-left:2.8pt;padding-right:2.8pt;">Meena</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T3.22.6.8.2.6" style="padding-left:2.8pt;padding-right:2.8pt;">T5</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" id="S3.T3.22.6.8.2.7" style="padding-left:2.8pt;padding-right:2.8pt;">Custom</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T3.22.6.8.2.8" style="padding-left:2.8pt;padding-right:2.8pt;">Meena</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" id="S3.T3.22.6.8.2.9" style="padding-left:2.8pt;padding-right:2.8pt;">Custom</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T3.22.6.8.2.10" style="padding-left:2.8pt;padding-right:2.8pt;">Custom</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T3.22.6.9.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="S3.T3.22.6.9.1.1" style="padding-left:2.8pt;padding-right:2.8pt;">Transformer XL</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S3.T3.22.6.9.1.2" style="padding-left:2.8pt;padding-right:2.8pt;">13.6M</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S3.T3.22.6.9.1.3" style="padding-left:2.8pt;padding-right:2.8pt;">13.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="S3.T3.22.6.9.1.4" style="padding-left:2.8pt;padding-right:2.8pt;">0M</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.22.6.9.1.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.65</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.22.6.9.1.6" style="padding-left:2.8pt;padding-right:2.8pt;">11.41</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T3.22.6.9.1.7" style="padding-left:2.8pt;padding-right:2.8pt;">12.42</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.22.6.9.1.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.60</td>
<td class="ltx_td ltx_align_center ltx_border_r ltx_border_t" id="S3.T3.22.6.9.1.9" style="padding-left:2.8pt;padding-right:2.8pt;">3.22</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T3.22.6.9.1.10" style="padding-left:2.8pt;padding-right:2.8pt;">18.22</td>
</tr>
<tr class="ltx_tr" id="S3.T3.22.6.10.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="S3.T3.22.6.10.2.1" style="padding-left:2.8pt;padding-right:2.8pt;">Block Recurrent</td>
<td class="ltx_td ltx_align_right" id="S3.T3.22.6.10.2.2" style="padding-left:2.8pt;padding-right:2.8pt;">13.1M</td>
<td class="ltx_td ltx_align_right" id="S3.T3.22.6.10.2.3" style="padding-left:2.8pt;padding-right:2.8pt;">13.1M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="S3.T3.22.6.10.2.4" style="padding-left:2.8pt;padding-right:2.8pt;">0M</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.10.2.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.30</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.10.2.6" style="padding-left:2.8pt;padding-right:2.8pt;">10.98</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.22.6.10.2.7" style="padding-left:2.8pt;padding-right:2.8pt;">11.90</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.10.2.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.26</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.22.6.10.2.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.70</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.10.2.10" style="padding-left:2.8pt;padding-right:2.8pt;">17.82</td>
</tr>
<tr class="ltx_tr" id="S3.T3.18.2.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="S3.T3.18.2.2.2" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="S3.T3.18.2.2.2.2">Melodi<span class="ltx_text ltx_font_upright" id="S3.T3.18.2.2.2.2.2"> <math alttext="S_{192}" class="ltx_Math" display="inline" id="S3.T3.17.1.1.1.1.1.m1.1"><semantics id="S3.T3.17.1.1.1.1.1.m1.1a"><msub id="S3.T3.17.1.1.1.1.1.m1.1.1" xref="S3.T3.17.1.1.1.1.1.m1.1.1.cmml"><mi id="S3.T3.17.1.1.1.1.1.m1.1.1.2" xref="S3.T3.17.1.1.1.1.1.m1.1.1.2.cmml">S</mi><mn id="S3.T3.17.1.1.1.1.1.m1.1.1.3" xref="S3.T3.17.1.1.1.1.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="S3.T3.17.1.1.1.1.1.m1.1b"><apply id="S3.T3.17.1.1.1.1.1.m1.1.1.cmml" xref="S3.T3.17.1.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T3.17.1.1.1.1.1.m1.1.1.1.cmml" xref="S3.T3.17.1.1.1.1.1.m1.1.1">subscript</csymbol><ci id="S3.T3.17.1.1.1.1.1.m1.1.1.2.cmml" xref="S3.T3.17.1.1.1.1.1.m1.1.1.2">𝑆</ci><cn id="S3.T3.17.1.1.1.1.1.m1.1.1.3.cmml" type="integer" xref="S3.T3.17.1.1.1.1.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.17.1.1.1.1.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.17.1.1.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{32}" class="ltx_Math" display="inline" id="S3.T3.18.2.2.2.2.2.m2.1"><semantics id="S3.T3.18.2.2.2.2.2.m2.1a"><msub id="S3.T3.18.2.2.2.2.2.m2.1.1" xref="S3.T3.18.2.2.2.2.2.m2.1.1.cmml"><mi id="S3.T3.18.2.2.2.2.2.m2.1.1.2" xref="S3.T3.18.2.2.2.2.2.m2.1.1.2.cmml">L</mi><mn id="S3.T3.18.2.2.2.2.2.m2.1.1.3" xref="S3.T3.18.2.2.2.2.2.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="S3.T3.18.2.2.2.2.2.m2.1b"><apply id="S3.T3.18.2.2.2.2.2.m2.1.1.cmml" xref="S3.T3.18.2.2.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.T3.18.2.2.2.2.2.m2.1.1.1.cmml" xref="S3.T3.18.2.2.2.2.2.m2.1.1">subscript</csymbol><ci id="S3.T3.18.2.2.2.2.2.m2.1.1.2.cmml" xref="S3.T3.18.2.2.2.2.2.m2.1.1.2">𝐿</ci><cn id="S3.T3.18.2.2.2.2.2.m2.1.1.3.cmml" type="integer" xref="S3.T3.18.2.2.2.2.2.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.18.2.2.2.2.2.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.18.2.2.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="S3.T3.18.2.2.3" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.18.2.2.3.1">11.0M</span></td>
<td class="ltx_td ltx_align_right" id="S3.T3.18.2.2.4" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;">2.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="S3.T3.18.2.2.5" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;">8.4M</td>
<td class="ltx_td ltx_align_center" id="S3.T3.18.2.2.6" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.18.2.2.6.1">8.08</span></td>
<td class="ltx_td ltx_align_center" id="S3.T3.18.2.2.7" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.18.2.2.7.1">10.51</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.18.2.2.8" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.18.2.2.8.1">11.47</span></td>
<td class="ltx_td ltx_align_center" id="S3.T3.18.2.2.9" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.18.2.2.9.1">2.12</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.18.2.2.10" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.18.2.2.10.1">2.54</span></td>
<td class="ltx_td ltx_align_center" id="S3.T3.18.2.2.11" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.18.2.2.11.1">17.55</span></td>
</tr>
<tr class="ltx_tr" id="S3.T3.22.6.11.3">
<td class="ltx_td ltx_align_left ltx_border_r" id="S3.T3.22.6.11.3.1" style="padding-left:2.8pt;padding-right:2.8pt;">Memorizing Trans.</td>
<td class="ltx_td ltx_align_right" id="S3.T3.22.6.11.3.2" style="padding-left:2.8pt;padding-right:2.8pt;">147.8M</td>
<td class="ltx_td ltx_align_right" id="S3.T3.22.6.11.3.3" style="padding-left:2.8pt;padding-right:2.8pt;">13.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="S3.T3.22.6.11.3.4" style="padding-left:2.8pt;padding-right:2.8pt;">134.2M</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.11.3.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.07</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.11.3.6" style="padding-left:2.8pt;padding-right:2.8pt;">10.62</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.22.6.11.3.7" style="padding-left:2.8pt;padding-right:2.8pt;">11.53</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.11.3.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.14</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.22.6.11.3.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.56</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.11.3.10" style="padding-left:2.8pt;padding-right:2.8pt;">17.37</td>
</tr>
<tr class="ltx_tr" id="S3.T3.20.4.4">
<td class="ltx_td ltx_align_left ltx_border_r" id="S3.T3.20.4.4.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="S3.T3.20.4.4.2.2">Melodi<span class="ltx_text ltx_font_upright" id="S3.T3.20.4.4.2.2.2"> <math alttext="S_{128}" class="ltx_Math" display="inline" id="S3.T3.19.3.3.1.1.1.m1.1"><semantics id="S3.T3.19.3.3.1.1.1.m1.1a"><msub id="S3.T3.19.3.3.1.1.1.m1.1.1" xref="S3.T3.19.3.3.1.1.1.m1.1.1.cmml"><mi id="S3.T3.19.3.3.1.1.1.m1.1.1.2" xref="S3.T3.19.3.3.1.1.1.m1.1.1.2.cmml">S</mi><mn id="S3.T3.19.3.3.1.1.1.m1.1.1.3" xref="S3.T3.19.3.3.1.1.1.m1.1.1.3.cmml">128</mn></msub><annotation-xml encoding="MathML-Content" id="S3.T3.19.3.3.1.1.1.m1.1b"><apply id="S3.T3.19.3.3.1.1.1.m1.1.1.cmml" xref="S3.T3.19.3.3.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T3.19.3.3.1.1.1.m1.1.1.1.cmml" xref="S3.T3.19.3.3.1.1.1.m1.1.1">subscript</csymbol><ci id="S3.T3.19.3.3.1.1.1.m1.1.1.2.cmml" xref="S3.T3.19.3.3.1.1.1.m1.1.1.2">𝑆</ci><cn id="S3.T3.19.3.3.1.1.1.m1.1.1.3.cmml" type="integer" xref="S3.T3.19.3.3.1.1.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.19.3.3.1.1.1.m1.1c">S_{128}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.19.3.3.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="S3.T3.20.4.4.2.2.2.m2.1"><semantics id="S3.T3.20.4.4.2.2.2.m2.1a"><msub id="S3.T3.20.4.4.2.2.2.m2.1.1" xref="S3.T3.20.4.4.2.2.2.m2.1.1.cmml"><mi id="S3.T3.20.4.4.2.2.2.m2.1.1.2" xref="S3.T3.20.4.4.2.2.2.m2.1.1.2.cmml">L</mi><mn id="S3.T3.20.4.4.2.2.2.m2.1.1.3" xref="S3.T3.20.4.4.2.2.2.m2.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="S3.T3.20.4.4.2.2.2.m2.1b"><apply id="S3.T3.20.4.4.2.2.2.m2.1.1.cmml" xref="S3.T3.20.4.4.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.T3.20.4.4.2.2.2.m2.1.1.1.cmml" xref="S3.T3.20.4.4.2.2.2.m2.1.1">subscript</csymbol><ci id="S3.T3.20.4.4.2.2.2.m2.1.1.2.cmml" xref="S3.T3.20.4.4.2.2.2.m2.1.1.2">𝐿</ci><cn id="S3.T3.20.4.4.2.2.2.m2.1.1.3.cmml" type="integer" xref="S3.T3.20.4.4.2.2.2.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.20.4.4.2.2.2.m2.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.20.4.4.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="S3.T3.20.4.4.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.20.4.4.3.1">18.5M</span></td>
<td class="ltx_td ltx_align_right" id="S3.T3.20.4.4.4" style="padding-left:2.8pt;padding-right:2.8pt;">1.7M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="S3.T3.20.4.4.5" style="padding-left:2.8pt;padding-right:2.8pt;">16.8M</td>
<td class="ltx_td ltx_align_center" id="S3.T3.20.4.4.6" style="padding-left:2.8pt;padding-right:2.8pt;">8.06</td>
<td class="ltx_td ltx_align_center" id="S3.T3.20.4.4.7" style="padding-left:2.8pt;padding-right:2.8pt;">10.44</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.20.4.4.8" style="padding-left:2.8pt;padding-right:2.8pt;">11.42</td>
<td class="ltx_td ltx_align_center" id="S3.T3.20.4.4.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.11</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.20.4.4.10" style="padding-left:2.8pt;padding-right:2.8pt;">2.52</td>
<td class="ltx_td ltx_align_center" id="S3.T3.20.4.4.11" style="padding-left:2.8pt;padding-right:2.8pt;">17.53</td>
</tr>
<tr class="ltx_tr" id="S3.T3.22.6.6">
<td class="ltx_td ltx_align_left ltx_border_r" id="S3.T3.22.6.6.2" style="padding-left:2.8pt;padding-right:2.8pt;">
<span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="S3.T3.22.6.6.2.1">Melodi</span> <math alttext="S_{192}" class="ltx_Math" display="inline" id="S3.T3.21.5.5.1.m1.1"><semantics id="S3.T3.21.5.5.1.m1.1a"><msub id="S3.T3.21.5.5.1.m1.1.1" xref="S3.T3.21.5.5.1.m1.1.1.cmml"><mi id="S3.T3.21.5.5.1.m1.1.1.2" xref="S3.T3.21.5.5.1.m1.1.1.2.cmml">S</mi><mn id="S3.T3.21.5.5.1.m1.1.1.3" xref="S3.T3.21.5.5.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="S3.T3.21.5.5.1.m1.1b"><apply id="S3.T3.21.5.5.1.m1.1.1.cmml" xref="S3.T3.21.5.5.1.m1.1.1"><csymbol cd="ambiguous" id="S3.T3.21.5.5.1.m1.1.1.1.cmml" xref="S3.T3.21.5.5.1.m1.1.1">subscript</csymbol><ci id="S3.T3.21.5.5.1.m1.1.1.2.cmml" xref="S3.T3.21.5.5.1.m1.1.1.2">𝑆</ci><cn id="S3.T3.21.5.5.1.m1.1.1.3.cmml" type="integer" xref="S3.T3.21.5.5.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.21.5.5.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.21.5.5.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{96}" class="ltx_Math" display="inline" id="S3.T3.22.6.6.2.m2.1"><semantics id="S3.T3.22.6.6.2.m2.1a"><msub id="S3.T3.22.6.6.2.m2.1.1" xref="S3.T3.22.6.6.2.m2.1.1.cmml"><mi id="S3.T3.22.6.6.2.m2.1.1.2" xref="S3.T3.22.6.6.2.m2.1.1.2.cmml">L</mi><mn id="S3.T3.22.6.6.2.m2.1.1.3" xref="S3.T3.22.6.6.2.m2.1.1.3.cmml">96</mn></msub><annotation-xml encoding="MathML-Content" id="S3.T3.22.6.6.2.m2.1b"><apply id="S3.T3.22.6.6.2.m2.1.1.cmml" xref="S3.T3.22.6.6.2.m2.1.1"><csymbol cd="ambiguous" id="S3.T3.22.6.6.2.m2.1.1.1.cmml" xref="S3.T3.22.6.6.2.m2.1.1">subscript</csymbol><ci id="S3.T3.22.6.6.2.m2.1.1.2.cmml" xref="S3.T3.22.6.6.2.m2.1.1.2">𝐿</ci><cn id="S3.T3.22.6.6.2.m2.1.1.3.cmml" type="integer" xref="S3.T3.22.6.6.2.m2.1.1.3">96</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.T3.22.6.6.2.m2.1c">L_{96}</annotation><annotation encoding="application/x-llamapun" id="S3.T3.22.6.6.2.m2.1d">italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_right" id="S3.T3.22.6.6.3" style="padding-left:2.8pt;padding-right:2.8pt;">27.8M</td>
<td class="ltx_td ltx_align_right" id="S3.T3.22.6.6.4" style="padding-left:2.8pt;padding-right:2.8pt;">2.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="S3.T3.22.6.6.5" style="padding-left:2.8pt;padding-right:2.8pt;">25.2M</td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.6.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.6.6.1">7.91</span></td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.6.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.6.7.1">10.29</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.22.6.6.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.6.8.1">11.27</span></td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.6.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.6.9.1">2.09</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="S3.T3.22.6.6.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.6.10.1">2.49</span></td>
<td class="ltx_td ltx_align_center" id="S3.T3.22.6.6.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="S3.T3.22.6.6.11.1">17.25</span></td>
</tr>
</tbody>
</table>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS3.p3">
<p class="ltx_p" id="S3.SS3.p3.5"><span class="ltx_text ltx_font_bold" id="S3.SS3.p3.5.1">Comparisons:</span>
Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.T3" title="Table 3 ‣ 3.3 Comparison with Baselines ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">3</span></a> presents a comparison of <span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p3.5.2">Melodi</span> against three baseline models (Transformer XL, Block Recurrent Transformer, and Memorizing Transformer) across three datasets. We evaluate three <span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p3.5.3">Melodi</span> configurations: <math alttext="S_{192}+L_{32}" class="ltx_Math" display="inline" id="S3.SS3.p3.1.m1.1"><semantics id="S3.SS3.p3.1.m1.1a"><mrow id="S3.SS3.p3.1.m1.1.1" xref="S3.SS3.p3.1.m1.1.1.cmml"><msub id="S3.SS3.p3.1.m1.1.1.2" xref="S3.SS3.p3.1.m1.1.1.2.cmml"><mi id="S3.SS3.p3.1.m1.1.1.2.2" xref="S3.SS3.p3.1.m1.1.1.2.2.cmml">S</mi><mn id="S3.SS3.p3.1.m1.1.1.2.3" xref="S3.SS3.p3.1.m1.1.1.2.3.cmml">192</mn></msub><mo id="S3.SS3.p3.1.m1.1.1.1" xref="S3.SS3.p3.1.m1.1.1.1.cmml">+</mo><msub id="S3.SS3.p3.1.m1.1.1.3" xref="S3.SS3.p3.1.m1.1.1.3.cmml"><mi id="S3.SS3.p3.1.m1.1.1.3.2" xref="S3.SS3.p3.1.m1.1.1.3.2.cmml">L</mi><mn id="S3.SS3.p3.1.m1.1.1.3.3" xref="S3.SS3.p3.1.m1.1.1.3.3.cmml">32</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.1.m1.1b"><apply id="S3.SS3.p3.1.m1.1.1.cmml" xref="S3.SS3.p3.1.m1.1.1"><plus id="S3.SS3.p3.1.m1.1.1.1.cmml" xref="S3.SS3.p3.1.m1.1.1.1"></plus><apply id="S3.SS3.p3.1.m1.1.1.2.cmml" xref="S3.SS3.p3.1.m1.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p3.1.m1.1.1.2.1.cmml" xref="S3.SS3.p3.1.m1.1.1.2">subscript</csymbol><ci id="S3.SS3.p3.1.m1.1.1.2.2.cmml" xref="S3.SS3.p3.1.m1.1.1.2.2">𝑆</ci><cn id="S3.SS3.p3.1.m1.1.1.2.3.cmml" type="integer" xref="S3.SS3.p3.1.m1.1.1.2.3">192</cn></apply><apply id="S3.SS3.p3.1.m1.1.1.3.cmml" xref="S3.SS3.p3.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p3.1.m1.1.1.3.1.cmml" xref="S3.SS3.p3.1.m1.1.1.3">subscript</csymbol><ci id="S3.SS3.p3.1.m1.1.1.3.2.cmml" xref="S3.SS3.p3.1.m1.1.1.3.2">𝐿</ci><cn id="S3.SS3.p3.1.m1.1.1.3.3.cmml" type="integer" xref="S3.SS3.p3.1.m1.1.1.3.3">32</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.1.m1.1c">S_{192}+L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="S_{128}+L_{64}" class="ltx_Math" display="inline" id="S3.SS3.p3.2.m2.1"><semantics id="S3.SS3.p3.2.m2.1a"><mrow id="S3.SS3.p3.2.m2.1.1" xref="S3.SS3.p3.2.m2.1.1.cmml"><msub id="S3.SS3.p3.2.m2.1.1.2" xref="S3.SS3.p3.2.m2.1.1.2.cmml"><mi id="S3.SS3.p3.2.m2.1.1.2.2" xref="S3.SS3.p3.2.m2.1.1.2.2.cmml">S</mi><mn id="S3.SS3.p3.2.m2.1.1.2.3" xref="S3.SS3.p3.2.m2.1.1.2.3.cmml">128</mn></msub><mo id="S3.SS3.p3.2.m2.1.1.1" xref="S3.SS3.p3.2.m2.1.1.1.cmml">+</mo><msub id="S3.SS3.p3.2.m2.1.1.3" xref="S3.SS3.p3.2.m2.1.1.3.cmml"><mi id="S3.SS3.p3.2.m2.1.1.3.2" xref="S3.SS3.p3.2.m2.1.1.3.2.cmml">L</mi><mn id="S3.SS3.p3.2.m2.1.1.3.3" xref="S3.SS3.p3.2.m2.1.1.3.3.cmml">64</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.2.m2.1b"><apply id="S3.SS3.p3.2.m2.1.1.cmml" xref="S3.SS3.p3.2.m2.1.1"><plus id="S3.SS3.p3.2.m2.1.1.1.cmml" xref="S3.SS3.p3.2.m2.1.1.1"></plus><apply id="S3.SS3.p3.2.m2.1.1.2.cmml" xref="S3.SS3.p3.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p3.2.m2.1.1.2.1.cmml" xref="S3.SS3.p3.2.m2.1.1.2">subscript</csymbol><ci id="S3.SS3.p3.2.m2.1.1.2.2.cmml" xref="S3.SS3.p3.2.m2.1.1.2.2">𝑆</ci><cn id="S3.SS3.p3.2.m2.1.1.2.3.cmml" type="integer" xref="S3.SS3.p3.2.m2.1.1.2.3">128</cn></apply><apply id="S3.SS3.p3.2.m2.1.1.3.cmml" xref="S3.SS3.p3.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p3.2.m2.1.1.3.1.cmml" xref="S3.SS3.p3.2.m2.1.1.3">subscript</csymbol><ci id="S3.SS3.p3.2.m2.1.1.3.2.cmml" xref="S3.SS3.p3.2.m2.1.1.3.2">𝐿</ci><cn id="S3.SS3.p3.2.m2.1.1.3.3.cmml" type="integer" xref="S3.SS3.p3.2.m2.1.1.3.3">64</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.2.m2.1c">S_{128}+L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.2.m2.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>, and <math alttext="S_{192}+L_{96}" class="ltx_Math" display="inline" id="S3.SS3.p3.3.m3.1"><semantics id="S3.SS3.p3.3.m3.1a"><mrow id="S3.SS3.p3.3.m3.1.1" xref="S3.SS3.p3.3.m3.1.1.cmml"><msub id="S3.SS3.p3.3.m3.1.1.2" xref="S3.SS3.p3.3.m3.1.1.2.cmml"><mi id="S3.SS3.p3.3.m3.1.1.2.2" xref="S3.SS3.p3.3.m3.1.1.2.2.cmml">S</mi><mn id="S3.SS3.p3.3.m3.1.1.2.3" xref="S3.SS3.p3.3.m3.1.1.2.3.cmml">192</mn></msub><mo id="S3.SS3.p3.3.m3.1.1.1" xref="S3.SS3.p3.3.m3.1.1.1.cmml">+</mo><msub id="S3.SS3.p3.3.m3.1.1.3" xref="S3.SS3.p3.3.m3.1.1.3.cmml"><mi id="S3.SS3.p3.3.m3.1.1.3.2" xref="S3.SS3.p3.3.m3.1.1.3.2.cmml">L</mi><mn id="S3.SS3.p3.3.m3.1.1.3.3" xref="S3.SS3.p3.3.m3.1.1.3.3.cmml">96</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.3.m3.1b"><apply id="S3.SS3.p3.3.m3.1.1.cmml" xref="S3.SS3.p3.3.m3.1.1"><plus id="S3.SS3.p3.3.m3.1.1.1.cmml" xref="S3.SS3.p3.3.m3.1.1.1"></plus><apply id="S3.SS3.p3.3.m3.1.1.2.cmml" xref="S3.SS3.p3.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p3.3.m3.1.1.2.1.cmml" xref="S3.SS3.p3.3.m3.1.1.2">subscript</csymbol><ci id="S3.SS3.p3.3.m3.1.1.2.2.cmml" xref="S3.SS3.p3.3.m3.1.1.2.2">𝑆</ci><cn id="S3.SS3.p3.3.m3.1.1.2.3.cmml" type="integer" xref="S3.SS3.p3.3.m3.1.1.2.3">192</cn></apply><apply id="S3.SS3.p3.3.m3.1.1.3.cmml" xref="S3.SS3.p3.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p3.3.m3.1.1.3.1.cmml" xref="S3.SS3.p3.3.m3.1.1.3">subscript</csymbol><ci id="S3.SS3.p3.3.m3.1.1.3.2.cmml" xref="S3.SS3.p3.3.m3.1.1.3.2">𝐿</ci><cn id="S3.SS3.p3.3.m3.1.1.3.3.cmml" type="integer" xref="S3.SS3.p3.3.m3.1.1.3.3">96</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.3.m3.1c">S_{192}+L_{96}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.3.m3.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>, where <math alttext="S" class="ltx_Math" display="inline" id="S3.SS3.p3.4.m4.1"><semantics id="S3.SS3.p3.4.m4.1a"><mi id="S3.SS3.p3.4.m4.1.1" xref="S3.SS3.p3.4.m4.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.4.m4.1b"><ci id="S3.SS3.p3.4.m4.1.1.cmml" xref="S3.SS3.p3.4.m4.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.4.m4.1c">S</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.4.m4.1d">italic_S</annotation></semantics></math> and <math alttext="L" class="ltx_Math" display="inline" id="S3.SS3.p3.5.m5.1"><semantics id="S3.SS3.p3.5.m5.1a"><mi id="S3.SS3.p3.5.m5.1.1" xref="S3.SS3.p3.5.m5.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p3.5.m5.1b"><ci id="S3.SS3.p3.5.m5.1.1.cmml" xref="S3.SS3.p3.5.m5.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p3.5.m5.1c">L</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p3.5.m5.1d">italic_L</annotation></semantics></math> denote the number of short-term and long-term tokens per context window, respectively. All models (<span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p3.5.4">Melodi</span> and baselines) utilize a 13-layer transformer architecture, except for Block Recurrent Transformer, which inserts a block recurrent layer into a 12-layer transformer, ensuring a similar parameter count for all models.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS3.p4">
<p class="ltx_p" id="S3.SS3.p4.2"><span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p4.2.1">Melodi</span> <math alttext="S_{192}" class="ltx_Math" display="inline" id="S3.SS3.p4.1.m1.1"><semantics id="S3.SS3.p4.1.m1.1a"><msub id="S3.SS3.p4.1.m1.1.1" xref="S3.SS3.p4.1.m1.1.1.cmml"><mi id="S3.SS3.p4.1.m1.1.1.2" xref="S3.SS3.p4.1.m1.1.1.2.cmml">S</mi><mn id="S3.SS3.p4.1.m1.1.1.3" xref="S3.SS3.p4.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p4.1.m1.1b"><apply id="S3.SS3.p4.1.m1.1.1.cmml" xref="S3.SS3.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p4.1.m1.1.1.1.cmml" xref="S3.SS3.p4.1.m1.1.1">subscript</csymbol><ci id="S3.SS3.p4.1.m1.1.1.2.cmml" xref="S3.SS3.p4.1.m1.1.1.2">𝑆</ci><cn id="S3.SS3.p4.1.m1.1.1.3.cmml" type="integer" xref="S3.SS3.p4.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p4.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p4.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{32}" class="ltx_Math" display="inline" id="S3.SS3.p4.2.m2.1"><semantics id="S3.SS3.p4.2.m2.1a"><msub id="S3.SS3.p4.2.m2.1.1" xref="S3.SS3.p4.2.m2.1.1.cmml"><mi id="S3.SS3.p4.2.m2.1.1.2" xref="S3.SS3.p4.2.m2.1.1.2.cmml">L</mi><mn id="S3.SS3.p4.2.m2.1.1.3" xref="S3.SS3.p4.2.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p4.2.m2.1b"><apply id="S3.SS3.p4.2.m2.1.1.cmml" xref="S3.SS3.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.p4.2.m2.1.1.1.cmml" xref="S3.SS3.p4.2.m2.1.1">subscript</csymbol><ci id="S3.SS3.p4.2.m2.1.1.2.cmml" xref="S3.SS3.p4.2.m2.1.1.2">𝐿</ci><cn id="S3.SS3.p4.2.m2.1.1.3.cmml" type="integer" xref="S3.SS3.p4.2.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p4.2.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p4.2.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math> consistently outperforms both Transformer XL and Block Recurrent Transformer across all datasets while utilizing less memory. For instance, it achieves a perplexity of 10.51 on PG-19 (T5 vocabulary), surpassing Transformer XL (11.41) and Block Recurrent Transformer (10.98) while consuming only 11.0M memory compared to their 13.6M and 13.1M, respectively.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS3.p5">
<p class="ltx_p" id="S3.SS3.p5.2">In comparison to the Memorizing Transformer, <span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p5.2.1">Melodi</span> <math alttext="S_{128}+L_{64}" class="ltx_Math" display="inline" id="S3.SS3.p5.1.m1.1"><semantics id="S3.SS3.p5.1.m1.1a"><mrow id="S3.SS3.p5.1.m1.1.1" xref="S3.SS3.p5.1.m1.1.1.cmml"><msub id="S3.SS3.p5.1.m1.1.1.2" xref="S3.SS3.p5.1.m1.1.1.2.cmml"><mi id="S3.SS3.p5.1.m1.1.1.2.2" xref="S3.SS3.p5.1.m1.1.1.2.2.cmml">S</mi><mn id="S3.SS3.p5.1.m1.1.1.2.3" xref="S3.SS3.p5.1.m1.1.1.2.3.cmml">128</mn></msub><mo id="S3.SS3.p5.1.m1.1.1.1" xref="S3.SS3.p5.1.m1.1.1.1.cmml">+</mo><msub id="S3.SS3.p5.1.m1.1.1.3" xref="S3.SS3.p5.1.m1.1.1.3.cmml"><mi id="S3.SS3.p5.1.m1.1.1.3.2" xref="S3.SS3.p5.1.m1.1.1.3.2.cmml">L</mi><mn id="S3.SS3.p5.1.m1.1.1.3.3" xref="S3.SS3.p5.1.m1.1.1.3.3.cmml">64</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p5.1.m1.1b"><apply id="S3.SS3.p5.1.m1.1.1.cmml" xref="S3.SS3.p5.1.m1.1.1"><plus id="S3.SS3.p5.1.m1.1.1.1.cmml" xref="S3.SS3.p5.1.m1.1.1.1"></plus><apply id="S3.SS3.p5.1.m1.1.1.2.cmml" xref="S3.SS3.p5.1.m1.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p5.1.m1.1.1.2.1.cmml" xref="S3.SS3.p5.1.m1.1.1.2">subscript</csymbol><ci id="S3.SS3.p5.1.m1.1.1.2.2.cmml" xref="S3.SS3.p5.1.m1.1.1.2.2">𝑆</ci><cn id="S3.SS3.p5.1.m1.1.1.2.3.cmml" type="integer" xref="S3.SS3.p5.1.m1.1.1.2.3">128</cn></apply><apply id="S3.SS3.p5.1.m1.1.1.3.cmml" xref="S3.SS3.p5.1.m1.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p5.1.m1.1.1.3.1.cmml" xref="S3.SS3.p5.1.m1.1.1.3">subscript</csymbol><ci id="S3.SS3.p5.1.m1.1.1.3.2.cmml" xref="S3.SS3.p5.1.m1.1.1.3.2">𝐿</ci><cn id="S3.SS3.p5.1.m1.1.1.3.3.cmml" type="integer" xref="S3.SS3.p5.1.m1.1.1.3.3">64</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p5.1.m1.1c">S_{128}+L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p5.1.m1.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math> exhibits slightly improved performance while significantly reducing memory consumption by approximately 8 times. <span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p5.2.2">Melodi</span> <math alttext="S_{192}+L_{96}" class="ltx_Math" display="inline" id="S3.SS3.p5.2.m2.1"><semantics id="S3.SS3.p5.2.m2.1a"><mrow id="S3.SS3.p5.2.m2.1.1" xref="S3.SS3.p5.2.m2.1.1.cmml"><msub id="S3.SS3.p5.2.m2.1.1.2" xref="S3.SS3.p5.2.m2.1.1.2.cmml"><mi id="S3.SS3.p5.2.m2.1.1.2.2" xref="S3.SS3.p5.2.m2.1.1.2.2.cmml">S</mi><mn id="S3.SS3.p5.2.m2.1.1.2.3" xref="S3.SS3.p5.2.m2.1.1.2.3.cmml">192</mn></msub><mo id="S3.SS3.p5.2.m2.1.1.1" xref="S3.SS3.p5.2.m2.1.1.1.cmml">+</mo><msub id="S3.SS3.p5.2.m2.1.1.3" xref="S3.SS3.p5.2.m2.1.1.3.cmml"><mi id="S3.SS3.p5.2.m2.1.1.3.2" xref="S3.SS3.p5.2.m2.1.1.3.2.cmml">L</mi><mn id="S3.SS3.p5.2.m2.1.1.3.3" xref="S3.SS3.p5.2.m2.1.1.3.3.cmml">96</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p5.2.m2.1b"><apply id="S3.SS3.p5.2.m2.1.1.cmml" xref="S3.SS3.p5.2.m2.1.1"><plus id="S3.SS3.p5.2.m2.1.1.1.cmml" xref="S3.SS3.p5.2.m2.1.1.1"></plus><apply id="S3.SS3.p5.2.m2.1.1.2.cmml" xref="S3.SS3.p5.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p5.2.m2.1.1.2.1.cmml" xref="S3.SS3.p5.2.m2.1.1.2">subscript</csymbol><ci id="S3.SS3.p5.2.m2.1.1.2.2.cmml" xref="S3.SS3.p5.2.m2.1.1.2.2">𝑆</ci><cn id="S3.SS3.p5.2.m2.1.1.2.3.cmml" type="integer" xref="S3.SS3.p5.2.m2.1.1.2.3">192</cn></apply><apply id="S3.SS3.p5.2.m2.1.1.3.cmml" xref="S3.SS3.p5.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS3.p5.2.m2.1.1.3.1.cmml" xref="S3.SS3.p5.2.m2.1.1.3">subscript</csymbol><ci id="S3.SS3.p5.2.m2.1.1.3.2.cmml" xref="S3.SS3.p5.2.m2.1.1.3.2">𝐿</ci><cn id="S3.SS3.p5.2.m2.1.1.3.3.cmml" type="integer" xref="S3.SS3.p5.2.m2.1.1.3.3">96</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p5.2.m2.1c">S_{192}+L_{96}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p5.2.m2.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math> further improves perplexity across all datasets, achieving a substantial reduction in memory usage exceeding a factor of 5.
These trends remain consistent across different network depths (12-layer and 13-layer), as shown in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A2.T5" title="Table 5 ‣ Appendix B Training Details ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">5</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A3" title="Appendix C More Comparison with Baselines ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">C</span></a>. These results collectively highlight <span class="ltx_text ltx_font_smallcaps" id="S3.SS3.p5.2.3">Melodi</span>’s efficacy and efficiency as a memory architecture for language models.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.4 </span>Ablations</h3>
<div class="ltx_para ltx_noindent" id="S3.SS4.p1">
<p class="ltx_p" id="S3.SS4.p1.2">We conduct an ablation study of <span class="ltx_text ltx_font_smallcaps" id="S3.SS4.p1.2.1">Melodi</span> using the default configuration (<math alttext="S_{128}" class="ltx_Math" display="inline" id="S3.SS4.p1.1.m1.1"><semantics id="S3.SS4.p1.1.m1.1a"><msub id="S3.SS4.p1.1.m1.1.1" xref="S3.SS4.p1.1.m1.1.1.cmml"><mi id="S3.SS4.p1.1.m1.1.1.2" xref="S3.SS4.p1.1.m1.1.1.2.cmml">S</mi><mn id="S3.SS4.p1.1.m1.1.1.3" xref="S3.SS4.p1.1.m1.1.1.3.cmml">128</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.1.m1.1b"><apply id="S3.SS4.p1.1.m1.1.1.cmml" xref="S3.SS4.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p1.1.m1.1.1.1.cmml" xref="S3.SS4.p1.1.m1.1.1">subscript</csymbol><ci id="S3.SS4.p1.1.m1.1.1.2.cmml" xref="S3.SS4.p1.1.m1.1.1.2">𝑆</ci><cn id="S3.SS4.p1.1.m1.1.1.3.cmml" type="integer" xref="S3.SS4.p1.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.1.m1.1c">S_{128}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.1.m1.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="S3.SS4.p1.2.m2.1"><semantics id="S3.SS4.p1.2.m2.1a"><msub id="S3.SS4.p1.2.m2.1.1" xref="S3.SS4.p1.2.m2.1.1.cmml"><mi id="S3.SS4.p1.2.m2.1.1.2" xref="S3.SS4.p1.2.m2.1.1.2.cmml">L</mi><mn id="S3.SS4.p1.2.m2.1.1.3" xref="S3.SS4.p1.2.m2.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p1.2.m2.1b"><apply id="S3.SS4.p1.2.m2.1.1.cmml" xref="S3.SS4.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS4.p1.2.m2.1.1.1.cmml" xref="S3.SS4.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS4.p1.2.m2.1.1.2.cmml" xref="S3.SS4.p1.2.m2.1.1.2">𝐿</ci><cn id="S3.SS4.p1.2.m2.1.1.3.cmml" type="integer" xref="S3.SS4.p1.2.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p1.2.m2.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p1.2.m2.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>) with 128 short-term and 64 long-term tokens per context window. The long-term memory spans 128 context windows, and the transformer architecture consists of 13 layers. All models are trained on the PG-19 dataset with the T5 vocabulary for 200k steps.</p>
</div>
<figure class="ltx_figure" id="S3.F4">
<p class="ltx_p ltx_align_center ltx_align_center" id="S3.F4.1.1"><span class="ltx_text" id="S3.F4.1.1.1"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="265" id="S3.F4.1.1.1.g1" src="extracted/5900799/figure/memory_size.png" width="598"/></span></p>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span><span class="ltx_text ltx_font_bold" id="S3.F4.15.1">Ablation of memory size on PG-19.</span>
The token perplexity is reported for various combinations of short-term and long-term memory sizes. Each curve represents a fixed size of long-term memory, with points along the curve indicating different short-term memory sizes. For example, the <span class="ltx_text" id="S3.F4.16.2" style="color:#0000FF;">blue curve</span> (<math alttext="L_{96}" class="ltx_Math" display="inline" id="S3.F4.7.7.m1.1"><semantics id="S3.F4.7.7.m1.1b"><msub id="S3.F4.7.7.m1.1.1" xref="S3.F4.7.7.m1.1.1.cmml"><mi id="S3.F4.7.7.m1.1.1.2" xref="S3.F4.7.7.m1.1.1.2.cmml">L</mi><mn id="S3.F4.7.7.m1.1.1.3" xref="S3.F4.7.7.m1.1.1.3.cmml">96</mn></msub><annotation-xml encoding="MathML-Content" id="S3.F4.7.7.m1.1c"><apply id="S3.F4.7.7.m1.1.1.cmml" xref="S3.F4.7.7.m1.1.1"><csymbol cd="ambiguous" id="S3.F4.7.7.m1.1.1.1.cmml" xref="S3.F4.7.7.m1.1.1">subscript</csymbol><ci id="S3.F4.7.7.m1.1.1.2.cmml" xref="S3.F4.7.7.m1.1.1.2">𝐿</ci><cn id="S3.F4.7.7.m1.1.1.3.cmml" type="integer" xref="S3.F4.7.7.m1.1.1.3">96</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F4.7.7.m1.1d">L_{96}</annotation><annotation encoding="application/x-llamapun" id="S3.F4.7.7.m1.1e">italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>), uses 96 long-term tokens per window over 128 windows, totaling 12,288 tokens. Each point on this curve represents a different short-term memory size (e.g. <math alttext="S_{8}" class="ltx_Math" display="inline" id="S3.F4.8.8.m2.1"><semantics id="S3.F4.8.8.m2.1b"><msub id="S3.F4.8.8.m2.1.1" xref="S3.F4.8.8.m2.1.1.cmml"><mi id="S3.F4.8.8.m2.1.1.2" xref="S3.F4.8.8.m2.1.1.2.cmml">S</mi><mn id="S3.F4.8.8.m2.1.1.3" xref="S3.F4.8.8.m2.1.1.3.cmml">8</mn></msub><annotation-xml encoding="MathML-Content" id="S3.F4.8.8.m2.1c"><apply id="S3.F4.8.8.m2.1.1.cmml" xref="S3.F4.8.8.m2.1.1"><csymbol cd="ambiguous" id="S3.F4.8.8.m2.1.1.1.cmml" xref="S3.F4.8.8.m2.1.1">subscript</csymbol><ci id="S3.F4.8.8.m2.1.1.2.cmml" xref="S3.F4.8.8.m2.1.1.2">𝑆</ci><cn id="S3.F4.8.8.m2.1.1.3.cmml" type="integer" xref="S3.F4.8.8.m2.1.1.3">8</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F4.8.8.m2.1d">S_{8}</annotation><annotation encoding="application/x-llamapun" id="S3.F4.8.8.m2.1e">italic_S start_POSTSUBSCRIPT 8 end_POSTSUBSCRIPT</annotation></semantics></math> denotes 8 short-term tokens per context window).
Memory size is measured by the number of floating-point numbers (floats). For instance, <math alttext="L_{96}" class="ltx_Math" display="inline" id="S3.F4.9.9.m3.1"><semantics id="S3.F4.9.9.m3.1b"><msub id="S3.F4.9.9.m3.1.1" xref="S3.F4.9.9.m3.1.1.cmml"><mi id="S3.F4.9.9.m3.1.1.2" xref="S3.F4.9.9.m3.1.1.2.cmml">L</mi><mn id="S3.F4.9.9.m3.1.1.3" xref="S3.F4.9.9.m3.1.1.3.cmml">96</mn></msub><annotation-xml encoding="MathML-Content" id="S3.F4.9.9.m3.1c"><apply id="S3.F4.9.9.m3.1.1.cmml" xref="S3.F4.9.9.m3.1.1"><csymbol cd="ambiguous" id="S3.F4.9.9.m3.1.1.1.cmml" xref="S3.F4.9.9.m3.1.1">subscript</csymbol><ci id="S3.F4.9.9.m3.1.1.2.cmml" xref="S3.F4.9.9.m3.1.1.2">𝐿</ci><cn id="S3.F4.9.9.m3.1.1.3.cmml" type="integer" xref="S3.F4.9.9.m3.1.1.3">96</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F4.9.9.m3.1d">L_{96}</annotation><annotation encoding="application/x-llamapun" id="S3.F4.9.9.m3.1e">italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math> stores 12,288 long-term key-value (KV) pairs, each with 1024 dimensions, resulting in a total of 12,288<math alttext="\times" class="ltx_Math" display="inline" id="S3.F4.10.10.m4.1"><semantics id="S3.F4.10.10.m4.1b"><mo id="S3.F4.10.10.m4.1.1" xref="S3.F4.10.10.m4.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.F4.10.10.m4.1c"><times id="S3.F4.10.10.m4.1.1.cmml" xref="S3.F4.10.10.m4.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.F4.10.10.m4.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S3.F4.10.10.m4.1e">×</annotation></semantics></math>1024<math alttext="\times" class="ltx_Math" display="inline" id="S3.F4.11.11.m5.1"><semantics id="S3.F4.11.11.m5.1b"><mo id="S3.F4.11.11.m5.1.1" xref="S3.F4.11.11.m5.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.F4.11.11.m5.1c"><times id="S3.F4.11.11.m5.1.1.cmml" xref="S3.F4.11.11.m5.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.F4.11.11.m5.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S3.F4.11.11.m5.1e">×</annotation></semantics></math>2=25.2 million floats. The table on the right provides the perplexity results for each point on the left plot, using matching colors.
These results highlight that long-term and short-term memories play complementary roles, and increasing either type’s capacity improves performance. Notably, <span class="ltx_text ltx_font_smallcaps" id="S3.F4.17.3">Melodi</span> achieves superior performance compared to baselines like Transformer XL, Block Recurrrent Transformer and Memorizing Transformer while utilizing fewer memory resources. Best viewed in color.
</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS4.p2">
<p class="ltx_p" id="S3.SS4.p2.2"><span class="ltx_text ltx_font_bold" id="S3.SS4.p2.2.1">Complementary roles of short-term and long-term memory:</span>
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.F4" title="Figure 4 ‣ 3.4 Ablations ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">4</span></a> illustrates how the sizes of both short-term and long-term memory jointly influence perplexity. Each curve represents a fixed long-term memory size, with varying short-term memory sizes depicted by points along the curve.
With the exception of the black curve, which solely utilizes short-term memory, all other curves incorporate long-term memory spanning 128 context windows.
The figure demonstrates that increasing either short-term or long-term memory capacity leads to improved perplexity, highlighting their complementary roles in performance. Notably, by judiciously selecting memory sizes (e.g., <math alttext="S_{192}" class="ltx_Math" display="inline" id="S3.SS4.p2.1.m1.1"><semantics id="S3.SS4.p2.1.m1.1a"><msub id="S3.SS4.p2.1.m1.1.1" xref="S3.SS4.p2.1.m1.1.1.cmml"><mi id="S3.SS4.p2.1.m1.1.1.2" xref="S3.SS4.p2.1.m1.1.1.2.cmml">S</mi><mn id="S3.SS4.p2.1.m1.1.1.3" xref="S3.SS4.p2.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.1.m1.1b"><apply id="S3.SS4.p2.1.m1.1.1.cmml" xref="S3.SS4.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.1.m1.1.1.1.cmml" xref="S3.SS4.p2.1.m1.1.1">subscript</csymbol><ci id="S3.SS4.p2.1.m1.1.1.2.cmml" xref="S3.SS4.p2.1.m1.1.1.2">𝑆</ci><cn id="S3.SS4.p2.1.m1.1.1.3.cmml" type="integer" xref="S3.SS4.p2.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math> for short-term and <math alttext="L_{32}" class="ltx_Math" display="inline" id="S3.SS4.p2.2.m2.1"><semantics id="S3.SS4.p2.2.m2.1a"><msub id="S3.SS4.p2.2.m2.1.1" xref="S3.SS4.p2.2.m2.1.1.cmml"><mi id="S3.SS4.p2.2.m2.1.1.2" xref="S3.SS4.p2.2.m2.1.1.2.cmml">L</mi><mn id="S3.SS4.p2.2.m2.1.1.3" xref="S3.SS4.p2.2.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.2.m2.1b"><apply id="S3.SS4.p2.2.m2.1.1.cmml" xref="S3.SS4.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.2.m2.1.1.1.cmml" xref="S3.SS4.p2.2.m2.1.1">subscript</csymbol><ci id="S3.SS4.p2.2.m2.1.1.2.cmml" xref="S3.SS4.p2.2.m2.1.1.2">𝐿</ci><cn id="S3.SS4.p2.2.m2.1.1.3.cmml" type="integer" xref="S3.SS4.p2.2.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.2.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.2.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math> for long-term), we can outperform the Memorizing Transformer while utilizing less memory than Transformer XL and Block Recurrent Transformer.</p>
</div>
<figure class="ltx_table" id="S3.SS4.2">
<div class="ltx_block" id="S3.SS4.2.3">
<figure class="ltx_figure ltx_figure_panel ltx_align_bottom" id="S3.F5" style="width:140.9pt;"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_square" height="531" id="S3.SS4.1.1.1.g1" src="extracted/5900799/figure/long-term-ablation2.png" width="598"/>
<br class="ltx_break ltx_break"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 5: </span><span class="ltx_text ltx_font_bold" id="S3.F5.8.1">Long-term memory coverage.</span> The coverage metric indicates the number of preceding context windows spanned by the long-term memory. All data points use <math alttext="L" class="ltx_Math" display="inline" id="S3.F5.4.m1.1"><semantics id="S3.F5.4.m1.1b"><mi id="S3.F5.4.m1.1.1" xref="S3.F5.4.m1.1.1.cmml">L</mi><annotation-xml encoding="MathML-Content" id="S3.F5.4.m1.1c"><ci id="S3.F5.4.m1.1.1.cmml" xref="S3.F5.4.m1.1.1">𝐿</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F5.4.m1.1d">L</annotation><annotation encoding="application/x-llamapun" id="S3.F5.4.m1.1e">italic_L</annotation></semantics></math>=64 long-term and <math alttext="S" class="ltx_Math" display="inline" id="S3.F5.5.m2.1"><semantics id="S3.F5.5.m2.1b"><mi id="S3.F5.5.m2.1.1" xref="S3.F5.5.m2.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.F5.5.m2.1c"><ci id="S3.F5.5.m2.1.1.cmml" xref="S3.F5.5.m2.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F5.5.m2.1d">S</annotation><annotation encoding="application/x-llamapun" id="S3.F5.5.m2.1e">italic_S</annotation></semantics></math>=128 short-term tokens per window. However, they vary in long-term memory capacity. For instance, ‘32’ denotes covering 32 context windows, totaling 32<math alttext="\times" class="ltx_Math" display="inline" id="S3.F5.6.m3.1"><semantics id="S3.F5.6.m3.1b"><mo id="S3.F5.6.m3.1.1" xref="S3.F5.6.m3.1.1.cmml">×</mo><annotation-xml encoding="MathML-Content" id="S3.F5.6.m3.1c"><times id="S3.F5.6.m3.1.1.cmml" xref="S3.F5.6.m3.1.1"></times></annotation-xml><annotation encoding="application/x-tex" id="S3.F5.6.m3.1d">\times</annotation><annotation encoding="application/x-llamapun" id="S3.F5.6.m3.1e">×</annotation></semantics></math>64=2048 long-term tokens.
Perplexity improves marginally with long-term memory coverage of 2-4 windows, then accelerates until 32 windows, after which it levels off.
</figcaption>
</figure>
<figure class="ltx_figure ltx_figure_panel ltx_align_bottom" id="S3.F6" style="width:279.7pt;"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="330" id="S3.SS4.2.2.1.g1" src="extracted/5900799/figure/window_size2.png" width="598"/>
<br class="ltx_break ltx_break"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 6: </span><span class="ltx_text ltx_font_bold" id="S3.F6.22.1">Shorter context windows.</span> <span class="ltx_text ltx_font_bold" id="S3.F6.23.2">(<span class="ltx_text ltx_font_italic" id="S3.F6.23.2.1">Left</span>)</span>: <span class="ltx_text ltx_font_italic" id="S3.F6.24.3">Perplexity with varying context window sizes (512, 256, 128 tokens).</span> The number of short-term and long-term memory tokens in <span class="ltx_text ltx_font_smallcaps" id="S3.F6.25.4">Melodi</span> is proportionally adjusted (<math alttext="\times\frac{1}{2}" class="ltx_Math" display="inline" id="S3.F6.7.m1.1"><semantics id="S3.F6.7.m1.1b"><mrow id="S3.F6.7.m1.1.1" xref="S3.F6.7.m1.1.1.cmml"><mi id="S3.F6.7.m1.1.1.2" xref="S3.F6.7.m1.1.1.2.cmml"></mi><mo id="S3.F6.7.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.F6.7.m1.1.1.1.cmml">×</mo><mfrac id="S3.F6.7.m1.1.1.3" xref="S3.F6.7.m1.1.1.3.cmml"><mn id="S3.F6.7.m1.1.1.3.2" xref="S3.F6.7.m1.1.1.3.2.cmml">1</mn><mn id="S3.F6.7.m1.1.1.3.3" xref="S3.F6.7.m1.1.1.3.3.cmml">2</mn></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S3.F6.7.m1.1c"><apply id="S3.F6.7.m1.1.1.cmml" xref="S3.F6.7.m1.1.1"><times id="S3.F6.7.m1.1.1.1.cmml" xref="S3.F6.7.m1.1.1.1"></times><csymbol cd="latexml" id="S3.F6.7.m1.1.1.2.cmml" xref="S3.F6.7.m1.1.1.2">absent</csymbol><apply id="S3.F6.7.m1.1.1.3.cmml" xref="S3.F6.7.m1.1.1.3"><divide id="S3.F6.7.m1.1.1.3.1.cmml" xref="S3.F6.7.m1.1.1.3"></divide><cn id="S3.F6.7.m1.1.1.3.2.cmml" type="integer" xref="S3.F6.7.m1.1.1.3.2">1</cn><cn id="S3.F6.7.m1.1.1.3.3.cmml" type="integer" xref="S3.F6.7.m1.1.1.3.3">2</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F6.7.m1.1d">\times\frac{1}{2}</annotation><annotation encoding="application/x-llamapun" id="S3.F6.7.m1.1e">× divide start_ARG 1 end_ARG start_ARG 2 end_ARG</annotation></semantics></math>, <math alttext="\times\frac{1}{4}" class="ltx_Math" display="inline" id="S3.F6.8.m2.1"><semantics id="S3.F6.8.m2.1b"><mrow id="S3.F6.8.m2.1.1" xref="S3.F6.8.m2.1.1.cmml"><mi id="S3.F6.8.m2.1.1.2" xref="S3.F6.8.m2.1.1.2.cmml"></mi><mo id="S3.F6.8.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.F6.8.m2.1.1.1.cmml">×</mo><mfrac id="S3.F6.8.m2.1.1.3" xref="S3.F6.8.m2.1.1.3.cmml"><mn id="S3.F6.8.m2.1.1.3.2" xref="S3.F6.8.m2.1.1.3.2.cmml">1</mn><mn id="S3.F6.8.m2.1.1.3.3" xref="S3.F6.8.m2.1.1.3.3.cmml">4</mn></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S3.F6.8.m2.1c"><apply id="S3.F6.8.m2.1.1.cmml" xref="S3.F6.8.m2.1.1"><times id="S3.F6.8.m2.1.1.1.cmml" xref="S3.F6.8.m2.1.1.1"></times><csymbol cd="latexml" id="S3.F6.8.m2.1.1.2.cmml" xref="S3.F6.8.m2.1.1.2">absent</csymbol><apply id="S3.F6.8.m2.1.1.3.cmml" xref="S3.F6.8.m2.1.1.3"><divide id="S3.F6.8.m2.1.1.3.1.cmml" xref="S3.F6.8.m2.1.1.3"></divide><cn id="S3.F6.8.m2.1.1.3.2.cmml" type="integer" xref="S3.F6.8.m2.1.1.3.2">1</cn><cn id="S3.F6.8.m2.1.1.3.3.cmml" type="integer" xref="S3.F6.8.m2.1.1.3.3">4</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F6.8.m2.1d">\times\frac{1}{4}</annotation><annotation encoding="application/x-llamapun" id="S3.F6.8.m2.1e">× divide start_ARG 1 end_ARG start_ARG 4 end_ARG</annotation></semantics></math>, respectively) to ensure consistent long-term memory coverage. Even with smaller windows, <span class="ltx_text ltx_font_smallcaps" id="S3.F6.26.5">Melodi</span> with appropriate memory allocation (e.g. <math alttext="S_{128}" class="ltx_Math" display="inline" id="S3.F6.9.m3.1"><semantics id="S3.F6.9.m3.1b"><msub id="S3.F6.9.m3.1.1" xref="S3.F6.9.m3.1.1.cmml"><mi id="S3.F6.9.m3.1.1.2" xref="S3.F6.9.m3.1.1.2.cmml">S</mi><mn id="S3.F6.9.m3.1.1.3" xref="S3.F6.9.m3.1.1.3.cmml">128</mn></msub><annotation-xml encoding="MathML-Content" id="S3.F6.9.m3.1c"><apply id="S3.F6.9.m3.1.1.cmml" xref="S3.F6.9.m3.1.1"><csymbol cd="ambiguous" id="S3.F6.9.m3.1.1.1.cmml" xref="S3.F6.9.m3.1.1">subscript</csymbol><ci id="S3.F6.9.m3.1.1.2.cmml" xref="S3.F6.9.m3.1.1.2">𝑆</ci><cn id="S3.F6.9.m3.1.1.3.cmml" type="integer" xref="S3.F6.9.m3.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F6.9.m3.1d">S_{128}</annotation><annotation encoding="application/x-llamapun" id="S3.F6.9.m3.1e">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="S3.F6.10.m4.1"><semantics id="S3.F6.10.m4.1b"><msub id="S3.F6.10.m4.1.1" xref="S3.F6.10.m4.1.1.cmml"><mi id="S3.F6.10.m4.1.1.2" xref="S3.F6.10.m4.1.1.2.cmml">L</mi><mn id="S3.F6.10.m4.1.1.3" xref="S3.F6.10.m4.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="S3.F6.10.m4.1c"><apply id="S3.F6.10.m4.1.1.cmml" xref="S3.F6.10.m4.1.1"><csymbol cd="ambiguous" id="S3.F6.10.m4.1.1.1.cmml" xref="S3.F6.10.m4.1.1">subscript</csymbol><ci id="S3.F6.10.m4.1.1.2.cmml" xref="S3.F6.10.m4.1.1.2">𝐿</ci><cn id="S3.F6.10.m4.1.1.3.cmml" type="integer" xref="S3.F6.10.m4.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.F6.10.m4.1d">L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.F6.10.m4.1e">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>) consistently outperforms baselines.
<span class="ltx_text ltx_font_bold" id="S3.F6.27.6">(<span class="ltx_text ltx_font_italic" id="S3.F6.27.6.1">Right</span>):</span> <span class="ltx_text ltx_font_italic" id="S3.F6.28.7">Perplexity increase due to window size reduction.</span> The <math alttext="x" class="ltx_Math" display="inline" id="S3.F6.11.m5.1"><semantics id="S3.F6.11.m5.1b"><mi id="S3.F6.11.m5.1.1" xref="S3.F6.11.m5.1.1.cmml">x</mi><annotation-xml encoding="MathML-Content" id="S3.F6.11.m5.1c"><ci id="S3.F6.11.m5.1.1.cmml" xref="S3.F6.11.m5.1.1">𝑥</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F6.11.m5.1d">x</annotation><annotation encoding="application/x-llamapun" id="S3.F6.11.m5.1e">italic_x</annotation></semantics></math> and <math alttext="y" class="ltx_Math" display="inline" id="S3.F6.12.m6.1"><semantics id="S3.F6.12.m6.1b"><mi id="S3.F6.12.m6.1.1" xref="S3.F6.12.m6.1.1.cmml">y</mi><annotation-xml encoding="MathML-Content" id="S3.F6.12.m6.1c"><ci id="S3.F6.12.m6.1.1.cmml" xref="S3.F6.12.m6.1.1">𝑦</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.F6.12.m6.1d">y</annotation><annotation encoding="application/x-llamapun" id="S3.F6.12.m6.1e">italic_y</annotation></semantics></math> axes represent the perplexity increment when reducing the window size from 512 to 256 and 128 tokens, respectively.
Models with long-term memory (i.e. <span class="ltx_text ltx_font_smallcaps" id="S3.F6.29.8">Melodi</span> variants with long-term memory and Memorizing Transformer) exhibit significantly less performance degradation (smaller perplexity increments) compared to those relying solely on short-term memory (<span class="ltx_text ltx_font_smallcaps" id="S3.F6.30.9">Melodi</span> with only short-term memory, Transformer XL, and Block Recurrent Transformer).</figcaption>
</figure>
</div>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS4.p3">
<p class="ltx_p" id="S3.SS4.p3.2"><span class="ltx_text ltx_font_bold" id="S3.SS4.p3.2.1">Impact of long-term memory coverage:</span>
In contrast to the previous ablation, we now maintain a fixed number of short-term (<math alttext="S=128" class="ltx_Math" display="inline" id="S3.SS4.p3.1.m1.1"><semantics id="S3.SS4.p3.1.m1.1a"><mrow id="S3.SS4.p3.1.m1.1.1" xref="S3.SS4.p3.1.m1.1.1.cmml"><mi id="S3.SS4.p3.1.m1.1.1.2" xref="S3.SS4.p3.1.m1.1.1.2.cmml">S</mi><mo id="S3.SS4.p3.1.m1.1.1.1" xref="S3.SS4.p3.1.m1.1.1.1.cmml">=</mo><mn id="S3.SS4.p3.1.m1.1.1.3" xref="S3.SS4.p3.1.m1.1.1.3.cmml">128</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.1.m1.1b"><apply id="S3.SS4.p3.1.m1.1.1.cmml" xref="S3.SS4.p3.1.m1.1.1"><eq id="S3.SS4.p3.1.m1.1.1.1.cmml" xref="S3.SS4.p3.1.m1.1.1.1"></eq><ci id="S3.SS4.p3.1.m1.1.1.2.cmml" xref="S3.SS4.p3.1.m1.1.1.2">𝑆</ci><cn id="S3.SS4.p3.1.m1.1.1.3.cmml" type="integer" xref="S3.SS4.p3.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.1.m1.1c">S=128</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.1.m1.1d">italic_S = 128</annotation></semantics></math>) and long-term tokens (<math alttext="L=64" class="ltx_Math" display="inline" id="S3.SS4.p3.2.m2.1"><semantics id="S3.SS4.p3.2.m2.1a"><mrow id="S3.SS4.p3.2.m2.1.1" xref="S3.SS4.p3.2.m2.1.1.cmml"><mi id="S3.SS4.p3.2.m2.1.1.2" xref="S3.SS4.p3.2.m2.1.1.2.cmml">L</mi><mo id="S3.SS4.p3.2.m2.1.1.1" xref="S3.SS4.p3.2.m2.1.1.1.cmml">=</mo><mn id="S3.SS4.p3.2.m2.1.1.3" xref="S3.SS4.p3.2.m2.1.1.3.cmml">64</mn></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.2.m2.1b"><apply id="S3.SS4.p3.2.m2.1.1.cmml" xref="S3.SS4.p3.2.m2.1.1"><eq id="S3.SS4.p3.2.m2.1.1.1.cmml" xref="S3.SS4.p3.2.m2.1.1.1"></eq><ci id="S3.SS4.p3.2.m2.1.1.2.cmml" xref="S3.SS4.p3.2.m2.1.1.2">𝐿</ci><cn id="S3.SS4.p3.2.m2.1.1.3.cmml" type="integer" xref="S3.SS4.p3.2.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.2.m2.1c">L=64</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.2.m2.1d">italic_L = 64</annotation></semantics></math>) per context window while varying the number of windows encompassed by the long-term memory. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.F5" title="Figure 5 ‣ 3.4 Ablations ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">5</span></a> demonstrates that performance improves as the long-term memory covers a wider range of context windows.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p4">
<p class="ltx_p" id="S3.SS4.p4.1">Interestingly, incorporating long-term memory for only the preceding 2 or 4 windows yields marginal perplexity improvements, suggesting that recent context is already effectively captured by the short-term memory. However, performance gains accelerate as the long-term memory expands to encompass up to 32 windows, after which the improvements level off. This observation indicates that while the middle and distant history are beneficial for language modeling, they are not adequately retained in the short-term memory. These findings further underscore the complementary nature of short-term and long-term memory mechanisms.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p5">
<p class="ltx_p" id="S3.SS4.p5.3"><span class="ltx_text ltx_font_bold" id="S3.SS4.p5.3.1">Performance with shorter context windows:</span> Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.F6" title="Figure 6 ‣ 3.4 Ablations ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">6</span></a> examines the impact of reducing context window size on model performance. The plot on the left displays perplexity scores for context window sizes of 512, 256, and 128 tokens. The number of short-term and long-term memory tokens in <span class="ltx_text ltx_font_smallcaps" id="S3.SS4.p5.3.2">Melodi</span> is proportionally adjusted (<math alttext="\times\frac{1}{2}" class="ltx_Math" display="inline" id="S3.SS4.p5.1.m1.1"><semantics id="S3.SS4.p5.1.m1.1a"><mrow id="S3.SS4.p5.1.m1.1.1" xref="S3.SS4.p5.1.m1.1.1.cmml"><mi id="S3.SS4.p5.1.m1.1.1.2" xref="S3.SS4.p5.1.m1.1.1.2.cmml"></mi><mo id="S3.SS4.p5.1.m1.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS4.p5.1.m1.1.1.1.cmml">×</mo><mfrac id="S3.SS4.p5.1.m1.1.1.3" xref="S3.SS4.p5.1.m1.1.1.3.cmml"><mn id="S3.SS4.p5.1.m1.1.1.3.2" xref="S3.SS4.p5.1.m1.1.1.3.2.cmml">1</mn><mn id="S3.SS4.p5.1.m1.1.1.3.3" xref="S3.SS4.p5.1.m1.1.1.3.3.cmml">2</mn></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p5.1.m1.1b"><apply id="S3.SS4.p5.1.m1.1.1.cmml" xref="S3.SS4.p5.1.m1.1.1"><times id="S3.SS4.p5.1.m1.1.1.1.cmml" xref="S3.SS4.p5.1.m1.1.1.1"></times><csymbol cd="latexml" id="S3.SS4.p5.1.m1.1.1.2.cmml" xref="S3.SS4.p5.1.m1.1.1.2">absent</csymbol><apply id="S3.SS4.p5.1.m1.1.1.3.cmml" xref="S3.SS4.p5.1.m1.1.1.3"><divide id="S3.SS4.p5.1.m1.1.1.3.1.cmml" xref="S3.SS4.p5.1.m1.1.1.3"></divide><cn id="S3.SS4.p5.1.m1.1.1.3.2.cmml" type="integer" xref="S3.SS4.p5.1.m1.1.1.3.2">1</cn><cn id="S3.SS4.p5.1.m1.1.1.3.3.cmml" type="integer" xref="S3.SS4.p5.1.m1.1.1.3.3">2</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p5.1.m1.1c">\times\frac{1}{2}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p5.1.m1.1d">× divide start_ARG 1 end_ARG start_ARG 2 end_ARG</annotation></semantics></math>, <math alttext="\times\frac{1}{4}" class="ltx_Math" display="inline" id="S3.SS4.p5.2.m2.1"><semantics id="S3.SS4.p5.2.m2.1a"><mrow id="S3.SS4.p5.2.m2.1.1" xref="S3.SS4.p5.2.m2.1.1.cmml"><mi id="S3.SS4.p5.2.m2.1.1.2" xref="S3.SS4.p5.2.m2.1.1.2.cmml"></mi><mo id="S3.SS4.p5.2.m2.1.1.1" lspace="0.222em" rspace="0.222em" xref="S3.SS4.p5.2.m2.1.1.1.cmml">×</mo><mfrac id="S3.SS4.p5.2.m2.1.1.3" xref="S3.SS4.p5.2.m2.1.1.3.cmml"><mn id="S3.SS4.p5.2.m2.1.1.3.2" xref="S3.SS4.p5.2.m2.1.1.3.2.cmml">1</mn><mn id="S3.SS4.p5.2.m2.1.1.3.3" xref="S3.SS4.p5.2.m2.1.1.3.3.cmml">4</mn></mfrac></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p5.2.m2.1b"><apply id="S3.SS4.p5.2.m2.1.1.cmml" xref="S3.SS4.p5.2.m2.1.1"><times id="S3.SS4.p5.2.m2.1.1.1.cmml" xref="S3.SS4.p5.2.m2.1.1.1"></times><csymbol cd="latexml" id="S3.SS4.p5.2.m2.1.1.2.cmml" xref="S3.SS4.p5.2.m2.1.1.2">absent</csymbol><apply id="S3.SS4.p5.2.m2.1.1.3.cmml" xref="S3.SS4.p5.2.m2.1.1.3"><divide id="S3.SS4.p5.2.m2.1.1.3.1.cmml" xref="S3.SS4.p5.2.m2.1.1.3"></divide><cn id="S3.SS4.p5.2.m2.1.1.3.2.cmml" type="integer" xref="S3.SS4.p5.2.m2.1.1.3.2">1</cn><cn id="S3.SS4.p5.2.m2.1.1.3.3.cmml" type="integer" xref="S3.SS4.p5.2.m2.1.1.3.3">4</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p5.2.m2.1c">\times\frac{1}{4}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p5.2.m2.1d">× divide start_ARG 1 end_ARG start_ARG 4 end_ARG</annotation></semantics></math>, respectively) to ensure consistent long-term memory coverage across different window sizes. Even with shorter context windows, <span class="ltx_text ltx_font_smallcaps" id="S3.SS4.p5.3.3">Melodi</span> with appropriate memory allocation (e.g., <math alttext="S_{128}+L_{64}" class="ltx_Math" display="inline" id="S3.SS4.p5.3.m3.1"><semantics id="S3.SS4.p5.3.m3.1a"><mrow id="S3.SS4.p5.3.m3.1.1" xref="S3.SS4.p5.3.m3.1.1.cmml"><msub id="S3.SS4.p5.3.m3.1.1.2" xref="S3.SS4.p5.3.m3.1.1.2.cmml"><mi id="S3.SS4.p5.3.m3.1.1.2.2" xref="S3.SS4.p5.3.m3.1.1.2.2.cmml">S</mi><mn id="S3.SS4.p5.3.m3.1.1.2.3" xref="S3.SS4.p5.3.m3.1.1.2.3.cmml">128</mn></msub><mo id="S3.SS4.p5.3.m3.1.1.1" xref="S3.SS4.p5.3.m3.1.1.1.cmml">+</mo><msub id="S3.SS4.p5.3.m3.1.1.3" xref="S3.SS4.p5.3.m3.1.1.3.cmml"><mi id="S3.SS4.p5.3.m3.1.1.3.2" xref="S3.SS4.p5.3.m3.1.1.3.2.cmml">L</mi><mn id="S3.SS4.p5.3.m3.1.1.3.3" xref="S3.SS4.p5.3.m3.1.1.3.3.cmml">64</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p5.3.m3.1b"><apply id="S3.SS4.p5.3.m3.1.1.cmml" xref="S3.SS4.p5.3.m3.1.1"><plus id="S3.SS4.p5.3.m3.1.1.1.cmml" xref="S3.SS4.p5.3.m3.1.1.1"></plus><apply id="S3.SS4.p5.3.m3.1.1.2.cmml" xref="S3.SS4.p5.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p5.3.m3.1.1.2.1.cmml" xref="S3.SS4.p5.3.m3.1.1.2">subscript</csymbol><ci id="S3.SS4.p5.3.m3.1.1.2.2.cmml" xref="S3.SS4.p5.3.m3.1.1.2.2">𝑆</ci><cn id="S3.SS4.p5.3.m3.1.1.2.3.cmml" type="integer" xref="S3.SS4.p5.3.m3.1.1.2.3">128</cn></apply><apply id="S3.SS4.p5.3.m3.1.1.3.cmml" xref="S3.SS4.p5.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p5.3.m3.1.1.3.1.cmml" xref="S3.SS4.p5.3.m3.1.1.3">subscript</csymbol><ci id="S3.SS4.p5.3.m3.1.1.3.2.cmml" xref="S3.SS4.p5.3.m3.1.1.3.2">𝐿</ci><cn id="S3.SS4.p5.3.m3.1.1.3.3.cmml" type="integer" xref="S3.SS4.p5.3.m3.1.1.3.3">64</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p5.3.m3.1c">S_{128}+L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p5.3.m3.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>) consistently outperforms the baseline models.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p6">
<p class="ltx_p" id="S3.SS4.p6.1">The plot on the right illustrates the increase in perplexity resulting from reducing the context window size. Notably, models incorporating long-term memory (<span class="ltx_text ltx_font_smallcaps" id="S3.SS4.p6.1.1">Melodi</span> variants with long-term memory and Memorizing Transformer) exhibit significantly less performance degradation (smaller perplexity increments) compared to models relying solely on short-term memory (<span class="ltx_text ltx_font_smallcaps" id="S3.SS4.p6.1.2">Melodi</span> variant with only short-term memory, Transformer XL, and Block Recurrent Transformer). This highlights the greater robustness of long-term memory mechanisms to reductions in context window size.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p7">
<p class="ltx_p" id="S3.SS4.p7.1"><span class="ltx_text ltx_font_bold" id="S3.SS4.p7.1.1">Number of short-term layers:</span>
We investigate the effect of varying the number of short-term layers on model performance. For a given layer count (e.g., 4 layers), the short-term layers are uniformly distributed throughout the network (e.g., layers 1, 5, 9, and 13). To disable short-term memory within a layer, we remove (a) the attention mechanism to the preceding short-term memory and (b) the linear token mixer responsible for updating the short-term memory.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p8">
<p class="ltx_p" id="S3.SS4.p8.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.F7" title="Figure 7 ‣ Table 4 ‣ 3.4 Ablations ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">7</span></a> shows that perplexity improves rapidly as the number of short-term layers increases from 1 to 4, after which the gains diminish. This observation supports our utilization of multiple layers for effective short-term memory modeling. However, it also suggests that disabling short-term memory in half of the layers offers a more efficient approach with negligible performance degradation.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p9">
<p class="ltx_p" id="S3.SS4.p9.5"><span class="ltx_text ltx_font_bold" id="S3.SS4.p9.5.1">Number of long-term layers:</span>
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.F8" title="Figure 8 ‣ Table 4 ‣ 3.4 Ablations ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">8</span></a> illustrates the effect of varying the number of long-term layers on perplexity. We consider two configurations: <math alttext="L_{64}" class="ltx_Math" display="inline" id="S3.SS4.p9.1.m1.1"><semantics id="S3.SS4.p9.1.m1.1a"><msub id="S3.SS4.p9.1.m1.1.1" xref="S3.SS4.p9.1.m1.1.1.cmml"><mi id="S3.SS4.p9.1.m1.1.1.2" xref="S3.SS4.p9.1.m1.1.1.2.cmml">L</mi><mn id="S3.SS4.p9.1.m1.1.1.3" xref="S3.SS4.p9.1.m1.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p9.1.m1.1b"><apply id="S3.SS4.p9.1.m1.1.1.cmml" xref="S3.SS4.p9.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p9.1.m1.1.1.1.cmml" xref="S3.SS4.p9.1.m1.1.1">subscript</csymbol><ci id="S3.SS4.p9.1.m1.1.1.2.cmml" xref="S3.SS4.p9.1.m1.1.1.2">𝐿</ci><cn id="S3.SS4.p9.1.m1.1.1.3.cmml" type="integer" xref="S3.SS4.p9.1.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p9.1.m1.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p9.1.m1.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math> and <math alttext="L_{32}" class="ltx_Math" display="inline" id="S3.SS4.p9.2.m2.1"><semantics id="S3.SS4.p9.2.m2.1a"><msub id="S3.SS4.p9.2.m2.1.1" xref="S3.SS4.p9.2.m2.1.1.cmml"><mi id="S3.SS4.p9.2.m2.1.1.2" xref="S3.SS4.p9.2.m2.1.1.2.cmml">L</mi><mn id="S3.SS4.p9.2.m2.1.1.3" xref="S3.SS4.p9.2.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p9.2.m2.1b"><apply id="S3.SS4.p9.2.m2.1.1.cmml" xref="S3.SS4.p9.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS4.p9.2.m2.1.1.1.cmml" xref="S3.SS4.p9.2.m2.1.1">subscript</csymbol><ci id="S3.SS4.p9.2.m2.1.1.2.cmml" xref="S3.SS4.p9.2.m2.1.1.2">𝐿</ci><cn id="S3.SS4.p9.2.m2.1.1.3.cmml" type="integer" xref="S3.SS4.p9.2.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p9.2.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p9.2.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math>, which compress each context window into 64 and 32 long-term tokens, respectively.
With <math alttext="L_{64}" class="ltx_Math" display="inline" id="S3.SS4.p9.3.m3.1"><semantics id="S3.SS4.p9.3.m3.1a"><msub id="S3.SS4.p9.3.m3.1.1" xref="S3.SS4.p9.3.m3.1.1.cmml"><mi id="S3.SS4.p9.3.m3.1.1.2" xref="S3.SS4.p9.3.m3.1.1.2.cmml">L</mi><mn id="S3.SS4.p9.3.m3.1.1.3" xref="S3.SS4.p9.3.m3.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p9.3.m3.1b"><apply id="S3.SS4.p9.3.m3.1.1.cmml" xref="S3.SS4.p9.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS4.p9.3.m3.1.1.1.cmml" xref="S3.SS4.p9.3.m3.1.1">subscript</csymbol><ci id="S3.SS4.p9.3.m3.1.1.2.cmml" xref="S3.SS4.p9.3.m3.1.1.2">𝐿</ci><cn id="S3.SS4.p9.3.m3.1.1.3.cmml" type="integer" xref="S3.SS4.p9.3.m3.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p9.3.m3.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p9.3.m3.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>, introducing the first long-term layer yields a substantial perplexity improvement, after which performance plateaus. In contrast, with <math alttext="L_{32}" class="ltx_Math" display="inline" id="S3.SS4.p9.4.m4.1"><semantics id="S3.SS4.p9.4.m4.1a"><msub id="S3.SS4.p9.4.m4.1.1" xref="S3.SS4.p9.4.m4.1.1.cmml"><mi id="S3.SS4.p9.4.m4.1.1.2" xref="S3.SS4.p9.4.m4.1.1.2.cmml">L</mi><mn id="S3.SS4.p9.4.m4.1.1.3" xref="S3.SS4.p9.4.m4.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p9.4.m4.1b"><apply id="S3.SS4.p9.4.m4.1.1.cmml" xref="S3.SS4.p9.4.m4.1.1"><csymbol cd="ambiguous" id="S3.SS4.p9.4.m4.1.1.1.cmml" xref="S3.SS4.p9.4.m4.1.1">subscript</csymbol><ci id="S3.SS4.p9.4.m4.1.1.2.cmml" xref="S3.SS4.p9.4.m4.1.1.2">𝐿</ci><cn id="S3.SS4.p9.4.m4.1.1.3.cmml" type="integer" xref="S3.SS4.p9.4.m4.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p9.4.m4.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p9.4.m4.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math>, while adding a second long-term layer provides a notable gain, the resulting performance remains inferior to that of a single <math alttext="L_{64}" class="ltx_Math" display="inline" id="S3.SS4.p9.5.m5.1"><semantics id="S3.SS4.p9.5.m5.1a"><msub id="S3.SS4.p9.5.m5.1.1" xref="S3.SS4.p9.5.m5.1.1.cmml"><mi id="S3.SS4.p9.5.m5.1.1.2" xref="S3.SS4.p9.5.m5.1.1.2.cmml">L</mi><mn id="S3.SS4.p9.5.m5.1.1.3" xref="S3.SS4.p9.5.m5.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p9.5.m5.1b"><apply id="S3.SS4.p9.5.m5.1.1.cmml" xref="S3.SS4.p9.5.m5.1.1"><csymbol cd="ambiguous" id="S3.SS4.p9.5.m5.1.1.1.cmml" xref="S3.SS4.p9.5.m5.1.1">subscript</csymbol><ci id="S3.SS4.p9.5.m5.1.1.2.cmml" xref="S3.SS4.p9.5.m5.1.1.2">𝐿</ci><cn id="S3.SS4.p9.5.m5.1.1.3.cmml" type="integer" xref="S3.SS4.p9.5.m5.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p9.5.m5.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p9.5.m5.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math> layer, even though both configurations utilize the same total number of long-term tokens. These findings validate our design choice of employing a single long-term memory layer with a sufficient number of long-term tokens.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p10">
<p class="ltx_p" id="S3.SS4.p10.1"><span class="ltx_text ltx_font_bold" id="S3.SS4.p10.1.1">Summary branching:</span>
Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#S3.T4" title="Table 4 ‣ 3.4 Ablations ‣ 3 Experimental Results ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">4</span></a> examines the effect of summary branching on perplexity, both with (ST+LT) and without (ST) long-term memory. Summary branching consistently yields a perplexity improvement of approximately 0.3, indicating distinct summary information flow across network layers and context windows.</p>
</div>
<figure class="ltx_table" id="S3.T4">
<div class="ltx_flex_figure ltx_flex_table">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_bottom" id="S3.T4.fig1" style="width:125.7pt;">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Table 4: </span><span class="ltx_text ltx_font_bold" id="S3.T4.fig1.2.1">Summary branching.</span> Summary branching provides a consistent gain of approximately 0.3 in perplexity, both with (column ST+LT) and without (column ST) long-term memory.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S3.T4.fig1.3">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S3.T4.fig1.3.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r" id="S3.T4.fig1.3.1.1.1" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T4.fig1.3.1.1.1.1">Branching</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T4.fig1.3.1.1.2" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T4.fig1.3.1.1.2.1">ST</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="S3.T4.fig1.3.1.1.3" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T4.fig1.3.1.1.3.1">ST+LT</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S3.T4.fig1.3.2.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S3.T4.fig1.3.2.1.1" style="padding-left:2.3pt;padding-right:2.3pt;">No</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T4.fig1.3.2.1.2" style="padding-left:2.3pt;padding-right:2.3pt;">11.68</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="S3.T4.fig1.3.2.1.3" style="padding-left:2.3pt;padding-right:2.3pt;">11.24</td>
</tr>
<tr class="ltx_tr" id="S3.T4.fig1.3.3.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="S3.T4.fig1.3.3.2.1" style="padding-left:2.3pt;padding-right:2.3pt;">Yes</th>
<td class="ltx_td ltx_align_center" id="S3.T4.fig1.3.3.2.2" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T4.fig1.3.3.2.2.1">11.39</span></td>
<td class="ltx_td ltx_align_center" id="S3.T4.fig1.3.3.2.3" style="padding-left:2.3pt;padding-right:2.3pt;"><span class="ltx_text ltx_font_bold" id="S3.T4.fig1.3.3.2.3.1">10.95</span></td>
</tr>
</tbody>
</table>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<div class="ltx_block ltx_figure_panel" id="S3.T4.3">
<figure class="ltx_figure ltx_figure_panel ltx_align_bottom" id="S3.F7" style="width:138.8pt;"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="426" id="S3.T4.1.1.g1" src="extracted/5900799/figure/short-term-layers.png" width="598"/>
<br class="ltx_break ltx_break"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 7: </span><span class="ltx_text ltx_font_bold" id="S3.F7.3.1">Number of short-term layers.</span> Perplexity improves as the number of short-term layers increases.
</figcaption>
</figure>
<figure class="ltx_figure ltx_figure_panel ltx_align_bottom" id="S3.F8" style="width:138.8pt;"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_figure_panel ltx_img_landscape" height="423" id="S3.T4.2.1.g1" src="extracted/5900799/figure/long-term-layers.png" width="598"/>
<br class="ltx_break ltx_break"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 8: </span><span class="ltx_text ltx_font_bold" id="S3.F8.3.1">Number of long-term layers.</span> A single layer with sufficient long-term tokens is adequate.</figcaption>
</figure>
</div>
</div>
</div>
</figure>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Related Work</h2>
<div class="ltx_para ltx_noindent" id="S4.p1">
<p class="ltx_p" id="S4.p1.1"><span class="ltx_text ltx_font_bold" id="S4.p1.1.1">Memory in language models:</span>
While LSTMs <cite class="ltx_cite ltx_citemacro_citep">(Hochreiter &amp; Schmidhuber, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib11" title="">1997</a>)</cite> achieve long-range memory through recurrent compression at the token level, the advent of Transformers <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib33" title="">2017</a>)</cite> has shifted the focus to memory mechanisms operating at the context window level. Transformer-XL <cite class="ltx_cite ltx_citemacro_citep">(Dai et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib7" title="">2019</a>)</cite> introduces a caching mechanism to store key-value (KV) pairs from the preceding context window as a form of short-term memory. Block Recurrent Transformer <cite class="ltx_cite ltx_citemacro_citep">(Hutchins et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib15" title="">2022</a>)</cite> and RMT <cite class="ltx_cite ltx_citemacro_citep">(Bulatov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib2" title="">2022</a>)</cite>, integrate recurrent mechanisms inspired by LSTMs into Transformer architectures at the window level. <cite class="ltx_cite ltx_citemacro_cite">Munkhdalai et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib20" title="">2024</a>)</cite> explore the use of additional memory like Hopfield Networks <cite class="ltx_cite ltx_citemacro_citep">(Hopfield, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib13" title="">1982</a>; Ramsauer et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib26" title="">2021</a>)</cite>. Memorizing Transformer <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib37" title="">2022</a>)</cite> introduces a dedicated memory layer to store KV pairs for long-term memory, whereas MemoryLLM <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib34" title="">2024</a>)</cite> incorporates long-term memory in every layer, incurring a substantial memory overhead. In contrast to these approaches, <span class="ltx_text ltx_font_smallcaps" id="S4.p1.1.2">Melodi</span> integrates both short-term and long-term memory into a transformer model via compression.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p2">
<p class="ltx_p" id="S4.p2.1"><span class="ltx_text ltx_font_bold" id="S4.p2.1.1">Extending context length:</span>
Recent research has demonstrated promising progress in scaling the context length of language models. To mitigate the cost of attention mechanisms over long contexts, LongLoRA <cite class="ltx_cite ltx_citemacro_citep">(Chen et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib4" title="">2024</a>)</cite>, PCW <cite class="ltx_cite ltx_citemacro_citep">(Ratner et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib27" title="">2023</a>)</cite>, and Landmark-Attention <cite class="ltx_cite ltx_citemacro_citep">(Mohtashami &amp; Jaggi, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib18" title="">2023</a>)</cite> employ sparse local attention for efficient fine-tuning. Position-Interpolation <cite class="ltx_cite ltx_citemacro_citep">(Chen et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib3" title="">2023</a>)</cite> and YaRN <cite class="ltx_cite ltx_citemacro_citep">(Peng et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib22" title="">2023</a>)</cite> extend context size by modifying the RoPE embedding scheme <cite class="ltx_cite ltx_citemacro_citep">(Su et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib29" title="">2023</a>)</cite>. <cite class="ltx_cite ltx_citemacro_cite">Xiong et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib38" title="">2023</a>)</cite> provide a practical recipe for extending LLAMA2 <cite class="ltx_cite ltx_citemacro_citep">(Touvron et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib32" title="">2023</a>)</cite> to handle up to 32,768 tokens, while <cite class="ltx_cite ltx_citemacro_cite">Fu et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib8" title="">2024</a>)</cite> further explore data-centric approaches for extending context length through lightweight continual pretraining.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p3">
<p class="ltx_p" id="S4.p3.1"><span class="ltx_text ltx_font_bold" id="S4.p3.1.1">Compression:</span>
Recent work has demonstrated the effectiveness of Transformer models in compressing input sequences by appending summary tokens <cite class="ltx_cite ltx_citemacro_citep">(Rae et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib23" title="">2019</a>; Bulatov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib2" title="">2022</a>; Chevalier et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib5" title="">2023</a>; Ge et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib9" title="">2024</a>)</cite>. For instance, RMT <cite class="ltx_cite ltx_citemacro_citep">(Bulatov et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib2" title="">2022</a>)</cite> utilizes the output of summary tokens recurrently as short-term memory. AutoCompressor <cite class="ltx_cite ltx_citemacro_citep">(Chevalier et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib5" title="">2023</a>)</cite> aggregates summary tokens across segments to generate a summary representation for long documents used in retrieval tasks. GISTING <cite class="ltx_cite ltx_citemacro_citep">(Mu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib19" title="">2024</a>)</cite> applies this technique to compress long prompts. ICAE <cite class="ltx_cite ltx_citemacro_citep">(Ge et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib9" title="">2024</a>)</cite> further incorporates LoRA fine-tuning <cite class="ltx_cite ltx_citemacro_citep">(Hu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib14" title="">2021</a>)</cite> for context compression, while TransformerFAM <cite class="ltx_cite ltx_citemacro_citep">(Hwang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib16" title="">2024</a>)</cite> introduces feedback attention to enhance performance.</p>
</div>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Conclusion</h2>
<div class="ltx_para ltx_noindent" id="S5.p1">
<p class="ltx_p" id="S5.p1.1">In this work, we have introduced <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.1">Melodi</span>, a novel memory architecture designed to address the challenges of long document processing within the constraints of short context windows. The core innovation of <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.2">Melodi</span> lies in its hierarchical compression approach, wherein short-term memory facilitates smooth transitions between context windows through recurrent compression across multiple layers, and long-term memory preserves crucial information from the entire history by performing further compression and aggregation within a single middle layer. Our empirical evaluations on multiple long-context datasets have validated <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.3">Melodi</span> as an efficient and effective solution. The success of <span class="ltx_text ltx_font_smallcaps" id="S5.p1.1.4">Melodi</span> underscores the potential of hierarchical memory compression for tackling the complexities of long document processing. We anticipate that further research in this direction will enhance long context understanding and generation over multiple modalities.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Agarwal et al. (2024)</span>
<span class="ltx_bibblock">
Rishabh Agarwal, Avi Singh, Lei M. Zhang, Bernd Bohnet, Luis Rosias, Stephanie
Chan, Biao Zhang, Ankesh Anand, Zaheer Abbas, Azade Nova, John D. Co-Reyes,
Eric Chu, Feryal Behbahani, Aleksandra Faust, and Hugo Larochelle.

</span>
<span class="ltx_bibblock">Many-shot in-context learning, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2404.11018" title="">https://arxiv.org/abs/2404.11018</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bulatov et al. (2022)</span>
<span class="ltx_bibblock">
Aydar Bulatov, Yury Kuratov, and Mikhail Burtsev.

</span>
<span class="ltx_bibblock">Recurrent memory transformer.

</span>
<span class="ltx_bibblock">In S. Koyejo, S. Mohamed, A. Agarwal, D. Belgrave, K. Cho, and A. Oh
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib2.1.1">Advances in Neural Information Processing Systems</em>, volume 35,
pp.  11079–11091. Curran Associates, Inc., 2022.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2022/file/47e288629a6996a17ce50b90a056a0e1-Paper-Conference.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2022/file/47e288629a6996a17ce50b90a056a0e1-Paper-Conference.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al. (2023)</span>
<span class="ltx_bibblock">
Shouyuan Chen, Sherman Wong, Liangjian Chen, and Yuandong Tian.

</span>
<span class="ltx_bibblock">Extending context window of large language models via positional
interpolation, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2306.15595" title="">https://arxiv.org/abs/2306.15595</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen et al. (2024)</span>
<span class="ltx_bibblock">
Yukang Chen, Shengju Qian, Haotian Tang, Xin Lai, Zhijian Liu, Song Han, and
Jiaya Jia.

</span>
<span class="ltx_bibblock">Longlora: Efficient fine-tuning of long-context large language
models, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2309.12307" title="">https://arxiv.org/abs/2309.12307</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chevalier et al. (2023)</span>
<span class="ltx_bibblock">
Alexis Chevalier, Alexander Wettig, Anirudh Ajith, and Danqi Chen.

</span>
<span class="ltx_bibblock">Adapting language models to compress contexts.

</span>
<span class="ltx_bibblock">In Houda Bouamor, Juan Pino, and Kalika Bali (eds.),
<em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">Proceedings of the 2023 Conference on Empirical Methods in Natural
Language Processing</em>, pp.  3829–3846, Singapore, December 2023. Association
for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/2023.emnlp-main.232</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2023.emnlp-main.232" title="">https://aclanthology.org/2023.emnlp-main.232</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chung et al. (2024)</span>
<span class="ltx_bibblock">
Hyung Won Chung, Le Hou, Shayne Longpre, Barret Zoph, Yi Tay, William Fedus,
Yunxuan Li, Xuezhi Wang, Mostafa Dehghani, Siddhartha Brahma, Albert Webson,
Shixiang Shane Gu, Zhuyun Dai, Mirac Suzgun, Xinyun Chen, Aakanksha
Chowdhery, Alex Castro-Ros, Marie Pellat, Kevin Robinson, Dasha Valter,
Sharan Narang, Gaurav Mishra, Adams Yu, Vincent Zhao, Yanping Huang, Andrew
Dai, Hongkun Yu, Slav Petrov, Ed H. Chi, Jeff Dean, Jacob Devlin, Adam
Roberts, Denny Zhou, Quoc V. Le, and Jason Wei.

</span>
<span class="ltx_bibblock">Scaling instruction-finetuned language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib6.1.1">Journal of Machine Learning Research</em>, 25(70):1–53, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://jmlr.org/papers/v25/23-0870.html" title="">http://jmlr.org/papers/v25/23-0870.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dai et al. (2019)</span>
<span class="ltx_bibblock">
Zihang Dai, Zhilin Yang, Yiming Yang, Jaime Carbonell, Quoc Le, and Ruslan
Salakhutdinov.

</span>
<span class="ltx_bibblock">Transformer-XL: Attentive language models beyond a fixed-length
context.

</span>
<span class="ltx_bibblock">In Anna Korhonen, David Traum, and Lluís Màrquez (eds.),
<em class="ltx_emph ltx_font_italic" id="bib.bib7.1.1">Proceedings of the 57th Annual Meeting of the Association for
Computational Linguistics</em>, pp.  2978–2988, Florence, Italy, July 2019.
Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/P19-1285</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/P19-1285" title="">https://aclanthology.org/P19-1285</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fu et al. (2024)</span>
<span class="ltx_bibblock">
Yao Fu, Rameswar Panda, Xinyao Niu, Xiang Yue, Hannaneh Hajishirzi, Yoon Kim,
and Hao Peng.

</span>
<span class="ltx_bibblock">Data engineering for scaling language models to 128k context, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2402.10171" title="">https://arxiv.org/abs/2402.10171</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ge et al. (2024)</span>
<span class="ltx_bibblock">
Tao Ge, Jing Hu, Lei Wang, Xun Wang, Si-Qing Chen, and Furu Wei.

</span>
<span class="ltx_bibblock">In-context autoencoder for context compression in a large language
model, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2307.06945" title="">https://arxiv.org/abs/2307.06945</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gemini-Team (2024)</span>
<span class="ltx_bibblock">
Gemini-Team.

</span>
<span class="ltx_bibblock">Gemini 1.5: Unlocking multimodal understanding across millions of
tokens of context, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2403.05530" title="">https://arxiv.org/abs/2403.05530</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hochreiter &amp; Schmidhuber (1997)</span>
<span class="ltx_bibblock">
Sepp Hochreiter and Jürgen Schmidhuber.

</span>
<span class="ltx_bibblock">Long short-term memory.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">Neural Computation</em>, 9(8):1735–1780, 1997.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hoffmann et al. (2022)</span>
<span class="ltx_bibblock">
Jordan Hoffmann, Sebastian Borgeaud, Arthur Mensch, Elena Buchatskaya, Trevor
Cai, Eliza Rutherford, Diego de Las Casas, Lisa Anne Hendricks, Johannes
Welbl, Aidan Clark, Tom Hennigan, Eric Noland, Katie Millican, George van den
Driessche, Bogdan Damoc, Aurelia Guy, Simon Osindero, Karen Simonyan, Erich
Elsen, Jack W. Rae, Oriol Vinyals, and Laurent Sifre.

</span>
<span class="ltx_bibblock">Training compute-optimal large language models, 2022.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2203.15556" title="">https://arxiv.org/abs/2203.15556</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hopfield (1982)</span>
<span class="ltx_bibblock">
J. J. Hopfield.

</span>
<span class="ltx_bibblock">Neural networks and physical systems with emergent collective
computational abilities.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">Proceedings of the National Academy of Sciences of the United
States of America</em>, 79(8):2554–2558, April 1982.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hu et al. (2021)</span>
<span class="ltx_bibblock">
Edward J. Hu, Yelong Shen, Phillip Wallis, Zeyuan Allen-Zhu, Yuanzhi Li, Shean
Wang, Lu Wang, and Weizhu Chen.

</span>
<span class="ltx_bibblock">Lora: Low-rank adaptation of large language models, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2106.09685" title="">https://arxiv.org/abs/2106.09685</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hutchins et al. (2022)</span>
<span class="ltx_bibblock">
DeLesley Hutchins, Imanol Schlag, Yuhuai Wu, Ethan Dyer, and Behnam Neyshabur.

</span>
<span class="ltx_bibblock">Block-recurrent transformers.

</span>
<span class="ltx_bibblock">In S. Koyejo, S. Mohamed, A. Agarwal, D. Belgrave, K. Cho, and A. Oh
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">Advances in Neural Information Processing Systems</em>, volume 35,
pp.  33248–33261. Curran Associates, Inc., 2022.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2022/file/d6e0bbb9fc3f4c10950052ec2359355c-Paper-Conference.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2022/file/d6e0bbb9fc3f4c10950052ec2359355c-Paper-Conference.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hwang et al. (2024)</span>
<span class="ltx_bibblock">
Dongseong Hwang, Weiran Wang, Zhuoyuan Huo, Khe Chai Sim, and Pedro Moreno
Mengibar.

</span>
<span class="ltx_bibblock">Transformerfam: Feedback attention is working memory, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2404.09173" title="">https://arxiv.org/abs/2404.09173</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kudo &amp; Richardson (2018)</span>
<span class="ltx_bibblock">
Taku Kudo and John Richardson.

</span>
<span class="ltx_bibblock">SentencePiece: A simple and language independent subword
tokenizer and detokenizer for neural text processing.

</span>
<span class="ltx_bibblock">In Eduardo Blanco and Wei Lu (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib17.1.1">Proceedings of the 2018
Conference on Empirical Methods in Natural Language Processing: System
Demonstrations</em>, pp.  66–71, Brussels, Belgium, November 2018. Association
for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/D18-2012</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/D18-2012" title="">https://aclanthology.org/D18-2012</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mohtashami &amp; Jaggi (2023)</span>
<span class="ltx_bibblock">
Amirkeivan Mohtashami and Martin Jaggi.

</span>
<span class="ltx_bibblock">Random-access infinite context length for transformers.

</span>
<span class="ltx_bibblock">In A. Oh, T. Naumann, A. Globerson, K. Saenko, M. Hardt, and
S. Levine (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">Advances in Neural Information Processing Systems</em>,
volume 36, pp.  54567–54585. Curran Associates, Inc., 2023.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2023/file/ab05dc8bf36a9f66edbff6992ec86f56-Paper-Conference.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2023/file/ab05dc8bf36a9f66edbff6992ec86f56-Paper-Conference.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Mu et al. (2024)</span>
<span class="ltx_bibblock">
Jesse Mu, Xiang Lisa Li, and Noah Goodman.

</span>
<span class="ltx_bibblock">Learning to compress prompts with gist tokens, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2304.08467" title="">https://arxiv.org/abs/2304.08467</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Munkhdalai et al. (2024)</span>
<span class="ltx_bibblock">
Tsendsuren Munkhdalai, Manaal Faruqui, and Siddharth Gopal.

</span>
<span class="ltx_bibblock">Leave no context behind: Efficient infinite context transformers with
infini-attention, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2404.07143" title="">https://arxiv.org/abs/2404.07143</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">OpenAI (2024)</span>
<span class="ltx_bibblock">
OpenAI.

</span>
<span class="ltx_bibblock">Gpt-4 technical report, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2303.08774" title="">https://arxiv.org/abs/2303.08774</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Peng et al. (2023)</span>
<span class="ltx_bibblock">
Bowen Peng, Jeffrey Quesnelle, Honglu Fan, and Enrico Shippole.

</span>
<span class="ltx_bibblock">Yarn: Efficient context window extension of large language models,
2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2309.00071" title="">https://arxiv.org/abs/2309.00071</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rae et al. (2019)</span>
<span class="ltx_bibblock">
Jack W Rae, Anna Potapenko, Siddhant M Jayakumar, Chloe Hillier, and Timothy P
Lillicrap.

</span>
<span class="ltx_bibblock">Compressive transformers for long-range sequence modelling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">arXiv preprint</em>, 2019.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/1911.05507" title="">https://arxiv.org/abs/1911.05507</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Raffel et al. (2020a)</span>
<span class="ltx_bibblock">
Colin Raffel, Noam Shazeer, Adam Roberts, Katherine Lee, Sharan Narang, Michael
Matena, Yanqi Zhou, Wei Li, and Peter J. Liu.

</span>
<span class="ltx_bibblock">Exploring the limits of transfer learning with a unified text-to-text
transformer.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib24.1.1">Journal of Machine Learning Research</em>, 21(140):1–67, 2020a.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://jmlr.org/papers/v21/20-074.html" title="">http://jmlr.org/papers/v21/20-074.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Raffel et al. (2020b)</span>
<span class="ltx_bibblock">
Colin Raffel, Noam Shazeer, Adam Roberts, Katherine Lee, Sharan Narang, Michael
Matena, Yanqi Zhou, Wei Li, and Peter J. Liu.

</span>
<span class="ltx_bibblock">Exploring the limits of transfer learning with a unified text-to-text
transformer.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib25.1.1">Journal of Machine Learning Research</em>, 21(140):1–67, 2020b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://jmlr.org/papers/v21/20-074.html" title="">http://jmlr.org/papers/v21/20-074.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ramsauer et al. (2021)</span>
<span class="ltx_bibblock">
Hubert Ramsauer, Bernhard Schäfl, Johannes Lehner, Philipp Seidl, Michael
Widrich, Thomas Adler, Lukas Gruber, Markus Holzleitner, Milena Pavlović,
Geir Kjetil Sandve, Victor Greiff, David Kreil, Michael Kopp, Günter
Klambauer, Johannes Brandstetter, and Sepp Hochreiter.

</span>
<span class="ltx_bibblock">Hopfield networks is all you need, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2008.02217" title="">https://arxiv.org/abs/2008.02217</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ratner et al. (2023)</span>
<span class="ltx_bibblock">
Nir Ratner, Yoav Levine, Yonatan Belinkov, Ori Ram, Inbal Magar, Omri Abend,
Ehud Karpas, Amnon Shashua, Kevin Leyton-Brown, and Yoav Shoham.

</span>
<span class="ltx_bibblock">Parallel context windows for large language models, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Shazeer &amp; Stern (2018)</span>
<span class="ltx_bibblock">
Noam Shazeer and Mitchell Stern.

</span>
<span class="ltx_bibblock">Adafactor: Adaptive Learning Rates with Sublinear Memory Cost.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">Proceedings of the 35th International Conference on Machine
Learning</em>, pp.  4603–4611. PMLR, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Su et al. (2023)</span>
<span class="ltx_bibblock">
Jianlin Su, Yu Lu, Shengfeng Pan, Ahmed Murtadha, Bo Wen, and Yunfeng Liu.

</span>
<span class="ltx_bibblock">Roformer: Enhanced transformer with rotary position embedding, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2104.09864" title="">https://arxiv.org/abs/2104.09864</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Thoppilan et al. (2022)</span>
<span class="ltx_bibblock">
Romal Thoppilan, Daniel De Freitas, Jamie Hall, Noam Shazeer, Apoorv
Kulshreshtha, Heng-Tze Cheng, Alicia Jin, Taylor Bos, Leslie Baker, Yu Du,
and et al.

</span>
<span class="ltx_bibblock">Lamda: Language models for dialog applications, 2022.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2201.08239" title="">https://arxiv.org/abs/2201.08239</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Tolstikhin et al. (2021)</span>
<span class="ltx_bibblock">
Ilya Tolstikhin, Neil Houlsby, Alexander Kolesnikov, Lucas Beyer, Xiaohua Zhai,
Thomas Unterthiner, Jessica Yung, Andreas Steiner, Daniel Keysers, Jakob
Uszkoreit, Mario Lucic, and Alexey Dosovitskiy.

</span>
<span class="ltx_bibblock">Mlp-mixer: An all-mlp architecture for vision, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Touvron et al. (2023)</span>
<span class="ltx_bibblock">
Hugo Touvron, Louis Martin, Kevin Stone, Peter Albert, Amjad Almahairi, Yasmine
Babaei, Nikolay Bashlykov, Soumya Batra, Prajjwal Bhargava, Shruti Bhosale,
Dan Bikel, Lukas Blecher, Cristian Canton Ferrer, Moya Chen, Guillem
Cucurull, David Esiobu, Jude Fernandes, Jeremy Fu, Wenyin Fu, Brian Fuller,
Cynthia Gao, Vedanuj Goswami, Naman Goyal, Anthony Hartshorn, Saghar
Hosseini, Rui Hou, Hakan Inan, Marcin Kardas, Viktor Kerkez, Madian Khabsa,
Isabel Kloumann, Artem Korenev, Punit Singh Koura, Marie-Anne Lachaux,
Thibaut Lavril, Jenya Lee, Diana Liskovich, Yinghai Lu, Yuning Mao, Xavier
Martinet, Todor Mihaylov, Pushkar Mishra, Igor Molybog, Yixin Nie, Andrew
Poulton, Jeremy Reizenstein, Rashi Rungta, Kalyan Saladi, Alan Schelten, Ruan
Silva, Eric Michael Smith, Ranjan Subramanian, Xiaoqing Ellen Tan, Binh Tang,
Ross Taylor, Adina Williams, Jian Xiang Kuan, Puxin Xu, Zheng Yan, Iliyan
Zarov, Yuchen Zhang, Angela Fan, Melanie Kambadur, Sharan Narang, Aurelien
Rodriguez, Robert Stojnic, Sergey Edunov, and Thomas Scialom.

</span>
<span class="ltx_bibblock">Llama 2: Open foundation and fine-tuned chat models, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2307.09288" title="">https://arxiv.org/abs/2307.09288</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al. (2017)</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones,
Aidan N Gomez, Ł ukasz Kaiser, and Illia Polosukhin.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock">In I. Guyon, U. V. Luxburg, S. Bengio, H. Wallach, R. Fergus,
S. Vishwanathan, and R. Garnett (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib33.1.1">Advances in Neural Information
Processing Systems</em>, volume 30. Curran Associates, Inc., 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2024)</span>
<span class="ltx_bibblock">
Yu Wang, Yifan Gao, Xiusi Chen, Haoming Jiang, Shiyang Li, Jingfeng Yang,
Qingyu Yin, Zheng Li, Xian Li, Bing Yin, Jingbo Shang, and Julian McAuley.

</span>
<span class="ltx_bibblock">Memoryllm: Towards self-updatable large language models, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2402.04624" title="">https://arxiv.org/abs/2402.04624</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wei et al. (2022a)</span>
<span class="ltx_bibblock">
Jason Wei, Maarten Bosma, Vincent Zhao, Kelvin Guu, Adams Wei Yu, Brian Lester,
Nan Du, Andrew M. Dai, and Quoc V Le.

</span>
<span class="ltx_bibblock">Finetuned language models are zero-shot learners.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">International Conference on Learning Representations</em>,
2022a.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=gEZrGCozdqR" title="">https://openreview.net/forum?id=gEZrGCozdqR</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wei et al. (2022b)</span>
<span class="ltx_bibblock">
Jason Wei, Xuezhi Wang, Dale Schuurmans, Maarten Bosma, brian ichter, Fei Xia,
Ed Chi, Quoc V Le, and Denny Zhou.

</span>
<span class="ltx_bibblock">Chain-of-thought prompting elicits reasoning in large language
models.

</span>
<span class="ltx_bibblock">In S. Koyejo, S. Mohamed, A. Agarwal, D. Belgrave, K. Cho, and A. Oh
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib36.1.1">Advances in Neural Information Processing Systems</em>, volume 35,
pp.  24824–24837. Curran Associates, Inc., 2022b.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2022/file/9d5609613524ecf4f15af0f7b31abca4-Paper-Conference.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2022/file/9d5609613524ecf4f15af0f7b31abca4-Paper-Conference.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wu et al. (2022)</span>
<span class="ltx_bibblock">
Yuhuai Wu, Markus Norman Rabe, DeLesley Hutchins, and Christian Szegedy.

</span>
<span class="ltx_bibblock">Memorizing transformers.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib37.1.1">International Conference on Learning Representations</em>, 2022.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://openreview.net/forum?id=TrjbxzRcnf-" title="">https://openreview.net/forum?id=TrjbxzRcnf-</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xiong et al. (2023)</span>
<span class="ltx_bibblock">
Wenhan Xiong, Jingyu Liu, Igor Molybog, Hejia Zhang, Prajjwal Bhargava, Rui
Hou, Louis Martin, Rashi Rungta, Karthik Abinav Sankararaman, Barlas Oguz,
Madian Khabsa, Han Fang, Yashar Mehdad, Sharan Narang, Kshitiz Malik, Angela
Fan, Shruti Bhosale, Sergey Edunov, Mike Lewis, Sinong Wang, and Hao Ma.

</span>
<span class="ltx_bibblock">Effective long-context scaling of foundation models, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2309.16039" title="">https://arxiv.org/abs/2309.16039</a>.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Limitations</h2>
<div class="ltx_para ltx_noindent" id="A1.p1">
<p class="ltx_p" id="A1.p1.1">A primary limitation of our current method is its focus on training from scratch, without addressing the fine-tuning of pre-trained models with fixed context window sizes. In future work, we plan to explore adapting <span class="ltx_text ltx_font_smallcaps" id="A1.p1.1.1">Melodi</span> (short-term and long-term memory) to enhance the long-context capabilities of pre-trained models through techniques like LoRA fine-tuning.</p>
</div>
</section>
<section class="ltx_appendix" id="A2">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>Training Details</h2>
<div class="ltx_para ltx_noindent" id="A2.p1">
<p class="ltx_p" id="A2.p1.1">We use Adafactor optimizer <cite class="ltx_cite ltx_citemacro_citep">(Shazeer &amp; Stern, <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib28" title="">2018</a>)</cite> with a learning rate schedule that employs a linear warmup for the first 1000 steps, followed by cosine decay. The maximum and minimum learning rates are set to 0.01 and 0.001, respectively, as recommended in <cite class="ltx_cite ltx_citemacro_cite">Hoffmann et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#bib.bib12" title="">2022</a>)</cite>. A dropout rate of 0.05 is applied. All models are trained for 500k steps (200k for ablations) on 32 TPU cores with a batch size of 32 (1 per core).</p>
</div>
<figure class="ltx_table" id="A2.T5">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 5: </span><span class="ltx_text ltx_font_bold" id="A2.T5.34.1">Comparisons with baselines on three datasets</span>. The table reports average token-level perplexities for various models on three datasets. All models were trained under the same settings (e.g. segment length 4096, context window 512, 500k training steps). Three <span class="ltx_text ltx_font_smallcaps" id="A2.T5.35.2">Melodi</span> configurations were used: <math alttext="S_{192}+L_{32}" class="ltx_Math" display="inline" id="A2.T5.9.m1.1"><semantics id="A2.T5.9.m1.1b"><mrow id="A2.T5.9.m1.1.1" xref="A2.T5.9.m1.1.1.cmml"><msub id="A2.T5.9.m1.1.1.2" xref="A2.T5.9.m1.1.1.2.cmml"><mi id="A2.T5.9.m1.1.1.2.2" xref="A2.T5.9.m1.1.1.2.2.cmml">S</mi><mn id="A2.T5.9.m1.1.1.2.3" xref="A2.T5.9.m1.1.1.2.3.cmml">192</mn></msub><mo id="A2.T5.9.m1.1.1.1" xref="A2.T5.9.m1.1.1.1.cmml">+</mo><msub id="A2.T5.9.m1.1.1.3" xref="A2.T5.9.m1.1.1.3.cmml"><mi id="A2.T5.9.m1.1.1.3.2" xref="A2.T5.9.m1.1.1.3.2.cmml">L</mi><mn id="A2.T5.9.m1.1.1.3.3" xref="A2.T5.9.m1.1.1.3.3.cmml">32</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="A2.T5.9.m1.1c"><apply id="A2.T5.9.m1.1.1.cmml" xref="A2.T5.9.m1.1.1"><plus id="A2.T5.9.m1.1.1.1.cmml" xref="A2.T5.9.m1.1.1.1"></plus><apply id="A2.T5.9.m1.1.1.2.cmml" xref="A2.T5.9.m1.1.1.2"><csymbol cd="ambiguous" id="A2.T5.9.m1.1.1.2.1.cmml" xref="A2.T5.9.m1.1.1.2">subscript</csymbol><ci id="A2.T5.9.m1.1.1.2.2.cmml" xref="A2.T5.9.m1.1.1.2.2">𝑆</ci><cn id="A2.T5.9.m1.1.1.2.3.cmml" type="integer" xref="A2.T5.9.m1.1.1.2.3">192</cn></apply><apply id="A2.T5.9.m1.1.1.3.cmml" xref="A2.T5.9.m1.1.1.3"><csymbol cd="ambiguous" id="A2.T5.9.m1.1.1.3.1.cmml" xref="A2.T5.9.m1.1.1.3">subscript</csymbol><ci id="A2.T5.9.m1.1.1.3.2.cmml" xref="A2.T5.9.m1.1.1.3.2">𝐿</ci><cn id="A2.T5.9.m1.1.1.3.3.cmml" type="integer" xref="A2.T5.9.m1.1.1.3.3">32</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.9.m1.1d">S_{192}+L_{32}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.9.m1.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math>, <math alttext="S_{128}+L_{64}" class="ltx_Math" display="inline" id="A2.T5.10.m2.1"><semantics id="A2.T5.10.m2.1b"><mrow id="A2.T5.10.m2.1.1" xref="A2.T5.10.m2.1.1.cmml"><msub id="A2.T5.10.m2.1.1.2" xref="A2.T5.10.m2.1.1.2.cmml"><mi id="A2.T5.10.m2.1.1.2.2" xref="A2.T5.10.m2.1.1.2.2.cmml">S</mi><mn id="A2.T5.10.m2.1.1.2.3" xref="A2.T5.10.m2.1.1.2.3.cmml">128</mn></msub><mo id="A2.T5.10.m2.1.1.1" xref="A2.T5.10.m2.1.1.1.cmml">+</mo><msub id="A2.T5.10.m2.1.1.3" xref="A2.T5.10.m2.1.1.3.cmml"><mi id="A2.T5.10.m2.1.1.3.2" xref="A2.T5.10.m2.1.1.3.2.cmml">L</mi><mn id="A2.T5.10.m2.1.1.3.3" xref="A2.T5.10.m2.1.1.3.3.cmml">64</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="A2.T5.10.m2.1c"><apply id="A2.T5.10.m2.1.1.cmml" xref="A2.T5.10.m2.1.1"><plus id="A2.T5.10.m2.1.1.1.cmml" xref="A2.T5.10.m2.1.1.1"></plus><apply id="A2.T5.10.m2.1.1.2.cmml" xref="A2.T5.10.m2.1.1.2"><csymbol cd="ambiguous" id="A2.T5.10.m2.1.1.2.1.cmml" xref="A2.T5.10.m2.1.1.2">subscript</csymbol><ci id="A2.T5.10.m2.1.1.2.2.cmml" xref="A2.T5.10.m2.1.1.2.2">𝑆</ci><cn id="A2.T5.10.m2.1.1.2.3.cmml" type="integer" xref="A2.T5.10.m2.1.1.2.3">128</cn></apply><apply id="A2.T5.10.m2.1.1.3.cmml" xref="A2.T5.10.m2.1.1.3"><csymbol cd="ambiguous" id="A2.T5.10.m2.1.1.3.1.cmml" xref="A2.T5.10.m2.1.1.3">subscript</csymbol><ci id="A2.T5.10.m2.1.1.3.2.cmml" xref="A2.T5.10.m2.1.1.3.2">𝐿</ci><cn id="A2.T5.10.m2.1.1.3.3.cmml" type="integer" xref="A2.T5.10.m2.1.1.3.3">64</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.10.m2.1d">S_{128}+L_{64}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.10.m2.1e">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>, and <math alttext="S_{192}+L_{96}" class="ltx_Math" display="inline" id="A2.T5.11.m3.1"><semantics id="A2.T5.11.m3.1b"><mrow id="A2.T5.11.m3.1.1" xref="A2.T5.11.m3.1.1.cmml"><msub id="A2.T5.11.m3.1.1.2" xref="A2.T5.11.m3.1.1.2.cmml"><mi id="A2.T5.11.m3.1.1.2.2" xref="A2.T5.11.m3.1.1.2.2.cmml">S</mi><mn id="A2.T5.11.m3.1.1.2.3" xref="A2.T5.11.m3.1.1.2.3.cmml">192</mn></msub><mo id="A2.T5.11.m3.1.1.1" xref="A2.T5.11.m3.1.1.1.cmml">+</mo><msub id="A2.T5.11.m3.1.1.3" xref="A2.T5.11.m3.1.1.3.cmml"><mi id="A2.T5.11.m3.1.1.3.2" xref="A2.T5.11.m3.1.1.3.2.cmml">L</mi><mn id="A2.T5.11.m3.1.1.3.3" xref="A2.T5.11.m3.1.1.3.3.cmml">96</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="A2.T5.11.m3.1c"><apply id="A2.T5.11.m3.1.1.cmml" xref="A2.T5.11.m3.1.1"><plus id="A2.T5.11.m3.1.1.1.cmml" xref="A2.T5.11.m3.1.1.1"></plus><apply id="A2.T5.11.m3.1.1.2.cmml" xref="A2.T5.11.m3.1.1.2"><csymbol cd="ambiguous" id="A2.T5.11.m3.1.1.2.1.cmml" xref="A2.T5.11.m3.1.1.2">subscript</csymbol><ci id="A2.T5.11.m3.1.1.2.2.cmml" xref="A2.T5.11.m3.1.1.2.2">𝑆</ci><cn id="A2.T5.11.m3.1.1.2.3.cmml" type="integer" xref="A2.T5.11.m3.1.1.2.3">192</cn></apply><apply id="A2.T5.11.m3.1.1.3.cmml" xref="A2.T5.11.m3.1.1.3"><csymbol cd="ambiguous" id="A2.T5.11.m3.1.1.3.1.cmml" xref="A2.T5.11.m3.1.1.3">subscript</csymbol><ci id="A2.T5.11.m3.1.1.3.2.cmml" xref="A2.T5.11.m3.1.1.3.2">𝐿</ci><cn id="A2.T5.11.m3.1.1.3.3.cmml" type="integer" xref="A2.T5.11.m3.1.1.3.3">96</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.11.m3.1d">S_{192}+L_{96}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.11.m3.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>. For instance, <math alttext="S_{192}+L_{32}" class="ltx_Math" display="inline" id="A2.T5.12.m4.1"><semantics id="A2.T5.12.m4.1b"><mrow id="A2.T5.12.m4.1.1" xref="A2.T5.12.m4.1.1.cmml"><msub id="A2.T5.12.m4.1.1.2" xref="A2.T5.12.m4.1.1.2.cmml"><mi id="A2.T5.12.m4.1.1.2.2" xref="A2.T5.12.m4.1.1.2.2.cmml">S</mi><mn id="A2.T5.12.m4.1.1.2.3" xref="A2.T5.12.m4.1.1.2.3.cmml">192</mn></msub><mo id="A2.T5.12.m4.1.1.1" xref="A2.T5.12.m4.1.1.1.cmml">+</mo><msub id="A2.T5.12.m4.1.1.3" xref="A2.T5.12.m4.1.1.3.cmml"><mi id="A2.T5.12.m4.1.1.3.2" xref="A2.T5.12.m4.1.1.3.2.cmml">L</mi><mn id="A2.T5.12.m4.1.1.3.3" xref="A2.T5.12.m4.1.1.3.3.cmml">32</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="A2.T5.12.m4.1c"><apply id="A2.T5.12.m4.1.1.cmml" xref="A2.T5.12.m4.1.1"><plus id="A2.T5.12.m4.1.1.1.cmml" xref="A2.T5.12.m4.1.1.1"></plus><apply id="A2.T5.12.m4.1.1.2.cmml" xref="A2.T5.12.m4.1.1.2"><csymbol cd="ambiguous" id="A2.T5.12.m4.1.1.2.1.cmml" xref="A2.T5.12.m4.1.1.2">subscript</csymbol><ci id="A2.T5.12.m4.1.1.2.2.cmml" xref="A2.T5.12.m4.1.1.2.2">𝑆</ci><cn id="A2.T5.12.m4.1.1.2.3.cmml" type="integer" xref="A2.T5.12.m4.1.1.2.3">192</cn></apply><apply id="A2.T5.12.m4.1.1.3.cmml" xref="A2.T5.12.m4.1.1.3"><csymbol cd="ambiguous" id="A2.T5.12.m4.1.1.3.1.cmml" xref="A2.T5.12.m4.1.1.3">subscript</csymbol><ci id="A2.T5.12.m4.1.1.3.2.cmml" xref="A2.T5.12.m4.1.1.3.2">𝐿</ci><cn id="A2.T5.12.m4.1.1.3.3.cmml" type="integer" xref="A2.T5.12.m4.1.1.3.3">32</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.12.m4.1d">S_{192}+L_{32}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.12.m4.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math> indicates <math alttext="S=192" class="ltx_Math" display="inline" id="A2.T5.13.m5.1"><semantics id="A2.T5.13.m5.1b"><mrow id="A2.T5.13.m5.1.1" xref="A2.T5.13.m5.1.1.cmml"><mi id="A2.T5.13.m5.1.1.2" xref="A2.T5.13.m5.1.1.2.cmml">S</mi><mo id="A2.T5.13.m5.1.1.1" xref="A2.T5.13.m5.1.1.1.cmml">=</mo><mn id="A2.T5.13.m5.1.1.3" xref="A2.T5.13.m5.1.1.3.cmml">192</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.T5.13.m5.1c"><apply id="A2.T5.13.m5.1.1.cmml" xref="A2.T5.13.m5.1.1"><eq id="A2.T5.13.m5.1.1.1.cmml" xref="A2.T5.13.m5.1.1.1"></eq><ci id="A2.T5.13.m5.1.1.2.cmml" xref="A2.T5.13.m5.1.1.2">𝑆</ci><cn id="A2.T5.13.m5.1.1.3.cmml" type="integer" xref="A2.T5.13.m5.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.13.m5.1d">S=192</annotation><annotation encoding="application/x-llamapun" id="A2.T5.13.m5.1e">italic_S = 192</annotation></semantics></math> short-term and <math alttext="L=32" class="ltx_Math" display="inline" id="A2.T5.14.m6.1"><semantics id="A2.T5.14.m6.1b"><mrow id="A2.T5.14.m6.1.1" xref="A2.T5.14.m6.1.1.cmml"><mi id="A2.T5.14.m6.1.1.2" xref="A2.T5.14.m6.1.1.2.cmml">L</mi><mo id="A2.T5.14.m6.1.1.1" xref="A2.T5.14.m6.1.1.1.cmml">=</mo><mn id="A2.T5.14.m6.1.1.3" xref="A2.T5.14.m6.1.1.3.cmml">32</mn></mrow><annotation-xml encoding="MathML-Content" id="A2.T5.14.m6.1c"><apply id="A2.T5.14.m6.1.1.cmml" xref="A2.T5.14.m6.1.1"><eq id="A2.T5.14.m6.1.1.1.cmml" xref="A2.T5.14.m6.1.1.1"></eq><ci id="A2.T5.14.m6.1.1.2.cmml" xref="A2.T5.14.m6.1.1.2">𝐿</ci><cn id="A2.T5.14.m6.1.1.3.cmml" type="integer" xref="A2.T5.14.m6.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.14.m6.1d">L=32</annotation><annotation encoding="application/x-llamapun" id="A2.T5.14.m6.1e">italic_L = 32</annotation></semantics></math> long-term tokens per context window. All <span class="ltx_text ltx_font_smallcaps" id="A2.T5.36.3">Melodi</span> models utilized a long-term memory spanning 128 context windows.
<span class="ltx_text ltx_font_smallcaps" id="A2.T5.37.4">Melodi</span> <math alttext="S_{192}+L_{32}" class="ltx_Math" display="inline" id="A2.T5.15.m7.1"><semantics id="A2.T5.15.m7.1b"><mrow id="A2.T5.15.m7.1.1" xref="A2.T5.15.m7.1.1.cmml"><msub id="A2.T5.15.m7.1.1.2" xref="A2.T5.15.m7.1.1.2.cmml"><mi id="A2.T5.15.m7.1.1.2.2" xref="A2.T5.15.m7.1.1.2.2.cmml">S</mi><mn id="A2.T5.15.m7.1.1.2.3" xref="A2.T5.15.m7.1.1.2.3.cmml">192</mn></msub><mo id="A2.T5.15.m7.1.1.1" xref="A2.T5.15.m7.1.1.1.cmml">+</mo><msub id="A2.T5.15.m7.1.1.3" xref="A2.T5.15.m7.1.1.3.cmml"><mi id="A2.T5.15.m7.1.1.3.2" xref="A2.T5.15.m7.1.1.3.2.cmml">L</mi><mn id="A2.T5.15.m7.1.1.3.3" xref="A2.T5.15.m7.1.1.3.3.cmml">32</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="A2.T5.15.m7.1c"><apply id="A2.T5.15.m7.1.1.cmml" xref="A2.T5.15.m7.1.1"><plus id="A2.T5.15.m7.1.1.1.cmml" xref="A2.T5.15.m7.1.1.1"></plus><apply id="A2.T5.15.m7.1.1.2.cmml" xref="A2.T5.15.m7.1.1.2"><csymbol cd="ambiguous" id="A2.T5.15.m7.1.1.2.1.cmml" xref="A2.T5.15.m7.1.1.2">subscript</csymbol><ci id="A2.T5.15.m7.1.1.2.2.cmml" xref="A2.T5.15.m7.1.1.2.2">𝑆</ci><cn id="A2.T5.15.m7.1.1.2.3.cmml" type="integer" xref="A2.T5.15.m7.1.1.2.3">192</cn></apply><apply id="A2.T5.15.m7.1.1.3.cmml" xref="A2.T5.15.m7.1.1.3"><csymbol cd="ambiguous" id="A2.T5.15.m7.1.1.3.1.cmml" xref="A2.T5.15.m7.1.1.3">subscript</csymbol><ci id="A2.T5.15.m7.1.1.3.2.cmml" xref="A2.T5.15.m7.1.1.3.2">𝐿</ci><cn id="A2.T5.15.m7.1.1.3.3.cmml" type="integer" xref="A2.T5.15.m7.1.1.3.3">32</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.15.m7.1d">S_{192}+L_{32}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.15.m7.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math> outperformed Transformer XL and Block Recurrent Transformer while consuming less memory. Notably, <span class="ltx_text ltx_font_smallcaps" id="A2.T5.38.5">Melodi</span> <math alttext="S_{192}+L_{96}" class="ltx_Math" display="inline" id="A2.T5.16.m8.1"><semantics id="A2.T5.16.m8.1b"><mrow id="A2.T5.16.m8.1.1" xref="A2.T5.16.m8.1.1.cmml"><msub id="A2.T5.16.m8.1.1.2" xref="A2.T5.16.m8.1.1.2.cmml"><mi id="A2.T5.16.m8.1.1.2.2" xref="A2.T5.16.m8.1.1.2.2.cmml">S</mi><mn id="A2.T5.16.m8.1.1.2.3" xref="A2.T5.16.m8.1.1.2.3.cmml">192</mn></msub><mo id="A2.T5.16.m8.1.1.1" xref="A2.T5.16.m8.1.1.1.cmml">+</mo><msub id="A2.T5.16.m8.1.1.3" xref="A2.T5.16.m8.1.1.3.cmml"><mi id="A2.T5.16.m8.1.1.3.2" xref="A2.T5.16.m8.1.1.3.2.cmml">L</mi><mn id="A2.T5.16.m8.1.1.3.3" xref="A2.T5.16.m8.1.1.3.3.cmml">96</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="A2.T5.16.m8.1c"><apply id="A2.T5.16.m8.1.1.cmml" xref="A2.T5.16.m8.1.1"><plus id="A2.T5.16.m8.1.1.1.cmml" xref="A2.T5.16.m8.1.1.1"></plus><apply id="A2.T5.16.m8.1.1.2.cmml" xref="A2.T5.16.m8.1.1.2"><csymbol cd="ambiguous" id="A2.T5.16.m8.1.1.2.1.cmml" xref="A2.T5.16.m8.1.1.2">subscript</csymbol><ci id="A2.T5.16.m8.1.1.2.2.cmml" xref="A2.T5.16.m8.1.1.2.2">𝑆</ci><cn id="A2.T5.16.m8.1.1.2.3.cmml" type="integer" xref="A2.T5.16.m8.1.1.2.3">192</cn></apply><apply id="A2.T5.16.m8.1.1.3.cmml" xref="A2.T5.16.m8.1.1.3"><csymbol cd="ambiguous" id="A2.T5.16.m8.1.1.3.1.cmml" xref="A2.T5.16.m8.1.1.3">subscript</csymbol><ci id="A2.T5.16.m8.1.1.3.2.cmml" xref="A2.T5.16.m8.1.1.3.2">𝐿</ci><cn id="A2.T5.16.m8.1.1.3.3.cmml" type="integer" xref="A2.T5.16.m8.1.1.3.3">96</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.16.m8.1d">S_{192}+L_{96}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.16.m8.1e">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math> clearly surpassed Memorizing Transformer, using only a fifth of its memory.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A2.T5.28.12">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A2.T5.28.12.13.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_border_r" id="A2.T5.28.12.13.1.1" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.13.1.1.1">MODEL</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" colspan="3" id="A2.T5.28.12.13.1.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.13.1.2.1">MEMORY</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" colspan="3" id="A2.T5.28.12.13.1.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.13.1.3.1">PG19</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" colspan="2" id="A2.T5.28.12.13.1.4" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.13.1.4.1">arXiv</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A2.T5.28.12.13.1.5" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.13.1.5.1">C4(4K+)</span></th>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.14.2">
<th class="ltx_td ltx_th ltx_th_column ltx_border_r" id="A2.T5.28.12.14.2.1" style="padding-left:2.8pt;padding-right:2.8pt;"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A2.T5.28.12.14.2.2" style="padding-left:2.8pt;padding-right:2.8pt;">All</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A2.T5.28.12.14.2.3" style="padding-left:2.8pt;padding-right:2.8pt;">Short</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="A2.T5.28.12.14.2.4" style="padding-left:2.8pt;padding-right:2.8pt;">Long</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A2.T5.28.12.14.2.5" style="padding-left:2.8pt;padding-right:2.8pt;">Meena</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A2.T5.28.12.14.2.6" style="padding-left:2.8pt;padding-right:2.8pt;">T5</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" id="A2.T5.28.12.14.2.7" style="padding-left:2.8pt;padding-right:2.8pt;">Custom</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A2.T5.28.12.14.2.8" style="padding-left:2.8pt;padding-right:2.8pt;">Meena</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" id="A2.T5.28.12.14.2.9" style="padding-left:2.8pt;padding-right:2.8pt;">Custom</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A2.T5.28.12.14.2.10" style="padding-left:2.8pt;padding-right:2.8pt;">Custom</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A2.T5.28.12.15.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A2.T5.28.12.15.1.1" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.15.1.1.1">12 LAYERS</span></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.15.1.2" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.15.1.3" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_r ltx_border_t" id="A2.T5.28.12.15.1.4" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.15.1.5" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.15.1.6" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_r ltx_border_t" id="A2.T5.28.12.15.1.7" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.15.1.8" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_r ltx_border_t" id="A2.T5.28.12.15.1.9" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.15.1.10" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.16.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.28.12.16.2.1" style="padding-left:2.8pt;padding-right:2.8pt;">Transformer XL</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.16.2.2" style="padding-left:2.8pt;padding-right:2.8pt;">12.6M</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.16.2.3" style="padding-left:2.8pt;padding-right:2.8pt;">12.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.28.12.16.2.4" style="padding-left:2.8pt;padding-right:2.8pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.16.2.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.76</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.16.2.6" style="padding-left:2.8pt;padding-right:2.8pt;">11.54</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.16.2.7" style="padding-left:2.8pt;padding-right:2.8pt;">12.63</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.16.2.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.61</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.16.2.9" style="padding-left:2.8pt;padding-right:2.8pt;">3.23</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.16.2.10" style="padding-left:2.8pt;padding-right:2.8pt;">18.61</td>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.17.3">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.28.12.17.3.1" style="padding-left:2.8pt;padding-right:2.8pt;">Block Recurrent</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.17.3.2" style="padding-left:2.8pt;padding-right:2.8pt;">12.1M</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.17.3.3" style="padding-left:2.8pt;padding-right:2.8pt;">12.1M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.28.12.17.3.4" style="padding-left:2.8pt;padding-right:2.8pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.17.3.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.47</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.17.3.6" style="padding-left:2.8pt;padding-right:2.8pt;">11.12</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.17.3.7" style="padding-left:2.8pt;padding-right:2.8pt;">12.11</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.17.3.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.27</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.17.3.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.73</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.17.3.10" style="padding-left:2.8pt;padding-right:2.8pt;">18.27</td>
</tr>
<tr class="ltx_tr" id="A2.T5.18.2.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.18.2.2.2" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A2.T5.18.2.2.2.2">Melodi<span class="ltx_text ltx_font_upright" id="A2.T5.18.2.2.2.2.2"> <math alttext="S_{192}" class="ltx_Math" display="inline" id="A2.T5.17.1.1.1.1.1.m1.1"><semantics id="A2.T5.17.1.1.1.1.1.m1.1a"><msub id="A2.T5.17.1.1.1.1.1.m1.1.1" xref="A2.T5.17.1.1.1.1.1.m1.1.1.cmml"><mi id="A2.T5.17.1.1.1.1.1.m1.1.1.2" xref="A2.T5.17.1.1.1.1.1.m1.1.1.2.cmml">S</mi><mn id="A2.T5.17.1.1.1.1.1.m1.1.1.3" xref="A2.T5.17.1.1.1.1.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.17.1.1.1.1.1.m1.1b"><apply id="A2.T5.17.1.1.1.1.1.m1.1.1.cmml" xref="A2.T5.17.1.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A2.T5.17.1.1.1.1.1.m1.1.1.1.cmml" xref="A2.T5.17.1.1.1.1.1.m1.1.1">subscript</csymbol><ci id="A2.T5.17.1.1.1.1.1.m1.1.1.2.cmml" xref="A2.T5.17.1.1.1.1.1.m1.1.1.2">𝑆</ci><cn id="A2.T5.17.1.1.1.1.1.m1.1.1.3.cmml" type="integer" xref="A2.T5.17.1.1.1.1.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.17.1.1.1.1.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.17.1.1.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{32}" class="ltx_Math" display="inline" id="A2.T5.18.2.2.2.2.2.m2.1"><semantics id="A2.T5.18.2.2.2.2.2.m2.1a"><msub id="A2.T5.18.2.2.2.2.2.m2.1.1" xref="A2.T5.18.2.2.2.2.2.m2.1.1.cmml"><mi id="A2.T5.18.2.2.2.2.2.m2.1.1.2" xref="A2.T5.18.2.2.2.2.2.m2.1.1.2.cmml">L</mi><mn id="A2.T5.18.2.2.2.2.2.m2.1.1.3" xref="A2.T5.18.2.2.2.2.2.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.18.2.2.2.2.2.m2.1b"><apply id="A2.T5.18.2.2.2.2.2.m2.1.1.cmml" xref="A2.T5.18.2.2.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="A2.T5.18.2.2.2.2.2.m2.1.1.1.cmml" xref="A2.T5.18.2.2.2.2.2.m2.1.1">subscript</csymbol><ci id="A2.T5.18.2.2.2.2.2.m2.1.1.2.cmml" xref="A2.T5.18.2.2.2.2.2.m2.1.1.2">𝐿</ci><cn id="A2.T5.18.2.2.2.2.2.m2.1.1.3.cmml" type="integer" xref="A2.T5.18.2.2.2.2.2.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.18.2.2.2.2.2.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.18.2.2.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.18.2.2.3" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.18.2.2.3.1">10.8M</span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.18.2.2.4" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;">2.4M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.18.2.2.5" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;">8.4M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.18.2.2.6" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.18.2.2.6.1">8.22</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.18.2.2.7" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.18.2.2.7.1">10.66</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.18.2.2.8" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.18.2.2.8.1">11.66</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.18.2.2.9" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.18.2.2.9.1">2.13</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.18.2.2.10" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.18.2.2.10.1">2.55</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.18.2.2.11" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.18.2.2.11.1">18.03</span></td>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.18.4">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.28.12.18.4.1" style="padding-left:2.8pt;padding-right:2.8pt;">Memorizing Trans.</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.18.4.2" style="padding-left:2.8pt;padding-right:2.8pt;">146.8M</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.18.4.3" style="padding-left:2.8pt;padding-right:2.8pt;">12.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.28.12.18.4.4" style="padding-left:2.8pt;padding-right:2.8pt;">134.2M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.18.4.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.15</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.18.4.6" style="padding-left:2.8pt;padding-right:2.8pt;">10.74</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.18.4.7" style="padding-left:2.8pt;padding-right:2.8pt;">11.68</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.18.4.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.15</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.18.4.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.57</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.18.4.10" style="padding-left:2.8pt;padding-right:2.8pt;">17.88</td>
</tr>
<tr class="ltx_tr" id="A2.T5.20.4.4">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.20.4.4.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A2.T5.20.4.4.2.2">Melodi<span class="ltx_text ltx_font_upright" id="A2.T5.20.4.4.2.2.2"> <math alttext="S_{128}" class="ltx_Math" display="inline" id="A2.T5.19.3.3.1.1.1.m1.1"><semantics id="A2.T5.19.3.3.1.1.1.m1.1a"><msub id="A2.T5.19.3.3.1.1.1.m1.1.1" xref="A2.T5.19.3.3.1.1.1.m1.1.1.cmml"><mi id="A2.T5.19.3.3.1.1.1.m1.1.1.2" xref="A2.T5.19.3.3.1.1.1.m1.1.1.2.cmml">S</mi><mn id="A2.T5.19.3.3.1.1.1.m1.1.1.3" xref="A2.T5.19.3.3.1.1.1.m1.1.1.3.cmml">128</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.19.3.3.1.1.1.m1.1b"><apply id="A2.T5.19.3.3.1.1.1.m1.1.1.cmml" xref="A2.T5.19.3.3.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A2.T5.19.3.3.1.1.1.m1.1.1.1.cmml" xref="A2.T5.19.3.3.1.1.1.m1.1.1">subscript</csymbol><ci id="A2.T5.19.3.3.1.1.1.m1.1.1.2.cmml" xref="A2.T5.19.3.3.1.1.1.m1.1.1.2">𝑆</ci><cn id="A2.T5.19.3.3.1.1.1.m1.1.1.3.cmml" type="integer" xref="A2.T5.19.3.3.1.1.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.19.3.3.1.1.1.m1.1c">S_{128}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.19.3.3.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="A2.T5.20.4.4.2.2.2.m2.1"><semantics id="A2.T5.20.4.4.2.2.2.m2.1a"><msub id="A2.T5.20.4.4.2.2.2.m2.1.1" xref="A2.T5.20.4.4.2.2.2.m2.1.1.cmml"><mi id="A2.T5.20.4.4.2.2.2.m2.1.1.2" xref="A2.T5.20.4.4.2.2.2.m2.1.1.2.cmml">L</mi><mn id="A2.T5.20.4.4.2.2.2.m2.1.1.3" xref="A2.T5.20.4.4.2.2.2.m2.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.20.4.4.2.2.2.m2.1b"><apply id="A2.T5.20.4.4.2.2.2.m2.1.1.cmml" xref="A2.T5.20.4.4.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="A2.T5.20.4.4.2.2.2.m2.1.1.1.cmml" xref="A2.T5.20.4.4.2.2.2.m2.1.1">subscript</csymbol><ci id="A2.T5.20.4.4.2.2.2.m2.1.1.2.cmml" xref="A2.T5.20.4.4.2.2.2.m2.1.1.2">𝐿</ci><cn id="A2.T5.20.4.4.2.2.2.m2.1.1.3.cmml" type="integer" xref="A2.T5.20.4.4.2.2.2.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.20.4.4.2.2.2.m2.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.20.4.4.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.20.4.4.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.20.4.4.3.1">18.4M</span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.20.4.4.4" style="padding-left:2.8pt;padding-right:2.8pt;">1.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.20.4.4.5" style="padding-left:2.8pt;padding-right:2.8pt;">16.8M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.20.4.4.6" style="padding-left:2.8pt;padding-right:2.8pt;">8.16</td>
<td class="ltx_td ltx_align_center" id="A2.T5.20.4.4.7" style="padding-left:2.8pt;padding-right:2.8pt;">10.61</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.20.4.4.8" style="padding-left:2.8pt;padding-right:2.8pt;">11.66</td>
<td class="ltx_td ltx_align_center" id="A2.T5.20.4.4.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.13</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.20.4.4.10" style="padding-left:2.8pt;padding-right:2.8pt;">2.55</td>
<td class="ltx_td ltx_align_center" id="A2.T5.20.4.4.11" style="padding-left:2.8pt;padding-right:2.8pt;">18.01</td>
</tr>
<tr class="ltx_tr" id="A2.T5.22.6.6">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.22.6.6.2" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A2.T5.22.6.6.2.2">Melodi<span class="ltx_text ltx_font_upright" id="A2.T5.22.6.6.2.2.2"> <math alttext="S_{192}" class="ltx_Math" display="inline" id="A2.T5.21.5.5.1.1.1.m1.1"><semantics id="A2.T5.21.5.5.1.1.1.m1.1a"><msub id="A2.T5.21.5.5.1.1.1.m1.1.1" xref="A2.T5.21.5.5.1.1.1.m1.1.1.cmml"><mi id="A2.T5.21.5.5.1.1.1.m1.1.1.2" xref="A2.T5.21.5.5.1.1.1.m1.1.1.2.cmml">S</mi><mn id="A2.T5.21.5.5.1.1.1.m1.1.1.3" xref="A2.T5.21.5.5.1.1.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.21.5.5.1.1.1.m1.1b"><apply id="A2.T5.21.5.5.1.1.1.m1.1.1.cmml" xref="A2.T5.21.5.5.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A2.T5.21.5.5.1.1.1.m1.1.1.1.cmml" xref="A2.T5.21.5.5.1.1.1.m1.1.1">subscript</csymbol><ci id="A2.T5.21.5.5.1.1.1.m1.1.1.2.cmml" xref="A2.T5.21.5.5.1.1.1.m1.1.1.2">𝑆</ci><cn id="A2.T5.21.5.5.1.1.1.m1.1.1.3.cmml" type="integer" xref="A2.T5.21.5.5.1.1.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.21.5.5.1.1.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.21.5.5.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{96}" class="ltx_Math" display="inline" id="A2.T5.22.6.6.2.2.2.m2.1"><semantics id="A2.T5.22.6.6.2.2.2.m2.1a"><msub id="A2.T5.22.6.6.2.2.2.m2.1.1" xref="A2.T5.22.6.6.2.2.2.m2.1.1.cmml"><mi id="A2.T5.22.6.6.2.2.2.m2.1.1.2" xref="A2.T5.22.6.6.2.2.2.m2.1.1.2.cmml">L</mi><mn id="A2.T5.22.6.6.2.2.2.m2.1.1.3" xref="A2.T5.22.6.6.2.2.2.m2.1.1.3.cmml">96</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.22.6.6.2.2.2.m2.1b"><apply id="A2.T5.22.6.6.2.2.2.m2.1.1.cmml" xref="A2.T5.22.6.6.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="A2.T5.22.6.6.2.2.2.m2.1.1.1.cmml" xref="A2.T5.22.6.6.2.2.2.m2.1.1">subscript</csymbol><ci id="A2.T5.22.6.6.2.2.2.m2.1.1.2.cmml" xref="A2.T5.22.6.6.2.2.2.m2.1.1.2">𝐿</ci><cn id="A2.T5.22.6.6.2.2.2.m2.1.1.3.cmml" type="integer" xref="A2.T5.22.6.6.2.2.2.m2.1.1.3">96</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.22.6.6.2.2.2.m2.1c">L_{96}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.22.6.6.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.22.6.6.3" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;">27.6M</td>
<td class="ltx_td ltx_align_right" id="A2.T5.22.6.6.4" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;">2.4M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.22.6.6.5" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;">25.2M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.22.6.6.6" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.22.6.6.6.1">8.08</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.22.6.6.7" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.22.6.6.7.1">10.48</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.22.6.6.8" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.22.6.6.8.1">11.47</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.22.6.6.9" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.22.6.6.9.1">2.11</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.22.6.6.10" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.22.6.6.10.1">2.51</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.22.6.6.11" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.22.6.6.11.1">17.75</span></td>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.19.5">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A2.T5.28.12.19.5.1" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.19.5.1.1">13 LAYERS</span></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.19.5.2" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.19.5.3" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_r ltx_border_t" id="A2.T5.28.12.19.5.4" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.19.5.5" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.19.5.6" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_r ltx_border_t" id="A2.T5.28.12.19.5.7" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.19.5.8" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_r ltx_border_t" id="A2.T5.28.12.19.5.9" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
<td class="ltx_td ltx_border_t" id="A2.T5.28.12.19.5.10" style="padding-bottom:2.84526pt;padding-left:2.8pt;padding-right:2.8pt;"></td>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.20.6">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.28.12.20.6.1" style="padding-left:2.8pt;padding-right:2.8pt;">Transformer XL</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.20.6.2" style="padding-left:2.8pt;padding-right:2.8pt;">13.6M</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.20.6.3" style="padding-left:2.8pt;padding-right:2.8pt;">13.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.28.12.20.6.4" style="padding-left:2.8pt;padding-right:2.8pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.20.6.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.65</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.20.6.6" style="padding-left:2.8pt;padding-right:2.8pt;">11.41</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.20.6.7" style="padding-left:2.8pt;padding-right:2.8pt;">12.42</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.20.6.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.60</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.20.6.9" style="padding-left:2.8pt;padding-right:2.8pt;">3.22</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.20.6.10" style="padding-left:2.8pt;padding-right:2.8pt;">18.22</td>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.21.7">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.28.12.21.7.1" style="padding-left:2.8pt;padding-right:2.8pt;">Block Recurrent</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.21.7.2" style="padding-left:2.8pt;padding-right:2.8pt;">13.1M</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.21.7.3" style="padding-left:2.8pt;padding-right:2.8pt;">13.1M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.28.12.21.7.4" style="padding-left:2.8pt;padding-right:2.8pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.21.7.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.30</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.21.7.6" style="padding-left:2.8pt;padding-right:2.8pt;">10.98</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.21.7.7" style="padding-left:2.8pt;padding-right:2.8pt;">11.90</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.21.7.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.26</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.21.7.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.70</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.21.7.10" style="padding-left:2.8pt;padding-right:2.8pt;">17.82</td>
</tr>
<tr class="ltx_tr" id="A2.T5.24.8.8">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.24.8.8.2" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A2.T5.24.8.8.2.2">Melodi<span class="ltx_text ltx_font_upright" id="A2.T5.24.8.8.2.2.2"> <math alttext="S_{192}" class="ltx_Math" display="inline" id="A2.T5.23.7.7.1.1.1.m1.1"><semantics id="A2.T5.23.7.7.1.1.1.m1.1a"><msub id="A2.T5.23.7.7.1.1.1.m1.1.1" xref="A2.T5.23.7.7.1.1.1.m1.1.1.cmml"><mi id="A2.T5.23.7.7.1.1.1.m1.1.1.2" xref="A2.T5.23.7.7.1.1.1.m1.1.1.2.cmml">S</mi><mn id="A2.T5.23.7.7.1.1.1.m1.1.1.3" xref="A2.T5.23.7.7.1.1.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.23.7.7.1.1.1.m1.1b"><apply id="A2.T5.23.7.7.1.1.1.m1.1.1.cmml" xref="A2.T5.23.7.7.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A2.T5.23.7.7.1.1.1.m1.1.1.1.cmml" xref="A2.T5.23.7.7.1.1.1.m1.1.1">subscript</csymbol><ci id="A2.T5.23.7.7.1.1.1.m1.1.1.2.cmml" xref="A2.T5.23.7.7.1.1.1.m1.1.1.2">𝑆</ci><cn id="A2.T5.23.7.7.1.1.1.m1.1.1.3.cmml" type="integer" xref="A2.T5.23.7.7.1.1.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.23.7.7.1.1.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.23.7.7.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{32}" class="ltx_Math" display="inline" id="A2.T5.24.8.8.2.2.2.m2.1"><semantics id="A2.T5.24.8.8.2.2.2.m2.1a"><msub id="A2.T5.24.8.8.2.2.2.m2.1.1" xref="A2.T5.24.8.8.2.2.2.m2.1.1.cmml"><mi id="A2.T5.24.8.8.2.2.2.m2.1.1.2" xref="A2.T5.24.8.8.2.2.2.m2.1.1.2.cmml">L</mi><mn id="A2.T5.24.8.8.2.2.2.m2.1.1.3" xref="A2.T5.24.8.8.2.2.2.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.24.8.8.2.2.2.m2.1b"><apply id="A2.T5.24.8.8.2.2.2.m2.1.1.cmml" xref="A2.T5.24.8.8.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="A2.T5.24.8.8.2.2.2.m2.1.1.1.cmml" xref="A2.T5.24.8.8.2.2.2.m2.1.1">subscript</csymbol><ci id="A2.T5.24.8.8.2.2.2.m2.1.1.2.cmml" xref="A2.T5.24.8.8.2.2.2.m2.1.1.2">𝐿</ci><cn id="A2.T5.24.8.8.2.2.2.m2.1.1.3.cmml" type="integer" xref="A2.T5.24.8.8.2.2.2.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.24.8.8.2.2.2.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.24.8.8.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.24.8.8.3" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.24.8.8.3.1">11.0M</span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.24.8.8.4" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;">2.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.24.8.8.5" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;">8.4M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.24.8.8.6" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.24.8.8.6.1">8.08</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.24.8.8.7" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.24.8.8.7.1">10.51</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.24.8.8.8" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.24.8.8.8.1">11.47</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.24.8.8.9" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.24.8.8.9.1">2.12</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.24.8.8.10" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.24.8.8.10.1">2.54</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.24.8.8.11" style="padding-bottom:5.69054pt;padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.24.8.8.11.1">17.55</span></td>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.22.8">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.28.12.22.8.1" style="padding-left:2.8pt;padding-right:2.8pt;">Memorizing Trans.</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.22.8.2" style="padding-left:2.8pt;padding-right:2.8pt;">147.8M</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.22.8.3" style="padding-left:2.8pt;padding-right:2.8pt;">13.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.28.12.22.8.4" style="padding-left:2.8pt;padding-right:2.8pt;">134.2M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.22.8.5" style="padding-left:2.8pt;padding-right:2.8pt;">8.07</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.22.8.6" style="padding-left:2.8pt;padding-right:2.8pt;">10.62</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.22.8.7" style="padding-left:2.8pt;padding-right:2.8pt;">11.53</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.22.8.8" style="padding-left:2.8pt;padding-right:2.8pt;">2.14</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.22.8.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.56</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.22.8.10" style="padding-left:2.8pt;padding-right:2.8pt;">17.37</td>
</tr>
<tr class="ltx_tr" id="A2.T5.26.10.10">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.26.10.10.2" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A2.T5.26.10.10.2.2">Melodi<span class="ltx_text ltx_font_upright" id="A2.T5.26.10.10.2.2.2"> <math alttext="S_{128}" class="ltx_Math" display="inline" id="A2.T5.25.9.9.1.1.1.m1.1"><semantics id="A2.T5.25.9.9.1.1.1.m1.1a"><msub id="A2.T5.25.9.9.1.1.1.m1.1.1" xref="A2.T5.25.9.9.1.1.1.m1.1.1.cmml"><mi id="A2.T5.25.9.9.1.1.1.m1.1.1.2" xref="A2.T5.25.9.9.1.1.1.m1.1.1.2.cmml">S</mi><mn id="A2.T5.25.9.9.1.1.1.m1.1.1.3" xref="A2.T5.25.9.9.1.1.1.m1.1.1.3.cmml">128</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.25.9.9.1.1.1.m1.1b"><apply id="A2.T5.25.9.9.1.1.1.m1.1.1.cmml" xref="A2.T5.25.9.9.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A2.T5.25.9.9.1.1.1.m1.1.1.1.cmml" xref="A2.T5.25.9.9.1.1.1.m1.1.1">subscript</csymbol><ci id="A2.T5.25.9.9.1.1.1.m1.1.1.2.cmml" xref="A2.T5.25.9.9.1.1.1.m1.1.1.2">𝑆</ci><cn id="A2.T5.25.9.9.1.1.1.m1.1.1.3.cmml" type="integer" xref="A2.T5.25.9.9.1.1.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.25.9.9.1.1.1.m1.1c">S_{128}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.25.9.9.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="A2.T5.26.10.10.2.2.2.m2.1"><semantics id="A2.T5.26.10.10.2.2.2.m2.1a"><msub id="A2.T5.26.10.10.2.2.2.m2.1.1" xref="A2.T5.26.10.10.2.2.2.m2.1.1.cmml"><mi id="A2.T5.26.10.10.2.2.2.m2.1.1.2" xref="A2.T5.26.10.10.2.2.2.m2.1.1.2.cmml">L</mi><mn id="A2.T5.26.10.10.2.2.2.m2.1.1.3" xref="A2.T5.26.10.10.2.2.2.m2.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.26.10.10.2.2.2.m2.1b"><apply id="A2.T5.26.10.10.2.2.2.m2.1.1.cmml" xref="A2.T5.26.10.10.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="A2.T5.26.10.10.2.2.2.m2.1.1.1.cmml" xref="A2.T5.26.10.10.2.2.2.m2.1.1">subscript</csymbol><ci id="A2.T5.26.10.10.2.2.2.m2.1.1.2.cmml" xref="A2.T5.26.10.10.2.2.2.m2.1.1.2">𝐿</ci><cn id="A2.T5.26.10.10.2.2.2.m2.1.1.3.cmml" type="integer" xref="A2.T5.26.10.10.2.2.2.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.26.10.10.2.2.2.m2.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.26.10.10.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.26.10.10.3" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.26.10.10.3.1">18.5M</span></td>
<td class="ltx_td ltx_align_right" id="A2.T5.26.10.10.4" style="padding-left:2.8pt;padding-right:2.8pt;">1.7M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.26.10.10.5" style="padding-left:2.8pt;padding-right:2.8pt;">16.8M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.26.10.10.6" style="padding-left:2.8pt;padding-right:2.8pt;">8.06</td>
<td class="ltx_td ltx_align_center" id="A2.T5.26.10.10.7" style="padding-left:2.8pt;padding-right:2.8pt;">10.44</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.26.10.10.8" style="padding-left:2.8pt;padding-right:2.8pt;">11.42</td>
<td class="ltx_td ltx_align_center" id="A2.T5.26.10.10.9" style="padding-left:2.8pt;padding-right:2.8pt;">2.11</td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.26.10.10.10" style="padding-left:2.8pt;padding-right:2.8pt;">2.52</td>
<td class="ltx_td ltx_align_center" id="A2.T5.26.10.10.11" style="padding-left:2.8pt;padding-right:2.8pt;">17.53</td>
</tr>
<tr class="ltx_tr" id="A2.T5.28.12.12">
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T5.28.12.12.2" style="padding-left:2.8pt;padding-right:2.8pt;">
<span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A2.T5.28.12.12.2.1">Melodi</span> <math alttext="S_{192}" class="ltx_Math" display="inline" id="A2.T5.27.11.11.1.m1.1"><semantics id="A2.T5.27.11.11.1.m1.1a"><msub id="A2.T5.27.11.11.1.m1.1.1" xref="A2.T5.27.11.11.1.m1.1.1.cmml"><mi id="A2.T5.27.11.11.1.m1.1.1.2" xref="A2.T5.27.11.11.1.m1.1.1.2.cmml">S</mi><mn id="A2.T5.27.11.11.1.m1.1.1.3" xref="A2.T5.27.11.11.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.27.11.11.1.m1.1b"><apply id="A2.T5.27.11.11.1.m1.1.1.cmml" xref="A2.T5.27.11.11.1.m1.1.1"><csymbol cd="ambiguous" id="A2.T5.27.11.11.1.m1.1.1.1.cmml" xref="A2.T5.27.11.11.1.m1.1.1">subscript</csymbol><ci id="A2.T5.27.11.11.1.m1.1.1.2.cmml" xref="A2.T5.27.11.11.1.m1.1.1.2">𝑆</ci><cn id="A2.T5.27.11.11.1.m1.1.1.3.cmml" type="integer" xref="A2.T5.27.11.11.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.27.11.11.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.27.11.11.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{96}" class="ltx_Math" display="inline" id="A2.T5.28.12.12.2.m2.1"><semantics id="A2.T5.28.12.12.2.m2.1a"><msub id="A2.T5.28.12.12.2.m2.1.1" xref="A2.T5.28.12.12.2.m2.1.1.cmml"><mi id="A2.T5.28.12.12.2.m2.1.1.2" xref="A2.T5.28.12.12.2.m2.1.1.2.cmml">L</mi><mn id="A2.T5.28.12.12.2.m2.1.1.3" xref="A2.T5.28.12.12.2.m2.1.1.3.cmml">96</mn></msub><annotation-xml encoding="MathML-Content" id="A2.T5.28.12.12.2.m2.1b"><apply id="A2.T5.28.12.12.2.m2.1.1.cmml" xref="A2.T5.28.12.12.2.m2.1.1"><csymbol cd="ambiguous" id="A2.T5.28.12.12.2.m2.1.1.1.cmml" xref="A2.T5.28.12.12.2.m2.1.1">subscript</csymbol><ci id="A2.T5.28.12.12.2.m2.1.1.2.cmml" xref="A2.T5.28.12.12.2.m2.1.1.2">𝐿</ci><cn id="A2.T5.28.12.12.2.m2.1.1.3.cmml" type="integer" xref="A2.T5.28.12.12.2.m2.1.1.3">96</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.T5.28.12.12.2.m2.1c">L_{96}</annotation><annotation encoding="application/x-llamapun" id="A2.T5.28.12.12.2.m2.1d">italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.12.3" style="padding-left:2.8pt;padding-right:2.8pt;">27.8M</td>
<td class="ltx_td ltx_align_right" id="A2.T5.28.12.12.4" style="padding-left:2.8pt;padding-right:2.8pt;">2.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T5.28.12.12.5" style="padding-left:2.8pt;padding-right:2.8pt;">25.2M</td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.12.6" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.12.6.1">7.91</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.12.7" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.12.7.1">10.29</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.12.8" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.12.8.1">11.27</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.12.9" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.12.9.1">2.09</span></td>
<td class="ltx_td ltx_align_center ltx_border_r" id="A2.T5.28.12.12.10" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.12.10.1">2.49</span></td>
<td class="ltx_td ltx_align_center" id="A2.T5.28.12.12.11" style="padding-left:2.8pt;padding-right:2.8pt;"><span class="ltx_text ltx_font_bold" id="A2.T5.28.12.12.11.1">17.25</span></td>
</tr>
</tbody>
</table>
</figure>
</section>
<section class="ltx_appendix" id="A3">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix C </span>More Comparison with Baselines</h2>
<div class="ltx_para ltx_noindent" id="A3.p1">
<p class="ltx_p" id="A3.p1.1"><span class="ltx_text ltx_font_bold" id="A3.p1.1.1">Comparison with baselines using a fixed context window size:</span>
Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A2.T5" title="Table 5 ‣ Appendix B Training Details ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">5</span></a> presents a comparison of <span class="ltx_text ltx_font_smallcaps" id="A3.p1.1.2">Melodi</span> against three baseline models (Transformer XL, Block Recurrent Transformer, and Memorizing Transformer) across three datasets, using a consistent segment length of 4096 tokens and a context window size of 512. The evaluation includes both 12-layer and 13-layer transformer architectures to assess the impact of model depth on performance.</p>
</div>
<div class="ltx_para ltx_noindent" id="A3.p2">
<p class="ltx_p" id="A3.p2.4">Notably, even with fewer layers, <span class="ltx_text ltx_font_smallcaps" id="A3.p2.4.1">Melodi</span> <math alttext="S_{192}" class="ltx_Math" display="inline" id="A3.p2.1.m1.1"><semantics id="A3.p2.1.m1.1a"><msub id="A3.p2.1.m1.1.1" xref="A3.p2.1.m1.1.1.cmml"><mi id="A3.p2.1.m1.1.1.2" xref="A3.p2.1.m1.1.1.2.cmml">S</mi><mn id="A3.p2.1.m1.1.1.3" xref="A3.p2.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="A3.p2.1.m1.1b"><apply id="A3.p2.1.m1.1.1.cmml" xref="A3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="A3.p2.1.m1.1.1.1.cmml" xref="A3.p2.1.m1.1.1">subscript</csymbol><ci id="A3.p2.1.m1.1.1.2.cmml" xref="A3.p2.1.m1.1.1.2">𝑆</ci><cn id="A3.p2.1.m1.1.1.3.cmml" type="integer" xref="A3.p2.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.p2.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="A3.p2.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{32}" class="ltx_Math" display="inline" id="A3.p2.2.m2.1"><semantics id="A3.p2.2.m2.1a"><msub id="A3.p2.2.m2.1.1" xref="A3.p2.2.m2.1.1.cmml"><mi id="A3.p2.2.m2.1.1.2" xref="A3.p2.2.m2.1.1.2.cmml">L</mi><mn id="A3.p2.2.m2.1.1.3" xref="A3.p2.2.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="A3.p2.2.m2.1b"><apply id="A3.p2.2.m2.1.1.cmml" xref="A3.p2.2.m2.1.1"><csymbol cd="ambiguous" id="A3.p2.2.m2.1.1.1.cmml" xref="A3.p2.2.m2.1.1">subscript</csymbol><ci id="A3.p2.2.m2.1.1.2.cmml" xref="A3.p2.2.m2.1.1.2">𝐿</ci><cn id="A3.p2.2.m2.1.1.3.cmml" type="integer" xref="A3.p2.2.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.p2.2.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="A3.p2.2.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math> consistently outperforms both Transformer XL and Block Recurrent Transformer across all datasets while consuming less memory. For instance, the 12-layer variant of <span class="ltx_text ltx_font_smallcaps" id="A3.p2.4.2">Melodi</span> <math alttext="S_{192}" class="ltx_Math" display="inline" id="A3.p2.3.m3.1"><semantics id="A3.p2.3.m3.1a"><msub id="A3.p2.3.m3.1.1" xref="A3.p2.3.m3.1.1.cmml"><mi id="A3.p2.3.m3.1.1.2" xref="A3.p2.3.m3.1.1.2.cmml">S</mi><mn id="A3.p2.3.m3.1.1.3" xref="A3.p2.3.m3.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="A3.p2.3.m3.1b"><apply id="A3.p2.3.m3.1.1.cmml" xref="A3.p2.3.m3.1.1"><csymbol cd="ambiguous" id="A3.p2.3.m3.1.1.1.cmml" xref="A3.p2.3.m3.1.1">subscript</csymbol><ci id="A3.p2.3.m3.1.1.2.cmml" xref="A3.p2.3.m3.1.1.2">𝑆</ci><cn id="A3.p2.3.m3.1.1.3.cmml" type="integer" xref="A3.p2.3.m3.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.p2.3.m3.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="A3.p2.3.m3.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{32}" class="ltx_Math" display="inline" id="A3.p2.4.m4.1"><semantics id="A3.p2.4.m4.1a"><msub id="A3.p2.4.m4.1.1" xref="A3.p2.4.m4.1.1.cmml"><mi id="A3.p2.4.m4.1.1.2" xref="A3.p2.4.m4.1.1.2.cmml">L</mi><mn id="A3.p2.4.m4.1.1.3" xref="A3.p2.4.m4.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="A3.p2.4.m4.1b"><apply id="A3.p2.4.m4.1.1.cmml" xref="A3.p2.4.m4.1.1"><csymbol cd="ambiguous" id="A3.p2.4.m4.1.1.1.cmml" xref="A3.p2.4.m4.1.1">subscript</csymbol><ci id="A3.p2.4.m4.1.1.2.cmml" xref="A3.p2.4.m4.1.1.2">𝐿</ci><cn id="A3.p2.4.m4.1.1.3.cmml" type="integer" xref="A3.p2.4.m4.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.p2.4.m4.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="A3.p2.4.m4.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math> achieves a perplexity of 10.66 on PG-19 (T5 vocabulary), surpassing the 13-layer variants of Transformer XL (11.41) and Block Recurrent Transformer (10.98).</p>
</div>
<div class="ltx_para ltx_noindent" id="A3.p3">
<p class="ltx_p" id="A3.p3.2">In comparison to the Memorizing Transformer, <span class="ltx_text ltx_font_smallcaps" id="A3.p3.2.1">Melodi</span> <math alttext="S_{128}+L_{64}" class="ltx_Math" display="inline" id="A3.p3.1.m1.1"><semantics id="A3.p3.1.m1.1a"><mrow id="A3.p3.1.m1.1.1" xref="A3.p3.1.m1.1.1.cmml"><msub id="A3.p3.1.m1.1.1.2" xref="A3.p3.1.m1.1.1.2.cmml"><mi id="A3.p3.1.m1.1.1.2.2" xref="A3.p3.1.m1.1.1.2.2.cmml">S</mi><mn id="A3.p3.1.m1.1.1.2.3" xref="A3.p3.1.m1.1.1.2.3.cmml">128</mn></msub><mo id="A3.p3.1.m1.1.1.1" xref="A3.p3.1.m1.1.1.1.cmml">+</mo><msub id="A3.p3.1.m1.1.1.3" xref="A3.p3.1.m1.1.1.3.cmml"><mi id="A3.p3.1.m1.1.1.3.2" xref="A3.p3.1.m1.1.1.3.2.cmml">L</mi><mn id="A3.p3.1.m1.1.1.3.3" xref="A3.p3.1.m1.1.1.3.3.cmml">64</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="A3.p3.1.m1.1b"><apply id="A3.p3.1.m1.1.1.cmml" xref="A3.p3.1.m1.1.1"><plus id="A3.p3.1.m1.1.1.1.cmml" xref="A3.p3.1.m1.1.1.1"></plus><apply id="A3.p3.1.m1.1.1.2.cmml" xref="A3.p3.1.m1.1.1.2"><csymbol cd="ambiguous" id="A3.p3.1.m1.1.1.2.1.cmml" xref="A3.p3.1.m1.1.1.2">subscript</csymbol><ci id="A3.p3.1.m1.1.1.2.2.cmml" xref="A3.p3.1.m1.1.1.2.2">𝑆</ci><cn id="A3.p3.1.m1.1.1.2.3.cmml" type="integer" xref="A3.p3.1.m1.1.1.2.3">128</cn></apply><apply id="A3.p3.1.m1.1.1.3.cmml" xref="A3.p3.1.m1.1.1.3"><csymbol cd="ambiguous" id="A3.p3.1.m1.1.1.3.1.cmml" xref="A3.p3.1.m1.1.1.3">subscript</csymbol><ci id="A3.p3.1.m1.1.1.3.2.cmml" xref="A3.p3.1.m1.1.1.3.2">𝐿</ci><cn id="A3.p3.1.m1.1.1.3.3.cmml" type="integer" xref="A3.p3.1.m1.1.1.3.3">64</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.p3.1.m1.1c">S_{128}+L_{64}</annotation><annotation encoding="application/x-llamapun" id="A3.p3.1.m1.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math> exhibits slightly improved performance while dramatically reducing memory consumption by a factor of 8. Furthermore, <span class="ltx_text ltx_font_smallcaps" id="A3.p3.2.2">Melodi</span> <math alttext="S_{192}+L_{96}" class="ltx_Math" display="inline" id="A3.p3.2.m2.1"><semantics id="A3.p3.2.m2.1a"><mrow id="A3.p3.2.m2.1.1" xref="A3.p3.2.m2.1.1.cmml"><msub id="A3.p3.2.m2.1.1.2" xref="A3.p3.2.m2.1.1.2.cmml"><mi id="A3.p3.2.m2.1.1.2.2" xref="A3.p3.2.m2.1.1.2.2.cmml">S</mi><mn id="A3.p3.2.m2.1.1.2.3" xref="A3.p3.2.m2.1.1.2.3.cmml">192</mn></msub><mo id="A3.p3.2.m2.1.1.1" xref="A3.p3.2.m2.1.1.1.cmml">+</mo><msub id="A3.p3.2.m2.1.1.3" xref="A3.p3.2.m2.1.1.3.cmml"><mi id="A3.p3.2.m2.1.1.3.2" xref="A3.p3.2.m2.1.1.3.2.cmml">L</mi><mn id="A3.p3.2.m2.1.1.3.3" xref="A3.p3.2.m2.1.1.3.3.cmml">96</mn></msub></mrow><annotation-xml encoding="MathML-Content" id="A3.p3.2.m2.1b"><apply id="A3.p3.2.m2.1.1.cmml" xref="A3.p3.2.m2.1.1"><plus id="A3.p3.2.m2.1.1.1.cmml" xref="A3.p3.2.m2.1.1.1"></plus><apply id="A3.p3.2.m2.1.1.2.cmml" xref="A3.p3.2.m2.1.1.2"><csymbol cd="ambiguous" id="A3.p3.2.m2.1.1.2.1.cmml" xref="A3.p3.2.m2.1.1.2">subscript</csymbol><ci id="A3.p3.2.m2.1.1.2.2.cmml" xref="A3.p3.2.m2.1.1.2.2">𝑆</ci><cn id="A3.p3.2.m2.1.1.2.3.cmml" type="integer" xref="A3.p3.2.m2.1.1.2.3">192</cn></apply><apply id="A3.p3.2.m2.1.1.3.cmml" xref="A3.p3.2.m2.1.1.3"><csymbol cd="ambiguous" id="A3.p3.2.m2.1.1.3.1.cmml" xref="A3.p3.2.m2.1.1.3">subscript</csymbol><ci id="A3.p3.2.m2.1.1.3.2.cmml" xref="A3.p3.2.m2.1.1.3.2">𝐿</ci><cn id="A3.p3.2.m2.1.1.3.3.cmml" type="integer" xref="A3.p3.2.m2.1.1.3.3">96</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.p3.2.m2.1c">S_{192}+L_{96}</annotation><annotation encoding="application/x-llamapun" id="A3.p3.2.m2.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT + italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math> achieves even better perplexity scores across all datasets with a substantial reduction in memory usage exceeding a factor of 5. The improvement is consistent for using both 12-layer and 13-layer transformer architectures. These results collectively highlight <span class="ltx_text ltx_font_smallcaps" id="A3.p3.2.3">Melodi</span>’s efficacy and efficiency as a memory architecture for language models.</p>
</div>
<div class="ltx_para ltx_noindent" id="A3.p4">
<p class="ltx_p" id="A3.p4.1"><span class="ltx_text ltx_font_bold" id="A3.p4.1.1">Comparison with baselines that utilize longer context windows:</span>
Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A3.T6" title="Table 6 ‣ Appendix C More Comparison with Baselines ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">6</span></a> demonstrates that on PG-19 (T5 vocabulary), <span class="ltx_text ltx_font_smallcaps" id="A3.p4.1.2">Melodi</span> (with a context window size of 512 tokens) outperforms three baselines even when they utilize longer context windows (1024 and 2048 tokens), further highlighting its effectiveness and efficiency in processing long sequences. While the baselines generally exhibit improved performance with increasing context window size, Memorizing Transformer shows instability with a 2048-token window. We hypothesize that this instability stems from the limited backpropagation through time (BPTT) depth (two windows) within each segment (4096 tokens).</p>
</div>
<figure class="ltx_table" id="A3.T6">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 6: </span><span class="ltx_text ltx_font_bold" id="A3.T6.10.1">Comparisons with baselines that utilize longer context windows</span>.
<span class="ltx_text ltx_font_smallcaps" id="A3.T6.11.2">Melodi</span>, with a context window size of 512, outperforms three baselines (i.e., Transformer XL, Block Recurrent Transformer and Memorizing Transformer) even when they utilize longer context windows (1024 and 2048 tokens). This highlights <span class="ltx_text ltx_font_smallcaps" id="A3.T6.12.3">Melodi</span>’s effectiveness in processing long sequences despite using shorter context windows.
</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A3.T6.6.6">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A3.T6.6.6.7.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" id="A3.T6.6.6.7.1.1" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.6.6.7.1.1.1">MODEL</span></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A3.T6.6.6.7.1.2" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.6.6.7.1.2.1">Segment</span></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="A3.T6.6.6.7.1.3" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.6.6.7.1.3.1">Window</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r" colspan="3" id="A3.T6.6.6.7.1.4" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.6.6.7.1.4.1">MEMORY</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T6.6.6.7.1.5" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.6.6.7.1.5.1">PG19</span></th>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.8.2">
<th class="ltx_td ltx_th ltx_th_column ltx_border_r" id="A3.T6.6.6.8.2.1" style="padding-left:5.7pt;padding-right:5.7pt;"></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A3.T6.6.6.8.2.2" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.6.6.8.2.2.1">Length</span></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="A3.T6.6.6.8.2.3" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.6.6.8.2.3.1">Length</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T6.6.6.8.2.4" style="padding-left:5.7pt;padding-right:5.7pt;">All</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T6.6.6.8.2.5" style="padding-left:5.7pt;padding-right:5.7pt;">Short</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="A3.T6.6.6.8.2.6" style="padding-left:5.7pt;padding-right:5.7pt;">Long</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T6.6.6.8.2.7" style="padding-left:5.7pt;padding-right:5.7pt;">T5</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A3.T6.6.6.9.1">
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A3.T6.6.6.9.1.1" style="padding-left:5.7pt;padding-right:5.7pt;">Transformer XL</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A3.T6.6.6.9.1.2" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A3.T6.6.6.9.1.3" style="padding-left:5.7pt;padding-right:5.7pt;">512</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A3.T6.6.6.9.1.4" style="padding-left:5.7pt;padding-right:5.7pt;">13.6M</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A3.T6.6.6.9.1.5" style="padding-left:5.7pt;padding-right:5.7pt;">13.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A3.T6.6.6.9.1.6" style="padding-left:5.7pt;padding-right:5.7pt;">0M</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T6.6.6.9.1.7" style="padding-left:5.7pt;padding-right:5.7pt;">11.41</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.10.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.10.2.1" style="padding-left:5.7pt;padding-right:5.7pt;">Transformer XL</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.10.2.2" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.10.2.3" style="padding-left:5.7pt;padding-right:5.7pt;">1024</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.10.2.4" style="padding-left:5.7pt;padding-right:5.7pt;">27.3M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.10.2.5" style="padding-left:5.7pt;padding-right:5.7pt;">27.3M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.10.2.6" style="padding-left:5.7pt;padding-right:5.7pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.10.2.7" style="padding-left:5.7pt;padding-right:5.7pt;">11.11</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.11.3">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.11.3.1" style="padding-left:5.7pt;padding-right:5.7pt;">Transformer XL</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.11.3.2" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.11.3.3" style="padding-left:5.7pt;padding-right:5.7pt;">2048</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.11.3.4" style="padding-left:5.7pt;padding-right:5.7pt;">54.5M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.11.3.5" style="padding-left:5.7pt;padding-right:5.7pt;">54.5M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.11.3.6" style="padding-left:5.7pt;padding-right:5.7pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.11.3.7" style="padding-left:5.7pt;padding-right:5.7pt;">10.99</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.12.4">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.12.4.1" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">Transformer XL</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.12.4.2" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">6144</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.12.4.3" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">3072</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.12.4.4" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">81.8M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.12.4.5" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">81.8M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.12.4.6" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.12.4.7" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">10.96</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.13.5">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.13.5.1" style="padding-left:5.7pt;padding-right:5.7pt;">Block Recurrent</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.13.5.2" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.13.5.3" style="padding-left:5.7pt;padding-right:5.7pt;">512</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.13.5.4" style="padding-left:5.7pt;padding-right:5.7pt;">13.1M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.13.5.5" style="padding-left:5.7pt;padding-right:5.7pt;">13.1M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.13.5.6" style="padding-left:5.7pt;padding-right:5.7pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.13.5.7" style="padding-left:5.7pt;padding-right:5.7pt;">10.98</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.14.6">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.14.6.1" style="padding-left:5.7pt;padding-right:5.7pt;">Block Recurrent</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.14.6.2" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.14.6.3" style="padding-left:5.7pt;padding-right:5.7pt;">1024</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.14.6.4" style="padding-left:5.7pt;padding-right:5.7pt;">25.7M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.14.6.5" style="padding-left:5.7pt;padding-right:5.7pt;">25.7M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.14.6.6" style="padding-left:5.7pt;padding-right:5.7pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.14.6.7" style="padding-left:5.7pt;padding-right:5.7pt;">10.91</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.15.7">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.15.7.1" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">Block Recurrent</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.15.7.2" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.15.7.3" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">2048</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.15.7.4" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">50.9M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.15.7.5" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">50.9M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.15.7.6" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">0M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.15.7.7" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">10.88</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.16.8">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.16.8.1" style="padding-left:5.7pt;padding-right:5.7pt;">Memorizing Trans.</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.16.8.2" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.16.8.3" style="padding-left:5.7pt;padding-right:5.7pt;">512</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.16.8.4" style="padding-left:5.7pt;padding-right:5.7pt;">147.8M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.16.8.5" style="padding-left:5.7pt;padding-right:5.7pt;">13.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.16.8.6" style="padding-left:5.7pt;padding-right:5.7pt;">134.2M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.16.8.7" style="padding-left:5.7pt;padding-right:5.7pt;">10.62</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.17.9">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.17.9.1" style="padding-left:5.7pt;padding-right:5.7pt;">Memorizing Trans.</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.17.9.2" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.17.9.3" style="padding-left:5.7pt;padding-right:5.7pt;">1024</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.17.9.4" style="padding-left:5.7pt;padding-right:5.7pt;">161.5M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.17.9.5" style="padding-left:5.7pt;padding-right:5.7pt;">27.3M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.17.9.6" style="padding-left:5.7pt;padding-right:5.7pt;">134.2M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.17.9.7" style="padding-left:5.7pt;padding-right:5.7pt;">10.53</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.18.10">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.18.10.1" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">Memorizing Trans.</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.18.10.2" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.18.10.3" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">2048</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.18.10.4" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">188.7M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.18.10.5" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">54.5M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.18.10.6" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">134.2M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.18.10.7" style="padding-bottom:5.69054pt;padding-left:5.7pt;padding-right:5.7pt;">not stable</td>
</tr>
<tr class="ltx_tr" id="A3.T6.2.2.2">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.2.2.2.2" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A3.T6.2.2.2.2.2">Melodi<span class="ltx_text ltx_font_upright" id="A3.T6.2.2.2.2.2.2"> <math alttext="S_{192}" class="ltx_Math" display="inline" id="A3.T6.1.1.1.1.1.1.m1.1"><semantics id="A3.T6.1.1.1.1.1.1.m1.1a"><msub id="A3.T6.1.1.1.1.1.1.m1.1.1" xref="A3.T6.1.1.1.1.1.1.m1.1.1.cmml"><mi id="A3.T6.1.1.1.1.1.1.m1.1.1.2" xref="A3.T6.1.1.1.1.1.1.m1.1.1.2.cmml">S</mi><mn id="A3.T6.1.1.1.1.1.1.m1.1.1.3" xref="A3.T6.1.1.1.1.1.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T6.1.1.1.1.1.1.m1.1b"><apply id="A3.T6.1.1.1.1.1.1.m1.1.1.cmml" xref="A3.T6.1.1.1.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A3.T6.1.1.1.1.1.1.m1.1.1.1.cmml" xref="A3.T6.1.1.1.1.1.1.m1.1.1">subscript</csymbol><ci id="A3.T6.1.1.1.1.1.1.m1.1.1.2.cmml" xref="A3.T6.1.1.1.1.1.1.m1.1.1.2">𝑆</ci><cn id="A3.T6.1.1.1.1.1.1.m1.1.1.3.cmml" type="integer" xref="A3.T6.1.1.1.1.1.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T6.1.1.1.1.1.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="A3.T6.1.1.1.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{32}" class="ltx_Math" display="inline" id="A3.T6.2.2.2.2.2.2.m2.1"><semantics id="A3.T6.2.2.2.2.2.2.m2.1a"><msub id="A3.T6.2.2.2.2.2.2.m2.1.1" xref="A3.T6.2.2.2.2.2.2.m2.1.1.cmml"><mi id="A3.T6.2.2.2.2.2.2.m2.1.1.2" xref="A3.T6.2.2.2.2.2.2.m2.1.1.2.cmml">L</mi><mn id="A3.T6.2.2.2.2.2.2.m2.1.1.3" xref="A3.T6.2.2.2.2.2.2.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T6.2.2.2.2.2.2.m2.1b"><apply id="A3.T6.2.2.2.2.2.2.m2.1.1.cmml" xref="A3.T6.2.2.2.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="A3.T6.2.2.2.2.2.2.m2.1.1.1.cmml" xref="A3.T6.2.2.2.2.2.2.m2.1.1">subscript</csymbol><ci id="A3.T6.2.2.2.2.2.2.m2.1.1.2.cmml" xref="A3.T6.2.2.2.2.2.2.m2.1.1.2">𝐿</ci><cn id="A3.T6.2.2.2.2.2.2.m2.1.1.3.cmml" type="integer" xref="A3.T6.2.2.2.2.2.2.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T6.2.2.2.2.2.2.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="A3.T6.2.2.2.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="A3.T6.2.2.2.3" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.2.2.2.4" style="padding-left:5.7pt;padding-right:5.7pt;">512</td>
<td class="ltx_td ltx_align_right" id="A3.T6.2.2.2.5" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.2.2.2.5.1">11.0M</span></td>
<td class="ltx_td ltx_align_right" id="A3.T6.2.2.2.6" style="padding-left:5.7pt;padding-right:5.7pt;">2.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.2.2.2.7" style="padding-left:5.7pt;padding-right:5.7pt;">8.4M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.2.2.2.8" style="padding-left:5.7pt;padding-right:5.7pt;">10.51</td>
</tr>
<tr class="ltx_tr" id="A3.T6.4.4.4">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.4.4.4.2" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A3.T6.4.4.4.2.2">Melodi<span class="ltx_text ltx_font_upright" id="A3.T6.4.4.4.2.2.2"> <math alttext="S_{128}" class="ltx_Math" display="inline" id="A3.T6.3.3.3.1.1.1.m1.1"><semantics id="A3.T6.3.3.3.1.1.1.m1.1a"><msub id="A3.T6.3.3.3.1.1.1.m1.1.1" xref="A3.T6.3.3.3.1.1.1.m1.1.1.cmml"><mi id="A3.T6.3.3.3.1.1.1.m1.1.1.2" xref="A3.T6.3.3.3.1.1.1.m1.1.1.2.cmml">S</mi><mn id="A3.T6.3.3.3.1.1.1.m1.1.1.3" xref="A3.T6.3.3.3.1.1.1.m1.1.1.3.cmml">128</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T6.3.3.3.1.1.1.m1.1b"><apply id="A3.T6.3.3.3.1.1.1.m1.1.1.cmml" xref="A3.T6.3.3.3.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A3.T6.3.3.3.1.1.1.m1.1.1.1.cmml" xref="A3.T6.3.3.3.1.1.1.m1.1.1">subscript</csymbol><ci id="A3.T6.3.3.3.1.1.1.m1.1.1.2.cmml" xref="A3.T6.3.3.3.1.1.1.m1.1.1.2">𝑆</ci><cn id="A3.T6.3.3.3.1.1.1.m1.1.1.3.cmml" type="integer" xref="A3.T6.3.3.3.1.1.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T6.3.3.3.1.1.1.m1.1c">S_{128}</annotation><annotation encoding="application/x-llamapun" id="A3.T6.3.3.3.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="A3.T6.4.4.4.2.2.2.m2.1"><semantics id="A3.T6.4.4.4.2.2.2.m2.1a"><msub id="A3.T6.4.4.4.2.2.2.m2.1.1" xref="A3.T6.4.4.4.2.2.2.m2.1.1.cmml"><mi id="A3.T6.4.4.4.2.2.2.m2.1.1.2" xref="A3.T6.4.4.4.2.2.2.m2.1.1.2.cmml">L</mi><mn id="A3.T6.4.4.4.2.2.2.m2.1.1.3" xref="A3.T6.4.4.4.2.2.2.m2.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T6.4.4.4.2.2.2.m2.1b"><apply id="A3.T6.4.4.4.2.2.2.m2.1.1.cmml" xref="A3.T6.4.4.4.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="A3.T6.4.4.4.2.2.2.m2.1.1.1.cmml" xref="A3.T6.4.4.4.2.2.2.m2.1.1">subscript</csymbol><ci id="A3.T6.4.4.4.2.2.2.m2.1.1.2.cmml" xref="A3.T6.4.4.4.2.2.2.m2.1.1.2">𝐿</ci><cn id="A3.T6.4.4.4.2.2.2.m2.1.1.3.cmml" type="integer" xref="A3.T6.4.4.4.2.2.2.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T6.4.4.4.2.2.2.m2.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="A3.T6.4.4.4.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math></span></span></td>
<td class="ltx_td ltx_align_right" id="A3.T6.4.4.4.3" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.4.4.4.4" style="padding-left:5.7pt;padding-right:5.7pt;">512</td>
<td class="ltx_td ltx_align_right" id="A3.T6.4.4.4.5" style="padding-left:5.7pt;padding-right:5.7pt;">18.5M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.4.4.4.6" style="padding-left:5.7pt;padding-right:5.7pt;">1.7M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.4.4.4.7" style="padding-left:5.7pt;padding-right:5.7pt;">16.8M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.4.4.4.8" style="padding-left:5.7pt;padding-right:5.7pt;">10.44</td>
</tr>
<tr class="ltx_tr" id="A3.T6.6.6.6">
<td class="ltx_td ltx_align_left ltx_border_r" id="A3.T6.6.6.6.2" style="padding-left:5.7pt;padding-right:5.7pt;">
<span class="ltx_text ltx_font_bold ltx_font_smallcaps" id="A3.T6.6.6.6.2.1">Melodi</span> <math alttext="S_{192}" class="ltx_Math" display="inline" id="A3.T6.5.5.5.1.m1.1"><semantics id="A3.T6.5.5.5.1.m1.1a"><msub id="A3.T6.5.5.5.1.m1.1.1" xref="A3.T6.5.5.5.1.m1.1.1.cmml"><mi id="A3.T6.5.5.5.1.m1.1.1.2" xref="A3.T6.5.5.5.1.m1.1.1.2.cmml">S</mi><mn id="A3.T6.5.5.5.1.m1.1.1.3" xref="A3.T6.5.5.5.1.m1.1.1.3.cmml">192</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T6.5.5.5.1.m1.1b"><apply id="A3.T6.5.5.5.1.m1.1.1.cmml" xref="A3.T6.5.5.5.1.m1.1.1"><csymbol cd="ambiguous" id="A3.T6.5.5.5.1.m1.1.1.1.cmml" xref="A3.T6.5.5.5.1.m1.1.1">subscript</csymbol><ci id="A3.T6.5.5.5.1.m1.1.1.2.cmml" xref="A3.T6.5.5.5.1.m1.1.1.2">𝑆</ci><cn id="A3.T6.5.5.5.1.m1.1.1.3.cmml" type="integer" xref="A3.T6.5.5.5.1.m1.1.1.3">192</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T6.5.5.5.1.m1.1c">S_{192}</annotation><annotation encoding="application/x-llamapun" id="A3.T6.5.5.5.1.m1.1d">italic_S start_POSTSUBSCRIPT 192 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{96}" class="ltx_Math" display="inline" id="A3.T6.6.6.6.2.m2.1"><semantics id="A3.T6.6.6.6.2.m2.1a"><msub id="A3.T6.6.6.6.2.m2.1.1" xref="A3.T6.6.6.6.2.m2.1.1.cmml"><mi id="A3.T6.6.6.6.2.m2.1.1.2" xref="A3.T6.6.6.6.2.m2.1.1.2.cmml">L</mi><mn id="A3.T6.6.6.6.2.m2.1.1.3" xref="A3.T6.6.6.6.2.m2.1.1.3.cmml">96</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T6.6.6.6.2.m2.1b"><apply id="A3.T6.6.6.6.2.m2.1.1.cmml" xref="A3.T6.6.6.6.2.m2.1.1"><csymbol cd="ambiguous" id="A3.T6.6.6.6.2.m2.1.1.1.cmml" xref="A3.T6.6.6.6.2.m2.1.1">subscript</csymbol><ci id="A3.T6.6.6.6.2.m2.1.1.2.cmml" xref="A3.T6.6.6.6.2.m2.1.1.2">𝐿</ci><cn id="A3.T6.6.6.6.2.m2.1.1.3.cmml" type="integer" xref="A3.T6.6.6.6.2.m2.1.1.3">96</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T6.6.6.6.2.m2.1c">L_{96}</annotation><annotation encoding="application/x-llamapun" id="A3.T6.6.6.6.2.m2.1d">italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.6.3" style="padding-left:5.7pt;padding-right:5.7pt;">4096</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.6.4" style="padding-left:5.7pt;padding-right:5.7pt;">512</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.6.5" style="padding-left:5.7pt;padding-right:5.7pt;">27.8M</td>
<td class="ltx_td ltx_align_right" id="A3.T6.6.6.6.6" style="padding-left:5.7pt;padding-right:5.7pt;">2.6M</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A3.T6.6.6.6.7" style="padding-left:5.7pt;padding-right:5.7pt;">25.2M</td>
<td class="ltx_td ltx_align_center" id="A3.T6.6.6.6.8" style="padding-left:5.7pt;padding-right:5.7pt;"><span class="ltx_text ltx_font_bold" id="A3.T6.6.6.6.8.1">10.29</span></td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_table" id="A3.T8">
<div class="ltx_flex_figure ltx_flex_table">
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_top" id="A3.T8.10" style="width:197.3pt;">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Table 7: </span><span class="ltx_text ltx_font_bold" id="A3.T8.10.12.1">Directly copying short-term tokens to long-term memory:</span> Here, we force the short-term and long-term to share the same number of tokens (e.g. <math alttext="S_{64}" class="ltx_Math" display="inline" id="A3.T8.3.3.m1.1"><semantics id="A3.T8.3.3.m1.1b"><msub id="A3.T8.3.3.m1.1.1" xref="A3.T8.3.3.m1.1.1.cmml"><mi id="A3.T8.3.3.m1.1.1.2" xref="A3.T8.3.3.m1.1.1.2.cmml">S</mi><mn id="A3.T8.3.3.m1.1.1.3" xref="A3.T8.3.3.m1.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T8.3.3.m1.1c"><apply id="A3.T8.3.3.m1.1.1.cmml" xref="A3.T8.3.3.m1.1.1"><csymbol cd="ambiguous" id="A3.T8.3.3.m1.1.1.1.cmml" xref="A3.T8.3.3.m1.1.1">subscript</csymbol><ci id="A3.T8.3.3.m1.1.1.2.cmml" xref="A3.T8.3.3.m1.1.1.2">𝑆</ci><cn id="A3.T8.3.3.m1.1.1.3.cmml" type="integer" xref="A3.T8.3.3.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T8.3.3.m1.1d">S_{64}</annotation><annotation encoding="application/x-llamapun" id="A3.T8.3.3.m1.1e">italic_S start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="A3.T8.4.4.m2.1"><semantics id="A3.T8.4.4.m2.1b"><msub id="A3.T8.4.4.m2.1.1" xref="A3.T8.4.4.m2.1.1.cmml"><mi id="A3.T8.4.4.m2.1.1.2" xref="A3.T8.4.4.m2.1.1.2.cmml">L</mi><mn id="A3.T8.4.4.m2.1.1.3" xref="A3.T8.4.4.m2.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T8.4.4.m2.1c"><apply id="A3.T8.4.4.m2.1.1.cmml" xref="A3.T8.4.4.m2.1.1"><csymbol cd="ambiguous" id="A3.T8.4.4.m2.1.1.1.cmml" xref="A3.T8.4.4.m2.1.1">subscript</csymbol><ci id="A3.T8.4.4.m2.1.1.2.cmml" xref="A3.T8.4.4.m2.1.1.2">𝐿</ci><cn id="A3.T8.4.4.m2.1.1.3.cmml" type="integer" xref="A3.T8.4.4.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T8.4.4.m2.1d">L_{64}</annotation><annotation encoding="application/x-llamapun" id="A3.T8.4.4.m2.1e">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>), and examine the impact of directly using short-term tokens as long-term tokens, bypassing the linear token mixer. This approach results in performance degradation compared to generating distinct long-term tokens.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A3.T8.10.10.6">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A3.T8.10.10.6.6">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r" id="A3.T8.10.10.6.6.7" style="padding-left:3.4pt;padding-right:3.4pt;"><span class="ltx_text ltx_font_bold" id="A3.T8.10.10.6.6.7.1">Copying</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T8.6.6.2.2.2" style="padding-left:3.4pt;padding-right:3.4pt;">
<math alttext="S_{96}" class="ltx_Math" display="inline" id="A3.T8.5.5.1.1.1.m1.1"><semantics id="A3.T8.5.5.1.1.1.m1.1a"><msub id="A3.T8.5.5.1.1.1.m1.1.1" xref="A3.T8.5.5.1.1.1.m1.1.1.cmml"><mi id="A3.T8.5.5.1.1.1.m1.1.1.2" xref="A3.T8.5.5.1.1.1.m1.1.1.2.cmml">S</mi><mn id="A3.T8.5.5.1.1.1.m1.1.1.3" xref="A3.T8.5.5.1.1.1.m1.1.1.3.cmml">96</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T8.5.5.1.1.1.m1.1b"><apply id="A3.T8.5.5.1.1.1.m1.1.1.cmml" xref="A3.T8.5.5.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A3.T8.5.5.1.1.1.m1.1.1.1.cmml" xref="A3.T8.5.5.1.1.1.m1.1.1">subscript</csymbol><ci id="A3.T8.5.5.1.1.1.m1.1.1.2.cmml" xref="A3.T8.5.5.1.1.1.m1.1.1.2">𝑆</ci><cn id="A3.T8.5.5.1.1.1.m1.1.1.3.cmml" type="integer" xref="A3.T8.5.5.1.1.1.m1.1.1.3">96</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T8.5.5.1.1.1.m1.1c">S_{96}</annotation><annotation encoding="application/x-llamapun" id="A3.T8.5.5.1.1.1.m1.1d">italic_S start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{96}" class="ltx_Math" display="inline" id="A3.T8.6.6.2.2.2.m2.1"><semantics id="A3.T8.6.6.2.2.2.m2.1a"><msub id="A3.T8.6.6.2.2.2.m2.1.1" xref="A3.T8.6.6.2.2.2.m2.1.1.cmml"><mi id="A3.T8.6.6.2.2.2.m2.1.1.2" xref="A3.T8.6.6.2.2.2.m2.1.1.2.cmml">L</mi><mn id="A3.T8.6.6.2.2.2.m2.1.1.3" xref="A3.T8.6.6.2.2.2.m2.1.1.3.cmml">96</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T8.6.6.2.2.2.m2.1b"><apply id="A3.T8.6.6.2.2.2.m2.1.1.cmml" xref="A3.T8.6.6.2.2.2.m2.1.1"><csymbol cd="ambiguous" id="A3.T8.6.6.2.2.2.m2.1.1.1.cmml" xref="A3.T8.6.6.2.2.2.m2.1.1">subscript</csymbol><ci id="A3.T8.6.6.2.2.2.m2.1.1.2.cmml" xref="A3.T8.6.6.2.2.2.m2.1.1.2">𝐿</ci><cn id="A3.T8.6.6.2.2.2.m2.1.1.3.cmml" type="integer" xref="A3.T8.6.6.2.2.2.m2.1.1.3">96</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T8.6.6.2.2.2.m2.1c">L_{96}</annotation><annotation encoding="application/x-llamapun" id="A3.T8.6.6.2.2.2.m2.1d">italic_L start_POSTSUBSCRIPT 96 end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T8.8.8.4.4.4" style="padding-left:3.4pt;padding-right:3.4pt;">
<math alttext="S_{64}" class="ltx_Math" display="inline" id="A3.T8.7.7.3.3.3.m1.1"><semantics id="A3.T8.7.7.3.3.3.m1.1a"><msub id="A3.T8.7.7.3.3.3.m1.1.1" xref="A3.T8.7.7.3.3.3.m1.1.1.cmml"><mi id="A3.T8.7.7.3.3.3.m1.1.1.2" xref="A3.T8.7.7.3.3.3.m1.1.1.2.cmml">S</mi><mn id="A3.T8.7.7.3.3.3.m1.1.1.3" xref="A3.T8.7.7.3.3.3.m1.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T8.7.7.3.3.3.m1.1b"><apply id="A3.T8.7.7.3.3.3.m1.1.1.cmml" xref="A3.T8.7.7.3.3.3.m1.1.1"><csymbol cd="ambiguous" id="A3.T8.7.7.3.3.3.m1.1.1.1.cmml" xref="A3.T8.7.7.3.3.3.m1.1.1">subscript</csymbol><ci id="A3.T8.7.7.3.3.3.m1.1.1.2.cmml" xref="A3.T8.7.7.3.3.3.m1.1.1.2">𝑆</ci><cn id="A3.T8.7.7.3.3.3.m1.1.1.3.cmml" type="integer" xref="A3.T8.7.7.3.3.3.m1.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T8.7.7.3.3.3.m1.1c">S_{64}</annotation><annotation encoding="application/x-llamapun" id="A3.T8.7.7.3.3.3.m1.1d">italic_S start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="A3.T8.8.8.4.4.4.m2.1"><semantics id="A3.T8.8.8.4.4.4.m2.1a"><msub id="A3.T8.8.8.4.4.4.m2.1.1" xref="A3.T8.8.8.4.4.4.m2.1.1.cmml"><mi id="A3.T8.8.8.4.4.4.m2.1.1.2" xref="A3.T8.8.8.4.4.4.m2.1.1.2.cmml">L</mi><mn id="A3.T8.8.8.4.4.4.m2.1.1.3" xref="A3.T8.8.8.4.4.4.m2.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T8.8.8.4.4.4.m2.1b"><apply id="A3.T8.8.8.4.4.4.m2.1.1.cmml" xref="A3.T8.8.8.4.4.4.m2.1.1"><csymbol cd="ambiguous" id="A3.T8.8.8.4.4.4.m2.1.1.1.cmml" xref="A3.T8.8.8.4.4.4.m2.1.1">subscript</csymbol><ci id="A3.T8.8.8.4.4.4.m2.1.1.2.cmml" xref="A3.T8.8.8.4.4.4.m2.1.1.2">𝐿</ci><cn id="A3.T8.8.8.4.4.4.m2.1.1.3.cmml" type="integer" xref="A3.T8.8.8.4.4.4.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T8.8.8.4.4.4.m2.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="A3.T8.8.8.4.4.4.m2.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T8.10.10.6.6.6" style="padding-left:3.4pt;padding-right:3.4pt;">
<math alttext="S_{32}" class="ltx_Math" display="inline" id="A3.T8.9.9.5.5.5.m1.1"><semantics id="A3.T8.9.9.5.5.5.m1.1a"><msub id="A3.T8.9.9.5.5.5.m1.1.1" xref="A3.T8.9.9.5.5.5.m1.1.1.cmml"><mi id="A3.T8.9.9.5.5.5.m1.1.1.2" xref="A3.T8.9.9.5.5.5.m1.1.1.2.cmml">S</mi><mn id="A3.T8.9.9.5.5.5.m1.1.1.3" xref="A3.T8.9.9.5.5.5.m1.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T8.9.9.5.5.5.m1.1b"><apply id="A3.T8.9.9.5.5.5.m1.1.1.cmml" xref="A3.T8.9.9.5.5.5.m1.1.1"><csymbol cd="ambiguous" id="A3.T8.9.9.5.5.5.m1.1.1.1.cmml" xref="A3.T8.9.9.5.5.5.m1.1.1">subscript</csymbol><ci id="A3.T8.9.9.5.5.5.m1.1.1.2.cmml" xref="A3.T8.9.9.5.5.5.m1.1.1.2">𝑆</ci><cn id="A3.T8.9.9.5.5.5.m1.1.1.3.cmml" type="integer" xref="A3.T8.9.9.5.5.5.m1.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T8.9.9.5.5.5.m1.1c">S_{32}</annotation><annotation encoding="application/x-llamapun" id="A3.T8.9.9.5.5.5.m1.1d">italic_S start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{32}" class="ltx_Math" display="inline" id="A3.T8.10.10.6.6.6.m2.1"><semantics id="A3.T8.10.10.6.6.6.m2.1a"><msub id="A3.T8.10.10.6.6.6.m2.1.1" xref="A3.T8.10.10.6.6.6.m2.1.1.cmml"><mi id="A3.T8.10.10.6.6.6.m2.1.1.2" xref="A3.T8.10.10.6.6.6.m2.1.1.2.cmml">L</mi><mn id="A3.T8.10.10.6.6.6.m2.1.1.3" xref="A3.T8.10.10.6.6.6.m2.1.1.3.cmml">32</mn></msub><annotation-xml encoding="MathML-Content" id="A3.T8.10.10.6.6.6.m2.1b"><apply id="A3.T8.10.10.6.6.6.m2.1.1.cmml" xref="A3.T8.10.10.6.6.6.m2.1.1"><csymbol cd="ambiguous" id="A3.T8.10.10.6.6.6.m2.1.1.1.cmml" xref="A3.T8.10.10.6.6.6.m2.1.1">subscript</csymbol><ci id="A3.T8.10.10.6.6.6.m2.1.1.2.cmml" xref="A3.T8.10.10.6.6.6.m2.1.1.2">𝐿</ci><cn id="A3.T8.10.10.6.6.6.m2.1.1.3.cmml" type="integer" xref="A3.T8.10.10.6.6.6.m2.1.1.3">32</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A3.T8.10.10.6.6.6.m2.1c">L_{32}</annotation><annotation encoding="application/x-llamapun" id="A3.T8.10.10.6.6.6.m2.1d">italic_L start_POSTSUBSCRIPT 32 end_POSTSUBSCRIPT</annotation></semantics></math>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A3.T8.10.10.6.7.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A3.T8.10.10.6.7.1.1" style="padding-left:3.4pt;padding-right:3.4pt;">Yes</th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.10.10.6.7.1.2" style="padding-left:3.4pt;padding-right:3.4pt;">11.00</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.10.10.6.7.1.3" style="padding-left:3.4pt;padding-right:3.4pt;">11.36</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.10.10.6.7.1.4" style="padding-left:3.4pt;padding-right:3.4pt;">11.42</td>
</tr>
<tr class="ltx_tr" id="A3.T8.10.10.6.8.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="A3.T8.10.10.6.8.2.1" style="padding-left:3.4pt;padding-right:3.4pt;">No</th>
<td class="ltx_td ltx_align_center" id="A3.T8.10.10.6.8.2.2" style="padding-left:3.4pt;padding-right:3.4pt;"><span class="ltx_text ltx_font_bold" id="A3.T8.10.10.6.8.2.2.1">10.92</span></td>
<td class="ltx_td ltx_align_center" id="A3.T8.10.10.6.8.2.3" style="padding-left:3.4pt;padding-right:3.4pt;"><span class="ltx_text ltx_font_bold" id="A3.T8.10.10.6.8.2.3.1">11.08</span></td>
<td class="ltx_td ltx_align_center" id="A3.T8.10.10.6.8.2.4" style="padding-left:3.4pt;padding-right:3.4pt;"><span class="ltx_text ltx_font_bold" id="A3.T8.10.10.6.8.2.4.1">11.25</span></td>
</tr>
</tbody>
</table>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_top" id="A3.T8.11" style="width:221.1pt;">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Table 8: </span><span class="ltx_text ltx_font_bold" id="A3.T8.11.4.1">Position of long-term layer.</span> Here, we use a 13-layer <span class="ltx_text ltx_font_smallcaps" id="A3.T8.11.5.2">Melodi</span> model, where layers are indexed from 0 to 12. The model uses 128 short-term and 64 long-term tokens per context window.
While the default position of the long-term layer is at layer 8, placing it at different layers between 5 and 11 yields consistent perplexity scores.
</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A3.T8.11.1.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A3.T8.11.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r" id="A3.T8.11.1.1.1.2" style="padding-left:5.1pt;padding-right:5.1pt;"><span class="ltx_text ltx_font_bold" id="A3.T8.11.1.1.1.2.1">Layer</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T8.11.1.1.1.3" style="padding-left:5.1pt;padding-right:5.1pt;">5</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T8.11.1.1.1.4" style="padding-left:5.1pt;padding-right:5.1pt;">6</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T8.11.1.1.1.5" style="padding-left:5.1pt;padding-right:5.1pt;">7</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A3.T8.11.1.1.1.1" style="padding-left:5.1pt;padding-right:5.1pt;">8<sup class="ltx_sup" id="A3.T8.11.1.1.1.1.1">∗</sup>
</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A3.T8.11.1.1.2.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A3.T8.11.1.1.2.1.1" style="padding-left:5.1pt;padding-right:5.1pt;"><span class="ltx_text ltx_font_bold" id="A3.T8.11.1.1.2.1.1.1">Perplexity</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.11.1.1.2.1.2" style="padding-left:5.1pt;padding-right:5.1pt;">11.00</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.11.1.1.2.1.3" style="padding-left:5.1pt;padding-right:5.1pt;">11.01</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.11.1.1.2.1.4" style="padding-left:5.1pt;padding-right:5.1pt;">11.03</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.11.1.1.2.1.5" style="padding-left:5.1pt;padding-right:5.1pt;">10.95</td>
</tr>
<tr class="ltx_tr" id="A3.T8.11.1.1.3.2">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r" id="A3.T8.11.1.1.3.2.1" style="padding-left:5.1pt;padding-right:5.1pt;"><span class="ltx_text ltx_font_bold" id="A3.T8.11.1.1.3.2.1.1">Layer</span></th>
<td class="ltx_td ltx_align_center" id="A3.T8.11.1.1.3.2.2" style="padding-left:5.1pt;padding-right:5.1pt;">9</td>
<td class="ltx_td ltx_align_center" id="A3.T8.11.1.1.3.2.3" style="padding-left:5.1pt;padding-right:5.1pt;">10</td>
<td class="ltx_td ltx_align_center" id="A3.T8.11.1.1.3.2.4" style="padding-left:5.1pt;padding-right:5.1pt;">11</td>
<td class="ltx_td" id="A3.T8.11.1.1.3.2.5" style="padding-left:5.1pt;padding-right:5.1pt;"></td>
</tr>
<tr class="ltx_tr" id="A3.T8.11.1.1.4.3">
<th class="ltx_td ltx_align_center ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A3.T8.11.1.1.4.3.1" style="padding-left:5.1pt;padding-right:5.1pt;"><span class="ltx_text ltx_font_bold" id="A3.T8.11.1.1.4.3.1.1">Perplexity</span></th>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.11.1.1.4.3.2" style="padding-left:5.1pt;padding-right:5.1pt;">10.96</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.11.1.1.4.3.3" style="padding-left:5.1pt;padding-right:5.1pt;">10.95</td>
<td class="ltx_td ltx_align_center ltx_border_t" id="A3.T8.11.1.1.4.3.4" style="padding-left:5.1pt;padding-right:5.1pt;">10.94</td>
<td class="ltx_td ltx_border_t" id="A3.T8.11.1.1.4.3.5" style="padding-left:5.1pt;padding-right:5.1pt;"></td>
</tr>
</tbody>
</table>
</figure>
</div>
</div>
</figure>
</section>
<section class="ltx_appendix" id="A4">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix D </span>More Ablations</h2>
<div class="ltx_para ltx_noindent" id="A4.p1">
<p class="ltx_p" id="A4.p1.1">In this section, we present additional ablation studies.</p>
</div>
<div class="ltx_para ltx_noindent" id="A4.p2">
<p class="ltx_p" id="A4.p2.1"><span class="ltx_text ltx_font_bold" id="A4.p2.1.1">Directly copying short-term memory to long-term memory:</span> This ablation experiment, conducted at the long-term layer, explores directly copying short-term memory tokens as long-term tokens. Instead of generating long-term tokens using the linear token mixer, this approach utilizes the short-term tokens present at the long-term layer and stores them directly in the long-term memory. Here, we force the short-term and long-term to share the same number of tokens (<math alttext="S=L" class="ltx_Math" display="inline" id="A4.p2.1.m1.1"><semantics id="A4.p2.1.m1.1a"><mrow id="A4.p2.1.m1.1.1" xref="A4.p2.1.m1.1.1.cmml"><mi id="A4.p2.1.m1.1.1.2" xref="A4.p2.1.m1.1.1.2.cmml">S</mi><mo id="A4.p2.1.m1.1.1.1" xref="A4.p2.1.m1.1.1.1.cmml">=</mo><mi id="A4.p2.1.m1.1.1.3" xref="A4.p2.1.m1.1.1.3.cmml">L</mi></mrow><annotation-xml encoding="MathML-Content" id="A4.p2.1.m1.1b"><apply id="A4.p2.1.m1.1.1.cmml" xref="A4.p2.1.m1.1.1"><eq id="A4.p2.1.m1.1.1.1.cmml" xref="A4.p2.1.m1.1.1.1"></eq><ci id="A4.p2.1.m1.1.1.2.cmml" xref="A4.p2.1.m1.1.1.2">𝑆</ci><ci id="A4.p2.1.m1.1.1.3.cmml" xref="A4.p2.1.m1.1.1.3">𝐿</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p2.1.m1.1c">S=L</annotation><annotation encoding="application/x-llamapun" id="A4.p2.1.m1.1d">italic_S = italic_L</annotation></semantics></math>). The results in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A3.T8" title="Table 8 ‣ Appendix C More Comparison with Baselines ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">8</span></a> indicate that this direct copying method leads to a performance degradation.</p>
</div>
<div class="ltx_para ltx_noindent" id="A4.p3">
<p class="ltx_p" id="A4.p3.2"><span class="ltx_text ltx_font_bold" id="A4.p3.2.1">Effect of long-term layer position:</span>
We investigate the impact of varying the position of the long-term layer within a 13-layer <span class="ltx_text ltx_font_smallcaps" id="A4.p3.2.2">Melodi</span> model (<math alttext="S_{128}" class="ltx_Math" display="inline" id="A4.p3.1.m1.1"><semantics id="A4.p3.1.m1.1a"><msub id="A4.p3.1.m1.1.1" xref="A4.p3.1.m1.1.1.cmml"><mi id="A4.p3.1.m1.1.1.2" xref="A4.p3.1.m1.1.1.2.cmml">S</mi><mn id="A4.p3.1.m1.1.1.3" xref="A4.p3.1.m1.1.1.3.cmml">128</mn></msub><annotation-xml encoding="MathML-Content" id="A4.p3.1.m1.1b"><apply id="A4.p3.1.m1.1.1.cmml" xref="A4.p3.1.m1.1.1"><csymbol cd="ambiguous" id="A4.p3.1.m1.1.1.1.cmml" xref="A4.p3.1.m1.1.1">subscript</csymbol><ci id="A4.p3.1.m1.1.1.2.cmml" xref="A4.p3.1.m1.1.1.2">𝑆</ci><cn id="A4.p3.1.m1.1.1.3.cmml" type="integer" xref="A4.p3.1.m1.1.1.3">128</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.1.m1.1c">S_{128}</annotation><annotation encoding="application/x-llamapun" id="A4.p3.1.m1.1d">italic_S start_POSTSUBSCRIPT 128 end_POSTSUBSCRIPT</annotation></semantics></math>+<math alttext="L_{64}" class="ltx_Math" display="inline" id="A4.p3.2.m2.1"><semantics id="A4.p3.2.m2.1a"><msub id="A4.p3.2.m2.1.1" xref="A4.p3.2.m2.1.1.cmml"><mi id="A4.p3.2.m2.1.1.2" xref="A4.p3.2.m2.1.1.2.cmml">L</mi><mn id="A4.p3.2.m2.1.1.3" xref="A4.p3.2.m2.1.1.3.cmml">64</mn></msub><annotation-xml encoding="MathML-Content" id="A4.p3.2.m2.1b"><apply id="A4.p3.2.m2.1.1.cmml" xref="A4.p3.2.m2.1.1"><csymbol cd="ambiguous" id="A4.p3.2.m2.1.1.1.cmml" xref="A4.p3.2.m2.1.1">subscript</csymbol><ci id="A4.p3.2.m2.1.1.2.cmml" xref="A4.p3.2.m2.1.1.2">𝐿</ci><cn id="A4.p3.2.m2.1.1.3.cmml" type="integer" xref="A4.p3.2.m2.1.1.3">64</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p3.2.m2.1c">L_{64}</annotation><annotation encoding="application/x-llamapun" id="A4.p3.2.m2.1d">italic_L start_POSTSUBSCRIPT 64 end_POSTSUBSCRIPT</annotation></semantics></math>). Layers are indexed from 0 to 12, with the default long-term layer position at layer 8. Results in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03156v1#A3.T8" title="Table 8 ‣ Appendix C More Comparison with Baselines ‣ Melodi: Exploring Memory Compression for Long Contexts"><span class="ltx_text ltx_ref_tag">8</span></a> reveal consistent perplexity scores when the long-term layer is positioned between layers 5 and 11.</p>
</div>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Fri Oct  4 05:24:09 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
