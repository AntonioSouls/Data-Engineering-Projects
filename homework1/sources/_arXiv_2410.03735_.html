<!DOCTYPE html>
<html lang="en">
<head>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<title>Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling</title>
<!--Generated on Mon Sep 30 20:43:09 2024 by LaTeXML (version 0.8.8) http://dlmf.nist.gov/LaTeXML/.-->
<meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/ar5iv-fonts.0.7.9.min.css" rel="stylesheet" type="text/css"/>
<link href="/static/browse/0.3.4/css/latexml_styles.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.3.3/html2canvas.min.js"></script>
<script src="/static/browse/0.3.4/js/addons_new.js"></script>
<script src="/static/browse/0.3.4/js/feedbackOverlay.js"></script>
<base href="/html/2410.03735v1/"/></head>
<body>
<nav class="ltx_page_navbar">
<nav class="ltx_TOC">
<ol class="ltx_toclist">
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S1" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">1 </span>Introduction</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S2" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">2 </span>Related Work</span></a></li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S3" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3 </span>Data Selection for Task-Adaptive Pretraining</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S3.SS1" title="In 3 Data Selection for Task-Adaptive Pretraining ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.1 </span>Notations</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S3.SS2" title="In 3 Data Selection for Task-Adaptive Pretraining ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.2 </span>Classification</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S3.SS3" title="In 3 Data Selection for Task-Adaptive Pretraining ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.3 </span>Gradient-Alignment</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S3.SS4" title="In 3 Data Selection for Task-Adaptive Pretraining ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">3.4 </span>CRISP: ClusteRed Importance Sampling for Pretraining</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4 </span>Experiments &amp; Results</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.SS1" title="In 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.1 </span>Language Modeling Tasks</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.SS2" title="In 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">4.2 </span>Multiple Choice Question Tasks</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5 </span>Analysis</span></a>
<ol class="ltx_toclist ltx_toclist_section">
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.SS1" title="In 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.1 </span>Clustering</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.SS2" title="In 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.2 </span>Model Size</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.SS3" title="In 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.3 </span>Different Amount of Training Data</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.SS4" title="In 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.4 </span>Task-Transfer and Multitasking</span></a></li>
<li class="ltx_tocentry ltx_tocentry_subsection"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.SS5" title="In 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">5.5 </span>Task-Dependent Continued Pretraining</span></a></li>
</ol>
</li>
<li class="ltx_tocentry ltx_tocentry_section"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S6" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">6 </span>Conclusions</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A1" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">A </span>Scalable Clustering</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">B </span>Dataset Statistics</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A3" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">C </span>Architectures &amp; Hyperparameters</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A4" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">D </span>MCQ Evaluation</span></a></li>
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A5" title="In Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">E </span>Supplementary Results for Language Modeling Tasks</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A6" title="In Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">F </span>Supplementary Results for Multiple Choice Questions</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_appendix">
<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A7" title="In Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">G </span>Comparing the results of DoGE and Importance Sampling</span></a>
<ol class="ltx_toclist ltx_toclist_appendix">
<li class="ltx_tocentry ltx_tocentry_appendix"><a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A8" title="In Appendix G Comparing the results of DoGE and Importance Sampling ‣ Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_title"><span class="ltx_tag ltx_tag_ref">H </span>Task Transfer for 350m, 1.3B and 7B models</span></a></li>
</ol>
</li>
</ol>
</li>
</ol>
</li>
</ol></nav>
</nav>
<div class="ltx_page_main">
<div class="ltx_page_content">
<article class="ltx_document ltx_authors_1line">
<h1 class="ltx_title ltx_title_document">Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling</h1>
<div class="ltx_authors">
<span class="ltx_creator ltx_role_author">
<span class="ltx_personname">David Grangier, Simin Fan, Skyler Seto, Pierre Ablin
<br class="ltx_break"/>Apple
</span></span>
</div>
<div class="ltx_abstract">
<h6 class="ltx_title ltx_title_abstract">Abstract</h6>
<p class="ltx_p" id="id1.id1">Specialist language models (LMs) focus on a specific task or domain on which they often outperform generalist LMs of the same size. However, the specialist data needed to pretrain these models is only available in limited amount for most tasks. In this work, we build specialist models from large generalist training sets instead. We adjust the training distribution of the generalist data with guidance from the limited domain-specific data. We explore several approaches, with clustered importance sampling standing out. This method clusters the generalist dataset and samples from these clusters based on their frequencies in the smaller specialist dataset. It is scalable, suitable for pretraining and continued pretraining, it works well in multi-task settings. Our findings demonstrate improvements across different domains in terms of language modeling perplexity and accuracy on multiple-choice question tasks. We also present ablation studies that examine the impact of dataset sizes, clustering configurations, and model sizes.</p>
</div>
<section class="ltx_section" id="S1">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">1 </span>Introduction</h2>
<div class="ltx_para ltx_noindent" id="S1.p1">
<p class="ltx_p" id="S1.p1.1">Generalist language models (LMs) can address a wide variety of tasks, but this generality comes at a cost <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib9" title="">2020</a>)</cite>. It necessitates a large training set representative of all prospective tasks, as well as a large model to fit such a comprehensive dataset. Specialist models forgo this generality and fit a model for a limited domain or task. In their narrow specialty, such models can achieve better accuracy at a given model size <cite class="ltx_cite ltx_citemacro_citep">(Kerner, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib34" title="">2024</a>)</cite>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p2">
<p class="ltx_p" id="S1.p2.1">Pretraining a specialist is interesting when two conditions are met: (i) the targeted task justifies the cost of training a dedicated model and (ii) a specialist dataset large enough for pretraining is available. Condition (i) is dependent on the targeted application and its potential economic benefit. Condition (ii) is more limiting since modern LMs are commonly pre-trained on datasets larger than 100B tokens<span class="ltx_note ltx_role_footnote" id="footnote1"><sup class="ltx_note_mark">1</sup><span class="ltx_note_outer"><span class="ltx_note_content"><sup class="ltx_note_mark">1</sup><span class="ltx_tag ltx_tag_note">1</span>100B tokens <math alttext="\simeq" class="ltx_Math" display="inline" id="footnote1.m1.1"><semantics id="footnote1.m1.1b"><mo id="footnote1.m1.1.1" xref="footnote1.m1.1.1.cmml">≃</mo><annotation-xml encoding="MathML-Content" id="footnote1.m1.1c"><csymbol cd="latexml" id="footnote1.m1.1.1.cmml" xref="footnote1.m1.1.1">similar-to-or-equals</csymbol></annotation-xml><annotation encoding="application/x-tex" id="footnote1.m1.1d">\simeq</annotation><annotation encoding="application/x-llamapun" id="footnote1.m1.1e">≃</annotation></semantics></math> 1m books <math alttext="\simeq" class="ltx_Math" display="inline" id="footnote1.m2.1"><semantics id="footnote1.m2.1b"><mo id="footnote1.m2.1.1" xref="footnote1.m2.1.1.cmml">≃</mo><annotation-xml encoding="MathML-Content" id="footnote1.m2.1c"><csymbol cd="latexml" id="footnote1.m2.1.1.cmml" xref="footnote1.m2.1.1">similar-to-or-equals</csymbol></annotation-xml><annotation encoding="application/x-tex" id="footnote1.m2.1d">\simeq</annotation><annotation encoding="application/x-llamapun" id="footnote1.m2.1e">≃</annotation></semantics></math> 60x the annual publication of the top English language publisher <cite class="ltx_cite ltx_citemacro_citep">(Lee, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib39" title="">2021</a>)</cite>.</span></span></span>, an amount that cannot be commissioned for most applications.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p3">
<p class="ltx_p" id="S1.p3.1">This work considers relaxing condition (ii) and studies methods to train a specialist model when specialized data is scarce. Given a large generalist dataset and a small specialist dataset, we propose to modify the distribution over the generalist dataset guided by the scarce specialist dataset. Training a model on the modified distribution gives a specialist model with better accuracy than a generalist model of the same size.</p>
</div>
<div class="ltx_para ltx_noindent" id="S1.p4">
<p class="ltx_p" id="S1.p4.1">We study this setting across different specialization tasks including domain-specific language modeling (medical, encyclopedic domains) and end-tasks (scholar exams in science and humanities, reasoning questions). We compare different strategies to manipulate the pretraining distribution. We evaluate strategies based on text classifiers, gradient-alignment and importance sampling (IS). Although IS is rarely used for LM data selection, we build upon on a simple IS recipe based on clustering <cite class="ltx_cite ltx_citemacro_citep">(Grangier et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib24" title="">2024b</a>)</cite> and report that the resulting method systematically outperforms alternatives. Our IS recipe clusters the generalist set and computes the cluster histogram over the specialist data. Then, for pretraining, generic data is sampled according to the specialist histogram, see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S3.F1" title="Figure 1 ‣ 3.4 CRISP: ClusteRed Importance Sampling for Pretraining ‣ 3 Data Selection for Task-Adaptive Pretraining ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">1</span></a>. We show the empirical benefit of this method varying model sizes (350m to 7B parameters), the amount of generalist data and the amount of specific data. We assess both perplexity gains for language model adaptation and accuracy improvements for multiple choice question tasks.</p>
</div>
</section>
<section class="ltx_section" id="S2">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">2 </span>Related Work</h2>
<div class="ltx_para ltx_noindent" id="S2.p1">
<p class="ltx_p" id="S2.p1.1"><span class="ltx_text ltx_font_bold" id="S2.p1.1.1">Generalist vs Specialist LMs</span> Generalist LMs address tasks which they have not been trained for explicitly <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib9" title="">2020</a>)</cite>, or provide a good initialization for fine-tuning a dedicated model <cite class="ltx_cite ltx_citemacro_citep">(Devlin et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib15" title="">2019</a>)</cite>. Nowadays generalists compete with dedicated models on many tasks <cite class="ltx_cite ltx_citemacro_citep">(Jiang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib31" title="">2024</a>; Dubey et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib17" title="">2024</a>)</cite>. Success however comes at a price: a generalist must be much larger than a specialist for the same accuracy.
For instance, on English-to-German translation, the 175-B parameter generalist GPT-3 <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib9" title="">2020</a>)</cite> is less accurate than a 136m-parameter specialist <cite class="ltx_cite ltx_citemacro_citep">(Sennrich et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib57" title="">2016a</a>)</cite>.
For neural LMs, the parameter count directly impacts training and inference costs.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.p2">
<p class="ltx_p" id="S2.p2.1">Specialist large LMs exist in domains where large amounts of specialized texts are available. Corpora with billions of tokens enable pretraining or <em class="ltx_emph ltx_font_italic" id="S2.p2.1.1">continued pretraining</em>, a generalist pretraining phase followed by a specialist one <cite class="ltx_cite ltx_citemacro_citep">(Gururangan et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib26" title="">2020</a>; Parmar et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib49" title="">2024</a>)</cite>). Domains with specialist models include medicine and biology <cite class="ltx_cite ltx_citemacro_citep">(Lewis et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib41" title="">2020</a>; Labrak et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib37" title="">2024</a>; Bolton et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib7" title="">2024</a>)</cite>, computer programming and mathematics <cite class="ltx_cite ltx_citemacro_citep">(Lewkowycz et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib42" title="">2022</a>; Rozière et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib54" title="">2024</a>; Azerbayev et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib6" title="">2024</a>)</cite> and finance <cite class="ltx_cite ltx_citemacro_citep">(Wu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib66" title="">2023</a>; Xie et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib68" title="">2023a</a>)</cite>. When specialist data is available in limited amount, there are methods to train specialist models on generalist data instead.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.p3">
<p class="ltx_p" id="S2.p3.1"><span class="ltx_text ltx_font_bold" id="S2.p3.1.1">Task-Adaptive Data-Selection</span> The selection methods over-sample generalist data that aids model generalization in the target domain. For masked LMs, <cite class="ltx_cite ltx_citemacro_citet">Gururangan et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib26" title="">2020</a>)</cite> observe that continued pretraining improves the performance on end-tasks when using data with high vocabulary overlap with the targeted task. For machine translation (MT), <cite class="ltx_cite ltx_citemacro_citet">Aharoni &amp; Goldberg (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib1" title="">2020</a>)</cite> show that a task-adapted pretraining dataset can be selected from a generalist dataset using the nearest neighbors of a small specialist set. Their nearest neighbor classifier relies on BERT sentence distance <cite class="ltx_cite ltx_citemacro_citep">(Devlin et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib15" title="">2019</a>)</cite>. Still for MT, other works have used other types of classifiers. In particular, contrasting the scores of two LMs (generalist and specialist) is popular <cite class="ltx_cite ltx_citemacro_citep">(Moore &amp; Lewis, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib47" title="">2010</a>; Axelrod et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib5" title="">2011</a>; Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib63" title="">2018</a>; Junczys-Dowmunt, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib32" title="">2018</a>)</cite>. Other classifiers include logistic regression or fine-tuned BERT <cite class="ltx_cite ltx_citemacro_citep">(Iter &amp; Grangier, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib29" title="">2021</a>)</cite>.
Outside classification, <cite class="ltx_cite ltx_citemacro_citet">Xie et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib70" title="">2023c</a>)</cite> proposed to use importance sampling for continued pretraining. They improve classification tasks by selecting pretraining data with a similar distribution to the targeted domain in terms of hashed-ngrams. Importance sampling is also used in <cite class="ltx_cite ltx_citemacro_citep">(Grangier et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib24" title="">2024b</a>)</cite> and we build upon that work which adjusts the frequency of generalist clusters informed by specialist data: we scale the method to millions of clusters, show that it works with larger models, and extend it beyond language modeling tasks.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.p4">
<p class="ltx_p" id="S2.p4.1">A third type of methods for task-adaptative selection relies on bilevel optimization and gradient aligment <cite class="ltx_cite ltx_citemacro_citep">(Pruthi et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib51" title="">2020</a>; Xia et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib67" title="">2024</a>; Grangier et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib22" title="">2023</a>)</cite>. The pretraining distribution is selected such that the reweighted gradients from the generalist dataset mimics the expected gradient from the small specialist dataset. Gradient-alignment for data selection has also been used for other purposes such as data summarization <cite class="ltx_cite ltx_citemacro_citep">(Borsos et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib8" title="">2024</a>)</cite>, pretraining acceleration <cite class="ltx_cite ltx_citemacro_citep">(Xie et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib69" title="">2023b</a>; Fan et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib19" title="">2024</a>)</cite> or auxiliary task weighting <cite class="ltx_cite ltx_citemacro_citep">(Wang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib64" title="">2020</a>; Raghu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib52" title="">2021</a>)</cite>. Finally, it is also worth mentioning data selection methods based on reinforcement learning <cite class="ltx_cite ltx_citemacro_citep">(Liu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib44" title="">2019</a>; Yoon et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib73" title="">2020</a>)</cite>, bayesian optimization <cite class="ltx_cite ltx_citemacro_citep">(Ruder &amp; Plank, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib55" title="">2017</a>)</cite>, data models <cite class="ltx_cite ltx_citemacro_citep">(Ilyas et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib28" title="">2022</a>)</cite> and influence models <cite class="ltx_cite ltx_citemacro_citep">(Yu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib74" title="">2024</a>)</cite>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S2.p5">
<p class="ltx_p" id="S2.p5.1"><span class="ltx_text ltx_font_bold" id="S2.p5.1.1">Pretraining Data Quality</span> Outside of domain aspects, the quality of pretraining data is also an important topic <cite class="ltx_cite ltx_citemacro_citep">(Wenzek et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib65" title="">2020</a>; Dodge et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib16" title="">2021</a>; Penedo et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib50" title="">2023</a>; Li et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib43" title="">2024</a>)</cite>. Data quality includes removing data in other languages <cite class="ltx_cite ltx_citemacro_citep">(Cook &amp; Lui, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib12" title="">2012</a>)</cite>, text formatting <cite class="ltx_cite ltx_citemacro_citep">(Xu et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib71" title="">2024</a>)</cite>, favoring long form text <cite class="ltx_cite ltx_citemacro_cite">Gao et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib20" title="">2021</a>); Gunasekar et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib25" title="">2023</a>)</cite>, removing duplicates <cite class="ltx_cite ltx_citemacro_citep">(Lee et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib40" title="">2022</a>)</cite>. It also involves balancing
different sources of data with the goal of reaching a better generic pretraining loss <cite class="ltx_cite ltx_citemacro_cite">Xie et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib69" title="">2023b</a>); Fan et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib19" title="">2024</a>); Vo et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib62" title="">2024</a>)</cite>. Recent work also considered filtering <cite class="ltx_cite ltx_citemacro_cite">Kong et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib36" title="">2024</a>)</cite>, correcting <cite class="ltx_cite ltx_citemacro_cite">Chen &amp; Mueller (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib10" title="">2024</a>)</cite> or generating <cite class="ltx_cite ltx_citemacro_cite">Maini et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib45" title="">2024</a>)</cite> pretraining data with LMs.
These data quality considerations are orthogonal to domain concerns: quality filters are applied alongside domain adaptation decisions <cite class="ltx_cite ltx_citemacro_citep">(Albalak et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib2" title="">2024</a>)</cite>.</p>
</div>
</section>
<section class="ltx_section" id="S3">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">3 </span>Data Selection for Task-Adaptive Pretraining</h2>
<div class="ltx_para ltx_noindent" id="S3.p1">
<p class="ltx_p" id="S3.p1.1">We consider three methods for task-adaptive pretraining of LMs. Classification and gradient alignment have been evaluated in different contexts before but not for end-tasks like multiple-choice question answering. Clustered-based importance sampling at scale is a contribution of this work, building upon recent work from <cite class="ltx_cite ltx_citemacro_cite">Grangier et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib24" title="">2024b</a>)</cite>.</p>
</div>
<section class="ltx_subsection" id="S3.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.1 </span>Notations</h3>
<div class="ltx_para ltx_noindent" id="S3.SS1.p1">
<p class="ltx_p" id="S3.SS1.p1.6"><math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="S3.SS1.p1.1.m1.1"><semantics id="S3.SS1.p1.1.m1.1a"><msup id="S3.SS1.p1.1.m1.1.1" xref="S3.SS1.p1.1.m1.1.1.cmml"><mi id="S3.SS1.p1.1.m1.1.1.2" xref="S3.SS1.p1.1.m1.1.1.2.cmml">D</mi><mi id="S3.SS1.p1.1.m1.1.1.3" mathvariant="normal" xref="S3.SS1.p1.1.m1.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.1.m1.1b"><apply id="S3.SS1.p1.1.m1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.1.m1.1.1.1.cmml" xref="S3.SS1.p1.1.m1.1.1">superscript</csymbol><ci id="S3.SS1.p1.1.m1.1.1.2.cmml" xref="S3.SS1.p1.1.m1.1.1.2">𝐷</ci><ci id="S3.SS1.p1.1.m1.1.1.3.cmml" xref="S3.SS1.p1.1.m1.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.1.m1.1c">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.1.m1.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> is the training dataset sampled from the generalist distribution <math alttext="{\cal D}^{\rm g}" class="ltx_Math" display="inline" id="S3.SS1.p1.2.m2.1"><semantics id="S3.SS1.p1.2.m2.1a"><msup id="S3.SS1.p1.2.m2.1.1" xref="S3.SS1.p1.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.2.m2.1.1.2" xref="S3.SS1.p1.2.m2.1.1.2.cmml">𝒟</mi><mi id="S3.SS1.p1.2.m2.1.1.3" mathvariant="normal" xref="S3.SS1.p1.2.m2.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.2.m2.1b"><apply id="S3.SS1.p1.2.m2.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.2.m2.1.1.1.cmml" xref="S3.SS1.p1.2.m2.1.1">superscript</csymbol><ci id="S3.SS1.p1.2.m2.1.1.2.cmml" xref="S3.SS1.p1.2.m2.1.1.2">𝒟</ci><ci id="S3.SS1.p1.2.m2.1.1.3.cmml" xref="S3.SS1.p1.2.m2.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.2.m2.1c">{\cal D}^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.2.m2.1d">caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math>. <math alttext="D^{\rm s}" class="ltx_Math" display="inline" id="S3.SS1.p1.3.m3.1"><semantics id="S3.SS1.p1.3.m3.1a"><msup id="S3.SS1.p1.3.m3.1.1" xref="S3.SS1.p1.3.m3.1.1.cmml"><mi id="S3.SS1.p1.3.m3.1.1.2" xref="S3.SS1.p1.3.m3.1.1.2.cmml">D</mi><mi id="S3.SS1.p1.3.m3.1.1.3" mathvariant="normal" xref="S3.SS1.p1.3.m3.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.3.m3.1b"><apply id="S3.SS1.p1.3.m3.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.3.m3.1.1.1.cmml" xref="S3.SS1.p1.3.m3.1.1">superscript</csymbol><ci id="S3.SS1.p1.3.m3.1.1.2.cmml" xref="S3.SS1.p1.3.m3.1.1.2">𝐷</ci><ci id="S3.SS1.p1.3.m3.1.1.3.cmml" xref="S3.SS1.p1.3.m3.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.3.m3.1c">D^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.3.m3.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math> is the specialist dataset representative of the final task,
sampled from <math alttext="{\cal D}^{\rm s}\neq{\cal D}^{\rm g}" class="ltx_Math" display="inline" id="S3.SS1.p1.4.m4.1"><semantics id="S3.SS1.p1.4.m4.1a"><mrow id="S3.SS1.p1.4.m4.1.1" xref="S3.SS1.p1.4.m4.1.1.cmml"><msup id="S3.SS1.p1.4.m4.1.1.2" xref="S3.SS1.p1.4.m4.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.4.m4.1.1.2.2" xref="S3.SS1.p1.4.m4.1.1.2.2.cmml">𝒟</mi><mi id="S3.SS1.p1.4.m4.1.1.2.3" mathvariant="normal" xref="S3.SS1.p1.4.m4.1.1.2.3.cmml">s</mi></msup><mo id="S3.SS1.p1.4.m4.1.1.1" xref="S3.SS1.p1.4.m4.1.1.1.cmml">≠</mo><msup id="S3.SS1.p1.4.m4.1.1.3" xref="S3.SS1.p1.4.m4.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.4.m4.1.1.3.2" xref="S3.SS1.p1.4.m4.1.1.3.2.cmml">𝒟</mi><mi id="S3.SS1.p1.4.m4.1.1.3.3" mathvariant="normal" xref="S3.SS1.p1.4.m4.1.1.3.3.cmml">g</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.4.m4.1b"><apply id="S3.SS1.p1.4.m4.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1"><neq id="S3.SS1.p1.4.m4.1.1.1.cmml" xref="S3.SS1.p1.4.m4.1.1.1"></neq><apply id="S3.SS1.p1.4.m4.1.1.2.cmml" xref="S3.SS1.p1.4.m4.1.1.2"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.2.1.cmml" xref="S3.SS1.p1.4.m4.1.1.2">superscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.2.2.cmml" xref="S3.SS1.p1.4.m4.1.1.2.2">𝒟</ci><ci id="S3.SS1.p1.4.m4.1.1.2.3.cmml" xref="S3.SS1.p1.4.m4.1.1.2.3">s</ci></apply><apply id="S3.SS1.p1.4.m4.1.1.3.cmml" xref="S3.SS1.p1.4.m4.1.1.3"><csymbol cd="ambiguous" id="S3.SS1.p1.4.m4.1.1.3.1.cmml" xref="S3.SS1.p1.4.m4.1.1.3">superscript</csymbol><ci id="S3.SS1.p1.4.m4.1.1.3.2.cmml" xref="S3.SS1.p1.4.m4.1.1.3.2">𝒟</ci><ci id="S3.SS1.p1.4.m4.1.1.3.3.cmml" xref="S3.SS1.p1.4.m4.1.1.3.3">g</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.4.m4.1c">{\cal D}^{\rm s}\neq{\cal D}^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.4.m4.1d">caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ≠ caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math>. The loss of model <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p1.5.m5.1"><semantics id="S3.SS1.p1.5.m5.1a"><mi id="S3.SS1.p1.5.m5.1.1" xref="S3.SS1.p1.5.m5.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.5.m5.1b"><ci id="S3.SS1.p1.5.m5.1.1.cmml" xref="S3.SS1.p1.5.m5.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.5.m5.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.5.m5.1d">italic_θ</annotation></semantics></math> on <math alttext="D" class="ltx_Math" display="inline" id="S3.SS1.p1.6.m6.1"><semantics id="S3.SS1.p1.6.m6.1a"><mi id="S3.SS1.p1.6.m6.1.1" xref="S3.SS1.p1.6.m6.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.6.m6.1b"><ci id="S3.SS1.p1.6.m6.1.1.cmml" xref="S3.SS1.p1.6.m6.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.6.m6.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.6.m6.1d">italic_D</annotation></semantics></math> is</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="{\cal L}(D;\theta):=\frac{1}{|D|}\sum_{x\in D}\ell(x;\theta)=-\frac{1}{|D|}%
\sum_{x\in D}\frac{1}{|x|}\sum_{i}\log p(x_{i}|x^{i-1}_{1};\theta)" class="ltx_Math" display="block" id="S3.Ex1.m1.9"><semantics id="S3.Ex1.m1.9a"><mrow id="S3.Ex1.m1.9.9" xref="S3.Ex1.m1.9.9.cmml"><mrow id="S3.Ex1.m1.9.9.3" xref="S3.Ex1.m1.9.9.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex1.m1.9.9.3.2" xref="S3.Ex1.m1.9.9.3.2.cmml">ℒ</mi><mo id="S3.Ex1.m1.9.9.3.1" xref="S3.Ex1.m1.9.9.3.1.cmml">⁢</mo><mrow id="S3.Ex1.m1.9.9.3.3.2" xref="S3.Ex1.m1.9.9.3.3.1.cmml"><mo id="S3.Ex1.m1.9.9.3.3.2.1" stretchy="false" xref="S3.Ex1.m1.9.9.3.3.1.cmml">(</mo><mi id="S3.Ex1.m1.4.4" xref="S3.Ex1.m1.4.4.cmml">D</mi><mo id="S3.Ex1.m1.9.9.3.3.2.2" xref="S3.Ex1.m1.9.9.3.3.1.cmml">;</mo><mi id="S3.Ex1.m1.5.5" xref="S3.Ex1.m1.5.5.cmml">θ</mi><mo id="S3.Ex1.m1.9.9.3.3.2.3" rspace="0.278em" stretchy="false" xref="S3.Ex1.m1.9.9.3.3.1.cmml">)</mo></mrow></mrow><mo id="S3.Ex1.m1.9.9.4" rspace="0.278em" xref="S3.Ex1.m1.9.9.4.cmml">:=</mo><mrow id="S3.Ex1.m1.9.9.5" xref="S3.Ex1.m1.9.9.5.cmml"><mfrac id="S3.Ex1.m1.1.1" xref="S3.Ex1.m1.1.1.cmml"><mn id="S3.Ex1.m1.1.1.3" xref="S3.Ex1.m1.1.1.3.cmml">1</mn><mrow id="S3.Ex1.m1.1.1.1.3" xref="S3.Ex1.m1.1.1.1.2.cmml"><mo id="S3.Ex1.m1.1.1.1.3.1" stretchy="false" xref="S3.Ex1.m1.1.1.1.2.1.cmml">|</mo><mi id="S3.Ex1.m1.1.1.1.1" xref="S3.Ex1.m1.1.1.1.1.cmml">D</mi><mo id="S3.Ex1.m1.1.1.1.3.2" stretchy="false" xref="S3.Ex1.m1.1.1.1.2.1.cmml">|</mo></mrow></mfrac><mo id="S3.Ex1.m1.9.9.5.1" xref="S3.Ex1.m1.9.9.5.1.cmml">⁢</mo><mrow id="S3.Ex1.m1.9.9.5.2" xref="S3.Ex1.m1.9.9.5.2.cmml"><munder id="S3.Ex1.m1.9.9.5.2.1" xref="S3.Ex1.m1.9.9.5.2.1.cmml"><mo id="S3.Ex1.m1.9.9.5.2.1.2" movablelimits="false" xref="S3.Ex1.m1.9.9.5.2.1.2.cmml">∑</mo><mrow id="S3.Ex1.m1.9.9.5.2.1.3" xref="S3.Ex1.m1.9.9.5.2.1.3.cmml"><mi id="S3.Ex1.m1.9.9.5.2.1.3.2" xref="S3.Ex1.m1.9.9.5.2.1.3.2.cmml">x</mi><mo id="S3.Ex1.m1.9.9.5.2.1.3.1" xref="S3.Ex1.m1.9.9.5.2.1.3.1.cmml">∈</mo><mi id="S3.Ex1.m1.9.9.5.2.1.3.3" xref="S3.Ex1.m1.9.9.5.2.1.3.3.cmml">D</mi></mrow></munder><mrow id="S3.Ex1.m1.9.9.5.2.2" xref="S3.Ex1.m1.9.9.5.2.2.cmml"><mi id="S3.Ex1.m1.9.9.5.2.2.2" mathvariant="normal" xref="S3.Ex1.m1.9.9.5.2.2.2.cmml">ℓ</mi><mo id="S3.Ex1.m1.9.9.5.2.2.1" xref="S3.Ex1.m1.9.9.5.2.2.1.cmml">⁢</mo><mrow id="S3.Ex1.m1.9.9.5.2.2.3.2" xref="S3.Ex1.m1.9.9.5.2.2.3.1.cmml"><mo id="S3.Ex1.m1.9.9.5.2.2.3.2.1" stretchy="false" xref="S3.Ex1.m1.9.9.5.2.2.3.1.cmml">(</mo><mi id="S3.Ex1.m1.6.6" xref="S3.Ex1.m1.6.6.cmml">x</mi><mo id="S3.Ex1.m1.9.9.5.2.2.3.2.2" xref="S3.Ex1.m1.9.9.5.2.2.3.1.cmml">;</mo><mi id="S3.Ex1.m1.7.7" xref="S3.Ex1.m1.7.7.cmml">θ</mi><mo id="S3.Ex1.m1.9.9.5.2.2.3.2.3" stretchy="false" xref="S3.Ex1.m1.9.9.5.2.2.3.1.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S3.Ex1.m1.9.9.6" xref="S3.Ex1.m1.9.9.6.cmml">=</mo><mrow id="S3.Ex1.m1.9.9.1" xref="S3.Ex1.m1.9.9.1.cmml"><mo id="S3.Ex1.m1.9.9.1a" xref="S3.Ex1.m1.9.9.1.cmml">−</mo><mrow id="S3.Ex1.m1.9.9.1.1" xref="S3.Ex1.m1.9.9.1.1.cmml"><mfrac id="S3.Ex1.m1.2.2" xref="S3.Ex1.m1.2.2.cmml"><mn id="S3.Ex1.m1.2.2.3" xref="S3.Ex1.m1.2.2.3.cmml">1</mn><mrow id="S3.Ex1.m1.2.2.1.3" xref="S3.Ex1.m1.2.2.1.2.cmml"><mo id="S3.Ex1.m1.2.2.1.3.1" stretchy="false" xref="S3.Ex1.m1.2.2.1.2.1.cmml">|</mo><mi id="S3.Ex1.m1.2.2.1.1" xref="S3.Ex1.m1.2.2.1.1.cmml">D</mi><mo id="S3.Ex1.m1.2.2.1.3.2" stretchy="false" xref="S3.Ex1.m1.2.2.1.2.1.cmml">|</mo></mrow></mfrac><mo id="S3.Ex1.m1.9.9.1.1.2" xref="S3.Ex1.m1.9.9.1.1.2.cmml">⁢</mo><mrow id="S3.Ex1.m1.9.9.1.1.1" xref="S3.Ex1.m1.9.9.1.1.1.cmml"><munder id="S3.Ex1.m1.9.9.1.1.1.2" xref="S3.Ex1.m1.9.9.1.1.1.2.cmml"><mo id="S3.Ex1.m1.9.9.1.1.1.2.2" movablelimits="false" xref="S3.Ex1.m1.9.9.1.1.1.2.2.cmml">∑</mo><mrow id="S3.Ex1.m1.9.9.1.1.1.2.3" xref="S3.Ex1.m1.9.9.1.1.1.2.3.cmml"><mi id="S3.Ex1.m1.9.9.1.1.1.2.3.2" xref="S3.Ex1.m1.9.9.1.1.1.2.3.2.cmml">x</mi><mo id="S3.Ex1.m1.9.9.1.1.1.2.3.1" xref="S3.Ex1.m1.9.9.1.1.1.2.3.1.cmml">∈</mo><mi id="S3.Ex1.m1.9.9.1.1.1.2.3.3" xref="S3.Ex1.m1.9.9.1.1.1.2.3.3.cmml">D</mi></mrow></munder><mrow id="S3.Ex1.m1.9.9.1.1.1.1" xref="S3.Ex1.m1.9.9.1.1.1.1.cmml"><mfrac id="S3.Ex1.m1.3.3" xref="S3.Ex1.m1.3.3.cmml"><mn id="S3.Ex1.m1.3.3.3" xref="S3.Ex1.m1.3.3.3.cmml">1</mn><mrow id="S3.Ex1.m1.3.3.1.3" xref="S3.Ex1.m1.3.3.1.2.cmml"><mo id="S3.Ex1.m1.3.3.1.3.1" stretchy="false" xref="S3.Ex1.m1.3.3.1.2.1.cmml">|</mo><mi id="S3.Ex1.m1.3.3.1.1" xref="S3.Ex1.m1.3.3.1.1.cmml">x</mi><mo id="S3.Ex1.m1.3.3.1.3.2" stretchy="false" xref="S3.Ex1.m1.3.3.1.2.1.cmml">|</mo></mrow></mfrac><mo id="S3.Ex1.m1.9.9.1.1.1.1.2" xref="S3.Ex1.m1.9.9.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex1.m1.9.9.1.1.1.1.1" xref="S3.Ex1.m1.9.9.1.1.1.1.1.cmml"><munder id="S3.Ex1.m1.9.9.1.1.1.1.1.2" xref="S3.Ex1.m1.9.9.1.1.1.1.1.2.cmml"><mo id="S3.Ex1.m1.9.9.1.1.1.1.1.2.2" movablelimits="false" xref="S3.Ex1.m1.9.9.1.1.1.1.1.2.2.cmml">∑</mo><mi id="S3.Ex1.m1.9.9.1.1.1.1.1.2.3" xref="S3.Ex1.m1.9.9.1.1.1.1.1.2.3.cmml">i</mi></munder><mrow id="S3.Ex1.m1.9.9.1.1.1.1.1.1" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.cmml"><mrow id="S3.Ex1.m1.9.9.1.1.1.1.1.1.3" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.cmml"><mi id="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.1" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.1.cmml">log</mi><mo id="S3.Ex1.m1.9.9.1.1.1.1.1.1.3a" lspace="0.167em" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.cmml">⁡</mo><mi id="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.2" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.2.cmml">p</mi></mrow><mo id="S3.Ex1.m1.9.9.1.1.1.1.1.1.2" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.cmml"><mo id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.cmml"><msub id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.cmml"><mi id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.2" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.2.cmml">x</mi><mi id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.3" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.3.cmml">i</mi></msub><mo fence="false" id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.2" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.2.cmml">|</mo><mrow id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.2.cmml"><msubsup id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.cmml"><mi id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.2" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml">x</mi><mn id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.3" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml">1</mn><mrow id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.cmml"><mi id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.2" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.2.cmml">i</mi><mo id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.1" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.1.cmml">−</mo><mn id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.3" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.3.cmml">1</mn></mrow></msubsup><mo id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.2" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.2.cmml">;</mo><mi id="S3.Ex1.m1.8.8" xref="S3.Ex1.m1.8.8.cmml">θ</mi></mrow></mrow><mo id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.3" stretchy="false" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex1.m1.9b"><apply id="S3.Ex1.m1.9.9.cmml" xref="S3.Ex1.m1.9.9"><and id="S3.Ex1.m1.9.9a.cmml" xref="S3.Ex1.m1.9.9"></and><apply id="S3.Ex1.m1.9.9b.cmml" xref="S3.Ex1.m1.9.9"><csymbol cd="latexml" id="S3.Ex1.m1.9.9.4.cmml" xref="S3.Ex1.m1.9.9.4">assign</csymbol><apply id="S3.Ex1.m1.9.9.3.cmml" xref="S3.Ex1.m1.9.9.3"><times id="S3.Ex1.m1.9.9.3.1.cmml" xref="S3.Ex1.m1.9.9.3.1"></times><ci id="S3.Ex1.m1.9.9.3.2.cmml" xref="S3.Ex1.m1.9.9.3.2">ℒ</ci><list id="S3.Ex1.m1.9.9.3.3.1.cmml" xref="S3.Ex1.m1.9.9.3.3.2"><ci id="S3.Ex1.m1.4.4.cmml" xref="S3.Ex1.m1.4.4">𝐷</ci><ci id="S3.Ex1.m1.5.5.cmml" xref="S3.Ex1.m1.5.5">𝜃</ci></list></apply><apply id="S3.Ex1.m1.9.9.5.cmml" xref="S3.Ex1.m1.9.9.5"><times id="S3.Ex1.m1.9.9.5.1.cmml" xref="S3.Ex1.m1.9.9.5.1"></times><apply id="S3.Ex1.m1.1.1.cmml" xref="S3.Ex1.m1.1.1"><divide id="S3.Ex1.m1.1.1.2.cmml" xref="S3.Ex1.m1.1.1"></divide><cn id="S3.Ex1.m1.1.1.3.cmml" type="integer" xref="S3.Ex1.m1.1.1.3">1</cn><apply id="S3.Ex1.m1.1.1.1.2.cmml" xref="S3.Ex1.m1.1.1.1.3"><abs id="S3.Ex1.m1.1.1.1.2.1.cmml" xref="S3.Ex1.m1.1.1.1.3.1"></abs><ci id="S3.Ex1.m1.1.1.1.1.cmml" xref="S3.Ex1.m1.1.1.1.1">𝐷</ci></apply></apply><apply id="S3.Ex1.m1.9.9.5.2.cmml" xref="S3.Ex1.m1.9.9.5.2"><apply id="S3.Ex1.m1.9.9.5.2.1.cmml" xref="S3.Ex1.m1.9.9.5.2.1"><csymbol cd="ambiguous" id="S3.Ex1.m1.9.9.5.2.1.1.cmml" xref="S3.Ex1.m1.9.9.5.2.1">subscript</csymbol><sum id="S3.Ex1.m1.9.9.5.2.1.2.cmml" xref="S3.Ex1.m1.9.9.5.2.1.2"></sum><apply id="S3.Ex1.m1.9.9.5.2.1.3.cmml" xref="S3.Ex1.m1.9.9.5.2.1.3"><in id="S3.Ex1.m1.9.9.5.2.1.3.1.cmml" xref="S3.Ex1.m1.9.9.5.2.1.3.1"></in><ci id="S3.Ex1.m1.9.9.5.2.1.3.2.cmml" xref="S3.Ex1.m1.9.9.5.2.1.3.2">𝑥</ci><ci id="S3.Ex1.m1.9.9.5.2.1.3.3.cmml" xref="S3.Ex1.m1.9.9.5.2.1.3.3">𝐷</ci></apply></apply><apply id="S3.Ex1.m1.9.9.5.2.2.cmml" xref="S3.Ex1.m1.9.9.5.2.2"><times id="S3.Ex1.m1.9.9.5.2.2.1.cmml" xref="S3.Ex1.m1.9.9.5.2.2.1"></times><ci id="S3.Ex1.m1.9.9.5.2.2.2.cmml" xref="S3.Ex1.m1.9.9.5.2.2.2">ℓ</ci><list id="S3.Ex1.m1.9.9.5.2.2.3.1.cmml" xref="S3.Ex1.m1.9.9.5.2.2.3.2"><ci id="S3.Ex1.m1.6.6.cmml" xref="S3.Ex1.m1.6.6">𝑥</ci><ci id="S3.Ex1.m1.7.7.cmml" xref="S3.Ex1.m1.7.7">𝜃</ci></list></apply></apply></apply></apply><apply id="S3.Ex1.m1.9.9c.cmml" xref="S3.Ex1.m1.9.9"><eq id="S3.Ex1.m1.9.9.6.cmml" xref="S3.Ex1.m1.9.9.6"></eq><share href="https://arxiv.org/html/2410.03735v1#S3.Ex1.m1.9.9.5.cmml" id="S3.Ex1.m1.9.9d.cmml" xref="S3.Ex1.m1.9.9"></share><apply id="S3.Ex1.m1.9.9.1.cmml" xref="S3.Ex1.m1.9.9.1"><minus id="S3.Ex1.m1.9.9.1.2.cmml" xref="S3.Ex1.m1.9.9.1"></minus><apply id="S3.Ex1.m1.9.9.1.1.cmml" xref="S3.Ex1.m1.9.9.1.1"><times id="S3.Ex1.m1.9.9.1.1.2.cmml" xref="S3.Ex1.m1.9.9.1.1.2"></times><apply id="S3.Ex1.m1.2.2.cmml" xref="S3.Ex1.m1.2.2"><divide id="S3.Ex1.m1.2.2.2.cmml" xref="S3.Ex1.m1.2.2"></divide><cn id="S3.Ex1.m1.2.2.3.cmml" type="integer" xref="S3.Ex1.m1.2.2.3">1</cn><apply id="S3.Ex1.m1.2.2.1.2.cmml" xref="S3.Ex1.m1.2.2.1.3"><abs id="S3.Ex1.m1.2.2.1.2.1.cmml" xref="S3.Ex1.m1.2.2.1.3.1"></abs><ci id="S3.Ex1.m1.2.2.1.1.cmml" xref="S3.Ex1.m1.2.2.1.1">𝐷</ci></apply></apply><apply id="S3.Ex1.m1.9.9.1.1.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1"><apply id="S3.Ex1.m1.9.9.1.1.1.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.9.9.1.1.1.2.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.2">subscript</csymbol><sum id="S3.Ex1.m1.9.9.1.1.1.2.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.2.2"></sum><apply id="S3.Ex1.m1.9.9.1.1.1.2.3.cmml" xref="S3.Ex1.m1.9.9.1.1.1.2.3"><in id="S3.Ex1.m1.9.9.1.1.1.2.3.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.2.3.1"></in><ci id="S3.Ex1.m1.9.9.1.1.1.2.3.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.2.3.2">𝑥</ci><ci id="S3.Ex1.m1.9.9.1.1.1.2.3.3.cmml" xref="S3.Ex1.m1.9.9.1.1.1.2.3.3">𝐷</ci></apply></apply><apply id="S3.Ex1.m1.9.9.1.1.1.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1"><times id="S3.Ex1.m1.9.9.1.1.1.1.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.2"></times><apply id="S3.Ex1.m1.3.3.cmml" xref="S3.Ex1.m1.3.3"><divide id="S3.Ex1.m1.3.3.2.cmml" xref="S3.Ex1.m1.3.3"></divide><cn id="S3.Ex1.m1.3.3.3.cmml" type="integer" xref="S3.Ex1.m1.3.3.3">1</cn><apply id="S3.Ex1.m1.3.3.1.2.cmml" xref="S3.Ex1.m1.3.3.1.3"><abs id="S3.Ex1.m1.3.3.1.2.1.cmml" xref="S3.Ex1.m1.3.3.1.3.1"></abs><ci id="S3.Ex1.m1.3.3.1.1.cmml" xref="S3.Ex1.m1.3.3.1.1">𝑥</ci></apply></apply><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1"><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S3.Ex1.m1.9.9.1.1.1.1.1.2.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.2">subscript</csymbol><sum id="S3.Ex1.m1.9.9.1.1.1.1.1.2.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.2.2"></sum><ci id="S3.Ex1.m1.9.9.1.1.1.1.1.2.3.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.2.3">𝑖</ci></apply><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1"><times id="S3.Ex1.m1.9.9.1.1.1.1.1.1.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.2"></times><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.3"><log id="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.1"></log><ci id="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.3.2">𝑝</ci></apply><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1"><csymbol cd="latexml" id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.2">conditional</csymbol><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3">subscript</csymbol><ci id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.2">𝑥</ci><ci id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.3.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.3.3">𝑖</ci></apply><list id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1"><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1">subscript</csymbol><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.2">𝑥</ci><apply id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3"><minus id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.1.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.1"></minus><ci id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.2.cmml" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.2">𝑖</ci><cn id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.3.cmml" type="integer" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.2.3.3">1</cn></apply></apply><cn id="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.3.cmml" type="integer" xref="S3.Ex1.m1.9.9.1.1.1.1.1.1.1.1.1.1.1.1.3">1</cn></apply><ci id="S3.Ex1.m1.8.8.cmml" xref="S3.Ex1.m1.8.8">𝜃</ci></list></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex1.m1.9c">{\cal L}(D;\theta):=\frac{1}{|D|}\sum_{x\in D}\ell(x;\theta)=-\frac{1}{|D|}%
\sum_{x\in D}\frac{1}{|x|}\sum_{i}\log p(x_{i}|x^{i-1}_{1};\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.Ex1.m1.9d">caligraphic_L ( italic_D ; italic_θ ) := divide start_ARG 1 end_ARG start_ARG | italic_D | end_ARG ∑ start_POSTSUBSCRIPT italic_x ∈ italic_D end_POSTSUBSCRIPT roman_ℓ ( italic_x ; italic_θ ) = - divide start_ARG 1 end_ARG start_ARG | italic_D | end_ARG ∑ start_POSTSUBSCRIPT italic_x ∈ italic_D end_POSTSUBSCRIPT divide start_ARG 1 end_ARG start_ARG | italic_x | end_ARG ∑ start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT roman_log italic_p ( italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT | italic_x start_POSTSUPERSCRIPT italic_i - 1 end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT ; italic_θ )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS1.p1.13">where <math alttext="|D|" class="ltx_Math" display="inline" id="S3.SS1.p1.7.m1.1"><semantics id="S3.SS1.p1.7.m1.1a"><mrow id="S3.SS1.p1.7.m1.1.2.2" xref="S3.SS1.p1.7.m1.1.2.1.cmml"><mo id="S3.SS1.p1.7.m1.1.2.2.1" stretchy="false" xref="S3.SS1.p1.7.m1.1.2.1.1.cmml">|</mo><mi id="S3.SS1.p1.7.m1.1.1" xref="S3.SS1.p1.7.m1.1.1.cmml">D</mi><mo id="S3.SS1.p1.7.m1.1.2.2.2" stretchy="false" xref="S3.SS1.p1.7.m1.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.7.m1.1b"><apply id="S3.SS1.p1.7.m1.1.2.1.cmml" xref="S3.SS1.p1.7.m1.1.2.2"><abs id="S3.SS1.p1.7.m1.1.2.1.1.cmml" xref="S3.SS1.p1.7.m1.1.2.2.1"></abs><ci id="S3.SS1.p1.7.m1.1.1.cmml" xref="S3.SS1.p1.7.m1.1.1">𝐷</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.7.m1.1c">|D|</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.7.m1.1d">| italic_D |</annotation></semantics></math> denotes the cardinality of a set <math alttext="D" class="ltx_Math" display="inline" id="S3.SS1.p1.8.m2.1"><semantics id="S3.SS1.p1.8.m2.1a"><mi id="S3.SS1.p1.8.m2.1.1" xref="S3.SS1.p1.8.m2.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.8.m2.1b"><ci id="S3.SS1.p1.8.m2.1.1.cmml" xref="S3.SS1.p1.8.m2.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.8.m2.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.8.m2.1d">italic_D</annotation></semantics></math> and <math alttext="|x|" class="ltx_Math" display="inline" id="S3.SS1.p1.9.m3.1"><semantics id="S3.SS1.p1.9.m3.1a"><mrow id="S3.SS1.p1.9.m3.1.2.2" xref="S3.SS1.p1.9.m3.1.2.1.cmml"><mo id="S3.SS1.p1.9.m3.1.2.2.1" stretchy="false" xref="S3.SS1.p1.9.m3.1.2.1.1.cmml">|</mo><mi id="S3.SS1.p1.9.m3.1.1" xref="S3.SS1.p1.9.m3.1.1.cmml">x</mi><mo id="S3.SS1.p1.9.m3.1.2.2.2" stretchy="false" xref="S3.SS1.p1.9.m3.1.2.1.1.cmml">|</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.9.m3.1b"><apply id="S3.SS1.p1.9.m3.1.2.1.cmml" xref="S3.SS1.p1.9.m3.1.2.2"><abs id="S3.SS1.p1.9.m3.1.2.1.1.cmml" xref="S3.SS1.p1.9.m3.1.2.2.1"></abs><ci id="S3.SS1.p1.9.m3.1.1.cmml" xref="S3.SS1.p1.9.m3.1.1">𝑥</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.9.m3.1c">|x|</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.9.m3.1d">| italic_x |</annotation></semantics></math> denotes the length of sequence <span class="ltx_text" id="S3.SS1.p1.10.1"><math alttext="x=x^{|x|}_{0}=(x_{1},\ldots,x_{|x|})" class="ltx_Math" display="inline" id="S3.SS1.p1.10.1.m1.5"><semantics id="S3.SS1.p1.10.1.m1.5a"><mrow id="S3.SS1.p1.10.1.m1.5.5" xref="S3.SS1.p1.10.1.m1.5.5.cmml"><mi id="S3.SS1.p1.10.1.m1.5.5.4" xref="S3.SS1.p1.10.1.m1.5.5.4.cmml">x</mi><mo id="S3.SS1.p1.10.1.m1.5.5.5" xref="S3.SS1.p1.10.1.m1.5.5.5.cmml">=</mo><msubsup id="S3.SS1.p1.10.1.m1.5.5.6" xref="S3.SS1.p1.10.1.m1.5.5.6.cmml"><mi id="S3.SS1.p1.10.1.m1.5.5.6.2.2" xref="S3.SS1.p1.10.1.m1.5.5.6.2.2.cmml">x</mi><mn id="S3.SS1.p1.10.1.m1.5.5.6.3" xref="S3.SS1.p1.10.1.m1.5.5.6.3.cmml">0</mn><mrow id="S3.SS1.p1.10.1.m1.1.1.1.3" xref="S3.SS1.p1.10.1.m1.1.1.1.2.cmml"><mo id="S3.SS1.p1.10.1.m1.1.1.1.3.1" stretchy="false" xref="S3.SS1.p1.10.1.m1.1.1.1.2.1.cmml">|</mo><mi id="S3.SS1.p1.10.1.m1.1.1.1.1" xref="S3.SS1.p1.10.1.m1.1.1.1.1.cmml">x</mi><mo id="S3.SS1.p1.10.1.m1.1.1.1.3.2" stretchy="false" xref="S3.SS1.p1.10.1.m1.1.1.1.2.1.cmml">|</mo></mrow></msubsup><mo id="S3.SS1.p1.10.1.m1.5.5.7" xref="S3.SS1.p1.10.1.m1.5.5.7.cmml">=</mo><mrow id="S3.SS1.p1.10.1.m1.5.5.2.2" xref="S3.SS1.p1.10.1.m1.5.5.2.3.cmml"><mo id="S3.SS1.p1.10.1.m1.5.5.2.2.3" stretchy="false" xref="S3.SS1.p1.10.1.m1.5.5.2.3.cmml">(</mo><msub id="S3.SS1.p1.10.1.m1.4.4.1.1.1" xref="S3.SS1.p1.10.1.m1.4.4.1.1.1.cmml"><mi id="S3.SS1.p1.10.1.m1.4.4.1.1.1.2" xref="S3.SS1.p1.10.1.m1.4.4.1.1.1.2.cmml">x</mi><mn id="S3.SS1.p1.10.1.m1.4.4.1.1.1.3" xref="S3.SS1.p1.10.1.m1.4.4.1.1.1.3.cmml">1</mn></msub><mo id="S3.SS1.p1.10.1.m1.5.5.2.2.4" xref="S3.SS1.p1.10.1.m1.5.5.2.3.cmml">,</mo><mi id="S3.SS1.p1.10.1.m1.3.3" mathvariant="normal" xref="S3.SS1.p1.10.1.m1.3.3.cmml">…</mi><mo id="S3.SS1.p1.10.1.m1.5.5.2.2.5" xref="S3.SS1.p1.10.1.m1.5.5.2.3.cmml">,</mo><msub id="S3.SS1.p1.10.1.m1.5.5.2.2.2" xref="S3.SS1.p1.10.1.m1.5.5.2.2.2.cmml"><mi id="S3.SS1.p1.10.1.m1.5.5.2.2.2.2" xref="S3.SS1.p1.10.1.m1.5.5.2.2.2.2.cmml">x</mi><mrow id="S3.SS1.p1.10.1.m1.2.2.1.3" xref="S3.SS1.p1.10.1.m1.2.2.1.2.cmml"><mo id="S3.SS1.p1.10.1.m1.2.2.1.3.1" stretchy="false" xref="S3.SS1.p1.10.1.m1.2.2.1.2.1.cmml">|</mo><mi id="S3.SS1.p1.10.1.m1.2.2.1.1" xref="S3.SS1.p1.10.1.m1.2.2.1.1.cmml">x</mi><mo id="S3.SS1.p1.10.1.m1.2.2.1.3.2" stretchy="false" xref="S3.SS1.p1.10.1.m1.2.2.1.2.1.cmml">|</mo></mrow></msub><mo id="S3.SS1.p1.10.1.m1.5.5.2.2.6" stretchy="false" xref="S3.SS1.p1.10.1.m1.5.5.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.10.1.m1.5b"><apply id="S3.SS1.p1.10.1.m1.5.5.cmml" xref="S3.SS1.p1.10.1.m1.5.5"><and id="S3.SS1.p1.10.1.m1.5.5a.cmml" xref="S3.SS1.p1.10.1.m1.5.5"></and><apply id="S3.SS1.p1.10.1.m1.5.5b.cmml" xref="S3.SS1.p1.10.1.m1.5.5"><eq id="S3.SS1.p1.10.1.m1.5.5.5.cmml" xref="S3.SS1.p1.10.1.m1.5.5.5"></eq><ci id="S3.SS1.p1.10.1.m1.5.5.4.cmml" xref="S3.SS1.p1.10.1.m1.5.5.4">𝑥</ci><apply id="S3.SS1.p1.10.1.m1.5.5.6.cmml" xref="S3.SS1.p1.10.1.m1.5.5.6"><csymbol cd="ambiguous" id="S3.SS1.p1.10.1.m1.5.5.6.1.cmml" xref="S3.SS1.p1.10.1.m1.5.5.6">subscript</csymbol><apply id="S3.SS1.p1.10.1.m1.5.5.6.2.cmml" xref="S3.SS1.p1.10.1.m1.5.5.6"><csymbol cd="ambiguous" id="S3.SS1.p1.10.1.m1.5.5.6.2.1.cmml" xref="S3.SS1.p1.10.1.m1.5.5.6">superscript</csymbol><ci id="S3.SS1.p1.10.1.m1.5.5.6.2.2.cmml" xref="S3.SS1.p1.10.1.m1.5.5.6.2.2">𝑥</ci><apply id="S3.SS1.p1.10.1.m1.1.1.1.2.cmml" xref="S3.SS1.p1.10.1.m1.1.1.1.3"><abs id="S3.SS1.p1.10.1.m1.1.1.1.2.1.cmml" xref="S3.SS1.p1.10.1.m1.1.1.1.3.1"></abs><ci id="S3.SS1.p1.10.1.m1.1.1.1.1.cmml" xref="S3.SS1.p1.10.1.m1.1.1.1.1">𝑥</ci></apply></apply><cn id="S3.SS1.p1.10.1.m1.5.5.6.3.cmml" type="integer" xref="S3.SS1.p1.10.1.m1.5.5.6.3">0</cn></apply></apply><apply id="S3.SS1.p1.10.1.m1.5.5c.cmml" xref="S3.SS1.p1.10.1.m1.5.5"><eq id="S3.SS1.p1.10.1.m1.5.5.7.cmml" xref="S3.SS1.p1.10.1.m1.5.5.7"></eq><share href="https://arxiv.org/html/2410.03735v1#S3.SS1.p1.10.1.m1.5.5.6.cmml" id="S3.SS1.p1.10.1.m1.5.5d.cmml" xref="S3.SS1.p1.10.1.m1.5.5"></share><vector id="S3.SS1.p1.10.1.m1.5.5.2.3.cmml" xref="S3.SS1.p1.10.1.m1.5.5.2.2"><apply id="S3.SS1.p1.10.1.m1.4.4.1.1.1.cmml" xref="S3.SS1.p1.10.1.m1.4.4.1.1.1"><csymbol cd="ambiguous" id="S3.SS1.p1.10.1.m1.4.4.1.1.1.1.cmml" xref="S3.SS1.p1.10.1.m1.4.4.1.1.1">subscript</csymbol><ci id="S3.SS1.p1.10.1.m1.4.4.1.1.1.2.cmml" xref="S3.SS1.p1.10.1.m1.4.4.1.1.1.2">𝑥</ci><cn id="S3.SS1.p1.10.1.m1.4.4.1.1.1.3.cmml" type="integer" xref="S3.SS1.p1.10.1.m1.4.4.1.1.1.3">1</cn></apply><ci id="S3.SS1.p1.10.1.m1.3.3.cmml" xref="S3.SS1.p1.10.1.m1.3.3">…</ci><apply id="S3.SS1.p1.10.1.m1.5.5.2.2.2.cmml" xref="S3.SS1.p1.10.1.m1.5.5.2.2.2"><csymbol cd="ambiguous" id="S3.SS1.p1.10.1.m1.5.5.2.2.2.1.cmml" xref="S3.SS1.p1.10.1.m1.5.5.2.2.2">subscript</csymbol><ci id="S3.SS1.p1.10.1.m1.5.5.2.2.2.2.cmml" xref="S3.SS1.p1.10.1.m1.5.5.2.2.2.2">𝑥</ci><apply id="S3.SS1.p1.10.1.m1.2.2.1.2.cmml" xref="S3.SS1.p1.10.1.m1.2.2.1.3"><abs id="S3.SS1.p1.10.1.m1.2.2.1.2.1.cmml" xref="S3.SS1.p1.10.1.m1.2.2.1.3.1"></abs><ci id="S3.SS1.p1.10.1.m1.2.2.1.1.cmml" xref="S3.SS1.p1.10.1.m1.2.2.1.1">𝑥</ci></apply></apply></vector></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.10.1.m1.5c">x=x^{|x|}_{0}=(x_{1},\ldots,x_{|x|})</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.10.1.m1.5d">italic_x = italic_x start_POSTSUPERSCRIPT | italic_x | end_POSTSUPERSCRIPT start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT = ( italic_x start_POSTSUBSCRIPT 1 end_POSTSUBSCRIPT , … , italic_x start_POSTSUBSCRIPT | italic_x | end_POSTSUBSCRIPT )</annotation></semantics></math></span>. The perplexity of model <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS1.p1.11.m4.1"><semantics id="S3.SS1.p1.11.m4.1a"><mi id="S3.SS1.p1.11.m4.1.1" xref="S3.SS1.p1.11.m4.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.11.m4.1b"><ci id="S3.SS1.p1.11.m4.1.1.cmml" xref="S3.SS1.p1.11.m4.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.11.m4.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.11.m4.1d">italic_θ</annotation></semantics></math> on the dataset <math alttext="D" class="ltx_Math" display="inline" id="S3.SS1.p1.12.m5.1"><semantics id="S3.SS1.p1.12.m5.1a"><mi id="S3.SS1.p1.12.m5.1.1" xref="S3.SS1.p1.12.m5.1.1.cmml">D</mi><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.12.m5.1b"><ci id="S3.SS1.p1.12.m5.1.1.cmml" xref="S3.SS1.p1.12.m5.1.1">𝐷</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.12.m5.1c">D</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.12.m5.1d">italic_D</annotation></semantics></math> is <math alttext="{\cal P}(D;\theta):=\exp({\cal L}(D;\theta))." class="ltx_Math" display="inline" id="S3.SS1.p1.13.m6.6"><semantics id="S3.SS1.p1.13.m6.6a"><mrow id="S3.SS1.p1.13.m6.6.6.1" xref="S3.SS1.p1.13.m6.6.6.1.1.cmml"><mrow id="S3.SS1.p1.13.m6.6.6.1.1" xref="S3.SS1.p1.13.m6.6.6.1.1.cmml"><mrow id="S3.SS1.p1.13.m6.6.6.1.1.3" xref="S3.SS1.p1.13.m6.6.6.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.13.m6.6.6.1.1.3.2" xref="S3.SS1.p1.13.m6.6.6.1.1.3.2.cmml">𝒫</mi><mo id="S3.SS1.p1.13.m6.6.6.1.1.3.1" xref="S3.SS1.p1.13.m6.6.6.1.1.3.1.cmml">⁢</mo><mrow id="S3.SS1.p1.13.m6.6.6.1.1.3.3.2" xref="S3.SS1.p1.13.m6.6.6.1.1.3.3.1.cmml"><mo id="S3.SS1.p1.13.m6.6.6.1.1.3.3.2.1" stretchy="false" xref="S3.SS1.p1.13.m6.6.6.1.1.3.3.1.cmml">(</mo><mi id="S3.SS1.p1.13.m6.1.1" xref="S3.SS1.p1.13.m6.1.1.cmml">D</mi><mo id="S3.SS1.p1.13.m6.6.6.1.1.3.3.2.2" xref="S3.SS1.p1.13.m6.6.6.1.1.3.3.1.cmml">;</mo><mi id="S3.SS1.p1.13.m6.2.2" xref="S3.SS1.p1.13.m6.2.2.cmml">θ</mi><mo id="S3.SS1.p1.13.m6.6.6.1.1.3.3.2.3" rspace="0.278em" stretchy="false" xref="S3.SS1.p1.13.m6.6.6.1.1.3.3.1.cmml">)</mo></mrow></mrow><mo id="S3.SS1.p1.13.m6.6.6.1.1.2" rspace="0.278em" xref="S3.SS1.p1.13.m6.6.6.1.1.2.cmml">:=</mo><mrow id="S3.SS1.p1.13.m6.6.6.1.1.1.1" xref="S3.SS1.p1.13.m6.6.6.1.1.1.2.cmml"><mi id="S3.SS1.p1.13.m6.5.5" xref="S3.SS1.p1.13.m6.5.5.cmml">exp</mi><mo id="S3.SS1.p1.13.m6.6.6.1.1.1.1a" xref="S3.SS1.p1.13.m6.6.6.1.1.1.2.cmml">⁡</mo><mrow id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1" xref="S3.SS1.p1.13.m6.6.6.1.1.1.2.cmml"><mo id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.2" stretchy="false" xref="S3.SS1.p1.13.m6.6.6.1.1.1.2.cmml">(</mo><mrow id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.2" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.2.cmml">ℒ</mi><mo id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.1" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.2" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.1.cmml"><mo id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.2.1" stretchy="false" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.1.cmml">(</mo><mi id="S3.SS1.p1.13.m6.3.3" xref="S3.SS1.p1.13.m6.3.3.cmml">D</mi><mo id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.2.2" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.1.cmml">;</mo><mi id="S3.SS1.p1.13.m6.4.4" xref="S3.SS1.p1.13.m6.4.4.cmml">θ</mi><mo id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.2.3" stretchy="false" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.1.cmml">)</mo></mrow></mrow><mo id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.3" stretchy="false" xref="S3.SS1.p1.13.m6.6.6.1.1.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S3.SS1.p1.13.m6.6.6.1.2" lspace="0em" xref="S3.SS1.p1.13.m6.6.6.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.SS1.p1.13.m6.6b"><apply id="S3.SS1.p1.13.m6.6.6.1.1.cmml" xref="S3.SS1.p1.13.m6.6.6.1"><csymbol cd="latexml" id="S3.SS1.p1.13.m6.6.6.1.1.2.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.2">assign</csymbol><apply id="S3.SS1.p1.13.m6.6.6.1.1.3.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.3"><times id="S3.SS1.p1.13.m6.6.6.1.1.3.1.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.3.1"></times><ci id="S3.SS1.p1.13.m6.6.6.1.1.3.2.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.3.2">𝒫</ci><list id="S3.SS1.p1.13.m6.6.6.1.1.3.3.1.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.3.3.2"><ci id="S3.SS1.p1.13.m6.1.1.cmml" xref="S3.SS1.p1.13.m6.1.1">𝐷</ci><ci id="S3.SS1.p1.13.m6.2.2.cmml" xref="S3.SS1.p1.13.m6.2.2">𝜃</ci></list></apply><apply id="S3.SS1.p1.13.m6.6.6.1.1.1.2.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1"><exp id="S3.SS1.p1.13.m6.5.5.cmml" xref="S3.SS1.p1.13.m6.5.5"></exp><apply id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1"><times id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.1.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.1"></times><ci id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.2.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.2">ℒ</ci><list id="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.1.cmml" xref="S3.SS1.p1.13.m6.6.6.1.1.1.1.1.1.3.2"><ci id="S3.SS1.p1.13.m6.3.3.cmml" xref="S3.SS1.p1.13.m6.3.3">𝐷</ci><ci id="S3.SS1.p1.13.m6.4.4.cmml" xref="S3.SS1.p1.13.m6.4.4">𝜃</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS1.p1.13.m6.6c">{\cal P}(D;\theta):=\exp({\cal L}(D;\theta)).</annotation><annotation encoding="application/x-llamapun" id="S3.SS1.p1.13.m6.6d">caligraphic_P ( italic_D ; italic_θ ) := roman_exp ( caligraphic_L ( italic_D ; italic_θ ) ) .</annotation></semantics></math></p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.2 </span>Classification</h3>
<div class="ltx_para ltx_noindent" id="S3.SS2.p1">
<p class="ltx_p" id="S3.SS2.p1.4">A binary classifier is trained to estimate the probability that a generalist pretraining document belongs to the targeted domain. The classifier <math alttext="\phi" class="ltx_Math" display="inline" id="S3.SS2.p1.1.m1.1"><semantics id="S3.SS2.p1.1.m1.1a"><mi id="S3.SS2.p1.1.m1.1.1" xref="S3.SS2.p1.1.m1.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.1.m1.1b"><ci id="S3.SS2.p1.1.m1.1.1.cmml" xref="S3.SS2.p1.1.m1.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.1.m1.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.1.m1.1d">italic_ϕ</annotation></semantics></math> is learned using positive examples from <math alttext="D^{\rm s}" class="ltx_Math" display="inline" id="S3.SS2.p1.2.m2.1"><semantics id="S3.SS2.p1.2.m2.1a"><msup id="S3.SS2.p1.2.m2.1.1" xref="S3.SS2.p1.2.m2.1.1.cmml"><mi id="S3.SS2.p1.2.m2.1.1.2" xref="S3.SS2.p1.2.m2.1.1.2.cmml">D</mi><mi id="S3.SS2.p1.2.m2.1.1.3" mathvariant="normal" xref="S3.SS2.p1.2.m2.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.2.m2.1b"><apply id="S3.SS2.p1.2.m2.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.2.m2.1.1.1.cmml" xref="S3.SS2.p1.2.m2.1.1">superscript</csymbol><ci id="S3.SS2.p1.2.m2.1.1.2.cmml" xref="S3.SS2.p1.2.m2.1.1.2">𝐷</ci><ci id="S3.SS2.p1.2.m2.1.1.3.cmml" xref="S3.SS2.p1.2.m2.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.2.m2.1c">D^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.2.m2.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math> and a subset of <math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="S3.SS2.p1.3.m3.1"><semantics id="S3.SS2.p1.3.m3.1a"><msup id="S3.SS2.p1.3.m3.1.1" xref="S3.SS2.p1.3.m3.1.1.cmml"><mi id="S3.SS2.p1.3.m3.1.1.2" xref="S3.SS2.p1.3.m3.1.1.2.cmml">D</mi><mi id="S3.SS2.p1.3.m3.1.1.3" mathvariant="normal" xref="S3.SS2.p1.3.m3.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.3.m3.1b"><apply id="S3.SS2.p1.3.m3.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.3.m3.1.1.1.cmml" xref="S3.SS2.p1.3.m3.1.1">superscript</csymbol><ci id="S3.SS2.p1.3.m3.1.1.2.cmml" xref="S3.SS2.p1.3.m3.1.1.2">𝐷</ci><ci id="S3.SS2.p1.3.m3.1.1.3.cmml" xref="S3.SS2.p1.3.m3.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.3.m3.1c">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.3.m3.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> as negative examples. <math alttext="\phi" class="ltx_Math" display="inline" id="S3.SS2.p1.4.m4.1"><semantics id="S3.SS2.p1.4.m4.1a"><mi id="S3.SS2.p1.4.m4.1.1" xref="S3.SS2.p1.4.m4.1.1.cmml">ϕ</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.4.m4.1b"><ci id="S3.SS2.p1.4.m4.1.1.cmml" xref="S3.SS2.p1.4.m4.1.1">italic-ϕ</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.4.m4.1c">\phi</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.4.m4.1d">italic_ϕ</annotation></semantics></math> then builds a domain-specific pretraining set</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="C(D^{\rm g},t):=\{x\in D^{\rm g}\text{ such that }\phi(x)&gt;t\}." class="ltx_Math" display="block" id="S3.Ex2.m1.3"><semantics id="S3.Ex2.m1.3a"><mrow id="S3.Ex2.m1.3.3.1" xref="S3.Ex2.m1.3.3.1.1.cmml"><mrow id="S3.Ex2.m1.3.3.1.1" xref="S3.Ex2.m1.3.3.1.1.cmml"><mrow id="S3.Ex2.m1.3.3.1.1.1" xref="S3.Ex2.m1.3.3.1.1.1.cmml"><mi id="S3.Ex2.m1.3.3.1.1.1.3" xref="S3.Ex2.m1.3.3.1.1.1.3.cmml">C</mi><mo id="S3.Ex2.m1.3.3.1.1.1.2" xref="S3.Ex2.m1.3.3.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex2.m1.3.3.1.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.1.1.2.cmml"><mo id="S3.Ex2.m1.3.3.1.1.1.1.1.2" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.1.1.2.cmml">(</mo><msup id="S3.Ex2.m1.3.3.1.1.1.1.1.1" xref="S3.Ex2.m1.3.3.1.1.1.1.1.1.cmml"><mi id="S3.Ex2.m1.3.3.1.1.1.1.1.1.2" xref="S3.Ex2.m1.3.3.1.1.1.1.1.1.2.cmml">D</mi><mi id="S3.Ex2.m1.3.3.1.1.1.1.1.1.3" mathvariant="normal" xref="S3.Ex2.m1.3.3.1.1.1.1.1.1.3.cmml">g</mi></msup><mo id="S3.Ex2.m1.3.3.1.1.1.1.1.3" xref="S3.Ex2.m1.3.3.1.1.1.1.2.cmml">,</mo><mi id="S3.Ex2.m1.1.1" xref="S3.Ex2.m1.1.1.cmml">t</mi><mo id="S3.Ex2.m1.3.3.1.1.1.1.1.4" rspace="0.278em" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.Ex2.m1.3.3.1.1.3" rspace="0.278em" xref="S3.Ex2.m1.3.3.1.1.3.cmml">:=</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.1" xref="S3.Ex2.m1.3.3.1.1.2.2.cmml"><mo id="S3.Ex2.m1.3.3.1.1.2.1.2" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.2.2.cmml">{</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.1.1" xref="S3.Ex2.m1.3.3.1.1.2.1.1.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.1.1.2" xref="S3.Ex2.m1.3.3.1.1.2.1.1.2.cmml">x</mi><mo id="S3.Ex2.m1.3.3.1.1.2.1.1.3" xref="S3.Ex2.m1.3.3.1.1.2.1.1.3.cmml">∈</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.1.1.4" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.cmml"><msup id="S3.Ex2.m1.3.3.1.1.2.1.1.4.2" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.cmml"><mi id="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.2" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.2.cmml">D</mi><mi id="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.3" mathvariant="normal" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.3.cmml">g</mi></msup><mo id="S3.Ex2.m1.3.3.1.1.2.1.1.4.1" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.1.cmml">⁢</mo><mtext id="S3.Ex2.m1.3.3.1.1.2.1.1.4.3" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.3a.cmml"> such that </mtext><mo id="S3.Ex2.m1.3.3.1.1.2.1.1.4.1a" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.1.cmml">⁢</mo><mi id="S3.Ex2.m1.3.3.1.1.2.1.1.4.4" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.4.cmml">ϕ</mi><mo id="S3.Ex2.m1.3.3.1.1.2.1.1.4.1b" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.1.cmml">⁢</mo><mrow id="S3.Ex2.m1.3.3.1.1.2.1.1.4.5.2" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.cmml"><mo id="S3.Ex2.m1.3.3.1.1.2.1.1.4.5.2.1" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.cmml">(</mo><mi id="S3.Ex2.m1.2.2" xref="S3.Ex2.m1.2.2.cmml">x</mi><mo id="S3.Ex2.m1.3.3.1.1.2.1.1.4.5.2.2" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.cmml">)</mo></mrow></mrow><mo id="S3.Ex2.m1.3.3.1.1.2.1.1.5" xref="S3.Ex2.m1.3.3.1.1.2.1.1.5.cmml">&gt;</mo><mi id="S3.Ex2.m1.3.3.1.1.2.1.1.6" xref="S3.Ex2.m1.3.3.1.1.2.1.1.6.cmml">t</mi></mrow><mo id="S3.Ex2.m1.3.3.1.1.2.1.3" stretchy="false" xref="S3.Ex2.m1.3.3.1.1.2.2.cmml">}</mo></mrow></mrow><mo id="S3.Ex2.m1.3.3.1.2" lspace="0em" xref="S3.Ex2.m1.3.3.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex2.m1.3b"><apply id="S3.Ex2.m1.3.3.1.1.cmml" xref="S3.Ex2.m1.3.3.1"><csymbol cd="latexml" id="S3.Ex2.m1.3.3.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.3">assign</csymbol><apply id="S3.Ex2.m1.3.3.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1"><times id="S3.Ex2.m1.3.3.1.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.2"></times><ci id="S3.Ex2.m1.3.3.1.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.3">𝐶</ci><interval closure="open" id="S3.Ex2.m1.3.3.1.1.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.1"><apply id="S3.Ex2.m1.3.3.1.1.1.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.1.1.1.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.1.1">superscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.1.1.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.1.1.2">𝐷</ci><ci id="S3.Ex2.m1.3.3.1.1.1.1.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.1.1.1.1.3">g</ci></apply><ci id="S3.Ex2.m1.1.1.cmml" xref="S3.Ex2.m1.1.1">𝑡</ci></interval></apply><set id="S3.Ex2.m1.3.3.1.1.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1"><apply id="S3.Ex2.m1.3.3.1.1.2.1.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1"><and id="S3.Ex2.m1.3.3.1.1.2.1.1a.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1"></and><apply id="S3.Ex2.m1.3.3.1.1.2.1.1b.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1"><in id="S3.Ex2.m1.3.3.1.1.2.1.1.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.3"></in><ci id="S3.Ex2.m1.3.3.1.1.2.1.1.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.2">𝑥</ci><apply id="S3.Ex2.m1.3.3.1.1.2.1.1.4.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4"><times id="S3.Ex2.m1.3.3.1.1.2.1.1.4.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.1"></times><apply id="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.2"><csymbol cd="ambiguous" id="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.1.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.2">superscript</csymbol><ci id="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.2.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.2">𝐷</ci><ci id="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.2.3">g</ci></apply><ci id="S3.Ex2.m1.3.3.1.1.2.1.1.4.3a.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.3"><mtext id="S3.Ex2.m1.3.3.1.1.2.1.1.4.3.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.3"> such that </mtext></ci><ci id="S3.Ex2.m1.3.3.1.1.2.1.1.4.4.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.4.4">italic-ϕ</ci><ci id="S3.Ex2.m1.2.2.cmml" xref="S3.Ex2.m1.2.2">𝑥</ci></apply></apply><apply id="S3.Ex2.m1.3.3.1.1.2.1.1c.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1"><gt id="S3.Ex2.m1.3.3.1.1.2.1.1.5.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.5"></gt><share href="https://arxiv.org/html/2410.03735v1#S3.Ex2.m1.3.3.1.1.2.1.1.4.cmml" id="S3.Ex2.m1.3.3.1.1.2.1.1d.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1"></share><ci id="S3.Ex2.m1.3.3.1.1.2.1.1.6.cmml" xref="S3.Ex2.m1.3.3.1.1.2.1.1.6">𝑡</ci></apply></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex2.m1.3c">C(D^{\rm g},t):=\{x\in D^{\rm g}\text{ such that }\phi(x)&gt;t\}.</annotation><annotation encoding="application/x-llamapun" id="S3.Ex2.m1.3d">italic_C ( italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT , italic_t ) := { italic_x ∈ italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT such that italic_ϕ ( italic_x ) &gt; italic_t } .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS2.p1.7">which restrict the generic dataset <math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="S3.SS2.p1.5.m1.1"><semantics id="S3.SS2.p1.5.m1.1a"><msup id="S3.SS2.p1.5.m1.1.1" xref="S3.SS2.p1.5.m1.1.1.cmml"><mi id="S3.SS2.p1.5.m1.1.1.2" xref="S3.SS2.p1.5.m1.1.1.2.cmml">D</mi><mi id="S3.SS2.p1.5.m1.1.1.3" mathvariant="normal" xref="S3.SS2.p1.5.m1.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.5.m1.1b"><apply id="S3.SS2.p1.5.m1.1.1.cmml" xref="S3.SS2.p1.5.m1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.5.m1.1.1.1.cmml" xref="S3.SS2.p1.5.m1.1.1">superscript</csymbol><ci id="S3.SS2.p1.5.m1.1.1.2.cmml" xref="S3.SS2.p1.5.m1.1.1.2">𝐷</ci><ci id="S3.SS2.p1.5.m1.1.1.3.cmml" xref="S3.SS2.p1.5.m1.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.5.m1.1c">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.5.m1.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> to the examples with an estimated probability to be in-domain above threshold <math alttext="t" class="ltx_Math" display="inline" id="S3.SS2.p1.6.m2.1"><semantics id="S3.SS2.p1.6.m2.1a"><mi id="S3.SS2.p1.6.m2.1.1" xref="S3.SS2.p1.6.m2.1.1.cmml">t</mi><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.6.m2.1b"><ci id="S3.SS2.p1.6.m2.1.1.cmml" xref="S3.SS2.p1.6.m2.1.1">𝑡</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.6.m2.1c">t</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.6.m2.1d">italic_t</annotation></semantics></math>.
The threshold is validated as a trade-off between focusing on data close to the domain of interest while keeping <math alttext="C(D_{g},t)" class="ltx_Math" display="inline" id="S3.SS2.p1.7.m3.2"><semantics id="S3.SS2.p1.7.m3.2a"><mrow id="S3.SS2.p1.7.m3.2.2" xref="S3.SS2.p1.7.m3.2.2.cmml"><mi id="S3.SS2.p1.7.m3.2.2.3" xref="S3.SS2.p1.7.m3.2.2.3.cmml">C</mi><mo id="S3.SS2.p1.7.m3.2.2.2" xref="S3.SS2.p1.7.m3.2.2.2.cmml">⁢</mo><mrow id="S3.SS2.p1.7.m3.2.2.1.1" xref="S3.SS2.p1.7.m3.2.2.1.2.cmml"><mo id="S3.SS2.p1.7.m3.2.2.1.1.2" stretchy="false" xref="S3.SS2.p1.7.m3.2.2.1.2.cmml">(</mo><msub id="S3.SS2.p1.7.m3.2.2.1.1.1" xref="S3.SS2.p1.7.m3.2.2.1.1.1.cmml"><mi id="S3.SS2.p1.7.m3.2.2.1.1.1.2" xref="S3.SS2.p1.7.m3.2.2.1.1.1.2.cmml">D</mi><mi id="S3.SS2.p1.7.m3.2.2.1.1.1.3" xref="S3.SS2.p1.7.m3.2.2.1.1.1.3.cmml">g</mi></msub><mo id="S3.SS2.p1.7.m3.2.2.1.1.3" xref="S3.SS2.p1.7.m3.2.2.1.2.cmml">,</mo><mi id="S3.SS2.p1.7.m3.1.1" xref="S3.SS2.p1.7.m3.1.1.cmml">t</mi><mo id="S3.SS2.p1.7.m3.2.2.1.1.4" stretchy="false" xref="S3.SS2.p1.7.m3.2.2.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS2.p1.7.m3.2b"><apply id="S3.SS2.p1.7.m3.2.2.cmml" xref="S3.SS2.p1.7.m3.2.2"><times id="S3.SS2.p1.7.m3.2.2.2.cmml" xref="S3.SS2.p1.7.m3.2.2.2"></times><ci id="S3.SS2.p1.7.m3.2.2.3.cmml" xref="S3.SS2.p1.7.m3.2.2.3">𝐶</ci><interval closure="open" id="S3.SS2.p1.7.m3.2.2.1.2.cmml" xref="S3.SS2.p1.7.m3.2.2.1.1"><apply id="S3.SS2.p1.7.m3.2.2.1.1.1.cmml" xref="S3.SS2.p1.7.m3.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.SS2.p1.7.m3.2.2.1.1.1.1.cmml" xref="S3.SS2.p1.7.m3.2.2.1.1.1">subscript</csymbol><ci id="S3.SS2.p1.7.m3.2.2.1.1.1.2.cmml" xref="S3.SS2.p1.7.m3.2.2.1.1.1.2">𝐷</ci><ci id="S3.SS2.p1.7.m3.2.2.1.1.1.3.cmml" xref="S3.SS2.p1.7.m3.2.2.1.1.1.3">𝑔</ci></apply><ci id="S3.SS2.p1.7.m3.1.1.cmml" xref="S3.SS2.p1.7.m3.1.1">𝑡</ci></interval></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS2.p1.7.m3.2c">C(D_{g},t)</annotation><annotation encoding="application/x-llamapun" id="S3.SS2.p1.7.m3.2d">italic_C ( italic_D start_POSTSUBSCRIPT italic_g end_POSTSUBSCRIPT , italic_t )</annotation></semantics></math> large enough to train an LM of the targeted capacity.
In our case, we rely on a logistic regression classifier trained over sentence BERT (SBERT) text embeddings <cite class="ltx_cite ltx_citemacro_citep">(Reimers &amp; Gurevych, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib53" title="">2019</a>)</cite>, an established classification method <cite class="ltx_cite ltx_citemacro_citep">(Minaee et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib46" title="">2021</a>)</cite>. The SBERT representation is also commonly used in data selection <cite class="ltx_cite ltx_citemacro_citep">(Albalak et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib2" title="">2024</a>; Xie et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib70" title="">2023c</a>; Zhang et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib75" title="">2024</a>; Su et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib59" title="">2023</a>)</cite>. This representation is also used in the alternative selection strategies we consider. As an ablation, we also evaluate the impact of the choice of SBERT (Section <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.SS1" title="5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">5.1</span></a>).</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.3 </span>Gradient-Alignment</h3>
<div class="ltx_para ltx_noindent" id="S3.SS3.p1">
<p class="ltx_p" id="S3.SS3.p1.5">Gradient-Alignment (GA) methods are common when the generic pretraining set <math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="S3.SS3.p1.1.m1.1"><semantics id="S3.SS3.p1.1.m1.1a"><msup id="S3.SS3.p1.1.m1.1.1" xref="S3.SS3.p1.1.m1.1.1.cmml"><mi id="S3.SS3.p1.1.m1.1.1.2" xref="S3.SS3.p1.1.m1.1.1.2.cmml">D</mi><mi id="S3.SS3.p1.1.m1.1.1.3" mathvariant="normal" xref="S3.SS3.p1.1.m1.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.1.m1.1b"><apply id="S3.SS3.p1.1.m1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.1.m1.1.1.1.cmml" xref="S3.SS3.p1.1.m1.1.1">superscript</csymbol><ci id="S3.SS3.p1.1.m1.1.1.2.cmml" xref="S3.SS3.p1.1.m1.1.1.2">𝐷</ci><ci id="S3.SS3.p1.1.m1.1.1.3.cmml" xref="S3.SS3.p1.1.m1.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.1.m1.1c">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.1.m1.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> originates from <math alttext="n_{\rm g}" class="ltx_Math" display="inline" id="S3.SS3.p1.2.m2.1"><semantics id="S3.SS3.p1.2.m2.1a"><msub id="S3.SS3.p1.2.m2.1.1" xref="S3.SS3.p1.2.m2.1.1.cmml"><mi id="S3.SS3.p1.2.m2.1.1.2" xref="S3.SS3.p1.2.m2.1.1.2.cmml">n</mi><mi id="S3.SS3.p1.2.m2.1.1.3" mathvariant="normal" xref="S3.SS3.p1.2.m2.1.1.3.cmml">g</mi></msub><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.2.m2.1b"><apply id="S3.SS3.p1.2.m2.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.2.m2.1.1.1.cmml" xref="S3.SS3.p1.2.m2.1.1">subscript</csymbol><ci id="S3.SS3.p1.2.m2.1.1.2.cmml" xref="S3.SS3.p1.2.m2.1.1.2">𝑛</ci><ci id="S3.SS3.p1.2.m2.1.1.3.cmml" xref="S3.SS3.p1.2.m2.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.2.m2.1c">n_{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.2.m2.1d">italic_n start_POSTSUBSCRIPT roman_g end_POSTSUBSCRIPT</annotation></semantics></math> different data sources
<math alttext="S" class="ltx_Math" display="inline" id="S3.SS3.p1.3.m3.1"><semantics id="S3.SS3.p1.3.m3.1a"><mi id="S3.SS3.p1.3.m3.1.1" xref="S3.SS3.p1.3.m3.1.1.cmml">S</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.3.m3.1b"><ci id="S3.SS3.p1.3.m3.1.1.cmml" xref="S3.SS3.p1.3.m3.1.1">𝑆</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.3.m3.1c">S</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.3.m3.1d">italic_S</annotation></semantics></math>, i.e. <math alttext="D^{\rm g}=\bigcup^{n_{\rm g}}_{i=1}D^{\rm g}_{i}" class="ltx_Math" display="inline" id="S3.SS3.p1.4.m4.1"><semantics id="S3.SS3.p1.4.m4.1a"><mrow id="S3.SS3.p1.4.m4.1.1" xref="S3.SS3.p1.4.m4.1.1.cmml"><msup id="S3.SS3.p1.4.m4.1.1.2" xref="S3.SS3.p1.4.m4.1.1.2.cmml"><mi id="S3.SS3.p1.4.m4.1.1.2.2" xref="S3.SS3.p1.4.m4.1.1.2.2.cmml">D</mi><mi id="S3.SS3.p1.4.m4.1.1.2.3" mathvariant="normal" xref="S3.SS3.p1.4.m4.1.1.2.3.cmml">g</mi></msup><mo id="S3.SS3.p1.4.m4.1.1.1" rspace="0.111em" xref="S3.SS3.p1.4.m4.1.1.1.cmml">=</mo><mrow id="S3.SS3.p1.4.m4.1.1.3" xref="S3.SS3.p1.4.m4.1.1.3.cmml"><msubsup id="S3.SS3.p1.4.m4.1.1.3.1" xref="S3.SS3.p1.4.m4.1.1.3.1.cmml"><mo id="S3.SS3.p1.4.m4.1.1.3.1.2.2" xref="S3.SS3.p1.4.m4.1.1.3.1.2.2.cmml">⋃</mo><mrow id="S3.SS3.p1.4.m4.1.1.3.1.3" xref="S3.SS3.p1.4.m4.1.1.3.1.3.cmml"><mi id="S3.SS3.p1.4.m4.1.1.3.1.3.2" xref="S3.SS3.p1.4.m4.1.1.3.1.3.2.cmml">i</mi><mo id="S3.SS3.p1.4.m4.1.1.3.1.3.1" xref="S3.SS3.p1.4.m4.1.1.3.1.3.1.cmml">=</mo><mn id="S3.SS3.p1.4.m4.1.1.3.1.3.3" xref="S3.SS3.p1.4.m4.1.1.3.1.3.3.cmml">1</mn></mrow><msub id="S3.SS3.p1.4.m4.1.1.3.1.2.3" xref="S3.SS3.p1.4.m4.1.1.3.1.2.3.cmml"><mi id="S3.SS3.p1.4.m4.1.1.3.1.2.3.2" xref="S3.SS3.p1.4.m4.1.1.3.1.2.3.2.cmml">n</mi><mi id="S3.SS3.p1.4.m4.1.1.3.1.2.3.3" mathvariant="normal" xref="S3.SS3.p1.4.m4.1.1.3.1.2.3.3.cmml">g</mi></msub></msubsup><msubsup id="S3.SS3.p1.4.m4.1.1.3.2" xref="S3.SS3.p1.4.m4.1.1.3.2.cmml"><mi id="S3.SS3.p1.4.m4.1.1.3.2.2.2" xref="S3.SS3.p1.4.m4.1.1.3.2.2.2.cmml">D</mi><mi id="S3.SS3.p1.4.m4.1.1.3.2.3" xref="S3.SS3.p1.4.m4.1.1.3.2.3.cmml">i</mi><mi id="S3.SS3.p1.4.m4.1.1.3.2.2.3" mathvariant="normal" xref="S3.SS3.p1.4.m4.1.1.3.2.2.3.cmml">g</mi></msubsup></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.4.m4.1b"><apply id="S3.SS3.p1.4.m4.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1"><eq id="S3.SS3.p1.4.m4.1.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1.1"></eq><apply id="S3.SS3.p1.4.m4.1.1.2.cmml" xref="S3.SS3.p1.4.m4.1.1.2"><csymbol cd="ambiguous" id="S3.SS3.p1.4.m4.1.1.2.1.cmml" xref="S3.SS3.p1.4.m4.1.1.2">superscript</csymbol><ci id="S3.SS3.p1.4.m4.1.1.2.2.cmml" xref="S3.SS3.p1.4.m4.1.1.2.2">𝐷</ci><ci id="S3.SS3.p1.4.m4.1.1.2.3.cmml" xref="S3.SS3.p1.4.m4.1.1.2.3">g</ci></apply><apply id="S3.SS3.p1.4.m4.1.1.3.cmml" xref="S3.SS3.p1.4.m4.1.1.3"><apply id="S3.SS3.p1.4.m4.1.1.3.1.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1"><csymbol cd="ambiguous" id="S3.SS3.p1.4.m4.1.1.3.1.1.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1">subscript</csymbol><apply id="S3.SS3.p1.4.m4.1.1.3.1.2.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1"><csymbol cd="ambiguous" id="S3.SS3.p1.4.m4.1.1.3.1.2.1.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1">superscript</csymbol><union id="S3.SS3.p1.4.m4.1.1.3.1.2.2.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1.2.2"></union><apply id="S3.SS3.p1.4.m4.1.1.3.1.2.3.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1.2.3"><csymbol cd="ambiguous" id="S3.SS3.p1.4.m4.1.1.3.1.2.3.1.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1.2.3">subscript</csymbol><ci id="S3.SS3.p1.4.m4.1.1.3.1.2.3.2.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1.2.3.2">𝑛</ci><ci id="S3.SS3.p1.4.m4.1.1.3.1.2.3.3.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1.2.3.3">g</ci></apply></apply><apply id="S3.SS3.p1.4.m4.1.1.3.1.3.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1.3"><eq id="S3.SS3.p1.4.m4.1.1.3.1.3.1.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1.3.1"></eq><ci id="S3.SS3.p1.4.m4.1.1.3.1.3.2.cmml" xref="S3.SS3.p1.4.m4.1.1.3.1.3.2">𝑖</ci><cn id="S3.SS3.p1.4.m4.1.1.3.1.3.3.cmml" type="integer" xref="S3.SS3.p1.4.m4.1.1.3.1.3.3">1</cn></apply></apply><apply id="S3.SS3.p1.4.m4.1.1.3.2.cmml" xref="S3.SS3.p1.4.m4.1.1.3.2"><csymbol cd="ambiguous" id="S3.SS3.p1.4.m4.1.1.3.2.1.cmml" xref="S3.SS3.p1.4.m4.1.1.3.2">subscript</csymbol><apply id="S3.SS3.p1.4.m4.1.1.3.2.2.cmml" xref="S3.SS3.p1.4.m4.1.1.3.2"><csymbol cd="ambiguous" id="S3.SS3.p1.4.m4.1.1.3.2.2.1.cmml" xref="S3.SS3.p1.4.m4.1.1.3.2">superscript</csymbol><ci id="S3.SS3.p1.4.m4.1.1.3.2.2.2.cmml" xref="S3.SS3.p1.4.m4.1.1.3.2.2.2">𝐷</ci><ci id="S3.SS3.p1.4.m4.1.1.3.2.2.3.cmml" xref="S3.SS3.p1.4.m4.1.1.3.2.2.3">g</ci></apply><ci id="S3.SS3.p1.4.m4.1.1.3.2.3.cmml" xref="S3.SS3.p1.4.m4.1.1.3.2.3">𝑖</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.4.m4.1c">D^{\rm g}=\bigcup^{n_{\rm g}}_{i=1}D^{\rm g}_{i}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.4.m4.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT = ⋃ start_POSTSUPERSCRIPT italic_n start_POSTSUBSCRIPT roman_g end_POSTSUBSCRIPT end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT</annotation></semantics></math>. These methods select weights for the different sources by considering two functions of <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS3.p1.5.m5.1"><semantics id="S3.SS3.p1.5.m5.1a"><mi id="S3.SS3.p1.5.m5.1.1" xref="S3.SS3.p1.5.m5.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.5.m5.1b"><ci id="S3.SS3.p1.5.m5.1.1.cmml" xref="S3.SS3.p1.5.m5.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.5.m5.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.5.m5.1d">italic_θ</annotation></semantics></math>: the pretraining reweighed loss,</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="{\cal L}((w,D^{\rm g});\theta):=\sum^{n_{\rm g}}_{i=1}w_{i}{\cal L}(D^{\rm g}_%
{i};\theta)," class="ltx_Math" display="block" id="S3.Ex3.m1.4"><semantics id="S3.Ex3.m1.4a"><mrow id="S3.Ex3.m1.4.4.1" xref="S3.Ex3.m1.4.4.1.1.cmml"><mrow id="S3.Ex3.m1.4.4.1.1" xref="S3.Ex3.m1.4.4.1.1.cmml"><mrow id="S3.Ex3.m1.4.4.1.1.1" xref="S3.Ex3.m1.4.4.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex3.m1.4.4.1.1.1.3" xref="S3.Ex3.m1.4.4.1.1.1.3.cmml">ℒ</mi><mo id="S3.Ex3.m1.4.4.1.1.1.2" xref="S3.Ex3.m1.4.4.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex3.m1.4.4.1.1.1.1.1" xref="S3.Ex3.m1.4.4.1.1.1.1.2.cmml"><mo id="S3.Ex3.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="S3.Ex3.m1.4.4.1.1.1.1.2.cmml">(</mo><mrow id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.2.cmml"><mo id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.2.cmml">(</mo><mi id="S3.Ex3.m1.1.1" xref="S3.Ex3.m1.1.1.cmml">w</mi><mo id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.3" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.2.cmml">,</mo><msup id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.cmml"><mi id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.2" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.2.cmml">D</mi><mi id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.3" mathvariant="normal" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.3.cmml">g</mi></msup><mo id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.4" stretchy="false" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.2.cmml">)</mo></mrow><mo id="S3.Ex3.m1.4.4.1.1.1.1.1.3" xref="S3.Ex3.m1.4.4.1.1.1.1.2.cmml">;</mo><mi id="S3.Ex3.m1.2.2" xref="S3.Ex3.m1.2.2.cmml">θ</mi><mo id="S3.Ex3.m1.4.4.1.1.1.1.1.4" rspace="0.278em" stretchy="false" xref="S3.Ex3.m1.4.4.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.Ex3.m1.4.4.1.1.3" rspace="0.111em" xref="S3.Ex3.m1.4.4.1.1.3.cmml">:=</mo><mrow id="S3.Ex3.m1.4.4.1.1.2" xref="S3.Ex3.m1.4.4.1.1.2.cmml"><munderover id="S3.Ex3.m1.4.4.1.1.2.2" xref="S3.Ex3.m1.4.4.1.1.2.2.cmml"><mo id="S3.Ex3.m1.4.4.1.1.2.2.2.2" movablelimits="false" xref="S3.Ex3.m1.4.4.1.1.2.2.2.2.cmml">∑</mo><mrow id="S3.Ex3.m1.4.4.1.1.2.2.3" xref="S3.Ex3.m1.4.4.1.1.2.2.3.cmml"><mi id="S3.Ex3.m1.4.4.1.1.2.2.3.2" xref="S3.Ex3.m1.4.4.1.1.2.2.3.2.cmml">i</mi><mo id="S3.Ex3.m1.4.4.1.1.2.2.3.1" xref="S3.Ex3.m1.4.4.1.1.2.2.3.1.cmml">=</mo><mn id="S3.Ex3.m1.4.4.1.1.2.2.3.3" xref="S3.Ex3.m1.4.4.1.1.2.2.3.3.cmml">1</mn></mrow><msub id="S3.Ex3.m1.4.4.1.1.2.2.2.3" xref="S3.Ex3.m1.4.4.1.1.2.2.2.3.cmml"><mi id="S3.Ex3.m1.4.4.1.1.2.2.2.3.2" xref="S3.Ex3.m1.4.4.1.1.2.2.2.3.2.cmml">n</mi><mi id="S3.Ex3.m1.4.4.1.1.2.2.2.3.3" mathvariant="normal" xref="S3.Ex3.m1.4.4.1.1.2.2.2.3.3.cmml">g</mi></msub></munderover><mrow id="S3.Ex3.m1.4.4.1.1.2.1" xref="S3.Ex3.m1.4.4.1.1.2.1.cmml"><msub id="S3.Ex3.m1.4.4.1.1.2.1.3" xref="S3.Ex3.m1.4.4.1.1.2.1.3.cmml"><mi id="S3.Ex3.m1.4.4.1.1.2.1.3.2" xref="S3.Ex3.m1.4.4.1.1.2.1.3.2.cmml">w</mi><mi id="S3.Ex3.m1.4.4.1.1.2.1.3.3" xref="S3.Ex3.m1.4.4.1.1.2.1.3.3.cmml">i</mi></msub><mo id="S3.Ex3.m1.4.4.1.1.2.1.2" xref="S3.Ex3.m1.4.4.1.1.2.1.2.cmml">⁢</mo><mi class="ltx_font_mathcaligraphic" id="S3.Ex3.m1.4.4.1.1.2.1.4" xref="S3.Ex3.m1.4.4.1.1.2.1.4.cmml">ℒ</mi><mo id="S3.Ex3.m1.4.4.1.1.2.1.2a" xref="S3.Ex3.m1.4.4.1.1.2.1.2.cmml">⁢</mo><mrow id="S3.Ex3.m1.4.4.1.1.2.1.1.1" xref="S3.Ex3.m1.4.4.1.1.2.1.1.2.cmml"><mo id="S3.Ex3.m1.4.4.1.1.2.1.1.1.2" stretchy="false" xref="S3.Ex3.m1.4.4.1.1.2.1.1.2.cmml">(</mo><msubsup id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.cmml"><mi id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.2" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.2.cmml">D</mi><mi id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.3" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.3.cmml">i</mi><mi id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.3" mathvariant="normal" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.3.cmml">g</mi></msubsup><mo id="S3.Ex3.m1.4.4.1.1.2.1.1.1.3" xref="S3.Ex3.m1.4.4.1.1.2.1.1.2.cmml">;</mo><mi id="S3.Ex3.m1.3.3" xref="S3.Ex3.m1.3.3.cmml">θ</mi><mo id="S3.Ex3.m1.4.4.1.1.2.1.1.1.4" stretchy="false" xref="S3.Ex3.m1.4.4.1.1.2.1.1.2.cmml">)</mo></mrow></mrow></mrow></mrow><mo id="S3.Ex3.m1.4.4.1.2" xref="S3.Ex3.m1.4.4.1.1.cmml">,</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex3.m1.4b"><apply id="S3.Ex3.m1.4.4.1.1.cmml" xref="S3.Ex3.m1.4.4.1"><csymbol cd="latexml" id="S3.Ex3.m1.4.4.1.1.3.cmml" xref="S3.Ex3.m1.4.4.1.1.3">assign</csymbol><apply id="S3.Ex3.m1.4.4.1.1.1.cmml" xref="S3.Ex3.m1.4.4.1.1.1"><times id="S3.Ex3.m1.4.4.1.1.1.2.cmml" xref="S3.Ex3.m1.4.4.1.1.1.2"></times><ci id="S3.Ex3.m1.4.4.1.1.1.3.cmml" xref="S3.Ex3.m1.4.4.1.1.1.3">ℒ</ci><list id="S3.Ex3.m1.4.4.1.1.1.1.2.cmml" xref="S3.Ex3.m1.4.4.1.1.1.1.1"><interval closure="open" id="S3.Ex3.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.1"><ci id="S3.Ex3.m1.1.1.cmml" xref="S3.Ex3.m1.1.1">𝑤</ci><apply id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.1.cmml" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.2.cmml" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.2">𝐷</ci><ci id="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.3.cmml" xref="S3.Ex3.m1.4.4.1.1.1.1.1.1.1.1.3">g</ci></apply></interval><ci id="S3.Ex3.m1.2.2.cmml" xref="S3.Ex3.m1.2.2">𝜃</ci></list></apply><apply id="S3.Ex3.m1.4.4.1.1.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2"><apply id="S3.Ex3.m1.4.4.1.1.2.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2"><csymbol cd="ambiguous" id="S3.Ex3.m1.4.4.1.1.2.2.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2">subscript</csymbol><apply id="S3.Ex3.m1.4.4.1.1.2.2.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2"><csymbol cd="ambiguous" id="S3.Ex3.m1.4.4.1.1.2.2.2.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2">superscript</csymbol><sum id="S3.Ex3.m1.4.4.1.1.2.2.2.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2.2.2"></sum><apply id="S3.Ex3.m1.4.4.1.1.2.2.2.3.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2.2.3"><csymbol cd="ambiguous" id="S3.Ex3.m1.4.4.1.1.2.2.2.3.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2.2.3">subscript</csymbol><ci id="S3.Ex3.m1.4.4.1.1.2.2.2.3.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2.2.3.2">𝑛</ci><ci id="S3.Ex3.m1.4.4.1.1.2.2.2.3.3.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2.2.3.3">g</ci></apply></apply><apply id="S3.Ex3.m1.4.4.1.1.2.2.3.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2.3"><eq id="S3.Ex3.m1.4.4.1.1.2.2.3.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2.3.1"></eq><ci id="S3.Ex3.m1.4.4.1.1.2.2.3.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.2.3.2">𝑖</ci><cn id="S3.Ex3.m1.4.4.1.1.2.2.3.3.cmml" type="integer" xref="S3.Ex3.m1.4.4.1.1.2.2.3.3">1</cn></apply></apply><apply id="S3.Ex3.m1.4.4.1.1.2.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1"><times id="S3.Ex3.m1.4.4.1.1.2.1.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.2"></times><apply id="S3.Ex3.m1.4.4.1.1.2.1.3.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.3"><csymbol cd="ambiguous" id="S3.Ex3.m1.4.4.1.1.2.1.3.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.3">subscript</csymbol><ci id="S3.Ex3.m1.4.4.1.1.2.1.3.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.3.2">𝑤</ci><ci id="S3.Ex3.m1.4.4.1.1.2.1.3.3.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.3.3">𝑖</ci></apply><ci id="S3.Ex3.m1.4.4.1.1.2.1.4.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.4">ℒ</ci><list id="S3.Ex3.m1.4.4.1.1.2.1.1.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1"><apply id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1">subscript</csymbol><apply id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.1.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1">superscript</csymbol><ci id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.2.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.2">𝐷</ci><ci id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.3.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.2.3">g</ci></apply><ci id="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.3.cmml" xref="S3.Ex3.m1.4.4.1.1.2.1.1.1.1.3">𝑖</ci></apply><ci id="S3.Ex3.m1.3.3.cmml" xref="S3.Ex3.m1.3.3">𝜃</ci></list></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex3.m1.4c">{\cal L}((w,D^{\rm g});\theta):=\sum^{n_{\rm g}}_{i=1}w_{i}{\cal L}(D^{\rm g}_%
{i};\theta),</annotation><annotation encoding="application/x-llamapun" id="S3.Ex3.m1.4d">caligraphic_L ( ( italic_w , italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ) ; italic_θ ) := ∑ start_POSTSUPERSCRIPT italic_n start_POSTSUBSCRIPT roman_g end_POSTSUBSCRIPT end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i = 1 end_POSTSUBSCRIPT italic_w start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT caligraphic_L ( italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ; italic_θ ) ,</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS3.p1.12">and the targeted loss, i.e. the loss on <math alttext="D^{\rm s}" class="ltx_Math" display="inline" id="S3.SS3.p1.6.m1.1"><semantics id="S3.SS3.p1.6.m1.1a"><msup id="S3.SS3.p1.6.m1.1.1" xref="S3.SS3.p1.6.m1.1.1.cmml"><mi id="S3.SS3.p1.6.m1.1.1.2" xref="S3.SS3.p1.6.m1.1.1.2.cmml">D</mi><mi id="S3.SS3.p1.6.m1.1.1.3" mathvariant="normal" xref="S3.SS3.p1.6.m1.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.6.m1.1b"><apply id="S3.SS3.p1.6.m1.1.1.cmml" xref="S3.SS3.p1.6.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.6.m1.1.1.1.cmml" xref="S3.SS3.p1.6.m1.1.1">superscript</csymbol><ci id="S3.SS3.p1.6.m1.1.1.2.cmml" xref="S3.SS3.p1.6.m1.1.1.2">𝐷</ci><ci id="S3.SS3.p1.6.m1.1.1.3.cmml" xref="S3.SS3.p1.6.m1.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.6.m1.1c">D^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.6.m1.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math> in our case. The weights, on the simplex,
can be inferred via a bilevel formulation of the data selection problem <cite class="ltx_cite ltx_citemacro_citep">(Dagréou et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib13" title="">2022</a>)</cite>:
the minimum <span class="ltx_text" id="S3.SS3.p1.7.1"><math alttext="\theta^{\star}(w)=\arg\min_{\theta}{\cal L}((w,D^{\rm g});\theta)" class="ltx_Math" display="inline" id="S3.SS3.p1.7.1.m1.4"><semantics id="S3.SS3.p1.7.1.m1.4a"><mrow id="S3.SS3.p1.7.1.m1.4.4" xref="S3.SS3.p1.7.1.m1.4.4.cmml"><mrow id="S3.SS3.p1.7.1.m1.4.4.3" xref="S3.SS3.p1.7.1.m1.4.4.3.cmml"><msup id="S3.SS3.p1.7.1.m1.4.4.3.2" xref="S3.SS3.p1.7.1.m1.4.4.3.2.cmml"><mi id="S3.SS3.p1.7.1.m1.4.4.3.2.2" xref="S3.SS3.p1.7.1.m1.4.4.3.2.2.cmml">θ</mi><mo id="S3.SS3.p1.7.1.m1.4.4.3.2.3" xref="S3.SS3.p1.7.1.m1.4.4.3.2.3.cmml">⋆</mo></msup><mo id="S3.SS3.p1.7.1.m1.4.4.3.1" xref="S3.SS3.p1.7.1.m1.4.4.3.1.cmml">⁢</mo><mrow id="S3.SS3.p1.7.1.m1.4.4.3.3.2" xref="S3.SS3.p1.7.1.m1.4.4.3.cmml"><mo id="S3.SS3.p1.7.1.m1.4.4.3.3.2.1" stretchy="false" xref="S3.SS3.p1.7.1.m1.4.4.3.cmml">(</mo><mi id="S3.SS3.p1.7.1.m1.1.1" xref="S3.SS3.p1.7.1.m1.1.1.cmml">w</mi><mo id="S3.SS3.p1.7.1.m1.4.4.3.3.2.2" stretchy="false" xref="S3.SS3.p1.7.1.m1.4.4.3.cmml">)</mo></mrow></mrow><mo id="S3.SS3.p1.7.1.m1.4.4.2" xref="S3.SS3.p1.7.1.m1.4.4.2.cmml">=</mo><mrow id="S3.SS3.p1.7.1.m1.4.4.1" xref="S3.SS3.p1.7.1.m1.4.4.1.cmml"><mrow id="S3.SS3.p1.7.1.m1.4.4.1.3" xref="S3.SS3.p1.7.1.m1.4.4.1.3.cmml"><mi id="S3.SS3.p1.7.1.m1.4.4.1.3.1" xref="S3.SS3.p1.7.1.m1.4.4.1.3.1.cmml">arg</mi><mo id="S3.SS3.p1.7.1.m1.4.4.1.3a" lspace="0.167em" xref="S3.SS3.p1.7.1.m1.4.4.1.3.cmml">⁡</mo><mrow id="S3.SS3.p1.7.1.m1.4.4.1.3.2" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.cmml"><msub id="S3.SS3.p1.7.1.m1.4.4.1.3.2.1" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.cmml"><mi id="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.2" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.2.cmml">min</mi><mi id="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.3" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.3.cmml">θ</mi></msub><mo id="S3.SS3.p1.7.1.m1.4.4.1.3.2a" lspace="0.167em" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.cmml">⁡</mo><mi class="ltx_font_mathcaligraphic" id="S3.SS3.p1.7.1.m1.4.4.1.3.2.2" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.2.cmml">ℒ</mi></mrow></mrow><mo id="S3.SS3.p1.7.1.m1.4.4.1.2" xref="S3.SS3.p1.7.1.m1.4.4.1.2.cmml">⁢</mo><mrow id="S3.SS3.p1.7.1.m1.4.4.1.1.1" xref="S3.SS3.p1.7.1.m1.4.4.1.1.2.cmml"><mo id="S3.SS3.p1.7.1.m1.4.4.1.1.1.2" stretchy="false" xref="S3.SS3.p1.7.1.m1.4.4.1.1.2.cmml">(</mo><mrow id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.2.cmml"><mo id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.2" stretchy="false" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.2.cmml">(</mo><mi id="S3.SS3.p1.7.1.m1.2.2" xref="S3.SS3.p1.7.1.m1.2.2.cmml">w</mi><mo id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.3" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.2.cmml">,</mo><msup id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.cmml"><mi id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.2" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.2.cmml">D</mi><mi id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.3" mathvariant="normal" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.3.cmml">g</mi></msup><mo id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.4" stretchy="false" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.2.cmml">)</mo></mrow><mo id="S3.SS3.p1.7.1.m1.4.4.1.1.1.3" xref="S3.SS3.p1.7.1.m1.4.4.1.1.2.cmml">;</mo><mi id="S3.SS3.p1.7.1.m1.3.3" xref="S3.SS3.p1.7.1.m1.3.3.cmml">θ</mi><mo id="S3.SS3.p1.7.1.m1.4.4.1.1.1.4" stretchy="false" xref="S3.SS3.p1.7.1.m1.4.4.1.1.2.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.7.1.m1.4b"><apply id="S3.SS3.p1.7.1.m1.4.4.cmml" xref="S3.SS3.p1.7.1.m1.4.4"><eq id="S3.SS3.p1.7.1.m1.4.4.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.2"></eq><apply id="S3.SS3.p1.7.1.m1.4.4.3.cmml" xref="S3.SS3.p1.7.1.m1.4.4.3"><times id="S3.SS3.p1.7.1.m1.4.4.3.1.cmml" xref="S3.SS3.p1.7.1.m1.4.4.3.1"></times><apply id="S3.SS3.p1.7.1.m1.4.4.3.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.3.2"><csymbol cd="ambiguous" id="S3.SS3.p1.7.1.m1.4.4.3.2.1.cmml" xref="S3.SS3.p1.7.1.m1.4.4.3.2">superscript</csymbol><ci id="S3.SS3.p1.7.1.m1.4.4.3.2.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.3.2.2">𝜃</ci><ci id="S3.SS3.p1.7.1.m1.4.4.3.2.3.cmml" xref="S3.SS3.p1.7.1.m1.4.4.3.2.3">⋆</ci></apply><ci id="S3.SS3.p1.7.1.m1.1.1.cmml" xref="S3.SS3.p1.7.1.m1.1.1">𝑤</ci></apply><apply id="S3.SS3.p1.7.1.m1.4.4.1.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1"><times id="S3.SS3.p1.7.1.m1.4.4.1.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.2"></times><apply id="S3.SS3.p1.7.1.m1.4.4.1.3.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.3"><arg id="S3.SS3.p1.7.1.m1.4.4.1.3.1.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.3.1"></arg><apply id="S3.SS3.p1.7.1.m1.4.4.1.3.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2"><apply id="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.1"><csymbol cd="ambiguous" id="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.1.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.1">subscript</csymbol><min id="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.2"></min><ci id="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.3.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.1.3">𝜃</ci></apply><ci id="S3.SS3.p1.7.1.m1.4.4.1.3.2.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.3.2.2">ℒ</ci></apply></apply><list id="S3.SS3.p1.7.1.m1.4.4.1.1.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1"><interval closure="open" id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1"><ci id="S3.SS3.p1.7.1.m1.2.2.cmml" xref="S3.SS3.p1.7.1.m1.2.2">𝑤</ci><apply id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.1.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1">superscript</csymbol><ci id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.2.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.2">𝐷</ci><ci id="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.3.cmml" xref="S3.SS3.p1.7.1.m1.4.4.1.1.1.1.1.1.3">g</ci></apply></interval><ci id="S3.SS3.p1.7.1.m1.3.3.cmml" xref="S3.SS3.p1.7.1.m1.3.3">𝜃</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.7.1.m1.4c">\theta^{\star}(w)=\arg\min_{\theta}{\cal L}((w,D^{\rm g});\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.7.1.m1.4d">italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ( italic_w ) = roman_arg roman_min start_POSTSUBSCRIPT italic_θ end_POSTSUBSCRIPT caligraphic_L ( ( italic_w , italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ) ; italic_θ )</annotation></semantics></math></span> depends on <math alttext="w" class="ltx_Math" display="inline" id="S3.SS3.p1.8.m2.1"><semantics id="S3.SS3.p1.8.m2.1a"><mi id="S3.SS3.p1.8.m2.1.1" xref="S3.SS3.p1.8.m2.1.1.cmml">w</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.8.m2.1b"><ci id="S3.SS3.p1.8.m2.1.1.cmml" xref="S3.SS3.p1.8.m2.1.1">𝑤</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.8.m2.1c">w</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.8.m2.1d">italic_w</annotation></semantics></math>
and task-dependent pretraining is interested in weights <math alttext="w" class="ltx_Math" display="inline" id="S3.SS3.p1.9.m3.1"><semantics id="S3.SS3.p1.9.m3.1a"><mi id="S3.SS3.p1.9.m3.1.1" xref="S3.SS3.p1.9.m3.1.1.cmml">w</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.9.m3.1b"><ci id="S3.SS3.p1.9.m3.1.1.cmml" xref="S3.SS3.p1.9.m3.1.1">𝑤</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.9.m3.1c">w</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.9.m3.1d">italic_w</annotation></semantics></math> that minimize <math alttext="{\cal L}(D^{\rm s};\theta^{\star}(w))" class="ltx_Math" display="inline" id="S3.SS3.p1.10.m4.3"><semantics id="S3.SS3.p1.10.m4.3a"><mrow id="S3.SS3.p1.10.m4.3.3" xref="S3.SS3.p1.10.m4.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS3.p1.10.m4.3.3.4" xref="S3.SS3.p1.10.m4.3.3.4.cmml">ℒ</mi><mo id="S3.SS3.p1.10.m4.3.3.3" xref="S3.SS3.p1.10.m4.3.3.3.cmml">⁢</mo><mrow id="S3.SS3.p1.10.m4.3.3.2.2" xref="S3.SS3.p1.10.m4.3.3.2.3.cmml"><mo id="S3.SS3.p1.10.m4.3.3.2.2.3" stretchy="false" xref="S3.SS3.p1.10.m4.3.3.2.3.cmml">(</mo><msup id="S3.SS3.p1.10.m4.2.2.1.1.1" xref="S3.SS3.p1.10.m4.2.2.1.1.1.cmml"><mi id="S3.SS3.p1.10.m4.2.2.1.1.1.2" xref="S3.SS3.p1.10.m4.2.2.1.1.1.2.cmml">D</mi><mi id="S3.SS3.p1.10.m4.2.2.1.1.1.3" mathvariant="normal" xref="S3.SS3.p1.10.m4.2.2.1.1.1.3.cmml">s</mi></msup><mo id="S3.SS3.p1.10.m4.3.3.2.2.4" xref="S3.SS3.p1.10.m4.3.3.2.3.cmml">;</mo><mrow id="S3.SS3.p1.10.m4.3.3.2.2.2" xref="S3.SS3.p1.10.m4.3.3.2.2.2.cmml"><msup id="S3.SS3.p1.10.m4.3.3.2.2.2.2" xref="S3.SS3.p1.10.m4.3.3.2.2.2.2.cmml"><mi id="S3.SS3.p1.10.m4.3.3.2.2.2.2.2" xref="S3.SS3.p1.10.m4.3.3.2.2.2.2.2.cmml">θ</mi><mo id="S3.SS3.p1.10.m4.3.3.2.2.2.2.3" xref="S3.SS3.p1.10.m4.3.3.2.2.2.2.3.cmml">⋆</mo></msup><mo id="S3.SS3.p1.10.m4.3.3.2.2.2.1" xref="S3.SS3.p1.10.m4.3.3.2.2.2.1.cmml">⁢</mo><mrow id="S3.SS3.p1.10.m4.3.3.2.2.2.3.2" xref="S3.SS3.p1.10.m4.3.3.2.2.2.cmml"><mo id="S3.SS3.p1.10.m4.3.3.2.2.2.3.2.1" stretchy="false" xref="S3.SS3.p1.10.m4.3.3.2.2.2.cmml">(</mo><mi id="S3.SS3.p1.10.m4.1.1" xref="S3.SS3.p1.10.m4.1.1.cmml">w</mi><mo id="S3.SS3.p1.10.m4.3.3.2.2.2.3.2.2" stretchy="false" xref="S3.SS3.p1.10.m4.3.3.2.2.2.cmml">)</mo></mrow></mrow><mo id="S3.SS3.p1.10.m4.3.3.2.2.5" stretchy="false" xref="S3.SS3.p1.10.m4.3.3.2.3.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.10.m4.3b"><apply id="S3.SS3.p1.10.m4.3.3.cmml" xref="S3.SS3.p1.10.m4.3.3"><times id="S3.SS3.p1.10.m4.3.3.3.cmml" xref="S3.SS3.p1.10.m4.3.3.3"></times><ci id="S3.SS3.p1.10.m4.3.3.4.cmml" xref="S3.SS3.p1.10.m4.3.3.4">ℒ</ci><list id="S3.SS3.p1.10.m4.3.3.2.3.cmml" xref="S3.SS3.p1.10.m4.3.3.2.2"><apply id="S3.SS3.p1.10.m4.2.2.1.1.1.cmml" xref="S3.SS3.p1.10.m4.2.2.1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p1.10.m4.2.2.1.1.1.1.cmml" xref="S3.SS3.p1.10.m4.2.2.1.1.1">superscript</csymbol><ci id="S3.SS3.p1.10.m4.2.2.1.1.1.2.cmml" xref="S3.SS3.p1.10.m4.2.2.1.1.1.2">𝐷</ci><ci id="S3.SS3.p1.10.m4.2.2.1.1.1.3.cmml" xref="S3.SS3.p1.10.m4.2.2.1.1.1.3">s</ci></apply><apply id="S3.SS3.p1.10.m4.3.3.2.2.2.cmml" xref="S3.SS3.p1.10.m4.3.3.2.2.2"><times id="S3.SS3.p1.10.m4.3.3.2.2.2.1.cmml" xref="S3.SS3.p1.10.m4.3.3.2.2.2.1"></times><apply id="S3.SS3.p1.10.m4.3.3.2.2.2.2.cmml" xref="S3.SS3.p1.10.m4.3.3.2.2.2.2"><csymbol cd="ambiguous" id="S3.SS3.p1.10.m4.3.3.2.2.2.2.1.cmml" xref="S3.SS3.p1.10.m4.3.3.2.2.2.2">superscript</csymbol><ci id="S3.SS3.p1.10.m4.3.3.2.2.2.2.2.cmml" xref="S3.SS3.p1.10.m4.3.3.2.2.2.2.2">𝜃</ci><ci id="S3.SS3.p1.10.m4.3.3.2.2.2.2.3.cmml" xref="S3.SS3.p1.10.m4.3.3.2.2.2.2.3">⋆</ci></apply><ci id="S3.SS3.p1.10.m4.1.1.cmml" xref="S3.SS3.p1.10.m4.1.1">𝑤</ci></apply></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.10.m4.3c">{\cal L}(D^{\rm s};\theta^{\star}(w))</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.10.m4.3d">caligraphic_L ( italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ; italic_θ start_POSTSUPERSCRIPT ⋆ end_POSTSUPERSCRIPT ( italic_w ) )</annotation></semantics></math> wrt <math alttext="w" class="ltx_Math" display="inline" id="S3.SS3.p1.11.m5.1"><semantics id="S3.SS3.p1.11.m5.1a"><mi id="S3.SS3.p1.11.m5.1.1" xref="S3.SS3.p1.11.m5.1.1.cmml">w</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.11.m5.1b"><ci id="S3.SS3.p1.11.m5.1.1.cmml" xref="S3.SS3.p1.11.m5.1.1">𝑤</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.11.m5.1c">w</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.11.m5.1d">italic_w</annotation></semantics></math>. This formulation results in algorithms that select weights during pretraining to align the gradients of these two functions wrt <math alttext="\theta" class="ltx_Math" display="inline" id="S3.SS3.p1.12.m6.1"><semantics id="S3.SS3.p1.12.m6.1a"><mi id="S3.SS3.p1.12.m6.1.1" xref="S3.SS3.p1.12.m6.1.1.cmml">θ</mi><annotation-xml encoding="MathML-Content" id="S3.SS3.p1.12.m6.1b"><ci id="S3.SS3.p1.12.m6.1.1.cmml" xref="S3.SS3.p1.12.m6.1.1">𝜃</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p1.12.m6.1c">\theta</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p1.12.m6.1d">italic_θ</annotation></semantics></math> <cite class="ltx_cite ltx_citemacro_citep">(Xie et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib69" title="">2023b</a>; Grangier et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib22" title="">2023</a>)</cite>. In our case, we rely on the DoGE <cite class="ltx_cite ltx_citemacro_citep">(Fan et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib19" title="">2024</a>)</cite> algorithm. Compared to classifiers, GA is harder to scale to large model size. This limitation is commonly addressed by finding the mixture weights with a small model before transferring them to a larger model.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS3.p2">
<p class="ltx_p" id="S3.SS3.p2.1">In this work, we consider a generic setting where the pretraining dataset <math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="S3.SS3.p2.1.m1.1"><semantics id="S3.SS3.p2.1.m1.1a"><msup id="S3.SS3.p2.1.m1.1.1" xref="S3.SS3.p2.1.m1.1.1.cmml"><mi id="S3.SS3.p2.1.m1.1.1.2" xref="S3.SS3.p2.1.m1.1.1.2.cmml">D</mi><mi id="S3.SS3.p2.1.m1.1.1.3" mathvariant="normal" xref="S3.SS3.p2.1.m1.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS3.p2.1.m1.1b"><apply id="S3.SS3.p2.1.m1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS3.p2.1.m1.1.1.1.cmml" xref="S3.SS3.p2.1.m1.1.1">superscript</csymbol><ci id="S3.SS3.p2.1.m1.1.1.2.cmml" xref="S3.SS3.p2.1.m1.1.1.2">𝐷</ci><ci id="S3.SS3.p2.1.m1.1.1.3.cmml" xref="S3.SS3.p2.1.m1.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS3.p2.1.m1.1c">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS3.p2.1.m1.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> is
not pre-segmented into few data sources. Instead, we rely on the k-means clustering of the Sentence BERT embeddings to identify data clusters. Clustering based on text embeddings has been used for data selection, both for quality filtering <cite class="ltx_cite ltx_citemacro_citep">(Kaddour, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib33" title="">2023</a>)</cite> and domain adaptation <cite class="ltx_cite ltx_citemacro_citep">(Grangier et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib23" title="">2024a</a>)</cite>.</p>
</div>
</section>
<section class="ltx_subsection" id="S3.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">3.4 </span>CRISP: ClusteRed Importance Sampling for Pretraining</h3>
<figure class="ltx_figure" id="S3.F1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="131" id="S3.F1.g1" src="x1.png" width="761"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 1: </span><span class="ltx_text ltx_font_bold" id="S3.F1.2.1">Clustered-based Importance Sampling with CRISP</span>.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S3.SS4.p1">
<p class="ltx_p" id="S3.SS4.p1.1">We sketch our strategy from Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S3.F1" title="Figure 1 ‣ 3.4 CRISP: ClusteRed Importance Sampling for Pretraining ‣ 3 Data Selection for Task-Adaptive Pretraining ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">1</span></a>. Initially, we divide the space of text into clusters. We decompose the specialist loss and the generalist loss as a weighted sum of losses over clusters. Then we make an independence assumption that implies that the specialist and generalist loss per cluster are identical. The specialist loss is then computed as the generalist loss with a reweighing of each cluster.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p2">
<p class="ltx_p" id="S3.SS4.p2.1">Specifically, we want to identify a model with a low loss on the
specialist distribution <math alttext="{\cal D}^{\rm s}" class="ltx_Math" display="inline" id="S3.SS4.p2.1.m1.1"><semantics id="S3.SS4.p2.1.m1.1a"><msup id="S3.SS4.p2.1.m1.1.1" xref="S3.SS4.p2.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p2.1.m1.1.1.2" xref="S3.SS4.p2.1.m1.1.1.2.cmml">𝒟</mi><mi id="S3.SS4.p2.1.m1.1.1.3" mathvariant="normal" xref="S3.SS4.p2.1.m1.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.1.m1.1b"><apply id="S3.SS4.p2.1.m1.1.1.cmml" xref="S3.SS4.p2.1.m1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.1.m1.1.1.1.cmml" xref="S3.SS4.p2.1.m1.1.1">superscript</csymbol><ci id="S3.SS4.p2.1.m1.1.1.2.cmml" xref="S3.SS4.p2.1.m1.1.1.2">𝒟</ci><ci id="S3.SS4.p2.1.m1.1.1.3.cmml" xref="S3.SS4.p2.1.m1.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.1.m1.1c">{\cal D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.1.m1.1d">caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>,</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex4">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="{\cal L}({\cal D}^{\rm s};\theta)=\mathop{\mathbb{E}}_{x\sim{\cal D}^{\rm s}}[%
\ell(x;\theta)]=\sum_{x}\ell(x;\theta)P(x|{\cal D}^{\rm s})" class="ltx_Math" display="block" id="S3.Ex4.m1.8"><semantics id="S3.Ex4.m1.8a"><mrow id="S3.Ex4.m1.8.8" xref="S3.Ex4.m1.8.8.cmml"><mrow id="S3.Ex4.m1.6.6.1" xref="S3.Ex4.m1.6.6.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex4.m1.6.6.1.3" xref="S3.Ex4.m1.6.6.1.3.cmml">ℒ</mi><mo id="S3.Ex4.m1.6.6.1.2" xref="S3.Ex4.m1.6.6.1.2.cmml">⁢</mo><mrow id="S3.Ex4.m1.6.6.1.1.1" xref="S3.Ex4.m1.6.6.1.1.2.cmml"><mo id="S3.Ex4.m1.6.6.1.1.1.2" stretchy="false" xref="S3.Ex4.m1.6.6.1.1.2.cmml">(</mo><msup id="S3.Ex4.m1.6.6.1.1.1.1" xref="S3.Ex4.m1.6.6.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex4.m1.6.6.1.1.1.1.2" xref="S3.Ex4.m1.6.6.1.1.1.1.2.cmml">𝒟</mi><mi id="S3.Ex4.m1.6.6.1.1.1.1.3" mathvariant="normal" xref="S3.Ex4.m1.6.6.1.1.1.1.3.cmml">s</mi></msup><mo id="S3.Ex4.m1.6.6.1.1.1.3" xref="S3.Ex4.m1.6.6.1.1.2.cmml">;</mo><mi id="S3.Ex4.m1.1.1" xref="S3.Ex4.m1.1.1.cmml">θ</mi><mo id="S3.Ex4.m1.6.6.1.1.1.4" stretchy="false" xref="S3.Ex4.m1.6.6.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.Ex4.m1.8.8.5" rspace="0.1389em" xref="S3.Ex4.m1.8.8.5.cmml">=</mo><mrow id="S3.Ex4.m1.7.7.2" xref="S3.Ex4.m1.7.7.2.cmml"><munder id="S3.Ex4.m1.7.7.2.2" xref="S3.Ex4.m1.7.7.2.2.cmml"><mo id="S3.Ex4.m1.7.7.2.2.2" lspace="0.1389em" movablelimits="false" rspace="0em" xref="S3.Ex4.m1.7.7.2.2.2.cmml">𝔼</mo><mrow id="S3.Ex4.m1.7.7.2.2.3" xref="S3.Ex4.m1.7.7.2.2.3.cmml"><mi id="S3.Ex4.m1.7.7.2.2.3.2" xref="S3.Ex4.m1.7.7.2.2.3.2.cmml">x</mi><mo id="S3.Ex4.m1.7.7.2.2.3.1" xref="S3.Ex4.m1.7.7.2.2.3.1.cmml">∼</mo><msup id="S3.Ex4.m1.7.7.2.2.3.3" xref="S3.Ex4.m1.7.7.2.2.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex4.m1.7.7.2.2.3.3.2" xref="S3.Ex4.m1.7.7.2.2.3.3.2.cmml">𝒟</mi><mi id="S3.Ex4.m1.7.7.2.2.3.3.3" mathvariant="normal" xref="S3.Ex4.m1.7.7.2.2.3.3.3.cmml">s</mi></msup></mrow></munder><mrow id="S3.Ex4.m1.7.7.2.1.1" xref="S3.Ex4.m1.7.7.2.1.2.cmml"><mo id="S3.Ex4.m1.7.7.2.1.1.2" stretchy="false" xref="S3.Ex4.m1.7.7.2.1.2.1.cmml">[</mo><mrow id="S3.Ex4.m1.7.7.2.1.1.1" xref="S3.Ex4.m1.7.7.2.1.1.1.cmml"><mi id="S3.Ex4.m1.7.7.2.1.1.1.2" mathvariant="normal" xref="S3.Ex4.m1.7.7.2.1.1.1.2.cmml">ℓ</mi><mo id="S3.Ex4.m1.7.7.2.1.1.1.1" xref="S3.Ex4.m1.7.7.2.1.1.1.1.cmml">⁢</mo><mrow id="S3.Ex4.m1.7.7.2.1.1.1.3.2" xref="S3.Ex4.m1.7.7.2.1.1.1.3.1.cmml"><mo id="S3.Ex4.m1.7.7.2.1.1.1.3.2.1" stretchy="false" xref="S3.Ex4.m1.7.7.2.1.1.1.3.1.cmml">(</mo><mi id="S3.Ex4.m1.2.2" xref="S3.Ex4.m1.2.2.cmml">x</mi><mo id="S3.Ex4.m1.7.7.2.1.1.1.3.2.2" xref="S3.Ex4.m1.7.7.2.1.1.1.3.1.cmml">;</mo><mi id="S3.Ex4.m1.3.3" xref="S3.Ex4.m1.3.3.cmml">θ</mi><mo id="S3.Ex4.m1.7.7.2.1.1.1.3.2.3" stretchy="false" xref="S3.Ex4.m1.7.7.2.1.1.1.3.1.cmml">)</mo></mrow></mrow><mo id="S3.Ex4.m1.7.7.2.1.1.3" stretchy="false" xref="S3.Ex4.m1.7.7.2.1.2.1.cmml">]</mo></mrow></mrow><mo id="S3.Ex4.m1.8.8.6" rspace="0.111em" xref="S3.Ex4.m1.8.8.6.cmml">=</mo><mrow id="S3.Ex4.m1.8.8.3" xref="S3.Ex4.m1.8.8.3.cmml"><munder id="S3.Ex4.m1.8.8.3.2" xref="S3.Ex4.m1.8.8.3.2.cmml"><mo id="S3.Ex4.m1.8.8.3.2.2" movablelimits="false" xref="S3.Ex4.m1.8.8.3.2.2.cmml">∑</mo><mi id="S3.Ex4.m1.8.8.3.2.3" xref="S3.Ex4.m1.8.8.3.2.3.cmml">x</mi></munder><mrow id="S3.Ex4.m1.8.8.3.1" xref="S3.Ex4.m1.8.8.3.1.cmml"><mi id="S3.Ex4.m1.8.8.3.1.3" mathvariant="normal" xref="S3.Ex4.m1.8.8.3.1.3.cmml">ℓ</mi><mo id="S3.Ex4.m1.8.8.3.1.2" xref="S3.Ex4.m1.8.8.3.1.2.cmml">⁢</mo><mrow id="S3.Ex4.m1.8.8.3.1.4.2" xref="S3.Ex4.m1.8.8.3.1.4.1.cmml"><mo id="S3.Ex4.m1.8.8.3.1.4.2.1" stretchy="false" xref="S3.Ex4.m1.8.8.3.1.4.1.cmml">(</mo><mi id="S3.Ex4.m1.4.4" xref="S3.Ex4.m1.4.4.cmml">x</mi><mo id="S3.Ex4.m1.8.8.3.1.4.2.2" xref="S3.Ex4.m1.8.8.3.1.4.1.cmml">;</mo><mi id="S3.Ex4.m1.5.5" xref="S3.Ex4.m1.5.5.cmml">θ</mi><mo id="S3.Ex4.m1.8.8.3.1.4.2.3" stretchy="false" xref="S3.Ex4.m1.8.8.3.1.4.1.cmml">)</mo></mrow><mo id="S3.Ex4.m1.8.8.3.1.2a" xref="S3.Ex4.m1.8.8.3.1.2.cmml">⁢</mo><mi id="S3.Ex4.m1.8.8.3.1.5" xref="S3.Ex4.m1.8.8.3.1.5.cmml">P</mi><mo id="S3.Ex4.m1.8.8.3.1.2b" xref="S3.Ex4.m1.8.8.3.1.2.cmml">⁢</mo><mrow id="S3.Ex4.m1.8.8.3.1.1.1" xref="S3.Ex4.m1.8.8.3.1.1.1.1.cmml"><mo id="S3.Ex4.m1.8.8.3.1.1.1.2" stretchy="false" xref="S3.Ex4.m1.8.8.3.1.1.1.1.cmml">(</mo><mrow id="S3.Ex4.m1.8.8.3.1.1.1.1" xref="S3.Ex4.m1.8.8.3.1.1.1.1.cmml"><mi id="S3.Ex4.m1.8.8.3.1.1.1.1.2" xref="S3.Ex4.m1.8.8.3.1.1.1.1.2.cmml">x</mi><mo fence="false" id="S3.Ex4.m1.8.8.3.1.1.1.1.1" xref="S3.Ex4.m1.8.8.3.1.1.1.1.1.cmml">|</mo><msup id="S3.Ex4.m1.8.8.3.1.1.1.1.3" xref="S3.Ex4.m1.8.8.3.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex4.m1.8.8.3.1.1.1.1.3.2" xref="S3.Ex4.m1.8.8.3.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.Ex4.m1.8.8.3.1.1.1.1.3.3" mathvariant="normal" xref="S3.Ex4.m1.8.8.3.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.Ex4.m1.8.8.3.1.1.1.3" stretchy="false" xref="S3.Ex4.m1.8.8.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex4.m1.8b"><apply id="S3.Ex4.m1.8.8.cmml" xref="S3.Ex4.m1.8.8"><and id="S3.Ex4.m1.8.8a.cmml" xref="S3.Ex4.m1.8.8"></and><apply id="S3.Ex4.m1.8.8b.cmml" xref="S3.Ex4.m1.8.8"><eq id="S3.Ex4.m1.8.8.5.cmml" xref="S3.Ex4.m1.8.8.5"></eq><apply id="S3.Ex4.m1.6.6.1.cmml" xref="S3.Ex4.m1.6.6.1"><times id="S3.Ex4.m1.6.6.1.2.cmml" xref="S3.Ex4.m1.6.6.1.2"></times><ci id="S3.Ex4.m1.6.6.1.3.cmml" xref="S3.Ex4.m1.6.6.1.3">ℒ</ci><list id="S3.Ex4.m1.6.6.1.1.2.cmml" xref="S3.Ex4.m1.6.6.1.1.1"><apply id="S3.Ex4.m1.6.6.1.1.1.1.cmml" xref="S3.Ex4.m1.6.6.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex4.m1.6.6.1.1.1.1.1.cmml" xref="S3.Ex4.m1.6.6.1.1.1.1">superscript</csymbol><ci id="S3.Ex4.m1.6.6.1.1.1.1.2.cmml" xref="S3.Ex4.m1.6.6.1.1.1.1.2">𝒟</ci><ci id="S3.Ex4.m1.6.6.1.1.1.1.3.cmml" xref="S3.Ex4.m1.6.6.1.1.1.1.3">s</ci></apply><ci id="S3.Ex4.m1.1.1.cmml" xref="S3.Ex4.m1.1.1">𝜃</ci></list></apply><apply id="S3.Ex4.m1.7.7.2.cmml" xref="S3.Ex4.m1.7.7.2"><apply id="S3.Ex4.m1.7.7.2.2.cmml" xref="S3.Ex4.m1.7.7.2.2"><csymbol cd="ambiguous" id="S3.Ex4.m1.7.7.2.2.1.cmml" xref="S3.Ex4.m1.7.7.2.2">subscript</csymbol><ci id="S3.Ex4.m1.7.7.2.2.2.cmml" xref="S3.Ex4.m1.7.7.2.2.2">𝔼</ci><apply id="S3.Ex4.m1.7.7.2.2.3.cmml" xref="S3.Ex4.m1.7.7.2.2.3"><csymbol cd="latexml" id="S3.Ex4.m1.7.7.2.2.3.1.cmml" xref="S3.Ex4.m1.7.7.2.2.3.1">similar-to</csymbol><ci id="S3.Ex4.m1.7.7.2.2.3.2.cmml" xref="S3.Ex4.m1.7.7.2.2.3.2">𝑥</ci><apply id="S3.Ex4.m1.7.7.2.2.3.3.cmml" xref="S3.Ex4.m1.7.7.2.2.3.3"><csymbol cd="ambiguous" id="S3.Ex4.m1.7.7.2.2.3.3.1.cmml" xref="S3.Ex4.m1.7.7.2.2.3.3">superscript</csymbol><ci id="S3.Ex4.m1.7.7.2.2.3.3.2.cmml" xref="S3.Ex4.m1.7.7.2.2.3.3.2">𝒟</ci><ci id="S3.Ex4.m1.7.7.2.2.3.3.3.cmml" xref="S3.Ex4.m1.7.7.2.2.3.3.3">s</ci></apply></apply></apply><apply id="S3.Ex4.m1.7.7.2.1.2.cmml" xref="S3.Ex4.m1.7.7.2.1.1"><csymbol cd="latexml" id="S3.Ex4.m1.7.7.2.1.2.1.cmml" xref="S3.Ex4.m1.7.7.2.1.1.2">delimited-[]</csymbol><apply id="S3.Ex4.m1.7.7.2.1.1.1.cmml" xref="S3.Ex4.m1.7.7.2.1.1.1"><times id="S3.Ex4.m1.7.7.2.1.1.1.1.cmml" xref="S3.Ex4.m1.7.7.2.1.1.1.1"></times><ci id="S3.Ex4.m1.7.7.2.1.1.1.2.cmml" xref="S3.Ex4.m1.7.7.2.1.1.1.2">ℓ</ci><list id="S3.Ex4.m1.7.7.2.1.1.1.3.1.cmml" xref="S3.Ex4.m1.7.7.2.1.1.1.3.2"><ci id="S3.Ex4.m1.2.2.cmml" xref="S3.Ex4.m1.2.2">𝑥</ci><ci id="S3.Ex4.m1.3.3.cmml" xref="S3.Ex4.m1.3.3">𝜃</ci></list></apply></apply></apply></apply><apply id="S3.Ex4.m1.8.8c.cmml" xref="S3.Ex4.m1.8.8"><eq id="S3.Ex4.m1.8.8.6.cmml" xref="S3.Ex4.m1.8.8.6"></eq><share href="https://arxiv.org/html/2410.03735v1#S3.Ex4.m1.7.7.2.cmml" id="S3.Ex4.m1.8.8d.cmml" xref="S3.Ex4.m1.8.8"></share><apply id="S3.Ex4.m1.8.8.3.cmml" xref="S3.Ex4.m1.8.8.3"><apply id="S3.Ex4.m1.8.8.3.2.cmml" xref="S3.Ex4.m1.8.8.3.2"><csymbol cd="ambiguous" id="S3.Ex4.m1.8.8.3.2.1.cmml" xref="S3.Ex4.m1.8.8.3.2">subscript</csymbol><sum id="S3.Ex4.m1.8.8.3.2.2.cmml" xref="S3.Ex4.m1.8.8.3.2.2"></sum><ci id="S3.Ex4.m1.8.8.3.2.3.cmml" xref="S3.Ex4.m1.8.8.3.2.3">𝑥</ci></apply><apply id="S3.Ex4.m1.8.8.3.1.cmml" xref="S3.Ex4.m1.8.8.3.1"><times id="S3.Ex4.m1.8.8.3.1.2.cmml" xref="S3.Ex4.m1.8.8.3.1.2"></times><ci id="S3.Ex4.m1.8.8.3.1.3.cmml" xref="S3.Ex4.m1.8.8.3.1.3">ℓ</ci><list id="S3.Ex4.m1.8.8.3.1.4.1.cmml" xref="S3.Ex4.m1.8.8.3.1.4.2"><ci id="S3.Ex4.m1.4.4.cmml" xref="S3.Ex4.m1.4.4">𝑥</ci><ci id="S3.Ex4.m1.5.5.cmml" xref="S3.Ex4.m1.5.5">𝜃</ci></list><ci id="S3.Ex4.m1.8.8.3.1.5.cmml" xref="S3.Ex4.m1.8.8.3.1.5">𝑃</ci><apply id="S3.Ex4.m1.8.8.3.1.1.1.1.cmml" xref="S3.Ex4.m1.8.8.3.1.1.1"><csymbol cd="latexml" id="S3.Ex4.m1.8.8.3.1.1.1.1.1.cmml" xref="S3.Ex4.m1.8.8.3.1.1.1.1.1">conditional</csymbol><ci id="S3.Ex4.m1.8.8.3.1.1.1.1.2.cmml" xref="S3.Ex4.m1.8.8.3.1.1.1.1.2">𝑥</ci><apply id="S3.Ex4.m1.8.8.3.1.1.1.1.3.cmml" xref="S3.Ex4.m1.8.8.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex4.m1.8.8.3.1.1.1.1.3.1.cmml" xref="S3.Ex4.m1.8.8.3.1.1.1.1.3">superscript</csymbol><ci id="S3.Ex4.m1.8.8.3.1.1.1.1.3.2.cmml" xref="S3.Ex4.m1.8.8.3.1.1.1.1.3.2">𝒟</ci><ci id="S3.Ex4.m1.8.8.3.1.1.1.1.3.3.cmml" xref="S3.Ex4.m1.8.8.3.1.1.1.1.3.3">s</ci></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex4.m1.8c">{\cal L}({\cal D}^{\rm s};\theta)=\mathop{\mathbb{E}}_{x\sim{\cal D}^{\rm s}}[%
\ell(x;\theta)]=\sum_{x}\ell(x;\theta)P(x|{\cal D}^{\rm s})</annotation><annotation encoding="application/x-llamapun" id="S3.Ex4.m1.8d">caligraphic_L ( caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ; italic_θ ) = blackboard_E start_POSTSUBSCRIPT italic_x ∼ caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT end_POSTSUBSCRIPT [ roman_ℓ ( italic_x ; italic_θ ) ] = ∑ start_POSTSUBSCRIPT italic_x end_POSTSUBSCRIPT roman_ℓ ( italic_x ; italic_θ ) italic_P ( italic_x | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.p2.2">We marginalize over a discrete latent variable <math alttext="c" class="ltx_Math" display="inline" id="S3.SS4.p2.2.m1.1"><semantics id="S3.SS4.p2.2.m1.1a"><mi id="S3.SS4.p2.2.m1.1.1" xref="S3.SS4.p2.2.m1.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.2.m1.1b"><ci id="S3.SS4.p2.2.m1.1.1.cmml" xref="S3.SS4.p2.2.m1.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.2.m1.1c">c</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.2.m1.1d">italic_c</annotation></semantics></math>, the cluster variable, and write</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E1">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="{\cal L}({\cal D}^{\rm s};\theta)=\sum_{x}\sum_{c}\ell(x;\theta)P(x|c,{\cal D}%
^{\rm s})P(c|{\cal D}^{\rm s})\underset{(2)}{=}\sum_{x}\sum_{c}\ell(x;\theta)P%
(x|c)P(c|{\cal D}^{\rm s})" class="ltx_Math" display="block" id="S3.E1.m1.12"><semantics id="S3.E1.m1.12a"><mrow id="S3.E1.m1.12.12" xref="S3.E1.m1.12.12.cmml"><mrow id="S3.E1.m1.8.8.1" xref="S3.E1.m1.8.8.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.8.8.1.3" xref="S3.E1.m1.8.8.1.3.cmml">ℒ</mi><mo id="S3.E1.m1.8.8.1.2" xref="S3.E1.m1.8.8.1.2.cmml">⁢</mo><mrow id="S3.E1.m1.8.8.1.1.1" xref="S3.E1.m1.8.8.1.1.2.cmml"><mo id="S3.E1.m1.8.8.1.1.1.2" stretchy="false" xref="S3.E1.m1.8.8.1.1.2.cmml">(</mo><msup id="S3.E1.m1.8.8.1.1.1.1" xref="S3.E1.m1.8.8.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.8.8.1.1.1.1.2" xref="S3.E1.m1.8.8.1.1.1.1.2.cmml">𝒟</mi><mi id="S3.E1.m1.8.8.1.1.1.1.3" mathvariant="normal" xref="S3.E1.m1.8.8.1.1.1.1.3.cmml">s</mi></msup><mo id="S3.E1.m1.8.8.1.1.1.3" xref="S3.E1.m1.8.8.1.1.2.cmml">;</mo><mi id="S3.E1.m1.2.2" xref="S3.E1.m1.2.2.cmml">θ</mi><mo id="S3.E1.m1.8.8.1.1.1.4" stretchy="false" xref="S3.E1.m1.8.8.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E1.m1.12.12.6" rspace="0.111em" xref="S3.E1.m1.12.12.6.cmml">=</mo><mrow id="S3.E1.m1.12.12.5" xref="S3.E1.m1.12.12.5.cmml"><munder id="S3.E1.m1.12.12.5.5" xref="S3.E1.m1.12.12.5.5.cmml"><mo id="S3.E1.m1.12.12.5.5.2" movablelimits="false" rspace="0em" xref="S3.E1.m1.12.12.5.5.2.cmml">∑</mo><mi id="S3.E1.m1.12.12.5.5.3" xref="S3.E1.m1.12.12.5.5.3.cmml">x</mi></munder><mrow id="S3.E1.m1.12.12.5.4" xref="S3.E1.m1.12.12.5.4.cmml"><munder id="S3.E1.m1.12.12.5.4.5" xref="S3.E1.m1.12.12.5.4.5.cmml"><mo id="S3.E1.m1.12.12.5.4.5.2" movablelimits="false" xref="S3.E1.m1.12.12.5.4.5.2.cmml">∑</mo><mi id="S3.E1.m1.12.12.5.4.5.3" xref="S3.E1.m1.12.12.5.4.5.3.cmml">c</mi></munder><mrow id="S3.E1.m1.12.12.5.4.4" xref="S3.E1.m1.12.12.5.4.4.cmml"><mi id="S3.E1.m1.12.12.5.4.4.6" mathvariant="normal" xref="S3.E1.m1.12.12.5.4.4.6.cmml">ℓ</mi><mo id="S3.E1.m1.12.12.5.4.4.5" xref="S3.E1.m1.12.12.5.4.4.5.cmml">⁢</mo><mrow id="S3.E1.m1.12.12.5.4.4.7.2" xref="S3.E1.m1.12.12.5.4.4.7.1.cmml"><mo id="S3.E1.m1.12.12.5.4.4.7.2.1" stretchy="false" xref="S3.E1.m1.12.12.5.4.4.7.1.cmml">(</mo><mi id="S3.E1.m1.3.3" xref="S3.E1.m1.3.3.cmml">x</mi><mo id="S3.E1.m1.12.12.5.4.4.7.2.2" xref="S3.E1.m1.12.12.5.4.4.7.1.cmml">;</mo><mi id="S3.E1.m1.4.4" xref="S3.E1.m1.4.4.cmml">θ</mi><mo id="S3.E1.m1.12.12.5.4.4.7.2.3" stretchy="false" xref="S3.E1.m1.12.12.5.4.4.7.1.cmml">)</mo></mrow><mo id="S3.E1.m1.12.12.5.4.4.5a" xref="S3.E1.m1.12.12.5.4.4.5.cmml">⁢</mo><mi id="S3.E1.m1.12.12.5.4.4.8" xref="S3.E1.m1.12.12.5.4.4.8.cmml">P</mi><mo id="S3.E1.m1.12.12.5.4.4.5b" xref="S3.E1.m1.12.12.5.4.4.5.cmml">⁢</mo><mrow id="S3.E1.m1.9.9.2.1.1.1.1" xref="S3.E1.m1.9.9.2.1.1.1.1.1.cmml"><mo id="S3.E1.m1.9.9.2.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.9.9.2.1.1.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.9.9.2.1.1.1.1.1" xref="S3.E1.m1.9.9.2.1.1.1.1.1.cmml"><mi id="S3.E1.m1.9.9.2.1.1.1.1.1.3" xref="S3.E1.m1.9.9.2.1.1.1.1.1.3.cmml">x</mi><mo fence="false" id="S3.E1.m1.9.9.2.1.1.1.1.1.2" xref="S3.E1.m1.9.9.2.1.1.1.1.1.2.cmml">|</mo><mrow id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.2.cmml"><mi id="S3.E1.m1.5.5" xref="S3.E1.m1.5.5.cmml">c</mi><mo id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.2" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.2.cmml">,</mo><msup id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.2" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.2.cmml">𝒟</mi><mi id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.3" mathvariant="normal" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.3.cmml">s</mi></msup></mrow></mrow><mo id="S3.E1.m1.9.9.2.1.1.1.1.3" stretchy="false" xref="S3.E1.m1.9.9.2.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E1.m1.12.12.5.4.4.5c" xref="S3.E1.m1.12.12.5.4.4.5.cmml">⁢</mo><mi id="S3.E1.m1.12.12.5.4.4.9" xref="S3.E1.m1.12.12.5.4.4.9.cmml">P</mi><mo id="S3.E1.m1.12.12.5.4.4.5d" xref="S3.E1.m1.12.12.5.4.4.5.cmml">⁢</mo><mrow id="S3.E1.m1.10.10.3.2.2.2.1" xref="S3.E1.m1.10.10.3.2.2.2.1.1.cmml"><mo id="S3.E1.m1.10.10.3.2.2.2.1.2" stretchy="false" xref="S3.E1.m1.10.10.3.2.2.2.1.1.cmml">(</mo><mrow id="S3.E1.m1.10.10.3.2.2.2.1.1" xref="S3.E1.m1.10.10.3.2.2.2.1.1.cmml"><mi id="S3.E1.m1.10.10.3.2.2.2.1.1.2" xref="S3.E1.m1.10.10.3.2.2.2.1.1.2.cmml">c</mi><mo fence="false" id="S3.E1.m1.10.10.3.2.2.2.1.1.1" xref="S3.E1.m1.10.10.3.2.2.2.1.1.1.cmml">|</mo><msup id="S3.E1.m1.10.10.3.2.2.2.1.1.3" xref="S3.E1.m1.10.10.3.2.2.2.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.10.10.3.2.2.2.1.1.3.2" xref="S3.E1.m1.10.10.3.2.2.2.1.1.3.2.cmml">𝒟</mi><mi id="S3.E1.m1.10.10.3.2.2.2.1.1.3.3" mathvariant="normal" xref="S3.E1.m1.10.10.3.2.2.2.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.E1.m1.10.10.3.2.2.2.1.3" stretchy="false" xref="S3.E1.m1.10.10.3.2.2.2.1.1.cmml">)</mo></mrow><mo id="S3.E1.m1.12.12.5.4.4.5e" xref="S3.E1.m1.12.12.5.4.4.5.cmml">⁢</mo><munder accentunder="true" id="S3.E1.m1.1.1" xref="S3.E1.m1.1.1.cmml"><mo id="S3.E1.m1.1.1.2" xref="S3.E1.m1.1.1.2.cmml">=</mo><mrow id="S3.E1.m1.1.1.1.3" xref="S3.E1.m1.1.1.cmml"><mo id="S3.E1.m1.1.1.1.3.1" stretchy="false" xref="S3.E1.m1.1.1.cmml">(</mo><mn id="S3.E1.m1.1.1.1.1" xref="S3.E1.m1.1.1.1.1.cmml">2</mn><mo id="S3.E1.m1.1.1.1.3.2" stretchy="false" xref="S3.E1.m1.1.1.cmml">)</mo></mrow></munder><mo id="S3.E1.m1.12.12.5.4.4.5f" lspace="0.278em" xref="S3.E1.m1.12.12.5.4.4.5.cmml">⁢</mo><mrow id="S3.E1.m1.12.12.5.4.4.4" xref="S3.E1.m1.12.12.5.4.4.4.cmml"><munder id="S3.E1.m1.12.12.5.4.4.4.3" xref="S3.E1.m1.12.12.5.4.4.4.3.cmml"><mo id="S3.E1.m1.12.12.5.4.4.4.3.2" movablelimits="false" rspace="0em" xref="S3.E1.m1.12.12.5.4.4.4.3.2.cmml">∑</mo><mi id="S3.E1.m1.12.12.5.4.4.4.3.3" xref="S3.E1.m1.12.12.5.4.4.4.3.3.cmml">x</mi></munder><mrow id="S3.E1.m1.12.12.5.4.4.4.2" xref="S3.E1.m1.12.12.5.4.4.4.2.cmml"><munder id="S3.E1.m1.12.12.5.4.4.4.2.3" xref="S3.E1.m1.12.12.5.4.4.4.2.3.cmml"><mo id="S3.E1.m1.12.12.5.4.4.4.2.3.2" movablelimits="false" xref="S3.E1.m1.12.12.5.4.4.4.2.3.2.cmml">∑</mo><mi id="S3.E1.m1.12.12.5.4.4.4.2.3.3" xref="S3.E1.m1.12.12.5.4.4.4.2.3.3.cmml">c</mi></munder><mrow id="S3.E1.m1.12.12.5.4.4.4.2.2" xref="S3.E1.m1.12.12.5.4.4.4.2.2.cmml"><mi id="S3.E1.m1.12.12.5.4.4.4.2.2.4" mathvariant="normal" xref="S3.E1.m1.12.12.5.4.4.4.2.2.4.cmml">ℓ</mi><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.3" xref="S3.E1.m1.12.12.5.4.4.4.2.2.3.cmml">⁢</mo><mrow id="S3.E1.m1.12.12.5.4.4.4.2.2.5.2" xref="S3.E1.m1.12.12.5.4.4.4.2.2.5.1.cmml"><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.5.2.1" stretchy="false" xref="S3.E1.m1.12.12.5.4.4.4.2.2.5.1.cmml">(</mo><mi id="S3.E1.m1.6.6" xref="S3.E1.m1.6.6.cmml">x</mi><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.5.2.2" xref="S3.E1.m1.12.12.5.4.4.4.2.2.5.1.cmml">;</mo><mi id="S3.E1.m1.7.7" xref="S3.E1.m1.7.7.cmml">θ</mi><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.5.2.3" stretchy="false" xref="S3.E1.m1.12.12.5.4.4.4.2.2.5.1.cmml">)</mo></mrow><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.3a" xref="S3.E1.m1.12.12.5.4.4.4.2.2.3.cmml">⁢</mo><mi id="S3.E1.m1.12.12.5.4.4.4.2.2.6" xref="S3.E1.m1.12.12.5.4.4.4.2.2.6.cmml">P</mi><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.3b" xref="S3.E1.m1.12.12.5.4.4.4.2.2.3.cmml">⁢</mo><mrow id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.cmml"><mo id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.2" stretchy="false" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.cmml">(</mo><mrow id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.cmml"><mi id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.2" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.2.cmml">x</mi><mo fence="false" id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.1" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.1.cmml">|</mo><mi id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.3" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.3.cmml">c</mi></mrow><mo id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.3" stretchy="false" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.cmml">)</mo></mrow><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.3c" xref="S3.E1.m1.12.12.5.4.4.4.2.2.3.cmml">⁢</mo><mi id="S3.E1.m1.12.12.5.4.4.4.2.2.7" xref="S3.E1.m1.12.12.5.4.4.4.2.2.7.cmml">P</mi><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.3d" xref="S3.E1.m1.12.12.5.4.4.4.2.2.3.cmml">⁢</mo><mrow id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.cmml"><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.2" stretchy="false" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.cmml">(</mo><mrow id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.cmml"><mi id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.2" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.2.cmml">c</mi><mo fence="false" id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.1" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.1.cmml">|</mo><msup id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.2" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.2.cmml">𝒟</mi><mi id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.3" mathvariant="normal" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.3" stretchy="false" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.cmml">)</mo></mrow></mrow></mrow></mrow></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E1.m1.12b"><apply id="S3.E1.m1.12.12.cmml" xref="S3.E1.m1.12.12"><eq id="S3.E1.m1.12.12.6.cmml" xref="S3.E1.m1.12.12.6"></eq><apply id="S3.E1.m1.8.8.1.cmml" xref="S3.E1.m1.8.8.1"><times id="S3.E1.m1.8.8.1.2.cmml" xref="S3.E1.m1.8.8.1.2"></times><ci id="S3.E1.m1.8.8.1.3.cmml" xref="S3.E1.m1.8.8.1.3">ℒ</ci><list id="S3.E1.m1.8.8.1.1.2.cmml" xref="S3.E1.m1.8.8.1.1.1"><apply id="S3.E1.m1.8.8.1.1.1.1.cmml" xref="S3.E1.m1.8.8.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.8.8.1.1.1.1.1.cmml" xref="S3.E1.m1.8.8.1.1.1.1">superscript</csymbol><ci id="S3.E1.m1.8.8.1.1.1.1.2.cmml" xref="S3.E1.m1.8.8.1.1.1.1.2">𝒟</ci><ci id="S3.E1.m1.8.8.1.1.1.1.3.cmml" xref="S3.E1.m1.8.8.1.1.1.1.3">s</ci></apply><ci id="S3.E1.m1.2.2.cmml" xref="S3.E1.m1.2.2">𝜃</ci></list></apply><apply id="S3.E1.m1.12.12.5.cmml" xref="S3.E1.m1.12.12.5"><apply id="S3.E1.m1.12.12.5.5.cmml" xref="S3.E1.m1.12.12.5.5"><csymbol cd="ambiguous" id="S3.E1.m1.12.12.5.5.1.cmml" xref="S3.E1.m1.12.12.5.5">subscript</csymbol><sum id="S3.E1.m1.12.12.5.5.2.cmml" xref="S3.E1.m1.12.12.5.5.2"></sum><ci id="S3.E1.m1.12.12.5.5.3.cmml" xref="S3.E1.m1.12.12.5.5.3">𝑥</ci></apply><apply id="S3.E1.m1.12.12.5.4.cmml" xref="S3.E1.m1.12.12.5.4"><apply id="S3.E1.m1.12.12.5.4.5.cmml" xref="S3.E1.m1.12.12.5.4.5"><csymbol cd="ambiguous" id="S3.E1.m1.12.12.5.4.5.1.cmml" xref="S3.E1.m1.12.12.5.4.5">subscript</csymbol><sum id="S3.E1.m1.12.12.5.4.5.2.cmml" xref="S3.E1.m1.12.12.5.4.5.2"></sum><ci id="S3.E1.m1.12.12.5.4.5.3.cmml" xref="S3.E1.m1.12.12.5.4.5.3">𝑐</ci></apply><apply id="S3.E1.m1.12.12.5.4.4.cmml" xref="S3.E1.m1.12.12.5.4.4"><times id="S3.E1.m1.12.12.5.4.4.5.cmml" xref="S3.E1.m1.12.12.5.4.4.5"></times><ci id="S3.E1.m1.12.12.5.4.4.6.cmml" xref="S3.E1.m1.12.12.5.4.4.6">ℓ</ci><list id="S3.E1.m1.12.12.5.4.4.7.1.cmml" xref="S3.E1.m1.12.12.5.4.4.7.2"><ci id="S3.E1.m1.3.3.cmml" xref="S3.E1.m1.3.3">𝑥</ci><ci id="S3.E1.m1.4.4.cmml" xref="S3.E1.m1.4.4">𝜃</ci></list><ci id="S3.E1.m1.12.12.5.4.4.8.cmml" xref="S3.E1.m1.12.12.5.4.4.8">𝑃</ci><apply id="S3.E1.m1.9.9.2.1.1.1.1.1.cmml" xref="S3.E1.m1.9.9.2.1.1.1.1"><csymbol cd="latexml" id="S3.E1.m1.9.9.2.1.1.1.1.1.2.cmml" xref="S3.E1.m1.9.9.2.1.1.1.1.1.2">conditional</csymbol><ci id="S3.E1.m1.9.9.2.1.1.1.1.1.3.cmml" xref="S3.E1.m1.9.9.2.1.1.1.1.1.3">𝑥</ci><list id="S3.E1.m1.9.9.2.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.1"><ci id="S3.E1.m1.5.5.cmml" xref="S3.E1.m1.5.5">𝑐</ci><apply id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.1.cmml" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.2.cmml" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.2">𝒟</ci><ci id="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.3.cmml" xref="S3.E1.m1.9.9.2.1.1.1.1.1.1.1.1.3">s</ci></apply></list></apply><ci id="S3.E1.m1.12.12.5.4.4.9.cmml" xref="S3.E1.m1.12.12.5.4.4.9">𝑃</ci><apply id="S3.E1.m1.10.10.3.2.2.2.1.1.cmml" xref="S3.E1.m1.10.10.3.2.2.2.1"><csymbol cd="latexml" id="S3.E1.m1.10.10.3.2.2.2.1.1.1.cmml" xref="S3.E1.m1.10.10.3.2.2.2.1.1.1">conditional</csymbol><ci id="S3.E1.m1.10.10.3.2.2.2.1.1.2.cmml" xref="S3.E1.m1.10.10.3.2.2.2.1.1.2">𝑐</ci><apply id="S3.E1.m1.10.10.3.2.2.2.1.1.3.cmml" xref="S3.E1.m1.10.10.3.2.2.2.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.10.10.3.2.2.2.1.1.3.1.cmml" xref="S3.E1.m1.10.10.3.2.2.2.1.1.3">superscript</csymbol><ci id="S3.E1.m1.10.10.3.2.2.2.1.1.3.2.cmml" xref="S3.E1.m1.10.10.3.2.2.2.1.1.3.2">𝒟</ci><ci id="S3.E1.m1.10.10.3.2.2.2.1.1.3.3.cmml" xref="S3.E1.m1.10.10.3.2.2.2.1.1.3.3">s</ci></apply></apply><apply id="S3.E1.m1.1.1.cmml" xref="S3.E1.m1.1.1"><cn id="S3.E1.m1.1.1.1.1.cmml" type="integer" xref="S3.E1.m1.1.1.1.1">2</cn><eq id="S3.E1.m1.1.1.2.cmml" xref="S3.E1.m1.1.1.2"></eq></apply><apply id="S3.E1.m1.12.12.5.4.4.4.cmml" xref="S3.E1.m1.12.12.5.4.4.4"><apply id="S3.E1.m1.12.12.5.4.4.4.3.cmml" xref="S3.E1.m1.12.12.5.4.4.4.3"><csymbol cd="ambiguous" id="S3.E1.m1.12.12.5.4.4.4.3.1.cmml" xref="S3.E1.m1.12.12.5.4.4.4.3">subscript</csymbol><sum id="S3.E1.m1.12.12.5.4.4.4.3.2.cmml" xref="S3.E1.m1.12.12.5.4.4.4.3.2"></sum><ci id="S3.E1.m1.12.12.5.4.4.4.3.3.cmml" xref="S3.E1.m1.12.12.5.4.4.4.3.3">𝑥</ci></apply><apply id="S3.E1.m1.12.12.5.4.4.4.2.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2"><apply id="S3.E1.m1.12.12.5.4.4.4.2.3.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.3"><csymbol cd="ambiguous" id="S3.E1.m1.12.12.5.4.4.4.2.3.1.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.3">subscript</csymbol><sum id="S3.E1.m1.12.12.5.4.4.4.2.3.2.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.3.2"></sum><ci id="S3.E1.m1.12.12.5.4.4.4.2.3.3.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.3.3">𝑐</ci></apply><apply id="S3.E1.m1.12.12.5.4.4.4.2.2.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2"><times id="S3.E1.m1.12.12.5.4.4.4.2.2.3.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.3"></times><ci id="S3.E1.m1.12.12.5.4.4.4.2.2.4.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.4">ℓ</ci><list id="S3.E1.m1.12.12.5.4.4.4.2.2.5.1.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.5.2"><ci id="S3.E1.m1.6.6.cmml" xref="S3.E1.m1.6.6">𝑥</ci><ci id="S3.E1.m1.7.7.cmml" xref="S3.E1.m1.7.7">𝜃</ci></list><ci id="S3.E1.m1.12.12.5.4.4.4.2.2.6.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.6">𝑃</ci><apply id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.cmml" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1"><csymbol cd="latexml" id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.1.cmml" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.1">conditional</csymbol><ci id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.2.cmml" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.2">𝑥</ci><ci id="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.3.cmml" xref="S3.E1.m1.11.11.4.3.3.3.1.1.1.1.1.3">𝑐</ci></apply><ci id="S3.E1.m1.12.12.5.4.4.4.2.2.7.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.7">𝑃</ci><apply id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1"><csymbol cd="latexml" id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.1.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.1">conditional</csymbol><ci id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.2.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.2">𝑐</ci><apply id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3"><csymbol cd="ambiguous" id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.1.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3">superscript</csymbol><ci id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.2.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.2">𝒟</ci><ci id="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.3.cmml" xref="S3.E1.m1.12.12.5.4.4.4.2.2.2.1.1.3.3">s</ci></apply></apply></apply></apply></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E1.m1.12c">{\cal L}({\cal D}^{\rm s};\theta)=\sum_{x}\sum_{c}\ell(x;\theta)P(x|c,{\cal D}%
^{\rm s})P(c|{\cal D}^{\rm s})\underset{(2)}{=}\sum_{x}\sum_{c}\ell(x;\theta)P%
(x|c)P(c|{\cal D}^{\rm s})</annotation><annotation encoding="application/x-llamapun" id="S3.E1.m1.12d">caligraphic_L ( caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ; italic_θ ) = ∑ start_POSTSUBSCRIPT italic_x end_POSTSUBSCRIPT ∑ start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT roman_ℓ ( italic_x ; italic_θ ) italic_P ( italic_x | italic_c , caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) start_UNDERACCENT ( 2 ) end_UNDERACCENT start_ARG = end_ARG ∑ start_POSTSUBSCRIPT italic_x end_POSTSUBSCRIPT ∑ start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT roman_ℓ ( italic_x ; italic_θ ) italic_P ( italic_x | italic_c ) italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT )</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(1)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.p2.5">where the second equality <math alttext="{=}_{(2)}" class="ltx_Math" display="inline" id="S3.SS4.p2.3.m1.1"><semantics id="S3.SS4.p2.3.m1.1a"><msub id="S3.SS4.p2.3.m1.1.2" xref="S3.SS4.p2.3.m1.1.2.cmml"><mo id="S3.SS4.p2.3.m1.1.2.2" xref="S3.SS4.p2.3.m1.1.2.2.cmml">=</mo><mrow id="S3.SS4.p2.3.m1.1.1.1.3" xref="S3.SS4.p2.3.m1.1.2.cmml"><mo id="S3.SS4.p2.3.m1.1.1.1.3.1" stretchy="false" xref="S3.SS4.p2.3.m1.1.2.cmml">(</mo><mn id="S3.SS4.p2.3.m1.1.1.1.1" xref="S3.SS4.p2.3.m1.1.1.1.1.cmml">2</mn><mo id="S3.SS4.p2.3.m1.1.1.1.3.2" stretchy="false" xref="S3.SS4.p2.3.m1.1.2.cmml">)</mo></mrow></msub><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.3.m1.1b"><apply id="S3.SS4.p2.3.m1.1.2.cmml" xref="S3.SS4.p2.3.m1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p2.3.m1.1.2.1.cmml" xref="S3.SS4.p2.3.m1.1.2">subscript</csymbol><eq id="S3.SS4.p2.3.m1.1.2.2.cmml" xref="S3.SS4.p2.3.m1.1.2.2"></eq><cn id="S3.SS4.p2.3.m1.1.1.1.1.cmml" type="integer" xref="S3.SS4.p2.3.m1.1.1.1.1">2</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.3.m1.1c">{=}_{(2)}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.3.m1.1d">= start_POSTSUBSCRIPT ( 2 ) end_POSTSUBSCRIPT</annotation></semantics></math> makes the independence assumption
<math alttext="P(x|c,{\cal D}^{\rm s})=P(x|c)" class="ltx_Math" display="inline" id="S3.SS4.p2.4.m2.3"><semantics id="S3.SS4.p2.4.m2.3a"><mrow id="S3.SS4.p2.4.m2.3.3" xref="S3.SS4.p2.4.m2.3.3.cmml"><mrow id="S3.SS4.p2.4.m2.2.2.1" xref="S3.SS4.p2.4.m2.2.2.1.cmml"><mi id="S3.SS4.p2.4.m2.2.2.1.3" xref="S3.SS4.p2.4.m2.2.2.1.3.cmml">P</mi><mo id="S3.SS4.p2.4.m2.2.2.1.2" xref="S3.SS4.p2.4.m2.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS4.p2.4.m2.2.2.1.1.1" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.cmml"><mo id="S3.SS4.p2.4.m2.2.2.1.1.1.2" stretchy="false" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p2.4.m2.2.2.1.1.1.1" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.cmml"><mi id="S3.SS4.p2.4.m2.2.2.1.1.1.1.3" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.3.cmml">x</mi><mo fence="false" id="S3.SS4.p2.4.m2.2.2.1.1.1.1.2" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.2.cmml">|</mo><mrow id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.2.cmml"><mi id="S3.SS4.p2.4.m2.1.1" xref="S3.SS4.p2.4.m2.1.1.cmml">c</mi><mo id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.2" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.2.cmml">,</mo><msup id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.2" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.2.cmml">𝒟</mi><mi id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.3" mathvariant="normal" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.3.cmml">s</mi></msup></mrow></mrow><mo id="S3.SS4.p2.4.m2.2.2.1.1.1.3" stretchy="false" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p2.4.m2.3.3.3" xref="S3.SS4.p2.4.m2.3.3.3.cmml">=</mo><mrow id="S3.SS4.p2.4.m2.3.3.2" xref="S3.SS4.p2.4.m2.3.3.2.cmml"><mi id="S3.SS4.p2.4.m2.3.3.2.3" xref="S3.SS4.p2.4.m2.3.3.2.3.cmml">P</mi><mo id="S3.SS4.p2.4.m2.3.3.2.2" xref="S3.SS4.p2.4.m2.3.3.2.2.cmml">⁢</mo><mrow id="S3.SS4.p2.4.m2.3.3.2.1.1" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.cmml"><mo id="S3.SS4.p2.4.m2.3.3.2.1.1.2" stretchy="false" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.cmml">(</mo><mrow id="S3.SS4.p2.4.m2.3.3.2.1.1.1" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.cmml"><mi id="S3.SS4.p2.4.m2.3.3.2.1.1.1.2" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.2.cmml">x</mi><mo fence="false" id="S3.SS4.p2.4.m2.3.3.2.1.1.1.1" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.1.cmml">|</mo><mi id="S3.SS4.p2.4.m2.3.3.2.1.1.1.3" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.3.cmml">c</mi></mrow><mo id="S3.SS4.p2.4.m2.3.3.2.1.1.3" stretchy="false" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.4.m2.3b"><apply id="S3.SS4.p2.4.m2.3.3.cmml" xref="S3.SS4.p2.4.m2.3.3"><eq id="S3.SS4.p2.4.m2.3.3.3.cmml" xref="S3.SS4.p2.4.m2.3.3.3"></eq><apply id="S3.SS4.p2.4.m2.2.2.1.cmml" xref="S3.SS4.p2.4.m2.2.2.1"><times id="S3.SS4.p2.4.m2.2.2.1.2.cmml" xref="S3.SS4.p2.4.m2.2.2.1.2"></times><ci id="S3.SS4.p2.4.m2.2.2.1.3.cmml" xref="S3.SS4.p2.4.m2.2.2.1.3">𝑃</ci><apply id="S3.SS4.p2.4.m2.2.2.1.1.1.1.cmml" xref="S3.SS4.p2.4.m2.2.2.1.1.1"><csymbol cd="latexml" id="S3.SS4.p2.4.m2.2.2.1.1.1.1.2.cmml" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.2">conditional</csymbol><ci id="S3.SS4.p2.4.m2.2.2.1.1.1.1.3.cmml" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.3">𝑥</ci><list id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.2.cmml" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1"><ci id="S3.SS4.p2.4.m2.1.1.cmml" xref="S3.SS4.p2.4.m2.1.1">𝑐</ci><apply id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.2">𝒟</ci><ci id="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.SS4.p2.4.m2.2.2.1.1.1.1.1.1.1.3">s</ci></apply></list></apply></apply><apply id="S3.SS4.p2.4.m2.3.3.2.cmml" xref="S3.SS4.p2.4.m2.3.3.2"><times id="S3.SS4.p2.4.m2.3.3.2.2.cmml" xref="S3.SS4.p2.4.m2.3.3.2.2"></times><ci id="S3.SS4.p2.4.m2.3.3.2.3.cmml" xref="S3.SS4.p2.4.m2.3.3.2.3">𝑃</ci><apply id="S3.SS4.p2.4.m2.3.3.2.1.1.1.cmml" xref="S3.SS4.p2.4.m2.3.3.2.1.1"><csymbol cd="latexml" id="S3.SS4.p2.4.m2.3.3.2.1.1.1.1.cmml" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.1">conditional</csymbol><ci id="S3.SS4.p2.4.m2.3.3.2.1.1.1.2.cmml" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.2">𝑥</ci><ci id="S3.SS4.p2.4.m2.3.3.2.1.1.1.3.cmml" xref="S3.SS4.p2.4.m2.3.3.2.1.1.1.3">𝑐</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.4.m2.3c">P(x|c,{\cal D}^{\rm s})=P(x|c)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.4.m2.3d">italic_P ( italic_x | italic_c , caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) = italic_P ( italic_x | italic_c )</annotation></semantics></math>. If we make a similar assumption for the
generalist loss <math alttext="P(x|c,{\cal D}^{\rm g})=P(x|c)" class="ltx_Math" display="inline" id="S3.SS4.p2.5.m3.3"><semantics id="S3.SS4.p2.5.m3.3a"><mrow id="S3.SS4.p2.5.m3.3.3" xref="S3.SS4.p2.5.m3.3.3.cmml"><mrow id="S3.SS4.p2.5.m3.2.2.1" xref="S3.SS4.p2.5.m3.2.2.1.cmml"><mi id="S3.SS4.p2.5.m3.2.2.1.3" xref="S3.SS4.p2.5.m3.2.2.1.3.cmml">P</mi><mo id="S3.SS4.p2.5.m3.2.2.1.2" xref="S3.SS4.p2.5.m3.2.2.1.2.cmml">⁢</mo><mrow id="S3.SS4.p2.5.m3.2.2.1.1.1" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.cmml"><mo id="S3.SS4.p2.5.m3.2.2.1.1.1.2" stretchy="false" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p2.5.m3.2.2.1.1.1.1" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.cmml"><mi id="S3.SS4.p2.5.m3.2.2.1.1.1.1.3" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.3.cmml">x</mi><mo fence="false" id="S3.SS4.p2.5.m3.2.2.1.1.1.1.2" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.2.cmml">|</mo><mrow id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.2.cmml"><mi id="S3.SS4.p2.5.m3.1.1" xref="S3.SS4.p2.5.m3.1.1.cmml">c</mi><mo id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.2" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.2.cmml">,</mo><msup id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.2" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.2.cmml">𝒟</mi><mi id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.3" mathvariant="normal" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.3.cmml">g</mi></msup></mrow></mrow><mo id="S3.SS4.p2.5.m3.2.2.1.1.1.3" stretchy="false" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p2.5.m3.3.3.3" xref="S3.SS4.p2.5.m3.3.3.3.cmml">=</mo><mrow id="S3.SS4.p2.5.m3.3.3.2" xref="S3.SS4.p2.5.m3.3.3.2.cmml"><mi id="S3.SS4.p2.5.m3.3.3.2.3" xref="S3.SS4.p2.5.m3.3.3.2.3.cmml">P</mi><mo id="S3.SS4.p2.5.m3.3.3.2.2" xref="S3.SS4.p2.5.m3.3.3.2.2.cmml">⁢</mo><mrow id="S3.SS4.p2.5.m3.3.3.2.1.1" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.cmml"><mo id="S3.SS4.p2.5.m3.3.3.2.1.1.2" stretchy="false" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.cmml">(</mo><mrow id="S3.SS4.p2.5.m3.3.3.2.1.1.1" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.cmml"><mi id="S3.SS4.p2.5.m3.3.3.2.1.1.1.2" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.2.cmml">x</mi><mo fence="false" id="S3.SS4.p2.5.m3.3.3.2.1.1.1.1" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.1.cmml">|</mo><mi id="S3.SS4.p2.5.m3.3.3.2.1.1.1.3" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.3.cmml">c</mi></mrow><mo id="S3.SS4.p2.5.m3.3.3.2.1.1.3" stretchy="false" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.5.m3.3b"><apply id="S3.SS4.p2.5.m3.3.3.cmml" xref="S3.SS4.p2.5.m3.3.3"><eq id="S3.SS4.p2.5.m3.3.3.3.cmml" xref="S3.SS4.p2.5.m3.3.3.3"></eq><apply id="S3.SS4.p2.5.m3.2.2.1.cmml" xref="S3.SS4.p2.5.m3.2.2.1"><times id="S3.SS4.p2.5.m3.2.2.1.2.cmml" xref="S3.SS4.p2.5.m3.2.2.1.2"></times><ci id="S3.SS4.p2.5.m3.2.2.1.3.cmml" xref="S3.SS4.p2.5.m3.2.2.1.3">𝑃</ci><apply id="S3.SS4.p2.5.m3.2.2.1.1.1.1.cmml" xref="S3.SS4.p2.5.m3.2.2.1.1.1"><csymbol cd="latexml" id="S3.SS4.p2.5.m3.2.2.1.1.1.1.2.cmml" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.2">conditional</csymbol><ci id="S3.SS4.p2.5.m3.2.2.1.1.1.1.3.cmml" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.3">𝑥</ci><list id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.2.cmml" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1"><ci id="S3.SS4.p2.5.m3.1.1.cmml" xref="S3.SS4.p2.5.m3.1.1">𝑐</ci><apply id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1">superscript</csymbol><ci id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.2.cmml" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.2">𝒟</ci><ci id="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.3.cmml" xref="S3.SS4.p2.5.m3.2.2.1.1.1.1.1.1.1.3">g</ci></apply></list></apply></apply><apply id="S3.SS4.p2.5.m3.3.3.2.cmml" xref="S3.SS4.p2.5.m3.3.3.2"><times id="S3.SS4.p2.5.m3.3.3.2.2.cmml" xref="S3.SS4.p2.5.m3.3.3.2.2"></times><ci id="S3.SS4.p2.5.m3.3.3.2.3.cmml" xref="S3.SS4.p2.5.m3.3.3.2.3">𝑃</ci><apply id="S3.SS4.p2.5.m3.3.3.2.1.1.1.cmml" xref="S3.SS4.p2.5.m3.3.3.2.1.1"><csymbol cd="latexml" id="S3.SS4.p2.5.m3.3.3.2.1.1.1.1.cmml" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.1">conditional</csymbol><ci id="S3.SS4.p2.5.m3.3.3.2.1.1.1.2.cmml" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.2">𝑥</ci><ci id="S3.SS4.p2.5.m3.3.3.2.1.1.1.3.cmml" xref="S3.SS4.p2.5.m3.3.3.2.1.1.1.3">𝑐</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.5.m3.3c">P(x|c,{\cal D}^{\rm g})=P(x|c)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.5.m3.3d">italic_P ( italic_x | italic_c , caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ) = italic_P ( italic_x | italic_c )</annotation></semantics></math>, we can write both losses as</p>
<table class="ltx_equation ltx_eqn_table" id="S3.E2">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="{\cal L}({\cal D}^{\rm s};\theta)=\mathop{\mathbb{E}}_{c\sim(c|{\cal D}^{\rm s%
})}[{\cal L}(c;\theta)]\quad\text{and}\quad{\cal L}({\cal D}^{\rm g};\theta)=%
\mathop{\mathbb{E}}_{c\sim(c|{\cal D}^{\rm g})}[{\cal L}(c;\theta)]" class="ltx_Math" display="block" id="S3.E2.m1.11"><semantics id="S3.E2.m1.11a"><mrow id="S3.E2.m1.11.11.2" xref="S3.E2.m1.11.11.3.cmml"><mrow id="S3.E2.m1.10.10.1.1" xref="S3.E2.m1.10.10.1.1.cmml"><mrow id="S3.E2.m1.10.10.1.1.1" xref="S3.E2.m1.10.10.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.10.10.1.1.1.3" xref="S3.E2.m1.10.10.1.1.1.3.cmml">ℒ</mi><mo id="S3.E2.m1.10.10.1.1.1.2" xref="S3.E2.m1.10.10.1.1.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.10.10.1.1.1.1.1" xref="S3.E2.m1.10.10.1.1.1.1.2.cmml"><mo id="S3.E2.m1.10.10.1.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.10.10.1.1.1.1.2.cmml">(</mo><msup id="S3.E2.m1.10.10.1.1.1.1.1.1" xref="S3.E2.m1.10.10.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.10.10.1.1.1.1.1.1.2" xref="S3.E2.m1.10.10.1.1.1.1.1.1.2.cmml">𝒟</mi><mi id="S3.E2.m1.10.10.1.1.1.1.1.1.3" mathvariant="normal" xref="S3.E2.m1.10.10.1.1.1.1.1.1.3.cmml">s</mi></msup><mo id="S3.E2.m1.10.10.1.1.1.1.1.3" xref="S3.E2.m1.10.10.1.1.1.1.2.cmml">;</mo><mi id="S3.E2.m1.3.3" xref="S3.E2.m1.3.3.cmml">θ</mi><mo id="S3.E2.m1.10.10.1.1.1.1.1.4" stretchy="false" xref="S3.E2.m1.10.10.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.10.10.1.1.3" rspace="0.1389em" xref="S3.E2.m1.10.10.1.1.3.cmml">=</mo><mrow id="S3.E2.m1.10.10.1.1.2.1" xref="S3.E2.m1.10.10.1.1.2.2.cmml"><mrow id="S3.E2.m1.10.10.1.1.2.1.1" xref="S3.E2.m1.10.10.1.1.2.1.1.cmml"><munder id="S3.E2.m1.10.10.1.1.2.1.1.2" xref="S3.E2.m1.10.10.1.1.2.1.1.2.cmml"><mo id="S3.E2.m1.10.10.1.1.2.1.1.2.2" lspace="0.1389em" movablelimits="false" rspace="0em" xref="S3.E2.m1.10.10.1.1.2.1.1.2.2.cmml">𝔼</mo><mrow id="S3.E2.m1.1.1.1" xref="S3.E2.m1.1.1.1.cmml"><mi id="S3.E2.m1.1.1.1.3" xref="S3.E2.m1.1.1.1.3.cmml">c</mi><mo id="S3.E2.m1.1.1.1.2" xref="S3.E2.m1.1.1.1.2.cmml">∼</mo><mrow id="S3.E2.m1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.cmml"><mo id="S3.E2.m1.1.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.E2.m1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.cmml"><mi id="S3.E2.m1.1.1.1.1.1.1.2" xref="S3.E2.m1.1.1.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.E2.m1.1.1.1.1.1.1.1" xref="S3.E2.m1.1.1.1.1.1.1.1.cmml">|</mo><msup id="S3.E2.m1.1.1.1.1.1.1.3" xref="S3.E2.m1.1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.1.1.1.1.1.1.3.2" xref="S3.E2.m1.1.1.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.E2.m1.1.1.1.1.1.1.3.3" mathvariant="normal" xref="S3.E2.m1.1.1.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.E2.m1.1.1.1.1.1.3" stretchy="false" xref="S3.E2.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></munder><mrow id="S3.E2.m1.10.10.1.1.2.1.1.1.1" xref="S3.E2.m1.10.10.1.1.2.1.1.1.2.cmml"><mo id="S3.E2.m1.10.10.1.1.2.1.1.1.1.2" stretchy="false" xref="S3.E2.m1.10.10.1.1.2.1.1.1.2.1.cmml">[</mo><mrow id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.2" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.2.cmml">ℒ</mi><mo id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.1" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.1.cmml">⁢</mo><mrow id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.2" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.1.cmml"><mo id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.2.1" stretchy="false" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.1.cmml">(</mo><mi id="S3.E2.m1.4.4" xref="S3.E2.m1.4.4.cmml">c</mi><mo id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.2.2" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.1.cmml">;</mo><mi id="S3.E2.m1.5.5" xref="S3.E2.m1.5.5.cmml">θ</mi><mo id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.2.3" stretchy="false" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.1.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.10.10.1.1.2.1.1.1.1.3" stretchy="false" xref="S3.E2.m1.10.10.1.1.2.1.1.1.2.1.cmml">]</mo></mrow></mrow><mspace id="S3.E2.m1.10.10.1.1.2.1.2" width="1em" xref="S3.E2.m1.10.10.1.1.2.2.cmml"></mspace><mtext id="S3.E2.m1.9.9" xref="S3.E2.m1.9.9a.cmml">and</mtext></mrow></mrow><mspace id="S3.E2.m1.11.11.2.3" width="1em" xref="S3.E2.m1.11.11.3a.cmml"></mspace><mrow id="S3.E2.m1.11.11.2.2" xref="S3.E2.m1.11.11.2.2.cmml"><mrow id="S3.E2.m1.11.11.2.2.1" xref="S3.E2.m1.11.11.2.2.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.11.11.2.2.1.3" xref="S3.E2.m1.11.11.2.2.1.3.cmml">ℒ</mi><mo id="S3.E2.m1.11.11.2.2.1.2" xref="S3.E2.m1.11.11.2.2.1.2.cmml">⁢</mo><mrow id="S3.E2.m1.11.11.2.2.1.1.1" xref="S3.E2.m1.11.11.2.2.1.1.2.cmml"><mo id="S3.E2.m1.11.11.2.2.1.1.1.2" stretchy="false" xref="S3.E2.m1.11.11.2.2.1.1.2.cmml">(</mo><msup id="S3.E2.m1.11.11.2.2.1.1.1.1" xref="S3.E2.m1.11.11.2.2.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.11.11.2.2.1.1.1.1.2" xref="S3.E2.m1.11.11.2.2.1.1.1.1.2.cmml">𝒟</mi><mi id="S3.E2.m1.11.11.2.2.1.1.1.1.3" mathvariant="normal" xref="S3.E2.m1.11.11.2.2.1.1.1.1.3.cmml">g</mi></msup><mo id="S3.E2.m1.11.11.2.2.1.1.1.3" xref="S3.E2.m1.11.11.2.2.1.1.2.cmml">;</mo><mi id="S3.E2.m1.6.6" xref="S3.E2.m1.6.6.cmml">θ</mi><mo id="S3.E2.m1.11.11.2.2.1.1.1.4" stretchy="false" xref="S3.E2.m1.11.11.2.2.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.11.11.2.2.3" rspace="0.1389em" xref="S3.E2.m1.11.11.2.2.3.cmml">=</mo><mrow id="S3.E2.m1.11.11.2.2.2" xref="S3.E2.m1.11.11.2.2.2.cmml"><munder id="S3.E2.m1.11.11.2.2.2.2" xref="S3.E2.m1.11.11.2.2.2.2.cmml"><mo id="S3.E2.m1.11.11.2.2.2.2.2" lspace="0.1389em" movablelimits="false" rspace="0em" xref="S3.E2.m1.11.11.2.2.2.2.2.cmml">𝔼</mo><mrow id="S3.E2.m1.2.2.1" xref="S3.E2.m1.2.2.1.cmml"><mi id="S3.E2.m1.2.2.1.3" xref="S3.E2.m1.2.2.1.3.cmml">c</mi><mo id="S3.E2.m1.2.2.1.2" xref="S3.E2.m1.2.2.1.2.cmml">∼</mo><mrow id="S3.E2.m1.2.2.1.1.1" xref="S3.E2.m1.2.2.1.1.1.1.cmml"><mo id="S3.E2.m1.2.2.1.1.1.2" stretchy="false" xref="S3.E2.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="S3.E2.m1.2.2.1.1.1.1" xref="S3.E2.m1.2.2.1.1.1.1.cmml"><mi id="S3.E2.m1.2.2.1.1.1.1.2" xref="S3.E2.m1.2.2.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.E2.m1.2.2.1.1.1.1.1" xref="S3.E2.m1.2.2.1.1.1.1.1.cmml">|</mo><msup id="S3.E2.m1.2.2.1.1.1.1.3" xref="S3.E2.m1.2.2.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.2.2.1.1.1.1.3.2" xref="S3.E2.m1.2.2.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.E2.m1.2.2.1.1.1.1.3.3" mathvariant="normal" xref="S3.E2.m1.2.2.1.1.1.1.3.3.cmml">g</mi></msup></mrow><mo id="S3.E2.m1.2.2.1.1.1.3" stretchy="false" xref="S3.E2.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></munder><mrow id="S3.E2.m1.11.11.2.2.2.1.1" xref="S3.E2.m1.11.11.2.2.2.1.2.cmml"><mo id="S3.E2.m1.11.11.2.2.2.1.1.2" stretchy="false" xref="S3.E2.m1.11.11.2.2.2.1.2.1.cmml">[</mo><mrow id="S3.E2.m1.11.11.2.2.2.1.1.1" xref="S3.E2.m1.11.11.2.2.2.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.E2.m1.11.11.2.2.2.1.1.1.2" xref="S3.E2.m1.11.11.2.2.2.1.1.1.2.cmml">ℒ</mi><mo id="S3.E2.m1.11.11.2.2.2.1.1.1.1" xref="S3.E2.m1.11.11.2.2.2.1.1.1.1.cmml">⁢</mo><mrow id="S3.E2.m1.11.11.2.2.2.1.1.1.3.2" xref="S3.E2.m1.11.11.2.2.2.1.1.1.3.1.cmml"><mo id="S3.E2.m1.11.11.2.2.2.1.1.1.3.2.1" stretchy="false" xref="S3.E2.m1.11.11.2.2.2.1.1.1.3.1.cmml">(</mo><mi id="S3.E2.m1.7.7" xref="S3.E2.m1.7.7.cmml">c</mi><mo id="S3.E2.m1.11.11.2.2.2.1.1.1.3.2.2" xref="S3.E2.m1.11.11.2.2.2.1.1.1.3.1.cmml">;</mo><mi id="S3.E2.m1.8.8" xref="S3.E2.m1.8.8.cmml">θ</mi><mo id="S3.E2.m1.11.11.2.2.2.1.1.1.3.2.3" stretchy="false" xref="S3.E2.m1.11.11.2.2.2.1.1.1.3.1.cmml">)</mo></mrow></mrow><mo id="S3.E2.m1.11.11.2.2.2.1.1.3" stretchy="false" xref="S3.E2.m1.11.11.2.2.2.1.2.1.cmml">]</mo></mrow></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.E2.m1.11b"><apply id="S3.E2.m1.11.11.3.cmml" xref="S3.E2.m1.11.11.2"><csymbol cd="ambiguous" id="S3.E2.m1.11.11.3a.cmml" xref="S3.E2.m1.11.11.2.3">formulae-sequence</csymbol><apply id="S3.E2.m1.10.10.1.1.cmml" xref="S3.E2.m1.10.10.1.1"><eq id="S3.E2.m1.10.10.1.1.3.cmml" xref="S3.E2.m1.10.10.1.1.3"></eq><apply id="S3.E2.m1.10.10.1.1.1.cmml" xref="S3.E2.m1.10.10.1.1.1"><times id="S3.E2.m1.10.10.1.1.1.2.cmml" xref="S3.E2.m1.10.10.1.1.1.2"></times><ci id="S3.E2.m1.10.10.1.1.1.3.cmml" xref="S3.E2.m1.10.10.1.1.1.3">ℒ</ci><list id="S3.E2.m1.10.10.1.1.1.1.2.cmml" xref="S3.E2.m1.10.10.1.1.1.1.1"><apply id="S3.E2.m1.10.10.1.1.1.1.1.1.cmml" xref="S3.E2.m1.10.10.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.10.10.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.10.10.1.1.1.1.1.1">superscript</csymbol><ci id="S3.E2.m1.10.10.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.10.10.1.1.1.1.1.1.2">𝒟</ci><ci id="S3.E2.m1.10.10.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.10.10.1.1.1.1.1.1.3">s</ci></apply><ci id="S3.E2.m1.3.3.cmml" xref="S3.E2.m1.3.3">𝜃</ci></list></apply><list id="S3.E2.m1.10.10.1.1.2.2.cmml" xref="S3.E2.m1.10.10.1.1.2.1"><apply id="S3.E2.m1.10.10.1.1.2.1.1.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1"><apply id="S3.E2.m1.10.10.1.1.2.1.1.2.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.2"><csymbol cd="ambiguous" id="S3.E2.m1.10.10.1.1.2.1.1.2.1.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.2">subscript</csymbol><ci id="S3.E2.m1.10.10.1.1.2.1.1.2.2.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.2.2">𝔼</ci><apply id="S3.E2.m1.1.1.1.cmml" xref="S3.E2.m1.1.1.1"><csymbol cd="latexml" id="S3.E2.m1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.2">similar-to</csymbol><ci id="S3.E2.m1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.3">𝑐</ci><apply id="S3.E2.m1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1"><csymbol cd="latexml" id="S3.E2.m1.1.1.1.1.1.1.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S3.E2.m1.1.1.1.1.1.1.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.2">𝑐</ci><apply id="S3.E2.m1.1.1.1.1.1.1.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.1.1.1.1.1.1.3.1.cmml" xref="S3.E2.m1.1.1.1.1.1.1.3">superscript</csymbol><ci id="S3.E2.m1.1.1.1.1.1.1.3.2.cmml" xref="S3.E2.m1.1.1.1.1.1.1.3.2">𝒟</ci><ci id="S3.E2.m1.1.1.1.1.1.1.3.3.cmml" xref="S3.E2.m1.1.1.1.1.1.1.3.3">s</ci></apply></apply></apply></apply><apply id="S3.E2.m1.10.10.1.1.2.1.1.1.2.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1"><csymbol cd="latexml" id="S3.E2.m1.10.10.1.1.2.1.1.1.2.1.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.2">delimited-[]</csymbol><apply id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1"><times id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.1.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.1"></times><ci id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.2.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.2">ℒ</ci><list id="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.1.cmml" xref="S3.E2.m1.10.10.1.1.2.1.1.1.1.1.3.2"><ci id="S3.E2.m1.4.4.cmml" xref="S3.E2.m1.4.4">𝑐</ci><ci id="S3.E2.m1.5.5.cmml" xref="S3.E2.m1.5.5">𝜃</ci></list></apply></apply></apply><ci id="S3.E2.m1.9.9a.cmml" xref="S3.E2.m1.9.9"><mtext id="S3.E2.m1.9.9.cmml" xref="S3.E2.m1.9.9">and</mtext></ci></list></apply><apply id="S3.E2.m1.11.11.2.2.cmml" xref="S3.E2.m1.11.11.2.2"><eq id="S3.E2.m1.11.11.2.2.3.cmml" xref="S3.E2.m1.11.11.2.2.3"></eq><apply id="S3.E2.m1.11.11.2.2.1.cmml" xref="S3.E2.m1.11.11.2.2.1"><times id="S3.E2.m1.11.11.2.2.1.2.cmml" xref="S3.E2.m1.11.11.2.2.1.2"></times><ci id="S3.E2.m1.11.11.2.2.1.3.cmml" xref="S3.E2.m1.11.11.2.2.1.3">ℒ</ci><list id="S3.E2.m1.11.11.2.2.1.1.2.cmml" xref="S3.E2.m1.11.11.2.2.1.1.1"><apply id="S3.E2.m1.11.11.2.2.1.1.1.1.cmml" xref="S3.E2.m1.11.11.2.2.1.1.1.1"><csymbol cd="ambiguous" id="S3.E2.m1.11.11.2.2.1.1.1.1.1.cmml" xref="S3.E2.m1.11.11.2.2.1.1.1.1">superscript</csymbol><ci id="S3.E2.m1.11.11.2.2.1.1.1.1.2.cmml" xref="S3.E2.m1.11.11.2.2.1.1.1.1.2">𝒟</ci><ci id="S3.E2.m1.11.11.2.2.1.1.1.1.3.cmml" xref="S3.E2.m1.11.11.2.2.1.1.1.1.3">g</ci></apply><ci id="S3.E2.m1.6.6.cmml" xref="S3.E2.m1.6.6">𝜃</ci></list></apply><apply id="S3.E2.m1.11.11.2.2.2.cmml" xref="S3.E2.m1.11.11.2.2.2"><apply id="S3.E2.m1.11.11.2.2.2.2.cmml" xref="S3.E2.m1.11.11.2.2.2.2"><csymbol cd="ambiguous" id="S3.E2.m1.11.11.2.2.2.2.1.cmml" xref="S3.E2.m1.11.11.2.2.2.2">subscript</csymbol><ci id="S3.E2.m1.11.11.2.2.2.2.2.cmml" xref="S3.E2.m1.11.11.2.2.2.2.2">𝔼</ci><apply id="S3.E2.m1.2.2.1.cmml" xref="S3.E2.m1.2.2.1"><csymbol cd="latexml" id="S3.E2.m1.2.2.1.2.cmml" xref="S3.E2.m1.2.2.1.2">similar-to</csymbol><ci id="S3.E2.m1.2.2.1.3.cmml" xref="S3.E2.m1.2.2.1.3">𝑐</ci><apply id="S3.E2.m1.2.2.1.1.1.1.cmml" xref="S3.E2.m1.2.2.1.1.1"><csymbol cd="latexml" id="S3.E2.m1.2.2.1.1.1.1.1.cmml" xref="S3.E2.m1.2.2.1.1.1.1.1">conditional</csymbol><ci id="S3.E2.m1.2.2.1.1.1.1.2.cmml" xref="S3.E2.m1.2.2.1.1.1.1.2">𝑐</ci><apply id="S3.E2.m1.2.2.1.1.1.1.3.cmml" xref="S3.E2.m1.2.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.E2.m1.2.2.1.1.1.1.3.1.cmml" xref="S3.E2.m1.2.2.1.1.1.1.3">superscript</csymbol><ci id="S3.E2.m1.2.2.1.1.1.1.3.2.cmml" xref="S3.E2.m1.2.2.1.1.1.1.3.2">𝒟</ci><ci id="S3.E2.m1.2.2.1.1.1.1.3.3.cmml" xref="S3.E2.m1.2.2.1.1.1.1.3.3">g</ci></apply></apply></apply></apply><apply id="S3.E2.m1.11.11.2.2.2.1.2.cmml" xref="S3.E2.m1.11.11.2.2.2.1.1"><csymbol cd="latexml" id="S3.E2.m1.11.11.2.2.2.1.2.1.cmml" xref="S3.E2.m1.11.11.2.2.2.1.1.2">delimited-[]</csymbol><apply id="S3.E2.m1.11.11.2.2.2.1.1.1.cmml" xref="S3.E2.m1.11.11.2.2.2.1.1.1"><times id="S3.E2.m1.11.11.2.2.2.1.1.1.1.cmml" xref="S3.E2.m1.11.11.2.2.2.1.1.1.1"></times><ci id="S3.E2.m1.11.11.2.2.2.1.1.1.2.cmml" xref="S3.E2.m1.11.11.2.2.2.1.1.1.2">ℒ</ci><list id="S3.E2.m1.11.11.2.2.2.1.1.1.3.1.cmml" xref="S3.E2.m1.11.11.2.2.2.1.1.1.3.2"><ci id="S3.E2.m1.7.7.cmml" xref="S3.E2.m1.7.7">𝑐</ci><ci id="S3.E2.m1.8.8.cmml" xref="S3.E2.m1.8.8">𝜃</ci></list></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.E2.m1.11c">{\cal L}({\cal D}^{\rm s};\theta)=\mathop{\mathbb{E}}_{c\sim(c|{\cal D}^{\rm s%
})}[{\cal L}(c;\theta)]\quad\text{and}\quad{\cal L}({\cal D}^{\rm g};\theta)=%
\mathop{\mathbb{E}}_{c\sim(c|{\cal D}^{\rm g})}[{\cal L}(c;\theta)]</annotation><annotation encoding="application/x-llamapun" id="S3.E2.m1.11d">caligraphic_L ( caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ; italic_θ ) = blackboard_E start_POSTSUBSCRIPT italic_c ∼ ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) end_POSTSUBSCRIPT [ caligraphic_L ( italic_c ; italic_θ ) ] and caligraphic_L ( caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ; italic_θ ) = blackboard_E start_POSTSUBSCRIPT italic_c ∼ ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ) end_POSTSUBSCRIPT [ caligraphic_L ( italic_c ; italic_θ ) ]</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(2)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S3.SS4.p2.7">where we define <math alttext="{\cal L}(c;\theta)=:\sum_{x}\ell(x;\theta)P(x|c)" class="ltx_math_unparsed" display="inline" id="S3.SS4.p2.6.m1.2"><semantics id="S3.SS4.p2.6.m1.2a"><mrow id="S3.SS4.p2.6.m1.2b"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p2.6.m1.2.3">ℒ</mi><mrow id="S3.SS4.p2.6.m1.2.4"><mo id="S3.SS4.p2.6.m1.2.4.1" stretchy="false">(</mo><mi id="S3.SS4.p2.6.m1.1.1">c</mi><mo id="S3.SS4.p2.6.m1.2.4.2">;</mo><mi id="S3.SS4.p2.6.m1.2.2">θ</mi><mo id="S3.SS4.p2.6.m1.2.4.3" stretchy="false">)</mo></mrow><mo id="S3.SS4.p2.6.m1.2.5" rspace="0em">=</mo><mo id="S3.SS4.p2.6.m1.2.6" rspace="0.111em">:</mo><msub id="S3.SS4.p2.6.m1.2.7"><mo id="S3.SS4.p2.6.m1.2.7.2">∑</mo><mi id="S3.SS4.p2.6.m1.2.7.3">x</mi></msub><mi id="S3.SS4.p2.6.m1.2.8" mathvariant="normal">ℓ</mi><mrow id="S3.SS4.p2.6.m1.2.9"><mo id="S3.SS4.p2.6.m1.2.9.1" stretchy="false">(</mo><mi id="S3.SS4.p2.6.m1.2.9.2">x</mi><mo id="S3.SS4.p2.6.m1.2.9.3">;</mo><mi id="S3.SS4.p2.6.m1.2.9.4">θ</mi><mo id="S3.SS4.p2.6.m1.2.9.5" stretchy="false">)</mo></mrow><mi id="S3.SS4.p2.6.m1.2.10">P</mi><mrow id="S3.SS4.p2.6.m1.2.11"><mo id="S3.SS4.p2.6.m1.2.11.1" stretchy="false">(</mo><mi id="S3.SS4.p2.6.m1.2.11.2">x</mi><mo fence="false" id="S3.SS4.p2.6.m1.2.11.3" rspace="0.167em" stretchy="false">|</mo><mi id="S3.SS4.p2.6.m1.2.11.4">c</mi><mo id="S3.SS4.p2.6.m1.2.11.5" stretchy="false">)</mo></mrow></mrow><annotation encoding="application/x-tex" id="S3.SS4.p2.6.m1.2c">{\cal L}(c;\theta)=:\sum_{x}\ell(x;\theta)P(x|c)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.6.m1.2d">caligraphic_L ( italic_c ; italic_θ ) = : ∑ start_POSTSUBSCRIPT italic_x end_POSTSUBSCRIPT roman_ℓ ( italic_x ; italic_θ ) italic_P ( italic_x | italic_c )</annotation></semantics></math>.
We now apply importance sampling to these expectation, defining the importance weights as <math alttext="w(c)=P(c|{\cal D}^{\rm s})/P(c|{\cal D}^{\rm g})" class="ltx_Math" display="inline" id="S3.SS4.p2.7.m2.3"><semantics id="S3.SS4.p2.7.m2.3a"><mrow id="S3.SS4.p2.7.m2.3.3" xref="S3.SS4.p2.7.m2.3.3.cmml"><mrow id="S3.SS4.p2.7.m2.3.3.4" xref="S3.SS4.p2.7.m2.3.3.4.cmml"><mi id="S3.SS4.p2.7.m2.3.3.4.2" xref="S3.SS4.p2.7.m2.3.3.4.2.cmml">w</mi><mo id="S3.SS4.p2.7.m2.3.3.4.1" xref="S3.SS4.p2.7.m2.3.3.4.1.cmml">⁢</mo><mrow id="S3.SS4.p2.7.m2.3.3.4.3.2" xref="S3.SS4.p2.7.m2.3.3.4.cmml"><mo id="S3.SS4.p2.7.m2.3.3.4.3.2.1" stretchy="false" xref="S3.SS4.p2.7.m2.3.3.4.cmml">(</mo><mi id="S3.SS4.p2.7.m2.1.1" xref="S3.SS4.p2.7.m2.1.1.cmml">c</mi><mo id="S3.SS4.p2.7.m2.3.3.4.3.2.2" stretchy="false" xref="S3.SS4.p2.7.m2.3.3.4.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p2.7.m2.3.3.3" xref="S3.SS4.p2.7.m2.3.3.3.cmml">=</mo><mrow id="S3.SS4.p2.7.m2.3.3.2" xref="S3.SS4.p2.7.m2.3.3.2.cmml"><mrow id="S3.SS4.p2.7.m2.2.2.1.1" xref="S3.SS4.p2.7.m2.2.2.1.1.cmml"><mrow id="S3.SS4.p2.7.m2.2.2.1.1.1" xref="S3.SS4.p2.7.m2.2.2.1.1.1.cmml"><mi id="S3.SS4.p2.7.m2.2.2.1.1.1.3" xref="S3.SS4.p2.7.m2.2.2.1.1.1.3.cmml">P</mi><mo id="S3.SS4.p2.7.m2.2.2.1.1.1.2" xref="S3.SS4.p2.7.m2.2.2.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.cmml"><mo id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.2" stretchy="false" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.cmml"><mi id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.2" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.1" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.1.cmml">|</mo><msup id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.2" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.3" mathvariant="normal" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.3" stretchy="false" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p2.7.m2.2.2.1.1.2" xref="S3.SS4.p2.7.m2.2.2.1.1.2.cmml">/</mo><mi id="S3.SS4.p2.7.m2.2.2.1.1.3" xref="S3.SS4.p2.7.m2.2.2.1.1.3.cmml">P</mi></mrow><mo id="S3.SS4.p2.7.m2.3.3.2.3" xref="S3.SS4.p2.7.m2.3.3.2.3.cmml">⁢</mo><mrow id="S3.SS4.p2.7.m2.3.3.2.2.1" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.cmml"><mo id="S3.SS4.p2.7.m2.3.3.2.2.1.2" stretchy="false" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.cmml">(</mo><mrow id="S3.SS4.p2.7.m2.3.3.2.2.1.1" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.cmml"><mi id="S3.SS4.p2.7.m2.3.3.2.2.1.1.2" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.2.cmml">c</mi><mo fence="false" id="S3.SS4.p2.7.m2.3.3.2.2.1.1.1" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.1.cmml">|</mo><msup id="S3.SS4.p2.7.m2.3.3.2.2.1.1.3" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.2" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.2.cmml">𝒟</mi><mi id="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.3" mathvariant="normal" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.3.cmml">g</mi></msup></mrow><mo id="S3.SS4.p2.7.m2.3.3.2.2.1.3" stretchy="false" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p2.7.m2.3b"><apply id="S3.SS4.p2.7.m2.3.3.cmml" xref="S3.SS4.p2.7.m2.3.3"><eq id="S3.SS4.p2.7.m2.3.3.3.cmml" xref="S3.SS4.p2.7.m2.3.3.3"></eq><apply id="S3.SS4.p2.7.m2.3.3.4.cmml" xref="S3.SS4.p2.7.m2.3.3.4"><times id="S3.SS4.p2.7.m2.3.3.4.1.cmml" xref="S3.SS4.p2.7.m2.3.3.4.1"></times><ci id="S3.SS4.p2.7.m2.3.3.4.2.cmml" xref="S3.SS4.p2.7.m2.3.3.4.2">𝑤</ci><ci id="S3.SS4.p2.7.m2.1.1.cmml" xref="S3.SS4.p2.7.m2.1.1">𝑐</ci></apply><apply id="S3.SS4.p2.7.m2.3.3.2.cmml" xref="S3.SS4.p2.7.m2.3.3.2"><times id="S3.SS4.p2.7.m2.3.3.2.3.cmml" xref="S3.SS4.p2.7.m2.3.3.2.3"></times><apply id="S3.SS4.p2.7.m2.2.2.1.1.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1"><divide id="S3.SS4.p2.7.m2.2.2.1.1.2.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.2"></divide><apply id="S3.SS4.p2.7.m2.2.2.1.1.1.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1"><times id="S3.SS4.p2.7.m2.2.2.1.1.1.2.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.2"></times><ci id="S3.SS4.p2.7.m2.2.2.1.1.1.3.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.3">𝑃</ci><apply id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1"><csymbol cd="latexml" id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.1">conditional</csymbol><ci id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.2.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.2">𝑐</ci><apply id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.1.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3">superscript</csymbol><ci id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.2.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.2">𝒟</ci><ci id="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.3.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.1.1.1.1.3.3">s</ci></apply></apply></apply><ci id="S3.SS4.p2.7.m2.2.2.1.1.3.cmml" xref="S3.SS4.p2.7.m2.2.2.1.1.3">𝑃</ci></apply><apply id="S3.SS4.p2.7.m2.3.3.2.2.1.1.cmml" xref="S3.SS4.p2.7.m2.3.3.2.2.1"><csymbol cd="latexml" id="S3.SS4.p2.7.m2.3.3.2.2.1.1.1.cmml" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.1">conditional</csymbol><ci id="S3.SS4.p2.7.m2.3.3.2.2.1.1.2.cmml" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.2">𝑐</ci><apply id="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.cmml" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.1.cmml" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.3">superscript</csymbol><ci id="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.2.cmml" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.2">𝒟</ci><ci id="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.3.cmml" xref="S3.SS4.p2.7.m2.3.3.2.2.1.1.3.3">g</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p2.7.m2.3c">w(c)=P(c|{\cal D}^{\rm s})/P(c|{\cal D}^{\rm g})</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p2.7.m2.3d">italic_w ( italic_c ) = italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) / italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT )</annotation></semantics></math>,</p>
<table class="ltx_equation ltx_eqn_table" id="S3.Ex5">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="{\cal L}({\cal D}^{\rm s};\theta)=\sum_{c}{\cal L}(c;\theta)P(c|{\cal D}^{\rm s%
})=\sum_{c}{\cal L}(c;\theta)\frac{P(c|{\cal D}^{\rm s})}{P(c|{\cal D}^{\rm g}%
)}P(c|{\cal D}^{\rm g})=\mathop{\mathbb{E}}_{c\sim(c|{\cal D}^{\rm s})}[w(c){%
\cal L}(c;\theta)]." class="ltx_Math" display="block" id="S3.Ex5.m1.12"><semantics id="S3.Ex5.m1.12a"><mrow id="S3.Ex5.m1.12.12.1" xref="S3.Ex5.m1.12.12.1.1.cmml"><mrow id="S3.Ex5.m1.12.12.1.1" xref="S3.Ex5.m1.12.12.1.1.cmml"><mrow id="S3.Ex5.m1.12.12.1.1.1" xref="S3.Ex5.m1.12.12.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.12.12.1.1.1.3" xref="S3.Ex5.m1.12.12.1.1.1.3.cmml">ℒ</mi><mo id="S3.Ex5.m1.12.12.1.1.1.2" xref="S3.Ex5.m1.12.12.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex5.m1.12.12.1.1.1.1.1" xref="S3.Ex5.m1.12.12.1.1.1.1.2.cmml"><mo id="S3.Ex5.m1.12.12.1.1.1.1.1.2" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.1.1.2.cmml">(</mo><msup id="S3.Ex5.m1.12.12.1.1.1.1.1.1" xref="S3.Ex5.m1.12.12.1.1.1.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.12.12.1.1.1.1.1.1.2" xref="S3.Ex5.m1.12.12.1.1.1.1.1.1.2.cmml">𝒟</mi><mi id="S3.Ex5.m1.12.12.1.1.1.1.1.1.3" mathvariant="normal" xref="S3.Ex5.m1.12.12.1.1.1.1.1.1.3.cmml">s</mi></msup><mo id="S3.Ex5.m1.12.12.1.1.1.1.1.3" xref="S3.Ex5.m1.12.12.1.1.1.1.2.cmml">;</mo><mi id="S3.Ex5.m1.4.4" xref="S3.Ex5.m1.4.4.cmml">θ</mi><mo id="S3.Ex5.m1.12.12.1.1.1.1.1.4" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S3.Ex5.m1.12.12.1.1.6" rspace="0.111em" xref="S3.Ex5.m1.12.12.1.1.6.cmml">=</mo><mrow id="S3.Ex5.m1.12.12.1.1.2" xref="S3.Ex5.m1.12.12.1.1.2.cmml"><munder id="S3.Ex5.m1.12.12.1.1.2.2" xref="S3.Ex5.m1.12.12.1.1.2.2.cmml"><mo id="S3.Ex5.m1.12.12.1.1.2.2.2" movablelimits="false" xref="S3.Ex5.m1.12.12.1.1.2.2.2.cmml">∑</mo><mi id="S3.Ex5.m1.12.12.1.1.2.2.3" xref="S3.Ex5.m1.12.12.1.1.2.2.3.cmml">c</mi></munder><mrow id="S3.Ex5.m1.12.12.1.1.2.1" xref="S3.Ex5.m1.12.12.1.1.2.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.12.12.1.1.2.1.3" xref="S3.Ex5.m1.12.12.1.1.2.1.3.cmml">ℒ</mi><mo id="S3.Ex5.m1.12.12.1.1.2.1.2" xref="S3.Ex5.m1.12.12.1.1.2.1.2.cmml">⁢</mo><mrow id="S3.Ex5.m1.12.12.1.1.2.1.4.2" xref="S3.Ex5.m1.12.12.1.1.2.1.4.1.cmml"><mo id="S3.Ex5.m1.12.12.1.1.2.1.4.2.1" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.2.1.4.1.cmml">(</mo><mi id="S3.Ex5.m1.5.5" xref="S3.Ex5.m1.5.5.cmml">c</mi><mo id="S3.Ex5.m1.12.12.1.1.2.1.4.2.2" xref="S3.Ex5.m1.12.12.1.1.2.1.4.1.cmml">;</mo><mi id="S3.Ex5.m1.6.6" xref="S3.Ex5.m1.6.6.cmml">θ</mi><mo id="S3.Ex5.m1.12.12.1.1.2.1.4.2.3" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.2.1.4.1.cmml">)</mo></mrow><mo id="S3.Ex5.m1.12.12.1.1.2.1.2a" xref="S3.Ex5.m1.12.12.1.1.2.1.2.cmml">⁢</mo><mi id="S3.Ex5.m1.12.12.1.1.2.1.5" xref="S3.Ex5.m1.12.12.1.1.2.1.5.cmml">P</mi><mo id="S3.Ex5.m1.12.12.1.1.2.1.2b" xref="S3.Ex5.m1.12.12.1.1.2.1.2.cmml">⁢</mo><mrow id="S3.Ex5.m1.12.12.1.1.2.1.1.1" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.cmml"><mo id="S3.Ex5.m1.12.12.1.1.2.1.1.1.2" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.cmml">(</mo><mrow id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.cmml"><mi id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.2" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.1" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.1.cmml">|</mo><msup id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.2" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.3" mathvariant="normal" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.Ex5.m1.12.12.1.1.2.1.1.1.3" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.Ex5.m1.12.12.1.1.7" rspace="0.111em" xref="S3.Ex5.m1.12.12.1.1.7.cmml">=</mo><mrow id="S3.Ex5.m1.12.12.1.1.3" xref="S3.Ex5.m1.12.12.1.1.3.cmml"><munder id="S3.Ex5.m1.12.12.1.1.3.2" xref="S3.Ex5.m1.12.12.1.1.3.2.cmml"><mo id="S3.Ex5.m1.12.12.1.1.3.2.2" movablelimits="false" xref="S3.Ex5.m1.12.12.1.1.3.2.2.cmml">∑</mo><mi id="S3.Ex5.m1.12.12.1.1.3.2.3" xref="S3.Ex5.m1.12.12.1.1.3.2.3.cmml">c</mi></munder><mrow id="S3.Ex5.m1.12.12.1.1.3.1" xref="S3.Ex5.m1.12.12.1.1.3.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.12.12.1.1.3.1.3" xref="S3.Ex5.m1.12.12.1.1.3.1.3.cmml">ℒ</mi><mo id="S3.Ex5.m1.12.12.1.1.3.1.2" xref="S3.Ex5.m1.12.12.1.1.3.1.2.cmml">⁢</mo><mrow id="S3.Ex5.m1.12.12.1.1.3.1.4.2" xref="S3.Ex5.m1.12.12.1.1.3.1.4.1.cmml"><mo id="S3.Ex5.m1.12.12.1.1.3.1.4.2.1" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.3.1.4.1.cmml">(</mo><mi id="S3.Ex5.m1.7.7" xref="S3.Ex5.m1.7.7.cmml">c</mi><mo id="S3.Ex5.m1.12.12.1.1.3.1.4.2.2" xref="S3.Ex5.m1.12.12.1.1.3.1.4.1.cmml">;</mo><mi id="S3.Ex5.m1.8.8" xref="S3.Ex5.m1.8.8.cmml">θ</mi><mo id="S3.Ex5.m1.12.12.1.1.3.1.4.2.3" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.3.1.4.1.cmml">)</mo></mrow><mo id="S3.Ex5.m1.12.12.1.1.3.1.2a" xref="S3.Ex5.m1.12.12.1.1.3.1.2.cmml">⁢</mo><mfrac id="S3.Ex5.m1.2.2" xref="S3.Ex5.m1.2.2.cmml"><mrow id="S3.Ex5.m1.1.1.1" xref="S3.Ex5.m1.1.1.1.cmml"><mi id="S3.Ex5.m1.1.1.1.3" xref="S3.Ex5.m1.1.1.1.3.cmml">P</mi><mo id="S3.Ex5.m1.1.1.1.2" xref="S3.Ex5.m1.1.1.1.2.cmml">⁢</mo><mrow id="S3.Ex5.m1.1.1.1.1.1" xref="S3.Ex5.m1.1.1.1.1.1.1.cmml"><mo id="S3.Ex5.m1.1.1.1.1.1.2" stretchy="false" xref="S3.Ex5.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.Ex5.m1.1.1.1.1.1.1" xref="S3.Ex5.m1.1.1.1.1.1.1.cmml"><mi id="S3.Ex5.m1.1.1.1.1.1.1.2" xref="S3.Ex5.m1.1.1.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.Ex5.m1.1.1.1.1.1.1.1" xref="S3.Ex5.m1.1.1.1.1.1.1.1.cmml">|</mo><msup id="S3.Ex5.m1.1.1.1.1.1.1.3" xref="S3.Ex5.m1.1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.1.1.1.1.1.1.3.2" xref="S3.Ex5.m1.1.1.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.Ex5.m1.1.1.1.1.1.1.3.3" mathvariant="normal" xref="S3.Ex5.m1.1.1.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.Ex5.m1.1.1.1.1.1.3" stretchy="false" xref="S3.Ex5.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mrow id="S3.Ex5.m1.2.2.2" xref="S3.Ex5.m1.2.2.2.cmml"><mi id="S3.Ex5.m1.2.2.2.3" xref="S3.Ex5.m1.2.2.2.3.cmml">P</mi><mo id="S3.Ex5.m1.2.2.2.2" xref="S3.Ex5.m1.2.2.2.2.cmml">⁢</mo><mrow id="S3.Ex5.m1.2.2.2.1.1" xref="S3.Ex5.m1.2.2.2.1.1.1.cmml"><mo id="S3.Ex5.m1.2.2.2.1.1.2" stretchy="false" xref="S3.Ex5.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="S3.Ex5.m1.2.2.2.1.1.1" xref="S3.Ex5.m1.2.2.2.1.1.1.cmml"><mi id="S3.Ex5.m1.2.2.2.1.1.1.2" xref="S3.Ex5.m1.2.2.2.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.Ex5.m1.2.2.2.1.1.1.1" xref="S3.Ex5.m1.2.2.2.1.1.1.1.cmml">|</mo><msup id="S3.Ex5.m1.2.2.2.1.1.1.3" xref="S3.Ex5.m1.2.2.2.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.2.2.2.1.1.1.3.2" xref="S3.Ex5.m1.2.2.2.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.Ex5.m1.2.2.2.1.1.1.3.3" mathvariant="normal" xref="S3.Ex5.m1.2.2.2.1.1.1.3.3.cmml">g</mi></msup></mrow><mo id="S3.Ex5.m1.2.2.2.1.1.3" stretchy="false" xref="S3.Ex5.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mfrac><mo id="S3.Ex5.m1.12.12.1.1.3.1.2b" xref="S3.Ex5.m1.12.12.1.1.3.1.2.cmml">⁢</mo><mi id="S3.Ex5.m1.12.12.1.1.3.1.5" xref="S3.Ex5.m1.12.12.1.1.3.1.5.cmml">P</mi><mo id="S3.Ex5.m1.12.12.1.1.3.1.2c" xref="S3.Ex5.m1.12.12.1.1.3.1.2.cmml">⁢</mo><mrow id="S3.Ex5.m1.12.12.1.1.3.1.1.1" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.cmml"><mo id="S3.Ex5.m1.12.12.1.1.3.1.1.1.2" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.cmml">(</mo><mrow id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.cmml"><mi id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.2" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.1" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.1.cmml">|</mo><msup id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.2" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.3" mathvariant="normal" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.3.cmml">g</mi></msup></mrow><mo id="S3.Ex5.m1.12.12.1.1.3.1.1.1.3" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><mo id="S3.Ex5.m1.12.12.1.1.8" rspace="0.1389em" xref="S3.Ex5.m1.12.12.1.1.8.cmml">=</mo><mrow id="S3.Ex5.m1.12.12.1.1.4" xref="S3.Ex5.m1.12.12.1.1.4.cmml"><munder id="S3.Ex5.m1.12.12.1.1.4.2" xref="S3.Ex5.m1.12.12.1.1.4.2.cmml"><mo id="S3.Ex5.m1.12.12.1.1.4.2.2" lspace="0.1389em" movablelimits="false" rspace="0em" xref="S3.Ex5.m1.12.12.1.1.4.2.2.cmml">𝔼</mo><mrow id="S3.Ex5.m1.3.3.1" xref="S3.Ex5.m1.3.3.1.cmml"><mi id="S3.Ex5.m1.3.3.1.3" xref="S3.Ex5.m1.3.3.1.3.cmml">c</mi><mo id="S3.Ex5.m1.3.3.1.2" xref="S3.Ex5.m1.3.3.1.2.cmml">∼</mo><mrow id="S3.Ex5.m1.3.3.1.1.1" xref="S3.Ex5.m1.3.3.1.1.1.1.cmml"><mo id="S3.Ex5.m1.3.3.1.1.1.2" stretchy="false" xref="S3.Ex5.m1.3.3.1.1.1.1.cmml">(</mo><mrow id="S3.Ex5.m1.3.3.1.1.1.1" xref="S3.Ex5.m1.3.3.1.1.1.1.cmml"><mi id="S3.Ex5.m1.3.3.1.1.1.1.2" xref="S3.Ex5.m1.3.3.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.Ex5.m1.3.3.1.1.1.1.1" xref="S3.Ex5.m1.3.3.1.1.1.1.1.cmml">|</mo><msup id="S3.Ex5.m1.3.3.1.1.1.1.3" xref="S3.Ex5.m1.3.3.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.3.3.1.1.1.1.3.2" xref="S3.Ex5.m1.3.3.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S3.Ex5.m1.3.3.1.1.1.1.3.3" mathvariant="normal" xref="S3.Ex5.m1.3.3.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.Ex5.m1.3.3.1.1.1.3" stretchy="false" xref="S3.Ex5.m1.3.3.1.1.1.1.cmml">)</mo></mrow></mrow></munder><mrow id="S3.Ex5.m1.12.12.1.1.4.1.1" xref="S3.Ex5.m1.12.12.1.1.4.1.2.cmml"><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.2" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.4.1.2.1.cmml">[</mo><mrow id="S3.Ex5.m1.12.12.1.1.4.1.1.1" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.cmml"><mi id="S3.Ex5.m1.12.12.1.1.4.1.1.1.2" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.2.cmml">w</mi><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.1.1" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.1.cmml">⁢</mo><mrow id="S3.Ex5.m1.12.12.1.1.4.1.1.1.3.2" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.cmml"><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.1.3.2.1" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.cmml">(</mo><mi id="S3.Ex5.m1.9.9" xref="S3.Ex5.m1.9.9.cmml">c</mi><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.1.3.2.2" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.cmml">)</mo></mrow><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.1.1a" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.1.cmml">⁢</mo><mi class="ltx_font_mathcaligraphic" id="S3.Ex5.m1.12.12.1.1.4.1.1.1.4" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.4.cmml">ℒ</mi><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.1.1b" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.1.cmml">⁢</mo><mrow id="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.2" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.1.cmml"><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.2.1" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.1.cmml">(</mo><mi id="S3.Ex5.m1.10.10" xref="S3.Ex5.m1.10.10.cmml">c</mi><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.2.2" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.1.cmml">;</mo><mi id="S3.Ex5.m1.11.11" xref="S3.Ex5.m1.11.11.cmml">θ</mi><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.2.3" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.1.cmml">)</mo></mrow></mrow><mo id="S3.Ex5.m1.12.12.1.1.4.1.1.3" stretchy="false" xref="S3.Ex5.m1.12.12.1.1.4.1.2.1.cmml">]</mo></mrow></mrow></mrow><mo id="S3.Ex5.m1.12.12.1.2" lspace="0em" xref="S3.Ex5.m1.12.12.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S3.Ex5.m1.12b"><apply id="S3.Ex5.m1.12.12.1.1.cmml" xref="S3.Ex5.m1.12.12.1"><and id="S3.Ex5.m1.12.12.1.1a.cmml" xref="S3.Ex5.m1.12.12.1"></and><apply id="S3.Ex5.m1.12.12.1.1b.cmml" xref="S3.Ex5.m1.12.12.1"><eq id="S3.Ex5.m1.12.12.1.1.6.cmml" xref="S3.Ex5.m1.12.12.1.1.6"></eq><apply id="S3.Ex5.m1.12.12.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.1"><times id="S3.Ex5.m1.12.12.1.1.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.1.2"></times><ci id="S3.Ex5.m1.12.12.1.1.1.3.cmml" xref="S3.Ex5.m1.12.12.1.1.1.3">ℒ</ci><list id="S3.Ex5.m1.12.12.1.1.1.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.1.1.1"><apply id="S3.Ex5.m1.12.12.1.1.1.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.1.1.1.1"><csymbol cd="ambiguous" id="S3.Ex5.m1.12.12.1.1.1.1.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.1.1.1.1">superscript</csymbol><ci id="S3.Ex5.m1.12.12.1.1.1.1.1.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.1.1.1.1.2">𝒟</ci><ci id="S3.Ex5.m1.12.12.1.1.1.1.1.1.3.cmml" xref="S3.Ex5.m1.12.12.1.1.1.1.1.1.3">s</ci></apply><ci id="S3.Ex5.m1.4.4.cmml" xref="S3.Ex5.m1.4.4">𝜃</ci></list></apply><apply id="S3.Ex5.m1.12.12.1.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.2"><apply id="S3.Ex5.m1.12.12.1.1.2.2.cmml" xref="S3.Ex5.m1.12.12.1.1.2.2"><csymbol cd="ambiguous" id="S3.Ex5.m1.12.12.1.1.2.2.1.cmml" xref="S3.Ex5.m1.12.12.1.1.2.2">subscript</csymbol><sum id="S3.Ex5.m1.12.12.1.1.2.2.2.cmml" xref="S3.Ex5.m1.12.12.1.1.2.2.2"></sum><ci id="S3.Ex5.m1.12.12.1.1.2.2.3.cmml" xref="S3.Ex5.m1.12.12.1.1.2.2.3">𝑐</ci></apply><apply id="S3.Ex5.m1.12.12.1.1.2.1.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1"><times id="S3.Ex5.m1.12.12.1.1.2.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.2"></times><ci id="S3.Ex5.m1.12.12.1.1.2.1.3.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.3">ℒ</ci><list id="S3.Ex5.m1.12.12.1.1.2.1.4.1.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.4.2"><ci id="S3.Ex5.m1.5.5.cmml" xref="S3.Ex5.m1.5.5">𝑐</ci><ci id="S3.Ex5.m1.6.6.cmml" xref="S3.Ex5.m1.6.6">𝜃</ci></list><ci id="S3.Ex5.m1.12.12.1.1.2.1.5.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.5">𝑃</ci><apply id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1"><csymbol cd="latexml" id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.1">conditional</csymbol><ci id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.2">𝑐</ci><apply id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.1.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3">superscript</csymbol><ci id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.2.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.2">𝒟</ci><ci id="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.3.cmml" xref="S3.Ex5.m1.12.12.1.1.2.1.1.1.1.3.3">s</ci></apply></apply></apply></apply></apply><apply id="S3.Ex5.m1.12.12.1.1c.cmml" xref="S3.Ex5.m1.12.12.1"><eq id="S3.Ex5.m1.12.12.1.1.7.cmml" xref="S3.Ex5.m1.12.12.1.1.7"></eq><share href="https://arxiv.org/html/2410.03735v1#S3.Ex5.m1.12.12.1.1.2.cmml" id="S3.Ex5.m1.12.12.1.1d.cmml" xref="S3.Ex5.m1.12.12.1"></share><apply id="S3.Ex5.m1.12.12.1.1.3.cmml" xref="S3.Ex5.m1.12.12.1.1.3"><apply id="S3.Ex5.m1.12.12.1.1.3.2.cmml" xref="S3.Ex5.m1.12.12.1.1.3.2"><csymbol cd="ambiguous" id="S3.Ex5.m1.12.12.1.1.3.2.1.cmml" xref="S3.Ex5.m1.12.12.1.1.3.2">subscript</csymbol><sum id="S3.Ex5.m1.12.12.1.1.3.2.2.cmml" xref="S3.Ex5.m1.12.12.1.1.3.2.2"></sum><ci id="S3.Ex5.m1.12.12.1.1.3.2.3.cmml" xref="S3.Ex5.m1.12.12.1.1.3.2.3">𝑐</ci></apply><apply id="S3.Ex5.m1.12.12.1.1.3.1.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1"><times id="S3.Ex5.m1.12.12.1.1.3.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.2"></times><ci id="S3.Ex5.m1.12.12.1.1.3.1.3.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.3">ℒ</ci><list id="S3.Ex5.m1.12.12.1.1.3.1.4.1.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.4.2"><ci id="S3.Ex5.m1.7.7.cmml" xref="S3.Ex5.m1.7.7">𝑐</ci><ci id="S3.Ex5.m1.8.8.cmml" xref="S3.Ex5.m1.8.8">𝜃</ci></list><apply id="S3.Ex5.m1.2.2.cmml" xref="S3.Ex5.m1.2.2"><divide id="S3.Ex5.m1.2.2.3.cmml" xref="S3.Ex5.m1.2.2"></divide><apply id="S3.Ex5.m1.1.1.1.cmml" xref="S3.Ex5.m1.1.1.1"><times id="S3.Ex5.m1.1.1.1.2.cmml" xref="S3.Ex5.m1.1.1.1.2"></times><ci id="S3.Ex5.m1.1.1.1.3.cmml" xref="S3.Ex5.m1.1.1.1.3">𝑃</ci><apply id="S3.Ex5.m1.1.1.1.1.1.1.cmml" xref="S3.Ex5.m1.1.1.1.1.1"><csymbol cd="latexml" id="S3.Ex5.m1.1.1.1.1.1.1.1.cmml" xref="S3.Ex5.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S3.Ex5.m1.1.1.1.1.1.1.2.cmml" xref="S3.Ex5.m1.1.1.1.1.1.1.2">𝑐</ci><apply id="S3.Ex5.m1.1.1.1.1.1.1.3.cmml" xref="S3.Ex5.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex5.m1.1.1.1.1.1.1.3.1.cmml" xref="S3.Ex5.m1.1.1.1.1.1.1.3">superscript</csymbol><ci id="S3.Ex5.m1.1.1.1.1.1.1.3.2.cmml" xref="S3.Ex5.m1.1.1.1.1.1.1.3.2">𝒟</ci><ci id="S3.Ex5.m1.1.1.1.1.1.1.3.3.cmml" xref="S3.Ex5.m1.1.1.1.1.1.1.3.3">s</ci></apply></apply></apply><apply id="S3.Ex5.m1.2.2.2.cmml" xref="S3.Ex5.m1.2.2.2"><times id="S3.Ex5.m1.2.2.2.2.cmml" xref="S3.Ex5.m1.2.2.2.2"></times><ci id="S3.Ex5.m1.2.2.2.3.cmml" xref="S3.Ex5.m1.2.2.2.3">𝑃</ci><apply id="S3.Ex5.m1.2.2.2.1.1.1.cmml" xref="S3.Ex5.m1.2.2.2.1.1"><csymbol cd="latexml" id="S3.Ex5.m1.2.2.2.1.1.1.1.cmml" xref="S3.Ex5.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="S3.Ex5.m1.2.2.2.1.1.1.2.cmml" xref="S3.Ex5.m1.2.2.2.1.1.1.2">𝑐</ci><apply id="S3.Ex5.m1.2.2.2.1.1.1.3.cmml" xref="S3.Ex5.m1.2.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex5.m1.2.2.2.1.1.1.3.1.cmml" xref="S3.Ex5.m1.2.2.2.1.1.1.3">superscript</csymbol><ci id="S3.Ex5.m1.2.2.2.1.1.1.3.2.cmml" xref="S3.Ex5.m1.2.2.2.1.1.1.3.2">𝒟</ci><ci id="S3.Ex5.m1.2.2.2.1.1.1.3.3.cmml" xref="S3.Ex5.m1.2.2.2.1.1.1.3.3">g</ci></apply></apply></apply></apply><ci id="S3.Ex5.m1.12.12.1.1.3.1.5.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.5">𝑃</ci><apply id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1"><csymbol cd="latexml" id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.1">conditional</csymbol><ci id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.2">𝑐</ci><apply id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.1.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3">superscript</csymbol><ci id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.2.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.2">𝒟</ci><ci id="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.3.cmml" xref="S3.Ex5.m1.12.12.1.1.3.1.1.1.1.3.3">g</ci></apply></apply></apply></apply></apply><apply id="S3.Ex5.m1.12.12.1.1e.cmml" xref="S3.Ex5.m1.12.12.1"><eq id="S3.Ex5.m1.12.12.1.1.8.cmml" xref="S3.Ex5.m1.12.12.1.1.8"></eq><share href="https://arxiv.org/html/2410.03735v1#S3.Ex5.m1.12.12.1.1.3.cmml" id="S3.Ex5.m1.12.12.1.1f.cmml" xref="S3.Ex5.m1.12.12.1"></share><apply id="S3.Ex5.m1.12.12.1.1.4.cmml" xref="S3.Ex5.m1.12.12.1.1.4"><apply id="S3.Ex5.m1.12.12.1.1.4.2.cmml" xref="S3.Ex5.m1.12.12.1.1.4.2"><csymbol cd="ambiguous" id="S3.Ex5.m1.12.12.1.1.4.2.1.cmml" xref="S3.Ex5.m1.12.12.1.1.4.2">subscript</csymbol><ci id="S3.Ex5.m1.12.12.1.1.4.2.2.cmml" xref="S3.Ex5.m1.12.12.1.1.4.2.2">𝔼</ci><apply id="S3.Ex5.m1.3.3.1.cmml" xref="S3.Ex5.m1.3.3.1"><csymbol cd="latexml" id="S3.Ex5.m1.3.3.1.2.cmml" xref="S3.Ex5.m1.3.3.1.2">similar-to</csymbol><ci id="S3.Ex5.m1.3.3.1.3.cmml" xref="S3.Ex5.m1.3.3.1.3">𝑐</ci><apply id="S3.Ex5.m1.3.3.1.1.1.1.cmml" xref="S3.Ex5.m1.3.3.1.1.1"><csymbol cd="latexml" id="S3.Ex5.m1.3.3.1.1.1.1.1.cmml" xref="S3.Ex5.m1.3.3.1.1.1.1.1">conditional</csymbol><ci id="S3.Ex5.m1.3.3.1.1.1.1.2.cmml" xref="S3.Ex5.m1.3.3.1.1.1.1.2">𝑐</ci><apply id="S3.Ex5.m1.3.3.1.1.1.1.3.cmml" xref="S3.Ex5.m1.3.3.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.Ex5.m1.3.3.1.1.1.1.3.1.cmml" xref="S3.Ex5.m1.3.3.1.1.1.1.3">superscript</csymbol><ci id="S3.Ex5.m1.3.3.1.1.1.1.3.2.cmml" xref="S3.Ex5.m1.3.3.1.1.1.1.3.2">𝒟</ci><ci id="S3.Ex5.m1.3.3.1.1.1.1.3.3.cmml" xref="S3.Ex5.m1.3.3.1.1.1.1.3.3">s</ci></apply></apply></apply></apply><apply id="S3.Ex5.m1.12.12.1.1.4.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.4.1.1"><csymbol cd="latexml" id="S3.Ex5.m1.12.12.1.1.4.1.2.1.cmml" xref="S3.Ex5.m1.12.12.1.1.4.1.1.2">delimited-[]</csymbol><apply id="S3.Ex5.m1.12.12.1.1.4.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1"><times id="S3.Ex5.m1.12.12.1.1.4.1.1.1.1.cmml" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.1"></times><ci id="S3.Ex5.m1.12.12.1.1.4.1.1.1.2.cmml" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.2">𝑤</ci><ci id="S3.Ex5.m1.9.9.cmml" xref="S3.Ex5.m1.9.9">𝑐</ci><ci id="S3.Ex5.m1.12.12.1.1.4.1.1.1.4.cmml" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.4">ℒ</ci><list id="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.1.cmml" xref="S3.Ex5.m1.12.12.1.1.4.1.1.1.5.2"><ci id="S3.Ex5.m1.10.10.cmml" xref="S3.Ex5.m1.10.10">𝑐</ci><ci id="S3.Ex5.m1.11.11.cmml" xref="S3.Ex5.m1.11.11">𝜃</ci></list></apply></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.Ex5.m1.12c">{\cal L}({\cal D}^{\rm s};\theta)=\sum_{c}{\cal L}(c;\theta)P(c|{\cal D}^{\rm s%
})=\sum_{c}{\cal L}(c;\theta)\frac{P(c|{\cal D}^{\rm s})}{P(c|{\cal D}^{\rm g}%
)}P(c|{\cal D}^{\rm g})=\mathop{\mathbb{E}}_{c\sim(c|{\cal D}^{\rm s})}[w(c){%
\cal L}(c;\theta)].</annotation><annotation encoding="application/x-llamapun" id="S3.Ex5.m1.12d">caligraphic_L ( caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ; italic_θ ) = ∑ start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT caligraphic_L ( italic_c ; italic_θ ) italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) = ∑ start_POSTSUBSCRIPT italic_c end_POSTSUBSCRIPT caligraphic_L ( italic_c ; italic_θ ) divide start_ARG italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) end_ARG start_ARG italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ) end_ARG italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ) = blackboard_E start_POSTSUBSCRIPT italic_c ∼ ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) end_POSTSUBSCRIPT [ italic_w ( italic_c ) caligraphic_L ( italic_c ; italic_θ ) ] .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
</tr></tbody>
</table>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p3">
<p class="ltx_p" id="S3.SS4.p3.15">In our experiments, we estimate the terms <math alttext="w(c),{\cal L}(c;\theta)" class="ltx_Math" display="inline" id="S3.SS4.p3.1.m1.5"><semantics id="S3.SS4.p3.1.m1.5a"><mrow id="S3.SS4.p3.1.m1.5.5.2" xref="S3.SS4.p3.1.m1.5.5.3.cmml"><mrow id="S3.SS4.p3.1.m1.4.4.1.1" xref="S3.SS4.p3.1.m1.4.4.1.1.cmml"><mi id="S3.SS4.p3.1.m1.4.4.1.1.2" xref="S3.SS4.p3.1.m1.4.4.1.1.2.cmml">w</mi><mo id="S3.SS4.p3.1.m1.4.4.1.1.1" xref="S3.SS4.p3.1.m1.4.4.1.1.1.cmml">⁢</mo><mrow id="S3.SS4.p3.1.m1.4.4.1.1.3.2" xref="S3.SS4.p3.1.m1.4.4.1.1.cmml"><mo id="S3.SS4.p3.1.m1.4.4.1.1.3.2.1" stretchy="false" xref="S3.SS4.p3.1.m1.4.4.1.1.cmml">(</mo><mi id="S3.SS4.p3.1.m1.1.1" xref="S3.SS4.p3.1.m1.1.1.cmml">c</mi><mo id="S3.SS4.p3.1.m1.4.4.1.1.3.2.2" stretchy="false" xref="S3.SS4.p3.1.m1.4.4.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p3.1.m1.5.5.2.3" xref="S3.SS4.p3.1.m1.5.5.3.cmml">,</mo><mrow id="S3.SS4.p3.1.m1.5.5.2.2" xref="S3.SS4.p3.1.m1.5.5.2.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p3.1.m1.5.5.2.2.2" xref="S3.SS4.p3.1.m1.5.5.2.2.2.cmml">ℒ</mi><mo id="S3.SS4.p3.1.m1.5.5.2.2.1" xref="S3.SS4.p3.1.m1.5.5.2.2.1.cmml">⁢</mo><mrow id="S3.SS4.p3.1.m1.5.5.2.2.3.2" xref="S3.SS4.p3.1.m1.5.5.2.2.3.1.cmml"><mo id="S3.SS4.p3.1.m1.5.5.2.2.3.2.1" stretchy="false" xref="S3.SS4.p3.1.m1.5.5.2.2.3.1.cmml">(</mo><mi id="S3.SS4.p3.1.m1.2.2" xref="S3.SS4.p3.1.m1.2.2.cmml">c</mi><mo id="S3.SS4.p3.1.m1.5.5.2.2.3.2.2" xref="S3.SS4.p3.1.m1.5.5.2.2.3.1.cmml">;</mo><mi id="S3.SS4.p3.1.m1.3.3" xref="S3.SS4.p3.1.m1.3.3.cmml">θ</mi><mo id="S3.SS4.p3.1.m1.5.5.2.2.3.2.3" stretchy="false" xref="S3.SS4.p3.1.m1.5.5.2.2.3.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.1.m1.5b"><list id="S3.SS4.p3.1.m1.5.5.3.cmml" xref="S3.SS4.p3.1.m1.5.5.2"><apply id="S3.SS4.p3.1.m1.4.4.1.1.cmml" xref="S3.SS4.p3.1.m1.4.4.1.1"><times id="S3.SS4.p3.1.m1.4.4.1.1.1.cmml" xref="S3.SS4.p3.1.m1.4.4.1.1.1"></times><ci id="S3.SS4.p3.1.m1.4.4.1.1.2.cmml" xref="S3.SS4.p3.1.m1.4.4.1.1.2">𝑤</ci><ci id="S3.SS4.p3.1.m1.1.1.cmml" xref="S3.SS4.p3.1.m1.1.1">𝑐</ci></apply><apply id="S3.SS4.p3.1.m1.5.5.2.2.cmml" xref="S3.SS4.p3.1.m1.5.5.2.2"><times id="S3.SS4.p3.1.m1.5.5.2.2.1.cmml" xref="S3.SS4.p3.1.m1.5.5.2.2.1"></times><ci id="S3.SS4.p3.1.m1.5.5.2.2.2.cmml" xref="S3.SS4.p3.1.m1.5.5.2.2.2">ℒ</ci><list id="S3.SS4.p3.1.m1.5.5.2.2.3.1.cmml" xref="S3.SS4.p3.1.m1.5.5.2.2.3.2"><ci id="S3.SS4.p3.1.m1.2.2.cmml" xref="S3.SS4.p3.1.m1.2.2">𝑐</ci><ci id="S3.SS4.p3.1.m1.3.3.cmml" xref="S3.SS4.p3.1.m1.3.3">𝜃</ci></list></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.1.m1.5c">w(c),{\cal L}(c;\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.1.m1.5d">italic_w ( italic_c ) , caligraphic_L ( italic_c ; italic_θ )</annotation></semantics></math> from
the finite training sets <math alttext="D^{\rm s}\sim{\cal D}^{\rm s}" class="ltx_Math" display="inline" id="S3.SS4.p3.2.m2.1"><semantics id="S3.SS4.p3.2.m2.1a"><mrow id="S3.SS4.p3.2.m2.1.1" xref="S3.SS4.p3.2.m2.1.1.cmml"><msup id="S3.SS4.p3.2.m2.1.1.2" xref="S3.SS4.p3.2.m2.1.1.2.cmml"><mi id="S3.SS4.p3.2.m2.1.1.2.2" xref="S3.SS4.p3.2.m2.1.1.2.2.cmml">D</mi><mi id="S3.SS4.p3.2.m2.1.1.2.3" mathvariant="normal" xref="S3.SS4.p3.2.m2.1.1.2.3.cmml">s</mi></msup><mo id="S3.SS4.p3.2.m2.1.1.1" xref="S3.SS4.p3.2.m2.1.1.1.cmml">∼</mo><msup id="S3.SS4.p3.2.m2.1.1.3" xref="S3.SS4.p3.2.m2.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p3.2.m2.1.1.3.2" xref="S3.SS4.p3.2.m2.1.1.3.2.cmml">𝒟</mi><mi id="S3.SS4.p3.2.m2.1.1.3.3" mathvariant="normal" xref="S3.SS4.p3.2.m2.1.1.3.3.cmml">s</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.2.m2.1b"><apply id="S3.SS4.p3.2.m2.1.1.cmml" xref="S3.SS4.p3.2.m2.1.1"><csymbol cd="latexml" id="S3.SS4.p3.2.m2.1.1.1.cmml" xref="S3.SS4.p3.2.m2.1.1.1">similar-to</csymbol><apply id="S3.SS4.p3.2.m2.1.1.2.cmml" xref="S3.SS4.p3.2.m2.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p3.2.m2.1.1.2.1.cmml" xref="S3.SS4.p3.2.m2.1.1.2">superscript</csymbol><ci id="S3.SS4.p3.2.m2.1.1.2.2.cmml" xref="S3.SS4.p3.2.m2.1.1.2.2">𝐷</ci><ci id="S3.SS4.p3.2.m2.1.1.2.3.cmml" xref="S3.SS4.p3.2.m2.1.1.2.3">s</ci></apply><apply id="S3.SS4.p3.2.m2.1.1.3.cmml" xref="S3.SS4.p3.2.m2.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p3.2.m2.1.1.3.1.cmml" xref="S3.SS4.p3.2.m2.1.1.3">superscript</csymbol><ci id="S3.SS4.p3.2.m2.1.1.3.2.cmml" xref="S3.SS4.p3.2.m2.1.1.3.2">𝒟</ci><ci id="S3.SS4.p3.2.m2.1.1.3.3.cmml" xref="S3.SS4.p3.2.m2.1.1.3.3">s</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.2.m2.1c">D^{\rm s}\sim{\cal D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.2.m2.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ∼ caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>
and <math alttext="D^{\rm g}\sim{\cal D}^{\rm g}" class="ltx_Math" display="inline" id="S3.SS4.p3.3.m3.1"><semantics id="S3.SS4.p3.3.m3.1a"><mrow id="S3.SS4.p3.3.m3.1.1" xref="S3.SS4.p3.3.m3.1.1.cmml"><msup id="S3.SS4.p3.3.m3.1.1.2" xref="S3.SS4.p3.3.m3.1.1.2.cmml"><mi id="S3.SS4.p3.3.m3.1.1.2.2" xref="S3.SS4.p3.3.m3.1.1.2.2.cmml">D</mi><mi id="S3.SS4.p3.3.m3.1.1.2.3" mathvariant="normal" xref="S3.SS4.p3.3.m3.1.1.2.3.cmml">g</mi></msup><mo id="S3.SS4.p3.3.m3.1.1.1" xref="S3.SS4.p3.3.m3.1.1.1.cmml">∼</mo><msup id="S3.SS4.p3.3.m3.1.1.3" xref="S3.SS4.p3.3.m3.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p3.3.m3.1.1.3.2" xref="S3.SS4.p3.3.m3.1.1.3.2.cmml">𝒟</mi><mi id="S3.SS4.p3.3.m3.1.1.3.3" mathvariant="normal" xref="S3.SS4.p3.3.m3.1.1.3.3.cmml">g</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.3.m3.1b"><apply id="S3.SS4.p3.3.m3.1.1.cmml" xref="S3.SS4.p3.3.m3.1.1"><csymbol cd="latexml" id="S3.SS4.p3.3.m3.1.1.1.cmml" xref="S3.SS4.p3.3.m3.1.1.1">similar-to</csymbol><apply id="S3.SS4.p3.3.m3.1.1.2.cmml" xref="S3.SS4.p3.3.m3.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p3.3.m3.1.1.2.1.cmml" xref="S3.SS4.p3.3.m3.1.1.2">superscript</csymbol><ci id="S3.SS4.p3.3.m3.1.1.2.2.cmml" xref="S3.SS4.p3.3.m3.1.1.2.2">𝐷</ci><ci id="S3.SS4.p3.3.m3.1.1.2.3.cmml" xref="S3.SS4.p3.3.m3.1.1.2.3">g</ci></apply><apply id="S3.SS4.p3.3.m3.1.1.3.cmml" xref="S3.SS4.p3.3.m3.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p3.3.m3.1.1.3.1.cmml" xref="S3.SS4.p3.3.m3.1.1.3">superscript</csymbol><ci id="S3.SS4.p3.3.m3.1.1.3.2.cmml" xref="S3.SS4.p3.3.m3.1.1.3.2">𝒟</ci><ci id="S3.SS4.p3.3.m3.1.1.3.3.cmml" xref="S3.SS4.p3.3.m3.1.1.3.3">g</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.3.m3.1c">D^{\rm g}\sim{\cal D}^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.3.m3.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ∼ caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math>. We count the number of examples in each
cluster to estimate <math alttext="P(c|{D}^{\rm s}),P(c|{D}^{\rm g})" class="ltx_Math" display="inline" id="S3.SS4.p3.4.m4.2"><semantics id="S3.SS4.p3.4.m4.2a"><mrow id="S3.SS4.p3.4.m4.2.2.2" xref="S3.SS4.p3.4.m4.2.2.3.cmml"><mrow id="S3.SS4.p3.4.m4.1.1.1.1" xref="S3.SS4.p3.4.m4.1.1.1.1.cmml"><mi id="S3.SS4.p3.4.m4.1.1.1.1.3" xref="S3.SS4.p3.4.m4.1.1.1.1.3.cmml">P</mi><mo id="S3.SS4.p3.4.m4.1.1.1.1.2" xref="S3.SS4.p3.4.m4.1.1.1.1.2.cmml">⁢</mo><mrow id="S3.SS4.p3.4.m4.1.1.1.1.1.1" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.cmml"><mo id="S3.SS4.p3.4.m4.1.1.1.1.1.1.2" stretchy="false" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.cmml"><mi id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.2" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.1" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.1.cmml">|</mo><msup id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.cmml"><mi id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.2" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.2.cmml">D</mi><mi id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.3" mathvariant="normal" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.SS4.p3.4.m4.1.1.1.1.1.1.3" stretchy="false" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S3.SS4.p3.4.m4.2.2.2.3" xref="S3.SS4.p3.4.m4.2.2.3.cmml">,</mo><mrow id="S3.SS4.p3.4.m4.2.2.2.2" xref="S3.SS4.p3.4.m4.2.2.2.2.cmml"><mi id="S3.SS4.p3.4.m4.2.2.2.2.3" xref="S3.SS4.p3.4.m4.2.2.2.2.3.cmml">P</mi><mo id="S3.SS4.p3.4.m4.2.2.2.2.2" xref="S3.SS4.p3.4.m4.2.2.2.2.2.cmml">⁢</mo><mrow id="S3.SS4.p3.4.m4.2.2.2.2.1.1" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.cmml"><mo id="S3.SS4.p3.4.m4.2.2.2.2.1.1.2" stretchy="false" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.cmml">(</mo><mrow id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.cmml"><mi id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.2" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.1" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.1.cmml">|</mo><msup id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.cmml"><mi id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.2" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.2.cmml">D</mi><mi id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.3" mathvariant="normal" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.3.cmml">g</mi></msup></mrow><mo id="S3.SS4.p3.4.m4.2.2.2.2.1.1.3" stretchy="false" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.4.m4.2b"><list id="S3.SS4.p3.4.m4.2.2.3.cmml" xref="S3.SS4.p3.4.m4.2.2.2"><apply id="S3.SS4.p3.4.m4.1.1.1.1.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1"><times id="S3.SS4.p3.4.m4.1.1.1.1.2.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.2"></times><ci id="S3.SS4.p3.4.m4.1.1.1.1.3.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.3">𝑃</ci><apply id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1"><csymbol cd="latexml" id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.1.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.2.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.2">𝑐</ci><apply id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.1.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3">superscript</csymbol><ci id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.2.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.2">𝐷</ci><ci id="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.3.cmml" xref="S3.SS4.p3.4.m4.1.1.1.1.1.1.1.3.3">s</ci></apply></apply></apply><apply id="S3.SS4.p3.4.m4.2.2.2.2.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2"><times id="S3.SS4.p3.4.m4.2.2.2.2.2.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.2"></times><ci id="S3.SS4.p3.4.m4.2.2.2.2.3.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.3">𝑃</ci><apply id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1"><csymbol cd="latexml" id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.1.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.1">conditional</csymbol><ci id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.2.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.2">𝑐</ci><apply id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.1.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3">superscript</csymbol><ci id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.2.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.2">𝐷</ci><ci id="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.3.cmml" xref="S3.SS4.p3.4.m4.2.2.2.2.1.1.1.3.3">g</ci></apply></apply></apply></list></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.4.m4.2c">P(c|{D}^{\rm s}),P(c|{D}^{\rm g})</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.4.m4.2d">italic_P ( italic_c | italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) , italic_P ( italic_c | italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT )</annotation></semantics></math>.
The expected loss over a
cluster <math alttext="{\cal L}(c;\theta)" class="ltx_Math" display="inline" id="S3.SS4.p3.5.m5.2"><semantics id="S3.SS4.p3.5.m5.2a"><mrow id="S3.SS4.p3.5.m5.2.3" xref="S3.SS4.p3.5.m5.2.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p3.5.m5.2.3.2" xref="S3.SS4.p3.5.m5.2.3.2.cmml">ℒ</mi><mo id="S3.SS4.p3.5.m5.2.3.1" xref="S3.SS4.p3.5.m5.2.3.1.cmml">⁢</mo><mrow id="S3.SS4.p3.5.m5.2.3.3.2" xref="S3.SS4.p3.5.m5.2.3.3.1.cmml"><mo id="S3.SS4.p3.5.m5.2.3.3.2.1" stretchy="false" xref="S3.SS4.p3.5.m5.2.3.3.1.cmml">(</mo><mi id="S3.SS4.p3.5.m5.1.1" xref="S3.SS4.p3.5.m5.1.1.cmml">c</mi><mo id="S3.SS4.p3.5.m5.2.3.3.2.2" xref="S3.SS4.p3.5.m5.2.3.3.1.cmml">;</mo><mi id="S3.SS4.p3.5.m5.2.2" xref="S3.SS4.p3.5.m5.2.2.cmml">θ</mi><mo id="S3.SS4.p3.5.m5.2.3.3.2.3" stretchy="false" xref="S3.SS4.p3.5.m5.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.5.m5.2b"><apply id="S3.SS4.p3.5.m5.2.3.cmml" xref="S3.SS4.p3.5.m5.2.3"><times id="S3.SS4.p3.5.m5.2.3.1.cmml" xref="S3.SS4.p3.5.m5.2.3.1"></times><ci id="S3.SS4.p3.5.m5.2.3.2.cmml" xref="S3.SS4.p3.5.m5.2.3.2">ℒ</ci><list id="S3.SS4.p3.5.m5.2.3.3.1.cmml" xref="S3.SS4.p3.5.m5.2.3.3.2"><ci id="S3.SS4.p3.5.m5.1.1.cmml" xref="S3.SS4.p3.5.m5.1.1">𝑐</ci><ci id="S3.SS4.p3.5.m5.2.2.cmml" xref="S3.SS4.p3.5.m5.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.5.m5.2c">{\cal L}(c;\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.5.m5.2d">caligraphic_L ( italic_c ; italic_θ )</annotation></semantics></math> is estimated as the average loss over the generalist
examples in cluster <math alttext="c" class="ltx_Math" display="inline" id="S3.SS4.p3.6.m6.1"><semantics id="S3.SS4.p3.6.m6.1a"><mi id="S3.SS4.p3.6.m6.1.1" xref="S3.SS4.p3.6.m6.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.6.m6.1b"><ci id="S3.SS4.p3.6.m6.1.1.cmml" xref="S3.SS4.p3.6.m6.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.6.m6.1c">c</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.6.m6.1d">italic_c</annotation></semantics></math>, <math alttext="{\cal L}({D}^{\rm g}\cap K(c);\theta)" class="ltx_Math" display="inline" id="S3.SS4.p3.7.m7.3"><semantics id="S3.SS4.p3.7.m7.3a"><mrow id="S3.SS4.p3.7.m7.3.3" xref="S3.SS4.p3.7.m7.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p3.7.m7.3.3.3" xref="S3.SS4.p3.7.m7.3.3.3.cmml">ℒ</mi><mo id="S3.SS4.p3.7.m7.3.3.2" xref="S3.SS4.p3.7.m7.3.3.2.cmml">⁢</mo><mrow id="S3.SS4.p3.7.m7.3.3.1.1" xref="S3.SS4.p3.7.m7.3.3.1.2.cmml"><mo id="S3.SS4.p3.7.m7.3.3.1.1.2" stretchy="false" xref="S3.SS4.p3.7.m7.3.3.1.2.cmml">(</mo><mrow id="S3.SS4.p3.7.m7.3.3.1.1.1" xref="S3.SS4.p3.7.m7.3.3.1.1.1.cmml"><msup id="S3.SS4.p3.7.m7.3.3.1.1.1.2" xref="S3.SS4.p3.7.m7.3.3.1.1.1.2.cmml"><mi id="S3.SS4.p3.7.m7.3.3.1.1.1.2.2" xref="S3.SS4.p3.7.m7.3.3.1.1.1.2.2.cmml">D</mi><mi id="S3.SS4.p3.7.m7.3.3.1.1.1.2.3" mathvariant="normal" xref="S3.SS4.p3.7.m7.3.3.1.1.1.2.3.cmml">g</mi></msup><mo id="S3.SS4.p3.7.m7.3.3.1.1.1.1" xref="S3.SS4.p3.7.m7.3.3.1.1.1.1.cmml">∩</mo><mrow id="S3.SS4.p3.7.m7.3.3.1.1.1.3" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3.cmml"><mi id="S3.SS4.p3.7.m7.3.3.1.1.1.3.2" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3.2.cmml">K</mi><mo id="S3.SS4.p3.7.m7.3.3.1.1.1.3.1" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3.1.cmml">⁢</mo><mrow id="S3.SS4.p3.7.m7.3.3.1.1.1.3.3.2" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3.cmml"><mo id="S3.SS4.p3.7.m7.3.3.1.1.1.3.3.2.1" stretchy="false" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3.cmml">(</mo><mi id="S3.SS4.p3.7.m7.1.1" xref="S3.SS4.p3.7.m7.1.1.cmml">c</mi><mo id="S3.SS4.p3.7.m7.3.3.1.1.1.3.3.2.2" stretchy="false" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="S3.SS4.p3.7.m7.3.3.1.1.3" xref="S3.SS4.p3.7.m7.3.3.1.2.cmml">;</mo><mi id="S3.SS4.p3.7.m7.2.2" xref="S3.SS4.p3.7.m7.2.2.cmml">θ</mi><mo id="S3.SS4.p3.7.m7.3.3.1.1.4" stretchy="false" xref="S3.SS4.p3.7.m7.3.3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.7.m7.3b"><apply id="S3.SS4.p3.7.m7.3.3.cmml" xref="S3.SS4.p3.7.m7.3.3"><times id="S3.SS4.p3.7.m7.3.3.2.cmml" xref="S3.SS4.p3.7.m7.3.3.2"></times><ci id="S3.SS4.p3.7.m7.3.3.3.cmml" xref="S3.SS4.p3.7.m7.3.3.3">ℒ</ci><list id="S3.SS4.p3.7.m7.3.3.1.2.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1"><apply id="S3.SS4.p3.7.m7.3.3.1.1.1.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1"><intersect id="S3.SS4.p3.7.m7.3.3.1.1.1.1.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1.1"></intersect><apply id="S3.SS4.p3.7.m7.3.3.1.1.1.2.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p3.7.m7.3.3.1.1.1.2.1.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1.2">superscript</csymbol><ci id="S3.SS4.p3.7.m7.3.3.1.1.1.2.2.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1.2.2">𝐷</ci><ci id="S3.SS4.p3.7.m7.3.3.1.1.1.2.3.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1.2.3">g</ci></apply><apply id="S3.SS4.p3.7.m7.3.3.1.1.1.3.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3"><times id="S3.SS4.p3.7.m7.3.3.1.1.1.3.1.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3.1"></times><ci id="S3.SS4.p3.7.m7.3.3.1.1.1.3.2.cmml" xref="S3.SS4.p3.7.m7.3.3.1.1.1.3.2">𝐾</ci><ci id="S3.SS4.p3.7.m7.1.1.cmml" xref="S3.SS4.p3.7.m7.1.1">𝑐</ci></apply></apply><ci id="S3.SS4.p3.7.m7.2.2.cmml" xref="S3.SS4.p3.7.m7.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.7.m7.3c">{\cal L}({D}^{\rm g}\cap K(c);\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.7.m7.3d">caligraphic_L ( italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ∩ italic_K ( italic_c ) ; italic_θ )</annotation></semantics></math>,
where <math alttext="K(c)" class="ltx_Math" display="inline" id="S3.SS4.p3.8.m8.1"><semantics id="S3.SS4.p3.8.m8.1a"><mrow id="S3.SS4.p3.8.m8.1.2" xref="S3.SS4.p3.8.m8.1.2.cmml"><mi id="S3.SS4.p3.8.m8.1.2.2" xref="S3.SS4.p3.8.m8.1.2.2.cmml">K</mi><mo id="S3.SS4.p3.8.m8.1.2.1" xref="S3.SS4.p3.8.m8.1.2.1.cmml">⁢</mo><mrow id="S3.SS4.p3.8.m8.1.2.3.2" xref="S3.SS4.p3.8.m8.1.2.cmml"><mo id="S3.SS4.p3.8.m8.1.2.3.2.1" stretchy="false" xref="S3.SS4.p3.8.m8.1.2.cmml">(</mo><mi id="S3.SS4.p3.8.m8.1.1" xref="S3.SS4.p3.8.m8.1.1.cmml">c</mi><mo id="S3.SS4.p3.8.m8.1.2.3.2.2" stretchy="false" xref="S3.SS4.p3.8.m8.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.8.m8.1b"><apply id="S3.SS4.p3.8.m8.1.2.cmml" xref="S3.SS4.p3.8.m8.1.2"><times id="S3.SS4.p3.8.m8.1.2.1.cmml" xref="S3.SS4.p3.8.m8.1.2.1"></times><ci id="S3.SS4.p3.8.m8.1.2.2.cmml" xref="S3.SS4.p3.8.m8.1.2.2">𝐾</ci><ci id="S3.SS4.p3.8.m8.1.1.cmml" xref="S3.SS4.p3.8.m8.1.1">𝑐</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.8.m8.1c">K(c)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.8.m8.1d">italic_K ( italic_c )</annotation></semantics></math> denotes the examples in cluster <math alttext="c" class="ltx_Math" display="inline" id="S3.SS4.p3.9.m9.1"><semantics id="S3.SS4.p3.9.m9.1a"><mi id="S3.SS4.p3.9.m9.1.1" xref="S3.SS4.p3.9.m9.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.9.m9.1b"><ci id="S3.SS4.p3.9.m9.1.1.cmml" xref="S3.SS4.p3.9.m9.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.9.m9.1c">c</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.9.m9.1d">italic_c</annotation></semantics></math>.
This strategy therefore only estimates <math alttext="P(c|{D}^{\rm s})" class="ltx_Math" display="inline" id="S3.SS4.p3.10.m10.1"><semantics id="S3.SS4.p3.10.m10.1a"><mrow id="S3.SS4.p3.10.m10.1.1" xref="S3.SS4.p3.10.m10.1.1.cmml"><mi id="S3.SS4.p3.10.m10.1.1.3" xref="S3.SS4.p3.10.m10.1.1.3.cmml">P</mi><mo id="S3.SS4.p3.10.m10.1.1.2" xref="S3.SS4.p3.10.m10.1.1.2.cmml">⁢</mo><mrow id="S3.SS4.p3.10.m10.1.1.1.1" xref="S3.SS4.p3.10.m10.1.1.1.1.1.cmml"><mo id="S3.SS4.p3.10.m10.1.1.1.1.2" stretchy="false" xref="S3.SS4.p3.10.m10.1.1.1.1.1.cmml">(</mo><mrow id="S3.SS4.p3.10.m10.1.1.1.1.1" xref="S3.SS4.p3.10.m10.1.1.1.1.1.cmml"><mi id="S3.SS4.p3.10.m10.1.1.1.1.1.2" xref="S3.SS4.p3.10.m10.1.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S3.SS4.p3.10.m10.1.1.1.1.1.1" xref="S3.SS4.p3.10.m10.1.1.1.1.1.1.cmml">|</mo><msup id="S3.SS4.p3.10.m10.1.1.1.1.1.3" xref="S3.SS4.p3.10.m10.1.1.1.1.1.3.cmml"><mi id="S3.SS4.p3.10.m10.1.1.1.1.1.3.2" xref="S3.SS4.p3.10.m10.1.1.1.1.1.3.2.cmml">D</mi><mi id="S3.SS4.p3.10.m10.1.1.1.1.1.3.3" mathvariant="normal" xref="S3.SS4.p3.10.m10.1.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S3.SS4.p3.10.m10.1.1.1.1.3" stretchy="false" xref="S3.SS4.p3.10.m10.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.10.m10.1b"><apply id="S3.SS4.p3.10.m10.1.1.cmml" xref="S3.SS4.p3.10.m10.1.1"><times id="S3.SS4.p3.10.m10.1.1.2.cmml" xref="S3.SS4.p3.10.m10.1.1.2"></times><ci id="S3.SS4.p3.10.m10.1.1.3.cmml" xref="S3.SS4.p3.10.m10.1.1.3">𝑃</ci><apply id="S3.SS4.p3.10.m10.1.1.1.1.1.cmml" xref="S3.SS4.p3.10.m10.1.1.1.1"><csymbol cd="latexml" id="S3.SS4.p3.10.m10.1.1.1.1.1.1.cmml" xref="S3.SS4.p3.10.m10.1.1.1.1.1.1">conditional</csymbol><ci id="S3.SS4.p3.10.m10.1.1.1.1.1.2.cmml" xref="S3.SS4.p3.10.m10.1.1.1.1.1.2">𝑐</ci><apply id="S3.SS4.p3.10.m10.1.1.1.1.1.3.cmml" xref="S3.SS4.p3.10.m10.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S3.SS4.p3.10.m10.1.1.1.1.1.3.1.cmml" xref="S3.SS4.p3.10.m10.1.1.1.1.1.3">superscript</csymbol><ci id="S3.SS4.p3.10.m10.1.1.1.1.1.3.2.cmml" xref="S3.SS4.p3.10.m10.1.1.1.1.1.3.2">𝐷</ci><ci id="S3.SS4.p3.10.m10.1.1.1.1.1.3.3.cmml" xref="S3.SS4.p3.10.m10.1.1.1.1.1.3.3">s</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.10.m10.1c">P(c|{D}^{\rm s})</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.10.m10.1d">italic_P ( italic_c | italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT )</annotation></semantics></math> on the small <math alttext="{D}^{\rm s}" class="ltx_Math" display="inline" id="S3.SS4.p3.11.m11.1"><semantics id="S3.SS4.p3.11.m11.1a"><msup id="S3.SS4.p3.11.m11.1.1" xref="S3.SS4.p3.11.m11.1.1.cmml"><mi id="S3.SS4.p3.11.m11.1.1.2" xref="S3.SS4.p3.11.m11.1.1.2.cmml">D</mi><mi id="S3.SS4.p3.11.m11.1.1.3" mathvariant="normal" xref="S3.SS4.p3.11.m11.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.11.m11.1b"><apply id="S3.SS4.p3.11.m11.1.1.cmml" xref="S3.SS4.p3.11.m11.1.1"><csymbol cd="ambiguous" id="S3.SS4.p3.11.m11.1.1.1.cmml" xref="S3.SS4.p3.11.m11.1.1">superscript</csymbol><ci id="S3.SS4.p3.11.m11.1.1.2.cmml" xref="S3.SS4.p3.11.m11.1.1.2">𝐷</ci><ci id="S3.SS4.p3.11.m11.1.1.3.cmml" xref="S3.SS4.p3.11.m11.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.11.m11.1c">{D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.11.m11.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>. The term <math alttext="{\cal L}(c;\theta)" class="ltx_Math" display="inline" id="S3.SS4.p3.12.m12.2"><semantics id="S3.SS4.p3.12.m12.2a"><mrow id="S3.SS4.p3.12.m12.2.3" xref="S3.SS4.p3.12.m12.2.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p3.12.m12.2.3.2" xref="S3.SS4.p3.12.m12.2.3.2.cmml">ℒ</mi><mo id="S3.SS4.p3.12.m12.2.3.1" xref="S3.SS4.p3.12.m12.2.3.1.cmml">⁢</mo><mrow id="S3.SS4.p3.12.m12.2.3.3.2" xref="S3.SS4.p3.12.m12.2.3.3.1.cmml"><mo id="S3.SS4.p3.12.m12.2.3.3.2.1" stretchy="false" xref="S3.SS4.p3.12.m12.2.3.3.1.cmml">(</mo><mi id="S3.SS4.p3.12.m12.1.1" xref="S3.SS4.p3.12.m12.1.1.cmml">c</mi><mo id="S3.SS4.p3.12.m12.2.3.3.2.2" xref="S3.SS4.p3.12.m12.2.3.3.1.cmml">;</mo><mi id="S3.SS4.p3.12.m12.2.2" xref="S3.SS4.p3.12.m12.2.2.cmml">θ</mi><mo id="S3.SS4.p3.12.m12.2.3.3.2.3" stretchy="false" xref="S3.SS4.p3.12.m12.2.3.3.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.12.m12.2b"><apply id="S3.SS4.p3.12.m12.2.3.cmml" xref="S3.SS4.p3.12.m12.2.3"><times id="S3.SS4.p3.12.m12.2.3.1.cmml" xref="S3.SS4.p3.12.m12.2.3.1"></times><ci id="S3.SS4.p3.12.m12.2.3.2.cmml" xref="S3.SS4.p3.12.m12.2.3.2">ℒ</ci><list id="S3.SS4.p3.12.m12.2.3.3.1.cmml" xref="S3.SS4.p3.12.m12.2.3.3.2"><ci id="S3.SS4.p3.12.m12.1.1.cmml" xref="S3.SS4.p3.12.m12.1.1">𝑐</ci><ci id="S3.SS4.p3.12.m12.2.2.cmml" xref="S3.SS4.p3.12.m12.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.12.m12.2c">{\cal L}(c;\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.12.m12.2d">caligraphic_L ( italic_c ; italic_θ )</annotation></semantics></math> is estimated over the large set as
<span class="ltx_text" id="S3.SS4.p3.13.1"><math alttext="{\cal L}({D}^{\rm g}\cap K(c);\theta)" class="ltx_Math" display="inline" id="S3.SS4.p3.13.1.m1.3"><semantics id="S3.SS4.p3.13.1.m1.3a"><mrow id="S3.SS4.p3.13.1.m1.3.3" xref="S3.SS4.p3.13.1.m1.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p3.13.1.m1.3.3.3" xref="S3.SS4.p3.13.1.m1.3.3.3.cmml">ℒ</mi><mo id="S3.SS4.p3.13.1.m1.3.3.2" xref="S3.SS4.p3.13.1.m1.3.3.2.cmml">⁢</mo><mrow id="S3.SS4.p3.13.1.m1.3.3.1.1" xref="S3.SS4.p3.13.1.m1.3.3.1.2.cmml"><mo id="S3.SS4.p3.13.1.m1.3.3.1.1.2" stretchy="false" xref="S3.SS4.p3.13.1.m1.3.3.1.2.cmml">(</mo><mrow id="S3.SS4.p3.13.1.m1.3.3.1.1.1" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.cmml"><msup id="S3.SS4.p3.13.1.m1.3.3.1.1.1.2" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.cmml"><mi id="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.2" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.2.cmml">D</mi><mi id="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.3" mathvariant="normal" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.3.cmml">g</mi></msup><mo id="S3.SS4.p3.13.1.m1.3.3.1.1.1.1" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.1.cmml">∩</mo><mrow id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.cmml"><mi id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.2" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.2.cmml">K</mi><mo id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.1" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.1.cmml">⁢</mo><mrow id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.3.2" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.cmml"><mo id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.3.2.1" stretchy="false" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.cmml">(</mo><mi id="S3.SS4.p3.13.1.m1.1.1" xref="S3.SS4.p3.13.1.m1.1.1.cmml">c</mi><mo id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.3.2.2" stretchy="false" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="S3.SS4.p3.13.1.m1.3.3.1.1.3" xref="S3.SS4.p3.13.1.m1.3.3.1.2.cmml">;</mo><mi id="S3.SS4.p3.13.1.m1.2.2" xref="S3.SS4.p3.13.1.m1.2.2.cmml">θ</mi><mo id="S3.SS4.p3.13.1.m1.3.3.1.1.4" stretchy="false" xref="S3.SS4.p3.13.1.m1.3.3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.13.1.m1.3b"><apply id="S3.SS4.p3.13.1.m1.3.3.cmml" xref="S3.SS4.p3.13.1.m1.3.3"><times id="S3.SS4.p3.13.1.m1.3.3.2.cmml" xref="S3.SS4.p3.13.1.m1.3.3.2"></times><ci id="S3.SS4.p3.13.1.m1.3.3.3.cmml" xref="S3.SS4.p3.13.1.m1.3.3.3">ℒ</ci><list id="S3.SS4.p3.13.1.m1.3.3.1.2.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1"><apply id="S3.SS4.p3.13.1.m1.3.3.1.1.1.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1"><intersect id="S3.SS4.p3.13.1.m1.3.3.1.1.1.1.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.1"></intersect><apply id="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.1.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.2">superscript</csymbol><ci id="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.2.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.2">𝐷</ci><ci id="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.3.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.2.3">g</ci></apply><apply id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3"><times id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.1.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.1"></times><ci id="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.2.cmml" xref="S3.SS4.p3.13.1.m1.3.3.1.1.1.3.2">𝐾</ci><ci id="S3.SS4.p3.13.1.m1.1.1.cmml" xref="S3.SS4.p3.13.1.m1.1.1">𝑐</ci></apply></apply><ci id="S3.SS4.p3.13.1.m1.2.2.cmml" xref="S3.SS4.p3.13.1.m1.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.13.1.m1.3c">{\cal L}({D}^{\rm g}\cap K(c);\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.13.1.m1.3d">caligraphic_L ( italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ∩ italic_K ( italic_c ) ; italic_θ )</annotation></semantics></math></span>
which has less variance than the estimator <math alttext="{\cal L}({D}^{\rm s}\cap K(c);\theta)" class="ltx_Math" display="inline" id="S3.SS4.p3.14.m13.3"><semantics id="S3.SS4.p3.14.m13.3a"><mrow id="S3.SS4.p3.14.m13.3.3" xref="S3.SS4.p3.14.m13.3.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S3.SS4.p3.14.m13.3.3.3" xref="S3.SS4.p3.14.m13.3.3.3.cmml">ℒ</mi><mo id="S3.SS4.p3.14.m13.3.3.2" xref="S3.SS4.p3.14.m13.3.3.2.cmml">⁢</mo><mrow id="S3.SS4.p3.14.m13.3.3.1.1" xref="S3.SS4.p3.14.m13.3.3.1.2.cmml"><mo id="S3.SS4.p3.14.m13.3.3.1.1.2" stretchy="false" xref="S3.SS4.p3.14.m13.3.3.1.2.cmml">(</mo><mrow id="S3.SS4.p3.14.m13.3.3.1.1.1" xref="S3.SS4.p3.14.m13.3.3.1.1.1.cmml"><msup id="S3.SS4.p3.14.m13.3.3.1.1.1.2" xref="S3.SS4.p3.14.m13.3.3.1.1.1.2.cmml"><mi id="S3.SS4.p3.14.m13.3.3.1.1.1.2.2" xref="S3.SS4.p3.14.m13.3.3.1.1.1.2.2.cmml">D</mi><mi id="S3.SS4.p3.14.m13.3.3.1.1.1.2.3" mathvariant="normal" xref="S3.SS4.p3.14.m13.3.3.1.1.1.2.3.cmml">s</mi></msup><mo id="S3.SS4.p3.14.m13.3.3.1.1.1.1" xref="S3.SS4.p3.14.m13.3.3.1.1.1.1.cmml">∩</mo><mrow id="S3.SS4.p3.14.m13.3.3.1.1.1.3" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3.cmml"><mi id="S3.SS4.p3.14.m13.3.3.1.1.1.3.2" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3.2.cmml">K</mi><mo id="S3.SS4.p3.14.m13.3.3.1.1.1.3.1" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3.1.cmml">⁢</mo><mrow id="S3.SS4.p3.14.m13.3.3.1.1.1.3.3.2" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3.cmml"><mo id="S3.SS4.p3.14.m13.3.3.1.1.1.3.3.2.1" stretchy="false" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3.cmml">(</mo><mi id="S3.SS4.p3.14.m13.1.1" xref="S3.SS4.p3.14.m13.1.1.cmml">c</mi><mo id="S3.SS4.p3.14.m13.3.3.1.1.1.3.3.2.2" stretchy="false" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="S3.SS4.p3.14.m13.3.3.1.1.3" xref="S3.SS4.p3.14.m13.3.3.1.2.cmml">;</mo><mi id="S3.SS4.p3.14.m13.2.2" xref="S3.SS4.p3.14.m13.2.2.cmml">θ</mi><mo id="S3.SS4.p3.14.m13.3.3.1.1.4" stretchy="false" xref="S3.SS4.p3.14.m13.3.3.1.2.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.14.m13.3b"><apply id="S3.SS4.p3.14.m13.3.3.cmml" xref="S3.SS4.p3.14.m13.3.3"><times id="S3.SS4.p3.14.m13.3.3.2.cmml" xref="S3.SS4.p3.14.m13.3.3.2"></times><ci id="S3.SS4.p3.14.m13.3.3.3.cmml" xref="S3.SS4.p3.14.m13.3.3.3">ℒ</ci><list id="S3.SS4.p3.14.m13.3.3.1.2.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1"><apply id="S3.SS4.p3.14.m13.3.3.1.1.1.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1"><intersect id="S3.SS4.p3.14.m13.3.3.1.1.1.1.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1.1"></intersect><apply id="S3.SS4.p3.14.m13.3.3.1.1.1.2.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1.2"><csymbol cd="ambiguous" id="S3.SS4.p3.14.m13.3.3.1.1.1.2.1.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1.2">superscript</csymbol><ci id="S3.SS4.p3.14.m13.3.3.1.1.1.2.2.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1.2.2">𝐷</ci><ci id="S3.SS4.p3.14.m13.3.3.1.1.1.2.3.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1.2.3">s</ci></apply><apply id="S3.SS4.p3.14.m13.3.3.1.1.1.3.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3"><times id="S3.SS4.p3.14.m13.3.3.1.1.1.3.1.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3.1"></times><ci id="S3.SS4.p3.14.m13.3.3.1.1.1.3.2.cmml" xref="S3.SS4.p3.14.m13.3.3.1.1.1.3.2">𝐾</ci><ci id="S3.SS4.p3.14.m13.1.1.cmml" xref="S3.SS4.p3.14.m13.1.1">𝑐</ci></apply></apply><ci id="S3.SS4.p3.14.m13.2.2.cmml" xref="S3.SS4.p3.14.m13.2.2">𝜃</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.14.m13.3c">{\cal L}({D}^{\rm s}\cap K(c);\theta)</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.14.m13.3d">caligraphic_L ( italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ∩ italic_K ( italic_c ) ; italic_θ )</annotation></semantics></math> over the small <math alttext="{D}^{\rm s}" class="ltx_Math" display="inline" id="S3.SS4.p3.15.m14.1"><semantics id="S3.SS4.p3.15.m14.1a"><msup id="S3.SS4.p3.15.m14.1.1" xref="S3.SS4.p3.15.m14.1.1.cmml"><mi id="S3.SS4.p3.15.m14.1.1.2" xref="S3.SS4.p3.15.m14.1.1.2.cmml">D</mi><mi id="S3.SS4.p3.15.m14.1.1.3" mathvariant="normal" xref="S3.SS4.p3.15.m14.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S3.SS4.p3.15.m14.1b"><apply id="S3.SS4.p3.15.m14.1.1.cmml" xref="S3.SS4.p3.15.m14.1.1"><csymbol cd="ambiguous" id="S3.SS4.p3.15.m14.1.1.1.cmml" xref="S3.SS4.p3.15.m14.1.1">superscript</csymbol><ci id="S3.SS4.p3.15.m14.1.1.2.cmml" xref="S3.SS4.p3.15.m14.1.1.2">𝐷</ci><ci id="S3.SS4.p3.15.m14.1.1.3.cmml" xref="S3.SS4.p3.15.m14.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S3.SS4.p3.15.m14.1c">{D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S3.SS4.p3.15.m14.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S3.SS4.p4">
<p class="ltx_p" id="S3.SS4.p4.1">We train CRISP models with stochastic optimization <cite class="ltx_cite ltx_citemacro_citep">(Kingma &amp; Ba, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib35" title="">2015</a>, Adam)</cite> and propose Algorithm <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#alg1" title="Algorithm 1 ‣ 3.4 CRISP: ClusteRed Importance Sampling for Pretraining ‣ 3 Data Selection for Task-Adaptive Pretraining ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">1</span></a>. Here, we do not explicitly reweigh the loss. We instead samples cluster from their importance. This avoids frequently visiting clusters with less weights. This strategy has less variance in its gradient estimates,
which can help convergence <cite class="ltx_cite ltx_citemacro_citep">(Seiffert et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib56" title="">2008</a>; An et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib3" title="">2021</a>)</cite>.
This algorithm is simple and efficient when one groups the generalist
examples by cluster prior to training.</p>
</div>
<figure class="ltx_float ltx_float_algorithm ltx_framed ltx_framed_top" id="alg1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_float"><span class="ltx_text ltx_font_bold" id="alg1.2.1.1">Algorithm 1</span> </span> CRISP Training</figcaption>
<div class="ltx_listing ltx_listing" id="alg1.3">
<div class="ltx_listingline" id="alg1.l1">
<span class="ltx_tag ltx_tag_listingline">1:</span><span class="ltx_text ltx_font_bold" id="alg1.l1.1">Parameters:</span> <math alttext="T" class="ltx_Math" display="inline" id="alg1.l1.m1.1"><semantics id="alg1.l1.m1.1a"><mi id="alg1.l1.m1.1.1" xref="alg1.l1.m1.1.1.cmml">T</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m1.1b"><ci id="alg1.l1.m1.1.1.cmml" xref="alg1.l1.m1.1.1">𝑇</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m1.1c">T</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m1.1d">italic_T</annotation></semantics></math> (number of steps), <math alttext="B" class="ltx_Math" display="inline" id="alg1.l1.m2.1"><semantics id="alg1.l1.m2.1a"><mi id="alg1.l1.m2.1.1" xref="alg1.l1.m2.1.1.cmml">B</mi><annotation-xml encoding="MathML-Content" id="alg1.l1.m2.1b"><ci id="alg1.l1.m2.1.1.cmml" xref="alg1.l1.m2.1.1">𝐵</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l1.m2.1c">B</annotation><annotation encoding="application/x-llamapun" id="alg1.l1.m2.1d">italic_B</annotation></semantics></math> (batch size)

</div>
<div class="ltx_listingline" id="alg1.l2">
<span class="ltx_tag ltx_tag_listingline">2:</span><span class="ltx_text ltx_font_bold" id="alg1.l2.1">Input:</span> <math alttext="D^{\rm s}" class="ltx_Math" display="inline" id="alg1.l2.m1.1"><semantics id="alg1.l2.m1.1a"><msup id="alg1.l2.m1.1.1" xref="alg1.l2.m1.1.1.cmml"><mi id="alg1.l2.m1.1.1.2" xref="alg1.l2.m1.1.1.2.cmml">D</mi><mi id="alg1.l2.m1.1.1.3" mathvariant="normal" xref="alg1.l2.m1.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="alg1.l2.m1.1b"><apply id="alg1.l2.m1.1.1.cmml" xref="alg1.l2.m1.1.1"><csymbol cd="ambiguous" id="alg1.l2.m1.1.1.1.cmml" xref="alg1.l2.m1.1.1">superscript</csymbol><ci id="alg1.l2.m1.1.1.2.cmml" xref="alg1.l2.m1.1.1.2">𝐷</ci><ci id="alg1.l2.m1.1.1.3.cmml" xref="alg1.l2.m1.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m1.1c">D^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m1.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math> (specialist set), <math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="alg1.l2.m2.1"><semantics id="alg1.l2.m2.1a"><msup id="alg1.l2.m2.1.1" xref="alg1.l2.m2.1.1.cmml"><mi id="alg1.l2.m2.1.1.2" xref="alg1.l2.m2.1.1.2.cmml">D</mi><mi id="alg1.l2.m2.1.1.3" mathvariant="normal" xref="alg1.l2.m2.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="alg1.l2.m2.1b"><apply id="alg1.l2.m2.1.1.cmml" xref="alg1.l2.m2.1.1"><csymbol cd="ambiguous" id="alg1.l2.m2.1.1.1.cmml" xref="alg1.l2.m2.1.1">superscript</csymbol><ci id="alg1.l2.m2.1.1.2.cmml" xref="alg1.l2.m2.1.1.2">𝐷</ci><ci id="alg1.l2.m2.1.1.3.cmml" xref="alg1.l2.m2.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l2.m2.1c">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="alg1.l2.m2.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> (generalist set)

</div>
<div class="ltx_listingline" id="alg1.l3">
<span class="ltx_tag ltx_tag_listingline">3:</span><math alttext="h^{\rm s}\leftarrow\{P(c|{D}^{\rm s}),\forall c\}" class="ltx_Math" display="inline" id="alg1.l3.m1.2"><semantics id="alg1.l3.m1.2a"><mrow id="alg1.l3.m1.2.2" xref="alg1.l3.m1.2.2.cmml"><msup id="alg1.l3.m1.2.2.4" xref="alg1.l3.m1.2.2.4.cmml"><mi id="alg1.l3.m1.2.2.4.2" xref="alg1.l3.m1.2.2.4.2.cmml">h</mi><mi id="alg1.l3.m1.2.2.4.3" mathvariant="normal" xref="alg1.l3.m1.2.2.4.3.cmml">s</mi></msup><mo id="alg1.l3.m1.2.2.3" stretchy="false" xref="alg1.l3.m1.2.2.3.cmml">←</mo><mrow id="alg1.l3.m1.2.2.2.2" xref="alg1.l3.m1.2.2.2.3.cmml"><mo id="alg1.l3.m1.2.2.2.2.3" stretchy="false" xref="alg1.l3.m1.2.2.2.3.cmml">{</mo><mrow id="alg1.l3.m1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.cmml"><mi id="alg1.l3.m1.1.1.1.1.1.3" xref="alg1.l3.m1.1.1.1.1.1.3.cmml">P</mi><mo id="alg1.l3.m1.1.1.1.1.1.2" xref="alg1.l3.m1.1.1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l3.m1.1.1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.cmml"><mo id="alg1.l3.m1.1.1.1.1.1.1.1.2" stretchy="false" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.cmml">(</mo><mrow id="alg1.l3.m1.1.1.1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.cmml"><mi id="alg1.l3.m1.1.1.1.1.1.1.1.1.2" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.2.cmml">c</mi><mo fence="false" id="alg1.l3.m1.1.1.1.1.1.1.1.1.1" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1.cmml">|</mo><msup id="alg1.l3.m1.1.1.1.1.1.1.1.1.3" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.3.cmml"><mi id="alg1.l3.m1.1.1.1.1.1.1.1.1.3.2" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.3.2.cmml">D</mi><mi id="alg1.l3.m1.1.1.1.1.1.1.1.1.3.3" mathvariant="normal" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="alg1.l3.m1.1.1.1.1.1.1.1.3" stretchy="false" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="alg1.l3.m1.2.2.2.2.4" xref="alg1.l3.m1.2.2.2.3.cmml">,</mo><mrow id="alg1.l3.m1.2.2.2.2.2" xref="alg1.l3.m1.2.2.2.2.2.cmml"><mo id="alg1.l3.m1.2.2.2.2.2.1" rspace="0.167em" xref="alg1.l3.m1.2.2.2.2.2.1.cmml">∀</mo><mi id="alg1.l3.m1.2.2.2.2.2.2" xref="alg1.l3.m1.2.2.2.2.2.2.cmml">c</mi></mrow><mo id="alg1.l3.m1.2.2.2.2.5" stretchy="false" xref="alg1.l3.m1.2.2.2.3.cmml">}</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l3.m1.2b"><apply id="alg1.l3.m1.2.2.cmml" xref="alg1.l3.m1.2.2"><ci id="alg1.l3.m1.2.2.3.cmml" xref="alg1.l3.m1.2.2.3">←</ci><apply id="alg1.l3.m1.2.2.4.cmml" xref="alg1.l3.m1.2.2.4"><csymbol cd="ambiguous" id="alg1.l3.m1.2.2.4.1.cmml" xref="alg1.l3.m1.2.2.4">superscript</csymbol><ci id="alg1.l3.m1.2.2.4.2.cmml" xref="alg1.l3.m1.2.2.4.2">ℎ</ci><ci id="alg1.l3.m1.2.2.4.3.cmml" xref="alg1.l3.m1.2.2.4.3">s</ci></apply><set id="alg1.l3.m1.2.2.2.3.cmml" xref="alg1.l3.m1.2.2.2.2"><apply id="alg1.l3.m1.1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1.1"><times id="alg1.l3.m1.1.1.1.1.1.2.cmml" xref="alg1.l3.m1.1.1.1.1.1.2"></times><ci id="alg1.l3.m1.1.1.1.1.1.3.cmml" xref="alg1.l3.m1.1.1.1.1.1.3">𝑃</ci><apply id="alg1.l3.m1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1"><csymbol cd="latexml" id="alg1.l3.m1.1.1.1.1.1.1.1.1.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.1">conditional</csymbol><ci id="alg1.l3.m1.1.1.1.1.1.1.1.1.2.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.2">𝑐</ci><apply id="alg1.l3.m1.1.1.1.1.1.1.1.1.3.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="alg1.l3.m1.1.1.1.1.1.1.1.1.3.1.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.3">superscript</csymbol><ci id="alg1.l3.m1.1.1.1.1.1.1.1.1.3.2.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.3.2">𝐷</ci><ci id="alg1.l3.m1.1.1.1.1.1.1.1.1.3.3.cmml" xref="alg1.l3.m1.1.1.1.1.1.1.1.1.3.3">s</ci></apply></apply></apply><apply id="alg1.l3.m1.2.2.2.2.2.cmml" xref="alg1.l3.m1.2.2.2.2.2"><csymbol cd="latexml" id="alg1.l3.m1.2.2.2.2.2.1.cmml" xref="alg1.l3.m1.2.2.2.2.2.1">for-all</csymbol><ci id="alg1.l3.m1.2.2.2.2.2.2.cmml" xref="alg1.l3.m1.2.2.2.2.2.2">𝑐</ci></apply></set></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.m1.2c">h^{\rm s}\leftarrow\{P(c|{D}^{\rm s}),\forall c\}</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.m1.2d">italic_h start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ← { italic_P ( italic_c | italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) , ∀ italic_c }</annotation></semantics></math> <span class="ltx_text" id="alg1.l3.2" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l3.1.m1.1"><semantics id="alg1.l3.1.m1.1a"><mo id="alg1.l3.1.m1.1.1" xref="alg1.l3.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l3.1.m1.1b"><ci id="alg1.l3.1.m1.1.1.cmml" xref="alg1.l3.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.1.m1.1d">▷</annotation></semantics></math> Count cluster frequency on the specialist set <math alttext="D^{\rm s}" class="ltx_Math" display="inline" id="alg1.l3.2.m2.1"><semantics id="alg1.l3.2.m2.1a"><msup id="alg1.l3.2.m2.1.1" xref="alg1.l3.2.m2.1.1.cmml"><mi id="alg1.l3.2.m2.1.1.2" xref="alg1.l3.2.m2.1.1.2.cmml">D</mi><mi id="alg1.l3.2.m2.1.1.3" mathvariant="normal" xref="alg1.l3.2.m2.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="alg1.l3.2.m2.1b"><apply id="alg1.l3.2.m2.1.1.cmml" xref="alg1.l3.2.m2.1.1"><csymbol cd="ambiguous" id="alg1.l3.2.m2.1.1.1.cmml" xref="alg1.l3.2.m2.1.1">superscript</csymbol><ci id="alg1.l3.2.m2.1.1.2.cmml" xref="alg1.l3.2.m2.1.1.2">𝐷</ci><ci id="alg1.l3.2.m2.1.1.3.cmml" xref="alg1.l3.2.m2.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l3.2.m2.1c">D^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="alg1.l3.2.m2.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>.
</span>
</div>
<div class="ltx_listingline" id="alg1.l4">
<span class="ltx_tag ltx_tag_listingline">4:</span><math alttext="\theta_{0}\leftarrow{\rm InitModel}()" class="ltx_Math" display="inline" id="alg1.l4.m1.1"><semantics id="alg1.l4.m1.1a"><mrow id="alg1.l4.m1.1.1" xref="alg1.l4.m1.1.1.cmml"><msub id="alg1.l4.m1.1.1.2" xref="alg1.l4.m1.1.1.2.cmml"><mi id="alg1.l4.m1.1.1.2.2" xref="alg1.l4.m1.1.1.2.2.cmml">θ</mi><mn id="alg1.l4.m1.1.1.2.3" xref="alg1.l4.m1.1.1.2.3.cmml">0</mn></msub><mo id="alg1.l4.m1.1.1.1" stretchy="false" xref="alg1.l4.m1.1.1.1.cmml">←</mo><mrow id="alg1.l4.m1.1.1.3" xref="alg1.l4.m1.1.1.3.cmml"><mi id="alg1.l4.m1.1.1.3.2" xref="alg1.l4.m1.1.1.3.2.cmml">InitModel</mi><mo id="alg1.l4.m1.1.1.3.1" xref="alg1.l4.m1.1.1.3.1.cmml">⁢</mo><mrow id="alg1.l4.m1.1.1.3.3.2" xref="alg1.l4.m1.1.1.3.cmml"><mo id="alg1.l4.m1.1.1.3.3.2.1" stretchy="false" xref="alg1.l4.m1.1.1.3.3.1.cmml">(</mo><mo id="alg1.l4.m1.1.1.3.3.2.2" stretchy="false" xref="alg1.l4.m1.1.1.3.3.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l4.m1.1b"><apply id="alg1.l4.m1.1.1.cmml" xref="alg1.l4.m1.1.1"><ci id="alg1.l4.m1.1.1.1.cmml" xref="alg1.l4.m1.1.1.1">←</ci><apply id="alg1.l4.m1.1.1.2.cmml" xref="alg1.l4.m1.1.1.2"><csymbol cd="ambiguous" id="alg1.l4.m1.1.1.2.1.cmml" xref="alg1.l4.m1.1.1.2">subscript</csymbol><ci id="alg1.l4.m1.1.1.2.2.cmml" xref="alg1.l4.m1.1.1.2.2">𝜃</ci><cn id="alg1.l4.m1.1.1.2.3.cmml" type="integer" xref="alg1.l4.m1.1.1.2.3">0</cn></apply><apply id="alg1.l4.m1.1.1.3.cmml" xref="alg1.l4.m1.1.1.3"><times id="alg1.l4.m1.1.1.3.1.cmml" xref="alg1.l4.m1.1.1.3.1"></times><ci id="alg1.l4.m1.1.1.3.2.cmml" xref="alg1.l4.m1.1.1.3.2">InitModel</ci><list id="alg1.l4.m1.1.1.3.3.1.cmml" xref="alg1.l4.m1.1.1.3.3.2.1"></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.m1.1c">\theta_{0}\leftarrow{\rm InitModel}()</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.m1.1d">italic_θ start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT ← roman_InitModel ( )</annotation></semantics></math> <span class="ltx_text" id="alg1.l4.1" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l4.1.m1.1"><semantics id="alg1.l4.1.m1.1a"><mo id="alg1.l4.1.m1.1.1" xref="alg1.l4.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l4.1.m1.1b"><ci id="alg1.l4.1.m1.1.1.cmml" xref="alg1.l4.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l4.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l4.1.m1.1d">▷</annotation></semantics></math> Initialize the model.
</span>
</div>
<div class="ltx_listingline" id="alg1.l5">
<span class="ltx_tag ltx_tag_listingline">5:</span><span class="ltx_text ltx_font_bold" id="alg1.l5.1">for</span> <math alttext="t=1,\ldots,T" class="ltx_Math" display="inline" id="alg1.l5.m1.3"><semantics id="alg1.l5.m1.3a"><mrow id="alg1.l5.m1.3.4" xref="alg1.l5.m1.3.4.cmml"><mi id="alg1.l5.m1.3.4.2" xref="alg1.l5.m1.3.4.2.cmml">t</mi><mo id="alg1.l5.m1.3.4.1" xref="alg1.l5.m1.3.4.1.cmml">=</mo><mrow id="alg1.l5.m1.3.4.3.2" xref="alg1.l5.m1.3.4.3.1.cmml"><mn id="alg1.l5.m1.1.1" xref="alg1.l5.m1.1.1.cmml">1</mn><mo id="alg1.l5.m1.3.4.3.2.1" xref="alg1.l5.m1.3.4.3.1.cmml">,</mo><mi id="alg1.l5.m1.2.2" mathvariant="normal" xref="alg1.l5.m1.2.2.cmml">…</mi><mo id="alg1.l5.m1.3.4.3.2.2" xref="alg1.l5.m1.3.4.3.1.cmml">,</mo><mi id="alg1.l5.m1.3.3" xref="alg1.l5.m1.3.3.cmml">T</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l5.m1.3b"><apply id="alg1.l5.m1.3.4.cmml" xref="alg1.l5.m1.3.4"><eq id="alg1.l5.m1.3.4.1.cmml" xref="alg1.l5.m1.3.4.1"></eq><ci id="alg1.l5.m1.3.4.2.cmml" xref="alg1.l5.m1.3.4.2">𝑡</ci><list id="alg1.l5.m1.3.4.3.1.cmml" xref="alg1.l5.m1.3.4.3.2"><cn id="alg1.l5.m1.1.1.cmml" type="integer" xref="alg1.l5.m1.1.1">1</cn><ci id="alg1.l5.m1.2.2.cmml" xref="alg1.l5.m1.2.2">…</ci><ci id="alg1.l5.m1.3.3.cmml" xref="alg1.l5.m1.3.3">𝑇</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l5.m1.3c">t=1,\ldots,T</annotation><annotation encoding="application/x-llamapun" id="alg1.l5.m1.3d">italic_t = 1 , … , italic_T</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg1.l5.2">do</span>
</div>
<div class="ltx_listingline" id="alg1.l6">
<span class="ltx_tag ltx_tag_listingline">6:</span>     <span class="ltx_text ltx_font_bold" id="alg1.l6.1">for</span> <math alttext="i=1,\ldots,B" class="ltx_Math" display="inline" id="alg1.l6.m1.3"><semantics id="alg1.l6.m1.3a"><mrow id="alg1.l6.m1.3.4" xref="alg1.l6.m1.3.4.cmml"><mi id="alg1.l6.m1.3.4.2" xref="alg1.l6.m1.3.4.2.cmml">i</mi><mo id="alg1.l6.m1.3.4.1" xref="alg1.l6.m1.3.4.1.cmml">=</mo><mrow id="alg1.l6.m1.3.4.3.2" xref="alg1.l6.m1.3.4.3.1.cmml"><mn id="alg1.l6.m1.1.1" xref="alg1.l6.m1.1.1.cmml">1</mn><mo id="alg1.l6.m1.3.4.3.2.1" xref="alg1.l6.m1.3.4.3.1.cmml">,</mo><mi id="alg1.l6.m1.2.2" mathvariant="normal" xref="alg1.l6.m1.2.2.cmml">…</mi><mo id="alg1.l6.m1.3.4.3.2.2" xref="alg1.l6.m1.3.4.3.1.cmml">,</mo><mi id="alg1.l6.m1.3.3" xref="alg1.l6.m1.3.3.cmml">B</mi></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l6.m1.3b"><apply id="alg1.l6.m1.3.4.cmml" xref="alg1.l6.m1.3.4"><eq id="alg1.l6.m1.3.4.1.cmml" xref="alg1.l6.m1.3.4.1"></eq><ci id="alg1.l6.m1.3.4.2.cmml" xref="alg1.l6.m1.3.4.2">𝑖</ci><list id="alg1.l6.m1.3.4.3.1.cmml" xref="alg1.l6.m1.3.4.3.2"><cn id="alg1.l6.m1.1.1.cmml" type="integer" xref="alg1.l6.m1.1.1">1</cn><ci id="alg1.l6.m1.2.2.cmml" xref="alg1.l6.m1.2.2">…</ci><ci id="alg1.l6.m1.3.3.cmml" xref="alg1.l6.m1.3.3">𝐵</ci></list></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l6.m1.3c">i=1,\ldots,B</annotation><annotation encoding="application/x-llamapun" id="alg1.l6.m1.3d">italic_i = 1 , … , italic_B</annotation></semantics></math> <span class="ltx_text ltx_font_bold" id="alg1.l6.2">do</span>
</div>
<div class="ltx_listingline" id="alg1.l7">
<span class="ltx_tag ltx_tag_listingline">7:</span>         <math alttext="c_{i}\sim{\rm Categorical}(h^{\rm s})" class="ltx_Math" display="inline" id="alg1.l7.m1.1"><semantics id="alg1.l7.m1.1a"><mrow id="alg1.l7.m1.1.1" xref="alg1.l7.m1.1.1.cmml"><msub id="alg1.l7.m1.1.1.3" xref="alg1.l7.m1.1.1.3.cmml"><mi id="alg1.l7.m1.1.1.3.2" xref="alg1.l7.m1.1.1.3.2.cmml">c</mi><mi id="alg1.l7.m1.1.1.3.3" xref="alg1.l7.m1.1.1.3.3.cmml">i</mi></msub><mo id="alg1.l7.m1.1.1.2" xref="alg1.l7.m1.1.1.2.cmml">∼</mo><mrow id="alg1.l7.m1.1.1.1" xref="alg1.l7.m1.1.1.1.cmml"><mi id="alg1.l7.m1.1.1.1.3" xref="alg1.l7.m1.1.1.1.3.cmml">Categorical</mi><mo id="alg1.l7.m1.1.1.1.2" xref="alg1.l7.m1.1.1.1.2.cmml">⁢</mo><mrow id="alg1.l7.m1.1.1.1.1.1" xref="alg1.l7.m1.1.1.1.1.1.1.cmml"><mo id="alg1.l7.m1.1.1.1.1.1.2" stretchy="false" xref="alg1.l7.m1.1.1.1.1.1.1.cmml">(</mo><msup id="alg1.l7.m1.1.1.1.1.1.1" xref="alg1.l7.m1.1.1.1.1.1.1.cmml"><mi id="alg1.l7.m1.1.1.1.1.1.1.2" xref="alg1.l7.m1.1.1.1.1.1.1.2.cmml">h</mi><mi id="alg1.l7.m1.1.1.1.1.1.1.3" mathvariant="normal" xref="alg1.l7.m1.1.1.1.1.1.1.3.cmml">s</mi></msup><mo id="alg1.l7.m1.1.1.1.1.1.3" stretchy="false" xref="alg1.l7.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l7.m1.1b"><apply id="alg1.l7.m1.1.1.cmml" xref="alg1.l7.m1.1.1"><csymbol cd="latexml" id="alg1.l7.m1.1.1.2.cmml" xref="alg1.l7.m1.1.1.2">similar-to</csymbol><apply id="alg1.l7.m1.1.1.3.cmml" xref="alg1.l7.m1.1.1.3"><csymbol cd="ambiguous" id="alg1.l7.m1.1.1.3.1.cmml" xref="alg1.l7.m1.1.1.3">subscript</csymbol><ci id="alg1.l7.m1.1.1.3.2.cmml" xref="alg1.l7.m1.1.1.3.2">𝑐</ci><ci id="alg1.l7.m1.1.1.3.3.cmml" xref="alg1.l7.m1.1.1.3.3">𝑖</ci></apply><apply id="alg1.l7.m1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1"><times id="alg1.l7.m1.1.1.1.2.cmml" xref="alg1.l7.m1.1.1.1.2"></times><ci id="alg1.l7.m1.1.1.1.3.cmml" xref="alg1.l7.m1.1.1.1.3">Categorical</ci><apply id="alg1.l7.m1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l7.m1.1.1.1.1.1.1.1.cmml" xref="alg1.l7.m1.1.1.1.1.1">superscript</csymbol><ci id="alg1.l7.m1.1.1.1.1.1.1.2.cmml" xref="alg1.l7.m1.1.1.1.1.1.1.2">ℎ</ci><ci id="alg1.l7.m1.1.1.1.1.1.1.3.cmml" xref="alg1.l7.m1.1.1.1.1.1.1.3">s</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.m1.1c">c_{i}\sim{\rm Categorical}(h^{\rm s})</annotation><annotation encoding="application/x-llamapun" id="alg1.l7.m1.1d">italic_c start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∼ roman_Categorical ( italic_h start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT )</annotation></semantics></math> <span class="ltx_text" id="alg1.l7.1" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l7.1.m1.1"><semantics id="alg1.l7.1.m1.1a"><mo id="alg1.l7.1.m1.1.1" xref="alg1.l7.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l7.1.m1.1b"><ci id="alg1.l7.1.m1.1.1.cmml" xref="alg1.l7.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l7.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l7.1.m1.1d">▷</annotation></semantics></math> Sample a cluster id from the specialist histogram.
</span>
</div>
<div class="ltx_listingline" id="alg1.l8">
<span class="ltx_tag ltx_tag_listingline">8:</span>         <math alttext="x_{i}\sim{\rm Uniform}({D}^{\rm s}\cap K(c))" class="ltx_Math" display="inline" id="alg1.l8.m1.2"><semantics id="alg1.l8.m1.2a"><mrow id="alg1.l8.m1.2.2" xref="alg1.l8.m1.2.2.cmml"><msub id="alg1.l8.m1.2.2.3" xref="alg1.l8.m1.2.2.3.cmml"><mi id="alg1.l8.m1.2.2.3.2" xref="alg1.l8.m1.2.2.3.2.cmml">x</mi><mi id="alg1.l8.m1.2.2.3.3" xref="alg1.l8.m1.2.2.3.3.cmml">i</mi></msub><mo id="alg1.l8.m1.2.2.2" xref="alg1.l8.m1.2.2.2.cmml">∼</mo><mrow id="alg1.l8.m1.2.2.1" xref="alg1.l8.m1.2.2.1.cmml"><mi id="alg1.l8.m1.2.2.1.3" xref="alg1.l8.m1.2.2.1.3.cmml">Uniform</mi><mo id="alg1.l8.m1.2.2.1.2" xref="alg1.l8.m1.2.2.1.2.cmml">⁢</mo><mrow id="alg1.l8.m1.2.2.1.1.1" xref="alg1.l8.m1.2.2.1.1.1.1.cmml"><mo id="alg1.l8.m1.2.2.1.1.1.2" stretchy="false" xref="alg1.l8.m1.2.2.1.1.1.1.cmml">(</mo><mrow id="alg1.l8.m1.2.2.1.1.1.1" xref="alg1.l8.m1.2.2.1.1.1.1.cmml"><msup id="alg1.l8.m1.2.2.1.1.1.1.2" xref="alg1.l8.m1.2.2.1.1.1.1.2.cmml"><mi id="alg1.l8.m1.2.2.1.1.1.1.2.2" xref="alg1.l8.m1.2.2.1.1.1.1.2.2.cmml">D</mi><mi id="alg1.l8.m1.2.2.1.1.1.1.2.3" mathvariant="normal" xref="alg1.l8.m1.2.2.1.1.1.1.2.3.cmml">s</mi></msup><mo id="alg1.l8.m1.2.2.1.1.1.1.1" xref="alg1.l8.m1.2.2.1.1.1.1.1.cmml">∩</mo><mrow id="alg1.l8.m1.2.2.1.1.1.1.3" xref="alg1.l8.m1.2.2.1.1.1.1.3.cmml"><mi id="alg1.l8.m1.2.2.1.1.1.1.3.2" xref="alg1.l8.m1.2.2.1.1.1.1.3.2.cmml">K</mi><mo id="alg1.l8.m1.2.2.1.1.1.1.3.1" xref="alg1.l8.m1.2.2.1.1.1.1.3.1.cmml">⁢</mo><mrow id="alg1.l8.m1.2.2.1.1.1.1.3.3.2" xref="alg1.l8.m1.2.2.1.1.1.1.3.cmml"><mo id="alg1.l8.m1.2.2.1.1.1.1.3.3.2.1" stretchy="false" xref="alg1.l8.m1.2.2.1.1.1.1.3.cmml">(</mo><mi id="alg1.l8.m1.1.1" xref="alg1.l8.m1.1.1.cmml">c</mi><mo id="alg1.l8.m1.2.2.1.1.1.1.3.3.2.2" stretchy="false" xref="alg1.l8.m1.2.2.1.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="alg1.l8.m1.2.2.1.1.1.3" stretchy="false" xref="alg1.l8.m1.2.2.1.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l8.m1.2b"><apply id="alg1.l8.m1.2.2.cmml" xref="alg1.l8.m1.2.2"><csymbol cd="latexml" id="alg1.l8.m1.2.2.2.cmml" xref="alg1.l8.m1.2.2.2">similar-to</csymbol><apply id="alg1.l8.m1.2.2.3.cmml" xref="alg1.l8.m1.2.2.3"><csymbol cd="ambiguous" id="alg1.l8.m1.2.2.3.1.cmml" xref="alg1.l8.m1.2.2.3">subscript</csymbol><ci id="alg1.l8.m1.2.2.3.2.cmml" xref="alg1.l8.m1.2.2.3.2">𝑥</ci><ci id="alg1.l8.m1.2.2.3.3.cmml" xref="alg1.l8.m1.2.2.3.3">𝑖</ci></apply><apply id="alg1.l8.m1.2.2.1.cmml" xref="alg1.l8.m1.2.2.1"><times id="alg1.l8.m1.2.2.1.2.cmml" xref="alg1.l8.m1.2.2.1.2"></times><ci id="alg1.l8.m1.2.2.1.3.cmml" xref="alg1.l8.m1.2.2.1.3">Uniform</ci><apply id="alg1.l8.m1.2.2.1.1.1.1.cmml" xref="alg1.l8.m1.2.2.1.1.1"><intersect id="alg1.l8.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l8.m1.2.2.1.1.1.1.1"></intersect><apply id="alg1.l8.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l8.m1.2.2.1.1.1.1.2"><csymbol cd="ambiguous" id="alg1.l8.m1.2.2.1.1.1.1.2.1.cmml" xref="alg1.l8.m1.2.2.1.1.1.1.2">superscript</csymbol><ci id="alg1.l8.m1.2.2.1.1.1.1.2.2.cmml" xref="alg1.l8.m1.2.2.1.1.1.1.2.2">𝐷</ci><ci id="alg1.l8.m1.2.2.1.1.1.1.2.3.cmml" xref="alg1.l8.m1.2.2.1.1.1.1.2.3">s</ci></apply><apply id="alg1.l8.m1.2.2.1.1.1.1.3.cmml" xref="alg1.l8.m1.2.2.1.1.1.1.3"><times id="alg1.l8.m1.2.2.1.1.1.1.3.1.cmml" xref="alg1.l8.m1.2.2.1.1.1.1.3.1"></times><ci id="alg1.l8.m1.2.2.1.1.1.1.3.2.cmml" xref="alg1.l8.m1.2.2.1.1.1.1.3.2">𝐾</ci><ci id="alg1.l8.m1.1.1.cmml" xref="alg1.l8.m1.1.1">𝑐</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l8.m1.2c">x_{i}\sim{\rm Uniform}({D}^{\rm s}\cap K(c))</annotation><annotation encoding="application/x-llamapun" id="alg1.l8.m1.2d">italic_x start_POSTSUBSCRIPT italic_i end_POSTSUBSCRIPT ∼ roman_Uniform ( italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ∩ italic_K ( italic_c ) )</annotation></semantics></math> <span class="ltx_text" id="alg1.l8.1" style="float:right;"><math alttext="\triangleright" class="ltx_Math" display="inline" id="alg1.l8.1.m1.1"><semantics id="alg1.l8.1.m1.1a"><mo id="alg1.l8.1.m1.1.1" xref="alg1.l8.1.m1.1.1.cmml">▷</mo><annotation-xml encoding="MathML-Content" id="alg1.l8.1.m1.1b"><ci id="alg1.l8.1.m1.1.1.cmml" xref="alg1.l8.1.m1.1.1">▷</ci></annotation-xml><annotation encoding="application/x-tex" id="alg1.l8.1.m1.1c">\triangleright</annotation><annotation encoding="application/x-llamapun" id="alg1.l8.1.m1.1d">▷</annotation></semantics></math> Sample a generalist example in the selected cluster.
</span>
</div>
<div class="ltx_listingline" id="alg1.l9">
<span class="ltx_tag ltx_tag_listingline">9:</span>     <span class="ltx_text ltx_font_bold" id="alg1.l9.1">end</span> <span class="ltx_text ltx_font_bold" id="alg1.l9.2">for</span>
</div>
<div class="ltx_listingline" id="alg1.l10">
<span class="ltx_tag ltx_tag_listingline">10:</span>     <math alttext="\theta_{t}\leftarrow{\rm AdamUpdate}(\theta_{t-1},\{x_{0},\ldots,x_{B}\})" class="ltx_Math" display="inline" id="alg1.l10.m1.3"><semantics id="alg1.l10.m1.3a"><mrow id="alg1.l10.m1.3.3" xref="alg1.l10.m1.3.3.cmml"><msub id="alg1.l10.m1.3.3.4" xref="alg1.l10.m1.3.3.4.cmml"><mi id="alg1.l10.m1.3.3.4.2" xref="alg1.l10.m1.3.3.4.2.cmml">θ</mi><mi id="alg1.l10.m1.3.3.4.3" xref="alg1.l10.m1.3.3.4.3.cmml">t</mi></msub><mo id="alg1.l10.m1.3.3.3" stretchy="false" xref="alg1.l10.m1.3.3.3.cmml">←</mo><mrow id="alg1.l10.m1.3.3.2" xref="alg1.l10.m1.3.3.2.cmml"><mi id="alg1.l10.m1.3.3.2.4" xref="alg1.l10.m1.3.3.2.4.cmml">AdamUpdate</mi><mo id="alg1.l10.m1.3.3.2.3" xref="alg1.l10.m1.3.3.2.3.cmml">⁢</mo><mrow id="alg1.l10.m1.3.3.2.2.2" xref="alg1.l10.m1.3.3.2.2.3.cmml"><mo id="alg1.l10.m1.3.3.2.2.2.3" stretchy="false" xref="alg1.l10.m1.3.3.2.2.3.cmml">(</mo><msub id="alg1.l10.m1.2.2.1.1.1.1" xref="alg1.l10.m1.2.2.1.1.1.1.cmml"><mi id="alg1.l10.m1.2.2.1.1.1.1.2" xref="alg1.l10.m1.2.2.1.1.1.1.2.cmml">θ</mi><mrow id="alg1.l10.m1.2.2.1.1.1.1.3" xref="alg1.l10.m1.2.2.1.1.1.1.3.cmml"><mi id="alg1.l10.m1.2.2.1.1.1.1.3.2" xref="alg1.l10.m1.2.2.1.1.1.1.3.2.cmml">t</mi><mo id="alg1.l10.m1.2.2.1.1.1.1.3.1" xref="alg1.l10.m1.2.2.1.1.1.1.3.1.cmml">−</mo><mn id="alg1.l10.m1.2.2.1.1.1.1.3.3" xref="alg1.l10.m1.2.2.1.1.1.1.3.3.cmml">1</mn></mrow></msub><mo id="alg1.l10.m1.3.3.2.2.2.4" xref="alg1.l10.m1.3.3.2.2.3.cmml">,</mo><mrow id="alg1.l10.m1.3.3.2.2.2.2.2" xref="alg1.l10.m1.3.3.2.2.2.2.3.cmml"><mo id="alg1.l10.m1.3.3.2.2.2.2.2.3" stretchy="false" xref="alg1.l10.m1.3.3.2.2.2.2.3.cmml">{</mo><msub id="alg1.l10.m1.3.3.2.2.2.2.1.1" xref="alg1.l10.m1.3.3.2.2.2.2.1.1.cmml"><mi id="alg1.l10.m1.3.3.2.2.2.2.1.1.2" xref="alg1.l10.m1.3.3.2.2.2.2.1.1.2.cmml">x</mi><mn id="alg1.l10.m1.3.3.2.2.2.2.1.1.3" xref="alg1.l10.m1.3.3.2.2.2.2.1.1.3.cmml">0</mn></msub><mo id="alg1.l10.m1.3.3.2.2.2.2.2.4" xref="alg1.l10.m1.3.3.2.2.2.2.3.cmml">,</mo><mi id="alg1.l10.m1.1.1" mathvariant="normal" xref="alg1.l10.m1.1.1.cmml">…</mi><mo id="alg1.l10.m1.3.3.2.2.2.2.2.5" xref="alg1.l10.m1.3.3.2.2.2.2.3.cmml">,</mo><msub id="alg1.l10.m1.3.3.2.2.2.2.2.2" xref="alg1.l10.m1.3.3.2.2.2.2.2.2.cmml"><mi id="alg1.l10.m1.3.3.2.2.2.2.2.2.2" xref="alg1.l10.m1.3.3.2.2.2.2.2.2.2.cmml">x</mi><mi id="alg1.l10.m1.3.3.2.2.2.2.2.2.3" xref="alg1.l10.m1.3.3.2.2.2.2.2.2.3.cmml">B</mi></msub><mo id="alg1.l10.m1.3.3.2.2.2.2.2.6" stretchy="false" xref="alg1.l10.m1.3.3.2.2.2.2.3.cmml">}</mo></mrow><mo id="alg1.l10.m1.3.3.2.2.2.5" stretchy="false" xref="alg1.l10.m1.3.3.2.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="alg1.l10.m1.3b"><apply id="alg1.l10.m1.3.3.cmml" xref="alg1.l10.m1.3.3"><ci id="alg1.l10.m1.3.3.3.cmml" xref="alg1.l10.m1.3.3.3">←</ci><apply id="alg1.l10.m1.3.3.4.cmml" xref="alg1.l10.m1.3.3.4"><csymbol cd="ambiguous" id="alg1.l10.m1.3.3.4.1.cmml" xref="alg1.l10.m1.3.3.4">subscript</csymbol><ci id="alg1.l10.m1.3.3.4.2.cmml" xref="alg1.l10.m1.3.3.4.2">𝜃</ci><ci id="alg1.l10.m1.3.3.4.3.cmml" xref="alg1.l10.m1.3.3.4.3">𝑡</ci></apply><apply id="alg1.l10.m1.3.3.2.cmml" xref="alg1.l10.m1.3.3.2"><times id="alg1.l10.m1.3.3.2.3.cmml" xref="alg1.l10.m1.3.3.2.3"></times><ci id="alg1.l10.m1.3.3.2.4.cmml" xref="alg1.l10.m1.3.3.2.4">AdamUpdate</ci><interval closure="open" id="alg1.l10.m1.3.3.2.2.3.cmml" xref="alg1.l10.m1.3.3.2.2.2"><apply id="alg1.l10.m1.2.2.1.1.1.1.cmml" xref="alg1.l10.m1.2.2.1.1.1.1"><csymbol cd="ambiguous" id="alg1.l10.m1.2.2.1.1.1.1.1.cmml" xref="alg1.l10.m1.2.2.1.1.1.1">subscript</csymbol><ci id="alg1.l10.m1.2.2.1.1.1.1.2.cmml" xref="alg1.l10.m1.2.2.1.1.1.1.2">𝜃</ci><apply id="alg1.l10.m1.2.2.1.1.1.1.3.cmml" xref="alg1.l10.m1.2.2.1.1.1.1.3"><minus id="alg1.l10.m1.2.2.1.1.1.1.3.1.cmml" xref="alg1.l10.m1.2.2.1.1.1.1.3.1"></minus><ci id="alg1.l10.m1.2.2.1.1.1.1.3.2.cmml" xref="alg1.l10.m1.2.2.1.1.1.1.3.2">𝑡</ci><cn id="alg1.l10.m1.2.2.1.1.1.1.3.3.cmml" type="integer" xref="alg1.l10.m1.2.2.1.1.1.1.3.3">1</cn></apply></apply><set id="alg1.l10.m1.3.3.2.2.2.2.3.cmml" xref="alg1.l10.m1.3.3.2.2.2.2.2"><apply id="alg1.l10.m1.3.3.2.2.2.2.1.1.cmml" xref="alg1.l10.m1.3.3.2.2.2.2.1.1"><csymbol cd="ambiguous" id="alg1.l10.m1.3.3.2.2.2.2.1.1.1.cmml" xref="alg1.l10.m1.3.3.2.2.2.2.1.1">subscript</csymbol><ci id="alg1.l10.m1.3.3.2.2.2.2.1.1.2.cmml" xref="alg1.l10.m1.3.3.2.2.2.2.1.1.2">𝑥</ci><cn id="alg1.l10.m1.3.3.2.2.2.2.1.1.3.cmml" type="integer" xref="alg1.l10.m1.3.3.2.2.2.2.1.1.3">0</cn></apply><ci id="alg1.l10.m1.1.1.cmml" xref="alg1.l10.m1.1.1">…</ci><apply id="alg1.l10.m1.3.3.2.2.2.2.2.2.cmml" xref="alg1.l10.m1.3.3.2.2.2.2.2.2"><csymbol cd="ambiguous" id="alg1.l10.m1.3.3.2.2.2.2.2.2.1.cmml" xref="alg1.l10.m1.3.3.2.2.2.2.2.2">subscript</csymbol><ci id="alg1.l10.m1.3.3.2.2.2.2.2.2.2.cmml" xref="alg1.l10.m1.3.3.2.2.2.2.2.2.2">𝑥</ci><ci id="alg1.l10.m1.3.3.2.2.2.2.2.2.3.cmml" xref="alg1.l10.m1.3.3.2.2.2.2.2.2.3">𝐵</ci></apply></set></interval></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="alg1.l10.m1.3c">\theta_{t}\leftarrow{\rm AdamUpdate}(\theta_{t-1},\{x_{0},\ldots,x_{B}\})</annotation><annotation encoding="application/x-llamapun" id="alg1.l10.m1.3d">italic_θ start_POSTSUBSCRIPT italic_t end_POSTSUBSCRIPT ← roman_AdamUpdate ( italic_θ start_POSTSUBSCRIPT italic_t - 1 end_POSTSUBSCRIPT , { italic_x start_POSTSUBSCRIPT 0 end_POSTSUBSCRIPT , … , italic_x start_POSTSUBSCRIPT italic_B end_POSTSUBSCRIPT } )</annotation></semantics></math>
</div>
<div class="ltx_listingline" id="alg1.l11">
<span class="ltx_tag ltx_tag_listingline">11:</span><span class="ltx_text ltx_font_bold" id="alg1.l11.1">end</span> <span class="ltx_text ltx_font_bold" id="alg1.l11.2">for</span>
</div>
</div>
</figure>
</section>
</section>
<section class="ltx_section" id="S4">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">4 </span>Experiments &amp; Results</h2>
<div class="ltx_para ltx_noindent" id="S4.p1">
<p class="ltx_p" id="S4.p1.1">We perform experiments with transformer LMs <cite class="ltx_cite ltx_citemacro_citep">(Vaswani et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib61" title="">2017</a>)</cite>. Most of our experiments use models with 1.3B parameters (trained on 120B tokens) and we conduct ablations with 350m and 7B models (resp. trained on 40B, 350B tokens). Our settings for architectures and optimization are borrowed from <cite class="ltx_cite ltx_citemacro_cite">Brown et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib9" title="">2020</a>)</cite>, see Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A3" title="Appendix C Architectures &amp; Hyperparameters ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">C</span></a>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p2">
<p class="ltx_p" id="S4.p2.5">Our generalist training set is Redpj2 <cite class="ltx_cite ltx_citemacro_citep">(Together AI Team, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib60" title="">2023</a>)</cite>. We select this dataset as it contains only web-crawled data without additional interventions to help evaluation tasks (e.g. adding encyclopedias, books or academic articles).
Redpj2 contains over 30T tokens with our 32k byte-pair encoding tokenizer <cite class="ltx_cite ltx_citemacro_citep">(Sennrich et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib58" title="">2016b</a>)</cite>, see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2.T2" title="Table 2 ‣ Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">2</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2" title="Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">B</span></a>.
We segment the dataset into non-overlapping 1,024 token windows (the model context limit) and compute SBERT embedding for every window. We cluster the generalist dataset hierarchically with a clustering tree with branching <math alttext="64" class="ltx_Math" display="inline" id="S4.p2.1.m1.1"><semantics id="S4.p2.1.m1.1a"><mn id="S4.p2.1.m1.1.1" xref="S4.p2.1.m1.1.1.cmml">64</mn><annotation-xml encoding="MathML-Content" id="S4.p2.1.m1.1b"><cn id="S4.p2.1.m1.1.1.cmml" type="integer" xref="S4.p2.1.m1.1.1">64</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.1.m1.1c">64</annotation><annotation encoding="application/x-llamapun" id="S4.p2.1.m1.1d">64</annotation></semantics></math> for <math alttext="4" class="ltx_Math" display="inline" id="S4.p2.2.m2.1"><semantics id="S4.p2.2.m2.1a"><mn id="S4.p2.2.m2.1.1" xref="S4.p2.2.m2.1.1.cmml">4</mn><annotation-xml encoding="MathML-Content" id="S4.p2.2.m2.1b"><cn id="S4.p2.2.m2.1.1.cmml" type="integer" xref="S4.p2.2.m2.1.1">4</cn></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.2.m2.1c">4</annotation><annotation encoding="application/x-llamapun" id="S4.p2.2.m2.1d">4</annotation></semantics></math> levels, see Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A1" title="Appendix A Scalable Clustering ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">A</span></a>. The levels therefore have 64, 4,096 (<math alttext="=64^{2}" class="ltx_Math" display="inline" id="S4.p2.3.m3.1"><semantics id="S4.p2.3.m3.1a"><mrow id="S4.p2.3.m3.1.1" xref="S4.p2.3.m3.1.1.cmml"><mi id="S4.p2.3.m3.1.1.2" xref="S4.p2.3.m3.1.1.2.cmml"></mi><mo id="S4.p2.3.m3.1.1.1" xref="S4.p2.3.m3.1.1.1.cmml">=</mo><msup id="S4.p2.3.m3.1.1.3" xref="S4.p2.3.m3.1.1.3.cmml"><mn id="S4.p2.3.m3.1.1.3.2" xref="S4.p2.3.m3.1.1.3.2.cmml">64</mn><mn id="S4.p2.3.m3.1.1.3.3" xref="S4.p2.3.m3.1.1.3.3.cmml">2</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.p2.3.m3.1b"><apply id="S4.p2.3.m3.1.1.cmml" xref="S4.p2.3.m3.1.1"><eq id="S4.p2.3.m3.1.1.1.cmml" xref="S4.p2.3.m3.1.1.1"></eq><csymbol cd="latexml" id="S4.p2.3.m3.1.1.2.cmml" xref="S4.p2.3.m3.1.1.2">absent</csymbol><apply id="S4.p2.3.m3.1.1.3.cmml" xref="S4.p2.3.m3.1.1.3"><csymbol cd="ambiguous" id="S4.p2.3.m3.1.1.3.1.cmml" xref="S4.p2.3.m3.1.1.3">superscript</csymbol><cn id="S4.p2.3.m3.1.1.3.2.cmml" type="integer" xref="S4.p2.3.m3.1.1.3.2">64</cn><cn id="S4.p2.3.m3.1.1.3.3.cmml" type="integer" xref="S4.p2.3.m3.1.1.3.3">2</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.3.m3.1c">=64^{2}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.3.m3.1d">= 64 start_POSTSUPERSCRIPT 2 end_POSTSUPERSCRIPT</annotation></semantics></math>), 260k (<math alttext="=64^{3}" class="ltx_Math" display="inline" id="S4.p2.4.m4.1"><semantics id="S4.p2.4.m4.1a"><mrow id="S4.p2.4.m4.1.1" xref="S4.p2.4.m4.1.1.cmml"><mi id="S4.p2.4.m4.1.1.2" xref="S4.p2.4.m4.1.1.2.cmml"></mi><mo id="S4.p2.4.m4.1.1.1" xref="S4.p2.4.m4.1.1.1.cmml">=</mo><msup id="S4.p2.4.m4.1.1.3" xref="S4.p2.4.m4.1.1.3.cmml"><mn id="S4.p2.4.m4.1.1.3.2" xref="S4.p2.4.m4.1.1.3.2.cmml">64</mn><mn id="S4.p2.4.m4.1.1.3.3" xref="S4.p2.4.m4.1.1.3.3.cmml">3</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.p2.4.m4.1b"><apply id="S4.p2.4.m4.1.1.cmml" xref="S4.p2.4.m4.1.1"><eq id="S4.p2.4.m4.1.1.1.cmml" xref="S4.p2.4.m4.1.1.1"></eq><csymbol cd="latexml" id="S4.p2.4.m4.1.1.2.cmml" xref="S4.p2.4.m4.1.1.2">absent</csymbol><apply id="S4.p2.4.m4.1.1.3.cmml" xref="S4.p2.4.m4.1.1.3"><csymbol cd="ambiguous" id="S4.p2.4.m4.1.1.3.1.cmml" xref="S4.p2.4.m4.1.1.3">superscript</csymbol><cn id="S4.p2.4.m4.1.1.3.2.cmml" type="integer" xref="S4.p2.4.m4.1.1.3.2">64</cn><cn id="S4.p2.4.m4.1.1.3.3.cmml" type="integer" xref="S4.p2.4.m4.1.1.3.3">3</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.4.m4.1c">=64^{3}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.4.m4.1d">= 64 start_POSTSUPERSCRIPT 3 end_POSTSUPERSCRIPT</annotation></semantics></math>) and 16.7m (<math alttext="=64^{4}" class="ltx_Math" display="inline" id="S4.p2.5.m5.1"><semantics id="S4.p2.5.m5.1a"><mrow id="S4.p2.5.m5.1.1" xref="S4.p2.5.m5.1.1.cmml"><mi id="S4.p2.5.m5.1.1.2" xref="S4.p2.5.m5.1.1.2.cmml"></mi><mo id="S4.p2.5.m5.1.1.1" xref="S4.p2.5.m5.1.1.1.cmml">=</mo><msup id="S4.p2.5.m5.1.1.3" xref="S4.p2.5.m5.1.1.3.cmml"><mn id="S4.p2.5.m5.1.1.3.2" xref="S4.p2.5.m5.1.1.3.2.cmml">64</mn><mn id="S4.p2.5.m5.1.1.3.3" xref="S4.p2.5.m5.1.1.3.3.cmml">4</mn></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.p2.5.m5.1b"><apply id="S4.p2.5.m5.1.1.cmml" xref="S4.p2.5.m5.1.1"><eq id="S4.p2.5.m5.1.1.1.cmml" xref="S4.p2.5.m5.1.1.1"></eq><csymbol cd="latexml" id="S4.p2.5.m5.1.1.2.cmml" xref="S4.p2.5.m5.1.1.2">absent</csymbol><apply id="S4.p2.5.m5.1.1.3.cmml" xref="S4.p2.5.m5.1.1.3"><csymbol cd="ambiguous" id="S4.p2.5.m5.1.1.3.1.cmml" xref="S4.p2.5.m5.1.1.3">superscript</csymbol><cn id="S4.p2.5.m5.1.1.3.2.cmml" type="integer" xref="S4.p2.5.m5.1.1.3.2">64</cn><cn id="S4.p2.5.m5.1.1.3.3.cmml" type="integer" xref="S4.p2.5.m5.1.1.3.3">4</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p2.5.m5.1c">=64^{4}</annotation><annotation encoding="application/x-llamapun" id="S4.p2.5.m5.1d">= 64 start_POSTSUPERSCRIPT 4 end_POSTSUPERSCRIPT</annotation></semantics></math>) clusters with an average of 540B, 8.4B, 130m and 2m tokens per cluster respectively. As an alternative to SBERT embeddings, we also consider Latent Semantic Index (LSI), i.e. singular value decomposition over tf-idf representations <cite class="ltx_cite ltx_citemacro_citep">(Deerwester et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib14" title="">1990</a>; Dumais, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib18" title="">2004</a>)</cite>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p3">
<p class="ltx_p" id="S4.p3.1">For our specialist tasks, we consider 3 language modeling tasks (LM) and 3 multiple-choice-question tasks (MCQ). For LM, we use Pile subsets from different domains <cite class="ltx_cite ltx_citemacro_citep">(Gao et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib20" title="">2021</a>)</cite>: medical (Pubmed Central), programming Q&amp;A (Stackexchange), and encyclopedic (Wikipedia). For MCQ answering, we use AI2 Reasoning Challenge <cite class="ltx_cite ltx_citemacro_citep">(Clark et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib11" title="">2018</a>, ARC)</cite>, Massive Multitask Language Understanding <cite class="ltx_cite ltx_citemacro_citep">(Hendrycks et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib27" title="">2021</a>, MMLU)</cite>, and Reward Bench Reasoning <cite class="ltx_cite ltx_citemacro_citep">(Lambert et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib38" title="">2024</a>, RWDB-R)</cite>. ARC focuses on science questions, MMLU focuses on interdisciplinary knowledge, RWDB-R focuses on correct vs incorrect solutions to math and programming problems. To provide a representative specialist train set <math alttext="D^{\rm s}\sim{\cal D}^{\rm s}" class="ltx_Math" display="inline" id="S4.p3.1.m1.1"><semantics id="S4.p3.1.m1.1a"><mrow id="S4.p3.1.m1.1.1" xref="S4.p3.1.m1.1.1.cmml"><msup id="S4.p3.1.m1.1.1.2" xref="S4.p3.1.m1.1.1.2.cmml"><mi id="S4.p3.1.m1.1.1.2.2" xref="S4.p3.1.m1.1.1.2.2.cmml">D</mi><mi id="S4.p3.1.m1.1.1.2.3" mathvariant="normal" xref="S4.p3.1.m1.1.1.2.3.cmml">s</mi></msup><mo id="S4.p3.1.m1.1.1.1" xref="S4.p3.1.m1.1.1.1.cmml">∼</mo><msup id="S4.p3.1.m1.1.1.3" xref="S4.p3.1.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S4.p3.1.m1.1.1.3.2" xref="S4.p3.1.m1.1.1.3.2.cmml">𝒟</mi><mi id="S4.p3.1.m1.1.1.3.3" mathvariant="normal" xref="S4.p3.1.m1.1.1.3.3.cmml">s</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="S4.p3.1.m1.1b"><apply id="S4.p3.1.m1.1.1.cmml" xref="S4.p3.1.m1.1.1"><csymbol cd="latexml" id="S4.p3.1.m1.1.1.1.cmml" xref="S4.p3.1.m1.1.1.1">similar-to</csymbol><apply id="S4.p3.1.m1.1.1.2.cmml" xref="S4.p3.1.m1.1.1.2"><csymbol cd="ambiguous" id="S4.p3.1.m1.1.1.2.1.cmml" xref="S4.p3.1.m1.1.1.2">superscript</csymbol><ci id="S4.p3.1.m1.1.1.2.2.cmml" xref="S4.p3.1.m1.1.1.2.2">𝐷</ci><ci id="S4.p3.1.m1.1.1.2.3.cmml" xref="S4.p3.1.m1.1.1.2.3">s</ci></apply><apply id="S4.p3.1.m1.1.1.3.cmml" xref="S4.p3.1.m1.1.1.3"><csymbol cd="ambiguous" id="S4.p3.1.m1.1.1.3.1.cmml" xref="S4.p3.1.m1.1.1.3">superscript</csymbol><ci id="S4.p3.1.m1.1.1.3.2.cmml" xref="S4.p3.1.m1.1.1.3.2">𝒟</ci><ci id="S4.p3.1.m1.1.1.3.3.cmml" xref="S4.p3.1.m1.1.1.3.3">s</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p3.1.m1.1c">D^{\rm s}\sim{\cal D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S4.p3.1.m1.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ∼ caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>, we split the questions into a train and test split, see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2.T3" title="Table 3 ‣ Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">3</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2" title="Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">B</span></a>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.p4">
<p class="ltx_p" id="S4.p4.1">Our main results are reported with unified settings. For the classifier, the classification threshold is the main parameter. A threshold accepting 2.5% of <math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="S4.p4.1.m1.1"><semantics id="S4.p4.1.m1.1a"><msup id="S4.p4.1.m1.1.1" xref="S4.p4.1.m1.1.1.cmml"><mi id="S4.p4.1.m1.1.1.2" xref="S4.p4.1.m1.1.1.2.cmml">D</mi><mi id="S4.p4.1.m1.1.1.3" mathvariant="normal" xref="S4.p4.1.m1.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S4.p4.1.m1.1b"><apply id="S4.p4.1.m1.1.1.cmml" xref="S4.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S4.p4.1.m1.1.1.1.cmml" xref="S4.p4.1.m1.1.1">superscript</csymbol><ci id="S4.p4.1.m1.1.1.2.cmml" xref="S4.p4.1.m1.1.1.2">𝐷</ci><ci id="S4.p4.1.m1.1.1.3.cmml" xref="S4.p4.1.m1.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S4.p4.1.m1.1c">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S4.p4.1.m1.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> worked best in for the runs with 1.3B models over 120B tokens. For DoGE, the method is costly to apply over many data sources/clusters and we applied it over 64 clusters, i.e. learning a mixture weight of dimension 64. For importance sampling, the results presented in this section relies on 260k clusters.
Later, Section <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5" title="5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">5</span></a> studies ablations and parameter sensitivity.
Details on hyperparameters can be found in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A3" title="Appendix C Architectures &amp; Hyperparameters ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">C</span></a>.</p>
</div>
<section class="ltx_subsection" id="S4.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.1 </span>Language Modeling Tasks</h3>
<div class="ltx_para ltx_noindent" id="S4.SS1.p1">
<p class="ltx_p" id="S4.SS1.p1.1">We evaluate specialist LMs on three domains from the Pile <cite class="ltx_cite ltx_citemacro_citep">(Gao et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib20" title="">2021</a>)</cite>: medical (PubMed Central), encyclopedic (Wikipedia) and programming Q&amp;A (StackExchange). We limit specialist training data from 14m tokens to the full Pile subset, up to 26.7B tokens, see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2.T2" title="Table 2 ‣ Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">2</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2" title="Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">B</span></a>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.p2">
<p class="ltx_p" id="S4.SS1.p2.1">As baselines, we either train only on the in-domain (specialist) data without pretraining or we fine-tune a model pre-trained on Redpj2. We refer to the Redpj2 pretraining distribution as the base distribution. For task-dependent pretraining, we resample the Redpj2 pretraining set using a classifier, DoGE or importance sampling for each domain. The three methods have access to 14m specialist training tokens.
In each case, the resampled pretraining set is used to train a 1.3B-parameter transformer model with the same hyperparameters as the Redpj2 baseline.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.p3">
<p class="ltx_p" id="S4.SS1.p3.1">We report pretraining results in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>, and the fine-tuning results in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>. For each domain, the pretraining results evaluate models trained using the resampled Redpj2 examples. The fine tuning results evaluate models where each model pretrained on (resampled) Redpj2 has been further trained on the in-domain data itself (PubMed, StackExchange, Wikipedia). All experiments consider the same optimization effort and we validate the fraction of steps spent in fine-tuning, from 3%-ft with 14m tokens to 100%-ft with 26.7B tokens.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.p4">
<p class="ltx_p" id="S4.SS1.p4.1">The pretraining results in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a> show that the in-domain perplexity is better with task-dependent pretraining than with generic pretraining (base Redpj2) for all methods. This gain in perplexity comes as model training focuses on data close to the targeted domain: the model capacity is not used to fit the filtered out training data. Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A5.T8" title="Table 8 ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">8</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A5" title="Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">E</span></a> shows, for instance, that CRISP outperforms base on 97.3% of PubMed but reports worse perplexity on 95.9% of Redpj2.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS1.p5">
<p class="ltx_p" id="S4.SS1.p5.1">When we fine tune the pretrained models,
the advantage of task-dependent pretraining is preserved, in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>. Task-specific pretraining checkpoints are better starting points for fine-tuning than generic ones. This shows the complementarity between task-dependent pretraining and fine-tuning. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a> also shows the necessity of pretraining: below 7B tokens, the “only specific” 1.3B model shows high perplexity. When comparing task-dependent pretraining methods, importance sampling consistently performs better after fine-tuning, even when the pretraining results are close (e.g. classifier on PubMed, Wikipedia).</p>
</div>
<figure class="ltx_figure" id="S4.F4">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel" id="S4.F2.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F2.sf1.g1" src="x2.png" width="166"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(a) </span>PubMed</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel" id="S4.F2.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F2.sf2.g1" src="x3.png" width="164"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(b) </span>StackExchange</figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel" id="S4.F2.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F2.sf3.g1" src="x4.png" width="168"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(c) </span>Wikipedia</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 2: </span><span class="ltx_text ltx_font_bold" id="S4.F4.2.1">Pretraining perplexities for language modeling tasks</span></figcaption><div class="ltx_flex_figure">
<div class="ltx_flex_break"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel" id="S4.F2.sf4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F2.sf4.g1" src="x5.png" width="168"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(d) </span>Pubmed Central</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel" id="S4.F2.sf5"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F2.sf5.g1" src="x6.png" width="170"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(e) </span>StackExchange</figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel" id="S4.F2.sf6"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F2.sf6.g1" src="x7.png" width="168"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(f) </span>Wikipedia</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 3: </span><span class="ltx_text ltx_font_bold" id="S4.F4.4.1">Fine-tuned perplexities for language modeling tasks.</span> Task-dependent pretraining is always better than generic pretraining. The ordering of the methods is unchanged from pretraining.</figcaption><div class="ltx_flex_figure">
<div class="ltx_flex_break"></div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F3.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F3.sf1.g1" src="x8.png" width="166"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(a) </span>Arc-E</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F3.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F3.sf2.g1" src="x9.png" width="161"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(b) </span>Arc-C</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_3">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F3.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F3.sf3.g1" src="x10.png" width="161"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(c) </span>MMLU</figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S4.F3.sf4"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S4.F3.sf4.g1" src="x11.png" width="164"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(d) </span>RWDB-R</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 4: </span><span class="ltx_text ltx_font_bold" id="S4.F4.6.1">Accuracy for multiple choice question tasks.</span> Light colors indicate fine tuning improvements if any. The ordering of the methods is consistent across all 4 datasets. </figcaption>
<br class="ltx_break ltx_centering"/>
</figure>
</section>
<section class="ltx_subsection" id="S4.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">4.2 </span>Multiple Choice Question Tasks</h3>
<div class="ltx_para ltx_noindent" id="S4.SS2.p1">
<p class="ltx_p" id="S4.SS2.p1.1">Compared to LM, MCQ has much smaller specialist training sets per task, i.e. between 200k and 2m tokens, see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2.T3" title="Table 3 ‣ Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">3</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2" title="Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">B</span></a>. The MCQ evaluation is also different: it uses accuracy and not perplexity. For each example, the model scores the concatenation of the question and a possible answer, for each proposed answer. The model is accurate when the correct answer is assigned the highest score (probability or normalized probability, see Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A4" title="Appendix D MCQ Evaluation ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">D</span></a>). For MCQ tasks, unlike for LM tasks,
the training loss (negative log likelihood) is therefore not closely tied to the test metric.</p>
</div>
<div class="ltx_para ltx_noindent" id="S4.SS2.p2">
<p class="ltx_p" id="S4.SS2.p2.1">Despite these differences, we observe a similar benefit for task-dependent pretraining compared to task-agnostic (base) pretraining. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a> displays a similar method ordering and CRISP is consistently the best method. As a difference with LM tasks, we observe limited benefits from fine tuning, see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>. Fine-tuning improves the base method on all datasets except ARC-E, but not enough to outperform task-specific pretraining, see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A6.T10" title="Table 10 ‣ Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">10</span></a> in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A6" title="Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">F</span></a>.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S5">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">5 </span>Analysis</h2>
<section class="ltx_subsection" id="S5.SS1">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.1 </span>Clustering</h3>
<div class="ltx_para ltx_noindent" id="S5.SS1.p1">
<p class="ltx_p" id="S5.SS1.p1.1">We study the impact of the text representation for clustering and the number of clusters. We consider two representations for clustering, the SBERT embeddings used
in all other experiments and LSI embeddings, see Section <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4" title="4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>.
We report their performance with 64, 4096, 262k and 16.7m clusters.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS1.p2">
<p class="ltx_p" id="S5.SS1.p2.3">The representation is important: the examples in a cluster are close in the embedding space. Our independence assumption, Equation <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S3.E1" title="In 3.4 CRISP: ClusteRed Importance Sampling for Pretraining ‣ 3 Data Selection for Task-Adaptive Pretraining ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">1</span></a>, assumes that the loss in a cluster <math alttext="c" class="ltx_Math" display="inline" id="S5.SS1.p2.1.m1.1"><semantics id="S5.SS1.p2.1.m1.1a"><mi id="S5.SS1.p2.1.m1.1.1" xref="S5.SS1.p2.1.m1.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.1.m1.1b"><ci id="S5.SS1.p2.1.m1.1.1.cmml" xref="S5.SS1.p2.1.m1.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.1.m1.1c">c</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.1.m1.1d">italic_c</annotation></semantics></math> is the same regardless whether its data originates from <math alttext="{D}^{\rm g}" class="ltx_Math" display="inline" id="S5.SS1.p2.2.m2.1"><semantics id="S5.SS1.p2.2.m2.1a"><msup id="S5.SS1.p2.2.m2.1.1" xref="S5.SS1.p2.2.m2.1.1.cmml"><mi id="S5.SS1.p2.2.m2.1.1.2" xref="S5.SS1.p2.2.m2.1.1.2.cmml">D</mi><mi id="S5.SS1.p2.2.m2.1.1.3" mathvariant="normal" xref="S5.SS1.p2.2.m2.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.2.m2.1b"><apply id="S5.SS1.p2.2.m2.1.1.cmml" xref="S5.SS1.p2.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS1.p2.2.m2.1.1.1.cmml" xref="S5.SS1.p2.2.m2.1.1">superscript</csymbol><ci id="S5.SS1.p2.2.m2.1.1.2.cmml" xref="S5.SS1.p2.2.m2.1.1.2">𝐷</ci><ci id="S5.SS1.p2.2.m2.1.1.3.cmml" xref="S5.SS1.p2.2.m2.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.2.m2.1c">{D}^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.2.m2.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> or <math alttext="{D}^{\rm s}" class="ltx_Math" display="inline" id="S5.SS1.p2.3.m3.1"><semantics id="S5.SS1.p2.3.m3.1a"><msup id="S5.SS1.p2.3.m3.1.1" xref="S5.SS1.p2.3.m3.1.1.cmml"><mi id="S5.SS1.p2.3.m3.1.1.2" xref="S5.SS1.p2.3.m3.1.1.2.cmml">D</mi><mi id="S5.SS1.p2.3.m3.1.1.3" mathvariant="normal" xref="S5.SS1.p2.3.m3.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.3.m3.1b"><apply id="S5.SS1.p2.3.m3.1.1.cmml" xref="S5.SS1.p2.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS1.p2.3.m3.1.1.1.cmml" xref="S5.SS1.p2.3.m3.1.1">superscript</csymbol><ci id="S5.SS1.p2.3.m3.1.1.2.cmml" xref="S5.SS1.p2.3.m3.1.1.2">𝐷</ci><ci id="S5.SS1.p2.3.m3.1.1.3.cmml" xref="S5.SS1.p2.3.m3.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.3.m3.1c">{D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.3.m3.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>, i.e.</p>
<table class="ltx_equation ltx_eqn_table" id="S5.E3">
<tbody><tr class="ltx_equation ltx_eqn_row ltx_align_baseline">
<td class="ltx_eqn_cell ltx_eqn_center_padleft"></td>
<td class="ltx_eqn_cell ltx_align_center"><math alttext="{\cal L}({D}^{\rm g}\cap K(c);\theta)\simeq{\cal L}({D}^{\rm s}\cap K(c);%
\theta)." class="ltx_Math" display="block" id="S5.E3.m1.5"><semantics id="S5.E3.m1.5a"><mrow id="S5.E3.m1.5.5.1" xref="S5.E3.m1.5.5.1.1.cmml"><mrow id="S5.E3.m1.5.5.1.1" xref="S5.E3.m1.5.5.1.1.cmml"><mrow id="S5.E3.m1.5.5.1.1.1" xref="S5.E3.m1.5.5.1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.E3.m1.5.5.1.1.1.3" xref="S5.E3.m1.5.5.1.1.1.3.cmml">ℒ</mi><mo id="S5.E3.m1.5.5.1.1.1.2" xref="S5.E3.m1.5.5.1.1.1.2.cmml">⁢</mo><mrow id="S5.E3.m1.5.5.1.1.1.1.1" xref="S5.E3.m1.5.5.1.1.1.1.2.cmml"><mo id="S5.E3.m1.5.5.1.1.1.1.1.2" stretchy="false" xref="S5.E3.m1.5.5.1.1.1.1.2.cmml">(</mo><mrow id="S5.E3.m1.5.5.1.1.1.1.1.1" xref="S5.E3.m1.5.5.1.1.1.1.1.1.cmml"><msup id="S5.E3.m1.5.5.1.1.1.1.1.1.2" xref="S5.E3.m1.5.5.1.1.1.1.1.1.2.cmml"><mi id="S5.E3.m1.5.5.1.1.1.1.1.1.2.2" xref="S5.E3.m1.5.5.1.1.1.1.1.1.2.2.cmml">D</mi><mi id="S5.E3.m1.5.5.1.1.1.1.1.1.2.3" mathvariant="normal" xref="S5.E3.m1.5.5.1.1.1.1.1.1.2.3.cmml">g</mi></msup><mo id="S5.E3.m1.5.5.1.1.1.1.1.1.1" xref="S5.E3.m1.5.5.1.1.1.1.1.1.1.cmml">∩</mo><mrow id="S5.E3.m1.5.5.1.1.1.1.1.1.3" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3.cmml"><mi id="S5.E3.m1.5.5.1.1.1.1.1.1.3.2" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3.2.cmml">K</mi><mo id="S5.E3.m1.5.5.1.1.1.1.1.1.3.1" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3.1.cmml">⁢</mo><mrow id="S5.E3.m1.5.5.1.1.1.1.1.1.3.3.2" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3.cmml"><mo id="S5.E3.m1.5.5.1.1.1.1.1.1.3.3.2.1" stretchy="false" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3.cmml">(</mo><mi id="S5.E3.m1.1.1" xref="S5.E3.m1.1.1.cmml">c</mi><mo id="S5.E3.m1.5.5.1.1.1.1.1.1.3.3.2.2" stretchy="false" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="S5.E3.m1.5.5.1.1.1.1.1.3" xref="S5.E3.m1.5.5.1.1.1.1.2.cmml">;</mo><mi id="S5.E3.m1.2.2" xref="S5.E3.m1.2.2.cmml">θ</mi><mo id="S5.E3.m1.5.5.1.1.1.1.1.4" stretchy="false" xref="S5.E3.m1.5.5.1.1.1.1.2.cmml">)</mo></mrow></mrow><mo id="S5.E3.m1.5.5.1.1.3" xref="S5.E3.m1.5.5.1.1.3.cmml">≃</mo><mrow id="S5.E3.m1.5.5.1.1.2" xref="S5.E3.m1.5.5.1.1.2.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.E3.m1.5.5.1.1.2.3" xref="S5.E3.m1.5.5.1.1.2.3.cmml">ℒ</mi><mo id="S5.E3.m1.5.5.1.1.2.2" xref="S5.E3.m1.5.5.1.1.2.2.cmml">⁢</mo><mrow id="S5.E3.m1.5.5.1.1.2.1.1" xref="S5.E3.m1.5.5.1.1.2.1.2.cmml"><mo id="S5.E3.m1.5.5.1.1.2.1.1.2" stretchy="false" xref="S5.E3.m1.5.5.1.1.2.1.2.cmml">(</mo><mrow id="S5.E3.m1.5.5.1.1.2.1.1.1" xref="S5.E3.m1.5.5.1.1.2.1.1.1.cmml"><msup id="S5.E3.m1.5.5.1.1.2.1.1.1.2" xref="S5.E3.m1.5.5.1.1.2.1.1.1.2.cmml"><mi id="S5.E3.m1.5.5.1.1.2.1.1.1.2.2" xref="S5.E3.m1.5.5.1.1.2.1.1.1.2.2.cmml">D</mi><mi id="S5.E3.m1.5.5.1.1.2.1.1.1.2.3" mathvariant="normal" xref="S5.E3.m1.5.5.1.1.2.1.1.1.2.3.cmml">s</mi></msup><mo id="S5.E3.m1.5.5.1.1.2.1.1.1.1" xref="S5.E3.m1.5.5.1.1.2.1.1.1.1.cmml">∩</mo><mrow id="S5.E3.m1.5.5.1.1.2.1.1.1.3" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3.cmml"><mi id="S5.E3.m1.5.5.1.1.2.1.1.1.3.2" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3.2.cmml">K</mi><mo id="S5.E3.m1.5.5.1.1.2.1.1.1.3.1" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3.1.cmml">⁢</mo><mrow id="S5.E3.m1.5.5.1.1.2.1.1.1.3.3.2" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3.cmml"><mo id="S5.E3.m1.5.5.1.1.2.1.1.1.3.3.2.1" stretchy="false" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3.cmml">(</mo><mi id="S5.E3.m1.3.3" xref="S5.E3.m1.3.3.cmml">c</mi><mo id="S5.E3.m1.5.5.1.1.2.1.1.1.3.3.2.2" stretchy="false" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3.cmml">)</mo></mrow></mrow></mrow><mo id="S5.E3.m1.5.5.1.1.2.1.1.3" xref="S5.E3.m1.5.5.1.1.2.1.2.cmml">;</mo><mi id="S5.E3.m1.4.4" xref="S5.E3.m1.4.4.cmml">θ</mi><mo id="S5.E3.m1.5.5.1.1.2.1.1.4" stretchy="false" xref="S5.E3.m1.5.5.1.1.2.1.2.cmml">)</mo></mrow></mrow></mrow><mo id="S5.E3.m1.5.5.1.2" lspace="0em" xref="S5.E3.m1.5.5.1.1.cmml">.</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.E3.m1.5b"><apply id="S5.E3.m1.5.5.1.1.cmml" xref="S5.E3.m1.5.5.1"><csymbol cd="latexml" id="S5.E3.m1.5.5.1.1.3.cmml" xref="S5.E3.m1.5.5.1.1.3">similar-to-or-equals</csymbol><apply id="S5.E3.m1.5.5.1.1.1.cmml" xref="S5.E3.m1.5.5.1.1.1"><times id="S5.E3.m1.5.5.1.1.1.2.cmml" xref="S5.E3.m1.5.5.1.1.1.2"></times><ci id="S5.E3.m1.5.5.1.1.1.3.cmml" xref="S5.E3.m1.5.5.1.1.1.3">ℒ</ci><list id="S5.E3.m1.5.5.1.1.1.1.2.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1"><apply id="S5.E3.m1.5.5.1.1.1.1.1.1.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1"><intersect id="S5.E3.m1.5.5.1.1.1.1.1.1.1.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1.1"></intersect><apply id="S5.E3.m1.5.5.1.1.1.1.1.1.2.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1.2"><csymbol cd="ambiguous" id="S5.E3.m1.5.5.1.1.1.1.1.1.2.1.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1.2">superscript</csymbol><ci id="S5.E3.m1.5.5.1.1.1.1.1.1.2.2.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1.2.2">𝐷</ci><ci id="S5.E3.m1.5.5.1.1.1.1.1.1.2.3.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1.2.3">g</ci></apply><apply id="S5.E3.m1.5.5.1.1.1.1.1.1.3.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3"><times id="S5.E3.m1.5.5.1.1.1.1.1.1.3.1.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3.1"></times><ci id="S5.E3.m1.5.5.1.1.1.1.1.1.3.2.cmml" xref="S5.E3.m1.5.5.1.1.1.1.1.1.3.2">𝐾</ci><ci id="S5.E3.m1.1.1.cmml" xref="S5.E3.m1.1.1">𝑐</ci></apply></apply><ci id="S5.E3.m1.2.2.cmml" xref="S5.E3.m1.2.2">𝜃</ci></list></apply><apply id="S5.E3.m1.5.5.1.1.2.cmml" xref="S5.E3.m1.5.5.1.1.2"><times id="S5.E3.m1.5.5.1.1.2.2.cmml" xref="S5.E3.m1.5.5.1.1.2.2"></times><ci id="S5.E3.m1.5.5.1.1.2.3.cmml" xref="S5.E3.m1.5.5.1.1.2.3">ℒ</ci><list id="S5.E3.m1.5.5.1.1.2.1.2.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1"><apply id="S5.E3.m1.5.5.1.1.2.1.1.1.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1"><intersect id="S5.E3.m1.5.5.1.1.2.1.1.1.1.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1.1"></intersect><apply id="S5.E3.m1.5.5.1.1.2.1.1.1.2.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1.2"><csymbol cd="ambiguous" id="S5.E3.m1.5.5.1.1.2.1.1.1.2.1.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1.2">superscript</csymbol><ci id="S5.E3.m1.5.5.1.1.2.1.1.1.2.2.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1.2.2">𝐷</ci><ci id="S5.E3.m1.5.5.1.1.2.1.1.1.2.3.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1.2.3">s</ci></apply><apply id="S5.E3.m1.5.5.1.1.2.1.1.1.3.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3"><times id="S5.E3.m1.5.5.1.1.2.1.1.1.3.1.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3.1"></times><ci id="S5.E3.m1.5.5.1.1.2.1.1.1.3.2.cmml" xref="S5.E3.m1.5.5.1.1.2.1.1.1.3.2">𝐾</ci><ci id="S5.E3.m1.3.3.cmml" xref="S5.E3.m1.3.3">𝑐</ci></apply></apply><ci id="S5.E3.m1.4.4.cmml" xref="S5.E3.m1.4.4">𝜃</ci></list></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.E3.m1.5c">{\cal L}({D}^{\rm g}\cap K(c);\theta)\simeq{\cal L}({D}^{\rm s}\cap K(c);%
\theta).</annotation><annotation encoding="application/x-llamapun" id="S5.E3.m1.5d">caligraphic_L ( italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ∩ italic_K ( italic_c ) ; italic_θ ) ≃ caligraphic_L ( italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ∩ italic_K ( italic_c ) ; italic_θ ) .</annotation></semantics></math></td>
<td class="ltx_eqn_cell ltx_eqn_center_padright"></td>
<td class="ltx_eqn_cell ltx_eqn_eqno ltx_align_middle ltx_align_right" rowspan="1"><span class="ltx_tag ltx_tag_equation ltx_align_right">(3)</span></td>
</tr></tbody>
</table>
<p class="ltx_p" id="S5.SS1.p2.5">In practice, it is sufficient that the embedding space reflects the similarity of the loss gradient, i.e. if the gradients of the loss over a generalist cluster <math alttext="{D}^{\rm g}\cap K(c)" class="ltx_Math" display="inline" id="S5.SS1.p2.4.m1.1"><semantics id="S5.SS1.p2.4.m1.1a"><mrow id="S5.SS1.p2.4.m1.1.2" xref="S5.SS1.p2.4.m1.1.2.cmml"><msup id="S5.SS1.p2.4.m1.1.2.2" xref="S5.SS1.p2.4.m1.1.2.2.cmml"><mi id="S5.SS1.p2.4.m1.1.2.2.2" xref="S5.SS1.p2.4.m1.1.2.2.2.cmml">D</mi><mi id="S5.SS1.p2.4.m1.1.2.2.3" mathvariant="normal" xref="S5.SS1.p2.4.m1.1.2.2.3.cmml">g</mi></msup><mo id="S5.SS1.p2.4.m1.1.2.1" xref="S5.SS1.p2.4.m1.1.2.1.cmml">∩</mo><mrow id="S5.SS1.p2.4.m1.1.2.3" xref="S5.SS1.p2.4.m1.1.2.3.cmml"><mi id="S5.SS1.p2.4.m1.1.2.3.2" xref="S5.SS1.p2.4.m1.1.2.3.2.cmml">K</mi><mo id="S5.SS1.p2.4.m1.1.2.3.1" xref="S5.SS1.p2.4.m1.1.2.3.1.cmml">⁢</mo><mrow id="S5.SS1.p2.4.m1.1.2.3.3.2" xref="S5.SS1.p2.4.m1.1.2.3.cmml"><mo id="S5.SS1.p2.4.m1.1.2.3.3.2.1" stretchy="false" xref="S5.SS1.p2.4.m1.1.2.3.cmml">(</mo><mi id="S5.SS1.p2.4.m1.1.1" xref="S5.SS1.p2.4.m1.1.1.cmml">c</mi><mo id="S5.SS1.p2.4.m1.1.2.3.3.2.2" stretchy="false" xref="S5.SS1.p2.4.m1.1.2.3.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p2.4.m1.1b"><apply id="S5.SS1.p2.4.m1.1.2.cmml" xref="S5.SS1.p2.4.m1.1.2"><intersect id="S5.SS1.p2.4.m1.1.2.1.cmml" xref="S5.SS1.p2.4.m1.1.2.1"></intersect><apply id="S5.SS1.p2.4.m1.1.2.2.cmml" xref="S5.SS1.p2.4.m1.1.2.2"><csymbol cd="ambiguous" id="S5.SS1.p2.4.m1.1.2.2.1.cmml" xref="S5.SS1.p2.4.m1.1.2.2">superscript</csymbol><ci id="S5.SS1.p2.4.m1.1.2.2.2.cmml" xref="S5.SS1.p2.4.m1.1.2.2.2">𝐷</ci><ci id="S5.SS1.p2.4.m1.1.2.2.3.cmml" xref="S5.SS1.p2.4.m1.1.2.2.3">g</ci></apply><apply id="S5.SS1.p2.4.m1.1.2.3.cmml" xref="S5.SS1.p2.4.m1.1.2.3"><times id="S5.SS1.p2.4.m1.1.2.3.1.cmml" xref="S5.SS1.p2.4.m1.1.2.3.1"></times><ci id="S5.SS1.p2.4.m1.1.2.3.2.cmml" xref="S5.SS1.p2.4.m1.1.2.3.2">𝐾</ci><ci id="S5.SS1.p2.4.m1.1.1.cmml" xref="S5.SS1.p2.4.m1.1.1">𝑐</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p2.4.m1.1c">{D}^{\rm g}\cap K(c)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.4.m1.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT ∩ italic_K ( italic_c )</annotation></semantics></math> is correlated with the gradient over a specialist cluster <math alttext="{D}^{\rm s}\cap K(c);\theta)" class="ltx_math_unparsed" display="inline" id="S5.SS1.p2.5.m2.2"><semantics id="S5.SS1.p2.5.m2.2a"><mrow id="S5.SS1.p2.5.m2.2b"><msup id="S5.SS1.p2.5.m2.2.3"><mi id="S5.SS1.p2.5.m2.2.3.2">D</mi><mi id="S5.SS1.p2.5.m2.2.3.3" mathvariant="normal">s</mi></msup><mo id="S5.SS1.p2.5.m2.2.4">∩</mo><mi id="S5.SS1.p2.5.m2.2.5">K</mi><mrow id="S5.SS1.p2.5.m2.2.6"><mo id="S5.SS1.p2.5.m2.2.6.1" stretchy="false">(</mo><mi id="S5.SS1.p2.5.m2.1.1">c</mi><mo id="S5.SS1.p2.5.m2.2.6.2" stretchy="false">)</mo></mrow><mo id="S5.SS1.p2.5.m2.2.7">;</mo><mi id="S5.SS1.p2.5.m2.2.2">θ</mi><mo id="S5.SS1.p2.5.m2.2.8" stretchy="false">)</mo></mrow><annotation encoding="application/x-tex" id="S5.SS1.p2.5.m2.2c">{D}^{\rm s}\cap K(c);\theta)</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p2.5.m2.2d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ∩ italic_K ( italic_c ) ; italic_θ )</annotation></semantics></math>, the model trained on the former improves on the later. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F7" title="Figure 7 ‣ 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">7</span></a> shows that the SBERT representation is more adapted and yields better results than LSI for all settings.</p>
</div>
<figure class="ltx_figure" id="S5.F7">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel" id="S5.F5.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="191" id="S5.F5.sf1.g1" src="x12.png" width="241"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(a) </span>Arc-E</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel" id="S5.F5.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_landscape" height="191" id="S5.F5.sf2.g1" src="x13.png" width="241"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(b) </span>Arc-C</figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel" id="S5.F5.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S5.F5.sf3.g1" src="x14.png" width="236"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(c) </span>MMLU</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 5: </span><span class="ltx_text ltx_font_bold" id="S5.F7.9.1">Accuracy for multiple choice question tasks varying the text representation for clustering and the number of clusters.</span> SBERT is more effective than LSI in all cases.</figcaption><div class="ltx_flex_figure">
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<div class="ltx_block ltx_figure_panel ltx_minipage ltx_align_center ltx_align_middle" id="S5.F7.1" style="width:159.0pt;">
<img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="191" id="S5.F7.1.g1" src="x15.png" width="292"/>
</div>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<div class="ltx_block ltx_figure_panel ltx_minipage ltx_align_center ltx_align_middle" id="S5.F7.3" style="width:230.5pt;">
<img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="191" id="S5.F7.2.g1" src="x16.png" width="204"/><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="S5.F7.3.g2" src="x17.png" width="188"/>
</div>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_center ltx_align_middle" id="S5.F7.fig1" style="width:159.0pt;">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 6: </span><span class="ltx_text ltx_font_bold" id="S5.F7.fig1.2.1">Number of occurrences of each training example for CRISP on MMLU.</span> Repeated examples increase with the number of clusters.
<br class="ltx_break"/></figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_minipage ltx_align_center ltx_align_middle" id="S5.F7.7" style="width:230.5pt;">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 7: </span><span class="ltx_text ltx_font_bold" id="S5.F7.7.6.1">Loss improvement on Redpj2 (valid) wrt base as a function of the SBERT distance to MMLU train.</span> Models with a large number of clusters are better than base in a small area near MMLU train. The gray area indicates the <math alttext="25" class="ltx_Math" display="inline" id="S5.F7.6.3.m1.1"><semantics id="S5.F7.6.3.m1.1b"><mn id="S5.F7.6.3.m1.1.1" xref="S5.F7.6.3.m1.1.1.cmml">25</mn><annotation-xml encoding="MathML-Content" id="S5.F7.6.3.m1.1c"><cn id="S5.F7.6.3.m1.1.1.cmml" type="integer" xref="S5.F7.6.3.m1.1.1">25</cn></annotation-xml><annotation encoding="application/x-tex" id="S5.F7.6.3.m1.1d">25</annotation><annotation encoding="application/x-llamapun" id="S5.F7.6.3.m1.1e">25</annotation></semantics></math>-<math alttext="75\%" class="ltx_Math" display="inline" id="S5.F7.7.4.m2.1"><semantics id="S5.F7.7.4.m2.1b"><mrow id="S5.F7.7.4.m2.1.1" xref="S5.F7.7.4.m2.1.1.cmml"><mn id="S5.F7.7.4.m2.1.1.2" xref="S5.F7.7.4.m2.1.1.2.cmml">75</mn><mo id="S5.F7.7.4.m2.1.1.1" xref="S5.F7.7.4.m2.1.1.1.cmml">%</mo></mrow><annotation-xml encoding="MathML-Content" id="S5.F7.7.4.m2.1c"><apply id="S5.F7.7.4.m2.1.1.cmml" xref="S5.F7.7.4.m2.1.1"><csymbol cd="latexml" id="S5.F7.7.4.m2.1.1.1.cmml" xref="S5.F7.7.4.m2.1.1.1">percent</csymbol><cn id="S5.F7.7.4.m2.1.1.2.cmml" type="integer" xref="S5.F7.7.4.m2.1.1.2">75</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.F7.7.4.m2.1d">75\%</annotation><annotation encoding="application/x-llamapun" id="S5.F7.7.4.m2.1e">75 %</annotation></semantics></math> quantiles for the MMLU test set.</figcaption>
</figure>
</div>
</div>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS1.p3">
<p class="ltx_p" id="S5.SS1.p3.4">The number of clusters is a trade-off and its optimum is at 260k for most of our experiments. There are multiple factors at play when the number of clusters varies. A smaller number of clusters implies larger clusters: our hypothesis, Equation <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.E3" title="In 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">3</span></a>, is then stronger as it assumes loss similarity on large areas of the embedding space. At the limit, with one cluster, this hypothesis assumes that the specialist loss and generalist loss are identical everywhere. Conversely, as the number of clusters gets larger, the estimation of the cluster density on the small specialist set <math alttext="P(c|{\cal D}^{\rm s})\simeq P(c|{D}^{\rm s})" class="ltx_Math" display="inline" id="S5.SS1.p3.1.m1.2"><semantics id="S5.SS1.p3.1.m1.2a"><mrow id="S5.SS1.p3.1.m1.2.2" xref="S5.SS1.p3.1.m1.2.2.cmml"><mrow id="S5.SS1.p3.1.m1.1.1.1" xref="S5.SS1.p3.1.m1.1.1.1.cmml"><mi id="S5.SS1.p3.1.m1.1.1.1.3" xref="S5.SS1.p3.1.m1.1.1.1.3.cmml">P</mi><mo id="S5.SS1.p3.1.m1.1.1.1.2" xref="S5.SS1.p3.1.m1.1.1.1.2.cmml">⁢</mo><mrow id="S5.SS1.p3.1.m1.1.1.1.1.1" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.cmml"><mo id="S5.SS1.p3.1.m1.1.1.1.1.1.2" stretchy="false" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS1.p3.1.m1.1.1.1.1.1.1" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.cmml"><mi id="S5.SS1.p3.1.m1.1.1.1.1.1.1.2" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S5.SS1.p3.1.m1.1.1.1.1.1.1.1" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.1.cmml">|</mo><msup id="S5.SS1.p3.1.m1.1.1.1.1.1.1.3" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.2" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.3" mathvariant="normal" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S5.SS1.p3.1.m1.1.1.1.1.1.3" stretchy="false" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.cmml">)</mo></mrow></mrow><mo id="S5.SS1.p3.1.m1.2.2.3" xref="S5.SS1.p3.1.m1.2.2.3.cmml">≃</mo><mrow id="S5.SS1.p3.1.m1.2.2.2" xref="S5.SS1.p3.1.m1.2.2.2.cmml"><mi id="S5.SS1.p3.1.m1.2.2.2.3" xref="S5.SS1.p3.1.m1.2.2.2.3.cmml">P</mi><mo id="S5.SS1.p3.1.m1.2.2.2.2" xref="S5.SS1.p3.1.m1.2.2.2.2.cmml">⁢</mo><mrow id="S5.SS1.p3.1.m1.2.2.2.1.1" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.cmml"><mo id="S5.SS1.p3.1.m1.2.2.2.1.1.2" stretchy="false" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.cmml">(</mo><mrow id="S5.SS1.p3.1.m1.2.2.2.1.1.1" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.cmml"><mi id="S5.SS1.p3.1.m1.2.2.2.1.1.1.2" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.2.cmml">c</mi><mo fence="false" id="S5.SS1.p3.1.m1.2.2.2.1.1.1.1" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.1.cmml">|</mo><msup id="S5.SS1.p3.1.m1.2.2.2.1.1.1.3" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.cmml"><mi id="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.2" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.2.cmml">D</mi><mi id="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.3" mathvariant="normal" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S5.SS1.p3.1.m1.2.2.2.1.1.3" stretchy="false" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.cmml">)</mo></mrow></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p3.1.m1.2b"><apply id="S5.SS1.p3.1.m1.2.2.cmml" xref="S5.SS1.p3.1.m1.2.2"><csymbol cd="latexml" id="S5.SS1.p3.1.m1.2.2.3.cmml" xref="S5.SS1.p3.1.m1.2.2.3">similar-to-or-equals</csymbol><apply id="S5.SS1.p3.1.m1.1.1.1.cmml" xref="S5.SS1.p3.1.m1.1.1.1"><times id="S5.SS1.p3.1.m1.1.1.1.2.cmml" xref="S5.SS1.p3.1.m1.1.1.1.2"></times><ci id="S5.SS1.p3.1.m1.1.1.1.3.cmml" xref="S5.SS1.p3.1.m1.1.1.1.3">𝑃</ci><apply id="S5.SS1.p3.1.m1.1.1.1.1.1.1.cmml" xref="S5.SS1.p3.1.m1.1.1.1.1.1"><csymbol cd="latexml" id="S5.SS1.p3.1.m1.1.1.1.1.1.1.1.cmml" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.SS1.p3.1.m1.1.1.1.1.1.1.2.cmml" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.2">𝑐</ci><apply id="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.cmml" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.1.cmml" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.3">superscript</csymbol><ci id="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.2.cmml" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.2">𝒟</ci><ci id="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.3.cmml" xref="S5.SS1.p3.1.m1.1.1.1.1.1.1.3.3">s</ci></apply></apply></apply><apply id="S5.SS1.p3.1.m1.2.2.2.cmml" xref="S5.SS1.p3.1.m1.2.2.2"><times id="S5.SS1.p3.1.m1.2.2.2.2.cmml" xref="S5.SS1.p3.1.m1.2.2.2.2"></times><ci id="S5.SS1.p3.1.m1.2.2.2.3.cmml" xref="S5.SS1.p3.1.m1.2.2.2.3">𝑃</ci><apply id="S5.SS1.p3.1.m1.2.2.2.1.1.1.cmml" xref="S5.SS1.p3.1.m1.2.2.2.1.1"><csymbol cd="latexml" id="S5.SS1.p3.1.m1.2.2.2.1.1.1.1.cmml" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.1">conditional</csymbol><ci id="S5.SS1.p3.1.m1.2.2.2.1.1.1.2.cmml" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.2">𝑐</ci><apply id="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.cmml" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.1.cmml" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.3">superscript</csymbol><ci id="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.2.cmml" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.2">𝐷</ci><ci id="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.3.cmml" xref="S5.SS1.p3.1.m1.2.2.2.1.1.1.3.3">s</ci></apply></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p3.1.m1.2c">P(c|{\cal D}^{\rm s})\simeq P(c|{D}^{\rm s})</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p3.1.m1.2d">italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ) ≃ italic_P ( italic_c | italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT )</annotation></semantics></math> gets less accurate. The estimator risks overfitting, i.e. favoring clusters frequent in the training set <math alttext="{D}^{\rm s}" class="ltx_Math" display="inline" id="S5.SS1.p3.2.m2.1"><semantics id="S5.SS1.p3.2.m2.1a"><msup id="S5.SS1.p3.2.m2.1.1" xref="S5.SS1.p3.2.m2.1.1.cmml"><mi id="S5.SS1.p3.2.m2.1.1.2" xref="S5.SS1.p3.2.m2.1.1.2.cmml">D</mi><mi id="S5.SS1.p3.2.m2.1.1.3" mathvariant="normal" xref="S5.SS1.p3.2.m2.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS1.p3.2.m2.1b"><apply id="S5.SS1.p3.2.m2.1.1.cmml" xref="S5.SS1.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS1.p3.2.m2.1.1.1.cmml" xref="S5.SS1.p3.2.m2.1.1">superscript</csymbol><ci id="S5.SS1.p3.2.m2.1.1.2.cmml" xref="S5.SS1.p3.2.m2.1.1.2">𝐷</ci><ci id="S5.SS1.p3.2.m2.1.1.3.cmml" xref="S5.SS1.p3.2.m2.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p3.2.m2.1c">{D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p3.2.m2.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math> but not as frequent on other samples from <math alttext="{\cal D}^{\rm s}" class="ltx_Math" display="inline" id="S5.SS1.p3.3.m3.1"><semantics id="S5.SS1.p3.3.m3.1a"><msup id="S5.SS1.p3.3.m3.1.1" xref="S5.SS1.p3.3.m3.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS1.p3.3.m3.1.1.2" xref="S5.SS1.p3.3.m3.1.1.2.cmml">𝒟</mi><mi id="S5.SS1.p3.3.m3.1.1.3" mathvariant="normal" xref="S5.SS1.p3.3.m3.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS1.p3.3.m3.1b"><apply id="S5.SS1.p3.3.m3.1.1.cmml" xref="S5.SS1.p3.3.m3.1.1"><csymbol cd="ambiguous" id="S5.SS1.p3.3.m3.1.1.1.cmml" xref="S5.SS1.p3.3.m3.1.1">superscript</csymbol><ci id="S5.SS1.p3.3.m3.1.1.2.cmml" xref="S5.SS1.p3.3.m3.1.1.2">𝒟</ci><ci id="S5.SS1.p3.3.m3.1.1.3.cmml" xref="S5.SS1.p3.3.m3.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p3.3.m3.1c">{\cal D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p3.3.m3.1d">caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>. Increasing the number of clusters also risks reducing the effective training set size: the specialist data could be mostly concentrated in a few clusters, corresponding to a small fraction of the overall generalist set <math alttext="{D}^{\rm g}" class="ltx_Math" display="inline" id="S5.SS1.p3.4.m4.1"><semantics id="S5.SS1.p3.4.m4.1a"><msup id="S5.SS1.p3.4.m4.1.1" xref="S5.SS1.p3.4.m4.1.1.cmml"><mi id="S5.SS1.p3.4.m4.1.1.2" xref="S5.SS1.p3.4.m4.1.1.2.cmml">D</mi><mi id="S5.SS1.p3.4.m4.1.1.3" mathvariant="normal" xref="S5.SS1.p3.4.m4.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS1.p3.4.m4.1b"><apply id="S5.SS1.p3.4.m4.1.1.cmml" xref="S5.SS1.p3.4.m4.1.1"><csymbol cd="ambiguous" id="S5.SS1.p3.4.m4.1.1.1.cmml" xref="S5.SS1.p3.4.m4.1.1">superscript</csymbol><ci id="S5.SS1.p3.4.m4.1.1.2.cmml" xref="S5.SS1.p3.4.m4.1.1.2">𝐷</ci><ci id="S5.SS1.p3.4.m4.1.1.3.cmml" xref="S5.SS1.p3.4.m4.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p3.4.m4.1c">{D}^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p3.4.m4.1d">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math>.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS1.p4">
<p class="ltx_p" id="S5.SS1.p4.2">We explore these aspects on MMLU. We first measure the number of repeated examples when training models with CRISP pretraining for different number of clusters. Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F7" title="Figure 7 ‣ 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">7</span></a> shows the number of repetitions for each quantile of the training set. Even for 16.7m clusters, only a small minority of training examples are repeated beyond 10 times and the average number of occurrences of the training is examples 1.94, well within commonly recommended values <cite class="ltx_cite ltx_citemacro_citep">(Muennighoff et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib48" title="">2023</a>; Xue et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib72" title="">2023</a>)</cite>. Even if exact repetitions do not account for the poorer performance of the 16.7m cluster setting, its training set might be less diverse and the model might generalize well only in a small neighborhood of its training set.
We plot Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F7" title="Figure 7 ‣ 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">7</span></a> to evaluate if the Redpj2 examples with good perplexity concentrate
around <math alttext="D^{\rm s}" class="ltx_Math" display="inline" id="S5.SS1.p4.1.m1.1"><semantics id="S5.SS1.p4.1.m1.1a"><msup id="S5.SS1.p4.1.m1.1.1" xref="S5.SS1.p4.1.m1.1.1.cmml"><mi id="S5.SS1.p4.1.m1.1.1.2" xref="S5.SS1.p4.1.m1.1.1.2.cmml">D</mi><mi id="S5.SS1.p4.1.m1.1.1.3" mathvariant="normal" xref="S5.SS1.p4.1.m1.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.1.m1.1b"><apply id="S5.SS1.p4.1.m1.1.1.cmml" xref="S5.SS1.p4.1.m1.1.1"><csymbol cd="ambiguous" id="S5.SS1.p4.1.m1.1.1.1.cmml" xref="S5.SS1.p4.1.m1.1.1">superscript</csymbol><ci id="S5.SS1.p4.1.m1.1.1.2.cmml" xref="S5.SS1.p4.1.m1.1.1.2">𝐷</ci><ci id="S5.SS1.p4.1.m1.1.1.3.cmml" xref="S5.SS1.p4.1.m1.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.1.m1.1c">D^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.1.m1.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>, the MMLU training set. This plot shows that the benefit of CRISP over base is indeed correlated with the distance to <math alttext="D^{\rm s}" class="ltx_Math" display="inline" id="S5.SS1.p4.2.m2.1"><semantics id="S5.SS1.p4.2.m2.1a"><msup id="S5.SS1.p4.2.m2.1.1" xref="S5.SS1.p4.2.m2.1.1.cmml"><mi id="S5.SS1.p4.2.m2.1.1.2" xref="S5.SS1.p4.2.m2.1.1.2.cmml">D</mi><mi id="S5.SS1.p4.2.m2.1.1.3" mathvariant="normal" xref="S5.SS1.p4.2.m2.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS1.p4.2.m2.1b"><apply id="S5.SS1.p4.2.m2.1.1.cmml" xref="S5.SS1.p4.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS1.p4.2.m2.1.1.1.cmml" xref="S5.SS1.p4.2.m2.1.1">superscript</csymbol><ci id="S5.SS1.p4.2.m2.1.1.2.cmml" xref="S5.SS1.p4.2.m2.1.1.2">𝐷</ci><ci id="S5.SS1.p4.2.m2.1.1.3.cmml" xref="S5.SS1.p4.2.m2.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p4.2.m2.1c">D^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p4.2.m2.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>. As the number of cluster increases to 16.7m, the benefit over base concentrate in an area with very few samples. For comparison, we plot the 2 middle quartiles [0.25, 0.75] where most of the MMLU test data concentrate in gray. We remark that MMLU test data mostly lies in an area where the perplexity of IS 16.7m is low.</p>
</div>
<figure class="ltx_figure ltx_align_floatright" id="S5.F8">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F8.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="191" id="S5.F8.sf1.g1" src="x18.png" width="224"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(a) </span>Perplexity on reweighted Redpj2</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F8.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="191" id="S5.F8.sf2.g1" src="x19.png" width="222"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(b) </span>Perplexity on MMLU train (plain) and test (dotted) sets.</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 8: </span><span class="ltx_text ltx_font_bold" id="S5.F8.2.1">Perplexity for CRISP on MMLU with different number of clusters.</span> Y-scales on (a) and (b) are different.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS1.p5">
<p class="ltx_p" id="S5.SS1.p5.1">Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F8" title="Figure 8 ‣ 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">8</span></a> shows the perplexity during training for CRISP runs on MMLU. On Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F8.sf1" title="In Figure 8 ‣ 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">8(a)</span></a>, the perplexity is computed from the reweighed loss on Redpj2. This is the loss optimized during pretraining. It shows that when the number of cluster increases the sampled training set is less diverse and corresponds to an easier learning problem (<math alttext="&lt;5" class="ltx_Math" display="inline" id="S5.SS1.p5.1.m1.1"><semantics id="S5.SS1.p5.1.m1.1a"><mrow id="S5.SS1.p5.1.m1.1.1" xref="S5.SS1.p5.1.m1.1.1.cmml"><mi id="S5.SS1.p5.1.m1.1.1.2" xref="S5.SS1.p5.1.m1.1.1.2.cmml"></mi><mo id="S5.SS1.p5.1.m1.1.1.1" xref="S5.SS1.p5.1.m1.1.1.1.cmml">&lt;</mo><mn id="S5.SS1.p5.1.m1.1.1.3" xref="S5.SS1.p5.1.m1.1.1.3.cmml">5</mn></mrow><annotation-xml encoding="MathML-Content" id="S5.SS1.p5.1.m1.1b"><apply id="S5.SS1.p5.1.m1.1.1.cmml" xref="S5.SS1.p5.1.m1.1.1"><lt id="S5.SS1.p5.1.m1.1.1.1.cmml" xref="S5.SS1.p5.1.m1.1.1.1"></lt><csymbol cd="latexml" id="S5.SS1.p5.1.m1.1.1.2.cmml" xref="S5.SS1.p5.1.m1.1.1.2">absent</csymbol><cn id="S5.SS1.p5.1.m1.1.1.3.cmml" type="integer" xref="S5.SS1.p5.1.m1.1.1.3">5</cn></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS1.p5.1.m1.1c">&lt;5</annotation><annotation encoding="application/x-llamapun" id="S5.SS1.p5.1.m1.1d">&lt; 5</annotation></semantics></math> PPL). On Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F8.sf2" title="In Figure 8 ‣ 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">8(b)</span></a>, the perplexity is computed on the MMLU data itself, on the training set (plain) and on the test set (dotted). The scale of both plot is different: the resampled perplexities on Redpj2 are therefore not a good approximation of the MMLU perplexities. This quantifies the error resulting from our assumption, Equation <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.E3" title="In 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">3</span></a>. We also remark overfitting for 16.7m clusters, the only case with better MMLU perplexity for train than for test. Finally, we notice that the gray area in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F7" title="Figure 7 ‣ 5.1 Clustering ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">7</span></a> fails to show that 260k cluster would have the best perplexity, which highlights that SBERT distance to the training data
is not the only factor explaining model performance.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS2">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.2 </span>Model Size</h3>
<figure class="ltx_figure" id="S5.F10">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel" id="S5.F9.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="620" id="S5.F9.sf1.g1" src="x20.png" width="761"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(a) </span>Arc-E</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel" id="S5.F9.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="620" id="S5.F9.sf2.g1" src="x21.png" width="761"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(b) </span>Arc-C</figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel" id="S5.F9.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="633" id="S5.F9.sf3.g1" src="x22.png" width="761"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(c) </span>MMLU</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">Figure 9: </span><span class="ltx_text ltx_font_bold" id="S5.F10.6.1">Accuracy for multiple choice question tasks across model sizes.</span></figcaption><div class="ltx_flex_figure">
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F9.sf4"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="672" id="S5.F9.sf4.g1" src="x23.png" width="761"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(d) </span>Arc-E</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F9.sf5"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="672" id="S5.F9.sf5.g1" src="x24.png" width="761"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(e) </span>Arc-C</figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F9.sf6"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="645" id="S5.F9.sf6.g1" src="x25.png" width="761"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(f) </span>MMLU</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 10: </span><span class="ltx_text ltx_font_bold" id="S5.F10.8.1">Accuracy for multiple choice question tasks as a function of training cost.</span> The large dots mark the transition between model sizes (350m <math alttext="\to" class="ltx_Math" display="inline" id="S5.F10.3.m1.1"><semantics id="S5.F10.3.m1.1a"><mo id="S5.F10.3.m1.1.1" stretchy="false" xref="S5.F10.3.m1.1.1.cmml">→</mo><annotation-xml encoding="MathML-Content" id="S5.F10.3.m1.1b"><ci id="S5.F10.3.m1.1.1.cmml" xref="S5.F10.3.m1.1.1">→</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F10.3.m1.1c">\to</annotation><annotation encoding="application/x-llamapun" id="S5.F10.3.m1.1d">→</annotation></semantics></math> 1.3B <math alttext="\to" class="ltx_Math" display="inline" id="S5.F10.4.m2.1"><semantics id="S5.F10.4.m2.1a"><mo id="S5.F10.4.m2.1.1" stretchy="false" xref="S5.F10.4.m2.1.1.cmml">→</mo><annotation-xml encoding="MathML-Content" id="S5.F10.4.m2.1b"><ci id="S5.F10.4.m2.1.1.cmml" xref="S5.F10.4.m2.1.1">→</ci></annotation-xml><annotation encoding="application/x-tex" id="S5.F10.4.m2.1c">\to</annotation><annotation encoding="application/x-llamapun" id="S5.F10.4.m2.1d">→</annotation></semantics></math> 6.7B).</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS2.p1">
<p class="ltx_p" id="S5.SS2.p1.1">This section compares CRISP and base at 3 model sizes. The benefit of task-dependent training is consistent across model sizes, see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F10" title="Figure 10 ‣ 5.2 Model Size ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">10</span></a>. We consolidate results across sizes to report the training cost in GPUh vs accuracy in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F10" title="Figure 10 ‣ 5.2 Model Size ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">10</span></a>. GPUh are measured in training hours per graphic processor (NVIDIA H100). We evaluate multiple checkpoints across model sizes and sort the checkpoints by training cost. The big dots mark transitions between model sizes: they show that the the 1.3B I.S. model outperforms the 6.7B base model on ARC. This shows substantial training speedups (<math alttext="\sim" class="ltx_Math" display="inline" id="S5.SS2.p1.1.m1.1"><semantics id="S5.SS2.p1.1.m1.1a"><mo id="S5.SS2.p1.1.m1.1.1" xref="S5.SS2.p1.1.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S5.SS2.p1.1.m1.1b"><csymbol cd="latexml" id="S5.SS2.p1.1.m1.1.1.cmml" xref="S5.SS2.p1.1.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S5.SS2.p1.1.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S5.SS2.p1.1.m1.1d">∼</annotation></semantics></math>30x). Of course, a smaller model is also beneficial at inference.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS3">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.3 </span>Different Amount of Training Data</h3>
<figure class="ltx_figure" id="S5.F11">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F11.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_img_landscape" height="206" id="S5.F11.sf1.g1" src="x26.png" width="322"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(a) </span>Repetitions for less generic data</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F11.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="206" id="S5.F11.sf2.g1" src="x27.png" width="207"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(b) </span>Acc. for less generic data</figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="S5.F11.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_img_square" height="206" id="S5.F11.sf3.g1" src="x28.png" width="207"/>
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_figure">(c) </span>Acc. for less specific data</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 11: </span><span class="ltx_text ltx_font_bold" id="S5.F11.8.1">MMLU with less training data.</span> When the generalist set <math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="S5.F11.4.m1.1"><semantics id="S5.F11.4.m1.1b"><msup id="S5.F11.4.m1.1.1" xref="S5.F11.4.m1.1.1.cmml"><mi id="S5.F11.4.m1.1.1.2" xref="S5.F11.4.m1.1.1.2.cmml">D</mi><mi id="S5.F11.4.m1.1.1.3" mathvariant="normal" xref="S5.F11.4.m1.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S5.F11.4.m1.1c"><apply id="S5.F11.4.m1.1.1.cmml" xref="S5.F11.4.m1.1.1"><csymbol cd="ambiguous" id="S5.F11.4.m1.1.1.1.cmml" xref="S5.F11.4.m1.1.1">superscript</csymbol><ci id="S5.F11.4.m1.1.1.2.cmml" xref="S5.F11.4.m1.1.1.2">𝐷</ci><ci id="S5.F11.4.m1.1.1.3.cmml" xref="S5.F11.4.m1.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.F11.4.m1.1d">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S5.F11.4.m1.1e">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> is small (a,b), the importance sampling method will up-sample a small part of <math alttext="D^{\rm g}" class="ltx_Math" display="inline" id="S5.F11.5.m2.1"><semantics id="S5.F11.5.m2.1b"><msup id="S5.F11.5.m2.1.1" xref="S5.F11.5.m2.1.1.cmml"><mi id="S5.F11.5.m2.1.1.2" xref="S5.F11.5.m2.1.1.2.cmml">D</mi><mi id="S5.F11.5.m2.1.1.3" mathvariant="normal" xref="S5.F11.5.m2.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="S5.F11.5.m2.1c"><apply id="S5.F11.5.m2.1.1.cmml" xref="S5.F11.5.m2.1.1"><csymbol cd="ambiguous" id="S5.F11.5.m2.1.1.1.cmml" xref="S5.F11.5.m2.1.1">superscript</csymbol><ci id="S5.F11.5.m2.1.1.2.cmml" xref="S5.F11.5.m2.1.1.2">𝐷</ci><ci id="S5.F11.5.m2.1.1.3.cmml" xref="S5.F11.5.m2.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.F11.5.m2.1d">D^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="S5.F11.5.m2.1e">italic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> and this part will be seen multiple times during training. When this part is too small, the benefit of data selection vanishes. When the specialist set <math alttext="D^{\rm s}" class="ltx_Math" display="inline" id="S5.F11.6.m3.1"><semantics id="S5.F11.6.m3.1b"><msup id="S5.F11.6.m3.1.1" xref="S5.F11.6.m3.1.1.cmml"><mi id="S5.F11.6.m3.1.1.2" xref="S5.F11.6.m3.1.1.2.cmml">D</mi><mi id="S5.F11.6.m3.1.1.3" mathvariant="normal" xref="S5.F11.6.m3.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S5.F11.6.m3.1c"><apply id="S5.F11.6.m3.1.1.cmml" xref="S5.F11.6.m3.1.1"><csymbol cd="ambiguous" id="S5.F11.6.m3.1.1.1.cmml" xref="S5.F11.6.m3.1.1">superscript</csymbol><ci id="S5.F11.6.m3.1.1.2.cmml" xref="S5.F11.6.m3.1.1.2">𝐷</ci><ci id="S5.F11.6.m3.1.1.3.cmml" xref="S5.F11.6.m3.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.F11.6.m3.1d">D^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S5.F11.6.m3.1e">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math> is small (c), the importance sampling weights are poorly estimated and the importance sampled data might not be representative of the targeted task.</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS3.p1">
<p class="ltx_p" id="S5.SS3.p1.1">This section varies both (i) the amount of generalist data available to sample the CRISP dataset from and (ii) the amount of specialist data for inferring the CRISP weights.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS3.p2">
<p class="ltx_p" id="S5.SS3.p2.2">When specialist data concentrates on a few clusters, CRISP often samples generalist data from the same clusters, which can be problematic when the generalist set is small. We restrict the pretraining set to 700B and 120B tokens (downsampling Redpj2 by resp. <math alttext="\sim" class="ltx_Math" display="inline" id="S5.SS3.p2.1.m1.1"><semantics id="S5.SS3.p2.1.m1.1a"><mo id="S5.SS3.p2.1.m1.1.1" xref="S5.SS3.p2.1.m1.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.1.m1.1b"><csymbol cd="latexml" id="S5.SS3.p2.1.m1.1.1.cmml" xref="S5.SS3.p2.1.m1.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.1.m1.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.1.m1.1d">∼</annotation></semantics></math> 50x and <math alttext="\sim" class="ltx_Math" display="inline" id="S5.SS3.p2.2.m2.1"><semantics id="S5.SS3.p2.2.m2.1a"><mo id="S5.SS3.p2.2.m2.1.1" xref="S5.SS3.p2.2.m2.1.1.cmml">∼</mo><annotation-xml encoding="MathML-Content" id="S5.SS3.p2.2.m2.1b"><csymbol cd="latexml" id="S5.SS3.p2.2.m2.1.1.cmml" xref="S5.SS3.p2.2.m2.1.1">similar-to</csymbol></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p2.2.m2.1c">\sim</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p2.2.m2.1d">∼</annotation></semantics></math>300x). Our pretraining runs use 120B tokens, so a base run never repeats in all settings. When CRISP is applied, some tokens are repeated.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F11.sf1" title="In Figure 11 ‣ 5.3 Different Amount of Training Data ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">11(a)</span></a> shows that,
when restricting to 120B tokens, the number of repetition becomes high (22.5 on average) and CRISP is ineffective after 256k steps.</p>
</div>
<div class="ltx_para ltx_noindent" id="S5.SS3.p3">
<p class="ltx_p" id="S5.SS3.p3.2">When the specialist dataset is smaller, Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F11.sf3" title="In Figure 11 ‣ 5.3 Different Amount of Training Data ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">11(c)</span></a> shows that the errors in estimating cluster frequencies <math alttext="P(c|{\cal D}^{\rm s})" class="ltx_Math" display="inline" id="S5.SS3.p3.1.m1.1"><semantics id="S5.SS3.p3.1.m1.1a"><mrow id="S5.SS3.p3.1.m1.1.1" xref="S5.SS3.p3.1.m1.1.1.cmml"><mi id="S5.SS3.p3.1.m1.1.1.3" xref="S5.SS3.p3.1.m1.1.1.3.cmml">P</mi><mo id="S5.SS3.p3.1.m1.1.1.2" xref="S5.SS3.p3.1.m1.1.1.2.cmml">⁢</mo><mrow id="S5.SS3.p3.1.m1.1.1.1.1" xref="S5.SS3.p3.1.m1.1.1.1.1.1.cmml"><mo id="S5.SS3.p3.1.m1.1.1.1.1.2" stretchy="false" xref="S5.SS3.p3.1.m1.1.1.1.1.1.cmml">(</mo><mrow id="S5.SS3.p3.1.m1.1.1.1.1.1" xref="S5.SS3.p3.1.m1.1.1.1.1.1.cmml"><mi id="S5.SS3.p3.1.m1.1.1.1.1.1.2" xref="S5.SS3.p3.1.m1.1.1.1.1.1.2.cmml">c</mi><mo fence="false" id="S5.SS3.p3.1.m1.1.1.1.1.1.1" xref="S5.SS3.p3.1.m1.1.1.1.1.1.1.cmml">|</mo><msup id="S5.SS3.p3.1.m1.1.1.1.1.1.3" xref="S5.SS3.p3.1.m1.1.1.1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="S5.SS3.p3.1.m1.1.1.1.1.1.3.2" xref="S5.SS3.p3.1.m1.1.1.1.1.1.3.2.cmml">𝒟</mi><mi id="S5.SS3.p3.1.m1.1.1.1.1.1.3.3" mathvariant="normal" xref="S5.SS3.p3.1.m1.1.1.1.1.1.3.3.cmml">s</mi></msup></mrow><mo id="S5.SS3.p3.1.m1.1.1.1.1.3" stretchy="false" xref="S5.SS3.p3.1.m1.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.1.m1.1b"><apply id="S5.SS3.p3.1.m1.1.1.cmml" xref="S5.SS3.p3.1.m1.1.1"><times id="S5.SS3.p3.1.m1.1.1.2.cmml" xref="S5.SS3.p3.1.m1.1.1.2"></times><ci id="S5.SS3.p3.1.m1.1.1.3.cmml" xref="S5.SS3.p3.1.m1.1.1.3">𝑃</ci><apply id="S5.SS3.p3.1.m1.1.1.1.1.1.cmml" xref="S5.SS3.p3.1.m1.1.1.1.1"><csymbol cd="latexml" id="S5.SS3.p3.1.m1.1.1.1.1.1.1.cmml" xref="S5.SS3.p3.1.m1.1.1.1.1.1.1">conditional</csymbol><ci id="S5.SS3.p3.1.m1.1.1.1.1.1.2.cmml" xref="S5.SS3.p3.1.m1.1.1.1.1.1.2">𝑐</ci><apply id="S5.SS3.p3.1.m1.1.1.1.1.1.3.cmml" xref="S5.SS3.p3.1.m1.1.1.1.1.1.3"><csymbol cd="ambiguous" id="S5.SS3.p3.1.m1.1.1.1.1.1.3.1.cmml" xref="S5.SS3.p3.1.m1.1.1.1.1.1.3">superscript</csymbol><ci id="S5.SS3.p3.1.m1.1.1.1.1.1.3.2.cmml" xref="S5.SS3.p3.1.m1.1.1.1.1.1.3.2">𝒟</ci><ci id="S5.SS3.p3.1.m1.1.1.1.1.1.3.3.cmml" xref="S5.SS3.p3.1.m1.1.1.1.1.1.3.3">s</ci></apply></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.1.m1.1c">P(c|{\cal D}^{\rm s})</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.1.m1.1d">italic_P ( italic_c | caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT )</annotation></semantics></math>
negatively impact end task accuracy. This suggests future work to improve this estimation for tasks with small <math alttext="{D}^{\rm s}" class="ltx_Math" display="inline" id="S5.SS3.p3.2.m2.1"><semantics id="S5.SS3.p3.2.m2.1a"><msup id="S5.SS3.p3.2.m2.1.1" xref="S5.SS3.p3.2.m2.1.1.cmml"><mi id="S5.SS3.p3.2.m2.1.1.2" xref="S5.SS3.p3.2.m2.1.1.2.cmml">D</mi><mi id="S5.SS3.p3.2.m2.1.1.3" mathvariant="normal" xref="S5.SS3.p3.2.m2.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="S5.SS3.p3.2.m2.1b"><apply id="S5.SS3.p3.2.m2.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1"><csymbol cd="ambiguous" id="S5.SS3.p3.2.m2.1.1.1.cmml" xref="S5.SS3.p3.2.m2.1.1">superscript</csymbol><ci id="S5.SS3.p3.2.m2.1.1.2.cmml" xref="S5.SS3.p3.2.m2.1.1.2">𝐷</ci><ci id="S5.SS3.p3.2.m2.1.1.3.cmml" xref="S5.SS3.p3.2.m2.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="S5.SS3.p3.2.m2.1c">{D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="S5.SS3.p3.2.m2.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>: e.g. specific set augmentations or task grouping.</p>
</div>
</section>
<section class="ltx_subsection" id="S5.SS4">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.4 </span>Task-Transfer and Multitasking</h3>
<div class="ltx_para ltx_noindent" id="S5.SS4.p1">
<p class="ltx_p" id="S5.SS4.p1.1">We perform cross-task evaluation, i.e. targeting a task A and evaluating on a task B, we also pretrain a multitask models with CRISP averaged weights from multiple tasks. Our results for the 1.3B models are in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.T1" title="Table 1 ‣ 5.4 Task-Transfer and Multitasking ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">1</span></a>, we also report cross-task evaluation results for different model sizes in Appendix <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A8" title="Appendix H Task Transfer for 350m, 1.3B and 7B models ‣ Appendix G Comparing the results of DoGE and Importance Sampling ‣ Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">H</span></a>.
Cross-task evaluations show that, perhaps unsurprisingly, the best results on a task A are obtained when pretraining for task A. Transfer differs across tasks: CRISP targeting MMLU gives better results than base for all tasks, which is not the case for CRISP targeting ARC or RWDB-R. The multi-task result which mixes the histograms with the same weight (1/3 for ARC, MMLU and RWDB-R) gives the best result on averaged multitask accuracy. Surprisingly, on RWDB-R, this setting slightly outperforms targeting RWDB-R itself.</p>
</div>
<figure class="ltx_table" id="S5.T1">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 1: </span><span class="ltx_text ltx_font_bold" id="S5.T1.2.1">Accuracy (%) for Task Transfer and Multitasking.</span> Importance Sampling on MMLU and on multitask improves all tasks compared to baseline.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="S5.T1.3">
<thead class="ltx_thead">
<tr class="ltx_tr" id="S5.T1.3.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" colspan="2" id="S5.T1.3.1.1.1">Model</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="5" id="S5.T1.3.1.1.2">Evaluation Tasks</th>
</tr>
<tr class="ltx_tr" id="S5.T1.3.2.2">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row" id="S5.T1.3.2.2.1"></th>
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r" id="S5.T1.3.2.2.2"></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="S5.T1.3.2.2.3">ARC-E</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="S5.T1.3.2.2.4">ARC-C</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="S5.T1.3.2.2.5">MMLU</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="S5.T1.3.2.2.6">RWDB-R</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="S5.T1.3.2.2.7">Multi</th>
</tr>
<tr class="ltx_tr" id="S5.T1.3.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="S5.T1.3.3.3.1">Base</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="S5.T1.3.3.3.2">Redpj2</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="S5.T1.3.3.3.3">58.4</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="S5.T1.3.3.3.4">27.5</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="S5.T1.3.3.3.5">30.1</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="S5.T1.3.3.3.6">62.2</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="S5.T1.3.3.3.7">45.1</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="S5.T1.3.4.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="S5.T1.3.4.1.1">CRISP</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="S5.T1.3.4.1.2">ARC</th>
<td class="ltx_td ltx_align_right ltx_border_t" id="S5.T1.3.4.1.3"><span class="ltx_text ltx_font_bold" id="S5.T1.3.4.1.3.1">71.3</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S5.T1.3.4.1.4"><span class="ltx_text ltx_font_bold" id="S5.T1.3.4.1.4.1">38.6</span></td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S5.T1.3.4.1.5">28.9</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="S5.T1.3.4.1.6">60.9</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="S5.T1.3.4.1.7">48.2</td>
</tr>
<tr class="ltx_tr" id="S5.T1.3.5.2">
<th class="ltx_td ltx_th ltx_th_row" id="S5.T1.3.5.2.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T1.3.5.2.2">MMLU</th>
<td class="ltx_td ltx_align_right" id="S5.T1.3.5.2.3">63.4</td>
<td class="ltx_td ltx_align_right" id="S5.T1.3.5.2.4">28.7</td>
<td class="ltx_td ltx_align_right" id="S5.T1.3.5.2.5"><span class="ltx_text ltx_font_bold" id="S5.T1.3.5.2.5.1">33.4</span></td>
<td class="ltx_td ltx_align_right ltx_border_r" id="S5.T1.3.5.2.6">65.2</td>
<td class="ltx_td ltx_align_right" id="S5.T1.3.5.2.7">48.2</td>
</tr>
<tr class="ltx_tr" id="S5.T1.3.6.3">
<th class="ltx_td ltx_th ltx_th_row" id="S5.T1.3.6.3.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="S5.T1.3.6.3.2">RWDB-R</th>
<td class="ltx_td ltx_align_right" id="S5.T1.3.6.3.3">42.4</td>
<td class="ltx_td ltx_align_right" id="S5.T1.3.6.3.4">23.4</td>
<td class="ltx_td ltx_align_right" id="S5.T1.3.6.3.5">26.4</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="S5.T1.3.6.3.6">70.1</td>
<td class="ltx_td ltx_align_right" id="S5.T1.3.6.3.7">43.1</td>
</tr>
<tr class="ltx_tr" id="S5.T1.3.7.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_t" id="S5.T1.3.7.4.1">CRISP</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r ltx_border_t" id="S5.T1.3.7.4.2">Multi</th>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_t" id="S5.T1.3.7.4.3">68.6</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_t" id="S5.T1.3.7.4.4">34.1</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_t" id="S5.T1.3.7.4.5">31.1</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r ltx_border_t" id="S5.T1.3.7.4.6"><span class="ltx_text ltx_font_bold" id="S5.T1.3.7.4.6.1">70.9</span></td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_t" id="S5.T1.3.7.4.7"><span class="ltx_text ltx_font_bold" id="S5.T1.3.7.4.7.1">51.1</span></td>
</tr>
</tbody>
</table>
</figure>
</section>
<section class="ltx_subsection" id="S5.SS5">
<h3 class="ltx_title ltx_title_subsection">
<span class="ltx_tag ltx_tag_subsection">5.5 </span>Task-Dependent Continued Pretraining</h3>
<figure class="ltx_figure ltx_align_floatright" id="S5.F12"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="224" id="S5.F12.g1" src="x29.png" width="228"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 12: </span>Continued Pretraining on MMLU</figcaption>
</figure>
<div class="ltx_para ltx_noindent" id="S5.SS5.p1">
<p class="ltx_p" id="S5.SS5.p1.1">We have seen the benefit of pretraining a model per task with CRISP in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>.
For tasks where pretraining cost is a concern, shorter pretraining runs still provide benefits, see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F10" title="Figure 10 ‣ 5.2 Model Size ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">10</span></a>. Pretraining a multi-task model is also a cost-effective option, see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.T1" title="Table 1 ‣ 5.4 Task-Transfer and Multitasking ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">1</span></a>. This section evaluates a third cost-effective option when targeting multiple tasks: continued pretraining.
In this case, pretraining is divided into a generic pretraining phase and a task-dependent continued pretraining phase using CRISP. The compute cost of the generic pretraining can be shared across multiple tasks. Our results in Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.F12" title="Figure 12 ‣ 5.5 Task-Dependent Continued Pretraining ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">12</span></a>
show that even 10% of CRISP continued pretraining (i.e. generic pretraining for 928 steps out of 1,024)
gives an accuracy (32.9%) close to a full CRISP run (33.4%). We also remark that the impact of continued pretraining is stronger than fine tuning a generic model on MMLU (31.0% accuracy), see Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>.</p>
</div>
</section>
</section>
<section class="ltx_section" id="S6">
<h2 class="ltx_title ltx_title_section">
<span class="ltx_tag ltx_tag_section">6 </span>Conclusions</h2>
<div class="ltx_para ltx_noindent" id="S6.p1">
<p class="ltx_p" id="S6.p1.1">A specialist LM is interesting since a small specialist LM can outperform a larger generalist LM on its targeted domain while having a lower inference cost. We explore pretraining specialist LMs when little specialization data is available, a common setting that prevents pretraining of dedicated LMs. We evaluate different method that modifies the distribution of a generic training set guided by little specialist data. Our experiments highlight the benefit of clustered importance sampling: i.e. resampling the generic
set such that its cluster histogram matches the specialist data. Our findings show that pretraining with this method provides strong models both for LM and question answering tasks. These benefits are studied across model size, training set size and clustering methods. We also explore ways to lower the training cost of specialist models addressing by showing their benefit on shorter training runs, continued pretraining and multitask settings.</p>
</div>
<div class="ltx_para ltx_noindent" id="S6.p2">
<p class="ltx_p" id="S6.p2.1">Our work shows that a simple, scalable importance sampling method can provide effective specialist LMs, even from little specialization data. Since clustered importance sampling is modality-agnostic, we foresee extensions of this work to other modalities, including vision and audio.</p>
</div>
<div class="ltx_pagination ltx_role_newpage"></div>
<div class="ltx_pagination ltx_role_newpage"></div>
</section>
<section class="ltx_section" id="Sx1">
<h2 class="ltx_title ltx_title_section">Acknowledgements</h2>
<div class="ltx_para ltx_noindent" id="Sx1.p1">
<p class="ltx_p" id="Sx1.p1.1">We thank Matteo Pagliardini and Angelos Karathopoulos for their help throughout the project. We also thank Maartje ter Hoeve, Yizhe Zhang and Navdeep Jaitly for their suggestions and comments.</p>
</div>
</section>
<section class="ltx_bibliography" id="bib">
<h2 class="ltx_title ltx_title_bibliography">References</h2>
<ul class="ltx_biblist">
<li class="ltx_bibitem" id="bib.bib1">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Aharoni &amp; Goldberg (2020)</span>
<span class="ltx_bibblock">
Roee Aharoni and Yoav Goldberg.

</span>
<span class="ltx_bibblock">Unsupervised domain clusters in pretrained language models.

</span>
<span class="ltx_bibblock">In Dan Jurafsky, Joyce Chai, Natalie Schluter, and Joel Tetreault
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib1.1.1">Proceedings of the 58th Annual Meeting of the Association for
Computational Linguistics</em>, pp.  7747–7763, Online, July 2020. Association
for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/2020.acl-main.692</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2020.acl-main.692" title="">https://aclanthology.org/2020.acl-main.692</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib2">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Albalak et al. (2024)</span>
<span class="ltx_bibblock">
Alon Albalak, Yanai Elazar, Sang Michael Xie, Shayne Longpre, Nathan Lambert,
Xinyi Wang, Niklas Muennighoff, Bairu Hou, Liangming Pan, Haewon Jeong, Colin
Raffel, Shiyu Chang, Tatsunori Hashimoto, and William Yang Wang.

</span>
<span class="ltx_bibblock">A survey on data selection for language models, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2402.16827" title="">https://arxiv.org/abs/2402.16827</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib3">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">An et al. (2021)</span>
<span class="ltx_bibblock">
J An, L Ying, and Y Zhu.

</span>
<span class="ltx_bibblock">Why resampling outperforms reweighting for correcting sampling bias
with stochastic gradients.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib3.1.1">International Conference on Learning Representations</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib4">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Arthur &amp; Vassilvitskii (2006)</span>
<span class="ltx_bibblock">
David Arthur and Sergei Vassilvitskii.

</span>
<span class="ltx_bibblock">k-means++: The advantages of careful seeding.

</span>
<span class="ltx_bibblock">Technical report, Stanford, 2006.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib5">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Axelrod et al. (2011)</span>
<span class="ltx_bibblock">
Amittai Axelrod, Xiaodong He, and Jianfeng Gao.

</span>
<span class="ltx_bibblock">Domain adaptation via pseudo in-domain data selection.

</span>
<span class="ltx_bibblock">In Regina Barzilay and Mark Johnson (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib5.1.1">Proceedings of the
2011 Conference on Empirical Methods in Natural Language Processing</em>, pp. 355–362, Edinburgh, Scotland, UK., July 2011. Association for Computational
Linguistics.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/D11-1033" title="">https://aclanthology.org/D11-1033</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib6">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Azerbayev et al. (2024)</span>
<span class="ltx_bibblock">
Zhangir Azerbayev, Hailey Schoelkopf, Keiran Paster, Marco Dos Santos, Stephen
McAleer, Albert Q. Jiang, Jia Deng, Stella Biderman, and Sean Welleck.

</span>
<span class="ltx_bibblock">Llemma: An open language model for mathematics, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2310.10631" title="">https://arxiv.org/abs/2310.10631</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib7">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Bolton et al. (2024)</span>
<span class="ltx_bibblock">
Elliot Bolton, Abhinav Venigalla, Michihiro Yasunaga, David Hall, Betty Xiong,
Tony Lee, Roxana Daneshjou, Jonathan Frankle, Percy Liang, Michael Carbin,
and Christopher D. Manning.

</span>
<span class="ltx_bibblock">Biomedlm: A 2.7b parameter language model trained on biomedical text,
2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2403.18421" title="">https://arxiv.org/abs/2403.18421</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib8">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Borsos et al. (2024)</span>
<span class="ltx_bibblock">
Zalán Borsos, MojmÃ­r MutnÃ½, Marco Tagliasacchi, and Andreas Krause.

</span>
<span class="ltx_bibblock">Data summarization via bilevel optimization.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib8.1.1">Journal of Machine Learning Research</em>, 25(73):1–53, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="http://jmlr.org/papers/v25/21-1132.html" title="">http://jmlr.org/papers/v25/21-1132.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib9">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Brown et al. (2020)</span>
<span class="ltx_bibblock">
Tom Brown, Benjamin Mann, Nick Ryder, Melanie Subbiah, Jared D Kaplan, Prafulla
Dhariwal, Arvind Neelakantan, Pranav Shyam, Girish Sastry, Amanda Askell,
Sandhini Agarwal, Ariel Herbert-Voss, Gretchen Krueger, Tom Henighan, Rewon
Child, Aditya Ramesh, Daniel Ziegler, Jeffrey Wu, Clemens Winter, Chris
Hesse, Mark Chen, Eric Sigler, Mateusz Litwin, Scott Gray, Benjamin Chess,
Jack Clark, Christopher Berner, Sam McCandlish, Alec Radford, Ilya Sutskever,
and Dario Amodei.

</span>
<span class="ltx_bibblock">Language models are few-shot learners.

</span>
<span class="ltx_bibblock">In H. Larochelle, M. Ranzato, R. Hadsell, M.F. Balcan, and H. Lin
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib9.1.1">Advances in Neural Information Processing Systems</em>, volume 33,
pp.  1877–1901. Curran Associates, Inc., 2020.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2020/file/1457c0d6bfcb4967418bfb8ac142f64a-Paper.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2020/file/1457c0d6bfcb4967418bfb8ac142f64a-Paper.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib10">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Chen &amp; Mueller (2024)</span>
<span class="ltx_bibblock">
Jiuhai Chen and Jonas Mueller.

</span>
<span class="ltx_bibblock">Automated data curation for robust language model fine-tuning, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2403.12776" title="">https://arxiv.org/abs/2403.12776</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib11">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Clark et al. (2018)</span>
<span class="ltx_bibblock">
Peter Clark, Isaac Cowhey, Oren Etzioni, Tushar Khot, Ashish Sabharwal, Carissa
Schoenick, and Oyvind Tafjord.

</span>
<span class="ltx_bibblock">Think you have solved question answering? try arc, the ai2 reasoning
challenge.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib11.1.1">arXiv preprint arXiv:1803.05457</em>, 2018.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib12">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Cook &amp; Lui (2012)</span>
<span class="ltx_bibblock">
Paul Cook and Marco Lui.

</span>
<span class="ltx_bibblock">langid.py for better language modelling.

</span>
<span class="ltx_bibblock">In Paul Cook and Scott Nowson (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib12.1.1">Proceedings of the
Australasian Language Technology Association Workshop 2012</em>, pp.  107–112,
Dunedin, New Zealand, December 2012.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/U12-1014" title="">https://aclanthology.org/U12-1014</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib13">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dagréou et al. (2022)</span>
<span class="ltx_bibblock">
Mathieu Dagréou, Pierre Ablin, Samuel Vaiter, and Thomas Moreau.

</span>
<span class="ltx_bibblock">A framework for bilevel optimization that enables stochastic and
global variance reduction algorithms.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib13.1.1">Advances in Neural Information Processing Systems</em>,
35:26698–26710, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib14">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Deerwester et al. (1990)</span>
<span class="ltx_bibblock">
Scott Deerwester, Susan T Dumais, George W Furnas, Thomas K Landauer, and
Richard Harshman.

</span>
<span class="ltx_bibblock">Indexing by latent semantic analysis.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib14.1.1">Journal of the American society for information science</em>,
41(6):391–407, 1990.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib15">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Devlin et al. (2019)</span>
<span class="ltx_bibblock">
Jacob Devlin, Ming-Wei Chang, Kenton Lee, and Kristina Toutanova.

</span>
<span class="ltx_bibblock">BERT: Pre-training of deep bidirectional transformers for language
understanding.

</span>
<span class="ltx_bibblock">In Jill Burstein, Christy Doran, and Thamar Solorio (eds.),
<em class="ltx_emph ltx_font_italic" id="bib.bib15.1.1">Proceedings of the 2019 Conference of the North American Chapter of
the Association for Computational Linguistics: Human Language Technologies,
Volume 1 (Long and Short Papers)</em>, pp.  4171–4186, Minneapolis, Minnesota,
June 2019. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/N19-1423</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/N19-1423" title="">https://aclanthology.org/N19-1423</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib16">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dodge et al. (2021)</span>
<span class="ltx_bibblock">
Jesse Dodge, Maarten Sap, Ana Marasović, William Agnew, Gabriel Ilharco,
Dirk Groeneveld, Margaret Mitchell, and Matt Gardner.

</span>
<span class="ltx_bibblock">Documenting large webtext corpora: A case study on the colossal clean
crawled corpus.

</span>
<span class="ltx_bibblock">In Marie-Francine Moens, Xuanjing Huang, Lucia Specia, and Scott
Wen-tau Yih (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib16.1.1">Proceedings of the 2021 Conference on Empirical
Methods in Natural Language Processing</em>, pp.  1286–1305, Online and Punta
Cana, Dominican Republic, November 2021. Association for Computational
Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/2021.emnlp-main.98</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2021.emnlp-main.98" title="">https://aclanthology.org/2021.emnlp-main.98</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib17">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dubey et al. (2024)</span>
<span class="ltx_bibblock">
Abhimanyu Dubey, Abhinav Jauhri, Abhinav Pandey, Abhishek Kadian, Ahmad
Al-Dahle, Aiesha Letman, …, Zach Rait, Zachary DeVito, Zef Rosnbrick,
Zhaoduo Wen, Zhenyu Yang, and Zhiwei Zhao.

</span>
<span class="ltx_bibblock">The llama 3 herd of models, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2407.21783" title="">https://arxiv.org/abs/2407.21783</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib18">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Dumais (2004)</span>
<span class="ltx_bibblock">
Susan T Dumais.

</span>
<span class="ltx_bibblock">Latent semantic analysis.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib18.1.1">Annual Review of Information Science and Technology (ARIST)</em>,
38:189–230, 2004.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib19">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Fan et al. (2024)</span>
<span class="ltx_bibblock">
Simin Fan, Matteo Pagliardini, and Martin Jaggi.

</span>
<span class="ltx_bibblock">Doge: Domain reweighting with generalization estimation, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2310.15393" title="">https://arxiv.org/abs/2310.15393</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib20">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gao et al. (2021)</span>
<span class="ltx_bibblock">
Leo Gao, Stella Biderman, Sid Black, Laurence Golding, Travis Hoppe, Charles
Foster, Jason Phang, Horace He, Anish Thite, Noa Nabeshima, Shawn Presser,
and Connor Leahy.

</span>
<span class="ltx_bibblock">The pile: An 800gb dataset of diverse text for language modeling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib20.1.1">CoRR</em>, abs/2101.00027, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib21">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gao et al. (2024)</span>
<span class="ltx_bibblock">
Leo Gao, Jonathan Tow, Baber Abbasi, Stella Biderman, Sid Black, Anthony
DiPofi, Charles Foster, Laurence Golding, Jeffrey Hsu, Alain Le Noac’h,
Haonan Li, Kyle McDonell, Niklas Muennighoff, Chris Ociepa, Jason Phang,
Laria Reynolds, Hailey Schoelkopf, Aviya Skowron, Lintang Sutawika, Eric
Tang, Anish Thite, Ben Wang, Kevin Wang, and Andy Zou.

</span>
<span class="ltx_bibblock">A framework for few-shot language model evaluation, 07 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://zenodo.org/records/12608602" title="">https://zenodo.org/records/12608602</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib22">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Grangier et al. (2023)</span>
<span class="ltx_bibblock">
David Grangier, Pierre Ablin, and Awni Hannun.

</span>
<span class="ltx_bibblock">Adaptive training distributions with scalable online bilevel
optimization, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2311.11973" title="">https://arxiv.org/abs/2311.11973</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib23">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Grangier et al. (2024a)</span>
<span class="ltx_bibblock">
David Grangier, Angelos Katharopoulos, Pierre Ablin, and Awni Hannun.

</span>
<span class="ltx_bibblock">Projected language models: A large model pre-segmented into smaller
ones.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib23.1.1">ICML Workshop on Foundation Models in the Wild</em>,
2024a.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib24">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Grangier et al. (2024b)</span>
<span class="ltx_bibblock">
David Grangier, Angelos Katharopoulos, Pierre Ablin, and Awni Hannun.

</span>
<span class="ltx_bibblock">Specialized language models with cheap inference from limited domain
data, 2024b.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2402.01093" title="">https://arxiv.org/abs/2402.01093</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib25">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gunasekar et al. (2023)</span>
<span class="ltx_bibblock">
Suriya Gunasekar, Yi Zhang, Jyoti Aneja, Caio César Teodoro Mendes, Allie Del
Giorno, Sivakanth Gopi, Mojan Javaheripi, Piero Kauffmann, Gustavo de Rosa,
Olli Saarikivi, Adil Salim, Shital Shah, Harkirat Singh Behl, Xin Wang,
Sébastien Bubeck, Ronen Eldan, Adam Tauman Kalai, Yin Tat Lee, and Yuanzhi
Li.

</span>
<span class="ltx_bibblock">Textbooks are all you need, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2306.11644" title="">https://arxiv.org/abs/2306.11644</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib26">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Gururangan et al. (2020)</span>
<span class="ltx_bibblock">
Suchin Gururangan, Ana Marasović, Swabha Swayamdipta, Kyle Lo, Iz Beltagy,
Doug Downey, and Noah A. Smith.

</span>
<span class="ltx_bibblock">Don’t stop pretraining: Adapt language models to domains and tasks.

</span>
<span class="ltx_bibblock">In Dan Jurafsky, Joyce Chai, Natalie Schluter, and Joel Tetreault
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib26.1.1">Proceedings of the 58th Annual Meeting of the Association for
Computational Linguistics</em>, pp.  8342–8360, Online, July 2020. Association
for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/2020.acl-main.740</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2020.acl-main.740" title="">https://aclanthology.org/2020.acl-main.740</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib27">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Hendrycks et al. (2021)</span>
<span class="ltx_bibblock">
Dan Hendrycks, Collin Burns, Steven Basart, Andy Zou, Mantas Mazeika, Dawn
Song, and Jacob Steinhardt.

</span>
<span class="ltx_bibblock">Measuring massive multitask language understanding.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib27.1.1">International Conference on Learning Representations
(ICLR)</em>, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib28">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ilyas et al. (2022)</span>
<span class="ltx_bibblock">
Andrew Ilyas, Sung Min Park, Logan Engstrom, Guillaume Leclerc, and Aleksander
Madry.

</span>
<span class="ltx_bibblock">Datamodels: Predicting predictions from training data.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib28.1.1">arXiv preprint arXiv:2202.00622</em>, 2022.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib29">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Iter &amp; Grangier (2021)</span>
<span class="ltx_bibblock">
Dan Iter and David Grangier.

</span>
<span class="ltx_bibblock">On the complementarity of data selection and fine tuning for domain
adaptation, 2021.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2109.07591" title="">https://arxiv.org/abs/2109.07591</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib30">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jegou et al. (2010)</span>
<span class="ltx_bibblock">
Herve Jegou, Matthijs Douze, and Cordelia Schmid.

</span>
<span class="ltx_bibblock">Product quantization for nearest neighbor search.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib30.1.1">IEEE transactions on pattern analysis and machine
intelligence</em>, 33(1):117–128, 2010.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib31">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Jiang et al. (2024)</span>
<span class="ltx_bibblock">
Albert Q. Jiang, Alexandre Sablayrolles, Antoine Roux, Arthur Mensch, Blanche
Savary, Chris Bamford, Devendra Singh Chaplot, Diego de las Casas, Emma Bou
Hanna, Florian Bressand, Gianna Lengyel, Guillaume Bour, Guillaume Lample,
Lélio Renard Lavaud, Lucile Saulnier, Marie-Anne Lachaux, Pierre Stock,
Sandeep Subramanian, Sophia Yang, Szymon Antoniak, Teven Le Scao, Théophile
Gervet, Thibaut Lavril, Thomas Wang, Timothée Lacroix, and William El Sayed.

</span>
<span class="ltx_bibblock">Mixtral of experts, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2401.04088" title="">https://arxiv.org/abs/2401.04088</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib32">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Junczys-Dowmunt (2018)</span>
<span class="ltx_bibblock">
Marcin Junczys-Dowmunt.

</span>
<span class="ltx_bibblock">Dual conditional cross-entropy filtering of noisy parallel corpora.

</span>
<span class="ltx_bibblock">In Ondřej Bojar, Rajen Chatterjee, Christian Federmann, Mark
Fishel, Yvette Graham, Barry Haddow, Matthias Huck, Antonio Jimeno Yepes,
Philipp Koehn, Christof Monz, Matteo Negri, Aurélie Névéol,
Mariana Neves, Matt Post, Lucia Specia, Marco Turchi, and Karin Verspoor
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib32.1.1">Proceedings of the Third Conference on Machine Translation:
Shared Task Papers</em>, pp.  888–895, Belgium, Brussels, October 2018.
Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/W18-6478</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/W18-6478" title="">https://aclanthology.org/W18-6478</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib33">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kaddour (2023)</span>
<span class="ltx_bibblock">
Jean Kaddour.

</span>
<span class="ltx_bibblock">The minipile challenge for data-efficient language models, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2304.08442" title="">https://arxiv.org/abs/2304.08442</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib34">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kerner (2024)</span>
<span class="ltx_bibblock">
T Kerner.

</span>
<span class="ltx_bibblock">Domain-specific pretraining of language models: A comparative study
in the medical field.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib34.1.1">arXiv preprint arXiv:2407.14076</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib35">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kingma &amp; Ba (2015)</span>
<span class="ltx_bibblock">
Diederik P Kingma and Jimmy Ba.

</span>
<span class="ltx_bibblock">Adam: A method for stochastic optimization.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib35.1.1">International Conference on Learning Representations</em>, 2015.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib36">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Kong et al. (2024)</span>
<span class="ltx_bibblock">
Xiang Kong, Tom Gunter, and Ruoming Pang.

</span>
<span class="ltx_bibblock">Large language model-guided document selection, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2406.04638" title="">https://arxiv.org/abs/2406.04638</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib37">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Labrak et al. (2024)</span>
<span class="ltx_bibblock">
Yanis Labrak, Adrien Bazoge, Emmanuel Morin, Pierre-Antoine Gourraud, Mickael
Rouvier, and Richard Dufour.

</span>
<span class="ltx_bibblock">Biomistral: A collection of open-source pretrained large language
models for medical domains, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2402.10373" title="">https://arxiv.org/abs/2402.10373</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib38">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lambert et al. (2024)</span>
<span class="ltx_bibblock">
Nathan Lambert, Valentina Pyatkin, Jacob Morrison, LJ Miranda, Bill Yuchen Lin,
Khyathi Chandu, Nouha Dziri, Sachin Kumar, Tom Zick, Yejin Choi, Noah A.
Smith, and Hannaneh Hajishirzi.

</span>
<span class="ltx_bibblock">Rewardbench: Evaluating reward models for language modeling, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2403.13787" title="">https://arxiv.org/abs/2403.13787</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib39">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lee (2021)</span>
<span class="ltx_bibblock">
Edmund Lee.

</span>
<span class="ltx_bibblock">What happens when a publisher becomes a megapublisher?

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib39.1.1">New York Times</em>, 2021.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.nytimes.com/2021/02/25/books/penguin-random-house-simon-schuster-publishing.html" title="">https://www.nytimes.com/2021/02/25/books/penguin-random-house-simon-schuster-publishing.html</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib40">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lee et al. (2022)</span>
<span class="ltx_bibblock">
Katherine Lee, Daphne Ippolito, Andrew Nystrom, Chiyuan Zhang, Douglas Eck,
Chris Callison-Burch, and Nicholas Carlini.

</span>
<span class="ltx_bibblock">Deduplicating training data makes language models better.

</span>
<span class="ltx_bibblock">In Smaranda Muresan, Preslav Nakov, and Aline Villavicencio (eds.),
<em class="ltx_emph ltx_font_italic" id="bib.bib40.1.1">Proceedings of the 60th Annual Meeting of the Association for
Computational Linguistics (Volume 1: Long Papers)</em>, pp.  8424–8445, Dublin,
Ireland, May 2022. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/2022.acl-long.577</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2022.acl-long.577" title="">https://aclanthology.org/2022.acl-long.577</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib41">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewis et al. (2020)</span>
<span class="ltx_bibblock">
Patrick Lewis, Myle Ott, Jingfei Du, and Veselin Stoyanov.

</span>
<span class="ltx_bibblock">Pretrained language models for biomedical and clinical tasks:
Understanding and extending the state-of-the-art.

</span>
<span class="ltx_bibblock">In Anna Rumshisky, Kirk Roberts, Steven Bethard, and Tristan Naumann
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib41.1.1">Proceedings of the 3rd Clinical Natural Language Processing
Workshop</em>, pp.  146–157, Online, November 2020. Association for
Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/2020.clinicalnlp-1.17</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2020.clinicalnlp-1.17" title="">https://aclanthology.org/2020.clinicalnlp-1.17</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib42">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Lewkowycz et al. (2022)</span>
<span class="ltx_bibblock">
Aitor Lewkowycz, Anders Andreassen, David Dohan, Ethan Dyer, Henryk
Michalewski, Vinay Ramasesh, Ambrose Slone, Cem Anil, Imanol Schlag, Theo
Gutman-Solo, Yuhuai Wu, Behnam Neyshabur, Guy Gur-Ari, and Vedant Misra.

</span>
<span class="ltx_bibblock">Solving quantitative reasoning problems with language models, 2022.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2206.14858" title="">https://arxiv.org/abs/2206.14858</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib43">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Li et al. (2024)</span>
<span class="ltx_bibblock">
Jeffrey Li, Alex Fang, Georgios Smyrnis, Maor Ivgi, Matt Jordan, Samir Gadre,
Hritik Bansal, Etash Guha, Sedrick Keh, Kushal Arora, Saurabh Garg, Rui Xin,
Niklas Muennighoff, Reinhard Heckel, Jean Mercat, Mayee Chen, Suchin
Gururangan, Mitchell Wortsman, Alon Albalak, Yonatan Bitton, Marianna
Nezhurina, Amro Abbas, Cheng-Yu Hsieh, Dhruba Ghosh, Josh Gardner, Maciej
Kilian, Hanlin Zhang, Rulin Shao, Sarah Pratt, Sunny Sanyal, Gabriel Ilharco,
Giannis Daras, Kalyani Marathe, Aaron Gokaslan, Jieyu Zhang, Khyathi Chandu,
Thao Nguyen, Igor Vasiljevic, Sham Kakade, Shuran Song, Sujay Sanghavi,
Fartash Faghri, Sewoong Oh, Luke Zettlemoyer, Kyle Lo, Alaaeldin El-Nouby,
Hadi Pouransari, Alexander Toshev, Stephanie Wang, Dirk Groeneveld, Luca
Soldaini, Pang Wei Koh, Jenia Jitsev, Thomas Kollar, Alexandros G. Dimakis,
Yair Carmon, Achal Dave, Ludwig Schmidt, and Vaishaal Shankar.

</span>
<span class="ltx_bibblock">Datacomp-lm: In search of the next generation of training sets for
language models, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2406.11794" title="">https://arxiv.org/abs/2406.11794</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib44">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Liu et al. (2019)</span>
<span class="ltx_bibblock">
Miaofeng Liu, Yan Song, Hongbin Zou, and Tong Zhang.

</span>
<span class="ltx_bibblock">Reinforced training data selection for domain adaptation.

</span>
<span class="ltx_bibblock">In Anna Korhonen, David Traum, and Lluís Màrquez (eds.),
<em class="ltx_emph ltx_font_italic" id="bib.bib44.1.1">Proceedings of the 57th Annual Meeting of the Association for
Computational Linguistics</em>, pp.  1957–1968, Florence, Italy, July 2019.
Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/P19-1189</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/P19-1189" title="">https://aclanthology.org/P19-1189</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib45">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Maini et al. (2024)</span>
<span class="ltx_bibblock">
Pratyush Maini, Skyler Seto, Richard Bai, David Grangier, Yizhe Zhang, and
Navdeep Jaitly.

</span>
<span class="ltx_bibblock">Rephrasing the web: A recipe for compute and data-efficient language
modeling.

</span>
<span class="ltx_bibblock">In Lun-Wei Ku, Andre Martins, and Vivek Srikumar (eds.),
<em class="ltx_emph ltx_font_italic" id="bib.bib45.1.1">Proceedings of the 62nd Annual Meeting of the Association for
Computational Linguistics (Volume 1: Long Papers)</em>, pp.  14044–14072,
Bangkok, Thailand, August 2024. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/2024.acl-long.757" title="">https://aclanthology.org/2024.acl-long.757</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib46">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Minaee et al. (2021)</span>
<span class="ltx_bibblock">
Shervin Minaee, Nal Kalchbrenner, Erik Cambria, Narjes Nikzad, Meysam
Chenaghlu, and Jianfeng Gao.

</span>
<span class="ltx_bibblock">Deep learning–based text classification: a comprehensive review.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib46.1.1">ACM computing surveys (CSUR)</em>, 54(3):1–40,
2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib47">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Moore &amp; Lewis (2010)</span>
<span class="ltx_bibblock">
Robert C. Moore and William Lewis.

</span>
<span class="ltx_bibblock">Intelligent selection of language model training data.

</span>
<span class="ltx_bibblock">In Jan Hajič, Sandra Carberry, Stephen Clark, and Joakim Nivre
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib47.1.1">Proceedings of the ACL 2010 Conference Short Papers</em>, pp. 220–224, Uppsala, Sweden, July 2010. Association for Computational
Linguistics.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/P10-2041" title="">https://aclanthology.org/P10-2041</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib48">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Muennighoff et al. (2023)</span>
<span class="ltx_bibblock">
Niklas Muennighoff, Alexander M Rush, Boaz Barak, Teven Le Scao, Aleksandra
Piktus, Nouamane Tazi, Sampo Pyysalo, Thomas Wolf, and Colin Raffel.

</span>
<span class="ltx_bibblock">Scaling data-constrained language models.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib48.1.1">arXiv preprint arXiv:2305.16264</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib49">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Parmar et al. (2024)</span>
<span class="ltx_bibblock">
Jupinder Parmar, Sanjev Satheesh, Mostofa Patwary, Mohammad Shoeybi, and Bryan
Catanzaro.

</span>
<span class="ltx_bibblock">Reuse, don’t retrain: A recipe for continued pretraining of language
models, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2407.07263" title="">https://arxiv.org/abs/2407.07263</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib50">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Penedo et al. (2023)</span>
<span class="ltx_bibblock">
Guilherme Penedo, Quentin Malartic, Daniel Hesslow, Ruxandra Cojocaru,
Alessandro Cappelli, Hamza Alobeidli, Baptiste Pannier, Ebtesam Almazrouei,
and Julien Launay.

</span>
<span class="ltx_bibblock">The refinedweb dataset for falcon llm: Outperforming curated corpora
with web data, and web data only, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2306.01116" title="">https://arxiv.org/abs/2306.01116</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib51">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Pruthi et al. (2020)</span>
<span class="ltx_bibblock">
Garima Pruthi, Frederick Liu, Satyen Kale, and Mukund Sundararajan.

</span>
<span class="ltx_bibblock">Estimating training data influence by tracing gradient descent.

</span>
<span class="ltx_bibblock">In H. Larochelle, M. Ranzato, R. Hadsell, M.F. Balcan, and H. Lin
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib51.1.1">Advances in Neural Information Processing Systems</em>, volume 33,
pp.  19920–19930. Curran Associates, Inc., 2020.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2020/file/e6385d39ec9394f2f3a354d9d2b88eec-Paper.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2020/file/e6385d39ec9394f2f3a354d9d2b88eec-Paper.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib52">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Raghu et al. (2021)</span>
<span class="ltx_bibblock">
Aniruddh Raghu, Jonathan Lorraine, Simon Kornblith, Matthew McDermott, and
David K Duvenaud.

</span>
<span class="ltx_bibblock">Meta-learning to improve pre-training.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib52.1.1">Advances in Neural Information Processing Systems</em>,
34:23231–23244, 2021.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib53">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Reimers &amp; Gurevych (2019)</span>
<span class="ltx_bibblock">
Nils Reimers and Iryna Gurevych.

</span>
<span class="ltx_bibblock">Sentence-BERT: Sentence embeddings using Siamese BERT-networks.

</span>
<span class="ltx_bibblock">In Kentaro Inui, Jing Jiang, Vincent Ng, and Xiaojun Wan (eds.),
<em class="ltx_emph ltx_font_italic" id="bib.bib53.1.1">Proceedings of the 2019 Conference on Empirical Methods in Natural
Language Processing and the 9th International Joint Conference on Natural
Language Processing (EMNLP-IJCNLP)</em>, pp.  3982–3992, Hong Kong, China,
November 2019. Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/D19-1410</span>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib54">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Rozière et al. (2024)</span>
<span class="ltx_bibblock">
Baptiste Rozière, Jonas Gehring, Fabian Gloeckle, Sten Sootla, Itai Gat,
Xiaoqing Ellen Tan, Yossi Adi, Jingyu Liu, Romain Sauvestre, Tal Remez,
Jérémy Rapin, Artyom Kozhevnikov, Ivan Evtimov, Joanna Bitton, Manish
Bhatt, Cristian Canton Ferrer, Aaron Grattafiori, Wenhan Xiong, Alexandre
Défossez, Jade Copet, Faisal Azhar, Hugo Touvron, Louis Martin, Nicolas
Usunier, Thomas Scialom, and Gabriel Synnaeve.

</span>
<span class="ltx_bibblock">Code llama: Open foundation models for code, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2308.12950" title="">https://arxiv.org/abs/2308.12950</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib55">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Ruder &amp; Plank (2017)</span>
<span class="ltx_bibblock">
Sebastian Ruder and Barbara Plank.

</span>
<span class="ltx_bibblock">Learning to select data for transfer learning with Bayesian
optimization.

</span>
<span class="ltx_bibblock">In Martha Palmer, Rebecca Hwa, and Sebastian Riedel (eds.),
<em class="ltx_emph ltx_font_italic" id="bib.bib55.1.1">Proceedings of the 2017 Conference on Empirical Methods in Natural
Language Processing</em>, pp.  372–382, Copenhagen, Denmark, September 2017.
Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/D17-1038</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/D17-1038" title="">https://aclanthology.org/D17-1038</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib56">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Seiffert et al. (2008)</span>
<span class="ltx_bibblock">
Chris Seiffert, Taghi M Khoshgoftaar, Jason Van Hulse, and Amri Napolitano.

</span>
<span class="ltx_bibblock">Resampling or reweighting: A comparison of boosting implementations.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib56.1.1">2008 20th IEEE international conference on tools with
artificial intelligence</em>, volume 1, pp.  445–451. IEEE, 2008.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib57">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sennrich et al. (2016a)</span>
<span class="ltx_bibblock">
Rico Sennrich, Barry Haddow, and Alexandra Birch.

</span>
<span class="ltx_bibblock">Edinburgh neural machine translation systems for WMT 16.

</span>
<span class="ltx_bibblock">In Ondřej Bojar, Christian Buck, Rajen Chatterjee, Christian
Federmann, Liane Guillou, Barry Haddow, Matthias Huck, Antonio Jimeno Yepes,
Aurélie Névéol, Mariana Neves, Pavel Pecina, Martin Popel,
Philipp Koehn, Christof Monz, Matteo Negri, Matt Post, Lucia Specia, Karin
Verspoor, Jörg Tiedemann, and Marco Turchi (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib57.1.1">Proceedings of
the First Conference on Machine Translation: Volume 2, Shared Task Papers</em>,
pp.  371–376, Berlin, Germany, August 2016a. Association for
Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/W16-2323</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/W16-2323" title="">https://aclanthology.org/W16-2323</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib58">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Sennrich et al. (2016b)</span>
<span class="ltx_bibblock">
Rico Sennrich, Barry Haddow, and Alexandra Birch.

</span>
<span class="ltx_bibblock">Neural machine translation of rare words with subword units.

</span>
<span class="ltx_bibblock">In Katrin Erk and Noah A. Smith (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib58.1.1">Proceedings of the 54th
Annual Meeting of the Association for Computational Linguistics (Volume 1:
Long Papers)</em>, pp.  1715–1725, Berlin, Germany, August 2016b.
Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/P16-1162</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/P16-1162" title="">https://aclanthology.org/P16-1162</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib59">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Su et al. (2023)</span>
<span class="ltx_bibblock">
Hongjin Su, Jungo Kasai, Chen Henry Wu, Weijia Shi, Tianlu Wang, Jiayi Xin, Rui
Zhang, Mari Ostendorf, Luke Zettlemoyer, Noah A. Smith, and Tao Yu.

</span>
<span class="ltx_bibblock">Selective annotation makes language models better few-shot learners.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib59.1.1">International Conference on Learning Representations
(ICLR)</em>, 2023.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib60">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Together AI Team (2023)</span>
<span class="ltx_bibblock">
Together AI Team.

</span>
<span class="ltx_bibblock">Redpajama-data-v2: An open dataset with 30 trillion tokens for
training large language models, October 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://www.together.ai/blog/redpajama-data-v2" title="">https://www.together.ai/blog/redpajama-data-v2</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib61">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vaswani et al. (2017)</span>
<span class="ltx_bibblock">
Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones,
Aidan N Gomez, Ł ukasz Kaiser, and Illia Polosukhin.

</span>
<span class="ltx_bibblock">Attention is all you need.

</span>
<span class="ltx_bibblock">In I. Guyon, U. Von Luxburg, S. Bengio, H. Wallach, R. Fergus,
S. Vishwanathan, and R. Garnett (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib61.1.1">Advances in Neural Information
Processing Systems</em>, volume 30. Curran Associates, Inc., 2017.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib62">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Vo et al. (2024)</span>
<span class="ltx_bibblock">
Huy V. Vo, Vasil Khalidov, Timothée Darcet, Théo Moutakanni, Nikita Smetanin,
Marc Szafraniec, Hugo Touvron, Camille Couprie, Maxime Oquab, Armand Joulin,
Hervé Jégou, Patrick Labatut, and Piotr Bojanowski.

</span>
<span class="ltx_bibblock">Automatic data curation for self-supervised learning: A
clustering-based approach, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2405.15613" title="">https://arxiv.org/abs/2405.15613</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib63">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2018)</span>
<span class="ltx_bibblock">
Wei Wang, Taro Watanabe, Macduff Hughes, Tetsuji Nakagawa, and Ciprian Chelba.

</span>
<span class="ltx_bibblock">Denoising neural machine translation training with trusted data and
online data selection.

</span>
<span class="ltx_bibblock">In Ondřej Bojar, Rajen Chatterjee, Christian Federmann, Mark
Fishel, Yvette Graham, Barry Haddow, Matthias Huck, Antonio Jimeno Yepes,
Philipp Koehn, Christof Monz, Matteo Negri, Aurélie Névéol,
Mariana Neves, Matt Post, Lucia Specia, Marco Turchi, and Karin Verspoor
(eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib63.1.1">Proceedings of the Third Conference on Machine Translation:
Research Papers</em>, pp.  133–143, Brussels, Belgium, October 2018.
Association for Computational Linguistics.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.18653/v1/W18-6314</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://aclanthology.org/W18-6314" title="">https://aclanthology.org/W18-6314</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib64">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wang et al. (2020)</span>
<span class="ltx_bibblock">
Zirui Wang, Yulia Tsvetkov, Orhan Firat, and Yuan Cao.

</span>
<span class="ltx_bibblock">Gradient vaccine: Investigating and improving multi-task optimization
in massively multilingual models, 2020.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2010.05874" title="">https://arxiv.org/abs/2010.05874</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib65">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wenzek et al. (2020)</span>
<span class="ltx_bibblock">
G. Wenzek, M. A. Lachaux, A. Conneau, V. Chaudhary, F. Guzmán, A. Joulin,
and E. Grave.

</span>
<span class="ltx_bibblock">Ccnet: Extracting high quality monolingual datasets from web crawl
data.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib65.1.1">Proceedings of The 12th Language Resources and Evaluation
Conference</em>, pp.  4003–4012, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib66">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Wu et al. (2023)</span>
<span class="ltx_bibblock">
Shijie Wu, Ozan Irsoy, Steven Lu, Vadim Dabravolski, Mark Dredze, Sebastian
Gehrmann, Prabhanjan Kambadur, David Rosenberg, and Gideon Mann.

</span>
<span class="ltx_bibblock">Bloomberggpt: A large language model for finance, 2023.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2303.17564" title="">https://arxiv.org/abs/2303.17564</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib67">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xia et al. (2024)</span>
<span class="ltx_bibblock">
Mengzhou Xia, Sadhika Malladi, Suchin Gururangan, Sanjeev Arora, and Danqi
Chen.

</span>
<span class="ltx_bibblock">LESS: Selecting influential data for targeted instruction tuning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib67.1.1">International Conference on Machine Learning (ICML)</em>, 2024.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib68">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xie et al. (2023a)</span>
<span class="ltx_bibblock">
Qianqian Xie, Weiguang Han, Xiao Zhang, Yanzhao Lai, Min Peng, Alejandro
Lopez-Lira, and Jimin Huang.

</span>
<span class="ltx_bibblock">Pixiu: A large language model, instruction data and evaluation
benchmark for finance, 2023a.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2306.05443" title="">https://arxiv.org/abs/2306.05443</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib69">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xie et al. (2023b)</span>
<span class="ltx_bibblock">
Sang Michael Xie, Hieu Pham, Xuanyi Dong, Nan Du, Hanxiao Liu, Yifeng Lu,
Percy S Liang, Quoc V Le, Tengyu Ma, and Adams Wei Yu.

</span>
<span class="ltx_bibblock">Doremi: Optimizing data mixtures speeds up language model
pretraining.

</span>
<span class="ltx_bibblock">In A. Oh, T. Naumann, A. Globerson, K. Saenko, M. Hardt, and
S. Levine (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib69.1.1">Advances in Neural Information Processing Systems</em>,
volume 36, pp.  69798–69818. Curran Associates, Inc., 2023b.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2023/file/dcba6be91359358c2355cd920da3fcbd-Paper-Conference.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2023/file/dcba6be91359358c2355cd920da3fcbd-Paper-Conference.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib70">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xie et al. (2023c)</span>
<span class="ltx_bibblock">
Sang Michael Xie, Shibani Santurkar, Tengyu Ma, and Percy Liang.

</span>
<span class="ltx_bibblock">Data selection for language models via importance resampling.

</span>
<span class="ltx_bibblock"><em class="ltx_emph ltx_font_italic" id="bib.bib70.1.1">CoRR</em>, abs/2302.03169, 2023c.

</span>
<span class="ltx_bibblock">doi: <span class="ltx_ref ltx_nolink ltx_Url ltx_ref_self">10.48550/ARXIV.2302.03169</span>.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://doi.org/10.48550/arXiv.2302.03169" title="">https://doi.org/10.48550/arXiv.2302.03169</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib71">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xu et al. (2024)</span>
<span class="ltx_bibblock">
Zhipeng Xu, Zhenghao Liu, Yukun Yan, Zhiyuan Liu, Ge Yu, and Chenyan Xiong.

</span>
<span class="ltx_bibblock">Cleaner pretraining corpus curation with neural web scraping, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2402.14652" title="">https://arxiv.org/abs/2402.14652</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib72">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Xue et al. (2023)</span>
<span class="ltx_bibblock">
Fuzhao Xue, Yao Fu, Wangchunshu Zhou, Zangwei Zheng, and Yang You.

</span>
<span class="ltx_bibblock">To repeat or not to repeat: Insights from scaling llm under
token-crisis.

</span>
<span class="ltx_bibblock">In A. Oh, T. Naumann, A. Globerson, K. Saenko, M. Hardt, and
S. Levine (eds.), <em class="ltx_emph ltx_font_italic" id="bib.bib72.1.1">Advances in Neural Information Processing Systems</em>,
volume 36, pp.  59304–59322. Curran Associates, Inc., 2023.

</span>
<span class="ltx_bibblock">URL
<a class="ltx_ref ltx_url ltx_font_typewriter" href="https://proceedings.neurips.cc/paper_files/paper/2023/file/b9e472cd579c83e2f6aa3459f46aac28-Paper-Conference.pdf" title="">https://proceedings.neurips.cc/paper_files/paper/2023/file/b9e472cd579c83e2f6aa3459f46aac28-Paper-Conference.pdf</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib73">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yoon et al. (2020)</span>
<span class="ltx_bibblock">
Jinsung Yoon, Sercan Arik, and Tomas Pfister.

</span>
<span class="ltx_bibblock">Data valuation using reinforcement learning.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib73.1.1">International Conference on Machine Learning</em>, pp. 10842–10851. PMLR, 2020.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib74">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Yu et al. (2024)</span>
<span class="ltx_bibblock">
Zichun Yu, Spandan Das, and Chenyan Xiong.

</span>
<span class="ltx_bibblock">Mates: Model-aware data selection for efficient pretraining with data
influence models, 2024.

</span>
<span class="ltx_bibblock">URL <a class="ltx_ref ltx_url ltx_font_typewriter" href="https://arxiv.org/abs/2406.06046" title="">https://arxiv.org/abs/2406.06046</a>.

</span>
</li>
<li class="ltx_bibitem" id="bib.bib75">
<span class="ltx_tag ltx_role_refnum ltx_tag_bibitem">Zhang et al. (2024)</span>
<span class="ltx_bibblock">
Shaokun Zhang, Xiaobo Xia, Zhaoqing Wang, Ling-Hao Chen, Jiale Liu, Qingyun Wu,
and Tongliang Liu.

</span>
<span class="ltx_bibblock">IDEAL: Influence-driven selective annotations empower in-context
learners in large language models.

</span>
<span class="ltx_bibblock">In <em class="ltx_emph ltx_font_italic" id="bib.bib75.1.1">International Conference on Learning Representations
(ICLR)</em>, 2024.

</span>
</li>
</ul>
</section>
<div class="ltx_pagination ltx_role_newpage"></div>
<section class="ltx_appendix" id="Ax1">
<h2 class="ltx_title ltx_title_appendix">Appendix</h2>
</section>
<section class="ltx_appendix" id="A1">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix A </span>Scalable Clustering</h2>
<div class="ltx_para ltx_noindent" id="A1.p1">
<p class="ltx_p" id="A1.p1.1">We cluster the Redpj2 dataset with hierarchical clustering.
We build a clustering tree. Each node in the tree is associated with a cluster centroid.
The examples traverse the tree from top to bottom, selecting the node corresponding to
the closest centroids among the current node’s children.</p>
</div>
<div class="ltx_para ltx_noindent" id="A1.p2">
<p class="ltx_p" id="A1.p2.2">The training of the tree proceed from root to leaves. Iteratively, a new level is built
by applying k-means to a subset of the examples belonging to each node. We built a tree
of depth up to <math alttext="4" class="ltx_Math" display="inline" id="A1.p2.1.m1.1"><semantics id="A1.p2.1.m1.1a"><mn id="A1.p2.1.m1.1.1" xref="A1.p2.1.m1.1.1.cmml">4</mn><annotation-xml encoding="MathML-Content" id="A1.p2.1.m1.1b"><cn id="A1.p2.1.m1.1.1.cmml" type="integer" xref="A1.p2.1.m1.1.1">4</cn></annotation-xml><annotation encoding="application/x-tex" id="A1.p2.1.m1.1c">4</annotation><annotation encoding="application/x-llamapun" id="A1.p2.1.m1.1d">4</annotation></semantics></math>, always splitting nodes in 64 clusters. For k-means, we normalize the Euclidean norm of the vectors prior to clustering. We train the model via Expectation Maximization using k-means++ initialization <cite class="ltx_cite ltx_citemacro_citep">(Arthur &amp; Vassilvitskii, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib4" title="">2006</a>)</cite>. At each step, we sample 6,400 new examples. With 20 steps, we visit 128k examples. To ensure a cluster distribution close to uniform, we monitor the cluster sizes at each assignment steps. If a cluster is larger than our balancing limit <math alttext="(0.022\simeq 1.5*1/64)" class="ltx_Math" display="inline" id="A1.p2.2.m2.1"><semantics id="A1.p2.2.m2.1a"><mrow id="A1.p2.2.m2.1.1.1" xref="A1.p2.2.m2.1.1.1.1.cmml"><mo id="A1.p2.2.m2.1.1.1.2" stretchy="false" xref="A1.p2.2.m2.1.1.1.1.cmml">(</mo><mrow id="A1.p2.2.m2.1.1.1.1" xref="A1.p2.2.m2.1.1.1.1.cmml"><mn id="A1.p2.2.m2.1.1.1.1.2" xref="A1.p2.2.m2.1.1.1.1.2.cmml">0.022</mn><mo id="A1.p2.2.m2.1.1.1.1.1" xref="A1.p2.2.m2.1.1.1.1.1.cmml">≃</mo><mrow id="A1.p2.2.m2.1.1.1.1.3" xref="A1.p2.2.m2.1.1.1.1.3.cmml"><mrow id="A1.p2.2.m2.1.1.1.1.3.2" xref="A1.p2.2.m2.1.1.1.1.3.2.cmml"><mn id="A1.p2.2.m2.1.1.1.1.3.2.2" xref="A1.p2.2.m2.1.1.1.1.3.2.2.cmml">1.5</mn><mo id="A1.p2.2.m2.1.1.1.1.3.2.1" lspace="0.222em" rspace="0.222em" xref="A1.p2.2.m2.1.1.1.1.3.2.1.cmml">∗</mo><mn id="A1.p2.2.m2.1.1.1.1.3.2.3" xref="A1.p2.2.m2.1.1.1.1.3.2.3.cmml">1</mn></mrow><mo id="A1.p2.2.m2.1.1.1.1.3.1" xref="A1.p2.2.m2.1.1.1.1.3.1.cmml">/</mo><mn id="A1.p2.2.m2.1.1.1.1.3.3" xref="A1.p2.2.m2.1.1.1.1.3.3.cmml">64</mn></mrow></mrow><mo id="A1.p2.2.m2.1.1.1.3" stretchy="false" xref="A1.p2.2.m2.1.1.1.1.cmml">)</mo></mrow><annotation-xml encoding="MathML-Content" id="A1.p2.2.m2.1b"><apply id="A1.p2.2.m2.1.1.1.1.cmml" xref="A1.p2.2.m2.1.1.1"><csymbol cd="latexml" id="A1.p2.2.m2.1.1.1.1.1.cmml" xref="A1.p2.2.m2.1.1.1.1.1">similar-to-or-equals</csymbol><cn id="A1.p2.2.m2.1.1.1.1.2.cmml" type="float" xref="A1.p2.2.m2.1.1.1.1.2">0.022</cn><apply id="A1.p2.2.m2.1.1.1.1.3.cmml" xref="A1.p2.2.m2.1.1.1.1.3"><divide id="A1.p2.2.m2.1.1.1.1.3.1.cmml" xref="A1.p2.2.m2.1.1.1.1.3.1"></divide><apply id="A1.p2.2.m2.1.1.1.1.3.2.cmml" xref="A1.p2.2.m2.1.1.1.1.3.2"><times id="A1.p2.2.m2.1.1.1.1.3.2.1.cmml" xref="A1.p2.2.m2.1.1.1.1.3.2.1"></times><cn id="A1.p2.2.m2.1.1.1.1.3.2.2.cmml" type="float" xref="A1.p2.2.m2.1.1.1.1.3.2.2">1.5</cn><cn id="A1.p2.2.m2.1.1.1.1.3.2.3.cmml" type="integer" xref="A1.p2.2.m2.1.1.1.1.3.2.3">1</cn></apply><cn id="A1.p2.2.m2.1.1.1.1.3.3.cmml" type="integer" xref="A1.p2.2.m2.1.1.1.1.3.3">64</cn></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A1.p2.2.m2.1c">(0.022\simeq 1.5*1/64)</annotation><annotation encoding="application/x-llamapun" id="A1.p2.2.m2.1d">( 0.022 ≃ 1.5 ∗ 1 / 64 )</annotation></semantics></math>, we split evenly at random its assignments with the smallest cluster, as suggested by <cite class="ltx_cite ltx_citemacro_cite">Jegou et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib30" title="">2010</a>)</cite>.
The clustering hyper-parameters can be found in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A3.T6" title="Table 6 ‣ Appendix C Architectures &amp; Hyperparameters ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">6</span></a>.</p>
</div>
</section>
<section class="ltx_appendix" id="A2">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix B </span>Dataset Statistics</h2>
<figure class="ltx_table" id="A2.T2">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 2: </span>LM Datasets.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A2.T2.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A2.T2.1.1.1">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A2.T2.1.1.1.1"></th>
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="A2.T2.1.1.1.2"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A2.T2.1.1.1.3">Redpj2</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A2.T2.1.1.1.4">PubMed</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A2.T2.1.1.1.5">StackExchange</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A2.T2.1.1.1.6">Wikipedia</th>
</tr>
<tr class="ltx_tr" id="A2.T2.1.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" colspan="2" id="A2.T2.1.2.2.1">Dataset role</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A2.T2.1.2.2.2"><span class="ltx_text ltx_font_italic" id="A2.T2.1.2.2.2.1">generalist</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A2.T2.1.2.2.3"><span class="ltx_text ltx_font_italic" id="A2.T2.1.2.2.3.1">specialist</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" id="A2.T2.1.2.2.4"><span class="ltx_text ltx_font_italic" id="A2.T2.1.2.2.4.1">specialist</span></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A2.T2.1.2.2.5"><span class="ltx_text ltx_font_italic" id="A2.T2.1.2.2.5.1">specialist</span></th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A2.T2.1.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A2.T2.1.3.1.1">Train</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A2.T2.1.3.1.2">Num. tokens</th>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T2.1.3.1.3">34.6T</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T2.1.3.1.4">26.7B</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T2.1.3.1.5">10.3B</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A2.T2.1.3.1.6">4.68B</td>
</tr>
<tr class="ltx_tr" id="A2.T2.1.4.2">
<th class="ltx_td ltx_th ltx_th_row" id="A2.T2.1.4.2.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A2.T2.1.4.2.2">Num. documents</th>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T2.1.4.2.3">24.0B</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T2.1.4.2.4">2.94m</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T2.1.4.2.5">15.4m</td>
<td class="ltx_td ltx_align_right" id="A2.T2.1.4.2.6">5.79m</td>
</tr>
<tr class="ltx_tr" id="A2.T2.1.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A2.T2.1.5.3.1">Test</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A2.T2.1.5.3.2">Num. tokens</th>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T2.1.5.3.3">359m</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T2.1.5.3.4">52.4m</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T2.1.5.3.5">20.1m</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A2.T2.1.5.3.6">14.1m</td>
</tr>
<tr class="ltx_tr" id="A2.T2.1.6.4">
<th class="ltx_td ltx_th ltx_th_row ltx_border_bb" id="A2.T2.1.6.4.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="A2.T2.1.6.4.2">Num. documents</th>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r" id="A2.T2.1.6.4.3">248k</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r" id="A2.T2.1.6.4.4">5.82k</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r" id="A2.T2.1.6.4.5">29.9k</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A2.T2.1.6.4.6">17.4k</td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_table" id="A2.T3">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 3: </span>MCQ Datasets.</figcaption>
<table class="ltx_tabular ltx_centering ltx_align_middle" id="A2.T3.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A2.T3.1.1.1">
<td class="ltx_td ltx_border_tt" id="A2.T3.1.1.1.1"></td>
<td class="ltx_td ltx_border_r ltx_border_tt" id="A2.T3.1.1.1.2"></td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A2.T3.1.1.1.3">ARC-E</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A2.T3.1.1.1.4">ARC-C</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A2.T3.1.1.1.5">MMLU</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A2.T3.1.1.1.6">RWDB-R</td>
</tr>
<tr class="ltx_tr" id="A2.T3.1.2.2">
<td class="ltx_td ltx_align_left ltx_border_tt" id="A2.T3.1.2.2.1">Train</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_tt" id="A2.T3.1.2.2.2">Num. tokens</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A2.T3.1.2.2.3">143k</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A2.T3.1.2.2.4">79.6k</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A2.T3.1.2.2.5">2.05m</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A2.T3.1.2.2.6">426k</td>
</tr>
<tr class="ltx_tr" id="A2.T3.1.3.3">
<td class="ltx_td" id="A2.T3.1.3.3.1"></td>
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T3.1.3.3.2">Num. questions</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.3.3.3">1.18k</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.3.3.4">578</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.3.3.5">6.95k</td>
<td class="ltx_td ltx_align_right" id="A2.T3.1.3.3.6">736</td>
</tr>
<tr class="ltx_tr" id="A2.T3.1.4.4">
<td class="ltx_td" id="A2.T3.1.4.4.1"></td>
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T3.1.4.4.2">Avg. tokens per choice</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.4.4.3">30.3</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.4.4.4">34.5</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.4.4.5">73.5</td>
<td class="ltx_td ltx_align_right" id="A2.T3.1.4.4.6">289</td>
</tr>
<tr class="ltx_tr" id="A2.T3.1.5.5">
<td class="ltx_td ltx_align_left ltx_border_t" id="A2.T3.1.5.5.1">Test</td>
<td class="ltx_td ltx_align_left ltx_border_r ltx_border_t" id="A2.T3.1.5.5.2">Num. tokens</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T3.1.5.5.3">144k</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T3.1.5.5.4">87.7k</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A2.T3.1.5.5.5">2.09m</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A2.T3.1.5.5.6">408k</td>
</tr>
<tr class="ltx_tr" id="A2.T3.1.6.6">
<td class="ltx_td" id="A2.T3.1.6.6.1"></td>
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T3.1.6.6.2">Num. questions</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.6.6.3">1.19k</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.6.6.4">593</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.6.6.5">7.09k</td>
<td class="ltx_td ltx_align_right" id="A2.T3.1.6.6.6">695</td>
</tr>
<tr class="ltx_tr" id="A2.T3.1.7.7">
<td class="ltx_td" id="A2.T3.1.7.7.1"></td>
<td class="ltx_td ltx_align_left ltx_border_r" id="A2.T3.1.7.7.2">Avg. tokens per choice</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.7.7.3">30.2</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.7.7.4">37.0</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A2.T3.1.7.7.5">73.6</td>
<td class="ltx_td ltx_align_right" id="A2.T3.1.7.7.6">293</td>
</tr>
<tr class="ltx_tr" id="A2.T3.1.8.8">
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_r ltx_border_t" colspan="2" id="A2.T3.1.8.8.1">Num. choices per question</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r ltx_border_t" id="A2.T3.1.8.8.2">4</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r ltx_border_t" id="A2.T3.1.8.8.3">4</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r ltx_border_t" id="A2.T3.1.8.8.4">4</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_t" id="A2.T3.1.8.8.5">2</td>
</tr>
</tbody>
</table>
</figure>
<div class="ltx_para ltx_noindent" id="A2.p1">
<p class="ltx_p" id="A2.p1.1">Our generic pretraining set is Redpj2 <cite class="ltx_cite ltx_citemacro_citep">(Together AI Team, <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib60" title="">2023</a>)</cite>. We use the head+middle English version of the dataset, i.e. web-documents with a high density of English text. Our specialization datasets for language modeling are much smaller, see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2.T2" title="Table 2 ‣ Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">2</span></a>.
Compared the LM tasks, the multiple choice question tasks have even smaller specialization training set, i.e. between 200k and 2m tokens, see Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A2.T3" title="Table 3 ‣ Appendix B Dataset Statistics ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">3</span></a>. For the LM data, we rely on the train split provided by Pile <cite class="ltx_cite ltx_citemacro_cite">Gao et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib20" title="">2021</a>)</cite>.
For the MCQ data, we split each evaluation set into an equal sized train and test set uniformly at random. This provides a representative specialist train set <math alttext="D^{\rm s}\sim{\cal D}^{\rm s}" class="ltx_Math" display="inline" id="A2.p1.1.m1.1"><semantics id="A2.p1.1.m1.1a"><mrow id="A2.p1.1.m1.1.1" xref="A2.p1.1.m1.1.1.cmml"><msup id="A2.p1.1.m1.1.1.2" xref="A2.p1.1.m1.1.1.2.cmml"><mi id="A2.p1.1.m1.1.1.2.2" xref="A2.p1.1.m1.1.1.2.2.cmml">D</mi><mi id="A2.p1.1.m1.1.1.2.3" mathvariant="normal" xref="A2.p1.1.m1.1.1.2.3.cmml">s</mi></msup><mo id="A2.p1.1.m1.1.1.1" xref="A2.p1.1.m1.1.1.1.cmml">∼</mo><msup id="A2.p1.1.m1.1.1.3" xref="A2.p1.1.m1.1.1.3.cmml"><mi class="ltx_font_mathcaligraphic" id="A2.p1.1.m1.1.1.3.2" xref="A2.p1.1.m1.1.1.3.2.cmml">𝒟</mi><mi id="A2.p1.1.m1.1.1.3.3" mathvariant="normal" xref="A2.p1.1.m1.1.1.3.3.cmml">s</mi></msup></mrow><annotation-xml encoding="MathML-Content" id="A2.p1.1.m1.1b"><apply id="A2.p1.1.m1.1.1.cmml" xref="A2.p1.1.m1.1.1"><csymbol cd="latexml" id="A2.p1.1.m1.1.1.1.cmml" xref="A2.p1.1.m1.1.1.1">similar-to</csymbol><apply id="A2.p1.1.m1.1.1.2.cmml" xref="A2.p1.1.m1.1.1.2"><csymbol cd="ambiguous" id="A2.p1.1.m1.1.1.2.1.cmml" xref="A2.p1.1.m1.1.1.2">superscript</csymbol><ci id="A2.p1.1.m1.1.1.2.2.cmml" xref="A2.p1.1.m1.1.1.2.2">𝐷</ci><ci id="A2.p1.1.m1.1.1.2.3.cmml" xref="A2.p1.1.m1.1.1.2.3">s</ci></apply><apply id="A2.p1.1.m1.1.1.3.cmml" xref="A2.p1.1.m1.1.1.3"><csymbol cd="ambiguous" id="A2.p1.1.m1.1.1.3.1.cmml" xref="A2.p1.1.m1.1.1.3">superscript</csymbol><ci id="A2.p1.1.m1.1.1.3.2.cmml" xref="A2.p1.1.m1.1.1.3.2">𝒟</ci><ci id="A2.p1.1.m1.1.1.3.3.cmml" xref="A2.p1.1.m1.1.1.3.3">s</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A2.p1.1.m1.1c">D^{\rm s}\sim{\cal D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="A2.p1.1.m1.1d">italic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT ∼ caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>. This also avoids cross-contamination between tasks, e.g. the official training set of MMLU contains ARC which would prevent the task transfer experiments in Section <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.SS4" title="5.4 Task-Transfer and Multitasking ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">5.4</span></a>.</p>
</div>
</section>
<section class="ltx_appendix" id="A3">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix C </span>Architectures &amp; Hyperparameters</h2>
<div class="ltx_para ltx_noindent" id="A3.p1">
<p class="ltx_p" id="A3.p1.1">Our architecture configurations are borrowed from <cite class="ltx_cite ltx_citemacro_cite">Brown et al. (<a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib9" title="">2020</a>)</cite> and described in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A3.T4" title="Table 4 ‣ Appendix C Architectures &amp; Hyperparameters ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>. We report the data selection hyperparameters in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A3.T5" title="Table 5 ‣ Appendix C Architectures &amp; Hyperparameters ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">5</span></a> and the clustering hyper-parameters in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A3.T6" title="Table 6 ‣ Appendix C Architectures &amp; Hyperparameters ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">6</span></a>.</p>
</div>
<figure class="ltx_table" id="A3.T4">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 4: </span>Model Hyperparameters</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A3.T4.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A3.T4.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A3.T4.1.1.1.1">Num. parameters</th>
<td class="ltx_td ltx_align_right ltx_border_t" id="A3.T4.1.1.1.2">350m</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A3.T4.1.1.1.3">1.3m</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A3.T4.1.1.1.4">6.7B</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A3.T4.1.2.2.1">Architecture</th>
<td class="ltx_td ltx_border_t" id="A3.T4.1.2.2.2"></td>
<td class="ltx_td ltx_border_t" id="A3.T4.1.2.2.3"></td>
<td class="ltx_td ltx_border_t" id="A3.T4.1.2.2.4"></td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.3.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.3.3.1">Embedding dim.</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.3.3.2">1,024</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.3.3.3">2,048</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.3.3.4">4,096</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.4.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.4.4.1">Latent dim.</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.4.4.2">4,096</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.4.4.3">8,192</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.4.4.4">16,384</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.5.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.5.5.1">Num. heads</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.5.5.2">16</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.5.5.3">16</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.5.5.4">32</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.6.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.6.6.1">Depth</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.6.6.2">24</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.6.6.3">24</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.6.6.4">32</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.7.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.7.7.1">Context limit</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.7.7.2">1,024</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.7.7.3">1,024</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.7.7.4">1,024</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.8.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A3.T4.1.8.8.1">Optimization</th>
<td class="ltx_td ltx_border_t" id="A3.T4.1.8.8.2"></td>
<td class="ltx_td ltx_border_t" id="A3.T4.1.8.8.3"></td>
<td class="ltx_td ltx_border_t" id="A3.T4.1.8.8.4"></td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.9.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.9.9.1">Batch size</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.9.9.2">96k</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.9.9.3">115k</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.9.9.4">1.04m</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.10.10">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.10.10.1">Learning rate</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.10.10.2">1e-4</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.10.10.3">1e-4</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.10.10.4">3e-4</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.11.11">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.11.11.1">Grad clipping</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.11.11.2">5.0</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.11.11.3">5.0</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.11.11.4">0.1</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.12.12">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A3.T4.1.12.12.1">Steps</th>
<td class="ltx_td ltx_align_right" id="A3.T4.1.12.12.2">400k</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.12.12.3">1m</td>
<td class="ltx_td ltx_align_right" id="A3.T4.1.12.12.4">340k</td>
</tr>
<tr class="ltx_tr" id="A3.T4.1.13.13">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_b" id="A3.T4.1.13.13.1">Num. train tokens</th>
<td class="ltx_td ltx_align_right ltx_border_b" id="A3.T4.1.13.13.2">40B</td>
<td class="ltx_td ltx_align_right ltx_border_b" id="A3.T4.1.13.13.3">120B</td>
<td class="ltx_td ltx_align_right ltx_border_b" id="A3.T4.1.13.13.4">350B</td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_table" id="A3.T5">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 5: </span>Data-Selection Hyperparameters</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A3.T5.1">
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A3.T5.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="A3.T5.1.2.1.1">Method</th>
<td class="ltx_td ltx_align_left ltx_border_tt" id="A3.T5.1.2.1.2">Parameter</td>
<td class="ltx_td ltx_align_left ltx_border_tt" id="A3.T5.1.2.1.3">Range</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="A3.T5.1.3.2.1">Classifier</th>
<td class="ltx_td ltx_align_left ltx_border_tt" id="A3.T5.1.3.2.2">Regularization strength</td>
<td class="ltx_td ltx_align_left ltx_border_tt" id="A3.T5.1.3.2.3">{None, 1000, 100, 10, 1, 0.1, 0.01, 0.001}</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.4.3">
<th class="ltx_td ltx_th ltx_th_row ltx_border_r" id="A3.T5.1.4.3.1"></th>
<td class="ltx_td ltx_align_left" id="A3.T5.1.4.3.2">Threshold quantiles</td>
<td class="ltx_td ltx_align_left" id="A3.T5.1.4.3.3">{0.5, 0.6, 0.7, 0.75, 0.8, 0.9, 0.95, …</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.5.4">
<th class="ltx_td ltx_th ltx_th_row ltx_border_r" id="A3.T5.1.5.4.1"></th>
<td class="ltx_td" id="A3.T5.1.5.4.2"></td>
<td class="ltx_td ltx_align_right" id="A3.T5.1.5.4.3">…, 0.975, 0.98, 0.9875, 0.99, 0.995, 0.9975}</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.6.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A3.T5.1.6.5.1">DoGE</th>
<td class="ltx_td ltx_align_left ltx_border_t" id="A3.T5.1.6.5.2">Num. clusters</td>
<td class="ltx_td ltx_align_left ltx_border_t" id="A3.T5.1.6.5.3">64</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.7.6">
<th class="ltx_td ltx_th ltx_th_row ltx_border_r" id="A3.T5.1.7.6.1"></th>
<td class="ltx_td ltx_align_left" id="A3.T5.1.7.6.2">Proxy model size</td>
<td class="ltx_td ltx_align_left" id="A3.T5.1.7.6.3">Transformer base, 110m parameters</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.8.7">
<th class="ltx_td ltx_th ltx_th_row ltx_border_r" id="A3.T5.1.8.7.1"></th>
<td class="ltx_td ltx_align_left" id="A3.T5.1.8.7.2">Proxy model optimization</td>
<td class="ltx_td ltx_align_left" id="A3.T5.1.8.7.3">32k batch size, 1e-4 learning rate, 100k steps</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.1">
<th class="ltx_td ltx_th ltx_th_row ltx_border_r" id="A3.T5.1.1.2"></th>
<td class="ltx_td ltx_align_left" id="A3.T5.1.1.1">Bregman coefficient <math alttext="\mu" class="ltx_Math" display="inline" id="A3.T5.1.1.1.m1.1"><semantics id="A3.T5.1.1.1.m1.1a"><mi id="A3.T5.1.1.1.m1.1.1" xref="A3.T5.1.1.1.m1.1.1.cmml">μ</mi><annotation-xml encoding="MathML-Content" id="A3.T5.1.1.1.m1.1b"><ci id="A3.T5.1.1.1.m1.1.1.cmml" xref="A3.T5.1.1.1.m1.1.1">𝜇</ci></annotation-xml><annotation encoding="application/x-tex" id="A3.T5.1.1.1.m1.1c">\mu</annotation><annotation encoding="application/x-llamapun" id="A3.T5.1.1.1.m1.1d">italic_μ</annotation></semantics></math>
</td>
<td class="ltx_td ltx_align_left" id="A3.T5.1.1.3">5e-4</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.9.8">
<th class="ltx_td ltx_th ltx_th_row ltx_border_r" id="A3.T5.1.9.8.1"></th>
<td class="ltx_td ltx_align_left" id="A3.T5.1.9.8.2">Transferred weights</td>
<td class="ltx_td ltx_align_left" id="A3.T5.1.9.8.3">{run average, last 20 step average}</td>
</tr>
<tr class="ltx_tr" id="A3.T5.1.10.9">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r ltx_border_t" id="A3.T5.1.10.9.1">Importance S.</th>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="A3.T5.1.10.9.2">Num. clusters</td>
<td class="ltx_td ltx_align_left ltx_border_bb ltx_border_t" id="A3.T5.1.10.9.3">{64, 4096, 262k, 16.7m}</td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_table" id="A3.T6">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 6: </span>Hierarchical Clustering Hyperparameters</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A3.T6.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A3.T6.1.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="A3.T6.1.1.1.1">Parameter</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" id="A3.T6.1.1.1.2">Range</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A3.T6.1.2.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="A3.T6.1.2.1.1">Tree depth</th>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A3.T6.1.2.1.2">4</td>
</tr>
<tr class="ltx_tr" id="A3.T6.1.3.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A3.T6.1.3.2.1">Tree arity</th>
<td class="ltx_td ltx_align_right" id="A3.T6.1.3.2.2">64</td>
</tr>
<tr class="ltx_tr" id="A3.T6.1.4.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A3.T6.1.4.3.1">Balancing limit</th>
<td class="ltx_td ltx_align_right" id="A3.T6.1.4.3.2">0.022</td>
</tr>
<tr class="ltx_tr" id="A3.T6.1.5.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A3.T6.1.5.4.1">Number of samples per step</th>
<td class="ltx_td ltx_align_right" id="A3.T6.1.5.4.2">6,400</td>
</tr>
<tr class="ltx_tr" id="A3.T6.1.6.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A3.T6.1.6.5.1">Number of steps</th>
<td class="ltx_td ltx_align_right" id="A3.T6.1.6.5.2">20</td>
</tr>
<tr class="ltx_tr" id="A3.T6.1.7.6">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A3.T6.1.7.6.1">SBERT model</th>
<td class="ltx_td ltx_align_right" id="A3.T6.1.7.6.2"><span class="ltx_text ltx_font_typewriter" id="A3.T6.1.7.6.2.1">MiniLM-L6-v2</span></td>
</tr>
<tr class="ltx_tr" id="A3.T6.1.8.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A3.T6.1.8.7.1">SBERT emb. dim.</th>
<td class="ltx_td ltx_align_right" id="A3.T6.1.8.7.2">384</td>
</tr>
<tr class="ltx_tr" id="A3.T6.1.9.8">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="A3.T6.1.9.8.1">LSI dim.</th>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A3.T6.1.9.8.2">256</td>
</tr>
</tbody>
</table>
</figure>
</section>
<section class="ltx_appendix" id="A4">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix D </span>MCQ Evaluation</h2>
<div class="ltx_para ltx_noindent" id="A4.p1">
<p class="ltx_p" id="A4.p1.3">For the multiple-choice-question tasks, we use the LM eval harness <cite class="ltx_cite ltx_citemacro_citep">(Gao et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib21" title="">2024</a>)</cite>. For each task, the evaluated model estimates the (log) probablity of each answer <math alttext="a" class="ltx_Math" display="inline" id="A4.p1.1.m1.1"><semantics id="A4.p1.1.m1.1a"><mi id="A4.p1.1.m1.1.1" xref="A4.p1.1.m1.1.1.cmml">a</mi><annotation-xml encoding="MathML-Content" id="A4.p1.1.m1.1b"><ci id="A4.p1.1.m1.1.1.cmml" xref="A4.p1.1.m1.1.1">𝑎</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.p1.1.m1.1c">a</annotation><annotation encoding="application/x-llamapun" id="A4.p1.1.m1.1d">italic_a</annotation></semantics></math> given the context <math alttext="c" class="ltx_Math" display="inline" id="A4.p1.2.m2.1"><semantics id="A4.p1.2.m2.1a"><mi id="A4.p1.2.m2.1.1" xref="A4.p1.2.m2.1.1.cmml">c</mi><annotation-xml encoding="MathML-Content" id="A4.p1.2.m2.1b"><ci id="A4.p1.2.m2.1.1.cmml" xref="A4.p1.2.m2.1.1">𝑐</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.p1.2.m2.1c">c</annotation><annotation encoding="application/x-llamapun" id="A4.p1.2.m2.1d">italic_c</annotation></semantics></math>, i.e. <math alttext="\log P(a|c)" class="ltx_Math" display="inline" id="A4.p1.3.m3.1"><semantics id="A4.p1.3.m3.1a"><mrow id="A4.p1.3.m3.1.1" xref="A4.p1.3.m3.1.1.cmml"><mrow id="A4.p1.3.m3.1.1.3" xref="A4.p1.3.m3.1.1.3.cmml"><mi id="A4.p1.3.m3.1.1.3.1" xref="A4.p1.3.m3.1.1.3.1.cmml">log</mi><mo id="A4.p1.3.m3.1.1.3a" lspace="0.167em" xref="A4.p1.3.m3.1.1.3.cmml">⁡</mo><mi id="A4.p1.3.m3.1.1.3.2" xref="A4.p1.3.m3.1.1.3.2.cmml">P</mi></mrow><mo id="A4.p1.3.m3.1.1.2" xref="A4.p1.3.m3.1.1.2.cmml">⁢</mo><mrow id="A4.p1.3.m3.1.1.1.1" xref="A4.p1.3.m3.1.1.1.1.1.cmml"><mo id="A4.p1.3.m3.1.1.1.1.2" stretchy="false" xref="A4.p1.3.m3.1.1.1.1.1.cmml">(</mo><mrow id="A4.p1.3.m3.1.1.1.1.1" xref="A4.p1.3.m3.1.1.1.1.1.cmml"><mi id="A4.p1.3.m3.1.1.1.1.1.2" xref="A4.p1.3.m3.1.1.1.1.1.2.cmml">a</mi><mo fence="false" id="A4.p1.3.m3.1.1.1.1.1.1" xref="A4.p1.3.m3.1.1.1.1.1.1.cmml">|</mo><mi id="A4.p1.3.m3.1.1.1.1.1.3" xref="A4.p1.3.m3.1.1.1.1.1.3.cmml">c</mi></mrow><mo id="A4.p1.3.m3.1.1.1.1.3" stretchy="false" xref="A4.p1.3.m3.1.1.1.1.1.cmml">)</mo></mrow></mrow><annotation-xml encoding="MathML-Content" id="A4.p1.3.m3.1b"><apply id="A4.p1.3.m3.1.1.cmml" xref="A4.p1.3.m3.1.1"><times id="A4.p1.3.m3.1.1.2.cmml" xref="A4.p1.3.m3.1.1.2"></times><apply id="A4.p1.3.m3.1.1.3.cmml" xref="A4.p1.3.m3.1.1.3"><log id="A4.p1.3.m3.1.1.3.1.cmml" xref="A4.p1.3.m3.1.1.3.1"></log><ci id="A4.p1.3.m3.1.1.3.2.cmml" xref="A4.p1.3.m3.1.1.3.2">𝑃</ci></apply><apply id="A4.p1.3.m3.1.1.1.1.1.cmml" xref="A4.p1.3.m3.1.1.1.1"><csymbol cd="latexml" id="A4.p1.3.m3.1.1.1.1.1.1.cmml" xref="A4.p1.3.m3.1.1.1.1.1.1">conditional</csymbol><ci id="A4.p1.3.m3.1.1.1.1.1.2.cmml" xref="A4.p1.3.m3.1.1.1.1.1.2">𝑎</ci><ci id="A4.p1.3.m3.1.1.1.1.1.3.cmml" xref="A4.p1.3.m3.1.1.1.1.1.3">𝑐</ci></apply></apply></annotation-xml><annotation encoding="application/x-tex" id="A4.p1.3.m3.1c">\log P(a|c)</annotation><annotation encoding="application/x-llamapun" id="A4.p1.3.m3.1d">roman_log italic_P ( italic_a | italic_c )</annotation></semantics></math>. The question contains the task prompt concatenated with the current question, while the answer contains the answer text. With this strategy, the model does not have access to all proposed answer choices in the prompt.
Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A4.T7" title="Table 7 ‣ Appendix D MCQ Evaluation ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">7</span></a> reports our prompt. For all evaluation, we use the above prompt without example questions, i.e. a zero-shot evaluation <cite class="ltx_cite ltx_citemacro_citep">(Brown et al., <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#bib.bib9" title="">2020</a>)</cite>.
Accuracy is computed by verifying if the highest score is assigned to the correct answer. The scores correspond to log probabilities for ARC-E and RWDB-R, while ARC-C, MMLU uses normalized scores, i.e. log probabilities divided by the number of characters in the answer.</p>
</div>
<figure class="ltx_table" id="A4.T7">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 7: </span>Task prompts (non-bold) for the multiple-choice-question tasks.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A4.T7.5">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A4.T7.5.6.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column" id="A4.T7.5.6.1.1">AI2 Reasoning Challenge (ARC) Easy and Challenge</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A4.T7.1.1">
<td class="ltx_td ltx_align_left ltx_border_t" id="A4.T7.1.1.1">Question: &lt;question&gt;<math alttext="\backslash" class="ltx_Math" display="inline" id="A4.T7.1.1.1.m1.1"><semantics id="A4.T7.1.1.1.m1.1a"><mo id="A4.T7.1.1.1.m1.1.1" xref="A4.T7.1.1.1.m1.1.1.cmml">\</mo><annotation-xml encoding="MathML-Content" id="A4.T7.1.1.1.m1.1b"><ci id="A4.T7.1.1.1.m1.1.1.cmml" xref="A4.T7.1.1.1.m1.1.1">\</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.T7.1.1.1.m1.1c">\backslash</annotation><annotation encoding="application/x-llamapun" id="A4.T7.1.1.1.m1.1d">\</annotation></semantics></math>n</td>
</tr>
<tr class="ltx_tr" id="A4.T7.5.7.1">
<td class="ltx_td ltx_align_left" id="A4.T7.5.7.1.1">Answer: <span class="ltx_text ltx_font_bold" id="A4.T7.5.7.1.1.1">&lt;answer&gt;</span>
</td>
</tr>
<tr class="ltx_tr" id="A4.T7.5.8.2">
<td class="ltx_td ltx_align_left" id="A4.T7.5.8.2.1">Massive Multitask Language Understanding (MMLU)</td>
</tr>
<tr class="ltx_tr" id="A4.T7.2.2">
<td class="ltx_td ltx_align_left ltx_border_t" id="A4.T7.2.2.1">The following are multiple choice questions (with answers) about &lt;topic&gt;.<math alttext="\backslash" class="ltx_Math" display="inline" id="A4.T7.2.2.1.m1.1"><semantics id="A4.T7.2.2.1.m1.1a"><mo id="A4.T7.2.2.1.m1.1.1" xref="A4.T7.2.2.1.m1.1.1.cmml">\</mo><annotation-xml encoding="MathML-Content" id="A4.T7.2.2.1.m1.1b"><ci id="A4.T7.2.2.1.m1.1.1.cmml" xref="A4.T7.2.2.1.m1.1.1">\</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.T7.2.2.1.m1.1c">\backslash</annotation><annotation encoding="application/x-llamapun" id="A4.T7.2.2.1.m1.1d">\</annotation></semantics></math>n</td>
</tr>
<tr class="ltx_tr" id="A4.T7.3.3">
<td class="ltx_td ltx_align_left" id="A4.T7.3.3.1">Question: &lt;question&gt;<math alttext="\backslash" class="ltx_Math" display="inline" id="A4.T7.3.3.1.m1.1"><semantics id="A4.T7.3.3.1.m1.1a"><mo id="A4.T7.3.3.1.m1.1.1" xref="A4.T7.3.3.1.m1.1.1.cmml">\</mo><annotation-xml encoding="MathML-Content" id="A4.T7.3.3.1.m1.1b"><ci id="A4.T7.3.3.1.m1.1.1.cmml" xref="A4.T7.3.3.1.m1.1.1">\</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.T7.3.3.1.m1.1c">\backslash</annotation><annotation encoding="application/x-llamapun" id="A4.T7.3.3.1.m1.1d">\</annotation></semantics></math>n</td>
</tr>
<tr class="ltx_tr" id="A4.T7.5.9.3">
<td class="ltx_td ltx_align_left" id="A4.T7.5.9.3.1">Answer: <span class="ltx_text ltx_font_bold" id="A4.T7.5.9.3.1.1">&lt;answer&gt;</span>
</td>
</tr>
<tr class="ltx_tr" id="A4.T7.5.10.4">
<td class="ltx_td ltx_align_left" id="A4.T7.5.10.4.1">Rewardbench Reasoning (RWB-R)</td>
</tr>
<tr class="ltx_tr" id="A4.T7.4.4">
<td class="ltx_td ltx_align_left ltx_border_t" id="A4.T7.4.4.1">Follow the instructions below.<math alttext="\backslash" class="ltx_Math" display="inline" id="A4.T7.4.4.1.m1.1"><semantics id="A4.T7.4.4.1.m1.1a"><mo id="A4.T7.4.4.1.m1.1.1" xref="A4.T7.4.4.1.m1.1.1.cmml">\</mo><annotation-xml encoding="MathML-Content" id="A4.T7.4.4.1.m1.1b"><ci id="A4.T7.4.4.1.m1.1.1.cmml" xref="A4.T7.4.4.1.m1.1.1">\</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.T7.4.4.1.m1.1c">\backslash</annotation><annotation encoding="application/x-llamapun" id="A4.T7.4.4.1.m1.1d">\</annotation></semantics></math>n</td>
</tr>
<tr class="ltx_tr" id="A4.T7.5.5">
<td class="ltx_td ltx_align_left" id="A4.T7.5.5.1">Instructions: &lt;question&gt;<math alttext="\backslash" class="ltx_Math" display="inline" id="A4.T7.5.5.1.m1.1"><semantics id="A4.T7.5.5.1.m1.1a"><mo id="A4.T7.5.5.1.m1.1.1" xref="A4.T7.5.5.1.m1.1.1.cmml">\</mo><annotation-xml encoding="MathML-Content" id="A4.T7.5.5.1.m1.1b"><ci id="A4.T7.5.5.1.m1.1.1.cmml" xref="A4.T7.5.5.1.m1.1.1">\</ci></annotation-xml><annotation encoding="application/x-tex" id="A4.T7.5.5.1.m1.1c">\backslash</annotation><annotation encoding="application/x-llamapun" id="A4.T7.5.5.1.m1.1d">\</annotation></semantics></math>n</td>
</tr>
<tr class="ltx_tr" id="A4.T7.5.11.5">
<td class="ltx_td ltx_align_left" id="A4.T7.5.11.5.1">Answer: <span class="ltx_text ltx_font_bold" id="A4.T7.5.11.5.1.1">&lt;answer&gt;</span>
</td>
</tr>
</tbody>
</table>
</figure>
</section>
<section class="ltx_appendix" id="A5">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix E </span>Supplementary Results for Language Modeling Tasks</h2>
<div class="ltx_para ltx_noindent" id="A5.p1">
<p class="ltx_p" id="A5.p1.2">We measure the fraction of examples where the pretrained model is better than the base
model. We measure this rate both on held-out data from <math alttext="{\cal D}^{\rm g}" class="ltx_Math" display="inline" id="A5.p1.1.m1.1"><semantics id="A5.p1.1.m1.1a"><msup id="A5.p1.1.m1.1.1" xref="A5.p1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A5.p1.1.m1.1.1.2" xref="A5.p1.1.m1.1.1.2.cmml">𝒟</mi><mi id="A5.p1.1.m1.1.1.3" mathvariant="normal" xref="A5.p1.1.m1.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="A5.p1.1.m1.1b"><apply id="A5.p1.1.m1.1.1.cmml" xref="A5.p1.1.m1.1.1"><csymbol cd="ambiguous" id="A5.p1.1.m1.1.1.1.cmml" xref="A5.p1.1.m1.1.1">superscript</csymbol><ci id="A5.p1.1.m1.1.1.2.cmml" xref="A5.p1.1.m1.1.1.2">𝒟</ci><ci id="A5.p1.1.m1.1.1.3.cmml" xref="A5.p1.1.m1.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A5.p1.1.m1.1c">{\cal D}^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="A5.p1.1.m1.1d">caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> (measured on the 360m tokens from Redpj2 valid) and on held-out data from <math alttext="{\cal D}^{\rm g}" class="ltx_Math" display="inline" id="A5.p1.2.m2.1"><semantics id="A5.p1.2.m2.1a"><msup id="A5.p1.2.m2.1.1" xref="A5.p1.2.m2.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A5.p1.2.m2.1.1.2" xref="A5.p1.2.m2.1.1.2.cmml">𝒟</mi><mi id="A5.p1.2.m2.1.1.3" mathvariant="normal" xref="A5.p1.2.m2.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="A5.p1.2.m2.1b"><apply id="A5.p1.2.m2.1.1.cmml" xref="A5.p1.2.m2.1.1"><csymbol cd="ambiguous" id="A5.p1.2.m2.1.1.1.cmml" xref="A5.p1.2.m2.1.1">superscript</csymbol><ci id="A5.p1.2.m2.1.1.2.cmml" xref="A5.p1.2.m2.1.1.2">𝒟</ci><ci id="A5.p1.2.m2.1.1.3.cmml" xref="A5.p1.2.m2.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A5.p1.2.m2.1c">{\cal D}^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="A5.p1.2.m2.1d">caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math> (measured on the full Pile validation set). The results in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A5.T8" title="Table 8 ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">8</span></a> shows that the model trained with importance
sampling improves perplexity on most specialist documents (right column). Its training on the importance sampled distribution utilize model capacity mostly on data close to the domain of interest, this relieves the model from fitting well most of the generic data, hence most generic documents have higher perplexity with CRISP (left column).</p>
</div>
<div class="ltx_para ltx_noindent" id="A5.p2">
<p class="ltx_p" id="A5.p2.1">For completeness, we also report the perplexity numbers from Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a> in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A5" title="Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">E</span></a>.</p>
</div>
<figure class="ltx_table" id="A5.T8">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 8: </span><span class="ltx_text ltx_font_bold" id="A5.T8.4.1">Fraction of examples with lower perplexity with importance sampling than with base.</span> Compared to base, CRISP models specialize: they performs better on most specialist examples and worse on most generic examples.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A5.T8.2">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A5.T8.2.2">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="A5.T8.2.2.3"></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.T8.1.1.1">Generalist <math alttext="{\cal D}^{\rm g}" class="ltx_Math" display="inline" id="A5.T8.1.1.1.m1.1"><semantics id="A5.T8.1.1.1.m1.1a"><msup id="A5.T8.1.1.1.m1.1.1" xref="A5.T8.1.1.1.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A5.T8.1.1.1.m1.1.1.2" xref="A5.T8.1.1.1.m1.1.1.2.cmml">𝒟</mi><mi id="A5.T8.1.1.1.m1.1.1.3" mathvariant="normal" xref="A5.T8.1.1.1.m1.1.1.3.cmml">g</mi></msup><annotation-xml encoding="MathML-Content" id="A5.T8.1.1.1.m1.1b"><apply id="A5.T8.1.1.1.m1.1.1.cmml" xref="A5.T8.1.1.1.m1.1.1"><csymbol cd="ambiguous" id="A5.T8.1.1.1.m1.1.1.1.cmml" xref="A5.T8.1.1.1.m1.1.1">superscript</csymbol><ci id="A5.T8.1.1.1.m1.1.1.2.cmml" xref="A5.T8.1.1.1.m1.1.1.2">𝒟</ci><ci id="A5.T8.1.1.1.m1.1.1.3.cmml" xref="A5.T8.1.1.1.m1.1.1.3">g</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A5.T8.1.1.1.m1.1c">{\cal D}^{\rm g}</annotation><annotation encoding="application/x-llamapun" id="A5.T8.1.1.1.m1.1d">caligraphic_D start_POSTSUPERSCRIPT roman_g end_POSTSUPERSCRIPT</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.T8.2.2.2">Specialist <math alttext="{\cal D}^{\rm s}" class="ltx_Math" display="inline" id="A5.T8.2.2.2.m1.1"><semantics id="A5.T8.2.2.2.m1.1a"><msup id="A5.T8.2.2.2.m1.1.1" xref="A5.T8.2.2.2.m1.1.1.cmml"><mi class="ltx_font_mathcaligraphic" id="A5.T8.2.2.2.m1.1.1.2" xref="A5.T8.2.2.2.m1.1.1.2.cmml">𝒟</mi><mi id="A5.T8.2.2.2.m1.1.1.3" mathvariant="normal" xref="A5.T8.2.2.2.m1.1.1.3.cmml">s</mi></msup><annotation-xml encoding="MathML-Content" id="A5.T8.2.2.2.m1.1b"><apply id="A5.T8.2.2.2.m1.1.1.cmml" xref="A5.T8.2.2.2.m1.1.1"><csymbol cd="ambiguous" id="A5.T8.2.2.2.m1.1.1.1.cmml" xref="A5.T8.2.2.2.m1.1.1">superscript</csymbol><ci id="A5.T8.2.2.2.m1.1.1.2.cmml" xref="A5.T8.2.2.2.m1.1.1.2">𝒟</ci><ci id="A5.T8.2.2.2.m1.1.1.3.cmml" xref="A5.T8.2.2.2.m1.1.1.3">s</ci></apply></annotation-xml><annotation encoding="application/x-tex" id="A5.T8.2.2.2.m1.1c">{\cal D}^{\rm s}</annotation><annotation encoding="application/x-llamapun" id="A5.T8.2.2.2.m1.1d">caligraphic_D start_POSTSUPERSCRIPT roman_s end_POSTSUPERSCRIPT</annotation></semantics></math>
</th>
</tr>
<tr class="ltx_tr" id="A5.T8.2.3.1">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r" id="A5.T8.2.3.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A5.T8.2.3.1.2">(Redpj2)</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A5.T8.2.3.1.3">(Pile subset)</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A5.T8.2.4.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="A5.T8.2.4.1.1">PubMed</th>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.T8.2.4.1.2">6.1%</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.T8.2.4.1.3">97.3%</td>
</tr>
<tr class="ltx_tr" id="A5.T8.2.5.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A5.T8.2.5.2.1">StackExchange</th>
<td class="ltx_td ltx_align_right" id="A5.T8.2.5.2.2">2.9%</td>
<td class="ltx_td ltx_align_right" id="A5.T8.2.5.2.3">92.6%</td>
</tr>
<tr class="ltx_tr" id="A5.T8.2.6.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="A5.T8.2.6.3.1">Wikipedia</th>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.T8.2.6.3.2">12.4%</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.T8.2.6.3.3">86.7%</td>
</tr>
</tbody>
</table>
</figure>
<figure class="ltx_table" id="A5.tab1">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 9: </span><span class="ltx_text ltx_font_bold" id="A5.tab1.2.1">Perplexity on language modeling tasks after fine-tuning.</span> These tables reports the perplexity numbers from Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>.</figcaption><div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_1">
<table class="ltx_tabular ltx_figure_panel ltx_guessed_headers ltx_align_middle" id="A5.tab1.3">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A5.tab1.3.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row" colspan="7" id="A5.tab1.3.1.1.1">(a) PubMed</th>
</tr>
<tr class="ltx_tr" id="A5.tab1.3.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A5.tab1.3.2.2.1">Specific tokens</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.3.2.2.2">14m</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.3.2.2.3">100m</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.3.2.2.4">500m</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.3.2.2.5">2.5B</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.3.2.2.6">7.5B</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.3.2.2.7">26.7B</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A5.tab1.3.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="A5.tab1.3.3.1.1">Only Specific</th>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.3.3.1.2">25.73</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.3.3.1.3">10.09</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.3.3.1.4">6.64</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.3.3.1.5">5.08</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.3.3.1.6">4.47</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.3.3.1.7">4.20</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.3.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.3.4.2.1">Base redpj2</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.4.2.2">6.34</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.4.2.3">5.98</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.4.2.4">5.38</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.4.2.5">4.79</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.4.2.6">4.47</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.4.2.7">4.20</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.3.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.3.5.3.1">DoGE</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.5.3.2">5.41</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.5.3.3">5.19</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.5.3.4">5.02</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.5.3.5">4.72</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.5.3.6">4.47</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.5.3.7">4.20</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.3.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.3.6.4.1">Classifier</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.6.4.2">5.18</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.6.4.3">5.08</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.6.4.4">4.90</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.6.4.5">4.67</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.6.4.6">4.45</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.3.6.4.7">4.20</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.3.7.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="A5.tab1.3.7.5.1">CRISP</th>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.3.7.5.2">5.11</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.3.7.5.3">5.00</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.3.7.5.4">4.83</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.3.7.5.5">4.63</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.3.7.5.6">4.44</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.3.7.5.7">4.20</td>
</tr>
</tbody>
</table>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<table class="ltx_tabular ltx_figure_panel ltx_guessed_headers ltx_align_middle" id="A5.tab1.4">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A5.tab1.4.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row" colspan="5" id="A5.tab1.4.1.1.1">(b) StackExchange</th>
</tr>
<tr class="ltx_tr" id="A5.tab1.4.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A5.tab1.4.2.2.1">Specific tokens</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A5.tab1.4.2.2.2">15m</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.4.2.2.3">133m</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.4.2.2.4">1.2B</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.4.2.2.5">10.3B</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A5.tab1.4.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="A5.tab1.4.3.1.1">Only Specific</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="A5.tab1.4.3.1.2">23.93</th>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.4.3.1.3">9.60</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.4.3.1.4">5.79</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.4.3.1.5">4.35</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.4.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.4.4.2.1">Base redpj2</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.4.4.2.2">8.41</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.4.2.3">6.66</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.4.2.4">5.35</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.4.2.5">4.35</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.4.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.4.5.3.1">DoGE</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.4.5.3.2">7.04</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.5.3.3">6.21</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.5.3.4">5.30</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.5.3.5">4.35</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.4.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.4.6.4.1">Classifier</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.4.6.4.2">7.15</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.6.4.3">6.34</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.6.4.4">5.39</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.4.6.4.5">4.35</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.4.7.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="A5.tab1.4.7.5.1">CRISP</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="A5.tab1.4.7.5.2">6.67</th>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.4.7.5.3">6.12</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.4.7.5.4">5.38</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.4.7.5.5">4.35</td>
</tr>
</tbody>
</table>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_2">
<table class="ltx_tabular ltx_figure_panel ltx_guessed_headers ltx_align_middle" id="A5.tab1.5">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A5.tab1.5.1.1">
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_th_row" colspan="5" id="A5.tab1.5.1.1.1">(c) Wikipedia</th>
</tr>
<tr class="ltx_tr" id="A5.tab1.5.2.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A5.tab1.5.2.2.1">Specific tokens</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_tt" id="A5.tab1.5.2.2.2">14m</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.5.2.2.3">93m</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.5.2.2.4">668m</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A5.tab1.5.2.2.5">4.7B</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A5.tab1.5.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="A5.tab1.5.3.1.1">Only Specific</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="A5.tab1.5.3.1.2">57.13</th>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.5.3.1.3">18.22</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.5.3.1.4">9.97</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A5.tab1.5.3.1.5">6.76</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.5.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.5.4.2.1">Base redpj2</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.5.4.2.2">8.53</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.4.2.3">7.99</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.4.2.4">7.41</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.4.2.5">6.43</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.5.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.5.5.3.1">DoGE</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.5.5.3.2">8.13</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.5.3.3">7.71</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.5.3.4">7.26</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.5.3.5">6.39</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.5.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.5.6.4.1">Classifier</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row" id="A5.tab1.5.6.4.2">7.83</th>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.6.4.3">7.53</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.6.4.4">7.23</td>
<td class="ltx_td ltx_align_right" id="A5.tab1.5.6.4.5">6.50</td>
</tr>
<tr class="ltx_tr" id="A5.tab1.5.7.5">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="A5.tab1.5.7.5.1">CRISP</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb" id="A5.tab1.5.7.5.2">7.66</th>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.5.7.5.3">7.37</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.5.7.5.4">7.09</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A5.tab1.5.7.5.5">6.40</td>
</tr>
</tbody>
</table>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<section class="ltx_appendix ltx_figure_panel" id="A6">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix F </span>Supplementary Results for Multiple Choice Questions</h2>
<div class="ltx_para ltx_noindent" id="A6.p1">
<p class="ltx_p" id="A6.p1.1">Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A6.T10" title="Table 10 ‣ Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">10</span></a> reports the MCQ results before and after fine-tuning, i.e the accuracy numbers from Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>. Fine-tuning on the small MCQ train sets
optimizing log-likelihood does not always benefit end-task accuracy.</p>
</div>
<figure class="ltx_table" id="A6.T10">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 10: </span><span class="ltx_text ltx_font_bold" id="A6.T10.2.1">MCQ Accurary.</span> Fine tuning results are dashed when not improved from pretraining. This table reports the accuracy numbers from Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S4.F4" title="Figure 4 ‣ 4.1 Language Modeling Tasks ‣ 4 Experiments &amp; Results ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">4</span></a>.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A6.T10.3">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A6.T10.3.1.1">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="A6.T10.3.1.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" colspan="2" id="A6.T10.3.1.1.2">ARC-E</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" colspan="2" id="A6.T10.3.1.1.3">ARC-C</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_r ltx_border_tt" colspan="2" id="A6.T10.3.1.1.4">MMLU</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="2" id="A6.T10.3.1.1.5">RWDB-R</th>
</tr>
<tr class="ltx_tr" id="A6.T10.3.2.2">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r" id="A6.T10.3.2.2.1"></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A6.T10.3.2.2.2">Pretr.</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="A6.T10.3.2.2.3">+ft</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A6.T10.3.2.2.4">Pretr.</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="A6.T10.3.2.2.5">+ft</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A6.T10.3.2.2.6">Pretr.</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="A6.T10.3.2.2.7">+ft</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A6.T10.3.2.2.8">Pretr.</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A6.T10.3.2.2.9">+ft</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A6.T10.3.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="A6.T10.3.3.1.1">Base redpjv2</th>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A6.T10.3.3.1.2">58.4</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A6.T10.3.3.1.3">–</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A6.T10.3.3.1.4">27.4</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A6.T10.3.3.1.5">28.8</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A6.T10.3.3.1.6">30.0</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A6.T10.3.3.1.7">31.0</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A6.T10.3.3.1.8">62.1</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A6.T10.3.3.1.9">63.5</td>
</tr>
<tr class="ltx_tr" id="A6.T10.3.4.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A6.T10.3.4.2.1">DoGE</th>
<td class="ltx_td ltx_align_right" id="A6.T10.3.4.2.2">66.2</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A6.T10.3.4.2.3">–</td>
<td class="ltx_td ltx_align_right" id="A6.T10.3.4.2.4">33.3</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A6.T10.3.4.2.5">34.9</td>
<td class="ltx_td ltx_align_right" id="A6.T10.3.4.2.6">31.0</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A6.T10.3.4.2.7">31.5</td>
<td class="ltx_td ltx_align_right" id="A6.T10.3.4.2.8">67.4</td>
<td class="ltx_td ltx_align_right" id="A6.T10.3.4.2.9">67.9</td>
</tr>
<tr class="ltx_tr" id="A6.T10.3.5.3">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A6.T10.3.5.3.1">Classifier</th>
<td class="ltx_td ltx_align_right" id="A6.T10.3.5.3.2">68.2</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A6.T10.3.5.3.3">–</td>
<td class="ltx_td ltx_align_right" id="A6.T10.3.5.3.4">36.7</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A6.T10.3.5.3.5">–</td>
<td class="ltx_td ltx_align_right" id="A6.T10.3.5.3.6">32.4</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A6.T10.3.5.3.7">–</td>
<td class="ltx_td ltx_align_right" id="A6.T10.3.5.3.8">69.4</td>
<td class="ltx_td ltx_align_right" id="A6.T10.3.5.3.9">–</td>
</tr>
<tr class="ltx_tr" id="A6.T10.3.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="A6.T10.3.6.4.1">CRISP</th>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A6.T10.3.6.4.2">71.2</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r" id="A6.T10.3.6.4.3">–</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A6.T10.3.6.4.4">38.6</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r" id="A6.T10.3.6.4.5">–</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A6.T10.3.6.4.6">33.4</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r" id="A6.T10.3.6.4.7">33.5</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A6.T10.3.6.4.8">70.0</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A6.T10.3.6.4.9">–</td>
</tr>
</tbody>
</table>
</figure>
<section class="ltx_appendix" id="A7">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix G </span>Comparing the results of DoGE and Importance Sampling</h2>
<figure class="ltx_table" id="A7.T11">
<figcaption class="ltx_caption"><span class="ltx_tag ltx_tag_table">Table 11: </span>DoGE &amp; CRISP on 64 Clusters</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A7.T11.2">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A7.T11.2.2">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" id="A7.T11.2.2.3"></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_tt" id="A7.T11.1.1.1">LM PPL<math alttext="\downarrow" class="ltx_Math" display="inline" id="A7.T11.1.1.1.m1.1"><semantics id="A7.T11.1.1.1.m1.1a"><mo id="A7.T11.1.1.1.m1.1.1" stretchy="false" xref="A7.T11.1.1.1.m1.1.1.cmml">↓</mo><annotation-xml encoding="MathML-Content" id="A7.T11.1.1.1.m1.1b"><ci id="A7.T11.1.1.1.m1.1.1.cmml" xref="A7.T11.1.1.1.m1.1.1">↓</ci></annotation-xml><annotation encoding="application/x-tex" id="A7.T11.1.1.1.m1.1c">\downarrow</annotation><annotation encoding="application/x-llamapun" id="A7.T11.1.1.1.m1.1d">↓</annotation></semantics></math>
</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="3" id="A7.T11.2.2.2">MCQ Acc (%) <math alttext="\uparrow" class="ltx_Math" display="inline" id="A7.T11.2.2.2.m1.1"><semantics id="A7.T11.2.2.2.m1.1a"><mo id="A7.T11.2.2.2.m1.1.1" stretchy="false" xref="A7.T11.2.2.2.m1.1.1.cmml">↑</mo><annotation-xml encoding="MathML-Content" id="A7.T11.2.2.2.m1.1b"><ci id="A7.T11.2.2.2.m1.1.1.cmml" xref="A7.T11.2.2.2.m1.1.1">↑</ci></annotation-xml><annotation encoding="application/x-tex" id="A7.T11.2.2.2.m1.1c">\uparrow</annotation><annotation encoding="application/x-llamapun" id="A7.T11.2.2.2.m1.1d">↑</annotation></semantics></math>
</th>
</tr>
<tr class="ltx_tr" id="A7.T11.2.3.1">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r" id="A7.T11.2.3.1.1"></th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column" id="A7.T11.2.3.1.2">PubMed</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A7.T11.2.3.1.3">ARC-E</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A7.T11.2.3.1.4">ARC-C</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A7.T11.2.3.1.5">MMLU</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A7.T11.2.4.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="A7.T11.2.4.1.1">DoGE</th>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A7.T11.2.4.1.2">7.44</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A7.T11.2.4.1.3">66.2</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A7.T11.2.4.1.4">33.3</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A7.T11.2.4.1.5">31.0</td>
</tr>
<tr class="ltx_tr" id="A7.T11.2.5.2">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A7.T11.2.5.2.1">CRISP</th>
<td class="ltx_td ltx_align_right" id="A7.T11.2.5.2.2">7.28</td>
<td class="ltx_td ltx_align_right" id="A7.T11.2.5.2.3">65.2</td>
<td class="ltx_td ltx_align_right" id="A7.T11.2.5.2.4">33.0</td>
<td class="ltx_td ltx_align_right" id="A7.T11.2.5.2.5">31.2</td>
</tr>
</tbody>
</table>
</figure>
<div class="ltx_para ltx_noindent" id="A7.p1">
<p class="ltx_p" id="A7.p1.1">We observe in Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A7.T11" title="Table 11 ‣ Appendix G Comparing the results of DoGE and Importance Sampling ‣ Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">11</span></a> that the pretraining results of DoGE and importance sampling on 64 clusters are close. Both methods pretrain models by sampling the clustered generalist data according to the cluster weights. If both methods would infer the same cluster weights, their pretraining runs would be identical. We therefore ask if the similar results are due to similar cluster weights.
Figure <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A7.F13" title="Figure 13 ‣ Appendix G Comparing the results of DoGE and Importance Sampling ‣ Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">13</span></a> compares the cluster weights for both methods.
The top clusters for both methods are similar, but their histograms
are not identical. This shows that similar pretraining results can be
obtained with different weights.</p>
</div>
<figure class="ltx_figure" id="A7.F13">
<div class="ltx_flex_figure">
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="A7.F12.sf1"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="A7.F12.sf1.g1" src="x30.png" width="218"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(a) </span>PubMed</figcaption>
</figure>
</div>
<div class="ltx_flex_cell ltx_flex_size_2">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="A7.F12.sf2"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="A7.F12.sf2.g1" src="x31.png" width="218"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(b) </span>ARC</figcaption>
</figure>
</div>
<div class="ltx_flex_break"></div>
<div class="ltx_flex_cell ltx_flex_size_1">
<figure class="ltx_figure ltx_figure_panel ltx_align_center" id="A7.F12.sf3"><img alt="Refer to caption" class="ltx_graphics ltx_centering ltx_img_square" height="191" id="A7.F12.sf3.g1" src="x32.png" width="225"/>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">(c) </span>MMLU</figcaption>
</figure>
</div>
</div>
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_figure">Figure 13: </span>DoGE vs CRISP weights with 64 clusters. We report the top-16 clusters sorted by mean weight across methods.</figcaption>
</figure>
<section class="ltx_appendix" id="A8">
<h2 class="ltx_title ltx_title_appendix">
<span class="ltx_tag ltx_tag_appendix">Appendix H </span>Task Transfer for 350m, 1.3B and 7B models</h2>
<div class="ltx_para ltx_noindent" id="A8.p1">
<p class="ltx_p" id="A8.p1.1">Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#A8.T12" title="Table 12 ‣ Appendix H Task Transfer for 350m, 1.3B and 7B models ‣ Appendix G Comparing the results of DoGE and Importance Sampling ‣ Appendix F Supplementary Results for Multiple Choice Questions ‣ Appendix E Supplementary Results for Language Modeling Tasks ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">12</span></a> complements the task-transfer results from Table <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.T1" title="Table 1 ‣ 5.4 Task-Transfer and Multitasking ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">1</span></a> in Section <a class="ltx_ref" href="https://arxiv.org/html/2410.03735v1#S5.SS4" title="5.4 Task-Transfer and Multitasking ‣ 5 Analysis ‣ Task-Adaptive Pretrained Language Models via Clustered-Importance Sampling"><span class="ltx_text ltx_ref_tag">5.4</span></a> with the results across different model sizes. The importance sampling models
trained with MMLU histograms outperform the base models on all tasks for all model sizes.</p>
</div>
<figure class="ltx_table" id="A8.T12">
<figcaption class="ltx_caption ltx_centering"><span class="ltx_tag ltx_tag_table">Table 12: </span>Accuracy (%) for Task Transfer on 350m, 1B and 7B models.</figcaption>
<table class="ltx_tabular ltx_centering ltx_guessed_headers ltx_align_middle" id="A8.T12.1">
<thead class="ltx_thead">
<tr class="ltx_tr" id="A8.T12.1.1.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_column ltx_th_row ltx_border_r ltx_border_tt" colspan="2" id="A8.T12.1.1.1.1">Model</th>
<th class="ltx_td ltx_align_center ltx_th ltx_th_column ltx_border_tt" colspan="5" id="A8.T12.1.1.1.2">Evaluation Tasks</th>
</tr>
<tr class="ltx_tr" id="A8.T12.1.2.2">
<th class="ltx_td ltx_th ltx_th_column ltx_th_row" id="A8.T12.1.2.2.1"></th>
<th class="ltx_td ltx_th ltx_th_column ltx_th_row ltx_border_r" id="A8.T12.1.2.2.2"></th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A8.T12.1.2.2.3">ARC-E</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A8.T12.1.2.2.4">ARC-C</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A8.T12.1.2.2.5">MMLU</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column ltx_border_r" id="A8.T12.1.2.2.6">RWDB-R</th>
<th class="ltx_td ltx_align_right ltx_th ltx_th_column" id="A8.T12.1.2.2.7">Multi</th>
</tr>
</thead>
<tbody class="ltx_tbody">
<tr class="ltx_tr" id="A8.T12.1.3.1">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_tt" id="A8.T12.1.3.1.1">350m</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_tt" id="A8.T12.1.3.1.2">Base</th>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A8.T12.1.3.1.3">49.5</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A8.T12.1.3.1.4">24.5</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A8.T12.1.3.1.5">27.0</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_tt" id="A8.T12.1.3.1.6">57.6</td>
<td class="ltx_td ltx_align_right ltx_border_tt" id="A8.T12.1.3.1.7">40.5</td>
</tr>
<tr class="ltx_tr" id="A8.T12.1.4.2">
<th class="ltx_td ltx_th ltx_th_row" id="A8.T12.1.4.2.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A8.T12.1.4.2.2">CRISP ARC</th>
<td class="ltx_td ltx_align_right" id="A8.T12.1.4.2.3">65.3</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.4.2.4">31.5</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.4.2.5">27.4</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A8.T12.1.4.2.6">58.4</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.4.2.7">44.7</td>
</tr>
<tr class="ltx_tr" id="A8.T12.1.5.3">
<th class="ltx_td ltx_th ltx_th_row" id="A8.T12.1.5.3.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A8.T12.1.5.3.2">CRISP MMLU</th>
<td class="ltx_td ltx_align_right" id="A8.T12.1.5.3.3">55.6</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.5.3.4">26.3</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.5.3.5">29.8</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A8.T12.1.5.3.6">61.3</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.5.3.7">44.0</td>
</tr>
<tr class="ltx_tr" id="A8.T12.1.6.4">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A8.T12.1.6.4.1">1B</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A8.T12.1.6.4.2">Base</th>
<td class="ltx_td ltx_align_right ltx_border_t" id="A8.T12.1.6.4.3">58.4</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A8.T12.1.6.4.4">27.5</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A8.T12.1.6.4.5">30.1</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A8.T12.1.6.4.6">62.2</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A8.T12.1.6.4.7">45.1</td>
</tr>
<tr class="ltx_tr" id="A8.T12.1.7.5">
<th class="ltx_td ltx_th ltx_th_row" id="A8.T12.1.7.5.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A8.T12.1.7.5.2">CRISP ARC</th>
<td class="ltx_td ltx_align_right" id="A8.T12.1.7.5.3">71.3</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.7.5.4">38.6</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.7.5.5">28.9</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A8.T12.1.7.5.6">60.9</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.7.5.7">48.2</td>
</tr>
<tr class="ltx_tr" id="A8.T12.1.8.6">
<th class="ltx_td ltx_th ltx_th_row" id="A8.T12.1.8.6.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A8.T12.1.8.6.2">CRISP MMLU</th>
<td class="ltx_td ltx_align_right" id="A8.T12.1.8.6.3">63.4</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.8.6.4">28.7</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.8.6.5">33.4</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A8.T12.1.8.6.6">65.2</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.8.6.7">48.2</td>
</tr>
<tr class="ltx_tr" id="A8.T12.1.9.7">
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_t" id="A8.T12.1.9.7.1">7B</th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r ltx_border_t" id="A8.T12.1.9.7.2">Base</th>
<td class="ltx_td ltx_align_right ltx_border_t" id="A8.T12.1.9.7.3">69.9</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A8.T12.1.9.7.4">35.9</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A8.T12.1.9.7.5">34.4</td>
<td class="ltx_td ltx_align_right ltx_border_r ltx_border_t" id="A8.T12.1.9.7.6">64.9</td>
<td class="ltx_td ltx_align_right ltx_border_t" id="A8.T12.1.9.7.7">50.7</td>
</tr>
<tr class="ltx_tr" id="A8.T12.1.10.8">
<th class="ltx_td ltx_th ltx_th_row" id="A8.T12.1.10.8.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_r" id="A8.T12.1.10.8.2">CRISP ARC</th>
<td class="ltx_td ltx_align_right" id="A8.T12.1.10.8.3">74.5</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.10.8.4">42.2</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.10.8.5">32.6</td>
<td class="ltx_td ltx_align_right ltx_border_r" id="A8.T12.1.10.8.6">62.4</td>
<td class="ltx_td ltx_align_right" id="A8.T12.1.10.8.7">51.1</td>
</tr>
<tr class="ltx_tr" id="A8.T12.1.11.9">
<th class="ltx_td ltx_th ltx_th_row ltx_border_bb" id="A8.T12.1.11.9.1"></th>
<th class="ltx_td ltx_align_left ltx_th ltx_th_row ltx_border_bb ltx_border_r" id="A8.T12.1.11.9.2">CRISP MMLU</th>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A8.T12.1.11.9.3">70.0</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A8.T12.1.11.9.4">37.6</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A8.T12.1.11.9.5">38.0</td>
<td class="ltx_td ltx_align_right ltx_border_bb ltx_border_r" id="A8.T12.1.11.9.6">67.5</td>
<td class="ltx_td ltx_align_right ltx_border_bb" id="A8.T12.1.11.9.7">53.1</td>
</tr>
</tbody>
</table>
</figure>
</section>
</section>
</section>
</div>
</div>
</figure>
</section>
</article>
</div>
<footer class="ltx_page_footer">
<div class="ltx_page_logo">Generated  on Mon Sep 30 20:43:09 2024 by <a class="ltx_LaTeXML_logo" href="http://dlmf.nist.gov/LaTeXML/"><span style="letter-spacing:-0.2em; margin-right:0.1em;">L<span class="ltx_font_smallcaps" style="position:relative; bottom:2.2pt;">a</span>T<span class="ltx_font_smallcaps" style="font-size:120%;position:relative; bottom:-0.2ex;">e</span></span><span style="font-size:90%; position:relative; bottom:-0.2ex;">XML</span><img alt="Mascot Sammy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAAOCAYAAAD5YeaVAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wKExQZLWTEaOUAAAAddEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIFRoZSBHSU1Q72QlbgAAAdpJREFUKM9tkL+L2nAARz9fPZNCKFapUn8kyI0e4iRHSR1Kb8ng0lJw6FYHFwv2LwhOpcWxTjeUunYqOmqd6hEoRDhtDWdA8ApRYsSUCDHNt5ul13vz4w0vWCgUnnEc975arX6ORqN3VqtVZbfbTQC4uEHANM3jSqXymFI6yWazP2KxWAXAL9zCUa1Wy2tXVxheKA9YNoR8Pt+aTqe4FVVVvz05O6MBhqUIBGk8Hn8HAOVy+T+XLJfLS4ZhTiRJgqIoVBRFIoric47jPnmeB1mW/9rr9ZpSSn3Lsmir1fJZlqWlUonKsvwWwD8ymc/nXwVBeLjf7xEKhdBut9Hr9WgmkyGEkJwsy5eHG5vN5g0AKIoCAEgkEkin0wQAfN9/cXPdheu6P33fBwB4ngcAcByHJpPJl+fn54mD3Gg0NrquXxeLRQAAwzAYj8cwTZPwPH9/sVg8PXweDAauqqr2cDjEer1GJBLBZDJBs9mE4zjwfZ85lAGg2+06hmGgXq+j3+/DsixYlgVN03a9Xu8jgCNCyIegIAgx13Vfd7vdu+FweG8YRkjXdWy329+dTgeSJD3ieZ7RNO0VAXAPwDEAO5VKndi2fWrb9jWl9Esul6PZbDY9Go1OZ7PZ9z/lyuD3OozU2wAAAABJRU5ErkJggg=="/></a>
</div></footer>
</div>
</body>
</html>
